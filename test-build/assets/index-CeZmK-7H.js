(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const Rc="171",W9=0,$9=1,H9=2,q9=0,Y9=1,Wa=3,$n=0,je=1,se=2,Hn=0,sn=1,pe=2,tc=3,ec=4,I3=5,ji=100,L3=101,U3=102,X9=103,j9=104,z3=200,V3=201,k3=202,O3=203,sc=204,ic=205,G3=206,W3=207,$3=208,H3=209,q3=210,Y3=0,X3=1,j3=2,nc=3,Z3=4,K3=5,J3=6,Q3=7,Fc=0,Z9=1,K9=2,Ko=0,J9=1,Q9=2,td=3,t5=4,ed=6,sd=7,Iu=300,qn=301,ir=302,va=303,Ma=304,N1=306,rn=1e3,Qi=1001,nr=1002,we=1003,C1=1004,Jo=1005,ps=1006,R1=1007,vi=1008,id=1008,nn=1009,$r=1010,Hr=1011,$o=1012,ke=1013,Ae=1014,qe=1015,Bs=1016,nd=1017,od=1018,Aa=1020,e5=35902,rd=1021,Lu=1022,an=1023,ad=1024,cd=1025,zn=1026,or=1027,Ec=1028,Uu=1029,aa=1030,zu=1031,ld=1032,Vu=1033,al=33776,z0=33777,V0=33778,k0=33779,w2=35840,_2=35841,T2=35842,S2=35843,v2=36196,F1=37492,E1=37496,B1=37808,D1=37809,P1=37810,I1=37811,L1=37812,U1=37813,z1=37814,V1=37815,k1=37816,O1=37817,G1=37818,W1=37819,$1=37820,H1=37821,cl=36492,ud=36283,M2=36284,A2=36285,N2=36286,cn=0,pd=1,Yn="",J="srgb",Mi="srgb-linear",C2="linear",qr="srgb",hd=0,Rn=7680,dd=7681,gd=7682,fd=7683,md=34055,yd=34056,xd=5386,bd=512,wd=513,_d=514,Td=515,Sd=516,vd=517,Md=518,q1=519,s5=512,ku=513,i5=514,n5=515,o5=516,r5=517,a5=518,c5=519,oc=35044,In=35048,Rs=2e3,Fi=2001;class gn{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let n=0,o=i.length;n<o;n++)i[n].call(this,t);t.target=null}}}const Fe=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let R2=1234567;const Yr=Math.PI/180,ca=180/Math.PI;function Ks(){const r=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(Fe[r&255]+Fe[r>>8&255]+Fe[r>>16&255]+Fe[r>>24&255]+"-"+Fe[t&255]+Fe[t>>8&255]+"-"+Fe[t>>16&15|64]+Fe[t>>24&255]+"-"+Fe[e&63|128]+Fe[e>>8&255]+"-"+Fe[e>>16&255]+Fe[e>>24&255]+Fe[s&255]+Fe[s>>8&255]+Fe[s>>16&255]+Fe[s>>24&255]).toLowerCase()}function ct(r,t,e){return Math.max(t,Math.min(e,r))}function Ou(r,t){return(r%t+t)%t}function Ad(r,t,e,s,i){return s+(r-t)*(i-s)/(e-t)}function Nd(r,t,e){return r!==t?(e-r)/(t-r):0}function Xr(r,t,e){return(1-e)*r+e*t}function Cd(r,t,e,s){return Xr(r,t,1-Math.exp(-e*s))}function Rd(r,t=1){return t-Math.abs(Ou(r,t*2)-t)}function Fd(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*(3-2*r))}function Ed(r,t,e){return r<=t?0:r>=e?1:(r=(r-t)/(e-t),r*r*r*(r*(r*6-15)+10))}function Bd(r,t){return r+Math.floor(Math.random()*(t-r+1))}function Dd(r,t){return r+Math.random()*(t-r)}function Pd(r){return r*(.5-Math.random())}function Id(r){r!==void 0&&(R2=r);let t=R2+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function Ld(r){return r*Yr}function Ud(r){return r*ca}function zd(r){return(r&r-1)===0&&r!==0}function Vd(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function kd(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function Od(r,t,e,s,i){const n=Math.cos,o=Math.sin,a=n(e/2),c=o(e/2),l=n((t+s)/2),u=o((t+s)/2),p=n((t-s)/2),h=o((t-s)/2),d=n((s-t)/2),g=o((s-t)/2);switch(i){case"XYX":r.set(a*u,c*p,c*h,a*l);break;case"YZY":r.set(c*h,a*u,c*p,a*l);break;case"ZXZ":r.set(c*p,c*h,a*u,a*l);break;case"XZX":r.set(a*u,c*g,c*d,a*l);break;case"YXY":r.set(c*d,a*u,c*g,a*l);break;case"ZYZ":r.set(c*g,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Oe(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function at(r,t){switch(t.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const Pe={DEG2RAD:Yr,RAD2DEG:ca,generateUUID:Ks,clamp:ct,euclideanModulo:Ou,mapLinear:Ad,inverseLerp:Nd,lerp:Xr,damp:Cd,pingpong:Rd,smoothstep:Fd,smootherstep:Ed,randInt:Bd,randFloat:Dd,randFloatSpread:Pd,seededRandom:Id,degToRad:Ld,radToDeg:Ud,isPowerOfTwo:zd,ceilPowerOfTwo:Vd,floorPowerOfTwo:kd,setQuaternionFromProperEuler:Od,normalize:at,denormalize:Oe};class q{constructor(t=0,e=0){q.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ct(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(ct(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,o=this.y-t.y;return this.x=n*s-o*i+t.x,this.y=n*i+o*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ts{constructor(t,e,s,i,n,o,a,c,l){ts.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,o,a,c,l)}set(t,e,s,i,n,o,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=e,u[4]=n,u[5]=c,u[6]=s,u[7]=o,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,o=s[0],a=s[3],c=s[6],l=s[1],u=s[4],p=s[7],h=s[2],d=s[5],g=s[8],f=i[0],y=i[3],x=i[6],b=i[1],w=i[4],_=i[7],T=i[2],M=i[5],A=i[8];return n[0]=o*f+a*b+c*T,n[3]=o*y+a*w+c*M,n[6]=o*x+a*_+c*A,n[1]=l*f+u*b+p*T,n[4]=l*y+u*w+p*M,n[7]=l*x+u*_+p*A,n[2]=h*f+d*b+g*T,n[5]=h*y+d*w+g*M,n[8]=h*x+d*_+g*A,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return e*o*u-e*a*l-s*n*u+s*a*c+i*n*l-i*o*c}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],p=u*o-a*l,h=a*c-u*n,d=l*n-o*c,g=e*p+s*h+i*d;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/g;return t[0]=p*f,t[1]=(i*l-u*s)*f,t[2]=(a*s-i*o)*f,t[3]=h*f,t[4]=(u*e-i*c)*f,t[5]=(i*n-a*e)*f,t[6]=d*f,t[7]=(s*c-l*e)*f,t[8]=(o*e-s*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,o,a){const c=Math.cos(n),l=Math.sin(n);return this.set(s*c,s*l,-s*(c*o+l*a)+o+t,-i*l,i*c,-i*(-l*o+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(ll.makeScale(t,e)),this}rotate(t){return this.premultiply(ll.makeRotation(-t)),this}translate(t,e){return this.premultiply(ll.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const ll=new ts;function Gd(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function Y1(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function Wd(){const r=Y1("canvas");return r.style.display="block",r}const F2={};function $d(r){r in F2||(F2[r]=!0,console.warn(r))}const E2=new ts().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),B2=new ts().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function Hd(){const r={enabled:!0,workingColorSpace:Mi,spaces:{},convert:function(i,n,o){return this.enabled===!1||n===o||!n||!o||(this.spaces[n].transfer===qr&&(i.r=Ai(i.r),i.g=Ai(i.g),i.b=Ai(i.b)),this.spaces[n].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[n].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===qr&&(i.r=Qo(i.r),i.g=Qo(i.g),i.b=Qo(i.b))),i},fromWorkingColorSpace:function(i,n){return this.convert(i,this.workingColorSpace,n)},toWorkingColorSpace:function(i,n){return this.convert(i,n,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Yn?C2:this.spaces[i].transfer},getLuminanceCoefficients:function(i,n=this.workingColorSpace){return i.fromArray(this.spaces[n].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,n,o){return i.copy(this.spaces[n].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],s=[.3127,.329];return r.define({[Mi]:{primaries:t,whitePoint:s,transfer:C2,toXYZ:E2,fromXYZ:B2,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:J},outputColorSpaceConfig:{drawingBufferColorSpace:J}},[J]:{primaries:t,whitePoint:s,transfer:qr,toXYZ:E2,fromXYZ:B2,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:J}}}),r}const ee=Hd();function Ai(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function Qo(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let ho;class qd{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{ho===void 0&&(ho=Y1("canvas")),ho.width=t.width,ho.height=t.height;const s=ho.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=ho}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Y1("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let o=0;o<n.length;o++)n[o]=Ai(n[o]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Ai(e[s]/255)*255):e[s]=Ai(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Yd=0;class l5{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Yd++}),this.uuid=Ks(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let o=0,a=i.length;o<a;o++)i[o].isDataTexture?n.push(ul(i[o].image)):n.push(ul(i[o]))}else n=ul(i);s.url=n}return e||(t.images[this.uuid]=s),s}}function ul(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?qd.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Xd=0;class Ge extends gn{constructor(t=Ge.DEFAULT_IMAGE,e=Ge.DEFAULT_MAPPING,s=Qi,i=Qi,n=ps,o=vi,a=an,c=nn,l=Ge.DEFAULT_ANISOTROPY,u=Yn){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Xd++}),this.uuid=Ks(),this.name="",this.source=new l5(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=o,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new q(0,0),this.repeat=new q(1,1),this.center=new q(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ts,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Iu)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case rn:t.x=t.x-Math.floor(t.x);break;case Qi:t.x=t.x<0?0:1;break;case nr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case rn:t.y=t.y-Math.floor(t.y);break;case Qi:t.y=t.y<0?0:1;break;case nr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ge.DEFAULT_IMAGE=null;Ge.DEFAULT_MAPPING=Iu;Ge.DEFAULT_ANISOTROPY=1;class yt{constructor(t=0,e=0,s=0,i=1){yt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,o=t.elements;return this.x=o[0]*e+o[4]*s+o[8]*i+o[12]*n,this.y=o[1]*e+o[5]*s+o[9]*i+o[13]*n,this.z=o[2]*e+o[6]*s+o[10]*i+o[14]*n,this.w=o[3]*e+o[7]*s+o[11]*i+o[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const c=t.elements,l=c[0],u=c[4],p=c[8],h=c[1],d=c[5],g=c[9],f=c[2],y=c[6],x=c[10];if(Math.abs(u-h)<.01&&Math.abs(p-f)<.01&&Math.abs(g-y)<.01){if(Math.abs(u+h)<.1&&Math.abs(p+f)<.1&&Math.abs(g+y)<.1&&Math.abs(l+d+x-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const w=(l+1)/2,_=(d+1)/2,T=(x+1)/2,M=(u+h)/4,A=(p+f)/4,C=(g+y)/4;return w>_&&w>T?w<.01?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(w),i=M/s,n=A/s):_>T?_<.01?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(_),s=M/i,n=C/i):T<.01?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(T),s=A/n,i=C/n),this.set(s,i,n,e),this}let b=Math.sqrt((y-g)*(y-g)+(p-f)*(p-f)+(h-u)*(h-u));return Math.abs(b)<.001&&(b=1),this.x=(y-g)/b,this.y=(p-f)/b,this.z=(h-u)/b,this.w=Math.acos((l+d+x-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this.z=ct(this.z,t.z,e.z),this.w=ct(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this.z=ct(this.z,t,e),this.w=ct(this.w,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ct(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class fn extends gn{constructor(t=1,e=1,s={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new yt(0,0,t,e),this.scissorTest=!1,this.viewport=new yt(0,0,t,e);const i={width:t,height:e,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ps,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},s);const n=new Ge(i,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);n.flipY=!1,n.generateMipmaps=s.generateMipmaps,n.internalFormat=s.internalFormat,this.textures=[];const o=s.count;for(let a=0;a<o;a++)this.textures[a]=n.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,s=1){if(this.width!==t||this.height!==e||this.depth!==s){this.width=t,this.height=e,this.depth=s;for(let i=0,n=this.textures.length;i<n;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=s;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let s=0,i=t.textures.length;s<i;s++)this.textures[s]=t.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new l5(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class jd extends fn{constructor(t=1,e=1,s={}){super(t,e,s),this.isWebGLRenderTarget=!0}}class Zd extends Ge{constructor(t=null,e=1,s=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:s,depth:i},this.magFilter=we,this.minFilter=we,this.wrapR=Qi,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class pr{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,o,a){let c=s[i+0],l=s[i+1],u=s[i+2],p=s[i+3];const h=n[o+0],d=n[o+1],g=n[o+2],f=n[o+3];if(a===0){t[e+0]=c,t[e+1]=l,t[e+2]=u,t[e+3]=p;return}if(a===1){t[e+0]=h,t[e+1]=d,t[e+2]=g,t[e+3]=f;return}if(p!==f||c!==h||l!==d||u!==g){let y=1-a;const x=c*h+l*d+u*g+p*f,b=x>=0?1:-1,w=1-x*x;if(w>Number.EPSILON){const T=Math.sqrt(w),M=Math.atan2(T,x*b);y=Math.sin(y*M)/T,a=Math.sin(a*M)/T}const _=a*b;if(c=c*y+h*_,l=l*y+d*_,u=u*y+g*_,p=p*y+f*_,y===1-a){const T=1/Math.sqrt(c*c+l*l+u*u+p*p);c*=T,l*=T,u*=T,p*=T}}t[e]=c,t[e+1]=l,t[e+2]=u,t[e+3]=p}static multiplyQuaternionsFlat(t,e,s,i,n,o){const a=s[i],c=s[i+1],l=s[i+2],u=s[i+3],p=n[o],h=n[o+1],d=n[o+2],g=n[o+3];return t[e]=a*g+u*p+c*d-l*h,t[e+1]=c*g+u*h+l*p-a*d,t[e+2]=l*g+u*d+a*h-c*p,t[e+3]=u*g-a*p-c*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,o=t._order,a=Math.cos,c=Math.sin,l=a(s/2),u=a(i/2),p=a(n/2),h=c(s/2),d=c(i/2),g=c(n/2);switch(o){case"XYZ":this._x=h*u*p+l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p-h*d*g;break;case"YXZ":this._x=h*u*p+l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p+h*d*g;break;case"ZXY":this._x=h*u*p-l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p-h*d*g;break;case"ZYX":this._x=h*u*p-l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p+h*d*g;break;case"YZX":this._x=h*u*p+l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p-h*d*g;break;case"XZY":this._x=h*u*p-l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p+h*d*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],o=e[1],a=e[5],c=e[9],l=e[2],u=e[6],p=e[10],h=s+a+p;if(h>0){const d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-c)*d,this._y=(n-l)*d,this._z=(o-i)*d}else if(s>a&&s>p){const d=2*Math.sqrt(1+s-a-p);this._w=(u-c)/d,this._x=.25*d,this._y=(i+o)/d,this._z=(n+l)/d}else if(a>p){const d=2*Math.sqrt(1+a-s-p);this._w=(n-l)/d,this._x=(i+o)/d,this._y=.25*d,this._z=(c+u)/d}else{const d=2*Math.sqrt(1+p-s-a);this._w=(o-i)/d,this._x=(n+l)/d,this._y=(c+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ct(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,o=t._w,a=e._x,c=e._y,l=e._z,u=e._w;return this._x=s*u+o*a+i*l-n*c,this._y=i*u+o*c+n*a-s*l,this._z=n*u+o*l+s*c-i*a,this._w=o*u-s*a-i*c-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,n=this._z,o=this._w;let a=o*t._w+s*t._x+i*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=o,this._x=s,this._y=i,this._z=n,this;const c=1-a*a;if(c<=Number.EPSILON){const d=1-e;return this._w=d*o+e*this._w,this._x=d*s+e*this._x,this._y=d*i+e*this._y,this._z=d*n+e*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),p=Math.sin((1-e)*u)/l,h=Math.sin(e*u)/l;return this._w=o*p+this._w*h,this._x=s*p+this._x*h,this._y=i*p+this._y*h,this._z=n*p+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class v{constructor(t=0,e=0,s=0){v.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(D2.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(D2.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,o=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*o,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*o,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*o,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,o=t.y,a=t.z,c=t.w,l=2*(o*i-a*s),u=2*(a*e-n*i),p=2*(n*s-o*e);return this.x=e+c*l+o*p-a*u,this.y=s+c*u+a*l-n*p,this.z=i+c*p+n*u-o*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=ct(this.x,t.x,e.x),this.y=ct(this.y,t.y,e.y),this.z=ct(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=ct(this.x,t,e),this.y=ct(this.y,t,e),this.z=ct(this.z,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(ct(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,o=e.x,a=e.y,c=e.z;return this.x=i*c-n*a,this.y=n*o-s*c,this.z=s*a-i*o,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return pl.copy(this).projectOnVector(t),this.sub(pl)}reflect(t){return this.sub(pl.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(ct(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pl=new v,D2=new pr;class Jn{constructor(t=new v(1/0,1/0,1/0),e=new v(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Ss.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Ss.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Ss.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const n=s.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let o=0,a=n.count;o<a;o++)t.isMesh===!0?t.getVertexPosition(o,Ss):Ss.fromBufferAttribute(n,o),Ss.applyMatrix4(t.matrixWorld),this.expandByPoint(Ss);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),$a.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),$a.copy(s.boundingBox)),$a.applyMatrix4(t.matrixWorld),this.union($a)}const i=t.children;for(let n=0,o=i.length;n<o;n++)this.expandByObject(i[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Ss),Ss.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(xr),Ha.subVectors(this.max,xr),go.subVectors(t.a,xr),fo.subVectors(t.b,xr),mo.subVectors(t.c,xr),zi.subVectors(fo,go),Vi.subVectors(mo,fo),wn.subVectors(go,mo);let e=[0,-zi.z,zi.y,0,-Vi.z,Vi.y,0,-wn.z,wn.y,zi.z,0,-zi.x,Vi.z,0,-Vi.x,wn.z,0,-wn.x,-zi.y,zi.x,0,-Vi.y,Vi.x,0,-wn.y,wn.x,0];return!hl(e,go,fo,mo,Ha)||(e=[1,0,0,0,1,0,0,0,1],!hl(e,go,fo,mo,Ha))?!1:(qa.crossVectors(zi,Vi),e=[qa.x,qa.y,qa.z],hl(e,go,fo,mo,Ha))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Ss).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Ss).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(ui[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),ui[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),ui[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),ui[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),ui[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),ui[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),ui[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),ui[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(ui),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const ui=[new v,new v,new v,new v,new v,new v,new v,new v],Ss=new v,$a=new Jn,go=new v,fo=new v,mo=new v,zi=new v,Vi=new v,wn=new v,xr=new v,Ha=new v,qa=new v,_n=new v;function hl(r,t,e,s,i){for(let n=0,o=r.length-3;n<=o;n+=3){_n.fromArray(r,n);const a=i.x*Math.abs(_n.x)+i.y*Math.abs(_n.y)+i.z*Math.abs(_n.z),c=t.dot(_n),l=e.dot(_n),u=s.dot(_n);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const Kd=new Jn,br=new v,dl=new v;class Qn{constructor(t=new v,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):Kd.setFromPoints(t).getCenter(s);let i=0;for(let n=0,o=t.length;n<o;n++)i=Math.max(i,s.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;br.subVectors(t,this.center);const e=br.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(br,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(dl.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(br.copy(t.center).add(dl)),this.expandByPoint(br.copy(t.center).sub(dl))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const pi=new v,gl=new v,Ya=new v,ki=new v,fl=new v,Xa=new v,ml=new v;class u5{constructor(t=new v,e=new v(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,pi)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=pi.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(pi.copy(this.origin).addScaledVector(this.direction,e),pi.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){gl.copy(t).add(e).multiplyScalar(.5),Ya.copy(e).sub(t).normalize(),ki.copy(this.origin).sub(gl);const n=t.distanceTo(e)*.5,o=-this.direction.dot(Ya),a=ki.dot(this.direction),c=-ki.dot(Ya),l=ki.lengthSq(),u=Math.abs(1-o*o);let p,h,d,g;if(u>0)if(p=o*c-a,h=o*a-c,g=n*u,p>=0)if(h>=-g)if(h<=g){const f=1/u;p*=f,h*=f,d=p*(p+o*h+2*a)+h*(o*p+h+2*c)+l}else h=n,p=Math.max(0,-(o*h+a)),d=-p*p+h*(h+2*c)+l;else h=-n,p=Math.max(0,-(o*h+a)),d=-p*p+h*(h+2*c)+l;else h<=-g?(p=Math.max(0,-(-o*n+a)),h=p>0?-n:Math.min(Math.max(-n,-c),n),d=-p*p+h*(h+2*c)+l):h<=g?(p=0,h=Math.min(Math.max(-n,-c),n),d=h*(h+2*c)+l):(p=Math.max(0,-(o*n+a)),h=p>0?n:Math.min(Math.max(-n,-c),n),d=-p*p+h*(h+2*c)+l);else h=o>0?-n:n,p=Math.max(0,-(o*h+a)),d=-p*p+h*(h+2*c)+l;return s&&s.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(gl).addScaledVector(Ya,h),d}intersectSphere(t,e){pi.subVectors(t.center,this.origin);const s=pi.dot(this.direction),i=pi.dot(pi)-s*s,n=t.radius*t.radius;if(i>n)return null;const o=Math.sqrt(n-i),a=s-o,c=s+o;return c<0?null:a<0?this.at(c,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,o,a,c;const l=1/this.direction.x,u=1/this.direction.y,p=1/this.direction.z,h=this.origin;return l>=0?(s=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(s=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),u>=0?(n=(t.min.y-h.y)*u,o=(t.max.y-h.y)*u):(n=(t.max.y-h.y)*u,o=(t.min.y-h.y)*u),s>o||n>i||((n>s||isNaN(s))&&(s=n),(o<i||isNaN(i))&&(i=o),p>=0?(a=(t.min.z-h.z)*p,c=(t.max.z-h.z)*p):(a=(t.max.z-h.z)*p,c=(t.min.z-h.z)*p),s>c||a>i)||((a>s||s!==s)&&(s=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,pi)!==null}intersectTriangle(t,e,s,i,n){fl.subVectors(e,t),Xa.subVectors(s,t),ml.crossVectors(fl,Xa);let o=this.direction.dot(ml),a;if(o>0){if(i)return null;a=1}else if(o<0)a=-1,o=-o;else return null;ki.subVectors(this.origin,t);const c=a*this.direction.dot(Xa.crossVectors(ki,Xa));if(c<0)return null;const l=a*this.direction.dot(fl.cross(ki));if(l<0||c+l>o)return null;const u=-a*ki.dot(ml);return u<0?null:this.at(u/o,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class pt{constructor(t,e,s,i,n,o,a,c,l,u,p,h,d,g,f,y){pt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,o,a,c,l,u,p,h,d,g,f,y)}set(t,e,s,i,n,o,a,c,l,u,p,h,d,g,f,y){const x=this.elements;return x[0]=t,x[4]=e,x[8]=s,x[12]=i,x[1]=n,x[5]=o,x[9]=a,x[13]=c,x[2]=l,x[6]=u,x[10]=p,x[14]=h,x[3]=d,x[7]=g,x[11]=f,x[15]=y,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pt().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/yo.setFromMatrixColumn(t,0).length(),n=1/yo.setFromMatrixColumn(t,1).length(),o=1/yo.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*o,e[9]=s[9]*o,e[10]=s[10]*o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,o=Math.cos(s),a=Math.sin(s),c=Math.cos(i),l=Math.sin(i),u=Math.cos(n),p=Math.sin(n);if(t.order==="XYZ"){const h=o*u,d=o*p,g=a*u,f=a*p;e[0]=c*u,e[4]=-c*p,e[8]=l,e[1]=d+g*l,e[5]=h-f*l,e[9]=-a*c,e[2]=f-h*l,e[6]=g+d*l,e[10]=o*c}else if(t.order==="YXZ"){const h=c*u,d=c*p,g=l*u,f=l*p;e[0]=h+f*a,e[4]=g*a-d,e[8]=o*l,e[1]=o*p,e[5]=o*u,e[9]=-a,e[2]=d*a-g,e[6]=f+h*a,e[10]=o*c}else if(t.order==="ZXY"){const h=c*u,d=c*p,g=l*u,f=l*p;e[0]=h-f*a,e[4]=-o*p,e[8]=g+d*a,e[1]=d+g*a,e[5]=o*u,e[9]=f-h*a,e[2]=-o*l,e[6]=a,e[10]=o*c}else if(t.order==="ZYX"){const h=o*u,d=o*p,g=a*u,f=a*p;e[0]=c*u,e[4]=g*l-d,e[8]=h*l+f,e[1]=c*p,e[5]=f*l+h,e[9]=d*l-g,e[2]=-l,e[6]=a*c,e[10]=o*c}else if(t.order==="YZX"){const h=o*c,d=o*l,g=a*c,f=a*l;e[0]=c*u,e[4]=f-h*p,e[8]=g*p+d,e[1]=p,e[5]=o*u,e[9]=-a*u,e[2]=-l*u,e[6]=d*p+g,e[10]=h-f*p}else if(t.order==="XZY"){const h=o*c,d=o*l,g=a*c,f=a*l;e[0]=c*u,e[4]=-p,e[8]=l*u,e[1]=h*p+f,e[5]=o*u,e[9]=d*p-g,e[2]=g*p-d,e[6]=a*u,e[10]=f*p+h}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Jd,t,Qd)}lookAt(t,e,s){const i=this.elements;return is.subVectors(t,e),is.lengthSq()===0&&(is.z=1),is.normalize(),Oi.crossVectors(s,is),Oi.lengthSq()===0&&(Math.abs(s.z)===1?is.x+=1e-4:is.z+=1e-4,is.normalize(),Oi.crossVectors(s,is)),Oi.normalize(),ja.crossVectors(is,Oi),i[0]=Oi.x,i[4]=ja.x,i[8]=is.x,i[1]=Oi.y,i[5]=ja.y,i[9]=is.y,i[2]=Oi.z,i[6]=ja.z,i[10]=is.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,o=s[0],a=s[4],c=s[8],l=s[12],u=s[1],p=s[5],h=s[9],d=s[13],g=s[2],f=s[6],y=s[10],x=s[14],b=s[3],w=s[7],_=s[11],T=s[15],M=i[0],A=i[4],C=i[8],P=i[12],D=i[1],V=i[5],$=i[9],Y=i[13],tt=i[2],ot=i[6],Nt=i[10],de=i[14],ut=i[3],gt=i[7],Bt=i[11],Ot=i[15];return n[0]=o*M+a*D+c*tt+l*ut,n[4]=o*A+a*V+c*ot+l*gt,n[8]=o*C+a*$+c*Nt+l*Bt,n[12]=o*P+a*Y+c*de+l*Ot,n[1]=u*M+p*D+h*tt+d*ut,n[5]=u*A+p*V+h*ot+d*gt,n[9]=u*C+p*$+h*Nt+d*Bt,n[13]=u*P+p*Y+h*de+d*Ot,n[2]=g*M+f*D+y*tt+x*ut,n[6]=g*A+f*V+y*ot+x*gt,n[10]=g*C+f*$+y*Nt+x*Bt,n[14]=g*P+f*Y+y*de+x*Ot,n[3]=b*M+w*D+_*tt+T*ut,n[7]=b*A+w*V+_*ot+T*gt,n[11]=b*C+w*$+_*Nt+T*Bt,n[15]=b*P+w*Y+_*de+T*Ot,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],o=t[1],a=t[5],c=t[9],l=t[13],u=t[2],p=t[6],h=t[10],d=t[14],g=t[3],f=t[7],y=t[11],x=t[15];return g*(+n*c*p-i*l*p-n*a*h+s*l*h+i*a*d-s*c*d)+f*(+e*c*d-e*l*h+n*o*h-i*o*d+i*l*u-n*c*u)+y*(+e*l*p-e*a*d-n*o*p+s*o*d+n*a*u-s*l*u)+x*(-i*a*u-e*c*p+e*a*h+i*o*p-s*o*h+s*c*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],o=t[4],a=t[5],c=t[6],l=t[7],u=t[8],p=t[9],h=t[10],d=t[11],g=t[12],f=t[13],y=t[14],x=t[15],b=p*y*l-f*h*l+f*c*d-a*y*d-p*c*x+a*h*x,w=g*h*l-u*y*l-g*c*d+o*y*d+u*c*x-o*h*x,_=u*f*l-g*p*l+g*a*d-o*f*d-u*a*x+o*p*x,T=g*p*c-u*f*c-g*a*h+o*f*h+u*a*y-o*p*y,M=e*b+s*w+i*_+n*T;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const A=1/M;return t[0]=b*A,t[1]=(f*h*n-p*y*n-f*i*d+s*y*d+p*i*x-s*h*x)*A,t[2]=(a*y*n-f*c*n+f*i*l-s*y*l-a*i*x+s*c*x)*A,t[3]=(p*c*n-a*h*n-p*i*l+s*h*l+a*i*d-s*c*d)*A,t[4]=w*A,t[5]=(u*y*n-g*h*n+g*i*d-e*y*d-u*i*x+e*h*x)*A,t[6]=(g*c*n-o*y*n-g*i*l+e*y*l+o*i*x-e*c*x)*A,t[7]=(o*h*n-u*c*n+u*i*l-e*h*l-o*i*d+e*c*d)*A,t[8]=_*A,t[9]=(g*p*n-u*f*n-g*s*d+e*f*d+u*s*x-e*p*x)*A,t[10]=(o*f*n-g*a*n+g*s*l-e*f*l-o*s*x+e*a*x)*A,t[11]=(u*a*n-o*p*n-u*s*l+e*p*l+o*s*d-e*a*d)*A,t[12]=T*A,t[13]=(u*f*i-g*p*i+g*s*h-e*f*h-u*s*y+e*p*y)*A,t[14]=(g*a*i-o*f*i-g*s*c+e*f*c+o*s*y-e*a*y)*A,t[15]=(o*p*i-u*a*i+u*s*c-e*p*c-o*s*h+e*a*h)*A,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,o=t.x,a=t.y,c=t.z,l=n*o,u=n*a;return this.set(l*o+s,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+s,u*c-i*o,0,l*c-i*a,u*c+i*o,n*c*c+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,o){return this.set(1,s,n,0,t,1,o,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,o=e._y,a=e._z,c=e._w,l=n+n,u=o+o,p=a+a,h=n*l,d=n*u,g=n*p,f=o*u,y=o*p,x=a*p,b=c*l,w=c*u,_=c*p,T=s.x,M=s.y,A=s.z;return i[0]=(1-(f+x))*T,i[1]=(d+_)*T,i[2]=(g-w)*T,i[3]=0,i[4]=(d-_)*M,i[5]=(1-(h+x))*M,i[6]=(y+b)*M,i[7]=0,i[8]=(g+w)*A,i[9]=(y-b)*A,i[10]=(1-(h+f))*A,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=yo.set(i[0],i[1],i[2]).length();const o=yo.set(i[4],i[5],i[6]).length(),a=yo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],vs.copy(this);const l=1/n,u=1/o,p=1/a;return vs.elements[0]*=l,vs.elements[1]*=l,vs.elements[2]*=l,vs.elements[4]*=u,vs.elements[5]*=u,vs.elements[6]*=u,vs.elements[8]*=p,vs.elements[9]*=p,vs.elements[10]*=p,e.setFromRotationMatrix(vs),s.x=n,s.y=o,s.z=a,this}makePerspective(t,e,s,i,n,o,a=Rs){const c=this.elements,l=2*n/(e-t),u=2*n/(s-i),p=(e+t)/(e-t),h=(s+i)/(s-i);let d,g;if(a===Rs)d=-(o+n)/(o-n),g=-2*o*n/(o-n);else if(a===Fi)d=-o/(o-n),g=-o*n/(o-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=p,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=d,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,s,i,n,o,a=Rs){const c=this.elements,l=1/(e-t),u=1/(s-i),p=1/(o-n),h=(e+t)*l,d=(s+i)*u;let g,f;if(a===Rs)g=(o+n)*p,f=-2*p;else if(a===Fi)g=n*p,f=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=f,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const yo=new v,vs=new pt,Jd=new v(0,0,0),Qd=new v(1,1,1),Oi=new v,ja=new v,is=new v,P2=new pt,I2=new pr;class hs{constructor(t=0,e=0,s=0,i=hs.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],o=i[4],a=i[8],c=i[1],l=i[5],u=i[9],p=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(ct(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-o,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-ct(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-p,n),this._z=0);break;case"ZXY":this._x=Math.asin(ct(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-p,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(c,n));break;case"ZYX":this._y=Math.asin(-ct(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(c,n)):(this._x=0,this._z=Math.atan2(-o,l));break;case"YZX":this._z=Math.asin(ct(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-p,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-ct(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return P2.makeRotationFromQuaternion(t),this.setFromRotationMatrix(P2,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return I2.setFromEuler(this),this.setFromQuaternion(I2,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}hs.DEFAULT_ORDER="XYZ";class tg{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let eg=0;const L2=new v,xo=new pr,hi=new pt,Za=new v,wr=new v,sg=new v,ig=new pr,U2=new v(1,0,0),z2=new v(0,1,0),V2=new v(0,0,1),k2={type:"added"},ng={type:"removed"},bo={type:"childadded",child:null},yl={type:"childremoved",child:null};class Yt extends gn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:eg++}),this.uuid=Ks(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Yt.DEFAULT_UP.clone();const t=new v,e=new hs,s=new pr,i=new v(1,1,1);function n(){s.setFromEuler(e,!1)}function o(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new pt},normalMatrix:{value:new ts}}),this.matrix=new pt,this.matrixWorld=new pt,this.matrixAutoUpdate=Yt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new tg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return xo.setFromAxisAngle(t,e),this.quaternion.multiply(xo),this}rotateOnWorldAxis(t,e){return xo.setFromAxisAngle(t,e),this.quaternion.premultiply(xo),this}rotateX(t){return this.rotateOnAxis(U2,t)}rotateY(t){return this.rotateOnAxis(z2,t)}rotateZ(t){return this.rotateOnAxis(V2,t)}translateOnAxis(t,e){return L2.copy(t).applyQuaternion(this.quaternion),this.position.add(L2.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(U2,t)}translateY(t){return this.translateOnAxis(z2,t)}translateZ(t){return this.translateOnAxis(V2,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(hi.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?Za.copy(t):Za.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),wr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?hi.lookAt(wr,Za,this.up):hi.lookAt(Za,wr,this.up),this.quaternion.setFromRotationMatrix(hi),i&&(hi.extractRotation(i.matrixWorld),xo.setFromRotationMatrix(hi),this.quaternion.premultiply(xo.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(k2),bo.child=t,this.dispatchEvent(bo),bo.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ng),yl.child=t,this.dispatchEvent(yl),yl.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),hi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),hi.multiply(t.parent.matrixWorld)),t.applyMatrix4(hi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(k2),bo.child=t,this.dispatchEvent(bo),bo.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const o=this.children[s].getObjectByProperty(t,e);if(o!==void 0)return o}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,o=i.length;n<o;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wr,t,sg),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(wr,ig,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].updateMatrixWorld(t)}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let n=0,o=i.length;n<o;n++)i[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function n(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const p=c[l];n(t.shapes,p)}else n(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(n(t.materials,this.material[c]));i.material=a}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(n(t.animations,c))}}if(e){const a=o(t.geometries),c=o(t.materials),l=o(t.textures),u=o(t.images),p=o(t.shapes),h=o(t.skeletons),d=o(t.animations),g=o(t.nodes);a.length>0&&(s.geometries=a),c.length>0&&(s.materials=c),l.length>0&&(s.textures=l),u.length>0&&(s.images=u),p.length>0&&(s.shapes=p),h.length>0&&(s.skeletons=h),d.length>0&&(s.animations=d),g.length>0&&(s.nodes=g)}return s.object=i,s;function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}Yt.DEFAULT_UP=new v(0,1,0);Yt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Yt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ms=new v,di=new v,xl=new v,gi=new v,wo=new v,_o=new v,O2=new v,bl=new v,wl=new v,_l=new v,Tl=new yt,Sl=new yt,vl=new yt;class Cs{constructor(t=new v,e=new v,s=new v){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),Ms.subVectors(t,e),i.cross(Ms);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){Ms.subVectors(i,e),di.subVectors(s,e),xl.subVectors(t,e);const o=Ms.dot(Ms),a=Ms.dot(di),c=Ms.dot(xl),l=di.dot(di),u=di.dot(xl),p=o*l-a*a;if(p===0)return n.set(0,0,0),null;const h=1/p,d=(l*c-a*u)*h,g=(o*u-a*c)*h;return n.set(1-d-g,g,d)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,gi)===null?!1:gi.x>=0&&gi.y>=0&&gi.x+gi.y<=1}static getInterpolation(t,e,s,i,n,o,a,c){return this.getBarycoord(t,e,s,i,gi)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(n,gi.x),c.addScaledVector(o,gi.y),c.addScaledVector(a,gi.z),c)}static getInterpolatedAttribute(t,e,s,i,n,o){return Tl.setScalar(0),Sl.setScalar(0),vl.setScalar(0),Tl.fromBufferAttribute(t,e),Sl.fromBufferAttribute(t,s),vl.fromBufferAttribute(t,i),o.setScalar(0),o.addScaledVector(Tl,n.x),o.addScaledVector(Sl,n.y),o.addScaledVector(vl,n.z),o}static isFrontFacing(t,e,s,i){return Ms.subVectors(s,e),di.subVectors(t,e),Ms.cross(di).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return Ms.subVectors(this.c,this.b),di.subVectors(this.a,this.b),Ms.cross(di).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Cs.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Cs.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return Cs.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return Cs.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Cs.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let o,a;wo.subVectors(i,s),_o.subVectors(n,s),bl.subVectors(t,s);const c=wo.dot(bl),l=_o.dot(bl);if(c<=0&&l<=0)return e.copy(s);wl.subVectors(t,i);const u=wo.dot(wl),p=_o.dot(wl);if(u>=0&&p<=u)return e.copy(i);const h=c*p-u*l;if(h<=0&&c>=0&&u<=0)return o=c/(c-u),e.copy(s).addScaledVector(wo,o);_l.subVectors(t,n);const d=wo.dot(_l),g=_o.dot(_l);if(g>=0&&d<=g)return e.copy(n);const f=d*l-c*g;if(f<=0&&l>=0&&g<=0)return a=l/(l-g),e.copy(s).addScaledVector(_o,a);const y=u*g-d*p;if(y<=0&&p-u>=0&&d-g>=0)return O2.subVectors(n,i),a=(p-u)/(p-u+(d-g)),e.copy(i).addScaledVector(O2,a);const x=1/(y+f+h);return o=f*x,a=h*x,e.copy(s).addScaledVector(wo,o).addScaledVector(_o,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const p5={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gi={h:0,s:0,l:0},Ka={h:0,s:0,l:0};function Ml(r,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?r+(t-r)*6*e:e<1/2?t:e<2/3?r+(t-r)*6*(2/3-e):r}class W{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=J){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,ee.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=ee.workingColorSpace){return this.r=t,this.g=e,this.b=s,ee.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=ee.workingColorSpace){if(t=Ou(t,1),e=ct(e,0,1),s=ct(s,0,1),e===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+e):s+e-s*e,o=2*s-n;this.r=Ml(o,n,t+1/3),this.g=Ml(o,n,t),this.b=Ml(o,n,t-1/3)}return ee.toWorkingColorSpace(this,i),this}setStyle(t,e=J){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const o=i[1],a=i[2];switch(o){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],o=n.length;if(o===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(o===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=J){const s=p5[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Ai(t.r),this.g=Ai(t.g),this.b=Ai(t.b),this}copyLinearToSRGB(t){return this.r=Qo(t.r),this.g=Qo(t.g),this.b=Qo(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=J){return ee.fromWorkingColorSpace(Ee.copy(this),t),Math.round(ct(Ee.r*255,0,255))*65536+Math.round(ct(Ee.g*255,0,255))*256+Math.round(ct(Ee.b*255,0,255))}getHexString(t=J){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=ee.workingColorSpace){ee.fromWorkingColorSpace(Ee.copy(this),e);const s=Ee.r,i=Ee.g,n=Ee.b,o=Math.max(s,i,n),a=Math.min(s,i,n);let c,l;const u=(a+o)/2;if(a===o)c=0,l=0;else{const p=o-a;switch(l=u<=.5?p/(o+a):p/(2-o-a),o){case s:c=(i-n)/p+(i<n?6:0);break;case i:c=(n-s)/p+2;break;case n:c=(s-i)/p+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,e=ee.workingColorSpace){return ee.fromWorkingColorSpace(Ee.copy(this),e),t.r=Ee.r,t.g=Ee.g,t.b=Ee.b,t}getStyle(t=J){ee.fromWorkingColorSpace(Ee.copy(this),t);const e=Ee.r,s=Ee.g,i=Ee.b;return t!==J?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(t,e,s){return this.getHSL(Gi),this.setHSL(Gi.h+t,Gi.s+e,Gi.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(Gi),t.getHSL(Ka);const s=Xr(Gi.h,Ka.h,e),i=Xr(Gi.s,Ka.s,e),n=Xr(Gi.l,Ka.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ee=new W;W.NAMES=p5;let og=0;class Ze extends gn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:og++}),this.uuid=Ks(),this.name="",this.type="Material",this.blending=sn,this.side=$n,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=sc,this.blendDst=ic,this.blendEquation=ji,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new W(0,0,0),this.blendAlpha=0,this.depthFunc=nc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=q1,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Rn,this.stencilZFail=Rn,this.stencilZPass=Rn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==sn&&(s.blending=this.blending),this.side!==$n&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==sc&&(s.blendSrc=this.blendSrc),this.blendDst!==ic&&(s.blendDst=this.blendDst),this.blendEquation!==ji&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==nc&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==q1&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Rn&&(s.stencilFail=this.stencilFail),this.stencilZFail!==Rn&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==Rn&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(n){const o=[];for(const a in n){const c=n[a];delete c.metadata,o.push(c)}return o}if(e){const n=i(t.textures),o=i(t.images);n.length>0&&(s.textures=n),o.length>0&&(s.images=o)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let n=0;n!==i;++n)s[n]=e[n].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class Ds extends Ze{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new hs,this.combine=Fc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const _i=rg();function rg(){const r=new ArrayBuffer(4),t=new Float32Array(r),e=new Uint32Array(r),s=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(s[c]=0,s[c|256]=32768,i[c]=24,i[c|256]=24):l<-14?(s[c]=1024>>-l-14,s[c|256]=1024>>-l-14|32768,i[c]=-l-1,i[c|256]=-l-1):l<=15?(s[c]=l+15<<10,s[c|256]=l+15<<10|32768,i[c]=13,i[c|256]=13):l<128?(s[c]=31744,s[c|256]=64512,i[c]=24,i[c|256]=24):(s[c]=31744,s[c|256]=64512,i[c]=13,i[c|256]=13)}const n=new Uint32Array(2048),o=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,u=0;for(;(l&8388608)===0;)l<<=1,u-=8388608;l&=-8388609,u+=947912704,n[c]=l|u}for(let c=1024;c<2048;++c)n[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:t,uint32View:e,baseTable:s,shiftTable:i,mantissaTable:n,exponentTable:o,offsetTable:a}}function ns(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=ct(r,-65504,65504),_i.floatView[0]=r;const t=_i.uint32View[0],e=t>>23&511;return _i.baseTable[e]+((t&8388607)>>_i.shiftTable[e])}function Ja(r){const t=r>>10;return _i.uint32View[0]=_i.mantissaTable[_i.offsetTable[t]+(r&1023)]+_i.exponentTable[t],_i.floatView[0]}const oe=new v,Qa=new q;class lt{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=oc,this.updateRanges=[],this.gpuType=qe,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)Qa.fromBufferAttribute(this,e),Qa.applyMatrix3(t),this.setXY(e,Qa.x,Qa.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)oe.fromBufferAttribute(this,e),oe.applyMatrix3(t),this.setXYZ(e,oe.x,oe.y,oe.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)oe.fromBufferAttribute(this,e),oe.applyMatrix4(t),this.setXYZ(e,oe.x,oe.y,oe.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)oe.fromBufferAttribute(this,e),oe.applyNormalMatrix(t),this.setXYZ(e,oe.x,oe.y,oe.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)oe.fromBufferAttribute(this,e),oe.transformDirection(t),this.setXYZ(e,oe.x,oe.y,oe.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=Oe(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=at(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Oe(e,this.array)),e}setX(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Oe(e,this.array)),e}setY(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Oe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Oe(e,this.array)),e}setW(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array),n=at(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==oc&&(t.usage=this.usage),t}}class h5 extends lt{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class d5 extends lt{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class g5 extends lt{constructor(t,e,s){super(new Uint16Array(t),e,s),this.isFloat16BufferAttribute=!0}getX(t){let e=Ja(this.array[t*this.itemSize]);return this.normalized&&(e=Oe(e,this.array)),e}setX(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize]=ns(e),this}getY(t){let e=Ja(this.array[t*this.itemSize+1]);return this.normalized&&(e=Oe(e,this.array)),e}setY(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+1]=ns(e),this}getZ(t){let e=Ja(this.array[t*this.itemSize+2]);return this.normalized&&(e=Oe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+2]=ns(e),this}getW(t){let e=Ja(this.array[t*this.itemSize+3]);return this.normalized&&(e=Oe(e,this.array)),e}setW(t,e){return this.normalized&&(e=at(e,this.array)),this.array[t*this.itemSize+3]=ns(e),this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array)),this.array[t+0]=ns(e),this.array[t+1]=ns(s),this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array)),this.array[t+0]=ns(e),this.array[t+1]=ns(s),this.array[t+2]=ns(i),this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array),n=at(n,this.array)),this.array[t+0]=ns(e),this.array[t+1]=ns(s),this.array[t+2]=ns(i),this.array[t+3]=ns(n),this}}class ht extends lt{constructor(t,e,s){super(new Float32Array(t),e,s)}}let ag=0;const ds=new pt,Al=new Yt,To=new v,os=new Jn,_r=new Jn,xe=new v;class It extends gn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:ag++}),this.uuid=Ks(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Gd(t)?d5:h5)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const n=new ts().getNormalMatrix(t);s.applyNormalMatrix(n),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return ds.makeRotationFromQuaternion(t),this.applyMatrix4(ds),this}rotateX(t){return ds.makeRotationX(t),this.applyMatrix4(ds),this}rotateY(t){return ds.makeRotationY(t),this.applyMatrix4(ds),this}rotateZ(t){return ds.makeRotationZ(t),this.applyMatrix4(ds),this}translate(t,e,s){return ds.makeTranslation(t,e,s),this.applyMatrix4(ds),this}scale(t,e,s){return ds.makeScale(t,e,s),this.applyMatrix4(ds),this}lookAt(t){return Al.lookAt(t),Al.updateMatrix(),this.applyMatrix4(Al.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(To).negate(),this.translate(To.x,To.y,To.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const s=[];for(let i=0,n=t.length;i<n;i++){const o=t[i];s.push(o.x,o.y,o.z||0)}this.setAttribute("position",new ht(s,3))}else{const s=Math.min(t.length,e.count);for(let i=0;i<s;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Jn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new v(-1/0,-1/0,-1/0),new v(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const n=e[s];os.setFromBufferAttribute(n),this.morphTargetsRelative?(xe.addVectors(this.boundingBox.min,os.min),this.boundingBox.expandByPoint(xe),xe.addVectors(this.boundingBox.max,os.max),this.boundingBox.expandByPoint(xe)):(this.boundingBox.expandByPoint(os.min),this.boundingBox.expandByPoint(os.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Qn);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new v,1/0);return}if(t){const s=this.boundingSphere.center;if(os.setFromBufferAttribute(t),e)for(let n=0,o=e.length;n<o;n++){const a=e[n];_r.setFromBufferAttribute(a),this.morphTargetsRelative?(xe.addVectors(os.min,_r.min),os.expandByPoint(xe),xe.addVectors(os.max,_r.max),os.expandByPoint(xe)):(os.expandByPoint(_r.min),os.expandByPoint(_r.max))}os.getCenter(s);let i=0;for(let n=0,o=t.count;n<o;n++)xe.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(xe));if(e)for(let n=0,o=e.length;n<o;n++){const a=e[n],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)xe.fromBufferAttribute(a,l),c&&(To.fromBufferAttribute(t,l),xe.add(To)),i=Math.max(i,s.distanceToSquared(xe))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,i=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new lt(new Float32Array(4*s.count),4));const o=this.getAttribute("tangent"),a=[],c=[];for(let C=0;C<s.count;C++)a[C]=new v,c[C]=new v;const l=new v,u=new v,p=new v,h=new q,d=new q,g=new q,f=new v,y=new v;function x(C,P,D){l.fromBufferAttribute(s,C),u.fromBufferAttribute(s,P),p.fromBufferAttribute(s,D),h.fromBufferAttribute(n,C),d.fromBufferAttribute(n,P),g.fromBufferAttribute(n,D),u.sub(l),p.sub(l),d.sub(h),g.sub(h);const V=1/(d.x*g.y-g.x*d.y);isFinite(V)&&(f.copy(u).multiplyScalar(g.y).addScaledVector(p,-d.y).multiplyScalar(V),y.copy(p).multiplyScalar(d.x).addScaledVector(u,-g.x).multiplyScalar(V),a[C].add(f),a[P].add(f),a[D].add(f),c[C].add(y),c[P].add(y),c[D].add(y))}let b=this.groups;b.length===0&&(b=[{start:0,count:t.count}]);for(let C=0,P=b.length;C<P;++C){const D=b[C],V=D.start,$=D.count;for(let Y=V,tt=V+$;Y<tt;Y+=3)x(t.getX(Y+0),t.getX(Y+1),t.getX(Y+2))}const w=new v,_=new v,T=new v,M=new v;function A(C){T.fromBufferAttribute(i,C),M.copy(T);const P=a[C];w.copy(P),w.sub(T.multiplyScalar(T.dot(P))).normalize(),_.crossVectors(M,P);const V=_.dot(c[C])<0?-1:1;o.setXYZW(C,w.x,w.y,w.z,V)}for(let C=0,P=b.length;C<P;++C){const D=b[C],V=D.start,$=D.count;for(let Y=V,tt=V+$;Y<tt;Y+=3)A(t.getX(Y+0)),A(t.getX(Y+1)),A(t.getX(Y+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new lt(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let h=0,d=s.count;h<d;h++)s.setXYZ(h,0,0,0);const i=new v,n=new v,o=new v,a=new v,c=new v,l=new v,u=new v,p=new v;if(t)for(let h=0,d=t.count;h<d;h+=3){const g=t.getX(h+0),f=t.getX(h+1),y=t.getX(h+2);i.fromBufferAttribute(e,g),n.fromBufferAttribute(e,f),o.fromBufferAttribute(e,y),u.subVectors(o,n),p.subVectors(i,n),u.cross(p),a.fromBufferAttribute(s,g),c.fromBufferAttribute(s,f),l.fromBufferAttribute(s,y),a.add(u),c.add(u),l.add(u),s.setXYZ(g,a.x,a.y,a.z),s.setXYZ(f,c.x,c.y,c.z),s.setXYZ(y,l.x,l.y,l.z)}else for(let h=0,d=e.count;h<d;h+=3)i.fromBufferAttribute(e,h+0),n.fromBufferAttribute(e,h+1),o.fromBufferAttribute(e,h+2),u.subVectors(o,n),p.subVectors(i,n),u.cross(p),s.setXYZ(h+0,u.x,u.y,u.z),s.setXYZ(h+1,u.x,u.y,u.z),s.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)xe.fromBufferAttribute(t,e),xe.normalize(),t.setXYZ(e,xe.x,xe.y,xe.z)}toNonIndexed(){function t(a,c){const l=a.array,u=a.itemSize,p=a.normalized,h=new l.constructor(c.length*u);let d=0,g=0;for(let f=0,y=c.length;f<y;f++){a.isInterleavedBufferAttribute?d=c[f]*a.data.stride+a.offset:d=c[f]*u;for(let x=0;x<u;x++)h[g++]=l[d++]}return new lt(h,u,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new It,s=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=t(c,s);e.setAttribute(a,l)}const n=this.morphAttributes;for(const a in n){const c=[],l=n[a];for(let u=0,p=l.length;u<p;u++){const h=l[u],d=t(h,s);c.push(d)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,c=o.length;a<c;a++){const l=o[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const c in s){const l=s[c];t.data.attributes[c]=l.toJSON(t.data)}const i={};let n=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let p=0,h=l.length;p<h;p++){const d=l[p];u.push(d.toJSON(t.data))}u.length>0&&(i[c]=u,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(t.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const i=t.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(e))}const n=t.morphAttributes;for(const l in n){const u=[],p=n[l];for(let h=0,d=p.length;h<d;h++)u.push(p[h].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const o=t.groups;for(let l=0,u=o.length;l<u;l++){const p=o[l];this.addGroup(p.start,p.count,p.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const G2=new pt,Tn=new u5,t0=new Qn,W2=new v,e0=new v,s0=new v,i0=new v,Nl=new v,n0=new v,$2=new v,o0=new v;class O extends Yt{constructor(t=new It,e=new Ds){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=i.length;n<o;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,o=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(n&&a){n0.set(0,0,0);for(let c=0,l=n.length;c<l;c++){const u=a[c],p=n[c];u!==0&&(Nl.fromBufferAttribute(p,t),o?n0.addScaledVector(Nl,u):n0.addScaledVector(Nl.sub(e),u))}e.add(n0)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;i!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),t0.copy(s.boundingSphere),t0.applyMatrix4(n),Tn.copy(t.ray).recast(t.near),!(t0.containsPoint(Tn.origin)===!1&&(Tn.intersectSphere(t0,W2)===null||Tn.origin.distanceToSquared(W2)>(t.far-t.near)**2))&&(G2.copy(n).invert(),Tn.copy(t.ray).applyMatrix4(G2),!(s.boundingBox!==null&&Tn.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,Tn)))}_computeIntersections(t,e,s){let i;const n=this.geometry,o=this.material,a=n.index,c=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,p=n.attributes.normal,h=n.groups,d=n.drawRange;if(a!==null)if(Array.isArray(o))for(let g=0,f=h.length;g<f;g++){const y=h[g],x=o[y.materialIndex],b=Math.max(y.start,d.start),w=Math.min(a.count,Math.min(y.start+y.count,d.start+d.count));for(let _=b,T=w;_<T;_+=3){const M=a.getX(_),A=a.getX(_+1),C=a.getX(_+2);i=r0(this,x,t,s,l,u,p,M,A,C),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=y.materialIndex,e.push(i))}}else{const g=Math.max(0,d.start),f=Math.min(a.count,d.start+d.count);for(let y=g,x=f;y<x;y+=3){const b=a.getX(y),w=a.getX(y+1),_=a.getX(y+2);i=r0(this,o,t,s,l,u,p,b,w,_),i&&(i.faceIndex=Math.floor(y/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let g=0,f=h.length;g<f;g++){const y=h[g],x=o[y.materialIndex],b=Math.max(y.start,d.start),w=Math.min(c.count,Math.min(y.start+y.count,d.start+d.count));for(let _=b,T=w;_<T;_+=3){const M=_,A=_+1,C=_+2;i=r0(this,x,t,s,l,u,p,M,A,C),i&&(i.faceIndex=Math.floor(_/3),i.face.materialIndex=y.materialIndex,e.push(i))}}else{const g=Math.max(0,d.start),f=Math.min(c.count,d.start+d.count);for(let y=g,x=f;y<x;y+=3){const b=y,w=y+1,_=y+2;i=r0(this,o,t,s,l,u,p,b,w,_),i&&(i.faceIndex=Math.floor(y/3),e.push(i))}}}}function cg(r,t,e,s,i,n,o,a){let c;if(t.side===je?c=s.intersectTriangle(o,n,i,!0,a):c=s.intersectTriangle(i,n,o,t.side===$n,a),c===null)return null;o0.copy(a),o0.applyMatrix4(r.matrixWorld);const l=e.ray.origin.distanceTo(o0);return l<e.near||l>e.far?null:{distance:l,point:o0.clone(),object:r}}function r0(r,t,e,s,i,n,o,a,c,l){r.getVertexPosition(a,e0),r.getVertexPosition(c,s0),r.getVertexPosition(l,i0);const u=cg(r,t,e,s,e0,s0,i0,$2);if(u){const p=new v;Cs.getBarycoord($2,e0,s0,i0,p),i&&(u.uv=Cs.getInterpolatedAttribute(i,a,c,l,p,new q)),n&&(u.uv1=Cs.getInterpolatedAttribute(n,a,c,l,p,new q)),o&&(u.normal=Cs.getInterpolatedAttribute(o,a,c,l,p,new v),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new v,materialIndex:0};Cs.getNormal(e0,s0,i0,h.normal),u.face=h,u.barycoord=p}return u}class to extends It{constructor(t=1,e=1,s=1,i=1,n=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:i,heightSegments:n,depthSegments:o};const a=this;i=Math.floor(i),n=Math.floor(n),o=Math.floor(o);const c=[],l=[],u=[],p=[];let h=0,d=0;g("z","y","x",-1,-1,s,e,t,o,n,0),g("z","y","x",1,-1,s,e,-t,o,n,1),g("x","z","y",1,1,t,s,e,i,o,2),g("x","z","y",1,-1,t,s,-e,i,o,3),g("x","y","z",1,-1,t,e,s,i,n,4),g("x","y","z",-1,-1,t,e,-s,i,n,5),this.setIndex(c),this.setAttribute("position",new ht(l,3)),this.setAttribute("normal",new ht(u,3)),this.setAttribute("uv",new ht(p,2));function g(f,y,x,b,w,_,T,M,A,C,P){const D=_/A,V=T/C,$=_/2,Y=T/2,tt=M/2,ot=A+1,Nt=C+1;let de=0,ut=0;const gt=new v;for(let Bt=0;Bt<Nt;Bt++){const Ot=Bt*V-Y;for(let Lt=0;Lt<ot;Lt++){const $e=Lt*D-$;gt[f]=$e*b,gt[y]=Ot*w,gt[x]=tt,l.push(gt.x,gt.y,gt.z),gt[f]=0,gt[y]=0,gt[x]=M>0?1:-1,u.push(gt.x,gt.y,gt.z),p.push(Lt/A),p.push(1-Bt/C),de+=1}}for(let Bt=0;Bt<C;Bt++)for(let Ot=0;Ot<A;Ot++){const Lt=h+Ot+ot*Bt,$e=h+Ot+ot*(Bt+1),Ui=h+(Ot+1)+ot*(Bt+1),li=h+(Ot+1)+ot*Bt;c.push(Lt,$e,li),c.push($e,Ui,li),ut+=6}a.addGroup(d,ut,P),d+=ut,h+=de}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new to(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function f5(r){const t={};for(const e in r){t[e]={};for(const s in r[e]){const i=r[e][s];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][s]=null):t[e][s]=i.clone():Array.isArray(i)?t[e][s]=i.slice():t[e][s]=i}}return t}function lg(r){const t=[];for(let e=0;e<r.length;e++)t.push(r[e].clone());return t}var ug=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,pg=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class hg extends Ze{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=ug,this.fragmentShader=pg,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=f5(t.uniforms),this.uniformsGroups=lg(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?e.uniforms[i]={type:"t",value:o.toJSON(t).uuid}:o&&o.isColor?e.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?e.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?e.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?e.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?e.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?e.uniforms[i]={type:"m4",value:o.toArray()}:e.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const s={};for(const i in this.extensions)this.extensions[i]===!0&&(s[i]=!0);return Object.keys(s).length>0&&(e.extensions=s),e}}class m5 extends Yt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pt,this.projectionMatrix=new pt,this.projectionMatrixInverse=new pt,this.coordinateSystem=Rs}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Wi=new v,H2=new q,q2=new q;class qs extends m5{constructor(t=50,e=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=ca*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Yr*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return ca*2*Math.atan(Math.tan(Yr*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,s){Wi.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(Wi.x,Wi.y).multiplyScalar(-t/Wi.z),Wi.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(Wi.x,Wi.y).multiplyScalar(-t/Wi.z)}getViewSize(t,e){return this.getViewBounds(t,H2,q2),e.subVectors(q2,H2)}setViewOffset(t,e,s,i,n,o){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Yr*.5*this.fov)/this.zoom,s=2*e,i=this.aspect*s,n=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,l=o.fullHeight;n+=o.offsetX*i/c,e-=o.offsetY*s/l,i*=o.width/c,s*=o.height/l}const a=this.filmOffset;a!==0&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,e,e-s,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const So=-90,vo=1;class y5 extends Yt{constructor(t,e,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new qs(So,vo,t,e);i.layers=this.layers,this.add(i);const n=new qs(So,vo,t,e);n.layers=this.layers,this.add(n);const o=new qs(So,vo,t,e);o.layers=this.layers,this.add(o);const a=new qs(So,vo,t,e);a.layers=this.layers,this.add(a);const c=new qs(So,vo,t,e);c.layers=this.layers,this.add(c);const l=new qs(So,vo,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[s,i,n,o,a,c]=e;for(const l of e)this.remove(l);if(t===Rs)s.up.set(0,1,0),s.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===Fi)s.up.set(0,-1,0),s.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,o,a,c,l,u]=this.children,p=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),g=t.xr.enabled;t.xr.enabled=!1;const f=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0,i),t.render(e,n),t.setRenderTarget(s,1,i),t.render(e,o),t.setRenderTarget(s,2,i),t.render(e,a),t.setRenderTarget(s,3,i),t.render(e,c),t.setRenderTarget(s,4,i),t.render(e,l),s.texture.generateMipmaps=f,t.setRenderTarget(s,5,i),t.render(e,u),t.setRenderTarget(p,h,d),t.xr.enabled=g,s.texture.needsPMREMUpdate=!0}}class Gu extends Ge{constructor(t,e,s,i,n,o,a,c,l,u){t=t!==void 0?t:[],e=e!==void 0?e:qn,super(t,e,s,i,n,o,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class dg extends jd{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const s={width:t,height:t,depth:1},i=[s,s,s,s,s,s];this.texture=new Gu(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:ps}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new to(5,5,5),n=new hg({name:"CubemapFromEquirect",uniforms:f5(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:je,blending:Hn});n.uniforms.tEquirect.value=e;const o=new O(i,n),a=e.minFilter;return e.minFilter===vi&&(e.minFilter=ps),new y5(1,10,this).update(t,o),e.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(t,e,s,i){const n=t.getRenderTarget();for(let o=0;o<6;o++)t.setRenderTarget(this,o),t.clear(e,s,i);t.setRenderTarget(n)}}class Wu{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new W(t),this.density=e}clone(){return new Wu(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class $u{constructor(t,e=1,s=1e3){this.isFog=!0,this.name="",this.color=new W(t),this.near=e,this.far=s}clone(){return new $u(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Hu extends Yt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new hs,this.environmentIntensity=1,this.environmentRotation=new hs,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class x5{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=oc,this.updateRanges=[],this.version=0,this.uuid=Ks()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ks()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Ks()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ve=new v;class qu{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)Ve.fromBufferAttribute(this,e),Ve.applyMatrix4(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Ve.fromBufferAttribute(this,e),Ve.applyNormalMatrix(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Ve.fromBufferAttribute(this,e),Ve.transformDirection(t),this.setXYZ(e,Ve.x,Ve.y,Ve.z);return this}getComponent(t,e){let s=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(s=Oe(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=at(s,this.array)),this.data.array[t*this.data.stride+this.offset+e]=s,this}setX(t,e){return this.normalized&&(e=at(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=at(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=at(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=at(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=Oe(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=Oe(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=Oe(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=Oe(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=at(e,this.array),s=at(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=at(e,this.array),s=at(s,this.array),i=at(i,this.array),n=at(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return new lt(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new qu(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class gg extends Ze{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new W(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class Yu extends Ge{constructor(t=null,e=1,s=1,i,n,o,a,c,l=we,u=we,p,h){super(null,o,a,c,l,u,i,n,p,h),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class la extends lt{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const Mo=new pt,Y2=new pt,a0=[],X2=new Jn,fg=new pt,Tr=new O,Sr=new Qn;class mg extends O{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new la(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<s;i++)this.setMatrixAt(i,fg)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new Jn),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Mo),X2.copy(t.boundingBox).applyMatrix4(Mo),this.boundingBox.union(X2)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Qn),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,Mo),Sr.copy(t.boundingSphere).applyMatrix4(Mo),this.boundingSphere.union(Sr)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=s.length+1,o=t*n+1;for(let a=0;a<s.length;a++)s[a]=i[o+a]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(Tr.geometry=this.geometry,Tr.material=this.material,Tr.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Sr.copy(this.boundingSphere),Sr.applyMatrix4(s),t.ray.intersectsSphere(Sr)!==!1))for(let n=0;n<i;n++){this.getMatrixAt(n,Mo),Y2.multiplyMatrices(s,Mo),Tr.matrixWorld=Y2,Tr.raycast(t,a0);for(let o=0,a=a0.length;o<a;o++){const c=a0[o];c.instanceId=n,c.object=this,e.push(c)}a0.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new la(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;this.morphTexture===null&&(this.morphTexture=new Yu(new Float32Array(i*this.count),i,this.count,Ec,qe));const n=this.morphTexture.source.data.data;let o=0;for(let l=0;l<s.length;l++)o+=s[l];const a=this.geometry.morphTargetsRelative?1:1-o,c=i*t;n[c]=a,n.set(s,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const Cl=new v,yg=new v,xg=new ts;class qi{constructor(t=new v(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=Cl.subVectors(s,e).cross(yg.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(Cl),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||xg.getNormalMatrix(t),i=this.coplanarPoint(Cl).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Sn=new Qn,c0=new v;class Xu{constructor(t=new qi,e=new qi,s=new qi,i=new qi,n=new qi,o=new qi){this.planes=[t,e,s,i,n,o]}set(t,e,s,i,n,o){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(s),a[3].copy(i),a[4].copy(n),a[5].copy(o),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=Rs){const s=this.planes,i=t.elements,n=i[0],o=i[1],a=i[2],c=i[3],l=i[4],u=i[5],p=i[6],h=i[7],d=i[8],g=i[9],f=i[10],y=i[11],x=i[12],b=i[13],w=i[14],_=i[15];if(s[0].setComponents(c-n,h-l,y-d,_-x).normalize(),s[1].setComponents(c+n,h+l,y+d,_+x).normalize(),s[2].setComponents(c+o,h+u,y+g,_+b).normalize(),s[3].setComponents(c-o,h-u,y-g,_-b).normalize(),s[4].setComponents(c-a,h-p,y-f,_-w).normalize(),e===Rs)s[5].setComponents(c+a,h+p,y+f,_+w).normalize();else if(e===Fi)s[5].setComponents(a,p,f,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),Sn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),Sn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(Sn)}intersectsSprite(t){return Sn.center.set(0,0,0),Sn.radius=.7071067811865476,Sn.applyMatrix4(t.matrixWorld),this.intersectsSphere(Sn)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(s)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(c0.x=i.normal.x>0?t.max.x:t.min.x,c0.y=i.normal.y>0?t.max.y:t.min.y,c0.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(c0)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class b5 extends Ze{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new W(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class ln extends Ze{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new W(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const j2=new pt,X1=new u5,l0=new Qn,u0=new v;class un extends Yt{constructor(t=new It,e=new ln){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Points.threshold,o=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),l0.copy(s.boundingSphere),l0.applyMatrix4(i),l0.radius+=n,t.ray.intersectsSphere(l0)===!1)return;j2.copy(i).invert(),X1.copy(t.ray).applyMatrix4(j2);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=s.index,p=s.attributes.position;if(l!==null){const h=Math.max(0,o.start),d=Math.min(l.count,o.start+o.count);for(let g=h,f=d;g<f;g++){const y=l.getX(g);u0.fromBufferAttribute(p,y),Z2(u0,y,c,i,t,e,this)}}else{const h=Math.max(0,o.start),d=Math.min(p.count,o.start+o.count);for(let g=h,f=d;g<f;g++)u0.fromBufferAttribute(p,g),Z2(u0,g,c,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,o=i.length;n<o;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}function Z2(r,t,e,s,i,n,o){const a=X1.distanceSqToPoint(r);if(a<e){const c=new v;X1.closestPointToPoint(r,c),c.applyMatrix4(s);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;n.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,faceIndex:null,barycoord:null,object:o})}}class K extends Yt{constructor(){super(),this.isGroup=!0,this.type="Group"}}class w5 extends Ge{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=we,this.minFilter=we,this.generateMipmaps=!1,this.needsUpdate=!0}}class eo extends Ge{constructor(t,e,s,i,n,o,a,c,l,u=zn){if(u!==zn&&u!==or)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&u===zn&&(s=Ae),s===void 0&&u===or&&(s=Aa),super(null,i,n,o,a,c,u,s,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:we,this.minFilter=c!==void 0?c:we,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class Us{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,i=this.getPoint(0),n=0;e.push(0);for(let o=1;o<=t;o++)s=this.getPoint(o/t),n+=s.distanceTo(i),e.push(n),i=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const s=this.getLengths();let i=0;const n=s.length;let o;e?o=e:o=t*s[n-1];let a=0,c=n-1,l;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),l=s[i]-o,l<0)a=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,s[i]===o)return i/(n-1);const u=s[i],h=s[i+1]-u,d=(o-u)/h;return(i+d)/(n-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const o=this.getPoint(i),a=this.getPoint(n),c=e||(o.isVector2?new q:new v);return c.copy(a).sub(o).normalize(),c}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e){const s=new v,i=[],n=[],o=[],a=new v,c=new pt;for(let d=0;d<=t;d++){const g=d/t;i[d]=this.getTangentAt(g,new v)}n[0]=new v,o[0]=new v;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),p=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=l&&(l=u,s.set(1,0,0)),p<=l&&(l=p,s.set(0,1,0)),h<=l&&s.set(0,0,1),a.crossVectors(i[0],s).normalize(),n[0].crossVectors(i[0],a),o[0].crossVectors(i[0],n[0]);for(let d=1;d<=t;d++){if(n[d]=n[d-1].clone(),o[d]=o[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(ct(i[d-1].dot(i[d]),-1,1));n[d].applyMatrix4(c.makeRotationAxis(a,g))}o[d].crossVectors(i[d],n[d])}if(e===!0){let d=Math.acos(ct(n[0].dot(n[t]),-1,1));d/=t,i[0].dot(a.crossVectors(n[0],n[t]))>0&&(d=-d);for(let g=1;g<=t;g++)n[g].applyMatrix4(c.makeRotationAxis(i[g],d*g)),o[g].crossVectors(i[g],n[g])}return{tangents:i,normals:n,binormals:o}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class ju extends Us{constructor(t=0,e=0,s=1,i=1,n=0,o=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=o,this.aClockwise=a,this.aRotation=c}getPoint(t,e=new q){const s=e,i=Math.PI*2;let n=this.aEndAngle-this.aStartAngle;const o=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(o?n=0:n=i),this.aClockwise===!0&&!o&&(n===i?n=-i:n=n-i);const a=this.aStartAngle+t*n;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),p=Math.sin(this.aRotation),h=c-this.aX,d=l-this.aY;c=h*u-d*p+this.aX,l=h*p+d*u+this.aY}return s.set(c,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class bg extends ju{constructor(t,e,s,i,n,o){super(t,e,s,s,i,n,o),this.isArcCurve=!0,this.type="ArcCurve"}}function Zu(){let r=0,t=0,e=0,s=0;function i(n,o,a,c){r=n,t=a,e=-3*n+3*o-2*a-c,s=2*n-2*o+a+c}return{initCatmullRom:function(n,o,a,c,l){i(o,a,l*(a-n),l*(c-o))},initNonuniformCatmullRom:function(n,o,a,c,l,u,p){let h=(o-n)/l-(a-n)/(l+u)+(a-o)/u,d=(a-o)/u-(c-o)/(u+p)+(c-a)/p;h*=u,d*=u,i(o,a,h,d)},calc:function(n){const o=n*n,a=o*n;return r+t*n+e*o+s*a}}}const p0=new v,Rl=new Zu,Fl=new Zu,El=new Zu;class wg extends Us{constructor(t=[],e=!1,s="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=i}getPoint(t,e=new v){const s=e,i=this.points,n=i.length,o=(n-(this.closed?0:1))*t;let a=Math.floor(o),c=o-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:c===0&&a===n-1&&(a=n-2,c=1);let l,u;this.closed||a>0?l=i[(a-1)%n]:(p0.subVectors(i[0],i[1]).add(i[0]),l=p0);const p=i[a%n],h=i[(a+1)%n];if(this.closed||a+2<n?u=i[(a+2)%n]:(p0.subVectors(i[n-1],i[n-2]).add(i[n-1]),u=p0),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let g=Math.pow(l.distanceToSquared(p),d),f=Math.pow(p.distanceToSquared(h),d),y=Math.pow(h.distanceToSquared(u),d);f<1e-4&&(f=1),g<1e-4&&(g=f),y<1e-4&&(y=f),Rl.initNonuniformCatmullRom(l.x,p.x,h.x,u.x,g,f,y),Fl.initNonuniformCatmullRom(l.y,p.y,h.y,u.y,g,f,y),El.initNonuniformCatmullRom(l.z,p.z,h.z,u.z,g,f,y)}else this.curveType==="catmullrom"&&(Rl.initCatmullRom(l.x,p.x,h.x,u.x,this.tension),Fl.initCatmullRom(l.y,p.y,h.y,u.y,this.tension),El.initCatmullRom(l.z,p.z,h.z,u.z,this.tension));return s.set(Rl.calc(c),Fl.calc(c),El.calc(c)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new v().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function K2(r,t,e,s,i){const n=(s-t)*.5,o=(i-e)*.5,a=r*r,c=r*a;return(2*e-2*s+n+o)*c+(-3*e+3*s-2*n-o)*a+n*r+e}function _g(r,t){const e=1-r;return e*e*t}function Tg(r,t){return 2*(1-r)*r*t}function Sg(r,t){return r*r*t}function jr(r,t,e,s){return _g(r,t)+Tg(r,e)+Sg(r,s)}function vg(r,t){const e=1-r;return e*e*e*t}function Mg(r,t){const e=1-r;return 3*e*e*r*t}function Ag(r,t){return 3*(1-r)*r*r*t}function Ng(r,t){return r*r*r*t}function Zr(r,t,e,s,i){return vg(r,t)+Mg(r,e)+Ag(r,s)+Ng(r,i)}class _5 extends Us{constructor(t=new q,e=new q,s=new q,i=new q){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new q){const s=e,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return s.set(Zr(t,i.x,n.x,o.x,a.x),Zr(t,i.y,n.y,o.y,a.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Cg extends Us{constructor(t=new v,e=new v,s=new v,i=new v){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new v){const s=e,i=this.v0,n=this.v1,o=this.v2,a=this.v3;return s.set(Zr(t,i.x,n.x,o.x,a.x),Zr(t,i.y,n.y,o.y,a.y),Zr(t,i.z,n.z,o.z,a.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class T5 extends Us{constructor(t=new q,e=new q){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new q){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new q){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Rg extends Us{constructor(t=new v,e=new v){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new v){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new v){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class S5 extends Us{constructor(t=new q,e=new q,s=new q){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new q){const s=e,i=this.v0,n=this.v1,o=this.v2;return s.set(jr(t,i.x,n.x,o.x),jr(t,i.y,n.y,o.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class v5 extends Us{constructor(t=new v,e=new v,s=new v){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new v){const s=e,i=this.v0,n=this.v1,o=this.v2;return s.set(jr(t,i.x,n.x,o.x),jr(t,i.y,n.y,o.y),jr(t,i.z,n.z,o.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class M5 extends Us{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new q){const s=e,i=this.points,n=(i.length-1)*t,o=Math.floor(n),a=n-o,c=i[o===0?o:o-1],l=i[o],u=i[o>i.length-2?i.length-1:o+1],p=i[o>i.length-3?i.length-1:o+2];return s.set(K2(a,c.x,l.x,u.x,p.x),K2(a,c.y,l.y,u.y,p.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new q().fromArray(i))}return this}}var j1=Object.freeze({__proto__:null,ArcCurve:bg,CatmullRomCurve3:wg,CubicBezierCurve:_5,CubicBezierCurve3:Cg,EllipseCurve:ju,LineCurve:T5,LineCurve3:Rg,QuadraticBezierCurve:S5,QuadraticBezierCurve3:v5,SplineCurve:M5});class Fg extends Us{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const s=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new j1[s](e,t))}return this}getPoint(t,e){const s=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=s){const o=i[n]-s,a=this.curves[n],c=a.getLength(),l=c===0?0:1-o/c;return a.getPointAt(l,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,i=this.curves.length;s<i;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let i=0,n=this.curves;i<n.length;i++){const o=n[i],a=o.isEllipseCurve?t*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?t*o.points.length:t,c=o.getPoints(a);for(let l=0;l<c.length;l++){const u=c[l];s&&s.equals(u)||(e.push(u),s=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(new j1[i.type]().fromJSON(i))}return this}}class Z1 extends Fg{constructor(t){super(),this.type="Path",this.currentPoint=new q,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new T5(this.currentPoint.clone(),new q(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,i){const n=new S5(this.currentPoint.clone(),new q(t,e),new q(s,i));return this.curves.push(n),this.currentPoint.set(s,i),this}bezierCurveTo(t,e,s,i,n,o){const a=new _5(this.currentPoint.clone(),new q(t,e),new q(s,i),new q(n,o));return this.curves.push(a),this.currentPoint.set(n,o),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new M5(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,i,n,o){const a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(t+a,e+c,s,i,n,o),this}absarc(t,e,s,i,n,o){return this.absellipse(t,e,s,s,i,n,o),this}ellipse(t,e,s,i,n,o,a,c){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+l,e+u,s,i,n,o,a,c),this}absellipse(t,e,s,i,n,o,a,c){const l=new ju(t,e,s,i,n,o,a,c);if(this.curves.length>0){const p=l.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Bc extends It{constructor(t=[new q(0,-.5),new q(.5,0),new q(0,.5)],e=12,s=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:s,phiLength:i},e=Math.floor(e),i=ct(i,0,Math.PI*2);const n=[],o=[],a=[],c=[],l=[],u=1/e,p=new v,h=new q,d=new v,g=new v,f=new v;let y=0,x=0;for(let b=0;b<=t.length-1;b++)switch(b){case 0:y=t[b+1].x-t[b].x,x=t[b+1].y-t[b].y,d.x=x*1,d.y=-y,d.z=x*0,f.copy(d),d.normalize(),c.push(d.x,d.y,d.z);break;case t.length-1:c.push(f.x,f.y,f.z);break;default:y=t[b+1].x-t[b].x,x=t[b+1].y-t[b].y,d.x=x*1,d.y=-y,d.z=x*0,g.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),c.push(d.x,d.y,d.z),f.copy(g)}for(let b=0;b<=e;b++){const w=s+b*u*i,_=Math.sin(w),T=Math.cos(w);for(let M=0;M<=t.length-1;M++){p.x=t[M].x*_,p.y=t[M].y,p.z=t[M].x*T,o.push(p.x,p.y,p.z),h.x=b/e,h.y=M/(t.length-1),a.push(h.x,h.y);const A=c[3*M+0]*_,C=c[3*M+1],P=c[3*M+0]*T;l.push(A,C,P)}}for(let b=0;b<e;b++)for(let w=0;w<t.length-1;w++){const _=w+b*t.length,T=_,M=_+t.length,A=_+t.length+1,C=_+1;n.push(T,M,C),n.push(A,C,M)}this.setIndex(n),this.setAttribute("position",new ht(o,3)),this.setAttribute("uv",new ht(a,2)),this.setAttribute("normal",new ht(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Bc(t.points,t.segments,t.phiStart,t.phiLength)}}class Dc extends Bc{constructor(t=1,e=1,s=4,i=8){const n=new Z1;n.absarc(0,-e/2,t,Math.PI*1.5,0),n.absarc(0,e/2,t,0,Math.PI*.5),super(n.getPoints(s),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:s,radialSegments:i}}static fromJSON(t){return new Dc(t.radius,t.length,t.capSegments,t.radialSegments)}}class Ku extends It{constructor(t=1,e=32,s=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:s,thetaLength:i},e=Math.max(3,e);const n=[],o=[],a=[],c=[],l=new v,u=new q;o.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let p=0,h=3;p<=e;p++,h+=3){const d=s+p/e*i;l.x=t*Math.cos(d),l.y=t*Math.sin(d),o.push(l.x,l.y,l.z),a.push(0,0,1),u.x=(o[h]/t+1)/2,u.y=(o[h+1]/t+1)/2,c.push(u.x,u.y)}for(let p=1;p<=e;p++)n.push(p,p+1,0);this.setIndex(n),this.setAttribute("position",new ht(o,3)),this.setAttribute("normal",new ht(a,3)),this.setAttribute("uv",new ht(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ku(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Le extends It{constructor(t=1,e=1,s=1,i=32,n=1,o=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:s,radialSegments:i,heightSegments:n,openEnded:o,thetaStart:a,thetaLength:c};const l=this;i=Math.floor(i),n=Math.floor(n);const u=[],p=[],h=[],d=[];let g=0;const f=[],y=s/2;let x=0;b(),o===!1&&(t>0&&w(!0),e>0&&w(!1)),this.setIndex(u),this.setAttribute("position",new ht(p,3)),this.setAttribute("normal",new ht(h,3)),this.setAttribute("uv",new ht(d,2));function b(){const _=new v,T=new v;let M=0;const A=(e-t)/s;for(let C=0;C<=n;C++){const P=[],D=C/n,V=D*(e-t)+t;for(let $=0;$<=i;$++){const Y=$/i,tt=Y*c+a,ot=Math.sin(tt),Nt=Math.cos(tt);T.x=V*ot,T.y=-D*s+y,T.z=V*Nt,p.push(T.x,T.y,T.z),_.set(ot,A,Nt).normalize(),h.push(_.x,_.y,_.z),d.push(Y,1-D),P.push(g++)}f.push(P)}for(let C=0;C<i;C++)for(let P=0;P<n;P++){const D=f[P][C],V=f[P+1][C],$=f[P+1][C+1],Y=f[P][C+1];(t>0||P!==0)&&(u.push(D,V,Y),M+=3),(e>0||P!==n-1)&&(u.push(V,$,Y),M+=3)}l.addGroup(x,M,0),x+=M}function w(_){const T=g,M=new q,A=new v;let C=0;const P=_===!0?t:e,D=_===!0?1:-1;for(let $=1;$<=i;$++)p.push(0,y*D,0),h.push(0,D,0),d.push(.5,.5),g++;const V=g;for(let $=0;$<=i;$++){const tt=$/i*c+a,ot=Math.cos(tt),Nt=Math.sin(tt);A.x=P*Nt,A.y=y*D,A.z=P*ot,p.push(A.x,A.y,A.z),h.push(0,D,0),M.x=ot*.5+.5,M.y=Nt*.5*D+.5,d.push(M.x,M.y),g++}for(let $=0;$<i;$++){const Y=T+$,tt=V+$;_===!0?u.push(tt,tt+1,Y):u.push(tt+1,tt,Y),C+=3}l.addGroup(x,C,_===!0?1:2),x+=C}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Le(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class mn extends Le{constructor(t=1,e=1,s=32,i=1,n=!1,o=0,a=Math.PI*2){super(0,t,e,s,i,n,o,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:s,heightSegments:i,openEnded:n,thetaStart:o,thetaLength:a}}static fromJSON(t){return new mn(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Ju extends It{constructor(t=[],e=[],s=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:s,detail:i};const n=[],o=[];a(i),l(s),u(),this.setAttribute("position",new ht(n,3)),this.setAttribute("normal",new ht(n.slice(),3)),this.setAttribute("uv",new ht(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(b){const w=new v,_=new v,T=new v;for(let M=0;M<e.length;M+=3)d(e[M+0],w),d(e[M+1],_),d(e[M+2],T),c(w,_,T,b)}function c(b,w,_,T){const M=T+1,A=[];for(let C=0;C<=M;C++){A[C]=[];const P=b.clone().lerp(_,C/M),D=w.clone().lerp(_,C/M),V=M-C;for(let $=0;$<=V;$++)$===0&&C===M?A[C][$]=P:A[C][$]=P.clone().lerp(D,$/V)}for(let C=0;C<M;C++)for(let P=0;P<2*(M-C)-1;P++){const D=Math.floor(P/2);P%2===0?(h(A[C][D+1]),h(A[C+1][D]),h(A[C][D])):(h(A[C][D+1]),h(A[C+1][D+1]),h(A[C+1][D]))}}function l(b){const w=new v;for(let _=0;_<n.length;_+=3)w.x=n[_+0],w.y=n[_+1],w.z=n[_+2],w.normalize().multiplyScalar(b),n[_+0]=w.x,n[_+1]=w.y,n[_+2]=w.z}function u(){const b=new v;for(let w=0;w<n.length;w+=3){b.x=n[w+0],b.y=n[w+1],b.z=n[w+2];const _=y(b)/2/Math.PI+.5,T=x(b)/Math.PI+.5;o.push(_,1-T)}g(),p()}function p(){for(let b=0;b<o.length;b+=6){const w=o[b+0],_=o[b+2],T=o[b+4],M=Math.max(w,_,T),A=Math.min(w,_,T);M>.9&&A<.1&&(w<.2&&(o[b+0]+=1),_<.2&&(o[b+2]+=1),T<.2&&(o[b+4]+=1))}}function h(b){n.push(b.x,b.y,b.z)}function d(b,w){const _=b*3;w.x=t[_+0],w.y=t[_+1],w.z=t[_+2]}function g(){const b=new v,w=new v,_=new v,T=new v,M=new q,A=new q,C=new q;for(let P=0,D=0;P<n.length;P+=9,D+=6){b.set(n[P+0],n[P+1],n[P+2]),w.set(n[P+3],n[P+4],n[P+5]),_.set(n[P+6],n[P+7],n[P+8]),M.set(o[D+0],o[D+1]),A.set(o[D+2],o[D+3]),C.set(o[D+4],o[D+5]),T.copy(b).add(w).add(_).divideScalar(3);const V=y(T);f(M,D+0,b,V),f(A,D+2,w,V),f(C,D+4,_,V)}}function f(b,w,_,T){T<0&&b.x===1&&(o[w]=b.x-1),_.x===0&&_.z===0&&(o[w]=T/2/Math.PI+.5)}function y(b){return Math.atan2(b.z,-b.x)}function x(b){return Math.atan2(-b.y,Math.sqrt(b.x*b.x+b.z*b.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Ju(t.vertices,t.indices,t.radius,t.details)}}class A5 extends Z1{constructor(t){super(t),this.uuid=Ks(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,i=this.holes.length;s<i;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(new Z1().fromJSON(i))}return this}}const Eg={triangulate:function(r,t,e=2){const s=t&&t.length,i=s?t[0]*e:r.length;let n=N5(r,0,i,e,!0);const o=[];if(!n||n.next===n.prev)return o;let a,c,l,u,p,h,d;if(s&&(n=Lg(r,t,n,e)),r.length>80*e){a=l=r[0],c=u=r[1];for(let g=e;g<i;g+=e)p=r[g],h=r[g+1],p<a&&(a=p),h<c&&(c=h),p>l&&(l=p),h>u&&(u=h);d=Math.max(l-a,u-c),d=d!==0?32767/d:0}return ua(n,o,e,a,c,d,0),o}};function N5(r,t,e,s,i){let n,o;if(i===Yg(r,t,e,s)>0)for(n=t;n<e;n+=s)o=J2(n,r[n],r[n+1],o);else for(n=e-s;n>=t;n-=s)o=J2(n,r[n],r[n+1],o);return o&&Pc(o,o.next)&&(ha(o),o=o.next),o}function Xn(r,t){if(!r)return r;t||(t=r);let e=r,s;do if(s=!1,!e.steiner&&(Pc(e,e.next)||qt(e.prev,e,e.next)===0)){if(ha(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function ua(r,t,e,s,i,n,o){if(!r)return;!o&&n&&Og(r,s,i,n);let a=r,c,l;for(;r.prev!==r.next;){if(c=r.prev,l=r.next,n?Dg(r,s,i,n):Bg(r)){t.push(c.i/e|0),t.push(r.i/e|0),t.push(l.i/e|0),ha(r),r=l.next,a=l.next;continue}if(r=l,r===a){o?o===1?(r=Pg(Xn(r),t,e),ua(r,t,e,s,i,n,2)):o===2&&Ig(r,t,e,s,i,n):ua(Xn(r),t,e,s,i,n,1);break}}}function Bg(r){const t=r.prev,e=r,s=r.next;if(qt(t,e,s)>=0)return!1;const i=t.x,n=e.x,o=s.x,a=t.y,c=e.y,l=s.y,u=i<n?i<o?i:o:n<o?n:o,p=a<c?a<l?a:l:c<l?c:l,h=i>n?i>o?i:o:n>o?n:o,d=a>c?a>l?a:l:c>l?c:l;let g=s.next;for(;g!==t;){if(g.x>=u&&g.x<=h&&g.y>=p&&g.y<=d&&Ho(i,a,n,c,o,l,g.x,g.y)&&qt(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Dg(r,t,e,s){const i=r.prev,n=r,o=r.next;if(qt(i,n,o)>=0)return!1;const a=i.x,c=n.x,l=o.x,u=i.y,p=n.y,h=o.y,d=a<c?a<l?a:l:c<l?c:l,g=u<p?u<h?u:h:p<h?p:h,f=a>c?a>l?a:l:c>l?c:l,y=u>p?u>h?u:h:p>h?p:h,x=K1(d,g,t,e,s),b=K1(f,y,t,e,s);let w=r.prevZ,_=r.nextZ;for(;w&&w.z>=x&&_&&_.z<=b;){if(w.x>=d&&w.x<=f&&w.y>=g&&w.y<=y&&w!==i&&w!==o&&Ho(a,u,c,p,l,h,w.x,w.y)&&qt(w.prev,w,w.next)>=0||(w=w.prevZ,_.x>=d&&_.x<=f&&_.y>=g&&_.y<=y&&_!==i&&_!==o&&Ho(a,u,c,p,l,h,_.x,_.y)&&qt(_.prev,_,_.next)>=0))return!1;_=_.nextZ}for(;w&&w.z>=x;){if(w.x>=d&&w.x<=f&&w.y>=g&&w.y<=y&&w!==i&&w!==o&&Ho(a,u,c,p,l,h,w.x,w.y)&&qt(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;_&&_.z<=b;){if(_.x>=d&&_.x<=f&&_.y>=g&&_.y<=y&&_!==i&&_!==o&&Ho(a,u,c,p,l,h,_.x,_.y)&&qt(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Pg(r,t,e){let s=r;do{const i=s.prev,n=s.next.next;!Pc(i,n)&&C5(i,s,s.next,n)&&pa(i,n)&&pa(n,i)&&(t.push(i.i/e|0),t.push(s.i/e|0),t.push(n.i/e|0),ha(s),ha(s.next),s=r=n),s=s.next}while(s!==r);return Xn(s)}function Ig(r,t,e,s,i,n){let o=r;do{let a=o.next.next;for(;a!==o.prev;){if(o.i!==a.i&&$g(o,a)){let c=R5(o,a);o=Xn(o,o.next),c=Xn(c,c.next),ua(o,t,e,s,i,n,0),ua(c,t,e,s,i,n,0);return}a=a.next}o=o.next}while(o!==r)}function Lg(r,t,e,s){const i=[];let n,o,a,c,l;for(n=0,o=t.length;n<o;n++)a=t[n]*s,c=n<o-1?t[n+1]*s:r.length,l=N5(r,a,c,s,!1),l===l.next&&(l.steiner=!0),i.push(Wg(l));for(i.sort(Ug),n=0;n<i.length;n++)e=zg(i[n],e);return e}function Ug(r,t){return r.x-t.x}function zg(r,t){const e=Vg(r,t);if(!e)return t;const s=R5(e,r);return Xn(s,s.next),Xn(e,e.next)}function Vg(r,t){let e=t,s=-1/0,i;const n=r.x,o=r.y;do{if(o<=e.y&&o>=e.next.y&&e.next.y!==e.y){const h=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=n&&h>s&&(s=h,i=e.x<e.next.x?e:e.next,h===n))return i}e=e.next}while(e!==t);if(!i)return null;const a=i,c=i.x,l=i.y;let u=1/0,p;e=i;do n>=e.x&&e.x>=c&&n!==e.x&&Ho(o<l?n:s,o,c,l,o<l?s:n,o,e.x,e.y)&&(p=Math.abs(o-e.y)/(n-e.x),pa(e,r)&&(p<u||p===u&&(e.x>i.x||e.x===i.x&&kg(i,e)))&&(i=e,u=p)),e=e.next;while(e!==a);return i}function kg(r,t){return qt(r.prev,r,t.prev)<0&&qt(t.next,r,r.next)<0}function Og(r,t,e,s){let i=r;do i.z===0&&(i.z=K1(i.x,i.y,t,e,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,Gg(i)}function Gg(r){let t,e,s,i,n,o,a,c,l=1;do{for(e=r,r=null,n=null,o=0;e;){for(o++,s=e,a=0,t=0;t<l&&(a++,s=s.nextZ,!!s);t++);for(c=l;a>0||c>0&&s;)a!==0&&(c===0||!s||e.z<=s.z)?(i=e,e=e.nextZ,a--):(i=s,s=s.nextZ,c--),n?n.nextZ=i:r=i,i.prevZ=n,n=i;e=s}n.nextZ=null,l*=2}while(o>1);return r}function K1(r,t,e,s,i){return r=(r-e)*i|0,t=(t-s)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,r|t<<1}function Wg(r){let t=r,e=r;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==r);return e}function Ho(r,t,e,s,i,n,o,a){return(i-o)*(t-a)>=(r-o)*(n-a)&&(r-o)*(s-a)>=(e-o)*(t-a)&&(e-o)*(n-a)>=(i-o)*(s-a)}function $g(r,t){return r.next.i!==t.i&&r.prev.i!==t.i&&!Hg(r,t)&&(pa(r,t)&&pa(t,r)&&qg(r,t)&&(qt(r.prev,r,t.prev)||qt(r,t.prev,t))||Pc(r,t)&&qt(r.prev,r,r.next)>0&&qt(t.prev,t,t.next)>0)}function qt(r,t,e){return(t.y-r.y)*(e.x-t.x)-(t.x-r.x)*(e.y-t.y)}function Pc(r,t){return r.x===t.x&&r.y===t.y}function C5(r,t,e,s){const i=d0(qt(r,t,e)),n=d0(qt(r,t,s)),o=d0(qt(e,s,r)),a=d0(qt(e,s,t));return!!(i!==n&&o!==a||i===0&&h0(r,e,t)||n===0&&h0(r,s,t)||o===0&&h0(e,r,s)||a===0&&h0(e,t,s))}function h0(r,t,e){return t.x<=Math.max(r.x,e.x)&&t.x>=Math.min(r.x,e.x)&&t.y<=Math.max(r.y,e.y)&&t.y>=Math.min(r.y,e.y)}function d0(r){return r>0?1:r<0?-1:0}function Hg(r,t){let e=r;do{if(e.i!==r.i&&e.next.i!==r.i&&e.i!==t.i&&e.next.i!==t.i&&C5(e,e.next,r,t))return!0;e=e.next}while(e!==r);return!1}function pa(r,t){return qt(r.prev,r,r.next)<0?qt(r,t,r.next)>=0&&qt(r,r.prev,t)>=0:qt(r,t,r.prev)<0||qt(r,r.next,t)<0}function qg(r,t){let e=r,s=!1;const i=(r.x+t.x)/2,n=(r.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==r);return s}function R5(r,t){const e=new J1(r.i,r.x,r.y),s=new J1(t.i,t.x,t.y),i=r.next,n=t.prev;return r.next=t,t.prev=r,e.next=i,i.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function J2(r,t,e,s){const i=new J1(r,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function ha(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function J1(r,t,e){this.i=r,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Yg(r,t,e,s){let i=0;for(let n=t,o=e-s;n<e;n+=s)i+=(r[o]-r[n])*(r[n+1]+r[o+1]),o=n;return i}class Kr{static area(t){const e=t.length;let s=0;for(let i=e-1,n=0;n<e;i=n++)s+=t[i].x*t[n].y-t[n].x*t[i].y;return s*.5}static isClockWise(t){return Kr.area(t)<0}static triangulateShape(t,e){const s=[],i=[],n=[];Q2(t),th(s,t);let o=t.length;e.forEach(Q2);for(let c=0;c<e.length;c++)i.push(o),o+=e[c].length,th(s,e[c]);const a=Eg.triangulate(s,i);for(let c=0;c<a.length;c+=3)n.push(a.slice(c,c+3));return n}}function Q2(r){const t=r.length;t>2&&r[t-1].equals(r[0])&&r.pop()}function th(r,t){for(let e=0;e<t.length;e++)r.push(t[e].x),r.push(t[e].y)}class da extends Ju{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,i=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new da(t.radius,t.detail)}}class on extends It{constructor(t=1,e=1,s=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:s,heightSegments:i};const n=t/2,o=e/2,a=Math.floor(s),c=Math.floor(i),l=a+1,u=c+1,p=t/a,h=e/c,d=[],g=[],f=[],y=[];for(let x=0;x<u;x++){const b=x*h-o;for(let w=0;w<l;w++){const _=w*p-n;g.push(_,-b,0),f.push(0,0,1),y.push(w/a),y.push(1-x/c)}}for(let x=0;x<c;x++)for(let b=0;b<a;b++){const w=b+l*x,_=b+l*(x+1),T=b+1+l*(x+1),M=b+1+l*x;d.push(w,_,M),d.push(_,T,M)}this.setIndex(d),this.setAttribute("position",new ht(g,3)),this.setAttribute("normal",new ht(f,3)),this.setAttribute("uv",new ht(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new on(t.width,t.height,t.widthSegments,t.heightSegments)}}class Na extends It{constructor(t=.5,e=1,s=32,i=1,n=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:s,phiSegments:i,thetaStart:n,thetaLength:o},s=Math.max(3,s),i=Math.max(1,i);const a=[],c=[],l=[],u=[];let p=t;const h=(e-t)/i,d=new v,g=new q;for(let f=0;f<=i;f++){for(let y=0;y<=s;y++){const x=n+y/s*o;d.x=p*Math.cos(x),d.y=p*Math.sin(x),c.push(d.x,d.y,d.z),l.push(0,0,1),g.x=(d.x/e+1)/2,g.y=(d.y/e+1)/2,u.push(g.x,g.y)}p+=h}for(let f=0;f<i;f++){const y=f*(s+1);for(let x=0;x<s;x++){const b=x+y,w=b,_=b+s+1,T=b+s+2,M=b+1;a.push(w,_,M),a.push(_,T,M)}}this.setIndex(a),this.setAttribute("position",new ht(c,3)),this.setAttribute("normal",new ht(l,3)),this.setAttribute("uv",new ht(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Na(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class Qu extends It{constructor(t=new A5([new q(0,.5),new q(-.5,-.5),new q(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],i=[],n=[],o=[];let a=0,c=0;if(Array.isArray(t)===!1)l(t);else for(let u=0;u<t.length;u++)l(t[u]),this.addGroup(a,c,u),a+=c,c=0;this.setIndex(s),this.setAttribute("position",new ht(i,3)),this.setAttribute("normal",new ht(n,3)),this.setAttribute("uv",new ht(o,2));function l(u){const p=i.length/3,h=u.extractPoints(e);let d=h.shape;const g=h.holes;Kr.isClockWise(d)===!1&&(d=d.reverse());for(let y=0,x=g.length;y<x;y++){const b=g[y];Kr.isClockWise(b)===!0&&(g[y]=b.reverse())}const f=Kr.triangulateShape(d,g);for(let y=0,x=g.length;y<x;y++){const b=g[y];d=d.concat(b)}for(let y=0,x=d.length;y<x;y++){const b=d[y];i.push(b.x,b.y,0),n.push(0,0,1),o.push(b.x,b.y)}for(let y=0,x=f.length;y<x;y++){const b=f[y],w=b[0]+p,_=b[1]+p,T=b[2]+p;s.push(w,_,T),c+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return Xg(e,t)}static fromJSON(t,e){const s=[];for(let i=0,n=t.shapes.length;i<n;i++){const o=e[t.shapes[i]];s.push(o)}return new Qu(s,t.curveSegments)}}function Xg(r,t){if(t.shapes=[],Array.isArray(r))for(let e=0,s=r.length;e<s;e++){const i=r[e];t.shapes.push(i.uuid)}else t.shapes.push(r.uuid);return t}class Et extends It{constructor(t=1,e=32,s=16,i=0,n=Math.PI*2,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:s,phiStart:i,phiLength:n,thetaStart:o,thetaLength:a},e=Math.max(3,Math.floor(e)),s=Math.max(2,Math.floor(s));const c=Math.min(o+a,Math.PI);let l=0;const u=[],p=new v,h=new v,d=[],g=[],f=[],y=[];for(let x=0;x<=s;x++){const b=[],w=x/s;let _=0;x===0&&o===0?_=.5/e:x===s&&c===Math.PI&&(_=-.5/e);for(let T=0;T<=e;T++){const M=T/e;p.x=-t*Math.cos(i+M*n)*Math.sin(o+w*a),p.y=t*Math.cos(o+w*a),p.z=t*Math.sin(i+M*n)*Math.sin(o+w*a),g.push(p.x,p.y,p.z),h.copy(p).normalize(),f.push(h.x,h.y,h.z),y.push(M+_,1-w),b.push(l++)}u.push(b)}for(let x=0;x<s;x++)for(let b=0;b<e;b++){const w=u[x][b+1],_=u[x][b],T=u[x+1][b],M=u[x+1][b+1];(x!==0||o>0)&&d.push(w,_,M),(x!==s-1||c<Math.PI)&&d.push(_,T,M)}this.setIndex(d),this.setAttribute("position",new ht(g,3)),this.setAttribute("normal",new ht(f,3)),this.setAttribute("uv",new ht(y,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Et(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Pi extends It{constructor(t=1,e=.4,s=12,i=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:s,tubularSegments:i,arc:n},s=Math.floor(s),i=Math.floor(i);const o=[],a=[],c=[],l=[],u=new v,p=new v,h=new v;for(let d=0;d<=s;d++)for(let g=0;g<=i;g++){const f=g/i*n,y=d/s*Math.PI*2;p.x=(t+e*Math.cos(y))*Math.cos(f),p.y=(t+e*Math.cos(y))*Math.sin(f),p.z=e*Math.sin(y),a.push(p.x,p.y,p.z),u.x=t*Math.cos(f),u.y=t*Math.sin(f),h.subVectors(p,u).normalize(),c.push(h.x,h.y,h.z),l.push(g/i),l.push(d/s)}for(let d=1;d<=s;d++)for(let g=1;g<=i;g++){const f=(i+1)*d+g-1,y=(i+1)*(d-1)+g-1,x=(i+1)*(d-1)+g,b=(i+1)*d+g;o.push(f,y,b),o.push(y,x,b)}this.setIndex(o),this.setAttribute("position",new ht(a,3)),this.setAttribute("normal",new ht(c,3)),this.setAttribute("uv",new ht(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Pi(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class tp extends It{constructor(t=1,e=.4,s=64,i=8,n=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:s,radialSegments:i,p:n,q:o},s=Math.floor(s),i=Math.floor(i);const a=[],c=[],l=[],u=[],p=new v,h=new v,d=new v,g=new v,f=new v,y=new v,x=new v;for(let w=0;w<=s;++w){const _=w/s*n*Math.PI*2;b(_,n,o,t,d),b(_+.01,n,o,t,g),y.subVectors(g,d),x.addVectors(g,d),f.crossVectors(y,x),x.crossVectors(f,y),f.normalize(),x.normalize();for(let T=0;T<=i;++T){const M=T/i*Math.PI*2,A=-e*Math.cos(M),C=e*Math.sin(M);p.x=d.x+(A*x.x+C*f.x),p.y=d.y+(A*x.y+C*f.y),p.z=d.z+(A*x.z+C*f.z),c.push(p.x,p.y,p.z),h.subVectors(p,d).normalize(),l.push(h.x,h.y,h.z),u.push(w/s),u.push(T/i)}}for(let w=1;w<=s;w++)for(let _=1;_<=i;_++){const T=(i+1)*(w-1)+(_-1),M=(i+1)*w+(_-1),A=(i+1)*w+_,C=(i+1)*(w-1)+_;a.push(T,M,C),a.push(M,A,C)}this.setIndex(a),this.setAttribute("position",new ht(c,3)),this.setAttribute("normal",new ht(l,3)),this.setAttribute("uv",new ht(u,2));function b(w,_,T,M,A){const C=Math.cos(w),P=Math.sin(w),D=T/_*w,V=Math.cos(D);A.x=M*(2+V)*.5*C,A.y=M*(2+V)*P*.5,A.z=M*Math.sin(D)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new tp(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class ep extends It{constructor(t=new v5(new v(-1,-1,0),new v(-1,1,0),new v(1,1,0)),e=64,s=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:s,radialSegments:i,closed:n};const o=t.computeFrenetFrames(e,n);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const a=new v,c=new v,l=new q;let u=new v;const p=[],h=[],d=[],g=[];f(),this.setIndex(g),this.setAttribute("position",new ht(p,3)),this.setAttribute("normal",new ht(h,3)),this.setAttribute("uv",new ht(d,2));function f(){for(let w=0;w<e;w++)y(w);y(n===!1?e:0),b(),x()}function y(w){u=t.getPointAt(w/e,u);const _=o.normals[w],T=o.binormals[w];for(let M=0;M<=i;M++){const A=M/i*Math.PI*2,C=Math.sin(A),P=-Math.cos(A);c.x=P*_.x+C*T.x,c.y=P*_.y+C*T.y,c.z=P*_.z+C*T.z,c.normalize(),h.push(c.x,c.y,c.z),a.x=u.x+s*c.x,a.y=u.y+s*c.y,a.z=u.z+s*c.z,p.push(a.x,a.y,a.z)}}function x(){for(let w=1;w<=e;w++)for(let _=1;_<=i;_++){const T=(i+1)*(w-1)+(_-1),M=(i+1)*w+(_-1),A=(i+1)*w+_,C=(i+1)*(w-1)+_;g.push(T,M,C),g.push(M,A,C)}}function b(){for(let w=0;w<=e;w++)for(let _=0;_<=i;_++)l.x=w/e,l.y=_/i,d.push(l.x,l.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new ep(new j1[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class jg extends Ze{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new W(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class Is extends Ze{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new W(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new hs,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class F5 extends Is{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new q(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return ct(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new W(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new W(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new W(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class Zg extends Ze{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new W(16777215),this.specular=new W(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new hs,this.combine=Fc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class Kg extends Ze{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new W(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class Jg extends Ze{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class Qg extends Ze{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new hs,this.combine=Fc,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class tf extends Ze{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new W(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=cn,this.normalScale=new q(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class ef extends b5{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}class so extends Yt{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new W(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}class E5 extends so{constructor(t,e,s){super(t,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new W(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const Bl=new pt,eh=new v,sh=new v;class sp{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new q(512,512),this.map=null,this.mapPass=null,this.matrix=new pt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Xu,this._frameExtents=new q(1,1),this._viewportCount=1,this._viewports=[new yt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;eh.setFromMatrixPosition(t.matrixWorld),e.position.copy(eh),sh.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(sh),e.updateMatrixWorld(),Bl.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Bl),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(Bl)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class sf extends sp{constructor(){super(new qs(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,s=ca*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(s!==e.fov||i!==e.aspect||n!==e.far)&&(e.fov=s,e.aspect=i,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class B5 extends so{constructor(t,e,s=0,i=Math.PI/3,n=0,o=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.distance=s,this.angle=i,this.penumbra=n,this.decay=o,this.map=null,this.shadow=new sf}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const ih=new pt,vr=new v,Dl=new v;class nf extends sp{constructor(){super(new qs(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new q(4,2),this._viewportCount=6,this._viewports=[new yt(2,1,1,1),new yt(0,1,1,1),new yt(3,1,1,1),new yt(1,1,1,1),new yt(3,0,1,1),new yt(1,0,1,1)],this._cubeDirections=[new v(1,0,0),new v(-1,0,0),new v(0,0,1),new v(0,0,-1),new v(0,1,0),new v(0,-1,0)],this._cubeUps=[new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,1,0),new v(0,0,1),new v(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,i=this.matrix,n=t.distance||s.far;n!==s.far&&(s.far=n,s.updateProjectionMatrix()),vr.setFromMatrixPosition(t.matrixWorld),s.position.copy(vr),Dl.copy(s.position),Dl.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(Dl),s.updateMatrixWorld(),i.makeTranslation(-vr.x,-vr.y,-vr.z),ih.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ih)}}class yn extends so{constructor(t,e,s=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new nf}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class ip extends m5{constructor(t=-1,e=1,s=1,i=-1,n=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=i,this.near=n,this.far=o,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,i,n,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=s-t,o=s+t,a=i+e,c=i-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,o=n+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,o,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class of extends sp{constructor(){super(new ip(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class D5 extends so{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Yt.DEFAULT_UP),this.updateMatrix(),this.target=new Yt,this.shadow=new of}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class rf extends so{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class af extends so{constructor(t,e,s=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class cf{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new v)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const s=t.x,i=t.y,n=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.282095),e.addScaledVector(o[1],.488603*i),e.addScaledVector(o[2],.488603*n),e.addScaledVector(o[3],.488603*s),e.addScaledVector(o[4],1.092548*(s*i)),e.addScaledVector(o[5],1.092548*(i*n)),e.addScaledVector(o[6],.315392*(3*n*n-1)),e.addScaledVector(o[7],1.092548*(s*n)),e.addScaledVector(o[8],.546274*(s*s-i*i)),e}getIrradianceAt(t,e){const s=t.x,i=t.y,n=t.z,o=this.coefficients;return e.copy(o[0]).multiplyScalar(.886227),e.addScaledVector(o[1],2*.511664*i),e.addScaledVector(o[2],2*.511664*n),e.addScaledVector(o[3],2*.511664*s),e.addScaledVector(o[4],2*.429043*s*i),e.addScaledVector(o[5],2*.429043*i*n),e.addScaledVector(o[6],.743125*n*n-.247708),e.addScaledVector(o[7],2*.429043*s*n),e.addScaledVector(o[8],.429043*(s*s-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(t.coefficients[s],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let s=0;s<9;s++)this.coefficients[s].lerp(t.coefficients[s],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].fromArray(t,e+i*3);return this}toArray(t=[],e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].toArray(t,e+i*3);return t}static getBasisAt(t,e){const s=t.x,i=t.y,n=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*n,e[3]=.488603*s,e[4]=1.092548*s*i,e[5]=1.092548*i*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*s*n,e[8]=.546274*(s*s-i*i)}}class lf extends so{constructor(t=new cf,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class uf{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=nh(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=nh();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function nh(){return performance.now()}class pf extends x5{constructor(t,e,s=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}class hf extends gn{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Rc}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Rc);const df=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class gf{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=t.object.isSkinnedMesh===!0,this.refreshUniforms=df,this.renderId=0}firstInitialization(t){return this.renderObjects.has(t)===!1?(this.getRenderObjectData(t),!0):!1}getRenderObjectData(t){let e=this.renderObjects.get(t);if(e===void 0){const{geometry:s,material:i,object:n}=t;if(e={material:this.getMaterialData(i),geometry:{attributes:this.getAttributesData(s.attributes),indexVersion:s.index?s.index.version:null,drawRange:{start:s.drawRange.start,count:s.drawRange.count}},worldMatrix:n.matrixWorld.clone()},n.center&&(e.center=n.center.clone()),n.morphTargetInfluences&&(e.morphTargetInfluences=n.morphTargetInfluences.slice()),t.bundle!==null&&(e.version=t.bundle.version),e.material.transmission>0){const{width:o,height:a}=t.context;e.bufferWidth=o,e.bufferHeight=a}this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const s in t){const i=t[s];e[s]={version:i.version}}return e}containsNode(t){const e=t.material;for(const s in e)if(e[s]&&e[s].isNode)return!0;return t.renderer.nodes.modelViewMatrix!==null||t.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(t){const e={};for(const s of this.refreshUniforms){const i=t[s];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?e[s]={id:i.id,version:i.version}:e[s]=i.clone():e[s]=i)}return e}equals(t){const{object:e,material:s,geometry:i}=t,n=this.getRenderObjectData(t);if(n.worldMatrix.equals(e.matrixWorld)!==!0)return n.worldMatrix.copy(e.matrixWorld),!1;const o=n.material;for(const f in o){const y=o[f],x=s[f];if(y.equals!==void 0){if(y.equals(x)===!1)return y.copy(x),!1}else if(x.isTexture===!0){if(y.id!==x.id||y.version!==x.version)return y.id=x.id,y.version=x.version,!1}else if(y!==x)return o[f]=x,!1}if(o.transmission>0){const{width:f,height:y}=t.context;if(n.bufferWidth!==f||n.bufferHeight!==y)return n.bufferWidth=f,n.bufferHeight=y,!1}const a=n.geometry,c=i.attributes,l=a.attributes,u=Object.keys(l),p=Object.keys(c);if(u.length!==p.length)return n.geometry.attributes=this.getAttributesData(c),!1;for(const f of u){const y=l[f],x=c[f];if(x===void 0)return delete l[f],!1;if(y.version!==x.version)return y.version=x.version,!1}const h=i.index,d=a.indexVersion,g=h?h.version:null;if(d!==g)return a.indexVersion=g,!1;if(a.drawRange.start!==i.drawRange.start||a.drawRange.count!==i.drawRange.count)return a.drawRange.start=i.drawRange.start,a.drawRange.count=i.drawRange.count,!1;if(n.morphTargetInfluences){let f=!1;for(let y=0;y<n.morphTargetInfluences.length;y++)n.morphTargetInfluences[y]!==e.morphTargetInfluences[y]&&(f=!0);if(f)return!0}return n.center&&n.center.equals(e.center)===!1?(n.center.copy(e.center),!0):(t.bundle!==null&&(n.version=t.bundle.version),!0)}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t))return!0;const{renderId:s}=e;if(this.renderId!==s)return this.renderId=s,!0;const i=t.object.static===!0,n=t.bundle!==null&&t.bundle.static===!0&&this.getRenderObjectData(t).version===t.bundle.version;return i||n?!1:this.equals(t)!==!0}}function ga(r,t=0){let e=3735928559^t,s=1103547991^t;if(r instanceof Array)for(let i=0,n;i<r.length;i++)n=r[i],e=Math.imul(e^n,2654435761),s=Math.imul(s^n,1597334677);else for(let i=0,n;i<r.length;i++)n=r.charCodeAt(i),e=Math.imul(e^n,2654435761),s=Math.imul(s^n,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&s)+(e>>>0)}const P5=r=>ga(r),np=r=>ga(r),I5=(...r)=>ga(r);function L5(r,t=!1){const e=[];r.isNode===!0&&(e.push(r.id),r=r.getSelf());for(const{property:s,childNode:i}of rc(r))e.push(e,ga(s.slice(0,-4)),i.getCacheKey(t));return ga(e)}function*rc(r,t=!1){for(const e in r){if(e.startsWith("_")===!0)continue;const s=r[e];if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const n=s[i];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:i,childNode:n})}else if(s&&s.isNode===!0)yield{property:e,childNode:s};else if(typeof s=="object")for(const i in s){const n=s[i];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:i,childNode:n})}}}const ff=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]);function U5(r){return ff.get(r)}function z5(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r))return 4;if(/mat3/.test(r))return 9;if(/mat4/.test(r))return 16;console.error("THREE.TSL: Unsupported type:",r)}function tn(r){if(r==null)return null;const t=typeof r;return r.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function V5(r,...t){const e=r?r.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),r==="color"?new W(...t):e==="vec2"?new q(...t):e==="vec3"?new v(...t):e==="vec4"?new yt(...t):e==="mat3"?new ts(...t):e==="mat4"?new pt(...t):r==="bool"?t[0]||!1:r==="float"||r==="int"||r==="uint"?t[0]||0:r==="string"?t[0]||"":r==="ArrayBuffer"?O5(t[0]):null}function k5(r){let t="";const e=new Uint8Array(r);for(let s=0;s<e.length;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function O5(r){return Uint8Array.from(atob(r),t=>t.charCodeAt(0)).buffer}const Q1={VERTEX:"vertex",FRAGMENT:"fragment"},st={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},mf={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},Ie={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},G5=["fragment","vertex"],tu=["setup","analyze","generate"],eu=[...G5,"compute"],io=["x","y","z","w"];let yf=0;class Z extends gn{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=st.NONE,this.updateBeforeType=st.NONE,this.updateAfterType=st.NONE,this.uuid=Pe.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:yf++})}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,st.FRAME)}onRenderUpdate(t){return this.onUpdate(t,st.RENDER)}onObjectUpdate(t){return this.onUpdate(t,st.OBJECT)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of rc(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return t=t||this.version!==this._cacheKeyVersion,(t===!0||this._cacheKey===null)&&(this._cacheKey=L5(this,t),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let s=0;for(const i of this.getChildren())e["node"+s++]=i;return null}analyze(t){if(t.increaseUsage(this)===1){const s=t.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(t)}}generate(t,e){const{outputNode:s}=t.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(t,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const s=this.getShared(t);if(this!==s)return s.build(t,e);t.addNode(this),t.addChain(this);let i=null;const n=t.getBuildStage();if(n==="setup"){this.updateReference(t);const o=t.getNodeProperties(this);if(o.initialized!==!0){const a=t.stack.nodes.length;o.initialized=!0,o.outputNode=this.setup(t),o.outputNode!==null&&t.stack.nodes.length;for(const c of Object.values(o))c&&c.isNode===!0&&c.build(t)}}else if(n==="analyze")this.analyze(t);else if(n==="generate")if(this.generate.length===1){const a=this.getNodeType(t),c=t.getDataFromNode(this);i=c.snippet,i===void 0?(i=this.generate(t)||"",c.snippet=i):c.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),i=t.format(i,a,e)}else i=this.generate(t,e)||"";return t.removeChain(this),t.addSequentialNode(this),i}getSerializeChildren(){return rc(this)}serialize(t){const e=this.getSerializeChildren(),s={};for(const{property:i,index:n,childNode:o}of e)n!==void 0?(s[i]===void 0&&(s[i]=Number.isInteger(n)?[]:{}),s[i][n]=o.toJSON(t.meta).uuid):s[i]=o.toJSON(t.meta).uuid;Object.keys(s).length>0&&(t.inputNodes=s)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const s in t.inputNodes)if(Array.isArray(t.inputNodes[s])){const i=[];for(const n of t.inputNodes[s])i.push(e[n]);this[s]=i}else if(typeof t.inputNodes[s]=="object"){const i={};for(const n in t.inputNodes[s]){const o=t.inputNodes[s][n];i[n]=e[o]}this[s]=i}else{const i=t.inputNodes[s];this[s]=e[i]}}}toJSON(t){const{uuid:e,type:s}=this,i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{},nodes:{}});let n=t.nodes[e];n===void 0&&(n={uuid:e,type:s,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},i!==!0&&(t.nodes[n.uuid]=n),this.serialize(n),delete n.meta);function o(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}if(i){const a=o(t.textures),c=o(t.images),l=o(t.nodes);a.length>0&&(n.textures=a),c.length>0&&(n.images=c),l.length>0&&(n.nodes=l)}return n}}class no extends Z{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=this.node.build(t),s=this.indexNode.build(t,"uint");return`${e}[ ${s} ]`}}class W5 extends Z{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let s=null;for(const i of this.convertTo.split("|"))(s===null||t.getTypeLength(e)===t.getTypeLength(i))&&(s=i);return s}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const s=this.node,i=this.getNodeType(t),n=s.build(t,i);return t.format(n,i,e)}}class te extends Z{static get type(){return"TempNode"}constructor(t){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const i=t.getVectorType(this.getNodeType(t,e)),n=t.getDataFromNode(this);if(n.propertyName!==void 0)return t.format(n.propertyName,i,e);if(i!=="void"&&e!=="void"&&this.hasDependencies(t)){const o=super.build(t,i),a=t.getVarFromNode(this,null,i),c=t.getPropertyName(a);return t.addLineFlowCode(`${c} = ${o}`,this),n.snippet=o,n.propertyName=c,t.format(n.propertyName,i,e)}}return super.build(t,e)}}class xf extends te{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,s)=>e+t.getTypeLength(s.getNodeType(t)),0))}generate(t,e){const s=this.getNodeType(t),i=this.nodes,n=t.getComponentType(s),o=[];for(const c of i){let l=c.build(t);const u=t.getComponentType(c.getNodeType(t));u!==n&&(l=t.format(l,u,n)),o.push(l)}const a=`${t.getType(s)}( ${o.join(", ")} )`;return t.format(a,s,e)}}const bf=io.join("");class su extends Z{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(io.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const s=this.node,i=t.getTypeLength(s.getNodeType(t));let n=null;if(i>1){let o=null;this.getVectorLength()>=i&&(o=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const c=s.build(t,o);this.components.length===i&&this.components===bf.slice(0,this.components.length)?n=t.format(c,o,e):n=t.format(`${c}.${this.components}`,this.getNodeType(t),e)}else n=s.build(t,e);return n}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class wf extends te{static get type(){return"SetNode"}constructor(t,e,s){super(),this.sourceNode=t,this.components=e,this.targetNode=s}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:s,targetNode:i}=this,n=this.getNodeType(t),o=t.getTypeFromLength(s.length,i.getNodeType(t)),a=i.build(t,o),c=e.build(t,n),l=t.getTypeLength(n),u=[];for(let p=0;p<l;p++){const h=io[p];h===s[0]?(u.push(a),p+=s.length-1):u.push(c+"."+h)}return`${t.getType(n)}( ${u.join(", ")} )`}}class _f extends te{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:s}=this,i=this.getNodeType(t),n=s.build(t),o=t.getVarFromNode(this),a=t.getPropertyName(o);t.addLineFlowCode(a+" = "+n,this);const c=t.getTypeLength(i),l=[];let u=0;for(let p=0;p<c;p++){const h=io[p];h===e[u]?(l.push("1.0 - "+(a+"."+h)),u++):l.push(a+"."+h)}return`${t.getType(i)}( ${l.join(", ")} )`}}class op extends Z{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?tn(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=tn(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=k5(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?V5(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}class zs extends op{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const s=this.getNodeType(t);return t.format(this.generateConst(t),s,e)}}let rr=null;const qo=new Map;function U(r,t){if(qo.has(r)){console.warn(`Redefinition of method chaining ${r}`);return}if(typeof t!="function")throw new Error(`Node element ${r} is not a function`);qo.set(r,t)}const $5=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),oh=r=>$5(r).split("").sort().join(""),H5={setup(r,t){const e=t.shift();return r(Ca(e),...t)},get(r,t,e){if(typeof t=="string"&&r[t]===void 0){if(r.isStackNode!==!0&&t==="assign")return(...s)=>(rr.assign(e,...s),e);if(qo.has(t)){const s=qo.get(t);return r.isStackNode?(...i)=>e.add(s(...i)):(...i)=>s(e,...i)}else{if(t==="self")return r;if(t.endsWith("Assign")&&qo.has(t.slice(0,t.length-6))){const s=qo.get(t.slice(0,t.length-6));return r.isStackNode?(...i)=>e.assign(i[0],s(...i)):(...i)=>e.assign(s(e,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0)return t=$5(t),z(new su(e,t));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=oh(t.slice(3).toLowerCase()),s=>z(new wf(r,t,s));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=oh(t.slice(4).toLowerCase()),()=>z(new _f(z(r),t));if(t==="width"||t==="height"||t==="depth")return t==="width"?t="x":t==="height"?t="y":t==="depth"&&(t="z"),z(new su(r,t));if(/^\d+$/.test(t)===!0)return z(new no(e,new zs(Number(t),"uint")))}}}return Reflect.get(r,t,e)},set(r,t,e,s){return typeof t=="string"&&r[t]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0||t==="width"||t==="height"||t==="depth"||/^\d+$/.test(t)===!0)?(s[t].assign(e),!0):Reflect.set(r,t,e,s)}},Pl=new WeakMap,rh=new WeakMap,Tf=function(r,t=null){const e=tn(r);if(e==="node"){let s=Pl.get(r);return s===void 0&&(s=new Proxy(r,H5),Pl.set(r,s),Pl.set(s,s)),s}else{if(t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string")return z(iu(r,t));if(e==="shader")return B(r)}return r},Sf=function(r,t=null){for(const e in r)r[e]=z(r[e],t);return r},vf=function(r,t=null){const e=r.length;for(let s=0;s<e;s++)r[s]=z(r[s],t);return r},Mf=function(r,t=null,e=null,s=null){const i=n=>z(s!==null?Object.assign(n,s):n);return t===null?(...n)=>i(new r(...Vn(n))):e!==null?(e=z(e),(...n)=>i(new r(t,...Vn(n),e))):(...n)=>i(new r(t,...Vn(n)))},Af=function(r,...t){return z(new r(...Vn(t)))};class Nf extends Z{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}call(t){const{shaderNode:e,inputNodes:s}=this,i=t.getNodeProperties(e);if(i.onceOutput)return i.onceOutput;let n=null;if(e.layout){let o=rh.get(t.constructor);o===void 0&&(o=new WeakMap,rh.set(t.constructor,o));let a=o.get(e);a===void 0&&(a=z(t.buildFunctionNode(e)),o.set(e,a)),t.currentFunctionNode!==null&&t.currentFunctionNode.includes.push(a),n=z(a.call(s))}else{const o=e.jsFunc,a=s!==null?o(s,t):o(t);n=z(a)}return e.once&&(i.onceOutput=n),n}getOutputNode(t){const e=t.getNodeProperties(this);return e.outputNode===null&&(e.outputNode=this.setupOutput(t)),e.outputNode}setup(t){return this.getOutputNode(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){return this.getOutputNode(t).build(t,e)}}class Cf extends Z{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return Ca(t),z(new Nf(this,t))}setup(){return this.call()}}const Rf=[!1,!0],Ff=[0,1,2,3],Ef=[-1,-2],q5=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],rp=new Map;for(const r of Rf)rp.set(r,new zs(r));const ap=new Map;for(const r of Ff)ap.set(r,new zs(r,"uint"));const cp=new Map([...ap].map(r=>new zs(r.value,"int")));for(const r of Ef)cp.set(r,new zs(r,"int"));const Ic=new Map([...cp].map(r=>new zs(r.value)));for(const r of q5)Ic.set(r,new zs(r));for(const r of q5)Ic.set(-r,new zs(-r));const Lc={bool:rp,uint:ap,ints:cp,float:Ic},ah=new Map([...rp,...Ic]),iu=(r,t)=>ah.has(r)?ah.get(r):r.isNode===!0?r:new zs(r,t),Bf=r=>{try{return r.getNodeType()}catch{return}},he=function(r,t=null){return(...e)=>{if((e.length===0||!["bool","float","int","uint"].includes(r)&&e.every(i=>typeof i!="object"))&&(e=[V5(r,...e)]),e.length===1&&t!==null&&t.has(e[0]))return z(t.get(e[0]));if(e.length===1){const i=iu(e[0],r);return Bf(i)===r?z(i):z(new W5(i,r))}const s=e.map(i=>iu(i));return z(new xf(s,r))}},fa=r=>typeof r=="object"&&r!==null?r.value:r,Y5=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function Jr(r,t){return new Proxy(new Cf(r,t),H5)}const z=(r,t=null)=>Tf(r,t),Ca=(r,t=null)=>new Sf(r,t),Vn=(r,t=null)=>new vf(r,t),L=(...r)=>new Mf(...r),G=(...r)=>new Af(...r),B=(r,t)=>{const e=new Jr(r,t),s=(...i)=>{let n;return Ca(i),i[0]&&i[0].isNode?n=[...i]:n=i[0],e.call(n)};return s.shaderNode=e,s.setLayout=i=>(e.setLayout(i),s),s.once=()=>(e.once=!0,s),s},Df=(...r)=>(console.warn("TSL.ShaderNode: tslFn() has been renamed to Fn()."),B(...r));U("toGlobal",r=>(r.global=!0,r));const ma=r=>{rr=r},lp=()=>rr,rt=(...r)=>rr.If(...r);function X5(r){return rr&&rr.add(r),r}U("append",X5);const j5=new he("color"),S=new he("float",Lc.float),N=new he("int",Lc.ints),H=new he("uint",Lc.uint),Ei=new he("bool",Lc.bool),k=new he("vec2"),ge=new he("ivec2"),Z5=new he("uvec2"),K5=new he("bvec2"),F=new he("vec3"),J5=new he("ivec3"),hr=new he("uvec3"),up=new he("bvec3"),X=new he("vec4"),Q5=new he("ivec4"),t4=new he("uvec4"),e4=new he("bvec4"),Uc=new he("mat2"),ze=new he("mat3"),kn=new he("mat4"),Pf=(r="")=>z(new zs(r,"string")),If=r=>z(new zs(r,"ArrayBuffer"));U("toColor",j5);U("toFloat",S);U("toInt",N);U("toUint",H);U("toBool",Ei);U("toVec2",k);U("toIVec2",ge);U("toUVec2",Z5);U("toBVec2",K5);U("toVec3",F);U("toIVec3",J5);U("toUVec3",hr);U("toBVec3",up);U("toVec4",X);U("toIVec4",Q5);U("toUVec4",t4);U("toBVec4",e4);U("toMat2",Uc);U("toMat3",ze);U("toMat4",kn);const s4=L(no),i4=(r,t)=>z(new W5(z(r),t)),Lf=(r,t)=>z(new su(z(r),t));U("element",s4);U("convert",i4);class n4 extends Z{static get type(){return"UniformGroupNode"}constructor(t,e=!1,s=1){super("string"),this.name=t,this.version=0,this.shared=e,this.order=s,this.isUniformGroup=!0}set needsUpdate(t){t===!0&&this.version++}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const o4=r=>new n4(r),pp=(r,t=0)=>new n4(r,!0,t),r4=pp("frame"),Q=pp("render"),hp=o4("object");class Ra extends op{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=hp}label(t){return this.name=t,this}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const s=this.getSelf();return t=t.bind(s),super.onUpdate(i=>{const n=t(i,s);n!==void 0&&(this.value=n)},e)}generate(t,e){const s=this.getNodeType(t),i=this.getUniformHash(t);let n=t.getNodeFromHash(i);n===void 0&&(t.setHashNode(this,i),n=this);const o=n.getInputType(t),a=t.getUniformFromNode(n,o,t.shaderStage,this.name||t.context.label),c=t.getPropertyName(a);return t.context.label!==void 0&&delete t.context.label,t.format(c,s,e)}}const j=(r,t)=>{const e=Y5(t||r),s=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return z(new Ra(s,e))};class vt extends Z{static get type(){return"PropertyNode"}constructor(t,e=null,s=!1){super(t),this.name=e,this.varying=s,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const a4=(r,t)=>z(new vt(r,t)),ya=(r,t)=>z(new vt(r,t,!0)),wt=G(vt,"vec4","DiffuseColor"),nu=G(vt,"vec3","EmissiveColor"),Xs=G(vt,"float","Roughness"),xa=G(vt,"float","Metalness"),ac=G(vt,"float","Clearcoat"),ba=G(vt,"float","ClearcoatRoughness"),Ln=G(vt,"vec3","Sheen"),zc=G(vt,"float","SheenRoughness"),Vc=G(vt,"float","Iridescence"),dp=G(vt,"float","IridescenceIOR"),gp=G(vt,"float","IridescenceThickness"),cc=G(vt,"float","AlphaT"),Yi=G(vt,"float","Anisotropy"),Qr=G(vt,"vec3","AnisotropyT"),On=G(vt,"vec3","AnisotropyB"),He=G(vt,"color","SpecularColor"),wa=G(vt,"float","SpecularF90"),lc=G(vt,"float","Shininess"),c4=G(vt,"vec4","Output"),O0=G(vt,"float","dashSize"),ou=G(vt,"float","gapSize"),Uf=G(vt,"float","pointWidth"),ta=G(vt,"float","IOR"),uc=G(vt,"float","Transmission"),fp=G(vt,"float","Thickness"),mp=G(vt,"float","AttenuationDistance"),yp=G(vt,"color","AttenuationColor"),xp=G(vt,"float","Dispersion");class zf extends te{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const s=t.getTypeLength(e.node.getNodeType(t));return io.join("").slice(0,s)!==e.components}return!1}generate(t,e){const{targetNode:s,sourceNode:i}=this,n=this.needsSplitAssign(t),o=s.getNodeType(t),a=s.context({assign:!0}).build(t),c=i.build(t,o),l=i.getNodeType(t),u=t.getDataFromNode(this);let p;if(u.initialized===!0)e!=="void"&&(p=a);else if(n){const h=t.getVarFromNode(this,null,o),d=t.getPropertyName(h);t.addLineFlowCode(`${d} = ${c}`,this);const g=s.node.context({assign:!0}).build(t);for(let f=0;f<s.components.length;f++){const y=s.components[f];t.addLineFlowCode(`${g}.${y} = ${d}[ ${f} ]`,this)}e!=="void"&&(p=a)}else p=`${a} = ${c}`,(e==="void"||l==="void")&&(t.addLineFlowCode(p,this),e!=="void"&&(p=a));return u.initialized=!0,t.format(p,o,e)}}const l4=L(zf);U("assign",l4);class Vf extends te{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],s=this.functionNode,i=s.getInputs(t),n=this.parameters,o=(c,l)=>{const u=l.type,p=u==="pointer";let h;return p?h="&"+c.build(t):h=c.build(t,u),h};if(Array.isArray(n))for(let c=0;c<n.length;c++)e.push(o(n[c],i[c]));else for(const c of i){const l=n[c.name];if(l!==void 0)e.push(o(l,c));else throw new Error(`FunctionCallNode: Input '${c.name}' not found in FunctionNode.`)}return`${s.build(t,"property")}( ${e.join(", ")} )`}}const u4=(r,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?Vn(t):Ca(t[0]),z(new Vf(z(r),t)));U("call",u4);class Gt extends te{static get type(){return"OperatorNode"}constructor(t,e,s,...i){if(super(),i.length>0){let n=new Gt(t,e,s);for(let o=0;o<i.length-1;o++)n=new Gt(t,n,i[o]);e=n,s=i[i.length-1]}this.op=t,this.aNode=e,this.bNode=s}getNodeType(t,e){const s=this.op,i=this.aNode,n=this.bNode,o=i.getNodeType(t),a=typeof n<"u"?n.getNodeType(t):null;if(o==="void"||a==="void")return"void";if(s==="%")return o;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return t.getIntegerType(o);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=e?t.getTypeLength(e):Math.max(t.getTypeLength(o),t.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return o==="float"&&t.isMatrix(a)?a:t.isMatrix(o)&&t.isVector(a)?t.getVectorFromMatrix(o):t.isVector(o)&&t.isMatrix(a)?t.getVectorFromMatrix(a):t.getTypeLength(a)>t.getTypeLength(o)?a:o}generate(t,e){const s=this.op,i=this.aNode,n=this.bNode,o=this.getNodeType(t,e);let a=null,c=null;o!=="void"?(a=i.getNodeType(t),c=typeof n<"u"?n.getNodeType(t):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?t.isVector(a)?c=a:a!==c&&(a=c="float"):s===">>"||s==="<<"?(a=o,c=t.changeComponentType(c,"uint")):t.isMatrix(a)&&t.isVector(c)?c=t.getVectorFromMatrix(a):t.isVector(a)&&t.isMatrix(c)?a=t.getVectorFromMatrix(c):a=c=o):a=c=o;const l=i.build(t,a),u=typeof n<"u"?n.build(t,c):null,p=t.getTypeLength(e),h=t.getFunctionOperator(s);if(e!=="void")return s==="<"&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThan",e)}( ${l}, ${u} )`,o,e):t.format(`( ${l} < ${u} )`,o,e):s==="<="&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThanEqual",e)}( ${l}, ${u} )`,o,e):t.format(`( ${l} <= ${u} )`,o,e):s===">"&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThan",e)}( ${l}, ${u} )`,o,e):t.format(`( ${l} > ${u} )`,o,e):s===">="&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThanEqual",e)}( ${l}, ${u} )`,o,e):t.format(`( ${l} >= ${u} )`,o,e):s==="!"||s==="~"?t.format(`(${s}${l})`,a,e):h?t.format(`${h}( ${l}, ${u} )`,o,e):t.format(`( ${l} ${s} ${u} )`,o,e);if(a!=="void")return h?t.format(`${h}( ${l}, ${u} )`,o,e):t.format(`${l} ${s} ${u}`,o,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const ne=L(Gt,"+"),ft=L(Gt,"-"),it=L(Gt,"*"),Ls=L(Gt,"/"),bp=L(Gt,"%"),p4=L(Gt,"=="),h4=L(Gt,"!="),d4=L(Gt,"<"),wp=L(Gt,">"),g4=L(Gt,"<="),f4=L(Gt,">="),m4=L(Gt,"&&"),y4=L(Gt,"||"),x4=L(Gt,"!"),b4=L(Gt,"^^"),w4=L(Gt,"&"),_4=L(Gt,"~"),T4=L(Gt,"|"),S4=L(Gt,"^"),v4=L(Gt,"<<"),M4=L(Gt,">>");U("add",ne);U("sub",ft);U("mul",it);U("div",Ls);U("modInt",bp);U("equal",p4);U("notEqual",h4);U("lessThan",d4);U("greaterThan",wp);U("lessThanEqual",g4);U("greaterThanEqual",f4);U("and",m4);U("or",y4);U("not",x4);U("xor",b4);U("bitAnd",w4);U("bitNot",_4);U("bitOr",T4);U("bitXor",S4);U("shiftLeft",v4);U("shiftRight",M4);const A4=(...r)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),bp(...r));U("remainder",A4);class E extends te{static get type(){return"MathNode"}constructor(t,e,s=null,i=null){super(),this.method=t,this.aNode=e,this.bNode=s,this.cNode=i}getInputType(t){const e=this.aNode.getNodeType(t),s=this.bNode?this.bNode.getNodeType(t):null,i=this.cNode?this.cNode.getNodeType(t):null,n=t.isMatrix(e)?0:t.getTypeLength(e),o=t.isMatrix(s)?0:t.getTypeLength(s),a=t.isMatrix(i)?0:t.getTypeLength(i);return n>o&&n>a?e:o>a?s:a>n?i:e}getNodeType(t){const e=this.method;return e===E.LENGTH||e===E.DISTANCE||e===E.DOT?"float":e===E.CROSS?"vec3":e===E.ALL?"bool":e===E.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===E.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){const s=this.method,i=this.getNodeType(t),n=this.getInputType(t),o=this.aNode,a=this.bNode,c=this.cNode,l=t.renderer.isWebGLRenderer===!0;if(s===E.TRANSFORM_DIRECTION){let u=o,p=a;t.isMatrix(u.getNodeType(t))?p=X(F(p),0):u=X(F(u),0);const h=it(u,p).xyz;return Bi(h).build(t,e)}else{if(s===E.NEGATE)return t.format("( - "+o.build(t,n)+" )",i,e);if(s===E.ONE_MINUS)return ft(1,o).build(t,e);if(s===E.RECIPROCAL)return Ls(1,o).build(t,e);if(s===E.DIFFERENCE)return Ft(ft(o,a)).build(t,e);{const u=[];return s===E.CROSS||s===E.MOD?u.push(o.build(t,i),a.build(t,i)):l&&s===E.STEP?u.push(o.build(t,t.getTypeLength(o.getNodeType(t))===1?"float":n),a.build(t,n)):l&&(s===E.MIN||s===E.MAX)||s===E.MOD?u.push(o.build(t,n),a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":n)):s===E.REFRACT?u.push(o.build(t,n),a.build(t,n),c.build(t,"float")):s===E.MIX?u.push(o.build(t,n),a.build(t,n),c.build(t,t.getTypeLength(c.getNodeType(t))===1?"float":n)):(u.push(o.build(t,n)),a!==null&&u.push(a.build(t,n)),c!==null&&u.push(c.build(t,n))),t.format(`${t.getMethod(s,i)}( ${u.join(", ")} )`,i,e)}}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}E.ALL="all";E.ANY="any";E.EQUALS="equals";E.RADIANS="radians";E.DEGREES="degrees";E.EXP="exp";E.EXP2="exp2";E.LOG="log";E.LOG2="log2";E.SQRT="sqrt";E.INVERSE_SQRT="inversesqrt";E.FLOOR="floor";E.CEIL="ceil";E.NORMALIZE="normalize";E.FRACT="fract";E.SIN="sin";E.COS="cos";E.TAN="tan";E.ASIN="asin";E.ACOS="acos";E.ATAN="atan";E.ABS="abs";E.SIGN="sign";E.LENGTH="length";E.NEGATE="negate";E.ONE_MINUS="oneMinus";E.DFDX="dFdx";E.DFDY="dFdy";E.ROUND="round";E.RECIPROCAL="reciprocal";E.TRUNC="trunc";E.FWIDTH="fwidth";E.BITCAST="bitcast";E.TRANSPOSE="transpose";E.ATAN2="atan2";E.MIN="min";E.MAX="max";E.MOD="mod";E.STEP="step";E.REFLECT="reflect";E.DISTANCE="distance";E.DIFFERENCE="difference";E.DOT="dot";E.CROSS="cross";E.POW="pow";E.TRANSFORM_DIRECTION="transformDirection";E.MIX="mix";E.CLAMP="clamp";E.REFRACT="refract";E.SMOOTHSTEP="smoothstep";E.FACEFORWARD="faceforward";const N4=S(1e-6),kf=S(1e6),pc=S(Math.PI),Of=S(Math.PI*2),_p=L(E,E.ALL),C4=L(E,E.ANY),R4=L(E,E.EQUALS),F4=L(E,E.RADIANS),E4=L(E,E.DEGREES),Tp=L(E,E.EXP),ar=L(E,E.EXP2),kc=L(E,E.LOG),Js=L(E,E.LOG2),ci=L(E,E.SQRT),B4=L(E,E.INVERSE_SQRT),Qs=L(E,E.FLOOR),Oc=L(E,E.CEIL),Bi=L(E,E.NORMALIZE),Ii=L(E,E.FRACT),ls=L(E,E.SIN),bi=L(E,E.COS),D4=L(E,E.TAN),P4=L(E,E.ASIN),I4=L(E,E.ACOS),L4=L(E,E.ATAN),Ft=L(E,E.ABS),_a=L(E,E.SIGN),Ni=L(E,E.LENGTH),U4=L(E,E.NEGATE),z4=L(E,E.ONE_MINUS),Sp=L(E,E.DFDX),vp=L(E,E.DFDY),V4=L(E,E.ROUND),k4=L(E,E.RECIPROCAL),Mp=L(E,E.TRUNC),O4=L(E,E.FWIDTH),Gf=L(E,E.BITCAST),G4=L(E,E.TRANSPOSE),W4=L(E,E.ATAN2),Ke=L(E,E.MIN),Jt=L(E,E.MAX),Ap=L(E,E.MOD),Gc=L(E,E.STEP),$4=L(E,E.REFLECT),H4=L(E,E.DISTANCE),q4=L(E,E.DIFFERENCE),xn=L(E,E.DOT),Wc=L(E,E.CROSS),Fs=L(E,E.POW),Np=L(E,E.POW,2),Y4=L(E,E.POW,3),X4=L(E,E.POW,4),j4=L(E,E.TRANSFORM_DIRECTION),Z4=r=>it(_a(r),Fs(Ft(r),1/3)),K4=r=>xn(r,r),_t=L(E,E.MIX),ei=(r,t=0,e=1)=>z(new E(E.CLAMP,z(r),z(t),z(e))),J4=r=>ei(r),Cp=L(E,E.REFRACT),Di=L(E,E.SMOOTHSTEP),Q4=L(E,E.FACEFORWARD),t8=B(([r])=>{const s=43758.5453,i=xn(r.xy,k(12.9898,78.233)),n=Ap(i,pc);return Ii(ls(n).mul(s))}),e8=(r,t,e)=>_t(t,e,r),s8=(r,t,e)=>Di(t,e,r);U("all",_p);U("any",C4);U("equals",R4);U("radians",F4);U("degrees",E4);U("exp",Tp);U("exp2",ar);U("log",kc);U("log2",Js);U("sqrt",ci);U("inverseSqrt",B4);U("floor",Qs);U("ceil",Oc);U("normalize",Bi);U("fract",Ii);U("sin",ls);U("cos",bi);U("tan",D4);U("asin",P4);U("acos",I4);U("atan",L4);U("abs",Ft);U("sign",_a);U("length",Ni);U("lengthSq",K4);U("negate",U4);U("oneMinus",z4);U("dFdx",Sp);U("dFdy",vp);U("round",V4);U("reciprocal",k4);U("trunc",Mp);U("fwidth",O4);U("atan2",W4);U("min",Ke);U("max",Jt);U("mod",Ap);U("step",Gc);U("reflect",$4);U("distance",H4);U("dot",xn);U("cross",Wc);U("pow",Fs);U("pow2",Np);U("pow3",Y4);U("pow4",X4);U("transformDirection",j4);U("mix",e8);U("clamp",ei);U("refract",Cp);U("smoothstep",s8);U("faceForward",Q4);U("difference",q4);U("saturate",J4);U("cbrt",Z4);U("transpose",G4);U("rand",t8);class Wf extends Z{static get type(){return"ConditionalNode"}constructor(t,e,s=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=s}getNodeType(t){const e=this.ifNode.getNodeType(t);if(this.elseNode!==null){const s=this.elseNode.getNodeType(t);if(t.getTypeLength(s)>t.getTypeLength(e))return s}return e}setup(t){const e=this.condNode.cache(),s=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,n=t.context.nodeBlock;t.getDataFromNode(s).parentNodeBlock=n,i!==null&&(t.getDataFromNode(i).parentNodeBlock=n);const o=t.getNodeProperties(this);o.condNode=e,o.ifNode=s.context({nodeBlock:s}),o.elseNode=i?i.context({nodeBlock:i}):null}generate(t,e){const s=this.getNodeType(t),i=t.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:n,ifNode:o,elseNode:a}=t.getNodeProperties(this),c=e!=="void",l=c?a4(s).build(t):"";i.nodeProperty=l;const u=n.build(t,"bool");t.addFlowCode(`
${t.tab}if ( ${u} ) {

`).addFlowTab();let p=o.build(t,s);if(p&&(c?p=l+" = "+p+";":p="return "+p+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+p+`

`+t.tab+"}"),a!==null){t.addFlowCode(` else {

`).addFlowTab();let h=a.build(t,s);h&&(c?h=l+" = "+h+";":h="return "+h+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+h+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(l,s,e)}}const Ce=L(Wf);U("select",Ce);const i8=(...r)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Ce(...r));U("cond",i8);class n8 extends Z{static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value});const s=this.node.build(t);return t.setContext(e),s}generate(t,e){const s=t.getContext();t.setContext({...t.context,...this.value});const i=this.node.build(t,e);return t.setContext(s),i}}const $c=L(n8),o8=(r,t)=>$c(r,{label:t});U("context",$c);U("label",o8);class r8 extends Z{static get type(){return"VarNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:s}=this,i=t.getVarFromNode(this,s,t.getVectorType(this.getNodeType(t))),n=t.getPropertyName(i),o=e.build(t,i.type);return t.addLineFlowCode(`${n} = ${o}`,this),n}}const a8=L(r8);U("toVar",(...r)=>a8(...r).append());const c8=r=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),a8(r));U("temp",c8);class $f extends Z{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let s=e.varying;if(s===void 0){const i=this.name,n=this.getNodeType(t);e.varying=s=t.getVaryingFromNode(this,i,n),e.node=this.node}return s.needsInterpolation||(s.needsInterpolation=t.shaderStage==="fragment"),s}setup(t){this.setupVarying(t)}analyze(t){return this.setupVarying(t),this.node.analyze(t)}generate(t){const e=t.getNodeProperties(this),s=this.setupVarying(t);if(e.propertyName===void 0){const i=this.getNodeType(t),n=t.getPropertyName(s,Q1.VERTEX);t.flowNodeFromShaderStage(Q1.VERTEX,this.node,i,n),e.propertyName=n}return t.getPropertyName(s)}}const es=L($f);U("varying",es);const l8=B(([r])=>{const t=r.mul(.9478672986).add(.0521327014).pow(2.4),e=r.mul(.0773993808),s=r.lessThanEqual(.04045);return _t(t,e,s)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),u8=B(([r])=>{const t=r.pow(.41666).mul(1.055).sub(.055),e=r.mul(12.92),s=r.lessThanEqual(.0031308);return _t(t,e,s)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),Fa="WorkingColorSpace",Rp="OutputColorSpace";class Ea extends te{static get type(){return"ColorSpaceNode"}constructor(t,e,s){super("vec4"),this.colorNode=t,this.source=e,this.target=s}resolveColorSpace(t,e){return e===Fa?ee.workingColorSpace:e===Rp?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,s=this.resolveColorSpace(t,this.source),i=this.resolveColorSpace(t,this.target);let n=e;return ee.enabled===!1||s===i||!s||!i||(ee.getTransfer(s)===qr&&(n=X(l8(n.rgb),n.a)),ee.getPrimaries(s)!==ee.getPrimaries(i)&&(n=X(ze(ee._getMatrix(new ts,s,i)).mul(n.rgb),n.a)),ee.getTransfer(i)===qr&&(n=X(u8(n.rgb),n.a))),n}}const p8=r=>z(new Ea(z(r),Fa,Rp)),h8=r=>z(new Ea(z(r),Rp,Fa)),d8=(r,t)=>z(new Ea(z(r),Fa,t)),Fp=(r,t)=>z(new Ea(z(r),t,Fa)),Hf=(r,t,e)=>z(new Ea(z(r),t,e));U("toOutputColorSpace",p8);U("toWorkingColorSpace",h8);U("workingToColorSpace",d8);U("colorSpaceToWorking",Fp);let qf=class extends no{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),s=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(e,s,i)}};class g8 extends Z{static get type(){return"ReferenceBaseNode"}constructor(t,e,s=null,i=null){super(),this.property=t,this.uniformType=e,this.object=s,this.count=i,this.properties=t.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=st.OBJECT}setGroup(t){return this.group=t,this}element(t){return z(new qf(this,z(t)))}setNodeType(t){const e=j(null,t).getSelf();this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let s=t[e[0]];for(let i=1;i<e.length;i++)s=s[e[i]];return s}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Yf=(r,t,e)=>z(new g8(r,t,e));class Xf extends g8{static get type(){return"RendererReferenceNode"}constructor(t,e,s=null){super(t,e,s),this.renderer=s,this.setGroup(Q)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const f8=(r,t,e)=>z(new Xf(r,t,e));class jf extends te{static get type(){return"ToneMappingNode"}constructor(t,e=y8,s=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=s}getCacheKey(){return I5(super.getCacheKey(),this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,s=this.toneMapping;if(s===Ko)return e;let i=null;const n=t.renderer.library.getToneMappingFunction(s);return n!==null?i=X(n(e.rgb,this.exposureNode),e.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),i=e),i}}const m8=(r,t,e)=>z(new jf(r,z(t),z(e))),y8=f8("toneMappingExposure","float");U("toneMapping",(r,t,e)=>m8(t,e,r));class Zf extends op{static get type(){return"BufferAttributeNode"}constructor(t,e=null,s=0,i=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=s,this.bufferOffset=i,this.usage=oc,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),s=this.value,i=t.getTypeLength(e),n=this.bufferStride||i,o=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new x5(s,n),c=new qu(a,i,o);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),s=t.getBufferAttributeFromNode(this,e),i=t.getPropertyName(s);let n=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=i,n=i):n=es(this).build(t,e),n}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const Ba=(r,t,e,s)=>z(new Zf(r,t,e,s)),x8=(r,t,e,s)=>Ba(r,t,e,s).setUsage(In),hc=(r,t,e,s)=>Ba(r,t,e,s).setInstanced(!0),ru=(r,t,e,s)=>x8(r,t,e,s).setInstanced(!0);U("toAttribute",r=>Ba(r.value));class Kf extends Z{static get type(){return"ComputeNode"}constructor(t,e,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=st.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let s=e[0];for(let i=1;i<e.length;i++)s*=e[i];this.dispatchCount=Math.ceil(t/s)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if(e==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s,this)}}}const b8=(r,t,e)=>z(new Kf(z(r),t,e));U("compute",b8);class Jf extends Z{static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){return this.node.getNodeType(t)}build(t,...e){const s=t.getCache(),i=t.getCacheFromNode(this,this.parent);t.setCache(i);const n=this.node.build(t,...e);return t.setCache(s),n}}const ea=(r,...t)=>z(new Jf(z(r),...t));U("cache",ea);class Qf extends Z{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const w8=L(Qf);U("bypass",w8);class _8 extends Z{static get type(){return"RemapNode"}constructor(t,e,s,i=S(0),n=S(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=s,this.outLowNode=i,this.outHighNode=n,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:s,outLowNode:i,outHighNode:n,doClamp:o}=this;let a=t.sub(e).div(s.sub(e));return o===!0&&(a=a.clamp()),a.mul(n.sub(i)).add(i)}}const T8=L(_8,null,null,{doClamp:!1}),S8=L(_8);U("remap",T8);U("remapClamp",S8);class v8 extends Z{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const s=this.getNodeType(t),i=this.snippet;if(s==="void")t.addLineFlowCode(i,this);else return t.format(`( ${i} )`,s,e)}}const pn=L(v8),M8=r=>(r?Ce(r,pn("discard")):pn("discard")).append(),tm=()=>pn("return").append();U("discard",M8);class em extends te{static get type(){return"RenderOutputNode"}constructor(t,e,s){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=s,this.isRenderOutput=!0}setup({context:t}){let e=this.colorNode||t.color;const s=(this.toneMapping!==null?this.toneMapping:t.toneMapping)||Ko,i=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||Yn;return s!==Ko&&(e=e.toneMapping(s)),i!==Yn&&i!==ee.workingColorSpace&&(e=e.workingToColorSpace(i)),e}}const A8=(r,t=null,e=null)=>z(new em(z(r),t,e));U("renderOutput",A8);function sm(r){console.warn("THREE.TSLBase: AddNodeElement has been removed in favor of tree-shaking. Trying add",r)}class N8 extends Z{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const s=this.getAttributeName(t);if(t.hasGeometryAttribute(s)){const i=t.geometry.getAttribute(s);e=t.getTypeFromAttribute(i)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),s=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const n=t.geometry.getAttribute(e),o=t.getTypeFromAttribute(n),a=t.getAttribute(e,o);return t.shaderStage==="vertex"?t.format(a.name,o,s):es(this).build(t,s)}else return console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(s)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const si=(r,t)=>z(new N8(r,t)),$t=r=>si("uv"+(r>0?r:""),"vec2");class im extends Z{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const s=this.textureNode.build(t,"property"),i=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${s}, ${i} )`,this.getNodeType(t),e)}}const Gn=L(im);class nm extends Ra{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=st.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,s=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(s&&s.width!==void 0){const{width:i,height:n}=s;this.value=Math.log2(Math.max(i,n))}}}const C8=L(nm);class ii extends Ra{static get type(){return"TextureNode"}constructor(t,e=null,s=null,i=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=s,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=st.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Ae?"uvec4":this.value.type===ke?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return $t(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=j(this.value.matrix)),this._matrixUniform.mul(F(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?st.FRAME:st.NONE,this}setupUV(t,e){const s=this.value;return t.isFlipY()&&(s.image instanceof ImageBitmap&&s.flipY===!0||s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(this.sampler?e=e.flipY():e=e.setY(N(Gn(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;let s=this.uvNode;(s===null||t.context.forceUVContext===!0)&&t.context.getUV&&(s=t.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(t,s);let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),e.uvNode=s,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateSnippet(t,e,s,i,n,o,a,c){const l=this.value;let u;return i?u=t.generateTextureLevel(l,e,s,i,o):n?u=t.generateTextureBias(l,e,s,n,o):c?u=t.generateTextureGrad(l,e,s,c,o):a?u=t.generateTextureCompare(l,e,s,a,o):this.sampler===!1?u=t.generateTextureLoad(l,e,s,o):u=t.generateTexture(l,e,s,o),u}generate(t,e){const s=t.getNodeProperties(this),i=this.value;if(!i||i.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const n=super.generate(t,"property");if(e==="sampler")return n+"_sampler";if(t.isReference(e))return n;{const o=t.getDataFromNode(this);let a=o.propertyName;if(a===void 0){const{uvNode:u,levelNode:p,biasNode:h,compareNode:d,depthNode:g,gradNode:f}=s,y=this.generateUV(t,u),x=p?p.build(t,"float"):null,b=h?h.build(t,"float"):null,w=g?g.build(t,"int"):null,_=d?d.build(t,"float"):null,T=f?[f[0].build(t,"vec2"),f[1].build(t,"vec2")]:null,M=t.getVarFromNode(this);a=t.getPropertyName(M);const A=this.generateSnippet(t,n,y,x,b,w,_,T);t.addLineFlowCode(`${a} = ${A}`,this),o.snippet=A,o.propertyName=a}let c=a;const l=this.getNodeType(t);return t.needsToWorkingColorSpace(i)&&(c=Fp(pn(c,l),i.colorSpace).setup(t).build(t,l)),t.format(c,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){const e=this.clone();return e.uvNode=z(t),e.referenceNode=this.getSelf(),z(e)}blur(t){const e=this.clone();return e.biasNode=z(t).mul(C8(e)),e.referenceNode=this.getSelf(),z(e)}level(t){const e=this.clone();return e.levelNode=z(t),e.referenceNode=this.getSelf(),z(e)}size(t){return Gn(this,t)}bias(t){const e=this.clone();return e.biasNode=z(t),e.referenceNode=this.getSelf(),z(e)}compare(t){const e=this.clone();return e.compareNode=z(t),e.referenceNode=this.getSelf(),z(e)}grad(t,e){const s=this.clone();return s.gradNode=[z(t),z(e)],s.referenceNode=this.getSelf(),z(s)}depth(t){const e=this.clone();return e.depthNode=z(t),e.referenceNode=this.getSelf(),z(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t}}const dt=L(ii),Zt=(...r)=>dt(...r).setSampler(!1),om=r=>(r.isNode===!0?r:dt(r)).convert("sampler"),Zi=j("float").label("cameraNear").setGroup(Q).onRenderUpdate(({camera:r})=>r.near),Ki=j("float").label("cameraFar").setGroup(Q).onRenderUpdate(({camera:r})=>r.far),hn=j("mat4").label("cameraProjectionMatrix").setGroup(Q).onRenderUpdate(({camera:r})=>r.projectionMatrix),rm=j("mat4").label("cameraProjectionMatrixInverse").setGroup(Q).onRenderUpdate(({camera:r})=>r.projectionMatrixInverse),ss=j("mat4").label("cameraViewMatrix").setGroup(Q).onRenderUpdate(({camera:r})=>r.matrixWorldInverse),am=j("mat4").label("cameraWorldMatrix").setGroup(Q).onRenderUpdate(({camera:r})=>r.matrixWorld),cm=j("mat3").label("cameraNormalMatrix").setGroup(Q).onRenderUpdate(({camera:r})=>r.normalMatrix),R8=j(new v).label("cameraPosition").setGroup(Q).onRenderUpdate(({camera:r},t)=>t.value.setFromMatrixPosition(r.matrixWorld));class bt extends Z{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=st.OBJECT,this._uniformNode=new Ra(null)}getNodeType(){const t=this.scope;if(t===bt.WORLD_MATRIX)return"mat4";if(t===bt.POSITION||t===bt.VIEW_POSITION||t===bt.DIRECTION||t===bt.SCALE)return"vec3"}update(t){const e=this.object3d,s=this._uniformNode,i=this.scope;if(i===bt.WORLD_MATRIX)s.value=e.matrixWorld;else if(i===bt.POSITION)s.value=s.value||new v,s.value.setFromMatrixPosition(e.matrixWorld);else if(i===bt.SCALE)s.value=s.value||new v,s.value.setFromMatrixScale(e.matrixWorld);else if(i===bt.DIRECTION)s.value=s.value||new v,e.getWorldDirection(s.value);else if(i===bt.VIEW_POSITION){const n=t.camera;s.value=s.value||new v,s.value.setFromMatrixPosition(e.matrixWorld),s.value.applyMatrix4(n.matrixWorldInverse)}}generate(t){const e=this.scope;return e===bt.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(e===bt.POSITION||e===bt.VIEW_POSITION||e===bt.DIRECTION||e===bt.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}bt.WORLD_MATRIX="worldMatrix";bt.POSITION="position";bt.SCALE="scale";bt.VIEW_POSITION="viewPosition";bt.DIRECTION="direction";const lm=L(bt,bt.DIRECTION),um=L(bt,bt.WORLD_MATRIX),F8=L(bt,bt.POSITION),pm=L(bt,bt.SCALE),hm=L(bt,bt.VIEW_POSITION);class ni extends bt{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const dm=G(ni,ni.DIRECTION),bs=G(ni,ni.WORLD_MATRIX),gm=G(ni,ni.POSITION),fm=G(ni,ni.SCALE),mm=G(ni,ni.VIEW_POSITION),E8=j(new ts).onObjectUpdate(({object:r},t)=>t.value.getNormalMatrix(r.matrixWorld)),ym=j(new pt).onObjectUpdate(({object:r},t)=>t.value.copy(r.matrixWorld).invert()),oo=ss.mul(bs).toVar("modelViewMatrix"),xm=B(r=>(r.context.isHighPrecisionModelViewMatrix=!0,j("mat4").onObjectUpdate(({object:t,camera:e})=>t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld)))).once()().toVar("highPrecisionModelViewMatrix"),bm=B(r=>{const t=r.context.isHighPrecisionModelViewMatrix;return j("mat3").onObjectUpdate(({object:e,camera:s})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highPrecisionModelNormalMatrix"),Ep=si("position","vec3"),Xt=Ep.varying("positionLocal"),dc=Ep.varying("positionPrevious"),Ci=bs.mul(Xt).xyz.varying("v_positionWorld"),Bp=Xt.transformDirection(bs).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),le=oo.mul(Xt).xyz.varying("v_positionView"),zt=le.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class wm extends Z{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:s}=t;return e.coordinateSystem===Rs&&s.side===je?"false":t.getFrontFacing()}}const B8=G(wm),Da=S(B8).mul(2).sub(1),Hc=si("normal","vec3"),Je=B(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),F(0,1,0)):Hc,"vec3").once()().toVar("normalLocal"),D8=le.dFdx().cross(le.dFdy()).normalize().toVar("normalFlat"),_s=B(r=>{let t;return r.material.flatShading===!0?t=D8:t=es(Dp(Je),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),qc=es(_s.transformDirection(ss),"v_normalWorld").normalize().toVar("normalWorld"),Kt=B(r=>r.context.setupNormal(),"vec3").once()().mul(Da).toVar("transformedNormalView"),Yc=Kt.transformDirection(ss).toVar("transformedNormalWorld"),Yo=B(r=>r.context.setupClearcoatNormal(),"vec3").once()().mul(Da).toVar("transformedClearcoatNormalView"),P8=B(([r,t=bs])=>{const e=ze(t),s=r.div(F(e[0].dot(e[0]),e[1].dot(e[1]),e[2].dot(e[2])));return e.mul(s).xyz}),Dp=B(([r],t)=>{const e=t.renderer.nodes.modelNormalViewMatrix;if(e!==null)return e.transformDirection(r);const s=E8.mul(r);return ss.transformDirection(s)}),I8=j(0).onReference(({material:r})=>r).onRenderUpdate(({material:r})=>r.refractionRatio),L8=zt.negate().reflect(Kt),U8=zt.negate().refract(Kt,I8),z8=L8.transformDirection(ss).toVar("reflectVector"),V8=U8.transformDirection(ss).toVar("reflectVector");class _m extends ii{static get type(){return"CubeTextureNode"}constructor(t,e=null,s=null,i=null){super(t,e,s,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===qn?z8:t.mapping===ir?V8:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',t.mapping),F(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const s=this.value;return t.renderer.coordinateSystem===Fi||!s.isRenderTargetTexture?F(e.x.negate(),e.yz):e}generateUV(t,e){return e.build(t,"vec3")}}const cr=L(_m);class Pp extends Ra{static get type(){return"BufferNode"}constructor(t,e,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=s}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const Pa=(r,t,e)=>z(new Pp(r,t,e));class Tm extends no{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),s=this.getNodeType();return t.format(e,"vec4",s)}}class k8 extends Pp{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null,"vec4"),this.array=t,this.elementType=e,this._elementType=null,this._elementLength=0,this.updateType=st.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:t,value:e}=this,s=this.getElementLength(),i=this.getElementType();if(s===1)for(let n=0;n<t.length;n++){const o=n*4;e[o]=t[n]}else if(i==="color")for(let n=0;n<t.length;n++){const o=n*4,a=t[n];e[o]=a.r,e[o+1]=a.g,e[o+2]=a.b||0}else for(let n=0;n<t.length;n++){const o=n*4,a=t[n];e[o]=a.x,e[o+1]=a.y,e[o+2]=a.z||0,e[o+3]=a.w||0}}setup(t){const e=this.array.length;this._elementType=this.elementType===null?tn(this.array[0]):this.elementType,this._elementLength=t.getTypeLength(this._elementType);let s=Float32Array;return this._elementType.charAt(0)==="i"?s=Int32Array:this._elementType.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(e*4),this.bufferCount=e,this.bufferType=t.changeComponentType("vec4",t.getComponentType(this._elementType)),super.setup(t)}element(t){return z(new Tm(this,z(t)))}}const Ti=(r,t)=>z(new k8(r,t)),Sm=(r,t)=>(console.warn("TSL.UniformArrayNode: uniforms() has been renamed to uniformArray()."),z(new k8(r,t)));class vm extends no{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),s=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(e,s,i)}}class Xc extends Z{static get type(){return"ReferenceNode"}constructor(t,e,s=null,i=null){super(),this.property=t,this.uniformType=e,this.object=s,this.count=i,this.properties=t.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=st.OBJECT}element(t){return z(new vm(this,z(t)))}setGroup(t){return this.group=t,this}label(t){return this.name=t,this}setNodeType(t){let e=null;this.count!==null?e=Pa(null,t,this.count):Array.isArray(this.getValueFromReference())?e=Ti(null,t):t==="texture"?e=dt(null):t==="cubeTexture"?e=cr(null):e=j(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.label(this.name),this.node=e.getSelf()}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let s=t[e[0]];for(let i=1;i<e.length;i++)s=s[e[i]];return s}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Mt=(r,t,e)=>z(new Xc(r,t,e)),au=(r,t,e,s)=>z(new Xc(r,t,s,e));class Mm extends Xc{static get type(){return"MaterialReferenceNode"}constructor(t,e,s=null){super(t,e,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const Si=(r,t,e)=>z(new Mm(r,t,e)),jc=B(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),si("tangent","vec4")))(),Ia=jc.xyz.toVar("tangentLocal"),La=oo.mul(X(Ia,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),O8=La.transformDirection(ss).varying("v_tangentWorld").normalize().toVar("tangentWorld"),Ip=La.toVar("transformedTangentView"),Am=Ip.transformDirection(ss).normalize().toVar("transformedTangentWorld"),Ua=r=>r.mul(jc.w).xyz,Nm=es(Ua(Hc.cross(jc)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),Cm=es(Ua(Je.cross(Ia)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),G8=es(Ua(_s.cross(La)),"v_bitangentView").normalize().toVar("bitangentView"),Rm=es(Ua(qc.cross(O8)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),W8=Ua(Kt.cross(Ip)).normalize().toVar("transformedBitangentView"),Fm=W8.transformDirection(ss).normalize().toVar("transformedBitangentWorld"),Un=ze(La,G8,_s),$8=zt.mul(Un),Em=(r,t)=>r.sub($8.mul(t)),H8=(()=>{let r=On.cross(zt);return r=r.cross(On).normalize(),r=_t(r,Kt,Yi.mul(Xs.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),Bm=B(r=>{const{eye_pos:t,surf_norm:e,mapN:s,uv:i}=r,n=t.dFdx(),o=t.dFdy(),a=i.dFdx(),c=i.dFdy(),l=e,u=o.cross(l),p=l.cross(n),h=u.mul(a.x).add(p.mul(c.x)),d=u.mul(a.y).add(p.mul(c.y)),g=h.dot(h).max(d.dot(d)),f=Da.mul(g.inverseSqrt());return ne(h.mul(s.x,f),d.mul(s.y,f),l.mul(s.z)).normalize()});class Dm extends te{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=cn}setup(t){const{normalMapType:e,scaleNode:s}=this;let i=this.node.mul(2).sub(1);s!==null&&(i=F(i.xy.mul(s),i.z));let n=null;return e===pd?n=Dp(i):e===cn&&(t.hasGeometryAttribute("tangent")===!0?n=Un.mul(i).normalize():n=Bm({eye_pos:le,surf_norm:_s,mapN:i,uv:$t()})),n}}const cu=L(Dm),Pm=B(({textureNode:r,bumpScale:t})=>{const e=i=>r.cache().context({getUV:n=>i(n.uvNode||$t()),forceUVContext:!0}),s=S(e(i=>i));return k(S(e(i=>i.add(i.dFdx()))).sub(s),S(e(i=>i.add(i.dFdy()))).sub(s)).mul(t)}),Im=B(r=>{const{surf_pos:t,surf_norm:e,dHdxy:s}=r,i=t.dFdx().normalize(),n=t.dFdy().normalize(),o=e,a=n.cross(o),c=o.cross(i),l=i.dot(a).mul(Da),u=l.sign().mul(s.x.mul(a).add(s.y.mul(c)));return l.abs().mul(e).sub(u).normalize()});class Lm extends te{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=Pm({textureNode:this.textureNode,bumpScale:t});return Im({surf_pos:le,surf_norm:_s,dHdxy:e})}}const q8=L(Lm),ch=new Map;class I extends Z{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let s=ch.get(t);return s===void 0&&(s=Si(t,e),ch.set(t,s)),s}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,s=this.scope;let i=null;if(s===I.COLOR){const n=e.color!==void 0?this.getColor(s):F();e.map&&e.map.isTexture===!0?i=n.mul(this.getTexture("map")):i=n}else if(s===I.OPACITY){const n=this.getFloat(s);e.alphaMap&&e.alphaMap.isTexture===!0?i=n.mul(this.getTexture("alpha")):i=n}else if(s===I.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=S(1);else if(s===I.SPECULAR_INTENSITY){const n=this.getFloat(s);e.specularMap?i=n.mul(this.getTexture(s).a):i=n}else if(s===I.SPECULAR_COLOR){const n=this.getColor(s);e.specularColorMap&&e.specularColorMap.isTexture===!0?i=n.mul(this.getTexture(s).rgb):i=n}else if(s===I.ROUGHNESS){const n=this.getFloat(s);e.roughnessMap&&e.roughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).g):i=n}else if(s===I.METALNESS){const n=this.getFloat(s);e.metalnessMap&&e.metalnessMap.isTexture===!0?i=n.mul(this.getTexture(s).b):i=n}else if(s===I.EMISSIVE){const n=this.getFloat("emissiveIntensity"),o=this.getColor(s).mul(n);e.emissiveMap&&e.emissiveMap.isTexture===!0?i=o.mul(this.getTexture(s)):i=o}else if(s===I.NORMAL)e.normalMap?(i=cu(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=e.normalMapType):e.bumpMap?i=q8(this.getTexture("bump").r,this.getFloat("bumpScale")):i=_s;else if(s===I.CLEARCOAT){const n=this.getFloat(s);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.CLEARCOAT_ROUGHNESS){const n=this.getFloat(s);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.CLEARCOAT_NORMAL)e.clearcoatNormalMap?i=cu(this.getTexture(s),this.getCache(s+"Scale","vec2")):i=_s;else if(s===I.SHEEN){const n=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?i=n.mul(this.getTexture("sheenColor").rgb):i=n}else if(s===I.SHEEN_ROUGHNESS){const n=this.getFloat(s);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).a):i=n,i=i.clamp(.07,1)}else if(s===I.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const n=this.getTexture(s);i=Uc(Vo.x,Vo.y,Vo.y.negate(),Vo.x).mul(n.rg.mul(2).sub(k(1)).normalize().mul(n.b))}else i=Vo;else if(s===I.IRIDESCENCE_THICKNESS){const n=Mt("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const o=Mt("0","float",e.iridescenceThicknessRange);i=n.sub(o).mul(this.getTexture(s).g).add(o)}else i=n}else if(s===I.TRANSMISSION){const n=this.getFloat(s);e.transmissionMap?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.THICKNESS){const n=this.getFloat(s);e.thicknessMap?i=n.mul(this.getTexture(s).g):i=n}else if(s===I.IOR)i=this.getFloat(s);else if(s===I.LIGHT_MAP)i=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===I.AO_MAP)i=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const n=this.getNodeType(t);i=this.getCache(s,n)}return i}}I.ALPHA_TEST="alphaTest";I.COLOR="color";I.OPACITY="opacity";I.SHININESS="shininess";I.SPECULAR="specular";I.SPECULAR_STRENGTH="specularStrength";I.SPECULAR_INTENSITY="specularIntensity";I.SPECULAR_COLOR="specularColor";I.REFLECTIVITY="reflectivity";I.ROUGHNESS="roughness";I.METALNESS="metalness";I.NORMAL="normal";I.CLEARCOAT="clearcoat";I.CLEARCOAT_ROUGHNESS="clearcoatRoughness";I.CLEARCOAT_NORMAL="clearcoatNormal";I.EMISSIVE="emissive";I.ROTATION="rotation";I.SHEEN="sheen";I.SHEEN_ROUGHNESS="sheenRoughness";I.ANISOTROPY="anisotropy";I.IRIDESCENCE="iridescence";I.IRIDESCENCE_IOR="iridescenceIOR";I.IRIDESCENCE_THICKNESS="iridescenceThickness";I.IOR="ior";I.TRANSMISSION="transmission";I.THICKNESS="thickness";I.ATTENUATION_DISTANCE="attenuationDistance";I.ATTENUATION_COLOR="attenuationColor";I.LINE_SCALE="scale";I.LINE_DASH_SIZE="dashSize";I.LINE_GAP_SIZE="gapSize";I.LINE_WIDTH="linewidth";I.LINE_DASH_OFFSET="dashOffset";I.POINT_WIDTH="pointWidth";I.DISPERSION="dispersion";I.LIGHT_MAP="light";I.AO_MAP="ao";const Y8=G(I,I.ALPHA_TEST),X8=G(I,I.COLOR),j8=G(I,I.SHININESS),Z8=G(I,I.EMISSIVE),Lp=G(I,I.OPACITY),K8=G(I,I.SPECULAR),lu=G(I,I.SPECULAR_INTENSITY),J8=G(I,I.SPECULAR_COLOR),sa=G(I,I.SPECULAR_STRENGTH),G0=G(I,I.REFLECTIVITY),Q8=G(I,I.ROUGHNESS),t6=G(I,I.METALNESS),e6=G(I,I.NORMAL).context({getUV:null}),s6=G(I,I.CLEARCOAT),i6=G(I,I.CLEARCOAT_ROUGHNESS),n6=G(I,I.CLEARCOAT_NORMAL).context({getUV:null}),o6=G(I,I.ROTATION),r6=G(I,I.SHEEN),a6=G(I,I.SHEEN_ROUGHNESS),c6=G(I,I.ANISOTROPY),l6=G(I,I.IRIDESCENCE),u6=G(I,I.IRIDESCENCE_IOR),p6=G(I,I.IRIDESCENCE_THICKNESS),h6=G(I,I.TRANSMISSION),d6=G(I,I.THICKNESS),g6=G(I,I.IOR),f6=G(I,I.ATTENUATION_DISTANCE),m6=G(I,I.ATTENUATION_COLOR),y6=G(I,I.LINE_SCALE),x6=G(I,I.LINE_DASH_SIZE),b6=G(I,I.LINE_GAP_SIZE),Um=G(I,I.LINE_WIDTH),w6=G(I,I.LINE_DASH_OFFSET),zm=G(I,I.POINT_WIDTH),_6=G(I,I.DISPERSION),Up=G(I,I.LIGHT_MAP),T6=G(I,I.AO_MAP),Vo=j(new q).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))});class Vm extends te{static get type(){return"ModelViewProjectionNode"}constructor(t=null){super("vec4"),this.positionNode=t}setup(t){if(t.shaderStage==="fragment")return es(t.context.mvp);const e=this.positionNode||Xt,s=t.renderer.nodes.modelViewMatrix||oo;return hn.mul(s).mul(e)}}const zp=L(Vm);class Vt extends Z{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isInstanceIndexNode=!0}generate(t){const e=this.getNodeType(t),s=this.scope;let i;if(s===Vt.VERTEX)i=t.getVertexIndex();else if(s===Vt.INSTANCE)i=t.getInstanceIndex();else if(s===Vt.DRAW)i=t.getDrawIndex();else if(s===Vt.INVOCATION_LOCAL)i=t.getInvocationLocalIndex();else if(s===Vt.INVOCATION_SUBGROUP)i=t.getInvocationSubgroupIndex();else if(s===Vt.SUBGROUP)i=t.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let n;return t.shaderStage==="vertex"||t.shaderStage==="compute"?n=i:n=es(this).build(t,e),n}}Vt.VERTEX="vertex";Vt.INSTANCE="instance";Vt.SUBGROUP="subgroup";Vt.INVOCATION_LOCAL="invocationLocal";Vt.INVOCATION_SUBGROUP="invocationSubgroup";Vt.DRAW="draw";const S6=G(Vt,Vt.VERTEX),za=G(Vt,Vt.INSTANCE),km=G(Vt,Vt.SUBGROUP),Om=G(Vt,Vt.INVOCATION_SUBGROUP),Gm=G(Vt,Vt.INVOCATION_LOCAL),v6=G(Vt,Vt.DRAW);class M6 extends Z{static get type(){return"InstanceNode"}constructor(t,e,s){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=s,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=st.FRAME,this.buffer=null,this.bufferColor=null}setup(t){const{count:e,instanceMatrix:s,instanceColor:i}=this;let{instanceMatrixNode:n,instanceColorNode:o}=this;if(n===null){if(e<=1e3)n=Pa(s.array,"mat4",Math.max(e,1)).element(za);else{const c=new pf(s.array,16,1);this.buffer=c;const l=s.usage===In?ru:hc,u=[l(c,"vec4",16,0),l(c,"vec4",16,4),l(c,"vec4",16,8),l(c,"vec4",16,12)];n=kn(...u)}this.instanceMatrixNode=n}if(i&&o===null){const c=new la(i.array,3),l=i.usage===In?ru:hc;this.bufferColor=c,o=F(l(c,"vec3",3,0)),this.instanceColorNode=o}const a=n.mul(Xt).xyz;if(Xt.assign(a),t.hasGeometryAttribute("normal")){const c=P8(Je,n);Je.assign(c)}this.instanceColorNode!==null&&ya("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==In&&this.buffer!=null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==In&&this.bufferColor!=null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}const Wm=L(M6);class $m extends M6{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:s,instanceColor:i}=t;super(e,s,i),this.instanceMesh=t}}const A6=L($m);class Hm extends Z{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(t.getDrawIndex()===null?this.batchingIdNode=za:this.batchingIdNode=v6);const s=B(([g])=>{const f=Gn(Zt(this.batchMesh._indirectTexture),0),y=N(g).modInt(N(f)),x=N(g).div(N(f));return Zt(this.batchMesh._indirectTexture,ge(y,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(N(this.batchingIdNode)),i=this.batchMesh._matricesTexture,n=Gn(Zt(i),0),o=S(s).mul(4).toInt().toVar(),a=o.modInt(n),c=o.div(N(n)),l=kn(Zt(i,ge(a,c)),Zt(i,ge(a.add(1),c)),Zt(i,ge(a.add(2),c)),Zt(i,ge(a.add(3),c))),u=this.batchMesh._colorsTexture;if(u!==null){const f=B(([y])=>{const x=Gn(Zt(u),0).x,b=y,w=b.modInt(x),_=b.div(x);return Zt(u,ge(w,_)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(s);ya("vec3","vBatchColor").assign(f)}const p=ze(l);Xt.assign(l.mul(Xt));const h=Je.div(F(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),d=p.mul(h).xyz;Je.assign(d),t.hasGeometryAttribute("tangent")&&Ia.mulAssign(p)}}const N6=L(Hm),lh=new WeakMap;class C6 extends Z{static get type(){return"SkinningNode"}constructor(t,e=!1){super("void"),this.skinnedMesh=t,this.useReference=e,this.updateType=st.OBJECT,this.skinIndexNode=si("skinIndex","uvec4"),this.skinWeightNode=si("skinWeight","vec4");let s,i,n;e?(s=Mt("bindMatrix","mat4"),i=Mt("bindMatrixInverse","mat4"),n=au("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(s=j(t.bindMatrix,"mat4"),i=j(t.bindMatrixInverse,"mat4"),n=Pa(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=i,this.boneMatricesNode=n,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=Xt){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:n,bindMatrixInverseNode:o}=this,a=t.element(s.x),c=t.element(s.y),l=t.element(s.z),u=t.element(s.w),p=n.mul(e),h=ne(a.mul(i.x).mul(p),c.mul(i.y).mul(p),l.mul(i.z).mul(p),u.mul(i.w).mul(p));return o.mul(h).xyz}getSkinnedNormal(t=this.boneMatricesNode,e=Je){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:n,bindMatrixInverseNode:o}=this,a=t.element(s.x),c=t.element(s.y),l=t.element(s.z),u=t.element(s.w);let p=ne(i.x.mul(a),i.y.mul(c),i.z.mul(l),i.w.mul(u));return p=o.mul(p).mul(n),p.transformDirection(e).xyz}getPreviousSkinnedPosition(t){const e=t.object;return this.previousBoneMatricesNode===null&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=au("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,dc)}needsPreviousBoneMatrices(t){const e=t.renderer.getMRT();return e&&e.has("velocity")}setup(t){this.needsPreviousBoneMatrices(t)&&dc.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(Xt.assign(e),t.hasGeometryAttribute("normal")){const s=this.getSkinnedNormal();Je.assign(s),t.hasGeometryAttribute("tangent")&&Ia.assign(s)}}generate(t,e){if(e!=="void")return Xt.build(t,e)}update(t){const s=(this.useReference?t.object:this.skinnedMesh).skeleton;lh.get(s)!==t.frameId&&(lh.set(s,t.frameId),this.previousBoneMatricesNode!==null&&s.previousBoneMatrices.set(s.boneMatrices),s.update())}}const qm=r=>z(new C6(r)),R6=r=>z(new C6(r,!0));class Ym extends Z{static get type(){return"LoopNode"}constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const s={};for(let n=0,o=this.params.length-1;n<o;n++){const a=this.params[n],c=a.isNode!==!0&&a.name||this.getVarName(n),l=a.isNode!==!0&&a.type||"int";s[c]=pn(c,l)}const i=t.addStack();return e.returnsNode=this.params[this.params.length-1](s,i,t),e.stackNode=i,t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),s=this.params,i=e.stackNode;for(let a=0,c=s.length-1;a<c;a++){const l=s[a];let u=null,p=null,h=null,d=null,g=null,f=null;l.isNode?(d="int",h=this.getVarName(a),u="0",p=l.build(t,d),g="<"):(d=l.type||"int",h=l.name||this.getVarName(a),u=l.start,p=l.end,g=l.condition,f=l.update,typeof u=="number"?u=t.generateConst(d,u):u&&u.isNode&&(u=u.build(t,d)),typeof p=="number"?p=t.generateConst(d,p):p&&p.isNode&&(p=p.build(t,d)),u!==void 0&&p===void 0?(u=u+" - 1",p="0",g=">="):p!==void 0&&u===void 0&&(u="0",g="<"),g===void 0&&(Number(u)>Number(p)?g=">=":g="<"));const y={start:u,end:p},x=y.start,b=y.end;let w="",_="",T="";f||(d==="int"||d==="uint"?g.includes("<")?f="++":f="--":g.includes("<")?f="+= 1.":f="-= 1."),w+=t.getVar(d,h)+" = "+x,_+=h+" "+g+" "+b,T+=h+" "+f;const M=`for ( ${w}; ${_}; ${T} )`;t.addFlowCode((a===0?`
`:"")+t.tab+M+` {

`).addFlowTab()}const n=i.build(t,"void"),o=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode(`
`+t.tab+n);for(let a=0,c=this.params.length-1;a<c;a++)t.addFlowCode((a===0?"":t.tab)+`}

`).removeFlowTab();return t.addFlowTab(),o}}const St=(...r)=>z(new Ym(Vn(r,"int"))).append(),Xm=()=>pn("continue").append(),F6=()=>pn("break").append(),jm=(...r)=>(console.warn("TSL.LoopNode: loop() has been renamed to Loop()."),St(...r)),Il=new WeakMap,rs=new yt,uh=B(({bufferMap:r,influence:t,stride:e,width:s,depth:i,offset:n})=>{const o=N(S6).mul(e).add(n),a=o.div(s),c=o.sub(a.mul(s));return Zt(r,ge(c,a)).depth(i).mul(t)});function Zm(r){const t=r.morphAttributes.position!==void 0,e=r.morphAttributes.normal!==void 0,s=r.morphAttributes.color!==void 0,i=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,n=i!==void 0?i.length:0;let o=Il.get(r);if(o===void 0||o.count!==n){let x=function(){f.dispose(),Il.delete(r),r.removeEventListener("dispose",x)};o!==void 0&&o.texture.dispose();const a=r.morphAttributes.position||[],c=r.morphAttributes.normal||[],l=r.morphAttributes.color||[];let u=0;t===!0&&(u=1),e===!0&&(u=2),s===!0&&(u=3);let p=r.attributes.position.count*u,h=1;const d=4096;p>d&&(h=Math.ceil(p/d),p=d);const g=new Float32Array(p*h*4*n),f=new Zd(g,p,h,n);f.type=qe,f.needsUpdate=!0;const y=u*4;for(let b=0;b<n;b++){const w=a[b],_=c[b],T=l[b],M=p*h*4*b;for(let A=0;A<w.count;A++){const C=A*y;t===!0&&(rs.fromBufferAttribute(w,A),g[M+C+0]=rs.x,g[M+C+1]=rs.y,g[M+C+2]=rs.z,g[M+C+3]=0),e===!0&&(rs.fromBufferAttribute(_,A),g[M+C+4]=rs.x,g[M+C+5]=rs.y,g[M+C+6]=rs.z,g[M+C+7]=0),s===!0&&(rs.fromBufferAttribute(T,A),g[M+C+8]=rs.x,g[M+C+9]=rs.y,g[M+C+10]=rs.z,g[M+C+11]=T.itemSize===4?rs.w:1)}}o={count:n,texture:f,stride:u,size:new q(p,h)},Il.set(r,o),r.addEventListener("dispose",x)}return o}class Km extends Z{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=j(1),this.updateType=st.OBJECT}setup(t){const{geometry:e}=t,s=e.morphAttributes.position!==void 0,i=e.hasAttribute("normal")&&e.morphAttributes.normal!==void 0,n=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,o=n!==void 0?n.length:0,{texture:a,stride:c,size:l}=Zm(e);s===!0&&Xt.mulAssign(this.morphBaseInfluence),i===!0&&Je.mulAssign(this.morphBaseInfluence);const u=N(l.width);St(o,({i:p})=>{const h=S(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?h.assign(Zt(this.mesh.morphTexture,ge(N(p).add(1),N(za))).r):h.assign(Mt("morphTargetInfluences","float").element(p).toVar()),s===!0&&Xt.addAssign(uh({bufferMap:a,influence:h,stride:c,width:u,depth:p,offset:N(0)})),i===!0&&Je.addAssign(uh({bufferMap:a,influence:h,stride:c,width:u,depth:p,offset:N(1)}))})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,s)=>e+s,0)}}const E6=L(Km);class dr extends Z{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class Jm extends dr{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class Qm extends n8{static get type(){return"LightingContextNode"}constructor(t,e=null,s=null,i=null){super(t),this.lightingModel=e,this.backdropNode=s,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,s=F().toVar("directDiffuse"),i=F().toVar("directSpecular"),n=F().toVar("indirectDiffuse"),o=F().toVar("indirectSpecular"),a={directDiffuse:s,directSpecular:i,indirectDiffuse:n,indirectSpecular:o};return{radiance:F().toVar("radiance"),irradiance:F().toVar("irradiance"),iblIrradiance:F().toVar("iblIrradiance"),ambientOcclusion:S(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const B6=L(Qm);class ty extends dr{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}let Mr,Ar;class ce extends Z{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===ce.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=st.NONE;return(this.scope===ce.SIZE||this.scope===ce.VIEWPORT)&&(t=st.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===ce.VIEWPORT?e!==null?Ar.copy(e.viewport):(t.getViewport(Ar),Ar.multiplyScalar(t.getPixelRatio())):e!==null?(Mr.width=e.width,Mr.height=e.height):t.getDrawingBufferSize(Mr)}setup(){const t=this.scope;let e=null;return t===ce.SIZE?e=j(Mr||(Mr=new q)):t===ce.VIEWPORT?e=j(Ar||(Ar=new yt)):e=k(Va.div(Ta)),e}generate(t){if(this.scope===ce.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const s=t.getNodeProperties(Ta).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${s}.y - ${e}.y )`}return e}return super.generate(t)}}ce.COORDINATE="coordinate";ce.VIEWPORT="viewport";ce.SIZE="size";ce.UV="uv";const oi=G(ce,ce.UV),Ta=G(ce,ce.SIZE),Va=G(ce,ce.COORDINATE),Vp=G(ce,ce.VIEWPORT),D6=Vp.zw,P6=Va.sub(Vp.xy),ey=P6.div(D6),sy=B(()=>(console.warn('TSL.ViewportNode: "viewportResolution" is deprecated. Use "screenSize" instead.'),Ta),"vec2").once()(),iy=B(()=>(console.warn('TSL.ViewportNode: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),oi),"vec2").once()(),ny=B(()=>(console.warn('TSL.ViewportNode: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),oi.flipY()),"vec2").once()(),Nr=new q;class Zc extends ii{static get type(){return"ViewportTextureNode"}constructor(t=oi,e=null,s=null){s===null&&(s=new w5,s.minFilter=vi),super(s,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=st.FRAME}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(Nr);const s=this.value;(s.image.width!==Nr.width||s.image.height!==Nr.height)&&(s.image.width=Nr.width,s.image.height=Nr.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const oy=L(Zc),kp=L(Zc,null,null,{generateMipmaps:!0});let Ll=null;class ry extends Zc{static get type(){return"ViewportDepthTextureNode"}constructor(t=oi,e=null){Ll===null&&(Ll=new eo),super(t,e,Ll)}}const Op=L(ry);class Ye extends Z{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===Ye.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,s=this.valueNode;let i=null;if(e===Ye.DEPTH_BASE)s!==null&&(i=L6().assign(s));else if(e===Ye.DEPTH)t.isPerspectiveCamera?i=I6(le.z,Zi,Ki):i=tr(le.z,Zi,Ki);else if(e===Ye.LINEAR_DEPTH)if(s!==null)if(t.isPerspectiveCamera){const n=Gp(s,Zi,Ki);i=tr(n,Zi,Ki)}else i=s;else i=tr(le.z,Zi,Ki);return i}}Ye.DEPTH_BASE="depthBase";Ye.DEPTH="depth";Ye.LINEAR_DEPTH="linearDepth";const tr=(r,t,e)=>r.add(t).div(t.sub(e)),ay=(r,t,e)=>t.sub(e).mul(r).sub(t),I6=(r,t,e)=>t.add(r).mul(e).div(e.sub(t).mul(r)),Gp=(r,t,e)=>t.mul(e).div(e.sub(t).mul(r).sub(e)),Wp=(r,t,e)=>{t=t.max(1e-6).toVar();const s=Js(r.negate().div(t)),i=Js(e.div(t));return s.div(i)},cy=(r,t,e)=>{const s=r.mul(kc(e.div(t)));return S(Math.E).pow(s).mul(t).negate()},L6=L(Ye,Ye.DEPTH_BASE),$p=G(Ye,Ye.DEPTH),gc=L(Ye,Ye.LINEAR_DEPTH),ly=gc(Op());$p.assign=r=>L6(r);class uy extends Z{constructor(t){super("float"),this.name=t,this.isBuiltinNode=!0}generate(){return this.name}}const py=L(uy);class ws extends Z{static get type(){return"ClippingNode"}constructor(t=ws.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:s,unionPlanes:i}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===ws.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(s,i):this.scope===ws.HARDWARE?this.setupHardwareClipping(i,t):this.setupDefault(s,i)}setupAlphaToCoverage(t,e){return B(()=>{const s=S().toVar("distanceToPlane"),i=S().toVar("distanceToGradient"),n=S(1).toVar("clipOpacity"),o=e.length;if(!this.hardwareClipping&&o>0){const c=Ti(e);St(o,({i:l})=>{const u=c.element(l);s.assign(le.dot(u.xyz).negate().add(u.w)),i.assign(s.fwidth().div(2)),n.mulAssign(Di(i.negate(),i,s))})}const a=t.length;if(a>0){const c=Ti(t),l=S(1).toVar("intersectionClipOpacity");St(a,({i:u})=>{const p=c.element(u);s.assign(le.dot(p.xyz).negate().add(p.w)),i.assign(s.fwidth().div(2)),l.mulAssign(Di(i.negate(),i,s).oneMinus())}),n.mulAssign(l.oneMinus())}wt.a.mulAssign(n),wt.a.equal(0).discard()})()}setupDefault(t,e){return B(()=>{const s=e.length;if(!this.hardwareClipping&&s>0){const n=Ti(e);St(s,({i:o})=>{const a=n.element(o);le.dot(a.xyz).greaterThan(a.w).discard()})}const i=t.length;if(i>0){const n=Ti(t),o=Ei(!0).toVar("clipped");St(i,({i:a})=>{const c=n.element(a);o.assign(le.dot(c.xyz).greaterThan(c.w).and(o))}),o.discard()}})()}setupHardwareClipping(t,e){const s=t.length;return e.enableHardwareClipping(s),B(()=>{const i=Ti(t),n=py(e.getClipDistance());St(s,({i:o})=>{const a=i.element(o),c=le.dot(a.xyz).sub(a.w).negate();n.element(o).assign(c)})})()}}ws.ALPHA_TO_COVERAGE="alphaToCoverage";ws.DEFAULT="default";ws.HARDWARE="hardware";const hy=()=>z(new ws),dy=()=>z(new ws(ws.ALPHA_TO_COVERAGE)),gy=()=>z(new ws(ws.HARDWARE)),fy=.05,ph=B(([r])=>Ii(it(1e4,ls(it(17,r.x).add(it(.1,r.y)))).mul(ne(.1,Ft(ls(it(13,r.y).add(r.x))))))),hh=B(([r])=>ph(k(ph(r.xy),r.z))),my=B(([r])=>{const t=Jt(Ni(Sp(r.xyz)),Ni(vp(r.xyz))),e=S(1).div(S(fy).mul(t)).toVar("pixScale"),s=k(ar(Qs(Js(e))),ar(Oc(Js(e)))),i=k(hh(Qs(s.x.mul(r.xyz))),hh(Qs(s.y.mul(r.xyz)))),n=Ii(Js(e)),o=ne(it(n.oneMinus(),i.x),it(n,i.y)),a=Ke(n,n.oneMinus()),c=F(o.mul(o).div(it(2,a).mul(ft(1,a))),o.sub(it(.5,a)).div(ft(1,a)),ft(1,ft(1,o).mul(ft(1,o)).div(it(2,a).mul(ft(1,a))))),l=o.lessThan(a.oneMinus()).select(o.lessThan(a).select(c.x,c.y),c.z);return ei(l,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Qt extends Ze{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+L5(this)}build(t){this.setup(t)}setupObserver(t){return new gf(t)}setup(t){t.context.setupNormal=()=>this.setupNormal(t);const e=t.renderer,s=e.getRenderTarget();t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),this.geometryNode!==null&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();let i;const n=this.setupClipping(t);if(this.depthWrite===!0&&(s!==null?s.depthBuffer===!0&&this.setupDepth(t):e.depth===!0&&this.setupDepth(t)),this.fragmentNode===null){this.setupDiffuseColor(t),this.setupVariants(t);const o=this.setupLighting(t);n!==null&&t.stack.add(n);const a=X(o,wt.a).max(0);if(i=this.setupOutput(t,a),c4.assign(i),this.outputNode!==null&&(i=this.outputNode),s!==null){const c=e.getMRT(),l=this.mrtNode;c!==null?(i=c,l!==null&&(i=c.merge(l))):l!==null&&(i=l)}}else{let o=this.fragmentNode;o.isOutputStructNode!==!0&&(o=X(o)),i=this.setupOutput(t,o)}t.stack.outputNode=i,t.addFlow("fragment",t.removeStack()),t.monitor=this.setupObserver(t)}setupClipping(t){if(t.clippingContext===null)return null;const{unionPlanes:e,intersectionPlanes:s}=t.clippingContext;let i=null;if(e.length>0||s.length>0){const n=t.renderer.samples;this.alphaToCoverage&&n>1?i=dy():t.stack.add(hy())}return i}setupHardwareClipping(t){if(this.hardwareClipping=!1,t.clippingContext===null)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.add(gy()),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:s}=t;let i=this.depthNode;if(i===null){const n=e.getMRT();n&&n.has("depth")?i=n.get("depth"):e.logarithmicDepthBuffer===!0&&(s.isPerspectiveCamera?i=Wp(le.z,Zi,Ki):i=tr(le.z,Zi,Ki))}i!==null&&$p.assign(i).append()}setupPosition(t){const{object:e}=t,s=e.geometry;if(t.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&E6(e).append(),e.isSkinnedMesh===!0&&R6(e).append(),this.displacementMap){const n=Si("displacementMap","texture"),o=Si("displacementScale","float"),a=Si("displacementBias","float");Xt.addAssign(Je.normalize().mul(n.x.mul(o).add(a)))}e.isBatchedMesh&&N6(e).append(),e.isInstancedMesh&&e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&A6(e).append(),this.positionNode!==null&&Xt.assign(this.positionNode),this.setupHardwareClipping(t);const i=zp();return t.context.vertex=t.removeStack(),t.context.mvp=i,i}setupDiffuseColor({object:t,geometry:e}){let s=this.colorNode?X(this.colorNode):X8;this.vertexColors===!0&&e.hasAttribute("color")&&(s=X(s.xyz.mul(si("color","vec3")),s.a)),t.instanceColor&&(s=ya("vec3","vInstanceColor").mul(s)),t.isBatchedMesh&&t._colorsTexture&&(s=ya("vec3","vBatchColor").mul(s)),wt.assign(s);const i=this.opacityNode?S(this.opacityNode):Lp;if(wt.a.assign(wt.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const n=this.alphaTestNode!==null?S(this.alphaTestNode):Y8;wt.a.lessThanEqual(n).discard()}this.alphaHash===!0&&wt.a.lessThan(my(Xt)).discard(),this.transparent===!1&&this.blending===sn&&this.alphaToCoverage===!1&&wt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?F(0):wt.rgb}setupNormal(){return this.normalNode?F(this.normalNode):e6}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?Si("envMap","cubeTexture"):Si("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new ty(Up)),e}setupLights(t){const e=[],s=this.setupEnvironment(t);s&&s.isLightingNode&&e.push(s);const i=this.setupLightMap(t);if(i&&i.isLightingNode&&e.push(i),this.aoNode!==null||t.material.aoMap){const o=this.aoNode!==null?this.aoNode:T6;e.push(new Jm(o))}let n=this.lightsNode||t.lightsNode;return e.length>0&&(n=t.renderer.lighting.createNode([...n.getLights(),...e])),n}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:s,backdropAlphaNode:i,emissiveNode:n}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let c=this.setupOutgoingLight(t);if(a&&a.getScope().hasLights){const l=this.setupLightingModel(t);c=B6(a,l,s,i)}else s!==null&&(c=F(i!==null?_t(c,s,i):s));return(n&&n.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(nu.assign(F(n||Z8)),c=c.add(nu)),c}setupOutput(t,e){if(this.fog===!0){const s=t.fogNode;s&&(e=X(s.mix(e.rgb,s.colorNode),e.a))}return e}setDefaultValues(t){for(const s in t){const i=t[s];this[s]===void 0&&(this[s]=i,i&&i.clone&&(this[s]=i.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const s in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&e[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,e[s])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const s=Ze.prototype.toJSON.call(this,t),i=rc(this);s.inputNodes={};for(const{property:o,childNode:a}of i)s.inputNodes[o]=a.toJSON(t).uuid;function n(o){const a=[];for(const c in o){const l=o[c];delete l.metadata,a.push(l)}return a}if(e){const o=n(t.textures),a=n(t.images),c=n(t.nodes);o.length>0&&(s.textures=o),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.shadowPositionNode=t.shadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}}const yy=new b5;class xy extends Qt{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(yy),this.setValues(t)}}const by=new ef;class wy extends Qt{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(by),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode?S(this.offsetNodeNode):w6,e=this.dashScaleNode?S(this.dashScaleNode):y6,s=this.dashSizeNode?S(this.dashSizeNode):x6,i=this.dashSizeNode?S(this.dashGapNode):b6;O0.assign(s),ou.assign(i);const n=es(si("lineDistance").mul(e));(t?n.add(t):n).mod(O0.add(ou)).greaterThan(O0).discard()}}let Ul=null;class _y extends Zc{static get type(){return"ViewportSharedTextureNode"}constructor(t=oi,e=null){Ul===null&&(Ul=new w5),super(t,e,Ul)}updateReference(){return this}}const Ty=L(_y),U6=r=>z(r).mul(.5).add(.5),Sy=r=>z(r).mul(2).sub(1),vy=new Jg;class My extends Qt{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(vy),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?S(this.opacityNode):Lp;wt.assign(X(U6(Kt),t))}}class Ay extends te{static get type(){return"EquirectUVNode"}constructor(t=Bp){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan2(t.x).mul(1/(Math.PI*2)).add(.5),s=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return k(e,s)}}const Hp=L(Ay);class z6 extends dg{constructor(t=1,e={}){super(t,e),this.isCubeRenderTarget=!0}fromEquirectangularTexture(t,e){const s=e.minFilter,i=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n=new to(5,5,5),o=Hp(Bp),a=new Qt;a.colorNode=dt(e,o,0),a.side=je,a.blending=Hn;const c=new O(n,a),l=new Hu;l.add(c),e.minFilter===vi&&(e.minFilter=ps);const u=new y5(1,10,this),p=t.getMRT();return t.setMRT(null),u.update(t,l),t.setMRT(p),e.minFilter=s,e.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const ia=new WeakMap;class Ny extends te{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=cr();const e=new Gu;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=st.RENDER}updateBefore(t){const{renderer:e,material:s}=t,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const n=i.isTextureNode?i.value:s[i.property];if(n&&n.isTexture){const o=n.mapping;if(o===va||o===Ma){if(ia.has(n)){const a=ia.get(n);dh(a,n.mapping),this._cubeTexture=a}else{const a=n.image;if(Cy(a)){const c=new z6(a.height);c.fromEquirectangularTexture(e,n),dh(c.texture,n.mapping),this._cubeTexture=c.texture,ia.set(n,c.texture),n.addEventListener("dispose",V6)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function Cy(r){return r==null?!1:r.height>0}function V6(r){const t=r.target;t.removeEventListener("dispose",V6);const e=ia.get(t);e!==void 0&&(ia.delete(t),e.dispose())}function dh(r,t){t===va?r.mapping=qn:t===Ma&&(r.mapping=ir)}const k6=L(Ny);class qp extends dr{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=k6(this.envNode)}}class Ry extends dr{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=S(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class Kc{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class O6 extends Kc{constructor(){super()}indirect(t,e,s){const i=t.ambientOcclusion,n=t.reflectedLight,o=s.context.irradianceLightMap;n.indirectDiffuse.assign(X(0)),o?n.indirectDiffuse.addAssign(o):n.indirectDiffuse.addAssign(X(1,1,1,0)),n.indirectDiffuse.mulAssign(i),n.indirectDiffuse.mulAssign(wt.rgb)}finish(t,e,s){const i=s.material,n=t.outgoingLight,o=s.context.environment;if(o)switch(i.combine){case Fc:n.rgb.assign(_t(n.rgb,n.rgb.mul(o.rgb),sa.mul(G0)));break;case Z9:n.rgb.assign(_t(n.rgb,o.rgb,sa.mul(G0)));break;case K9:n.rgb.addAssign(o.rgb.mul(sa.mul(G0)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",i.combine);break}}}const Fy=new Ds;class Yp extends Qt{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Fy),this.setValues(t)}setupNormal(){return _s}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new qp(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new Ry(Up)),e}setupOutgoingLight(){return wt.rgb}setupLightingModel(){return new O6}}const lr=B(({f0:r,f90:t,dotVH:e})=>{const s=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return r.mul(s.oneMinus()).add(t.mul(s))}),jn=B(r=>r.diffuseColor.mul(1/Math.PI)),Ey=()=>S(.25),By=B(({dotNH:r})=>lc.mul(S(.5)).add(1).mul(S(1/Math.PI)).mul(r.pow(lc))),Dy=B(({lightDirection:r})=>{const t=r.add(zt).normalize(),e=Kt.dot(t).clamp(),s=zt.dot(t).clamp(),i=lr({f0:He,f90:1,dotVH:s}),n=Ey(),o=By({dotNH:e});return i.mul(n).mul(o)});class G6 extends O6{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const n=Kt.dot(t).clamp().mul(e);s.directDiffuse.addAssign(n.mul(jn({diffuseColor:wt.rgb}))),this.specular===!0&&s.directSpecular.addAssign(n.mul(Dy({lightDirection:t})).mul(sa))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:s}){s.indirectDiffuse.addAssign(e.mul(jn({diffuseColor:wt}))),s.indirectDiffuse.mulAssign(t)}}const Py=new Qg;class Iy extends Qt{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Py),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new qp(e):null}setupLightingModel(){return new G6(!1)}}const Ly=new Zg;class Uy extends Qt{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(Ly),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new qp(e):null}setupLightingModel(){return new G6}setupVariants(){const t=(this.shininessNode?S(this.shininessNode):j8).max(1e-4);lc.assign(t);const e=this.specularNode||K8;He.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const W6=B(r=>{if(r.geometry.hasAttribute("normal")===!1)return S(0);const t=_s.dFdx().abs().max(_s.dFdy().abs());return t.x.max(t.y).max(t.z)}),Xp=B(r=>{const{roughness:t}=r,e=W6();let s=t.max(.0525);return s=s.add(e),s=s.min(1),s}),$6=B(({alpha:r,dotNL:t,dotNV:e})=>{const s=r.pow2(),i=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt()),n=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt());return Ls(.5,i.add(n).max(N4))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),zy=B(({alphaT:r,alphaB:t,dotTV:e,dotBV:s,dotTL:i,dotBL:n,dotNV:o,dotNL:a})=>{const c=a.mul(F(r.mul(e),t.mul(s),o).length()),l=o.mul(F(r.mul(i),t.mul(n),a).length());return Ls(.5,c.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),H6=B(({alpha:r,dotNH:t})=>{const e=r.pow2(),s=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),Vy=S(1/Math.PI),ky=B(({alphaT:r,alphaB:t,dotNH:e,dotTH:s,dotBH:i})=>{const n=r.mul(t),o=F(t.mul(s),r.mul(i),n.mul(e)),a=o.dot(o),c=n.div(a);return Vy.mul(n.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),uu=B(r=>{const{lightDirection:t,f0:e,f90:s,roughness:i,f:n,USE_IRIDESCENCE:o,USE_ANISOTROPY:a}=r,c=r.normalView||Kt,l=i.pow2(),u=t.add(zt).normalize(),p=c.dot(t).clamp(),h=c.dot(zt).clamp(),d=c.dot(u).clamp(),g=zt.dot(u).clamp();let f=lr({f0:e,f90:s,dotVH:g}),y,x;if(fa(o)&&(f=Vc.mix(f,n)),fa(a)){const b=Qr.dot(t),w=Qr.dot(zt),_=Qr.dot(u),T=On.dot(t),M=On.dot(zt),A=On.dot(u);y=zy({alphaT:cc,alphaB:l,dotTV:w,dotBV:M,dotTL:b,dotBL:T,dotNV:h,dotNL:p}),x=ky({alphaT:cc,alphaB:l,dotNH:d,dotTH:_,dotBH:A})}else y=$6({alpha:l,dotNL:p,dotNV:h}),x=H6({alpha:l,dotNH:d});return f.mul(y).mul(x)}),jp=B(({roughness:r,dotNV:t})=>{const e=X(-1,-.0275,-.572,.022),s=X(1,.0425,1.04,-.04),i=r.mul(e).add(s),n=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return k(-1.04,1.04).mul(n).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),q6=B(r=>{const{dotNV:t,specularColor:e,specularF90:s,roughness:i}=r,n=jp({dotNV:t,roughness:i});return e.mul(n.x).add(s.mul(n.y))}),Y6=B(({f:r,f90:t,dotVH:e})=>{const s=e.oneMinus().saturate(),i=s.mul(s),n=s.mul(i,i).clamp(0,.9999);return r.sub(F(t).mul(n)).div(n.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),Oy=B(({roughness:r,dotNH:t})=>{const e=r.pow2(),s=S(1).div(e),n=t.pow2().oneMinus().max(.0078125);return S(2).add(s).mul(n.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),Gy=B(({dotNV:r,dotNL:t})=>S(1).div(S(4).mul(t.add(r).sub(t.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),Wy=B(({lightDirection:r})=>{const t=r.add(zt).normalize(),e=Kt.dot(r).clamp(),s=Kt.dot(zt).clamp(),i=Kt.dot(t).clamp(),n=Oy({roughness:zc,dotNH:i}),o=Gy({dotNV:s,dotNL:e});return Ln.mul(n).mul(o)}),$y=B(({N:r,V:t,roughness:e})=>{const n=.0078125,o=r.dot(t).saturate(),a=k(e,o.oneMinus().sqrt());return a.assign(a.mul(.984375).add(n)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),Hy=B(({f:r})=>{const t=r.length();return Jt(t.mul(t).add(r.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),g0=B(({v1:r,v2:t})=>{const e=r.dot(t),s=e.abs().toVar(),i=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),n=s.add(4.1616724).mul(s).add(3.417594).toVar(),o=i.div(n),a=e.greaterThan(0).select(o,Jt(e.mul(e).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(o));return r.cross(t).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),gh=B(({N:r,V:t,P:e,mInv:s,p0:i,p1:n,p2:o,p3:a})=>{const c=n.sub(i).toVar(),l=a.sub(i).toVar(),u=c.cross(l),p=F().toVar();return rt(u.dot(e.sub(i)).greaterThanEqual(0),()=>{const h=t.sub(r.mul(t.dot(r))).normalize(),d=r.cross(h).negate(),g=s.mul(ze(h,d,r).transpose()).toVar(),f=g.mul(i.sub(e)).normalize().toVar(),y=g.mul(n.sub(e)).normalize().toVar(),x=g.mul(o.sub(e)).normalize().toVar(),b=g.mul(a.sub(e)).normalize().toVar(),w=F(0).toVar();w.addAssign(g0({v1:f,v2:y})),w.addAssign(g0({v1:y,v2:x})),w.addAssign(g0({v1:x,v2:b})),w.addAssign(g0({v1:b,v2:f})),p.assign(F(Hy({f:w})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Jc=1/6,X6=r=>it(Jc,it(r,it(r,r.negate().add(3)).sub(3)).add(1)),pu=r=>it(Jc,it(r,it(r,it(3,r).sub(6))).add(4)),j6=r=>it(Jc,it(r,it(r,it(-3,r).add(3)).add(3)).add(1)),hu=r=>it(Jc,Fs(r,3)),fh=r=>X6(r).add(pu(r)),mh=r=>j6(r).add(hu(r)),yh=r=>ne(-1,pu(r).div(X6(r).add(pu(r)))),xh=r=>ne(1,hu(r).div(j6(r).add(hu(r)))),bh=(r,t,e)=>{const s=r.uvNode,i=it(s,t.zw).add(.5),n=Qs(i),o=Ii(i),a=fh(o.x),c=mh(o.x),l=yh(o.x),u=xh(o.x),p=yh(o.y),h=xh(o.y),d=k(n.x.add(l),n.y.add(p)).sub(.5).mul(t.xy),g=k(n.x.add(u),n.y.add(p)).sub(.5).mul(t.xy),f=k(n.x.add(l),n.y.add(h)).sub(.5).mul(t.xy),y=k(n.x.add(u),n.y.add(h)).sub(.5).mul(t.xy),x=fh(o.y).mul(ne(a.mul(r.uv(d).level(e)),c.mul(r.uv(g).level(e)))),b=mh(o.y).mul(ne(a.mul(r.uv(f).level(e)),c.mul(r.uv(y).level(e))));return x.add(b)},Z6=B(([r,t=S(3)])=>{const e=k(r.size(N(t))),s=k(r.size(N(t.add(1)))),i=Ls(1,e),n=Ls(1,s),o=bh(r,X(i,e),Qs(t)),a=bh(r,X(n,s),Oc(t));return Ii(t).mix(o,a)}),wh=B(([r,t,e,s,i])=>{const n=F(Cp(t.negate(),Bi(r),Ls(1,s))),o=F(Ni(i[0].xyz),Ni(i[1].xyz),Ni(i[2].xyz));return Bi(n).mul(e.mul(o))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),qy=B(([r,t])=>r.mul(ei(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),Yy=kp(),Xy=kp(),_h=B(([r,t,e],{material:s})=>{const n=(s.side==je?Yy:Xy).uv(r),o=Js(Ta.x).mul(qy(t,e));return Z6(n,o)}),Th=B(([r,t,e])=>(rt(e.notEqual(0),()=>{const s=kc(t).negate().div(e);return Tp(s.negate().mul(r))}),F(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),jy=B(([r,t,e,s,i,n,o,a,c,l,u,p,h,d,g])=>{let f,y;if(g){f=X().toVar(),y=F().toVar();const T=u.sub(1).mul(g.mul(.025)),M=F(u.sub(T),u,u.add(T));St({start:0,end:3},({i:A})=>{const C=M.element(A),P=wh(r,t,p,C,a),D=o.add(P),V=l.mul(c.mul(X(D,1))),$=k(V.xy.div(V.w)).toVar();$.addAssign(1),$.divAssign(2),$.assign(k($.x,$.y.oneMinus()));const Y=_h($,e,C);f.element(A).assign(Y.element(A)),f.a.addAssign(Y.a),y.element(A).assign(s.element(A).mul(Th(Ni(P),h,d).element(A)))}),f.a.divAssign(3)}else{const T=wh(r,t,p,u,a),M=o.add(T),A=l.mul(c.mul(X(M,1))),C=k(A.xy.div(A.w)).toVar();C.addAssign(1),C.divAssign(2),C.assign(k(C.x,C.y.oneMinus())),f=_h(C,e,u),y=s.mul(Th(Ni(T),h,d))}const x=y.rgb.mul(f.rgb),b=r.dot(t).clamp(),w=F(q6({dotNV:b,specularColor:i,specularF90:n,roughness:e})),_=y.r.add(y.g,y.b).div(3);return X(w.oneMinus().mul(x),f.a.oneMinus().mul(_).oneMinus())}),Zy=ze(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),Ky=r=>{const t=r.sqrt();return F(1).add(t).div(F(1).sub(t))},Sh=(r,t)=>r.sub(t).div(r.add(t)).pow2(),Jy=(r,t)=>{const e=r.mul(2*Math.PI*1e-9),s=F(54856e-17,44201e-17,52481e-17),i=F(1681e3,1795300,2208400),n=F(43278e5,93046e5,66121e5),o=S(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let a=s.mul(n.mul(2*Math.PI).sqrt()).mul(i.mul(e).add(t).cos()).mul(e.pow2().negate().mul(n).exp());return a=F(a.x.add(o),a.y,a.z).div(10685e-11),Zy.mul(a)},Qy=B(({outsideIOR:r,eta2:t,cosTheta1:e,thinFilmThickness:s,baseF0:i})=>{const n=_t(r,t,Di(0,.03,s)),a=r.div(n).pow2().mul(e.pow2().oneMinus()).oneMinus();rt(a.lessThan(0),()=>F(1));const c=a.sqrt(),l=Sh(n,r),u=lr({f0:l,f90:1,dotVH:e}),p=u.oneMinus(),h=n.lessThan(r).select(Math.PI,0),d=S(Math.PI).sub(h),g=Ky(i.clamp(0,.9999)),f=Sh(g,n.toVec3()),y=lr({f0:f,f90:1,dotVH:c}),x=F(g.x.lessThan(n).select(Math.PI,0),g.y.lessThan(n).select(Math.PI,0),g.z.lessThan(n).select(Math.PI,0)),b=n.mul(s,c,2),w=F(d).add(x),_=u.mul(y).clamp(1e-5,.9999),T=_.sqrt(),M=p.pow2().mul(y).div(F(1).sub(_)),C=u.add(M).toVar(),P=M.sub(p).toVar();return St({start:1,end:2,condition:"<=",name:"m"},({m:D})=>{P.mulAssign(T);const V=Jy(S(D).mul(b),S(D).mul(w)).mul(2);C.addAssign(P.mul(V))}),C.max(F(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),tx=B(({normal:r,viewDir:t,roughness:e})=>{const s=r.dot(t).saturate(),i=e.pow2(),n=Ce(e.lessThan(.25),S(-339.2).mul(i).add(S(161.4).mul(e)).sub(25.9),S(-8.48).mul(i).add(S(14.3).mul(e)).sub(9.95)),o=Ce(e.lessThan(.25),S(44).mul(i).sub(S(23.7).mul(e)).add(3.26),S(1.97).mul(i).sub(S(3.27).mul(e)).add(.72));return Ce(e.lessThan(.25),0,S(.1).mul(e).sub(.025)).add(n.mul(s).add(o).exp()).mul(1/Math.PI).saturate()}),zl=F(.04),Vl=S(1);class K6 extends Kc{constructor(t=!1,e=!1,s=!1,i=!1,n=!1,o=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=s,this.anisotropy=i,this.transmission=n,this.dispersion=o,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(t){if(this.clearcoat===!0&&(this.clearcoatRadiance=F().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=F().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=F().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=F().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=F().toVar("sheenSpecularIndirect")),this.iridescence===!0){const e=Kt.dot(zt).clamp();this.iridescenceFresnel=Qy({outsideIOR:S(1),eta2:dp,cosTheta1:e,thinFilmThickness:gp,baseF0:He}),this.iridescenceF0=Y6({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(this.transmission===!0){const e=Ci,s=R8.sub(Ci).normalize(),i=Yc;t.backdrop=jy(i,s,Xs,wt,He,wa,e,bs,ss,hn,ta,fp,yp,mp,this.dispersion?xp:null),t.backdropAlpha=uc,wt.a.mulAssign(_t(1,t.backdrop.a,uc))}}computeMultiscattering(t,e,s){const i=Kt.dot(zt).clamp(),n=jp({roughness:Xs,dotNV:i}),a=(this.iridescenceF0?Vc.mix(He,this.iridescenceF0):He).mul(n.x).add(s.mul(n.y)),l=n.x.add(n.y).oneMinus(),u=He.add(He.oneMinus().mul(.047619)),p=a.mul(u).div(l.mul(u).oneMinus());t.addAssign(a),e.addAssign(p.mul(l))}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const n=Kt.dot(t).clamp().mul(e);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(n.mul(Wy({lightDirection:t}))),this.clearcoat===!0){const a=Yo.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(a.mul(uu({lightDirection:t,f0:zl,f90:Vl,roughness:ba,normalView:Yo})))}s.directDiffuse.addAssign(n.mul(jn({diffuseColor:wt.rgb}))),s.directSpecular.addAssign(n.mul(uu({lightDirection:t,f0:He,f90:1,roughness:Xs,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:s,halfHeight:i,reflectedLight:n,ltc_1:o,ltc_2:a}){const c=e.add(s).sub(i),l=e.sub(s).sub(i),u=e.sub(s).add(i),p=e.add(s).add(i),h=Kt,d=zt,g=le.toVar(),f=$y({N:h,V:d,roughness:Xs}),y=o.uv(f).toVar(),x=a.uv(f).toVar(),b=ze(F(y.x,0,y.y),F(0,1,0),F(y.z,0,y.w)).toVar(),w=He.mul(x.x).add(He.oneMinus().mul(x.y)).toVar();n.directSpecular.addAssign(t.mul(w).mul(gh({N:h,V:d,P:g,mInv:b,p0:c,p1:l,p2:u,p3:p}))),n.directDiffuse.addAssign(t.mul(wt).mul(gh({N:h,V:d,P:g,mInv:ze(1,0,0,0,1,0,0,0,1),p0:c,p1:l,p2:u,p3:p})))}indirect(t,e,s){this.indirectDiffuse(t,e,s),this.indirectSpecular(t,e,s),this.ambientOcclusion(t,e,s)}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(jn({diffuseColor:wt})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(e.mul(Ln,tx({normal:Kt,viewDir:zt,roughness:zc}))),this.clearcoat===!0){const l=Yo.dot(zt).clamp(),u=q6({dotNV:l,specularColor:zl,specularF90:Vl,roughness:ba});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const i=F().toVar("singleScattering"),n=F().toVar("multiScattering"),o=e.mul(1/Math.PI);this.computeMultiscattering(i,n,wa);const a=i.add(n),c=wt.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(t.mul(i)),s.indirectSpecular.addAssign(n.mul(o)),s.indirectDiffuse.addAssign(c.mul(o))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const i=Kt.dot(zt).clamp().add(t),n=Xs.mul(-16).oneMinus().negate().exp2(),o=t.sub(i.pow(n).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(o)}finish(t){const{outgoingLight:e}=t;if(this.clearcoat===!0){const s=Yo.dot(zt).clamp(),i=lr({dotVH:s,f0:zl,f90:Vl}),n=e.mul(ac.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(ac));e.assign(n)}if(this.sheen===!0){const s=Ln.r.max(Ln.g).max(Ln.b).mul(.157).oneMinus(),i=e.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(i)}}}const vh=S(1),du=S(-2),f0=S(.8),kl=S(-1),m0=S(.4),Ol=S(2),y0=S(.305),Gl=S(3),Mh=S(.21),ex=S(4),Ah=S(4),sx=S(16),ix=B(([r])=>{const t=F(Ft(r)).toVar(),e=S(-1).toVar();return rt(t.x.greaterThan(t.z),()=>{rt(t.x.greaterThan(t.y),()=>{e.assign(Ce(r.x.greaterThan(0),0,3))}).Else(()=>{e.assign(Ce(r.y.greaterThan(0),1,4))})}).Else(()=>{rt(t.z.greaterThan(t.y),()=>{e.assign(Ce(r.z.greaterThan(0),2,5))}).Else(()=>{e.assign(Ce(r.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),nx=B(([r,t])=>{const e=k().toVar();return rt(t.equal(0),()=>{e.assign(k(r.z,r.y).div(Ft(r.x)))}).ElseIf(t.equal(1),()=>{e.assign(k(r.x.negate(),r.z.negate()).div(Ft(r.y)))}).ElseIf(t.equal(2),()=>{e.assign(k(r.x.negate(),r.y).div(Ft(r.z)))}).ElseIf(t.equal(3),()=>{e.assign(k(r.z.negate(),r.y).div(Ft(r.x)))}).ElseIf(t.equal(4),()=>{e.assign(k(r.x.negate(),r.z).div(Ft(r.y)))}).Else(()=>{e.assign(k(r.x,r.y).div(Ft(r.z)))}),it(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),ox=B(([r])=>{const t=S(0).toVar();return rt(r.greaterThanEqual(f0),()=>{t.assign(vh.sub(r).mul(kl.sub(du)).div(vh.sub(f0)).add(du))}).ElseIf(r.greaterThanEqual(m0),()=>{t.assign(f0.sub(r).mul(Ol.sub(kl)).div(f0.sub(m0)).add(kl))}).ElseIf(r.greaterThanEqual(y0),()=>{t.assign(m0.sub(r).mul(Gl.sub(Ol)).div(m0.sub(y0)).add(Ol))}).ElseIf(r.greaterThanEqual(Mh),()=>{t.assign(y0.sub(r).mul(ex.sub(Gl)).div(y0.sub(Mh)).add(Gl))}).Else(()=>{t.assign(S(-2).mul(Js(it(1.16,r))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),J6=B(([r,t])=>{const e=r.toVar();e.assign(it(2,e).sub(1));const s=F(e,1).toVar();return rt(t.equal(0),()=>{s.assign(s.zyx)}).ElseIf(t.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{s.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),Q6=B(([r,t,e,s,i,n])=>{const o=S(e),a=F(t),c=ei(ox(o),du,n),l=Ii(c),u=Qs(c),p=F(gu(r,a,u,s,i,n)).toVar();return rt(l.notEqual(0),()=>{const h=F(gu(r,a,u.add(1),s,i,n)).toVar();p.assign(_t(p,h,l))}),p}),gu=B(([r,t,e,s,i,n])=>{const o=S(e).toVar(),a=F(t),c=S(ix(a)).toVar(),l=S(Jt(Ah.sub(o),0)).toVar();o.assign(Jt(o,Ah));const u=S(ar(o)).toVar(),p=k(nx(a,c).mul(u.sub(2)).add(1)).toVar();return rt(c.greaterThan(2),()=>{p.y.addAssign(u),c.subAssign(3)}),p.x.addAssign(c.mul(u)),p.x.addAssign(l.mul(it(3,sx))),p.y.addAssign(it(4,ar(n).sub(u))),p.x.mulAssign(s),p.y.mulAssign(i),r.uv(p).grad(k(),k())}),Wl=B(({envMap:r,mipInt:t,outputDirection:e,theta:s,axis:i,CUBEUV_TEXEL_WIDTH:n,CUBEUV_TEXEL_HEIGHT:o,CUBEUV_MAX_MIP:a})=>{const c=bi(s),l=e.mul(c).add(i.cross(e).mul(ls(s))).add(i.mul(i.dot(e).mul(c.oneMinus())));return gu(r,l,t,n,o,a)}),t7=B(({n:r,latitudinal:t,poleAxis:e,outputDirection:s,weights:i,samples:n,dTheta:o,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})=>{const h=F(Ce(t,e,Wc(e,s))).toVar();rt(_p(h.equals(F(0))),()=>{h.assign(F(s.z,0,s.x.negate()))}),h.assign(Bi(h));const d=F().toVar();return d.addAssign(i.element(N(0)).mul(Wl({theta:0,axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),St({start:N(1),end:r},({i:g})=>{rt(g.greaterThanEqual(n),()=>{F6()});const f=S(o.mul(S(g))).toVar();d.addAssign(i.element(g).mul(Wl({theta:f.mul(-1),axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),d.addAssign(i.element(g).mul(Wl({theta:f,axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})))}),X(d,1)});let fc=null;const Nh=new WeakMap;function rx(r){const t=Math.log2(r)-2,e=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:e,maxMip:t}}function ax(r){let t=Nh.get(r);if((t!==void 0?t.pmremVersion:-1)!==r.pmremVersion){const s=r.image;if(r.isCubeTexture)if(lx(s))t=fc.fromCubemap(r,t);else return null;else if(ux(s))t=fc.fromEquirectangular(r,t);else return null;t.pmremVersion=r.pmremVersion,Nh.set(r,t)}return t.texture}class cx extends te{static get type(){return"PMREMNode"}constructor(t,e=null,s=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=s,this._generator=null;const i=new Ge;i.isRenderTargetTexture=!0,this._texture=dt(i),this._width=j(0),this._height=j(0),this._maxMip=j(0),this.updateBeforeType=st.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=rx(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(){let t=this._pmrem;const e=t?t.pmremVersion:-1,s=this._value;e!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=ax(s),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(t){fc===null&&(fc=t.createPMREMGenerator()),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this));const s=this.value;t.renderer.coordinateSystem===Rs&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(e=F(e.x.negate(),e.yz));let i=this.levelNode;return i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),Q6(this._texture,e,i,this._width,this._height,this._maxMip)}}function lx(r){if(r==null)return!1;let t=0;const e=6;for(let s=0;s<e;s++)r[s]!==void 0&&t++;return t===e}function ux(r){return r==null?!1:r.height>0}const Zp=L(cx),Ch=new WeakMap;class px extends dr{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const d=s.isTextureNode?s.value:e[s.property];let g=Ch.get(d);g===void 0&&(g=Zp(d),Ch.set(d,g)),s=g}const n=e.envMap?Mt("envMapIntensity","float",t.material):Mt("environmentIntensity","float",t.scene),a=e.useAnisotropy===!0||e.anisotropy>0?H8:Kt,c=s.context(Rh(Xs,a)).mul(n),l=s.context(hx(Yc)).mul(Math.PI).mul(n),u=ea(c),p=ea(l);t.context.radiance.addAssign(u),t.context.iblIrradiance.addAssign(p);const h=t.context.lightingModel.clearcoatRadiance;if(h){const d=s.context(Rh(ba,Yo)).mul(n),g=ea(d);h.addAssign(g)}}}const Rh=(r,t)=>{let e=null;return{getUV:()=>(e===null&&(e=zt.negate().reflect(t),e=r.mul(r).mix(e,t).normalize(),e=e.transformDirection(ss)),e),getTextureLevel:()=>r}},hx=r=>({getUV:()=>r,getTextureLevel:()=>S(1)}),dx=new Is;class Qe extends Qt{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(dx),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return e===null&&t.environmentNode&&(e=t.environmentNode),e?new px(e):null}setupLightingModel(){return new K6}setupSpecular(){const t=_t(F(.04),wt.rgb,xa);He.assign(t),wa.assign(1)}setupVariants(){const t=this.metalnessNode?S(this.metalnessNode):t6;xa.assign(t);let e=this.roughnessNode?S(this.roughnessNode):Q8;e=Xp({roughness:e}),Xs.assign(e),this.setupSpecular(),wt.assign(X(wt.rgb.mul(t.oneMinus()),wt.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const gx=new F5;class fx extends Qe{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(gx),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const t=this.iorNode?S(this.iorNode):g6;ta.assign(t),He.assign(_t(Ke(Np(ta.sub(1).div(ta.add(1))).mul(J8),F(1)).mul(lu),wt.rgb,xa)),wa.assign(_t(lu,1,xa))}setupLightingModel(){return new K6(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?S(this.clearcoatNode):s6,s=this.clearcoatRoughnessNode?S(this.clearcoatRoughnessNode):i6;ac.assign(e),ba.assign(Xp({roughness:s}))}if(this.useSheen){const e=this.sheenNode?F(this.sheenNode):r6,s=this.sheenRoughnessNode?S(this.sheenRoughnessNode):a6;Ln.assign(e),zc.assign(s)}if(this.useIridescence){const e=this.iridescenceNode?S(this.iridescenceNode):l6,s=this.iridescenceIORNode?S(this.iridescenceIORNode):u6,i=this.iridescenceThicknessNode?S(this.iridescenceThicknessNode):p6;Vc.assign(e),dp.assign(s),gp.assign(i)}if(this.useAnisotropy){const e=(this.anisotropyNode?k(this.anisotropyNode):c6).toVar();Yi.assign(e.length()),rt(Yi.equal(0),()=>{e.assign(k(1,0))}).Else(()=>{e.divAssign(k(Yi)),Yi.assign(Yi.saturate())}),cc.assign(Yi.pow2().mix(Xs.pow2(),1)),Qr.assign(Un[0].mul(e.x).add(Un[1].mul(e.y))),On.assign(Un[1].mul(e.x).sub(Un[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?S(this.transmissionNode):h6,s=this.thicknessNode?S(this.thicknessNode):d6,i=this.attenuationDistanceNode?S(this.attenuationDistanceNode):f6,n=this.attenuationColorNode?F(this.attenuationColorNode):m6;if(uc.assign(e),fp.assign(s),mp.assign(i),yp.assign(n),this.useDispersion){const o=this.dispersionNode?S(this.dispersionNode):_6;xp.assign(o)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?F(this.clearcoatNormalNode):n6}setup(t){t.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(t),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const mx=B(({normal:r,lightDirection:t,builder:e})=>{const s=r.dot(t),i=k(s.mul(.5).add(.5),0);if(e.material.gradientMap){const n=Si("gradientMap","texture").context({getUV:()=>i});return F(n.r)}else{const n=i.fwidth().mul(.5);return _t(F(.7),F(1),Di(S(.7).sub(n.x),S(.7).add(n.x),i.x))}});class yx extends Kc{direct({lightDirection:t,lightColor:e,reflectedLight:s},i,n){const o=mx({normal:Hc,lightDirection:t,builder:n}).mul(e);s.directDiffuse.addAssign(o.mul(jn({diffuseColor:wt.rgb})))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:s}){s.indirectDiffuse.addAssign(e.mul(jn({diffuseColor:wt}))),s.indirectDiffuse.mulAssign(t)}}const xx=new Kg;class bx extends Qt{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(xx),this.setValues(t)}setupLightingModel(){return new yx}}class wx extends te{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const t=F(zt.z,0,zt.x.negate()).normalize(),e=zt.cross(t);return k(t.dot(Kt),e.dot(Kt)).mul(.495).add(.5)}}const e7=G(wx),_x=new tf;class Tx extends Qt{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(_x),this.setValues(t)}setupVariants(t){const e=e7;let s;t.material.matcap?s=Si("matcap","texture").context({getUV:()=>e}):s=F(_t(.2,.8,e.y)),wt.rgb.mulAssign(s.rgb)}}const Sx=new ln;class Kp extends Qt{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Sx),this.setValues(t)}copy(t){return this.sizeNode=t.sizeNode,super.copy(t)}}class vx extends te{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:s}=this;if(this.getNodeType(t)==="vec2"){const n=e.cos(),o=e.sin();return Uc(n,o,o.negate(),n).mul(s)}else{const n=e,o=kn(X(1,0,0,0),X(0,bi(n.x),ls(n.x).negate(),0),X(0,ls(n.x),bi(n.x),0),X(0,0,0,1)),a=kn(X(bi(n.y),0,ls(n.y),0),X(0,1,0,0),X(ls(n.y).negate(),0,bi(n.y),0),X(0,0,0,1)),c=kn(X(bi(n.z),ls(n.z).negate(),0,0),X(ls(n.z),bi(n.z),0,0),X(0,0,1,0),X(0,0,0,1));return o.mul(a).mul(c).mul(X(s,1)).xyz}}}const Jp=L(vx),Mx=new gg;class Ax extends Qt{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues(Mx),this.setValues(t)}setupPosition({object:t,camera:e,context:s}){const i=this.sizeAttenuation,{positionNode:n,rotationNode:o,scaleNode:a}=this,c=Xt;let l=oo.mul(F(n||0)),u=k(bs[0].xyz.length(),bs[1].xyz.length());if(a!==null&&(u=u.mul(a)),!i)if(e.isPerspectiveCamera)u=u.mul(l.z.negate());else{const f=S(2).div(hn.element(1).element(1));u=u.mul(f.mul(2))}let p=c.xy;if(t.center&&t.center.isVector2===!0){const f=Yf("center","vec2");p=p.sub(f.sub(.5))}p=p.mul(u);const h=S(o||o6),d=Jp(p,h);l=X(l.xy.add(d),l.zw);const g=hn.mul(l);return s.vertex=c,g}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}class Nx extends Kc{constructor(){super(),this.shadowNode=S(1).toVar("shadowMask")}direct({shadowMask:t}){this.shadowNode.mulAssign(t)}finish(t){wt.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(wt.rgb)}}const Cx=new jg;class Rx extends Qt{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Cx),this.setValues(t)}setupLightingModel(){return new Nx}}const Fx=B(({texture:r,uv:t})=>{const s=F().toVar();return rt(t.x.lessThan(1e-4),()=>{s.assign(F(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{s.assign(F(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{s.assign(F(0,0,1))}).ElseIf(t.x.greaterThan(1-1e-4),()=>{s.assign(F(-1,0,0))}).ElseIf(t.y.greaterThan(1-1e-4),()=>{s.assign(F(0,-1,0))}).ElseIf(t.z.greaterThan(1-1e-4),()=>{s.assign(F(0,0,-1))}).Else(()=>{const n=r.uv(t.add(F(-.01,0,0))).r.sub(r.uv(t.add(F(.01,0,0))).r),o=r.uv(t.add(F(0,-.01,0))).r.sub(r.uv(t.add(F(0,.01,0))).r),a=r.uv(t.add(F(0,0,-.01))).r.sub(r.uv(t.add(F(0,0,.01))).r);s.assign(F(n,o,a))}),s.normalize()});class Ex extends ii{static get type(){return"Texture3DNode"}constructor(t,e=null,s=null){super(t,e,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return F(.5,.5,.5)}setUpdateMatrix(){}setupUV(t,e){return e}generateUV(t,e){return e.build(t,"vec3")}normal(t){return Fx({texture:this,uv:t})}}const Bx=L(Ex);class Dx{constructor(t,e){this.nodes=t,this.info=e,this._context=self,this._animationLoop=null,this._requestId=null}start(){const t=(e,s)=>{this._requestId=this._context.requestAnimationFrame(t),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(e,s)};t()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}setAnimationLoop(t){this._animationLoop=t}setContext(t){this._context=t}dispose(){this.stop()}}class ri{constructor(){this.weakMap=new WeakMap}get(t){let e=this.weakMap;for(let s=0;s<t.length;s++)if(e=e.get(t[s]),e===void 0)return;return e.get(t[t.length-1])}set(t,e){let s=this.weakMap;for(let i=0;i<t.length;i++){const n=t[i];s.has(n)===!1&&s.set(n,new WeakMap),s=s.get(n)}return s.set(t[t.length-1],e)}delete(t){let e=this.weakMap;for(let s=0;s<t.length;s++)if(e=e.get(t[s]),e===void 0)return!1;return e.delete(t[t.length-1])}}let Px=0;function Ix(r){const t=Object.keys(r);let e=Object.getPrototypeOf(r);for(;e;){const s=Object.getOwnPropertyDescriptors(e);for(const i in s)if(s[i]!==void 0){const n=s[i];n&&typeof n.get=="function"&&t.push(i)}e=Object.getPrototypeOf(e)}return t}class Lx{constructor(t,e,s,i,n,o,a,c,l,u){this._nodes=t,this._geometries=e,this.id=Px++,this.renderer=s,this.object=i,this.material=n,this.scene=o,this.camera=a,this.lightsNode=c,this.context=l,this.geometry=i.geometry,this.version=n.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(t){this.clippingContext=t}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(t){this.geometry=t,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,s=[],i=new Set;for(const n of t){const o=n.node&&n.node.attribute?n.node.attribute:e.getAttribute(n.name);if(o===void 0)continue;s.push(o);const a=o.isInterleavedBufferAttribute?o.data:o;i.add(a)}return this.attributes=s,this.vertexBuffers=Array.from(i.values()),s}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:s,group:i,drawRange:n}=this,o=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null,l=s.isInstancedBufferGeometry?s.instanceCount:t.count>1?t.count:1;if(l===0)return null;if(o.instanceCount=l,t.isBatchedMesh===!0)return o;let u=1;e.wireframe===!0&&!t.isPoints&&!t.isLineSegments&&!t.isLine&&!t.isLineLoop&&(u=2);let p=n.start*u,h=(n.start+n.count)*u;i!==null&&(p=Math.max(p,i.start*u),h=Math.min(h,(i.start+i.count)*u));const d=s.attributes.position;let g=1/0;c?g=a.count:d!=null&&(g=d.count),p=Math.max(p,0),h=Math.min(h,g);const f=h-p;return f<0||f===1/0?null:(o.vertexCount=f,o.firstVertex=p,o)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const s of Object.keys(t.attributes).sort()){const i=t.attributes[s];e+=s+",",i.data&&(e+=i.data.stride+","),i.offset&&(e+=i.offset+","),i.itemSize&&(e+=i.itemSize+","),i.normalized&&(e+="n,")}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e}=this;let s=e.customProgramCacheKey();for(const i of Ix(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const n=e[i];let o;if(n!==null){const a=typeof n;a==="number"?o=n!==0?"1":"0":a==="object"?(o="{",n.isTexture&&(o+=n.mapping),o+="}"):o=String(n)}else o=String(n);s+=o+","}return s+=this.clippingContextCacheKey+",",t.geometry&&(s+=this.getGeometryCacheKey()),t.skeleton&&(s+=t.skeleton.bones.length+","),t.morphTargetInfluences&&(s+=t.morphTargetInfluences.length+","),t.isBatchedMesh&&(s+=t._matricesTexture.uuid+",",t._colorsTexture!==null&&(s+=t._colorsTexture.uuid+",")),t.count>1&&(s+=t.uuid+","),s+=t.receiveShadow+",",P5(s)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(t+=1),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Ao=[];class Ux{constructor(t,e,s,i,n,o){this.renderer=t,this.nodes=e,this.geometries=s,this.pipelines=i,this.bindings=n,this.info=o,this.chainMaps={}}get(t,e,s,i,n,o,a,c){const l=this.getChainMap(c);Ao[0]=t,Ao[1]=e,Ao[2]=o,Ao[3]=n;let u=l.get(Ao);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,s,i,n,o,a,c),l.set(Ao,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(t.geometry),(u.version!==e.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(t,e,s,i,n,o,a,c)):u.version=e.version)),u}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new ri)}dispose(){this.chainMaps={}}createRenderObject(t,e,s,i,n,o,a,c,l,u,p){const h=this.getChainMap(p),d=new Lx(t,e,s,i,n,o,a,c,l,u);return d.onDispose=()=>{this.pipelines.delete(d),this.bindings.delete(d),this.nodes.delete(d),h.delete(d.getChainArray())},d}}class bn{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}delete(t){let e;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const js={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Ji=16,zx=211,Vx=212;class kx extends bn{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return e!==void 0&&this.backend.destroyAttribute(t),e}update(t,e){const s=this.get(t);if(s.version===void 0)e===js.VERTEX?this.backend.createAttribute(t):e===js.INDEX?this.backend.createIndexAttribute(t):e===js.STORAGE?this.backend.createStorageAttribute(t):e===js.INDIRECT&&this.backend.createIndirectStorageAttribute(t),s.version=this._getBufferAttribute(t).version;else{const i=this._getBufferAttribute(t);(s.version<i.version||i.usage===In)&&(this.backend.updateAttribute(t),s.version=i.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function Ox(r){for(let t=r.length-1;t>=0;--t)if(r[t]>=65535)return!0;return!1}function s7(r){return r.index!==null?r.index.version:r.attributes.position.version}function Fh(r){const t=[],e=r.index,s=r.attributes.position;if(e!==null){const n=e.array;for(let o=0,a=n.length;o<a;o+=3){const c=n[o+0],l=n[o+1],u=n[o+2];t.push(c,l,l,u,u,c)}}else{const n=s.array;for(let o=0,a=n.length/3-1;o<a;o+=3){const c=o+0,l=o+1,u=o+2;t.push(c,l,l,u,u,c)}}const i=new(Ox(t)?d5:h5)(t,1);return i.version=s7(r),i}class Gx extends bn{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(t){const e=t.geometry;return super.has(e)&&this.get(e).initialized===!0}updateForRender(t){this.has(t)===!1&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry,s=this.get(e);s.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const n=e.index,o=t.getAttributes();n!==null&&this.attributes.delete(n);for(const c of o)this.attributes.delete(c);const a=this.wireframes.get(e);a!==void 0&&this.attributes.delete(a),e.removeEventListener("dispose",i)};e.addEventListener("dispose",i)}updateAttributes(t){const e=t.getAttributes();for(const n of e)n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute?this.updateAttribute(n,js.STORAGE):this.updateAttribute(n,js.VERTEX);const s=this.getIndex(t);s!==null&&this.updateAttribute(s,js.INDEX);const i=t.geometry.indirect;i!==null&&this.updateAttribute(i,js.INDIRECT)}updateAttribute(t,e){const s=this.info.render.calls;t.isInterleavedBufferAttribute?this.attributeCall.get(t)===void 0?(this.attributes.update(t,e),this.attributeCall.set(t,s)):this.attributeCall.get(t.data)!==s&&(this.attributes.update(t,e),this.attributeCall.set(t.data,s),this.attributeCall.set(t,s)):this.attributeCall.get(t)!==s&&(this.attributes.update(t,e),this.attributeCall.set(t,s))}getIndirect(t){return t.geometry.indirect}getIndex(t){const{geometry:e,material:s}=t;let i=e.index;if(s.wireframe===!0){const n=this.wireframes;let o=n.get(e);o===void 0?(o=Fh(e),n.set(e,o)):o.version!==s7(e)&&(this.attributes.delete(o),o=Fh(e),n.set(e,o)),i=o}return i}}class Wx{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(t,e,s){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=s*(e/3):t.isPoints?this.render.points+=s*e:t.isLineSegments?this.render.lines+=s*(e/2):t.isLine?this.render.lines+=s*(e-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(t,e){this[t].timestampCalls===0&&(this[t].timestamp=0),this[t].timestamp+=e,this[t].timestampCalls++,this[t].timestampCalls>=this[t].previousFrameCalls&&(this[t].timestampCalls=0)}reset(){const t=this.render.frameCalls;this.render.previousFrameCalls=t;const e=this.compute.frameCalls;this.compute.previousFrameCalls=e,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class i7{constructor(t){this.cacheKey=t,this.usedTimes=0}}class $x extends i7{constructor(t,e,s){super(t),this.vertexProgram=e,this.fragmentProgram=s}}class Hx extends i7{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let qx=0;class $l{constructor(t,e,s=null,i=null){this.id=qx++,this.code=t,this.stage=e,this.transforms=s,this.attributes=i,this.usedTimes=0}}class Yx extends bn{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:s}=this,i=this.get(t);if(this._needsComputeUpdate(t)){const n=i.pipeline;n&&(n.usedTimes--,n.computeProgram.usedTimes--);const o=this.nodes.getForCompute(t);let a=this.programs.compute.get(o.computeShader);a===void 0&&(n&&n.computeProgram.usedTimes===0&&this._releaseProgram(n.computeProgram),a=new $l(o.computeShader,"compute",o.transforms,o.nodeAttributes),this.programs.compute.set(o.computeShader,a),s.createProgram(a));const c=this._getComputeCacheKey(t,a);let l=this.caches.get(c);l===void 0&&(n&&n.usedTimes===0&&this._releasePipeline(n),l=this._getComputePipeline(t,a,c,e)),l.usedTimes++,a.usedTimes++,i.version=t.version,i.pipeline=l}return i.pipeline}getForRender(t,e=null){const{backend:s}=this,i=this.get(t);if(this._needsRenderUpdate(t)){const n=i.pipeline;n&&(n.usedTimes--,n.vertexProgram.usedTimes--,n.fragmentProgram.usedTimes--);const o=t.getNodeBuilderState();let a=this.programs.vertex.get(o.vertexShader);a===void 0&&(n&&n.vertexProgram.usedTimes===0&&this._releaseProgram(n.vertexProgram),a=new $l(o.vertexShader,"vertex"),this.programs.vertex.set(o.vertexShader,a),s.createProgram(a));let c=this.programs.fragment.get(o.fragmentShader);c===void 0&&(n&&n.fragmentProgram.usedTimes===0&&this._releaseProgram(n.fragmentProgram),c=new $l(o.fragmentShader,"fragment"),this.programs.fragment.set(o.fragmentShader,c),s.createProgram(c));const l=this._getRenderCacheKey(t,a,c);let u=this.caches.get(l);u===void 0?(n&&n.usedTimes===0&&this._releasePipeline(n),u=this._getRenderPipeline(t,a,c,l,e)):t.pipeline=u,u.usedTimes++,a.usedTimes++,c.usedTimes++,i.pipeline=u}return i.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,e.usedTimes===0&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,e.computeProgram.usedTimes===0&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,e.vertexProgram.usedTimes===0&&this._releaseProgram(e.vertexProgram),e.fragmentProgram.usedTimes===0&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,s,i){s=s||this._getComputeCacheKey(t,e);let n=this.caches.get(s);return n===void 0&&(n=new Hx(s,e),this.caches.set(s,n),this.backend.createComputePipeline(n,i)),n}_getRenderPipeline(t,e,s,i,n){i=i||this._getRenderCacheKey(t,e,s);let o=this.caches.get(i);return o===void 0&&(o=new $x(i,e,s),this.caches.set(i,o),t.pipeline=o,this.backend.createRenderPipeline(t,n)),o}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,s){return e.id+","+s.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,s=t.stage;this.programs[s].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return e.pipeline===void 0||e.version!==t.version}_needsRenderUpdate(t){return this.get(t).pipeline===void 0||this.backend.needsRenderUpdate(t)}}class Xx extends bn{constructor(t,e,s,i,n,o){super(),this.backend=t,this.textures=s,this.pipelines=n,this.attributes=i,this.nodes=e,this.info=o,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const s of e){const i=this.get(s);i.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,e,0),i.bindGroup=s)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const s of e){const i=this.get(s);i.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,e,0),i.bindGroup=s)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isStorageBuffer){const s=e.attribute,i=s.isIndirectStorageBufferAttribute?js.INDIRECT:js.STORAGE;this.attributes.update(s,i)}}_update(t,e){const{backend:s}=this;let i=!1,n=!0,o=0,a=0;for(const c of t.bindings)if(!(c.isNodeUniformsGroup&&!this.nodes.updateGroup(c))){if(c.isUniformBuffer)c.update()&&s.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const l=this.textures.get(c.texture);c.needsBindingsUpdate(l.generation)&&(i=!0);const u=c.update(),p=c.texture;u&&this.textures.updateTexture(p);const h=s.get(p);if(h.externalTexture!==void 0||l.isDefaultTexture?n=!1:(o=o*10+p.id,a+=p.version),s.isWebGPUBackend===!0&&h.texture===void 0&&h.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,u,p,c.textureNode.value,i),this.textures.updateTexture(p),i=!0),p.isStorageTexture===!0){const d=this.get(p);c.store===!0?d.needsMipmap=!0:this.textures.needsMipmaps(p)&&d.needsMipmap===!0&&(this.backend.generateMipmaps(p),d.needsMipmap=!1)}}}i===!0&&this.backend.updateBindings(t,e,n?o:0,a)}}function jx(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.material.id!==t.material.id?r.material.id-t.material.id:r.z!==t.z?r.z-t.z:r.id-t.id}function Eh(r,t){return r.groupOrder!==t.groupOrder?r.groupOrder-t.groupOrder:r.renderOrder!==t.renderOrder?r.renderOrder-t.renderOrder:r.z!==t.z?t.z-r.z:r.id-t.id}function Bh(r){return(r.transmission>0||r.transmissionNode)&&r.side===se&&r.forceSinglePass===!1}class Zx{constructor(t,e,s){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,s),this.lightsArray=[],this.scene=e,this.camera=s,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,s,i,n,o,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:t.id,object:t,geometry:e,material:s,groupOrder:i,renderOrder:t.renderOrder,z:n,group:o,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=t.id,c.object=t,c.geometry=e,c.material=s,c.groupOrder=i,c.renderOrder=t.renderOrder,c.z=n,c.group=o,c.clippingContext=a),this.renderItemsIndex++,c}push(t,e,s,i,n,o,a){const c=this.getNextRenderItem(t,e,s,i,n,o,a);t.occlusionTest===!0&&this.occlusionQueryCount++,s.transparent===!0||s.transmission>0?(Bh(s)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(t,e,s,i,n,o,a){const c=this.getNextRenderItem(t,e,s,i,n,o,a);s.transparent===!0||s.transmission>0?(Bh(s)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||jx),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||Eh),this.transparent.length>1&&this.transparent.sort(e||Eh)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const s=this.renderItems[t];if(s.id===null)break;s.id=null,s.object=null,s.geometry=null,s.material=null,s.groupOrder=null,s.renderOrder=null,s.z=null,s.group=null,s.clippingContext=null}}}class Kx{constructor(t){this.lighting=t,this.lists=new ri}get(t,e){const s=this.lists,i=[t,e];let n=s.get(i);return n===void 0&&(n=new Zx(this.lighting,t,e),s.set(i,n)),n}dispose(){this.lists=new ri}}let Jx=0;class Qx{constructor(){this.id=Jx++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new yt,this.scissor=!1,this.scissorValue=new yt,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return n7(this)}}function n7(r){const{textures:t,activeCubeFace:e}=r,s=[e];for(const i of t)s.push(i.id);return np(s)}class tb{constructor(){this.chainMaps={}}get(t,e,s=null){const i=[t,e];let n;if(s===null)n="default";else{const c=s.texture.format;n=`${s.textures.length}:${c}:${s.samples}:${s.depthBuffer}:${s.stencilBuffer}`}const o=this.getChainMap(n);let a=o.get(i);return a===void 0&&(a=new Qx,o.set(i,a)),s!==null&&(a.sampleCount=s.samples===0?1:s.samples),a}getChainMap(t){return this.chainMaps[t]||(this.chainMaps[t]=new ri)}dispose(){this.chainMaps={}}}const eb=new v;class sb extends bn{constructor(t,e,s){super(),this.renderer=t,this.backend=e,this.info=s}updateRenderTarget(t,e=0){const s=this.get(t),i=t.samples===0?1:t.samples,n=s.depthTextureMips||(s.depthTextureMips={}),o=t.textures,a=this.getSize(o[0]),c=a.width>>e,l=a.height>>e;let u=t.depthTexture||n[e];const p=t.depthBuffer===!0||t.stencilBuffer===!0;let h=!1;u===void 0&&p&&(u=new eo,u.format=t.stencilBuffer?or:zn,u.type=t.stencilBuffer?Aa:Ae,u.image.width=c,u.image.height=l,n[e]=u),(s.width!==a.width||a.height!==s.height)&&(h=!0,u&&(u.needsUpdate=!0,u.image.width=c,u.image.height=l)),s.width=a.width,s.height=a.height,s.textures=o,s.depthTexture=u||null,s.depth=t.depthBuffer,s.stencil=t.stencilBuffer,s.renderTarget=t,s.sampleCount!==i&&(h=!0,u&&(u.needsUpdate=!0),s.sampleCount=i);const d={sampleCount:i};for(let g=0;g<o.length;g++){const f=o[g];h&&(f.needsUpdate=!0),this.updateTexture(f,d)}if(u&&this.updateTexture(u,d),s.initialized!==!0){s.initialized=!0;const g=()=>{t.removeEventListener("dispose",g);for(let f=0;f<o.length;f++)this._destroyTexture(o[f]);u&&this._destroyTexture(u),this.delete(t)};t.addEventListener("dispose",g)}}updateTexture(t,e={}){const s=this.get(t);if(s.initialized===!0&&s.version===t.version)return;const i=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,n=this.backend;if(i&&s.initialized===!0&&(n.destroySampler(t),n.destroyTexture(t)),t.isFramebufferTexture){const l=this.renderer.getRenderTarget();l?t.type=l.texture.type:t.type=nn}const{width:o,height:a,depth:c}=this.getSize(t);if(e.width=o,e.height=a,e.depth=c,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,o,a):1,i||t.isStorageTexture===!0)n.createSampler(t),n.createTexture(t,e),s.generation=t.version;else if(s.initialized!==!0&&n.createSampler(t),t.version>0){const u=t.image;if(u===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(u.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const p=[];for(const h of t.images)p.push(h);e.images=p}else e.image=u;(s.isDefaultTexture===void 0||s.isDefaultTexture===!0)&&(n.createTexture(t,e),s.isDefaultTexture=!1,s.generation=t.version),t.source.dataReady===!0&&n.updateTexture(t,e),e.needsMipmaps&&t.mipmaps.length===0&&n.generateMipmaps(t)}}else n.createDefaultTexture(t),s.isDefaultTexture=!0,s.generation=t.version;if(s.initialized!==!0){s.initialized=!0,s.generation=t.version,this.info.memory.textures++;const l=()=>{t.removeEventListener("dispose",l),this._destroyTexture(t),this.info.memory.textures--};t.addEventListener("dispose",l)}s.version=t.version}getSize(t,e=eb){let s=t.images?t.images[0]:t.image;return s?(s.image!==void 0&&(s=s.image),e.width=s.width||1,e.height=s.height||1,e.depth=t.isCubeTexture?6:s.depth||1):e.width=e.height=e.depth=1,e}getMipLevels(t,e,s){let i;return t.isCompressedTexture?t.mipmaps?i=t.mipmaps.length:i=1:i=Math.floor(Math.log2(Math.max(e,s)))+1,i}needsMipmaps(t){return this.isEnvironmentTexture(t)||t.isCompressedTexture===!0||t.generateMipmaps}isEnvironmentTexture(t){const e=t.mapping;return e===va||e===Ma||e===qn||e===ir}_destroyTexture(t){this.backend.destroySampler(t),this.backend.destroyTexture(t),this.delete(t)}}class Qp extends W{constructor(t,e,s,i=1){super(t,e,s),this.a=i}set(t,e,s,i=1){return this.a=i,super.set(t,e,s)}copy(t){return t.a!==void 0&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class o7 extends vt{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}const ib=(r,t)=>z(new o7(r,t));class nb extends Z{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}add(t){return this.nodes.push(t),this}If(t,e){const s=new Jr(e);return this._currentCond=Ce(t,s),this.add(this._currentCond)}ElseIf(t,e){const s=new Jr(e),i=Ce(t,s);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(t){return this._currentCond.elseNode=new Jr(t),this}build(t,...e){const s=lp();ma(this);for(const i of this.nodes)i.build(t,"void");return ma(s),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}else(...t){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...t)}elseif(...t){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...t)}}const W0=L(nb);class ob extends Z{static get type(){return"StructTypeNode"}constructor(t){super(),this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class r7 extends Z{static get type(){return"OutputStructNode"}constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}setup(t){super.setup(t);const e=this.members,s=[];for(let i=0;i<e.length;i++)s.push(e[i].getNodeType(t));this.nodeType=t.getStructTypeFromNode(new ob(s)).name}generate(t,e){const s=t.getOutputStructName(),i=this.members,n=s!==""?s+".":"";for(let o=0;o<i.length;o++){const a=i[o].build(t,e);t.addLineFlowCode(`${n}m${o} = ${a}`,this)}return s}}const rb=L(r7);function a7(r,t){for(let e=0;e<r.length;e++)if(r[e].name===t)return e;return-1}class ab extends r7{static get type(){return"MRTNode"}constructor(t){super(),this.outputNodes=t,this.isMRTNode=!0}has(t){return this.outputNodes[t]!==void 0}get(t){return this.outputNodes[t]}merge(t){const e={...this.outputNodes,...t.outputNodes};return c7(e)}setup(t){const e=this.outputNodes,s=t.renderer.getRenderTarget(),i=[],n=s.textures;for(const o in e){const a=a7(n,o);i[a]=X(e[o])}return this.members=i,super.setup(t)}}const c7=L(ab),cb=B(([r])=>{const t=r.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)}),fu=(r,t)=>Fs(it(4,r.mul(ft(1,r))),t),lb=(r,t)=>r.lessThan(.5)?fu(r.mul(2),t).div(2):ft(1,fu(it(ft(1,r),2),t).div(2)),ub=(r,t,e)=>Fs(Ls(Fs(r,t),ne(Fs(r,t),Fs(ft(1,r),e))),1/t),pb=(r,t)=>ls(pc.mul(t.mul(r).sub(1))).div(pc.mul(t.mul(r).sub(1))),Ys=B(([r])=>r.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),l7=B(([r])=>F(Ys(r.z.add(Ys(r.y.mul(1)))),Ys(r.z.add(Ys(r.x.mul(1)))),Ys(r.y.add(Ys(r.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),hb=B(([r,t,e])=>{const s=F(r).toVar(),i=S(1.4).toVar(),n=S(0).toVar(),o=F(s).toVar();return St({start:S(0),end:S(3),type:"float",condition:"<="},()=>{const a=F(l7(o.mul(2))).toVar();s.addAssign(a.add(e.mul(S(.1).mul(t)))),o.mulAssign(1.8),i.mulAssign(1.5),s.mulAssign(1.2);const c=S(Ys(s.z.add(Ys(s.x.add(Ys(s.y)))))).toVar();n.addAssign(c.div(i)),o.addAssign(.14)}),n}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});class db extends Z{static get type(){return"FunctionOverloadingNode"}constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(t){const e=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let i=null,n=-1;for(const o of this.functionNodes){const c=o.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const l=c.inputs;if(e.length===l.length){let u=0;for(let p=0;p<e.length;p++){const h=e[p],d=l[p];h.getNodeType(t)===d.type?u++:u=0}u>n&&(i=o,n=u)}}this._candidateFnCall=s=i(...e)}return s}}const gb=L(db),Re=r=>(...t)=>gb(r,...t),ro=j(0).setGroup(Q).onRenderUpdate(r=>r.time),u7=j(0).setGroup(Q).onRenderUpdate(r=>r.deltaTime),fb=j(0,"uint").setGroup(Q).onRenderUpdate(r=>r.frameId),mb=(r=1)=>(console.warn('TSL: timerLocal() is deprecated. Use "time" instead.'),ro.mul(r)),yb=(r=1)=>(console.warn('TSL: timerGlobal() is deprecated. Use "time" instead.'),ro.mul(r)),xb=(r=1)=>(console.warn('TSL: timerDelta() is deprecated. Use "deltaTime" instead.'),u7.mul(r)),bb=(r=ro)=>r.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),wb=(r=ro)=>r.fract().round(),_b=(r=ro)=>r.add(.5).fract().mul(2).sub(1).abs(),Tb=(r=ro)=>r.fract(),Sb=B(([r,t,e=k(.5)])=>Jp(r.sub(e),t).add(e)),vb=B(([r,t,e=k(.5)])=>{const s=r.sub(e),i=s.dot(s),o=i.mul(i).mul(t);return r.add(s.mul(o))}),Mb=B(({position:r=null,horizontal:t=!0,vertical:e=!1})=>{let s;r!==null?(s=bs.toVar(),s[3][0]=r.x,s[3][1]=r.y,s[3][2]=r.z):s=bs;const i=ss.mul(s);return fa(t)&&(i[0][0]=bs[0].length(),i[0][1]=0,i[0][2]=0),fa(e)&&(i[1][0]=0,i[1][1]=bs[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,hn.mul(i).mul(Xt)}),Ab=B(([r=null])=>{const t=gc();return gc(Op(r)).sub(t).lessThan(0).select(oi,r)});class Nb extends Z{static get type(){return"SpriteSheetUVNode"}constructor(t,e=$t(),s=S(0)){super("vec2"),this.countNode=t,this.uvNode=e,this.frameNode=s}setup(){const{frameNode:t,uvNode:e,countNode:s}=this,{width:i,height:n}=s,o=t.mod(i.mul(n)).floor(),a=o.mod(i),c=n.sub(o.add(1).div(i).ceil()),l=s.reciprocal(),u=k(a,c);return e.add(u).mul(l)}}const Cb=L(Nb);class Rb extends Z{static get type(){return"TriplanarTexturesNode"}constructor(t,e=null,s=null,i=S(1),n=Xt,o=Je){super("vec4"),this.textureXNode=t,this.textureYNode=e,this.textureZNode=s,this.scaleNode=i,this.positionNode=n,this.normalNode=o}setup(){const{textureXNode:t,textureYNode:e,textureZNode:s,scaleNode:i,positionNode:n,normalNode:o}=this;let a=o.abs().normalize();a=a.div(a.dot(F(1)));const c=n.yz.mul(i),l=n.zx.mul(i),u=n.xy.mul(i),p=t.value,h=e!==null?e.value:p,d=s!==null?s.value:p,g=dt(p,c).mul(a.x),f=dt(h,l).mul(a.y),y=dt(d,u).mul(a.z);return ne(g,f,y)}}const p7=L(Rb),Fb=(...r)=>p7(...r),No=new qi,vn=new v,Co=new v,Hl=new v,Cr=new pt,x0=new v(0,0,-1),ks=new yt,Rr=new v,b0=new v,Fr=new yt,w0=new q,mc=new fn,Eb=oi.flipX();mc.depthTexture=new eo(1,1);let ql=!1;class t2 extends ii{static get type(){return"ReflectorNode"}constructor(t={}){super(t.defaultTexture||mc.texture,Eb),this._reflectorBaseNode=t.reflector||new Bb(this,t),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=z(new t2({defaultTexture:mc.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(t){return t.object.isQuadMesh||this._reflectorBaseNode.build(t),super.setup(t)}clone(){const t=new this.constructor(this.reflectorNode);return t._reflectorBaseNode=this._reflectorBaseNode,t}}class Bb extends Z{static get type(){return"ReflectorBaseNode"}constructor(t,e={}){super();const{target:s=new Yt,resolution:i=1,generateMipmaps:n=!1,bounces:o=!0,depth:a=!1}=e;this.textureNode=t,this.target=s,this.resolution=i,this.generateMipmaps=n,this.bounces=o,this.depth=a,this.updateBeforeType=o?st.RENDER:st.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap}_updateResolution(t,e){const s=this.resolution;e.getDrawingBufferSize(w0),t.setSize(Math.round(w0.width*s),Math.round(w0.height*s))}setup(t){return this._updateResolution(mc,t.renderer),super.setup(t)}getVirtualCamera(t){let e=this.virtualCameras.get(t);return e===void 0&&(e=t.clone(),this.virtualCameras.set(t,e)),e}getRenderTarget(t){let e=this.renderTargets.get(t);return e===void 0&&(e=new fn(0,0,{type:Bs}),this.generateMipmaps===!0&&(e.texture.minFilter=id,e.texture.generateMipmaps=!0),this.depth===!0&&(e.depthTexture=new eo),this.renderTargets.set(t,e)),e}updateBefore(t){if(this.bounces===!1&&ql)return;ql=!0;const{scene:e,camera:s,renderer:i,material:n}=t,{target:o}=this,a=this.getVirtualCamera(s),c=this.getRenderTarget(a);if(i.getDrawingBufferSize(w0),this._updateResolution(c,i),Co.setFromMatrixPosition(o.matrixWorld),Hl.setFromMatrixPosition(s.matrixWorld),Cr.extractRotation(o.matrixWorld),vn.set(0,0,1),vn.applyMatrix4(Cr),Rr.subVectors(Co,Hl),Rr.dot(vn)>0)return;Rr.reflect(vn).negate(),Rr.add(Co),Cr.extractRotation(s.matrixWorld),x0.set(0,0,-1),x0.applyMatrix4(Cr),x0.add(Hl),b0.subVectors(Co,x0),b0.reflect(vn).negate(),b0.add(Co),a.coordinateSystem=s.coordinateSystem,a.position.copy(Rr),a.up.set(0,1,0),a.up.applyMatrix4(Cr),a.up.reflect(vn),a.lookAt(b0),a.near=s.near,a.far=s.far,a.updateMatrixWorld(),a.projectionMatrix.copy(s.projectionMatrix),No.setFromNormalAndCoplanarPoint(vn,Co),No.applyMatrix4(a.matrixWorldInverse),ks.set(No.normal.x,No.normal.y,No.normal.z,No.constant);const l=a.projectionMatrix;Fr.x=(Math.sign(ks.x)+l.elements[8])/l.elements[0],Fr.y=(Math.sign(ks.y)+l.elements[9])/l.elements[5],Fr.z=-1,Fr.w=(1+l.elements[10])/l.elements[14],ks.multiplyScalar(1/ks.dot(Fr));const u=0;l.elements[2]=ks.x,l.elements[6]=ks.y,l.elements[10]=i.coordinateSystem===Fi?ks.z-u:ks.z+1-u,l.elements[14]=ks.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),n.visible=!1;const p=i.getRenderTarget(),h=i.getMRT();i.setMRT(null),i.setRenderTarget(c),i.render(e,a),i.setMRT(h),i.setRenderTarget(p),n.visible=!0,ql=!1}}const Db=r=>z(new t2(r)),Yl=new ip(-1,1,1,-1,0,1);class Pb extends It{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new ht([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new ht(e,2))}}const Ib=new Pb;class e2 extends O{constructor(t=null){super(Ib,t),this.camera=Yl,this.isQuadMesh=!0}renderAsync(t){return t.renderAsync(this,Yl)}render(t){t.render(this,Yl)}}const Lb=new q;class Ub extends ii{static get type(){return"RTTNode"}constructor(t,e=null,s=null,i={type:Bs}){const n=new fn(e,s,i);super(n.texture,$t()),this.node=t,this.width=e,this.height=s,this.renderTarget=n,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this.updateMap=new WeakMap,this._rttNode=null,this._quadMesh=new e2(new Qt),this.updateBeforeType=st.RENDER}get autoSize(){return this.width===null}setup(t){return this._rttNode=this.node.context(t.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(t)}setSize(t,e){this.width=t,this.height=e;const s=t*this.pixelRatio,i=e*this.pixelRatio;this.renderTarget.setSize(s,i),this.textureNeedsUpdate=!0}setPixelRatio(t){this.pixelRatio=t,this.setSize(this.width,this.height)}updateBefore({renderer:t}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoSize===!0){this.pixelRatio=t.getPixelRatio();const s=t.getSize(Lb);this.setSize(s.width,s.height)}this._quadMesh.material.fragmentNode=this._rttNode;const e=t.getRenderTarget();t.setRenderTarget(this.renderTarget),this._quadMesh.render(t),t.setRenderTarget(e)}clone(){const t=new ii(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t.referenceNode=this,t}}const h7=(r,...t)=>z(new Ub(z(r),...t)),zb=(r,...t)=>r.isTextureNode?r:r.isPassNode?r.getTextureNode():h7(r,...t),ko=B(([r,t,e],s)=>{let i;s.renderer.coordinateSystem===Fi?(r=k(r.x,r.y.oneMinus()).mul(2).sub(1),i=X(F(r,t),1)):i=X(F(r.x,r.y.oneMinus(),t).mul(2).sub(1),1);const n=X(e.mul(i));return n.xyz.div(n.w)}),Vb=B(([r,t])=>{const e=t.mul(X(r,1)),s=e.xy.div(e.w).mul(.5).add(.5).toVar();return k(s.x,s.y.oneMinus())}),kb=B(([r,t,e])=>{const s=Gn(Zt(t)),i=ge(r.mul(s)).toVar(),n=Zt(t,i).toVar(),o=Zt(t,i.sub(ge(2,0))).toVar(),a=Zt(t,i.sub(ge(1,0))).toVar(),c=Zt(t,i.add(ge(1,0))).toVar(),l=Zt(t,i.add(ge(2,0))).toVar(),u=Zt(t,i.add(ge(0,2))).toVar(),p=Zt(t,i.add(ge(0,1))).toVar(),h=Zt(t,i.sub(ge(0,1))).toVar(),d=Zt(t,i.sub(ge(0,2))).toVar(),g=Ft(ft(S(2).mul(a).sub(o),n)).toVar(),f=Ft(ft(S(2).mul(c).sub(l),n)).toVar(),y=Ft(ft(S(2).mul(p).sub(u),n)).toVar(),x=Ft(ft(S(2).mul(h).sub(d),n)).toVar(),b=ko(r,n,e).toVar(),w=g.lessThan(f).select(b.sub(ko(r.sub(k(S(1).div(s.x),0)),a,e)),b.negate().add(ko(r.add(k(S(1).div(s.x),0)),c,e))),_=y.lessThan(x).select(b.sub(ko(r.add(k(0,S(1).div(s.y))),p,e)),b.negate().add(ko(r.sub(k(0,S(1).div(s.y))),h,e)));return Bi(Wc(w,_))});class Ob extends la{constructor(t,e,s=Float32Array){ArrayBuffer.isView(t)===!1&&(t=new s(t*e)),super(t,e),this.isStorageInstancedBufferAttribute=!0}}class Gb extends lt{constructor(t,e,s=Float32Array){ArrayBuffer.isView(t)===!1&&(t=new s(t*e)),super(t,e),this.isStorageBufferAttribute=!0}}class Wb extends no{static get type(){return"StorageArrayElementNode"}constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}setup(t){return t.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let s;const i=t.context.assign;if(t.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||t.shaderStage!=="compute")?s=t.generatePBO(this):s=this.node.build(t):s=super.generate(t),i!==!0){const n=this.getNodeType(t);s=t.format(s,n,e)}return s}}const $b=L(Wb);class Hb extends Pp{static get type(){return"StorageBufferNode"}constructor(t,e=null,s=0){e===null&&(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(e=U5(t.itemSize),s=t.count),super(t,e,s),this.isStorageBufferNode=!0,this.access=Ie.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this.bufferCount=s,this._attribute=null,this._varying=null,this.global=!0,t.isStorageBufferAttribute!==!0&&t.isStorageInstancedBufferAttribute!==!0&&(t.isInstancedBufferAttribute?t.isStorageInstancedBufferAttribute=!0:t.isStorageBufferAttribute=!0)}getHash(t){if(this.bufferCount===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(t){return $b(this,t)}setPBO(t){return this.isPBO=t,this}getPBO(){return this.isPBO}setAccess(t){return this.access=t,this}toReadOnly(){return this.setAccess(Ie.READ_ONLY)}setAtomic(t){return this.isAtomic=t,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=Ba(this.value),this._varying=es(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(t){if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.getNodeType(t);const{attribute:e}=this.getAttributeData();return e.getNodeType(t)}generate(t){if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.generate(t);const{attribute:e,varying:s}=this.getAttributeData(),i=s.build(t);return t.registerTransform(i,e),i}}const Qc=(r,t,e)=>z(new Hb(r,t,e)),qb=(r,t,e)=>(console.warn('THREE.TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Qc(r,t,e).setPBO(!0)),Yb=(r,t="float")=>{const e=z5(t),s=new Gb(r,e);return Qc(s,t,r)},Xb=(r,t="float")=>{const e=z5(t),s=new Ob(r,e);return Qc(s,t,r)};class jb extends N8{static get type(){return"VertexColorNode"}constructor(t=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t),s=t.hasGeometryAttribute(e);let i;return s===!0?i=super.generate(t):i=t.generateConst(this.nodeType,new yt(1,1,1,1)),i}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const Zb=(...r)=>z(new jb(...r));class Kb extends Z{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const Jb=G(Kb),Er=new hs,Xl=new pt;class Xe extends Z{static get type(){return"SceneNode"}constructor(t=Xe.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,s=this.scene!==null?this.scene:t.scene;let i;return e===Xe.BACKGROUND_BLURRINESS?i=Mt("backgroundBlurriness","float",s):e===Xe.BACKGROUND_INTENSITY?i=Mt("backgroundIntensity","float",s):e===Xe.BACKGROUND_ROTATION?i=j("mat4").label("backgroundRotation").setGroup(Q).onRenderUpdate(()=>{const n=s.background;return n!==null&&n.isTexture&&n.mapping!==Iu?(Er.copy(s.backgroundRotation),Er.x*=-1,Er.y*=-1,Er.z*=-1,Xl.makeRotationFromEuler(Er)):Xl.identity(),Xl}):console.error("THREE.SceneNode: Unknown scope:",e),i}}Xe.BACKGROUND_BLURRINESS="backgroundBlurriness";Xe.BACKGROUND_INTENSITY="backgroundIntensity";Xe.BACKGROUND_ROTATION="backgroundRotation";const d7=G(Xe,Xe.BACKGROUND_BLURRINESS),mu=G(Xe,Xe.BACKGROUND_INTENSITY),g7=G(Xe,Xe.BACKGROUND_ROTATION);class Qb extends ii{static get type(){return"StorageTextureNode"}constructor(t,e,s=null){super(t,e),this.storeNode=s,this.isStorageTextureNode=!0,this.access=Ie.WRITE_ONLY}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);e.storeNode=this.storeNode}setAccess(t){return this.access=t,this}generate(t,e){let s;return this.storeNode!==null?s=this.generateStore(t):s=super.generate(t,e),s}toReadWrite(){return this.setAccess(Ie.READ_WRITE)}toReadOnly(){return this.setAccess(Ie.READ_ONLY)}toWriteOnly(){return this.setAccess(Ie.WRITE_ONLY)}generateStore(t){const e=t.getNodeProperties(this),{uvNode:s,storeNode:i}=e,n=super.generate(t,"property"),o=s.build(t,"uvec2"),a=i.build(t,"vec4"),c=t.generateTextureStore(t,n,o,a);t.addLineFlowCode(c,this)}}const f7=L(Qb),tw=(r,t,e)=>{const s=f7(r,t,e);return e!==null&&s.append(),s};class ew extends Xc{static get type(){return"UserDataNode"}constructor(t,e,s=null){super(t,e,s),this.userData=s}updateReference(t){return this.reference=this.userData!==null?this.userData:t.object.userData,this.reference}}const sw=(r,t,e)=>z(new ew(r,t,e)),Dh=new WeakMap;class iw extends te{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=st.OBJECT,this.updateAfterType=st.OBJECT,this.previousModelWorldMatrix=j(new pt),this.previousProjectionMatrix=j(new pt).setGroup(Q),this.previousCameraViewMatrix=j(new pt)}setProjectionMatrix(t){this.projectionMatrix=t}update({frameId:t,camera:e,object:s}){const i=Ph(s);this.previousModelWorldMatrix.value.copy(i);const n=m7(e);n.frameId!==t&&(n.frameId=t,n.previousProjectionMatrix===void 0?(n.previousProjectionMatrix=new pt,n.previousCameraViewMatrix=new pt,n.currentProjectionMatrix=new pt,n.currentCameraViewMatrix=new pt,n.previousProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.previousCameraViewMatrix.copy(e.matrixWorldInverse)):(n.previousProjectionMatrix.copy(n.currentProjectionMatrix),n.previousCameraViewMatrix.copy(n.currentCameraViewMatrix)),n.currentProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.currentCameraViewMatrix.copy(e.matrixWorldInverse),this.previousProjectionMatrix.value.copy(n.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(n.previousCameraViewMatrix))}updateAfter({object:t}){Ph(t).copy(t.matrixWorld)}setup(){const t=this.projectionMatrix===null?hn:j(this.projectionMatrix),e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),s=t.mul(oo).mul(Xt),i=this.previousProjectionMatrix.mul(e).mul(dc),n=s.xy.div(s.w),o=i.xy.div(i.w);return ft(n,o)}}function m7(r){let t=Dh.get(r);return t===void 0&&(t={},Dh.set(r,t)),t}function Ph(r,t=0){const e=m7(r);let s=e[t];return s===void 0&&(e[t]=s=new pt),s}const nw=G(iw),y7=B(([r,t])=>Ke(1,r.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),x7=B(([r,t])=>Ke(r.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),b7=B(([r,t])=>r.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),w7=B(([r,t])=>_t(r.mul(2).mul(t),r.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),Gc(.5,r))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ow=B(([r,t])=>{const e=t.a.add(r.a.mul(t.a.oneMinus()));return X(t.rgb.mul(t.a).add(r.rgb.mul(r.a).mul(t.a.oneMinus())).div(e),e)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),rw=(...r)=>(console.warn('THREE.TSL: "burn" has been renamed. Use "blendBurn" instead.'),y7(r)),aw=(...r)=>(console.warn('THREE.TSL: "dodge" has been renamed. Use "blendDodge" instead.'),x7(r)),cw=(...r)=>(console.warn('THREE.TSL: "screen" has been renamed. Use "blendScreen" instead.'),b7(r)),lw=(...r)=>(console.warn('THREE.TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),w7(r)),uw=B(([r])=>tl(r.rgb)),pw=B(([r,t=S(1)])=>t.mix(tl(r.rgb),r.rgb)),hw=B(([r,t=S(1)])=>{const e=ne(r.r,r.g,r.b).div(3),s=r.r.max(r.g.max(r.b)),i=s.sub(e).mul(t).mul(-3);return _t(r.rgb,s,i)}),dw=B(([r,t=S(1)])=>{const e=F(.57735,.57735,.57735),s=t.cos();return F(r.rgb.mul(s).add(e.cross(r.rgb).mul(t.sin()).add(e.mul(xn(e,r.rgb).mul(s.oneMinus())))))}),tl=(r,t=F(ee.getLuminanceCoefficients(new v)))=>xn(r,t),gw=(r,t)=>_t(F(0),r,tl(r).sub(t).max(0)),fw=B(([r,t=F(1),e=F(0),s=F(1),i=S(1),n=F(ee.getLuminanceCoefficients(new v,Mi))])=>{const o=r.rgb.dot(F(n)),a=Jt(r.rgb.mul(t).add(e),0).toVar(),c=a.pow(s).toVar();return rt(a.r.greaterThan(0),()=>{a.r.assign(c.r)}),rt(a.g.greaterThan(0),()=>{a.g.assign(c.g)}),rt(a.b.greaterThan(0),()=>{a.b.assign(c.b)}),a.assign(o.add(a.sub(o).mul(i))),X(a.rgb,r.a)});class mw extends te{static get type(){return"PosterizeNode"}constructor(t,e){super(),this.sourceNode=t,this.stepsNode=e}setup(){const{sourceNode:t,stepsNode:e}=this;return t.mul(e).floor().div(e)}}const yw=L(mw),xw=new q;class _7 extends ii{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return t.object.isQuadMesh&&this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class Ih extends _7{static get type(){return"PassMultipleTextureNode"}constructor(t,e,s=!1){super(t,null),this.textureName=e,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class ai extends te{static get type(){return"PassNode"}constructor(t,e,s,i={}){super("vec4"),this.scope=t,this.scene=e,this.camera=s,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const n=new eo;n.isRenderTargetTexture=!0,n.name="depth";const o=new fn(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Bs,...i});o.texture.name="output",o.depthTexture=n,this.renderTarget=o,this.updateBeforeType=st.FRAME,this._textures={output:o.texture,depth:n},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=j(0),this._cameraFar=j(0),this._mrt=null,this.isPassNode=!0}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.isRenderTargetTexture=!0,e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),e.isRenderTargetTexture=!0,this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const s=this._textures[t],i=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[i]=e,this._textures[t]=e,this._previousTextures[t]=s,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=z(new Ih(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=z(new Ih(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const s=this._cameraNear,i=this._cameraFar;this._viewZNodes[t]=e=Gp(this.getTextureNode(t),s,i)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const s=this._cameraNear,i=this._cameraFar,n=this.getViewZNode(t);this._linearDepthNodes[t]=e=tr(n,s,i)}return e}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,t.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===ai.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:s,camera:i}=this;this._pixelRatio=e.getPixelRatio();const n=e.getSize(xw);this.setSize(n.width,n.height);const o=e.getRenderTarget(),a=e.getMRT();this._cameraNear.value=i.near,this._cameraFar.value=i.far;for(const c in this._previousTextures)this.toggleTexture(c);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(s,i),e.setRenderTarget(o),e.setMRT(a)}setSize(t,e){this._width=t,this._height=e;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget.setSize(s,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}ai.COLOR="color";ai.DEPTH="depth";const bw=(r,t,e)=>z(new ai(ai.COLOR,r,t,e)),ww=(r,t)=>z(new _7(r,t)),_w=(r,t)=>z(new ai(ai.DEPTH,r,t));class Tw extends ai{static get type(){return"ToonOutlinePassNode"}constructor(t,e,s,i,n){super(ai.COLOR,t,e),this.colorNode=s,this.thicknessNode=i,this.alphaNode=n,this._materialCache=new WeakMap}updateBefore(t){const{renderer:e}=t,s=e.getRenderObjectFunction();e.setRenderObjectFunction((i,n,o,a,c,l,u,p)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const h=this._getOutlineMaterial(c);e.renderObject(i,n,o,a,h,l,u,p)}e.renderObject(i,n,o,a,c,l,u,p)}),super.updateBefore(t),e.setRenderObjectFunction(s)}_createMaterial(){const t=new Qt;t.isMeshToonOutlineMaterial=!0,t.name="Toon_Outline",t.side=je;const e=Je.negate(),s=hn.mul(oo),i=S(1),n=s.mul(X(Xt,1)),o=s.mul(X(Xt.add(e),1)),a=Bi(n.sub(o));return t.vertexNode=n.add(a.mul(this.thicknessNode).mul(n.w).mul(i)),t.colorNode=X(this.colorNode,this.alphaNode),t}_getOutlineMaterial(t){let e=this._materialCache.get(t);return e===void 0&&(e=this._createMaterial(),this._materialCache.set(t,e)),e}}const Sw=(r,t,e=new W(0,0,0),s=.003,i=1)=>z(new Tw(r,t,z(e),z(s),z(i))),T7=B(([r,t])=>r.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),S7=B(([r,t])=>(r=r.mul(t),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),v7=B(([r,t])=>{r=r.mul(t),r=r.sub(.004).max(0);const e=r.mul(r.mul(6.2).add(.5)),s=r.mul(r.mul(6.2).add(1.7)).add(.06);return e.div(s).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),vw=B(([r])=>{const t=r.mul(r.add(.0245786)).sub(90537e-9),e=r.mul(r.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),M7=B(([r,t])=>{const e=ze(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=ze(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(t).div(.6),r=e.mul(r),r=vw(r),r=s.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Mw=ze(F(1.6605,-.1246,-.0182),F(-.5876,1.1329,-.1006),F(-.0728,-.0083,1.1187)),Aw=ze(F(.6274,.0691,.0164),F(.3293,.9195,.088),F(.0433,.0113,.8956)),Nw=B(([r])=>{const t=F(r).toVar(),e=F(t.mul(t)).toVar(),s=F(e.mul(e)).toVar();return S(15.5).mul(s.mul(e)).sub(it(40.14,s.mul(t))).add(it(31.96,s).sub(it(6.868,e.mul(t))).add(it(.4298,e).add(it(.1191,t).sub(.00232))))}),A7=B(([r,t])=>{const e=F(r).toVar(),s=ze(F(.856627153315983,.137318972929847,.11189821299995),F(.0951212405381588,.761241990602591,.0767994186031903),F(.0482516061458583,.101439036467562,.811302368396859)),i=ze(F(1.1271005818144368,-.1413297634984383,-.14132976349843826),F(-.11060664309660323,1.157823702216272,-.11060664309660294),F(-.016493938717834573,-.016493938717834257,1.2519364065950405)),n=S(-12.47393),o=S(4.026069);return e.mulAssign(t),e.assign(Aw.mul(e)),e.assign(s.mul(e)),e.assign(Jt(e,1e-10)),e.assign(Js(e)),e.assign(e.sub(n).div(o.sub(n))),e.assign(ei(e,0,1)),e.assign(Nw(e)),e.assign(i.mul(e)),e.assign(Fs(Jt(F(0),e),F(2.2))),e.assign(Mw.mul(e)),e.assign(ei(e,0,1)),e}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),N7=B(([r,t])=>{const e=S(.76),s=S(.15);r=r.mul(t);const i=Ke(r.r,Ke(r.g,r.b)),n=Ce(i.lessThan(.08),i.sub(it(6.25,i.mul(i))),.04);r.subAssign(n);const o=Jt(r.r,Jt(r.g,r.b));rt(o.lessThan(e),()=>r);const a=ft(1,e),c=ft(1,a.mul(a).div(o.add(a.sub(e))));r.mulAssign(c.div(o));const l=ft(1,Ls(1,s.mul(o.sub(c)).add(1)));return _t(r,F(c),l)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class ae extends Z{static get type(){return"CodeNode"}constructor(t="",e=[],s=""){super("code"),this.isCodeNode=!0,this.code=t,this.language=s,this.includes=e}isGlobal(){return!0}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const i of e)i.build(t);const s=t.getCodeFromNode(this,this.getNodeType(t));return s.code=this.code,s.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}const el=L(ae),Cw=(r,t)=>el(r,t,"js"),Rw=(r,t)=>el(r,t,"wgsl"),Fw=(r,t)=>el(r,t,"glsl");class C7 extends ae{static get type(){return"FunctionNode"}constructor(t="",e=[],s=""){super(t,e,s)}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let s=e.nodeFunction;return s===void 0&&(s=t.parser.parseFunction(this.code),e.nodeFunction=s),s}generate(t,e){super.generate(t);const s=this.getNodeFunction(t),i=s.name,n=s.type,o=t.getCodeFromNode(this,n);i!==""&&(o.name=i);const a=t.getPropertyName(o),c=this.getNodeFunction(t).getCode(a);return o.code=c+`
`,e==="property"?a:t.format(`${a}()`,n,e)}}const R7=(r,t=[],e="")=>{for(let n=0;n<t.length;n++){const o=t[n];typeof o=="function"&&(t[n]=o.functionNode)}const s=z(new C7(r,t,e)),i=(...n)=>s.call(...n);return i.functionNode=s,i},Ew=(r,t)=>R7(r,t,"glsl"),Bw=(r,t)=>R7(r,t,"wgsl");class Dw extends Z{static get type(){return"ScriptableValueNode"}constructor(t=null){super(),this._value=t,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new gn,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(t){this._value!==t&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const t=this.value;if(t&&this._cache===null&&this.inputType==="URL"&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&t.value!==null&&t.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof t.value=="string"||this.inputType==="Number"&&typeof t.value=="number"||this.inputType==="Vector2"&&t.value.isVector2||this.inputType==="Vector3"&&t.value.isVector3||this.inputType==="Vector4"&&t.value.isVector4||this.inputType==="Color"&&t.value.isColor||this.inputType==="Matrix3"&&t.value.isMatrix3||this.inputType==="Matrix4"&&t.value.isMatrix4))return t.value;return this._cache||t}getNodeType(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}setup(){return this.value&&this.value.isNode?this.value:S()}serialize(t){super.serialize(t),this.value!==null?this.inputType==="ArrayBuffer"?t.value=k5(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}deserialize(t){super.deserialize(t);let e=null;t.value!==null&&(t.inputType==="ArrayBuffer"?e=O5(t.value):t.inputType==="Texture"?e=t.meta.textures[t.value]:e=t.meta.nodes[t.value]||null),this.value=e,this.inputType=t.inputType,this.outputType=t.outputType}}const $0=L(Dw);class F7 extends Map{get(t,e=null,...s){if(this.has(t))return super.get(t);if(e!==null){const i=e(...s);return this.set(t,i),i}}}class Pw{constructor(t){this.scriptableNode=t}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(t){return this.scriptableNode.getInputLayout(t)}get(t){const e=this.parameters[t];return e?e.getValue():null}}const H0=new F7;class Iw extends Z{static get type(){return"ScriptableNode"}constructor(t=null,e={}){super(),this.codeNode=t,this.parameters=e,this._local=new F7,this._output=$0(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(t,e){return this._local.set(t,e)}getLocal(t){return this._local.get(t)}onRefresh(){this._refresh()}getInputLayout(t){for(const e of this.getLayout())if(e.inputType&&(e.id===t||e.name===t))return e}getOutputLayout(t){for(const e of this.getLayout())if(e.outputType&&(e.id===t||e.name===t))return e}setOutput(t,e){const s=this._outputs;return s[t]===void 0?s[t]=$0(e):s[t].value=e,this}getOutput(t){return this._outputs[t]}getParameter(t){return this.parameters[t]}setParameter(t,e){const s=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),s[t]=e,s[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),s[t]=e,s[t].events.addEventListener("refresh",this.onRefresh)):s[t]===void 0?(s[t]=$0(e),s[t].events.addEventListener("refresh",this.onRefresh)):s[t].value=e,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(t){let e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const t of Object.keys(this.parameters))this.deleteParameter(t);return this.needsUpdate=!0,this}call(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i(...e)}async callAsync(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...e):i(...e)}getNodeType(t){return this.getDefaultOutputNode().getNodeType(t)}refresh(t=null){t!==null?this.getOutput(t).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const t=()=>this.refresh(),e=(l,u)=>this.setOutput(l,u),s=new Pw(this),i=H0.get("THREE"),n=H0.get("TSL"),o=this.getMethod(this.codeNode),a=[s,this._local,H0,t,e,i,n];this._object=o(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const l of c.elements){const u=l.id||l.name;l.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=l.inputType),l.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=l.outputType)}return this._object}deserialize(t){super.deserialize(t);for(const e in this.parameters){let s=this.parameters[e];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const t=this.getDefaultOutput().value;return t&&t.isNode?t:S()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const t=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),i="var "+s+`; var output = {};
`,n=`
return { ...output, `+s+" };",o=i+this.codeNode.code+n;return this._method=new Function(...t,o),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(t){const e=[P5(this.source),this.getDefaultOutputNode().getCacheKey(t)];for(const s in this.parameters)e.push(this.parameters[s].getCacheKey(t));return np(e)}set needsUpdate(t){t===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const Lw=L(Iw);class s2 extends Z{static get type(){return"FogNode"}constructor(t,e){super("float"),this.isFogNode=!0,this.colorNode=t,this.factorNode=e}getViewZNode(t){let e;const s=t.context.getViewZ;return s!==void 0&&(e=s(this)),(e||le.z).negate()}setup(){return this.factorNode}}const Uw=L(s2);class zw extends s2{static get type(){return"FogRangeNode"}constructor(t,e,s){super(t),this.isFogRangeNode=!0,this.nearNode=e,this.farNode=s}setup(t){const e=this.getViewZNode(t);return Di(this.nearNode,this.farNode,e)}}const E7=L(zw);class Vw extends s2{static get type(){return"FogExp2Node"}constructor(t,e){super(t),this.isFogExp2Node=!0,this.densityNode=e}setup(t){const e=this.getViewZNode(t),s=this.densityNode;return s.mul(s,e,e).negate().exp().oneMinus()}}const B7=L(Vw);let Mn=null,An=null;class kw extends Z{static get type(){return"RangeNode"}constructor(t=S(),e=S()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=t.getTypeLength(tn(this.minNode.value)),s=t.getTypeLength(tn(this.maxNode.value));return e>s?e:s}getNodeType(t){return t.object.count>1?t.getTypeFromLength(this.getVectorLength(t)):"float"}setup(t){const e=t.object;let s=null;if(e.count>1){const i=this.minNode.value,n=this.maxNode.value,o=t.getTypeLength(tn(i)),a=t.getTypeLength(tn(n));Mn=Mn||new yt,An=An||new yt,Mn.setScalar(0),An.setScalar(0),o===1?Mn.setScalar(i):i.isColor?Mn.set(i.r,i.g,i.b):Mn.set(i.x,i.y,i.z||0,i.w||0),a===1?An.setScalar(n):n.isColor?An.set(n.r,n.g,n.b):An.set(n.x,n.y,n.z||0,n.w||0);const c=4,l=c*e.count,u=new Float32Array(l);for(let h=0;h<l;h++){const d=h%c,g=Mn.getComponent(d),f=An.getComponent(d);u[h]=Pe.lerp(g,f,Math.random())}const p=this.getNodeType(t);if(e.count<=4096)s=Pa(u,"vec4",e.count).element(za).convert(p);else{const h=new la(u,4);t.geometry.setAttribute("__range"+this.id,h),s=hc(h).convert(p)}}else s=S(0);return s}}const Ow=L(kw);class Gw extends Z{static get type(){return"ComputeBuiltinNode"}constructor(t,e){super(e),this._builtinName=t}getHash(t){return this.getBuiltinName(t)}getNodeType(){return this.nodeType}setBuiltinName(t){return this._builtinName=t,this}getBuiltinName(){return this._builtinName}hasBuiltin(t){t.hasBuiltin(this._builtinName)}generate(t,e){const s=this.getBuiltinName(t),i=this.getNodeType(t);return t.shaderStage==="compute"?t.format(s,i,e):(console.warn(`ComputeBuiltinNode: Compute built-in value ${s} can not be accessed in the ${t.shaderStage} stage`),t.generateConst(i))}serialize(t){super.serialize(t),t.global=this.global,t._builtinName=this._builtinName}deserialize(t){super.deserialize(t),this.global=t.global,this._builtinName=t._builtinName}}const sl=(r,t)=>z(new Gw(r,t)),Ww=sl("numWorkgroups","uvec3"),$w=sl("workgroupId","uvec3"),Hw=sl("localId","uvec3"),qw=sl("subgroupSize","uint");class Yw extends Z{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:s}=t;s.backend.isWebGLBackend===!0?t.addFlowCode(`	// ${e}Barrier 
`):t.addLineFlowCode(`${e}Barrier()`,this)}}const i2=L(Yw),Xw=()=>i2("workgroup").append(),jw=()=>i2("storage").append(),Zw=()=>i2("texture").append();class Kw extends no{constructor(t,e){super(t,e),this.isWorkgroupInfoElementNode=!0}generate(t,e){let s;const i=t.context.assign;if(s=super.generate(t),i!==!0){const n=this.getNodeType(t);s=t.format(s,n,e)}return s}}class Jw extends Z{constructor(t,e,s=0){super(e),this.bufferType=e,this.bufferCount=s,this.isWorkgroupInfoNode=!0,this.scope=t}label(t){return this.name=t,this}getHash(){return this.uuid}setScope(t){return this.scope=t,this}getInputType(){return`${this.scope}Array`}element(t){return z(new Kw(this,t))}generate(t){return t.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const Qw=(r,t)=>z(new Jw("Workgroup",r,t));class _e extends te{static get type(){return"AtomicFunctionNode"}constructor(t,e,s,i=null){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=s,this.storeNode=i}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=this.method,s=this.getNodeType(t),i=this.getInputType(t),n=this.pointerNode,o=this.valueNode,a=[];a.push(`&${n.build(t,i)}`),a.push(o.build(t,i));const c=`${t.getMethod(e,s)}( ${a.join(", ")} )`;if(this.storeNode!==null){const l=this.storeNode.build(t,i);t.addLineFlowCode(`${l} = ${c}`,this)}else t.addLineFlowCode(c,this)}}_e.ATOMIC_LOAD="atomicLoad";_e.ATOMIC_STORE="atomicStore";_e.ATOMIC_ADD="atomicAdd";_e.ATOMIC_SUB="atomicSub";_e.ATOMIC_MAX="atomicMax";_e.ATOMIC_MIN="atomicMin";_e.ATOMIC_AND="atomicAnd";_e.ATOMIC_OR="atomicOr";_e.ATOMIC_XOR="atomicXor";const t_=L(_e),Li=(r,t,e,s)=>{const i=t_(r,t,e,s);return i.append(),i},e_=(r,t,e=null)=>Li(_e.ATOMIC_STORE,r,t,e),s_=(r,t,e=null)=>Li(_e.ATOMIC_ADD,r,t,e),i_=(r,t,e=null)=>Li(_e.ATOMIC_SUB,r,t,e),n_=(r,t,e=null)=>Li(_e.ATOMIC_MAX,r,t,e),o_=(r,t,e=null)=>Li(_e.ATOMIC_MIN,r,t,e),r_=(r,t,e=null)=>Li(_e.ATOMIC_AND,r,t,e),a_=(r,t,e=null)=>Li(_e.ATOMIC_OR,r,t,e),c_=(r,t,e=null)=>Li(_e.ATOMIC_XOR,r,t,e);let _0;function ka(r){_0=_0||new WeakMap;let t=_0.get(r);return t===void 0&&_0.set(r,t={}),t}function n2(r){const t=ka(r);return t.shadowMatrix||(t.shadowMatrix=j("mat4").setGroup(Q).onRenderUpdate(()=>(r.shadow.updateMatrices(r),r.shadow.matrix)))}function D7(r){const t=ka(r);if(t.projectionUV===void 0){const e=n2(r).mul(Ci);t.projectionUV=e.xyz.div(e.w)}return t.projectionUV}function o2(r){const t=ka(r);return t.position||(t.position=j(new v).setGroup(Q).onRenderUpdate((e,s)=>s.value.setFromMatrixPosition(r.matrixWorld)))}function P7(r){const t=ka(r);return t.targetPosition||(t.targetPosition=j(new v).setGroup(Q).onRenderUpdate((e,s)=>s.value.setFromMatrixPosition(r.target.matrixWorld)))}function il(r){const t=ka(r);return t.viewPosition||(t.viewPosition=j(new v).setGroup(Q).onRenderUpdate(({camera:e},s)=>{s.value=s.value||new v,s.value.setFromMatrixPosition(r.matrixWorld),s.value.applyMatrix4(e.matrixWorldInverse)}))}const r2=r=>ss.transformDirection(o2(r).sub(P7(r))),l_=r=>r.sort((t,e)=>t.id-e.id),u_=(r,t)=>{for(const e of t)if(e.isAnalyticLightNode&&e.light.id===r)return e;return null},jl=new WeakMap;class a2 extends Z{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=F().toVar("totalDiffuse"),this.totalSpecularNode=F().toVar("totalSpecular"),this.outgoingLightNode=F().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(t){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(t);const e=[];for(const s of this._lightNodes)e.push(s.getSelf().getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getDataFromNode(this);for(const s of e.nodes)s.build(t)}setupLightsNode(t){const e=[],s=this._lightNodes,i=l_(this._lights),n=t.renderer.library;for(const o of i)if(o.isNode)e.push(z(o));else{let a=null;if(s!==null&&(a=u_(o.id,s)),a===null){const c=n.getLightNodeClass(o.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${o.constructor.name}`);continue}let l=null;jl.has(o)?l=jl.get(o):(l=z(new c(o)),jl.set(o,l)),e.push(l)}}this._lightNodes=e}setupLights(t,e){for(const s of e)s.build(t)}setup(t){this._lightNodes===null&&this.setupLightsNode(t);const e=t.context,s=e.lightingModel;let i=this.outgoingLightNode;if(s){const{_lightNodes:n,totalDiffuseNode:o,totalSpecularNode:a}=this;e.outgoingLight=i;const c=t.addStack(),l=t.getDataFromNode(this);l.nodes=c.nodes,s.start(e,c,t),this.setupLights(t,n),s.indirect(e,c,t);const{backdrop:u,backdropAlpha:p}=e,{directDiffuse:h,directSpecular:d,indirectDiffuse:g,indirectSpecular:f}=e.reflectedLight;let y=h.add(g);u!==null&&(p!==null?y=F(p.mix(y,u)):y=F(u),e.material.transparent=!0),o.assign(y),a.assign(d.add(f)),i.assign(o.add(a)),s.finish(e,c,t),i=i.bypass(t.removeStack())}return i}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const p_=(r=[])=>z(new a2).setLights(r),Lh=new WeakMap,Uh=F().toVar("shadowWorldPosition"),h_=B(([r,t,e])=>{let s=Ci.sub(r).length();return s=s.sub(t).div(e.sub(t)),s=s.saturate(),s}),d_=r=>{const t=r.shadow.camera,e=Mt("near","float",t).setGroup(Q),s=Mt("far","float",t).setGroup(Q),i=F8(r);return h_(i,e,s)},g_=r=>{let t=Lh.get(r);if(t===void 0){const e=r.isPointLight?d_(r):null;t=new Qt,t.colorNode=X(0,0,0,1),t.depthNode=e,t.isShadowNodeMaterial=!0,t.blending=Hn,t.name="ShadowMaterial",Lh.set(r,t)}return t},I7=B(({depthTexture:r,shadowCoord:t})=>dt(r,t.xy).compare(t.z)),L7=B(({depthTexture:r,shadowCoord:t,shadow:e})=>{const s=(f,y)=>dt(r,f).compare(y),i=Mt("mapSize","vec2",e).setGroup(Q),n=Mt("radius","float",e).setGroup(Q),o=k(1).div(i),a=o.x.negate().mul(n),c=o.y.negate().mul(n),l=o.x.mul(n),u=o.y.mul(n),p=a.div(2),h=c.div(2),d=l.div(2),g=u.div(2);return ne(s(t.xy.add(k(a,c)),t.z),s(t.xy.add(k(0,c)),t.z),s(t.xy.add(k(l,c)),t.z),s(t.xy.add(k(p,h)),t.z),s(t.xy.add(k(0,h)),t.z),s(t.xy.add(k(d,h)),t.z),s(t.xy.add(k(a,0)),t.z),s(t.xy.add(k(p,0)),t.z),s(t.xy,t.z),s(t.xy.add(k(d,0)),t.z),s(t.xy.add(k(l,0)),t.z),s(t.xy.add(k(p,g)),t.z),s(t.xy.add(k(0,g)),t.z),s(t.xy.add(k(d,g)),t.z),s(t.xy.add(k(a,u)),t.z),s(t.xy.add(k(0,u)),t.z),s(t.xy.add(k(l,u)),t.z)).mul(1/17)}),U7=B(({depthTexture:r,shadowCoord:t,shadow:e})=>{const s=(u,p)=>dt(r,u).compare(p),i=Mt("mapSize","vec2",e).setGroup(Q),n=k(1).div(i),o=n.x,a=n.y,c=t.xy,l=Ii(c.mul(i).add(.5));return c.subAssign(l.mul(n)),ne(s(c,t.z),s(c.add(k(o,0)),t.z),s(c.add(k(0,a)),t.z),s(c.add(n),t.z),_t(s(c.add(k(o.negate(),0)),t.z),s(c.add(k(o.mul(2),0)),t.z),l.x),_t(s(c.add(k(o.negate(),a)),t.z),s(c.add(k(o.mul(2),a)),t.z),l.x),_t(s(c.add(k(0,a.negate())),t.z),s(c.add(k(0,a.mul(2))),t.z),l.y),_t(s(c.add(k(o,a.negate())),t.z),s(c.add(k(o,a.mul(2))),t.z),l.y),_t(_t(s(c.add(k(o.negate(),a.negate())),t.z),s(c.add(k(o.mul(2),a.negate())),t.z),l.x),_t(s(c.add(k(o.negate(),a.mul(2))),t.z),s(c.add(k(o.mul(2),a.mul(2))),t.z),l.x),l.y)).mul(1/9)}),z7=B(({depthTexture:r,shadowCoord:t})=>{const e=S(1).toVar(),s=dt(r).uv(t.xy).rg,i=Gc(t.z,s.x);return rt(i.notEqual(S(1)),()=>{const n=t.z.sub(s.x),o=Jt(0,s.y.mul(s.y));let a=o.div(o.add(n.mul(n)));a=ei(ft(a,.3).div(.95-.3)),e.assign(ei(Jt(i,a)))}),e}),f_=B(({samples:r,radius:t,size:e,shadowPass:s})=>{const i=S(0).toVar(),n=S(0).toVar(),o=r.lessThanEqual(S(1)).select(S(0),S(2).div(r.sub(1))),a=r.lessThanEqual(S(1)).select(S(0),S(-1));St({start:N(0),end:N(r),type:"int",condition:"<"},({i:l})=>{const u=a.add(S(l).mul(o)),p=s.uv(ne(Va.xy,k(0,u).mul(t)).div(e)).x;i.addAssign(p),n.addAssign(p.mul(p))}),i.divAssign(r),n.divAssign(r);const c=ci(n.sub(i.mul(i)));return k(i,c)}),m_=B(({samples:r,radius:t,size:e,shadowPass:s})=>{const i=S(0).toVar(),n=S(0).toVar(),o=r.lessThanEqual(S(1)).select(S(0),S(2).div(r.sub(1))),a=r.lessThanEqual(S(1)).select(S(0),S(-1));St({start:N(0),end:N(r),type:"int",condition:"<"},({i:l})=>{const u=a.add(S(l).mul(o)),p=s.uv(ne(Va.xy,k(u,0).mul(t)).div(e));i.addAssign(p.x),n.addAssign(ne(p.y.mul(p.y),p.x.mul(p.x)))}),i.divAssign(r),n.divAssign(r);const c=ci(n.sub(i.mul(i)));return k(i,c)}),y_=[I7,L7,U7,z7],T0=new e2;class V7 extends Z{static get type(){return"ShadowNode"}constructor(t,e=null){super(),this.light=t,this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=st.RENDER,this._node=null,this.isShadowNode=!0}setupShadowFilter(t,{filterFn:e,depthTexture:s,shadowCoord:i,shadow:n}){const o=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),a=e({depthTexture:s,shadowCoord:i,shadow:n});return o.select(a,S(1))}setupShadowCoord(t,e){const{shadow:s}=this,{renderer:i}=t,n=Mt("bias","float",s).setGroup(Q);let o=e,a;if(s.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)o=o.xyz.div(o.w),a=o.z,i.coordinateSystem===Fi&&(a=a.mul(2).sub(1));else{const c=o.w;o=o.xy.div(c);const l=Mt("near","float",s.camera).setGroup(Q),u=Mt("far","float",s.camera).setGroup(Q);a=Wp(c.negate(),l,u)}return o=F(o.x,o.y.oneMinus(),a.add(n)),o}getShadowFilterFn(t){return y_[t]}setupShadow(t){const{renderer:e}=t,{light:s,shadow:i}=this,n=e.shadowMap.type,o=new eo(i.mapSize.width,i.mapSize.height);o.compareFunction=ku;const a=t.createRenderTarget(i.mapSize.width,i.mapSize.height);if(a.depthTexture=o,i.camera.updateProjectionMatrix(),n===Wa){o.compareFunction=null,this.vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:aa,type:Bs}),this.vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:aa,type:Bs});const x=dt(o),b=dt(this.vsmShadowMapVertical.texture),w=Mt("blurSamples","float",i).setGroup(Q),_=Mt("radius","float",i).setGroup(Q),T=Mt("mapSize","vec2",i).setGroup(Q);let M=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Qt);M.fragmentNode=f_({samples:w,radius:_,size:T,shadowPass:x}).context(t.getSharedContext()),M.name="VSMVertical",M=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Qt),M.fragmentNode=m_({samples:w,radius:_,size:T,shadowPass:b}).context(t.getSharedContext()),M.name="VSMHorizontal"}const c=Mt("intensity","float",i).setGroup(Q),l=Mt("normalBias","float",i).setGroup(Q),u=n2(s).mul(Uh.add(Yc.mul(l))),p=this.setupShadowCoord(t,u),h=i.filterNode||this.getShadowFilterFn(e.shadowMap.type)||null;if(h===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const d=n===Wa?this.vsmShadowMapHorizontal.texture:o,g=this.setupShadowFilter(t,{filterFn:h,shadowTexture:a.texture,depthTexture:d,shadowCoord:p,shadow:i}),f=dt(a.texture,p),y=_t(1,g.rgb.mix(f,1),c.mul(f.a)).toVar();return this.shadowMap=a,this.shadow.map=a,y}setup(t){if(t.renderer.shadowMap.enabled!==!1)return B(({material:e})=>{Uh.assign(e.shadowPositionNode||Ci);let s=this._node;return s===null&&(this._node=s=this.setupShadow(t)),t.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),t.material.receivedShadowNode&&(s=t.material.receivedShadowNode(s)),s})()}renderShadow(t){const{shadow:e,shadowMap:s}=this,{renderer:i,scene:n}=t;s.setSize(e.mapSize.width,e.mapSize.height),i.render(n,e.camera)}updateShadow(t){const{shadowMap:e,light:s,shadow:i}=this,{renderer:n,scene:o,camera:a}=t,c=n.shadowMap.type,l=e.depthTexture.version;this._depthVersionCached=l;const u=o.overrideMaterial;o.overrideMaterial=g_(s),i.camera.layers.mask=a.layers.mask;const p=n.getRenderTarget(),h=n.getRenderObjectFunction(),d=n.getMRT();n.setMRT(null),n.setRenderObjectFunction((g,...f)=>{(g.castShadow===!0||g.receiveShadow&&c===Wa)&&n.renderObject(g,...f)}),n.setRenderTarget(e),this.renderShadow(t),n.setRenderObjectFunction(h),s.isPointLight!==!0&&c===Wa&&this.vsmPass(n),n.setRenderTarget(p),n.setMRT(d),o.overrideMaterial=u}vsmPass(t){const{shadow:e}=this;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height),t.setRenderTarget(this.vsmShadowMapVertical),T0.material=this.vsmMaterialVertical,T0.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),T0.material=this.vsmMaterialHorizontal,T0.render(t)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=st.NONE}updateBefore(t){const{shadow:e}=this;(e.needsUpdate||e.autoUpdate)&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}const k7=(r,t)=>z(new V7(r,t));class ao extends dr{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.light=t,this.color=new W,this.colorNode=t&&t.colorNode||j(this.color).setGroup(Q),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=st.FRAME}getCacheKey(){return I5(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadowNode(){return k7(this.light)}setupShadow(t){const{renderer:e}=t;if(e.shadowMap.enabled===!1)return;let s=this.shadowColorNode;if(s===null){const i=this.light.shadow.shadowNode;let n;i!==void 0?n=z(i):n=this.setupShadowNode(t),this.shadowNode=n,this.shadowColorNode=s=this.colorNode.mul(n),this.baseColorNode=this.colorNode}this.colorNode=s}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const c2=B(r=>{const{lightDistance:t,cutoffDistance:e,decayExponent:s}=r,i=t.pow(s).max(.01).reciprocal();return e.greaterThan(0).select(i.mul(t.div(e).pow4().oneMinus().clamp().pow2()),i)}),x_=new W,Gs=B(([r,t])=>{const e=r.toVar(),s=Ft(e),i=Ls(1,Jt(s.x,Jt(s.y,s.z)));s.mulAssign(i),e.mulAssign(i.mul(t.mul(2).oneMinus()));const n=k(e.xy).toVar(),a=t.mul(1.5).oneMinus();return rt(s.z.greaterThanEqual(a),()=>{rt(e.z.greaterThan(0),()=>{n.x.assign(ft(4,e.x))})}).ElseIf(s.x.greaterThanEqual(a),()=>{const c=_a(e.x);n.x.assign(e.z.mul(c).add(c.mul(2)))}).ElseIf(s.y.greaterThanEqual(a),()=>{const c=_a(e.y);n.x.assign(e.x.add(c.mul(2)).add(2)),n.y.assign(e.z.mul(c).sub(2))}),k(.125,.25).mul(n).add(k(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),b_=B(({depthTexture:r,bd3D:t,dp:e,texelSize:s})=>dt(r,Gs(t,s.y)).compare(e)),w_=B(({depthTexture:r,bd3D:t,dp:e,texelSize:s,shadow:i})=>{const n=Mt("radius","float",i).setGroup(Q),o=k(-1,1).mul(n).mul(s.y);return dt(r,Gs(t.add(o.xyy),s.y)).compare(e).add(dt(r,Gs(t.add(o.yyy),s.y)).compare(e)).add(dt(r,Gs(t.add(o.xyx),s.y)).compare(e)).add(dt(r,Gs(t.add(o.yyx),s.y)).compare(e)).add(dt(r,Gs(t,s.y)).compare(e)).add(dt(r,Gs(t.add(o.xxy),s.y)).compare(e)).add(dt(r,Gs(t.add(o.yxy),s.y)).compare(e)).add(dt(r,Gs(t.add(o.xxx),s.y)).compare(e)).add(dt(r,Gs(t.add(o.yxx),s.y)).compare(e)).mul(1/9)}),__=B(({filterFn:r,depthTexture:t,shadowCoord:e,shadow:s})=>{const i=e.xyz.toVar(),n=i.length(),o=j("float").setGroup(Q).onRenderUpdate(()=>s.camera.near),a=j("float").setGroup(Q).onRenderUpdate(()=>s.camera.far),c=Mt("bias","float",s).setGroup(Q),l=j(s.mapSize).setGroup(Q),u=S(1).toVar();return rt(n.sub(a).lessThanEqual(0).and(n.sub(o).greaterThanEqual(0)),()=>{const p=n.sub(o).div(a.sub(o)).toVar();p.addAssign(c);const h=i.normalize(),d=k(1).div(l.mul(k(4,2)));u.assign(r({depthTexture:t,bd3D:h,dp:p,texelSize:d,shadow:s}))}),u}),zh=new yt,Ro=new q,Br=new q;class T_ extends V7{static get type(){return"PointShadowNode"}constructor(t,e=null){super(t,e)}getShadowFilterFn(t){return t===q9?b_:w_}setupShadowCoord(t,e){return e}setupShadowFilter(t,{filterFn:e,shadowTexture:s,depthTexture:i,shadowCoord:n,shadow:o}){return __({filterFn:e,shadowTexture:s,depthTexture:i,shadowCoord:n,shadow:o})}renderShadow(t){const{shadow:e,shadowMap:s,light:i}=this,{renderer:n,scene:o}=t,a=e.getFrameExtents();Br.copy(e.mapSize),Br.multiply(a),s.setSize(Br.width,Br.height),Ro.copy(e.mapSize);const c=n.autoClear,l=n.getClearColor(x_),u=n.getClearAlpha();n.autoClear=!1,n.setClearColor(e.clearColor,e.clearAlpha),n.clear();const p=e.getViewportCount();for(let h=0;h<p;h++){const d=e.getViewport(h),g=Ro.x*d.x,f=Br.y-Ro.y-Ro.y*d.y;zh.set(g,f,Ro.x*d.z,Ro.y*d.w),s.viewport.copy(zh),e.updateMatrices(i,h),n.render(o,e.camera)}n.autoClear=c,n.setClearColor(l,u)}}const S_=(r,t)=>z(new T_(r,t)),O7=B(({color:r,lightViewPosition:t,cutoffDistance:e,decayExponent:s},i)=>{const n=i.context.lightingModel,o=t.sub(le),a=o.normalize(),c=o.length(),l=c2({lightDistance:c,cutoffDistance:e,decayExponent:s}),u=r.mul(l),p=i.context.reflectedLight;n.direct({lightDirection:a,lightColor:u,reflectedLight:p},i.stack,i)});class v_ extends ao{static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=j(0).setGroup(Q),this.decayExponentNode=j(0).setGroup(Q)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setupShadowNode(){return S_(this.light)}setup(t){super.setup(t),O7({color:this.colorNode,lightViewPosition:il(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const M_=B(([r=$t()])=>{const t=r.mul(2),e=t.x.floor(),s=t.y.floor();return e.add(s).mod(2).sign()}),na=B(([r,t,e])=>{const s=S(e).toVar(),i=S(t).toVar(),n=Ei(r).toVar();return Ce(n,i,s)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),yc=B(([r,t])=>{const e=Ei(t).toVar(),s=S(r).toVar();return Ce(e,s.negate(),s)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),ie=B(([r])=>{const t=S(r).toVar();return N(Qs(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),kt=B(([r,t])=>{const e=S(r).toVar();return t.assign(ie(e)),e.sub(S(t))}),A_=B(([r,t,e,s,i,n])=>{const o=S(n).toVar(),a=S(i).toVar(),c=S(s).toVar(),l=S(e).toVar(),u=S(t).toVar(),p=S(r).toVar(),h=S(ft(1,a)).toVar();return ft(1,o).mul(p.mul(h).add(u.mul(a))).add(o.mul(l.mul(h).add(c.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),N_=B(([r,t,e,s,i,n])=>{const o=S(n).toVar(),a=S(i).toVar(),c=F(s).toVar(),l=F(e).toVar(),u=F(t).toVar(),p=F(r).toVar(),h=S(ft(1,a)).toVar();return ft(1,o).mul(p.mul(h).add(u.mul(a))).add(o.mul(l.mul(h).add(c.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),G7=Re([A_,N_]),C_=B(([r,t,e,s,i,n,o,a,c,l,u])=>{const p=S(u).toVar(),h=S(l).toVar(),d=S(c).toVar(),g=S(a).toVar(),f=S(o).toVar(),y=S(n).toVar(),x=S(i).toVar(),b=S(s).toVar(),w=S(e).toVar(),_=S(t).toVar(),T=S(r).toVar(),M=S(ft(1,d)).toVar(),A=S(ft(1,h)).toVar();return S(ft(1,p)).toVar().mul(A.mul(T.mul(M).add(_.mul(d))).add(h.mul(w.mul(M).add(b.mul(d))))).add(p.mul(A.mul(x.mul(M).add(y.mul(d))).add(h.mul(f.mul(M).add(g.mul(d))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),R_=B(([r,t,e,s,i,n,o,a,c,l,u])=>{const p=S(u).toVar(),h=S(l).toVar(),d=S(c).toVar(),g=F(a).toVar(),f=F(o).toVar(),y=F(n).toVar(),x=F(i).toVar(),b=F(s).toVar(),w=F(e).toVar(),_=F(t).toVar(),T=F(r).toVar(),M=S(ft(1,d)).toVar(),A=S(ft(1,h)).toVar();return S(ft(1,p)).toVar().mul(A.mul(T.mul(M).add(_.mul(d))).add(h.mul(w.mul(M).add(b.mul(d))))).add(p.mul(A.mul(x.mul(M).add(y.mul(d))).add(h.mul(f.mul(M).add(g.mul(d))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),W7=Re([C_,R_]),F_=B(([r,t,e])=>{const s=S(e).toVar(),i=S(t).toVar(),n=H(r).toVar(),o=H(n.bitAnd(H(7))).toVar(),a=S(na(o.lessThan(H(4)),i,s)).toVar(),c=S(it(2,na(o.lessThan(H(4)),s,i))).toVar();return yc(a,Ei(o.bitAnd(H(1)))).add(yc(c,Ei(o.bitAnd(H(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),E_=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=S(t).toVar(),a=H(r).toVar(),c=H(a.bitAnd(H(15))).toVar(),l=S(na(c.lessThan(H(8)),o,n)).toVar(),u=S(na(c.lessThan(H(4)),n,na(c.equal(H(12)).or(c.equal(H(14))),o,i))).toVar();return yc(l,Ei(c.bitAnd(H(1)))).add(yc(u,Ei(c.bitAnd(H(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),be=Re([F_,E_]),B_=B(([r,t,e])=>{const s=S(e).toVar(),i=S(t).toVar(),n=hr(r).toVar();return F(be(n.x,i,s),be(n.y,i,s),be(n.z,i,s))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),D_=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=S(t).toVar(),a=hr(r).toVar();return F(be(a.x,o,n,i),be(a.y,o,n,i),be(a.z,o,n,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),gs=Re([B_,D_]),P_=B(([r])=>{const t=S(r).toVar();return it(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),I_=B(([r])=>{const t=S(r).toVar();return it(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),L_=B(([r])=>{const t=F(r).toVar();return it(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),$7=Re([P_,L_]),U_=B(([r])=>{const t=F(r).toVar();return it(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),H7=Re([I_,U_]),cs=B(([r,t])=>{const e=N(t).toVar(),s=H(r).toVar();return s.shiftLeft(e).bitOr(s.shiftRight(N(32).sub(e)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),q7=B(([r,t,e])=>{r.subAssign(e),r.bitXorAssign(cs(e,N(4))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(cs(r,N(6))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(cs(t,N(8))),t.addAssign(r),r.subAssign(e),r.bitXorAssign(cs(e,N(16))),e.addAssign(t),t.subAssign(r),t.bitXorAssign(cs(r,N(19))),r.addAssign(e),e.subAssign(t),e.bitXorAssign(cs(t,N(4))),t.addAssign(r)}),Oa=B(([r,t,e])=>{const s=H(e).toVar(),i=H(t).toVar(),n=H(r).toVar();return s.bitXorAssign(i),s.subAssign(cs(i,N(14))),n.bitXorAssign(s),n.subAssign(cs(s,N(11))),i.bitXorAssign(n),i.subAssign(cs(n,N(25))),s.bitXorAssign(i),s.subAssign(cs(i,N(16))),n.bitXorAssign(s),n.subAssign(cs(s,N(4))),i.bitXorAssign(n),i.subAssign(cs(n,N(14))),s.bitXorAssign(i),s.subAssign(cs(i,N(24))),s}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),Ue=B(([r])=>{const t=H(r).toVar();return S(t).div(S(H(N(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),ti=B(([r])=>{const t=S(r).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),z_=B(([r])=>{const t=N(r).toVar(),e=H(H(1)).toVar(),s=H(H(N(3735928559)).add(e.shiftLeft(H(2))).add(H(13))).toVar();return Oa(s.add(H(t)),s,s)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),V_=B(([r,t])=>{const e=N(t).toVar(),s=N(r).toVar(),i=H(H(2)).toVar(),n=H().toVar(),o=H().toVar(),a=H().toVar();return n.assign(o.assign(a.assign(H(N(3735928559)).add(i.shiftLeft(H(2))).add(H(13))))),n.addAssign(H(s)),o.addAssign(H(e)),Oa(n,o,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),k_=B(([r,t,e])=>{const s=N(e).toVar(),i=N(t).toVar(),n=N(r).toVar(),o=H(H(3)).toVar(),a=H().toVar(),c=H().toVar(),l=H().toVar();return a.assign(c.assign(l.assign(H(N(3735928559)).add(o.shiftLeft(H(2))).add(H(13))))),a.addAssign(H(n)),c.addAssign(H(i)),l.addAssign(H(s)),Oa(a,c,l)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),O_=B(([r,t,e,s])=>{const i=N(s).toVar(),n=N(e).toVar(),o=N(t).toVar(),a=N(r).toVar(),c=H(H(4)).toVar(),l=H().toVar(),u=H().toVar(),p=H().toVar();return l.assign(u.assign(p.assign(H(N(3735928559)).add(c.shiftLeft(H(2))).add(H(13))))),l.addAssign(H(a)),u.addAssign(H(o)),p.addAssign(H(n)),q7(l,u,p),l.addAssign(H(i)),Oa(l,u,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),G_=B(([r,t,e,s,i])=>{const n=N(i).toVar(),o=N(s).toVar(),a=N(e).toVar(),c=N(t).toVar(),l=N(r).toVar(),u=H(H(5)).toVar(),p=H().toVar(),h=H().toVar(),d=H().toVar();return p.assign(h.assign(d.assign(H(N(3735928559)).add(u.shiftLeft(H(2))).add(H(13))))),p.addAssign(H(l)),h.addAssign(H(c)),d.addAssign(H(a)),q7(p,h,d),p.addAssign(H(o)),h.addAssign(H(n)),Oa(p,h,d)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),At=Re([z_,V_,k_,O_,G_]),W_=B(([r,t])=>{const e=N(t).toVar(),s=N(r).toVar(),i=H(At(s,e)).toVar(),n=hr().toVar();return n.x.assign(i.bitAnd(N(255))),n.y.assign(i.shiftRight(N(8)).bitAnd(N(255))),n.z.assign(i.shiftRight(N(16)).bitAnd(N(255))),n}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),$_=B(([r,t,e])=>{const s=N(e).toVar(),i=N(t).toVar(),n=N(r).toVar(),o=H(At(n,i,s)).toVar(),a=hr().toVar();return a.x.assign(o.bitAnd(N(255))),a.y.assign(o.shiftRight(N(8)).bitAnd(N(255))),a.z.assign(o.shiftRight(N(16)).bitAnd(N(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),fs=Re([W_,$_]),H_=B(([r])=>{const t=k(r).toVar(),e=N().toVar(),s=N().toVar(),i=S(kt(t.x,e)).toVar(),n=S(kt(t.y,s)).toVar(),o=S(ti(i)).toVar(),a=S(ti(n)).toVar(),c=S(G7(be(At(e,s),i,n),be(At(e.add(N(1)),s),i.sub(1),n),be(At(e,s.add(N(1))),i,n.sub(1)),be(At(e.add(N(1)),s.add(N(1))),i.sub(1),n.sub(1)),o,a)).toVar();return $7(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),q_=B(([r])=>{const t=F(r).toVar(),e=N().toVar(),s=N().toVar(),i=N().toVar(),n=S(kt(t.x,e)).toVar(),o=S(kt(t.y,s)).toVar(),a=S(kt(t.z,i)).toVar(),c=S(ti(n)).toVar(),l=S(ti(o)).toVar(),u=S(ti(a)).toVar(),p=S(W7(be(At(e,s,i),n,o,a),be(At(e.add(N(1)),s,i),n.sub(1),o,a),be(At(e,s.add(N(1)),i),n,o.sub(1),a),be(At(e.add(N(1)),s.add(N(1)),i),n.sub(1),o.sub(1),a),be(At(e,s,i.add(N(1))),n,o,a.sub(1)),be(At(e.add(N(1)),s,i.add(N(1))),n.sub(1),o,a.sub(1)),be(At(e,s.add(N(1)),i.add(N(1))),n,o.sub(1),a.sub(1)),be(At(e.add(N(1)),s.add(N(1)),i.add(N(1))),n.sub(1),o.sub(1),a.sub(1)),c,l,u)).toVar();return H7(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),l2=Re([H_,q_]),Y_=B(([r])=>{const t=k(r).toVar(),e=N().toVar(),s=N().toVar(),i=S(kt(t.x,e)).toVar(),n=S(kt(t.y,s)).toVar(),o=S(ti(i)).toVar(),a=S(ti(n)).toVar(),c=F(G7(gs(fs(e,s),i,n),gs(fs(e.add(N(1)),s),i.sub(1),n),gs(fs(e,s.add(N(1))),i,n.sub(1)),gs(fs(e.add(N(1)),s.add(N(1))),i.sub(1),n.sub(1)),o,a)).toVar();return $7(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),X_=B(([r])=>{const t=F(r).toVar(),e=N().toVar(),s=N().toVar(),i=N().toVar(),n=S(kt(t.x,e)).toVar(),o=S(kt(t.y,s)).toVar(),a=S(kt(t.z,i)).toVar(),c=S(ti(n)).toVar(),l=S(ti(o)).toVar(),u=S(ti(a)).toVar(),p=F(W7(gs(fs(e,s,i),n,o,a),gs(fs(e.add(N(1)),s,i),n.sub(1),o,a),gs(fs(e,s.add(N(1)),i),n,o.sub(1),a),gs(fs(e.add(N(1)),s.add(N(1)),i),n.sub(1),o.sub(1),a),gs(fs(e,s,i.add(N(1))),n,o,a.sub(1)),gs(fs(e.add(N(1)),s,i.add(N(1))),n.sub(1),o,a.sub(1)),gs(fs(e,s.add(N(1)),i.add(N(1))),n,o.sub(1),a.sub(1)),gs(fs(e.add(N(1)),s.add(N(1)),i.add(N(1))),n.sub(1),o.sub(1),a.sub(1)),c,l,u)).toVar();return H7(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),u2=Re([Y_,X_]),j_=B(([r])=>{const t=S(r).toVar(),e=N(ie(t)).toVar();return Ue(At(e))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Z_=B(([r])=>{const t=k(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar();return Ue(At(e,s))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),K_=B(([r])=>{const t=F(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar(),i=N(ie(t.z)).toVar();return Ue(At(e,s,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),J_=B(([r])=>{const t=X(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar(),i=N(ie(t.z)).toVar(),n=N(ie(t.w)).toVar();return Ue(At(e,s,i,n))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),Q_=Re([j_,Z_,K_,J_]),tT=B(([r])=>{const t=S(r).toVar(),e=N(ie(t)).toVar();return F(Ue(At(e,N(0))),Ue(At(e,N(1))),Ue(At(e,N(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),eT=B(([r])=>{const t=k(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar();return F(Ue(At(e,s,N(0))),Ue(At(e,s,N(1))),Ue(At(e,s,N(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),sT=B(([r])=>{const t=F(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar(),i=N(ie(t.z)).toVar();return F(Ue(At(e,s,i,N(0))),Ue(At(e,s,i,N(1))),Ue(At(e,s,i,N(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),iT=B(([r])=>{const t=X(r).toVar(),e=N(ie(t.x)).toVar(),s=N(ie(t.y)).toVar(),i=N(ie(t.z)).toVar(),n=N(ie(t.w)).toVar();return F(Ue(At(e,s,i,n,N(0))),Ue(At(e,s,i,n,N(1))),Ue(At(e,s,i,n,N(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),Y7=Re([tT,eT,sT,iT]),xc=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=N(t).toVar(),a=F(r).toVar(),c=S(0).toVar(),l=S(1).toVar();return St(o,()=>{c.addAssign(l.mul(l2(a))),l.mulAssign(i),a.mulAssign(n)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),X7=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=N(t).toVar(),a=F(r).toVar(),c=F(0).toVar(),l=S(1).toVar();return St(o,()=>{c.addAssign(l.mul(u2(a))),l.mulAssign(i),a.mulAssign(n)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),nT=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=N(t).toVar(),a=F(r).toVar();return k(xc(a,o,n,i),xc(a.add(F(N(19),N(193),N(17))),o,n,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),oT=B(([r,t,e,s])=>{const i=S(s).toVar(),n=S(e).toVar(),o=N(t).toVar(),a=F(r).toVar(),c=F(X7(a,o,n,i)).toVar(),l=S(xc(a.add(F(N(19),N(193),N(17))),o,n,i)).toVar();return X(c,l)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),rT=B(([r,t,e,s,i,n,o])=>{const a=N(o).toVar(),c=S(n).toVar(),l=N(i).toVar(),u=N(s).toVar(),p=N(e).toVar(),h=N(t).toVar(),d=k(r).toVar(),g=F(Y7(k(h.add(u),p.add(l)))).toVar(),f=k(g.x,g.y).toVar();f.subAssign(.5),f.mulAssign(c),f.addAssign(.5);const y=k(k(S(h),S(p)).add(f)).toVar(),x=k(y.sub(d)).toVar();return rt(a.equal(N(2)),()=>Ft(x.x).add(Ft(x.y))),rt(a.equal(N(3)),()=>Jt(Ft(x.x),Ft(x.y))),xn(x,x)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),aT=B(([r,t,e,s,i,n,o,a,c])=>{const l=N(c).toVar(),u=S(a).toVar(),p=N(o).toVar(),h=N(n).toVar(),d=N(i).toVar(),g=N(s).toVar(),f=N(e).toVar(),y=N(t).toVar(),x=F(r).toVar(),b=F(Y7(F(y.add(d),f.add(h),g.add(p)))).toVar();b.subAssign(.5),b.mulAssign(u),b.addAssign(.5);const w=F(F(S(y),S(f),S(g)).add(b)).toVar(),_=F(w.sub(x)).toVar();return rt(l.equal(N(2)),()=>Ft(_.x).add(Ft(_.y)).add(Ft(_.z))),rt(l.equal(N(3)),()=>Jt(Jt(Ft(_.x),Ft(_.y)),Ft(_.z))),xn(_,_)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),gr=Re([rT,aT]),cT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=k(r).toVar(),o=N().toVar(),a=N().toVar(),c=k(kt(n.x,o),kt(n.y,a)).toVar(),l=S(1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:u})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:p})=>{const h=S(gr(c,u,p,o,a,i,s)).toVar();l.assign(Ke(l,h))})}),rt(s.equal(N(0)),()=>{l.assign(ci(l))}),l}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),lT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=k(r).toVar(),o=N().toVar(),a=N().toVar(),c=k(kt(n.x,o),kt(n.y,a)).toVar(),l=k(1e6,1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:u})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:p})=>{const h=S(gr(c,u,p,o,a,i,s)).toVar();rt(h.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(h)}).ElseIf(h.lessThan(l.y),()=>{l.y.assign(h)})})}),rt(s.equal(N(0)),()=>{l.assign(ci(l))}),l}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),uT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=k(r).toVar(),o=N().toVar(),a=N().toVar(),c=k(kt(n.x,o),kt(n.y,a)).toVar(),l=F(1e6,1e6,1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:u})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:p})=>{const h=S(gr(c,u,p,o,a,i,s)).toVar();rt(h.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(h)}).ElseIf(h.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(h)}).ElseIf(h.lessThan(l.z),()=>{l.z.assign(h)})})}),rt(s.equal(N(0)),()=>{l.assign(ci(l))}),l}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),pT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=F(r).toVar(),o=N().toVar(),a=N().toVar(),c=N().toVar(),l=F(kt(n.x,o),kt(n.y,a),kt(n.z,c)).toVar(),u=S(1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:p})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:h})=>{St({start:-1,end:N(1),name:"z",condition:"<="},({z:d})=>{const g=S(gr(l,p,h,d,o,a,c,i,s)).toVar();u.assign(Ke(u,g))})})}),rt(s.equal(N(0)),()=>{u.assign(ci(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),hT=Re([cT,pT]),dT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=F(r).toVar(),o=N().toVar(),a=N().toVar(),c=N().toVar(),l=F(kt(n.x,o),kt(n.y,a),kt(n.z,c)).toVar(),u=k(1e6,1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:p})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:h})=>{St({start:-1,end:N(1),name:"z",condition:"<="},({z:d})=>{const g=S(gr(l,p,h,d,o,a,c,i,s)).toVar();rt(g.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.y.assign(g)})})})}),rt(s.equal(N(0)),()=>{u.assign(ci(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),gT=Re([lT,dT]),fT=B(([r,t,e])=>{const s=N(e).toVar(),i=S(t).toVar(),n=F(r).toVar(),o=N().toVar(),a=N().toVar(),c=N().toVar(),l=F(kt(n.x,o),kt(n.y,a),kt(n.z,c)).toVar(),u=F(1e6,1e6,1e6).toVar();return St({start:-1,end:N(1),name:"x",condition:"<="},({x:p})=>{St({start:-1,end:N(1),name:"y",condition:"<="},({y:h})=>{St({start:-1,end:N(1),name:"z",condition:"<="},({z:d})=>{const g=S(gr(l,p,h,d,o,a,c,i,s)).toVar();rt(g.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(g)}).ElseIf(g.lessThan(u.z),()=>{u.z.assign(g)})})})}),rt(s.equal(N(0)),()=>{u.assign(ci(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),mT=Re([uT,fT]),yT=B(([r])=>{const t=r.y,e=r.z,s=F().toVar();return rt(t.lessThan(1e-4),()=>{s.assign(F(e,e,e))}).Else(()=>{let i=r.x;i=i.sub(Qs(i)).mul(6).toVar();const n=N(Mp(i)),o=i.sub(S(n)),a=e.mul(t.oneMinus()),c=e.mul(t.mul(o).oneMinus()),l=e.mul(t.mul(o.oneMinus()).oneMinus());rt(n.equal(N(0)),()=>{s.assign(F(e,l,a))}).ElseIf(n.equal(N(1)),()=>{s.assign(F(c,e,a))}).ElseIf(n.equal(N(2)),()=>{s.assign(F(a,e,l))}).ElseIf(n.equal(N(3)),()=>{s.assign(F(a,c,e))}).ElseIf(n.equal(N(4)),()=>{s.assign(F(l,a,e))}).Else(()=>{s.assign(F(e,a,c))})}),s}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),xT=B(([r])=>{const t=F(r).toVar(),e=S(t.x).toVar(),s=S(t.y).toVar(),i=S(t.z).toVar(),n=S(Ke(e,Ke(s,i))).toVar(),o=S(Jt(e,Jt(s,i))).toVar(),a=S(o.sub(n)).toVar(),c=S().toVar(),l=S().toVar(),u=S().toVar();return u.assign(o),rt(o.greaterThan(0),()=>{l.assign(a.div(o))}).Else(()=>{l.assign(0)}),rt(l.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{rt(e.greaterThanEqual(o),()=>{c.assign(s.sub(i).div(a))}).ElseIf(s.greaterThanEqual(o),()=>{c.assign(ne(2,i.sub(e).div(a)))}).Else(()=>{c.assign(ne(4,e.sub(s).div(a)))}),c.mulAssign(1/6),rt(c.lessThan(0),()=>{c.addAssign(1)})}),F(c,l,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),bT=B(([r])=>{const t=F(r).toVar(),e=up(wp(t,F(.04045))).toVar(),s=F(t.div(12.92)).toVar(),i=F(Fs(Jt(t.add(F(.055)),F(0)).div(1.055),F(2.4))).toVar();return _t(s,i,e)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),j7=(r,t)=>{r=S(r),t=S(t);const e=k(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return Di(r.sub(e),r.add(e),t)},Z7=(r,t,e,s)=>_t(r,t,e[s].clamp()),wT=(r,t,e=$t())=>Z7(r,t,e,"x"),_T=(r,t,e=$t())=>Z7(r,t,e,"y"),K7=(r,t,e,s,i)=>_t(r,t,j7(e,s[i])),TT=(r,t,e,s=$t())=>K7(r,t,e,s,"x"),ST=(r,t,e,s=$t())=>K7(r,t,e,s,"y"),vT=(r=1,t=0,e=$t())=>e.mul(r).add(t),MT=(r,t=1)=>(r=S(r),r.abs().pow(t).mul(r.sign())),AT=(r,t=1,e=.5)=>S(r).sub(e).mul(t).add(e),NT=(r=$t(),t=1,e=0)=>l2(r.convert("vec2|vec3")).mul(t).add(e),CT=(r=$t(),t=1,e=0)=>u2(r.convert("vec2|vec3")).mul(t).add(e),RT=(r=$t(),t=1,e=0)=>(r=r.convert("vec2|vec3"),X(u2(r),l2(r.add(k(19,73)))).mul(t).add(e)),FT=(r=$t(),t=1)=>hT(r.convert("vec2|vec3"),t,N(1)),ET=(r=$t(),t=1)=>gT(r.convert("vec2|vec3"),t,N(1)),BT=(r=$t(),t=1)=>mT(r.convert("vec2|vec3"),t,N(1)),DT=(r=$t())=>Q_(r.convert("vec2|vec3")),PT=(r=$t(),t=3,e=2,s=.5,i=1)=>xc(r,N(t),e,s).mul(i),IT=(r=$t(),t=3,e=2,s=.5,i=1)=>nT(r,N(t),e,s).mul(i),LT=(r=$t(),t=3,e=2,s=.5,i=1)=>X7(r,N(t),e,s).mul(i),UT=(r=$t(),t=3,e=2,s=.5,i=1)=>oT(r,N(t),e,s).mul(i),zT=B(([r,t,e])=>{const s=Bi(r).toVar("nDir"),i=ft(S(.5).mul(t.sub(e)),Ci).div(s).toVar("rbmax"),n=ft(S(-.5).mul(t.sub(e)),Ci).div(s).toVar("rbmin"),o=F().toVar("rbminmax");o.x=s.x.greaterThan(S(0)).select(i.x,n.x),o.y=s.y.greaterThan(S(0)).select(i.y,n.y),o.z=s.z.greaterThan(S(0)).select(i.z,n.z);const a=Ke(Ke(o.x,o.y),o.z).toVar("correction");return Ci.add(s.mul(a)).toVar("boxIntersection").sub(e)}),J7=B(([r,t])=>{const e=r.x,s=r.y,i=r.z;let n=t.element(0).mul(.886227);return n=n.add(t.element(1).mul(2*.511664).mul(s)),n=n.add(t.element(2).mul(2*.511664).mul(i)),n=n.add(t.element(3).mul(2*.511664).mul(e)),n=n.add(t.element(4).mul(2*.429043).mul(e).mul(s)),n=n.add(t.element(5).mul(2*.429043).mul(s).mul(i)),n=n.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),n=n.add(t.element(7).mul(2*.429043).mul(e).mul(i)),n=n.add(t.element(8).mul(.429043).mul(it(e,e).sub(it(s,s)))),n});var m=Object.freeze({__proto__:null,BRDF_GGX:uu,BRDF_Lambert:jn,BasicShadowFilter:I7,Break:F6,Continue:Xm,DFGApprox:jp,D_GGX:H6,Discard:M8,EPSILON:N4,F_Schlick:lr,Fn:B,INFINITY:kf,If:rt,Loop:St,NodeAccess:Ie,NodeShaderStage:Q1,NodeType:mf,NodeUpdateType:st,PCFShadowFilter:L7,PCFSoftShadowFilter:U7,PI:pc,PI2:Of,Return:tm,Schlick_to_F0:Y6,ScriptableNodeResources:H0,ShaderNode:Jr,TBNViewMatrix:Un,VSMShadowFilter:z7,V_GGX_SmithCorrelated:$6,abs:Ft,acesFilmicToneMapping:M7,acos:I4,add:ne,addMethodChaining:U,addNodeElement:sm,agxToneMapping:A7,all:_p,alphaT:cc,and:m4,anisotropy:Yi,anisotropyB:On,anisotropyT:Qr,any:C4,append:X5,arrayBuffer:If,asin:P4,assign:l4,atan:L4,atan2:W4,atomicAdd:s_,atomicAnd:r_,atomicFunc:Li,atomicMax:n_,atomicMin:o_,atomicOr:a_,atomicStore:e_,atomicSub:i_,atomicXor:c_,attenuationColor:yp,attenuationDistance:mp,attribute:si,attributeArray:Yb,backgroundBlurriness:d7,backgroundIntensity:mu,backgroundRotation:g7,batch:N6,billboarding:Mb,bitAnd:w4,bitNot:_4,bitOr:T4,bitXor:S4,bitangentGeometry:Nm,bitangentLocal:Cm,bitangentView:G8,bitangentWorld:Rm,bitcast:Gf,blendBurn:y7,blendColor:ow,blendDodge:x7,blendOverlay:w7,blendScreen:b7,blur:t7,bool:Ei,buffer:Pa,bufferAttribute:Ba,bumpMap:q8,burn:rw,bvec2:K5,bvec3:up,bvec4:e4,bypass:w8,cache:ea,call:u4,cameraFar:Ki,cameraNear:Zi,cameraNormalMatrix:cm,cameraPosition:R8,cameraProjectionMatrix:hn,cameraProjectionMatrixInverse:rm,cameraViewMatrix:ss,cameraWorldMatrix:am,cbrt:Z4,cdl:fw,ceil:Oc,checker:M_,cineonToneMapping:v7,clamp:ei,clearcoat:ac,clearcoatRoughness:ba,code:el,color:j5,colorSpaceToWorking:Fp,colorToDirection:Sy,compute:b8,cond:i8,context:$c,convert:i4,convertColorSpace:Hf,convertToTexture:zb,cos:bi,cross:Wc,cubeTexture:cr,dFdx:Sp,dFdy:vp,dashSize:O0,defaultBuildStages:tu,defaultShaderStages:G5,defined:fa,degrees:E4,deltaTime:u7,densityFog:B7,depth:$p,depthPass:_w,difference:q4,diffuseColor:wt,directPointLight:O7,directionToColor:U6,dispersion:xp,distance:H4,div:Ls,dodge:aw,dot:xn,drawIndex:v6,dynamicBufferAttribute:x8,element:s4,emissive:nu,equal:p4,equals:R4,equirectUV:Hp,exp:Tp,exp2:ar,expression:pn,faceDirection:Da,faceForward:Q4,float:S,floor:Qs,fog:Uw,fract:Ii,frameGroup:r4,frameId:fb,frontFacing:B8,fwidth:O4,gain:lb,gapSize:ou,getConstNodeType:Y5,getCurrentStack:lp,getDirection:J6,getDistanceAttenuation:c2,getGeometryRoughness:W6,getNormalFromDepth:kb,getParallaxCorrectNormal:zT,getRoughness:Xp,getScreenPosition:Vb,getShIrradianceAt:J7,getTextureIndex:a7,getViewPosition:ko,glsl:Fw,glslFn:Ew,grayscale:uw,greaterThan:wp,greaterThanEqual:f4,hash:cb,highPrecisionModelNormalViewMatrix:bm,highPrecisionModelViewMatrix:xm,hue:dw,instance:Wm,instanceIndex:za,instancedArray:Xb,instancedBufferAttribute:hc,instancedDynamicBufferAttribute:ru,instancedMesh:A6,int:N,inverseSqrt:B4,invocationLocalIndex:Gm,invocationSubgroupIndex:Om,ior:ta,iridescence:Vc,iridescenceIOR:dp,iridescenceThickness:gp,ivec2:ge,ivec3:J5,ivec4:Q5,js:Cw,label:o8,length:Ni,lengthSq:K4,lessThan:d4,lessThanEqual:g4,lightPosition:o2,lightProjectionUV:D7,lightShadowMatrix:n2,lightTargetDirection:r2,lightTargetPosition:P7,lightViewPosition:il,lightingContext:B6,lights:p_,linearDepth:gc,linearToneMapping:T7,localId:Hw,log:kc,log2:Js,logarithmicDepthToViewZ:cy,loop:jm,luminance:tl,mat2:Uc,mat3:ze,mat4:kn,matcapUV:e7,materialAOMap:T6,materialAlphaTest:Y8,materialAnisotropy:c6,materialAnisotropyVector:Vo,materialAttenuationColor:m6,materialAttenuationDistance:f6,materialClearcoat:s6,materialClearcoatNormal:n6,materialClearcoatRoughness:i6,materialColor:X8,materialDispersion:_6,materialEmissive:Z8,materialIOR:g6,materialIridescence:l6,materialIridescenceIOR:u6,materialIridescenceThickness:p6,materialLightMap:Up,materialLineDashOffset:w6,materialLineDashSize:x6,materialLineGapSize:b6,materialLineScale:y6,materialLineWidth:Um,materialMetalness:t6,materialNormal:e6,materialOpacity:Lp,materialPointWidth:zm,materialReference:Si,materialReflectivity:G0,materialRefractionRatio:I8,materialRotation:o6,materialRoughness:Q8,materialSheen:r6,materialSheenRoughness:a6,materialShininess:j8,materialSpecular:K8,materialSpecularColor:J8,materialSpecularIntensity:lu,materialSpecularStrength:sa,materialThickness:d6,materialTransmission:h6,max:Jt,maxMipLevel:C8,metalness:xa,min:Ke,mix:_t,mixElement:e8,mod:Ap,modInt:bp,modelDirection:dm,modelNormalMatrix:E8,modelPosition:gm,modelScale:fm,modelViewMatrix:oo,modelViewPosition:mm,modelViewProjection:zp,modelWorldMatrix:bs,modelWorldMatrixInverse:ym,morphReference:E6,mrt:c7,mul:it,mx_aastep:j7,mx_cell_noise_float:DT,mx_contrast:AT,mx_fractal_noise_float:PT,mx_fractal_noise_vec2:IT,mx_fractal_noise_vec3:LT,mx_fractal_noise_vec4:UT,mx_hsvtorgb:yT,mx_noise_float:NT,mx_noise_vec3:CT,mx_noise_vec4:RT,mx_ramplr:wT,mx_ramptb:_T,mx_rgbtohsv:xT,mx_safepower:MT,mx_splitlr:TT,mx_splittb:ST,mx_srgb_texture_to_lin_rec709:bT,mx_transform_uv:vT,mx_worley_noise_float:FT,mx_worley_noise_vec2:ET,mx_worley_noise_vec3:BT,negate:U4,neutralToneMapping:N7,nodeArray:Vn,nodeImmutable:G,nodeObject:z,nodeObjects:Ca,nodeProxy:L,normalFlat:D8,normalGeometry:Hc,normalLocal:Je,normalMap:cu,normalView:_s,normalWorld:qc,normalize:Bi,not:x4,notEqual:h4,numWorkgroups:Ww,objectDirection:lm,objectGroup:hp,objectPosition:F8,objectScale:pm,objectViewPosition:hm,objectWorldMatrix:um,oneMinus:z4,or:y4,orthographicDepthToViewZ:ay,oscSawtooth:Tb,oscSine:bb,oscSquare:wb,oscTriangle:_b,output:c4,outputStruct:rb,overlay:lw,overloadingFn:Re,parabola:fu,parallaxDirection:$8,parallaxUV:Em,parameter:ib,pass:bw,passTexture:ww,pcurve:ub,perspectiveDepthToViewZ:Gp,pmremTexture:Zp,pointUV:Jb,pointWidth:Uf,positionGeometry:Ep,positionLocal:Xt,positionPrevious:dc,positionView:le,positionViewDirection:zt,positionWorld:Ci,positionWorldDirection:Bp,posterize:yw,pow:Fs,pow2:Np,pow3:Y4,pow4:X4,property:a4,radians:F4,rand:t8,range:Ow,rangeFog:E7,reciprocal:k4,reference:Mt,referenceBuffer:au,reflect:$4,reflectVector:z8,reflectView:L8,reflector:Db,refract:Cp,refractVector:V8,refractView:U8,reinhardToneMapping:S7,remainder:A4,remap:T8,remapClamp:S8,renderGroup:Q,renderOutput:A8,rendererReference:f8,rotate:Jp,rotateUV:Sb,roughness:Xs,round:V4,rtt:h7,sRGBTransferEOTF:l8,sRGBTransferOETF:u8,sampler:om,saturate:J4,saturation:pw,screen:cw,screenCoordinate:Va,screenSize:Ta,screenUV:oi,scriptable:Lw,scriptableValue:$0,select:Ce,setCurrentStack:ma,shaderStages:eu,shadow:k7,sharedUniformGroup:pp,sheen:Ln,sheenRoughness:zc,shiftLeft:v4,shiftRight:M4,shininess:lc,sign:_a,sin:ls,sinc:pb,skinning:qm,skinningReference:R6,smoothstep:Di,smoothstepElement:s8,specularColor:He,specularF90:wa,spherizeUV:vb,split:Lf,spritesheetUV:Cb,sqrt:ci,stack:W0,step:Gc,storage:Qc,storageBarrier:jw,storageObject:qb,storageTexture:f7,string:Pf,sub:ft,subgroupIndex:km,subgroupSize:qw,tan:D4,tangentGeometry:jc,tangentLocal:Ia,tangentView:La,tangentWorld:O8,temp:c8,texture:dt,texture3D:Bx,textureBarrier:Zw,textureBicubic:Z6,textureCubeUV:Q6,textureLoad:Zt,textureSize:Gn,textureStore:tw,thickness:fp,threshold:gw,time:ro,timerDelta:xb,timerGlobal:yb,timerLocal:mb,toOutputColorSpace:p8,toWorkingColorSpace:h8,toneMapping:m8,toneMappingExposure:y8,toonOutlinePass:Sw,transformDirection:j4,transformNormal:P8,transformNormalToView:Dp,transformedBentNormalView:H8,transformedBitangentView:W8,transformedBitangentWorld:Fm,transformedClearcoatNormalView:Yo,transformedNormalView:Kt,transformedNormalWorld:Yc,transformedTangentView:Ip,transformedTangentWorld:Am,transmission:uc,transpose:G4,tri:Ys,tri3:l7,triNoise3D:hb,triplanarTexture:Fb,triplanarTextures:p7,trunc:Mp,tslFn:Df,uint:H,uniform:j,uniformArray:Ti,uniformGroup:o4,uniforms:Sm,userData:sw,uv:$t,uvec2:Z5,uvec3:hr,uvec4:t4,varying:es,varyingProperty:ya,vec2:k,vec3:F,vec4:X,vectorComponents:io,velocity:nw,vertexColor:Zb,vertexIndex:S6,vibrance:hw,viewZToLogarithmicDepth:Wp,viewZToOrthographicDepth:tr,viewZToPerspectiveDepth:I6,viewport:Vp,viewportBottomLeft:ny,viewportCoordinate:P6,viewportDepthTexture:Op,viewportLinearDepth:ly,viewportMipTexture:kp,viewportResolution:sy,viewportSafeUV:Ab,viewportSharedTexture:Ty,viewportSize:D6,viewportTexture:oy,viewportTopLeft:iy,viewportUV:ey,wgsl:Rw,wgslFn:Bw,workgroupArray:Qw,workgroupBarrier:Xw,workgroupId:$w,workingToColorSpace:d8,xor:b4});const fi=new Qp;class VT extends bn{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,s){const i=this.renderer,n=this.nodes.getBackgroundNode(t)||t.background;let o=!1;if(n===null)i._clearColor.getRGB(fi,Mi),fi.a=i._clearColor.a;else if(n.isColor===!0)n.getRGB(fi,Mi),fi.a=1,o=!0;else if(n.isNode===!0){const a=this.get(t),c=n;fi.copy(i._clearColor);let l=a.backgroundMesh;if(l===void 0){const p=$c(X(c).mul(mu),{getUV:()=>g7.mul(qc),getTextureLevel:()=>d7});let h=zp();h=h.setZ(h.w);const d=new Qt;d.name="Background.material",d.side=je,d.depthTest=!1,d.depthWrite=!1,d.fog=!1,d.lights=!1,d.vertexNode=h,d.colorNode=p,a.backgroundMeshNode=p,a.backgroundMesh=l=new O(new Et(1,32,32),d),l.frustumCulled=!1,l.name="Background.mesh",l.onBeforeRender=function(g,f,y){this.matrixWorld.copyPosition(y.matrixWorld)}}const u=c.getCacheKey();a.backgroundCacheKey!==u&&(a.backgroundMeshNode.node=X(c).mul(mu),a.backgroundMeshNode.needsUpdate=!0,l.material.needsUpdate=!0,a.backgroundCacheKey=u),e.unshift(l,l.geometry,l.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",n);if(i.autoClear===!0||o===!0){const a=s.clearColorValue;a.r=fi.r,a.g=fi.g,a.b=fi.b,a.a=fi.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),s.depthClearValue=i._clearDepth,s.stencilClearValue=i._clearStencil,s.clearColor=i.autoClearColor===!0,s.clearDepth=i.autoClearDepth===!0,s.clearStencil=i.autoClearStencil===!0}else s.clearColor=!1,s.clearDepth=!1,s.clearStencil=!1}}let kT=0;class yu{constructor(t="",e=[],s=0,i=[]){this.name=t,this.bindings=e,this.index=s,this.bindingsReference=i,this.id=kT++}}class OT{constructor(t,e,s,i,n,o,a,c,l,u=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=s,this.transforms=u,this.nodeAttributes=i,this.bindings=n,this.updateNodes=o,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.monitor=l,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings)if(e.bindings[0].groupNode.shared!==!0){const i=new yu(e.name,[],e.index,e);t.push(i);for(const n of e.bindings)i.bindings.push(n.clone())}else t.push(e);return t}}class Vh{constructor(t,e,s=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=s}}class GT{constructor(t,e,s){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=s.getSelf()}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class Q7{constructor(t,e){this.isNodeVar=!0,this.name=t,this.type=e}}class WT extends Q7{constructor(t,e){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0}}class $T{constructor(t,e,s=""){this.name=t,this.type=e,this.code=s,Object.defineProperty(this,"isNodeCode",{value:!0})}}let HT=0;class Zl{constructor(t=null){this.id=HT++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return e===void 0&&this.parent!==null&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class co{constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0}setValue(t){this.value=t}getValue(){return this.value}}class qT extends co{constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class YT extends co{constructor(t,e=new q){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class XT extends co{constructor(t,e=new v){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class jT extends co{constructor(t,e=new yt){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class ZT extends co{constructor(t,e=new W){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class KT extends co{constructor(t,e=new ts){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class JT extends co{constructor(t,e=new pt){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class QT extends qT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class tS extends YT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class eS extends XT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class sS extends jT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class iS extends ZT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class nS extends KT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class oS extends JT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const Xo=4,kh=[.125,.215,.35,.446,.526,.582],En=20,Kl=new ip(-1,1,1,-1,0,1),rS=new qs(90,1),Oh=new W;let Jl=null,Ql=0,t1=0;const Fn=(1+Math.sqrt(5))/2,Fo=1/Fn,Gh=[new v(-Fn,Fo,0),new v(Fn,Fo,0),new v(-Fo,0,Fn),new v(Fo,0,Fn),new v(0,Fn,-Fo),new v(0,Fn,Fo),new v(-1,1,-1),new v(1,1,-1),new v(-1,1,1),new v(1,1,1)],aS=[3,1,5,0,4,2],e1=J6($t(),si("faceIndex")).normalize(),p2=F(e1.x,e1.y.negate(),e1.z);class cS{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,s=.1,i=100,n=null){if(this._setSize(256),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const a=n||this._allocateTargets();return this.fromSceneAsync(t,e,s,i,a),a}Jl=this._renderer.getRenderTarget(),Ql=this._renderer.getActiveCubeFace(),t1=this._renderer.getActiveMipmapLevel();const o=n||this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(t,s,i,o),e>0&&this._blur(o,0,0,e),this._applyPMREM(o),this._cleanup(o),o}async fromSceneAsync(t,e=0,s=.1,i=100,n=null){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(t,e,s,i,n)}fromEquirectangular(t,e=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(t);const s=e||this._allocateTargets();return this.fromEquirectangularAsync(t,s),s}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const s=e||this._allocateTargets();return this.fromCubemapAsync(t,e),s}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=$h(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=Hh(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===qn||t.mapping===ir?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Jl,Ql,t1),t.scissorTest=!1,S0(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),Jl=this._renderer.getRenderTarget(),Ql=this._renderer.getActiveCubeFace(),t1=this._renderer.getActiveMipmapLevel();const s=e||this._allocateTargets();return this._textureToCubeUV(t,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,s={magFilter:ps,minFilter:ps,generateMipmaps:!1,type:Bs,format:an,colorSpace:Mi},i=Wh(t,e,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Wh(t,e,s);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=lS(n)),this._blurMaterial=uS(n,t,e)}return i}async _compileMaterial(t){const e=new O(this._lodPlanes[0],t);await this._renderer.compile(e,Kl)}_sceneToCubeUV(t,e,s,i){const n=rS;n.near=e,n.far=s;const o=[-1,1,-1,-1,-1,-1],a=[1,1,1,-1,-1,-1],c=this._renderer,l=c.autoClear;c.getClearColor(Oh),c.autoClear=!1;let u=this._backgroundBox;if(u===null){const d=new Ds({name:"PMREM.Background",side:je,depthWrite:!1,depthTest:!1});u=new O(new to,d)}let p=!1;const h=t.background;h?h.isColor&&(u.material.color.copy(h),t.background=null,p=!0):(u.material.color.copy(Oh),p=!0),c.setRenderTarget(i),c.clear(),p&&c.render(u,n);for(let d=0;d<6;d++){const g=d%3;g===0?(n.up.set(0,o[d],0),n.lookAt(a[d],0,0)):g===1?(n.up.set(0,0,o[d]),n.lookAt(0,a[d],0)):(n.up.set(0,o[d],0),n.lookAt(0,0,a[d]));const f=this._cubeSize;S0(i,g*f,d>2?f:0,f,f),c.render(t,n)}c.autoClear=l,t.background=h}_textureToCubeUV(t,e){const s=this._renderer,i=t.mapping===qn||t.mapping===ir;i?this._cubemapMaterial===null&&(this._cubemapMaterial=$h(t)):this._equirectMaterial===null&&(this._equirectMaterial=Hh(t));const n=i?this._cubemapMaterial:this._equirectMaterial;n.fragmentNode.value=t;const o=this._lodMeshes[0];o.material=n;const a=this._cubeSize;S0(e,0,0,3*a,2*a),s.setRenderTarget(e),s.render(o,Kl)}_applyPMREM(t){const e=this._renderer,s=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let n=1;n<i;n++){const o=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=Gh[(i-n-1)%Gh.length];this._blur(t,n-1,n,o,a)}e.autoClear=s}_blur(t,e,s,i,n){const o=this._pingPongRenderTarget;this._halfBlur(t,o,e,s,i,"latitudinal",n),this._halfBlur(o,t,s,s,i,"longitudinal",n)}_halfBlur(t,e,s,i,n,o,a){const c=this._renderer,l=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,p=this._lodMeshes[i];p.material=l;const h=l.uniforms,d=this._sizeLods[s]-1,g=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*En-1),f=n/g,y=isFinite(n)?1+Math.floor(u*f):En;y>En&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${y} samples when the maximum is set to ${En}`);const x=[];let b=0;for(let A=0;A<En;++A){const C=A/f,P=Math.exp(-C*C/2);x.push(P),A===0?b+=P:A<y&&(b+=2*P)}for(let A=0;A<x.length;A++)x[A]=x[A]/b;t.texture.frame=(t.texture.frame||0)+1,h.envMap.value=t.texture,h.samples.value=y,h.weights.array=x,h.latitudinal.value=o==="latitudinal"?1:0,a&&(h.poleAxis.value=a);const{_lodMax:w}=this;h.dTheta.value=g,h.mipInt.value=w-s;const _=this._sizeLods[i],T=3*_*(i>w-Xo?i-w+Xo:0),M=4*(this._cubeSize-_);S0(e,T,M,3*_,2*_),c.setRenderTarget(e),c.render(p,Kl)}}function lS(r){const t=[],e=[],s=[],i=[];let n=r;const o=r-Xo+1+kh.length;for(let a=0;a<o;a++){const c=Math.pow(2,n);e.push(c);let l=1/c;a>r-Xo?l=kh[a-r+Xo-1]:a===0&&(l=0),s.push(l);const u=1/(c-2),p=-u,h=1+u,d=[p,p,h,p,h,h,p,p,h,h,p,h],g=6,f=6,y=3,x=2,b=1,w=new Float32Array(y*f*g),_=new Float32Array(x*f*g),T=new Float32Array(b*f*g);for(let A=0;A<g;A++){const C=A%3*2/3-1,P=A>2?0:-1,D=[C,P,0,C+2/3,P,0,C+2/3,P+1,0,C,P,0,C+2/3,P+1,0,C,P+1,0],V=aS[A];w.set(D,y*f*V),_.set(d,x*f*V);const $=[V,V,V,V,V,V];T.set($,b*f*V)}const M=new It;M.setAttribute("position",new lt(w,y)),M.setAttribute("uv",new lt(_,x)),M.setAttribute("faceIndex",new lt(T,b)),t.push(M),i.push(new O(M,null)),n>Xo&&n--}return{lodPlanes:t,sizeLods:e,sigmas:s,lodMeshes:i}}function Wh(r,t,e){const s=new fn(r,t,e);return s.texture.mapping=N1,s.texture.name="PMREM.cubeUv",s.texture.isPMREMTexture=!0,s.scissorTest=!0,s}function S0(r,t,e,s,i){r.viewport.set(t,e,s,i),r.scissor.set(t,e,s,i)}function h2(r){const t=new Qt;return t.depthTest=!1,t.depthWrite=!1,t.blending=Hn,t.name=`PMREM_${r}`,t}function uS(r,t,e){const s=Ti(new Array(En).fill(0)),i=j(new v(0,1,0)),n=j(0),o=S(En),a=j(0),c=j(1),l=dt(null),u=j(0),p=S(1/t),h=S(1/e),d=S(r),g={n:o,latitudinal:a,weights:s,poleAxis:i,outputDirection:p2,dTheta:n,samples:c,envMap:l,mipInt:u,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d},f=h2("blur");return f.uniforms=g,f.fragmentNode=t7({...g,latitudinal:a.equal(1)}),f}function $h(r){const t=h2("cubemap");return t.fragmentNode=cr(r,p2),t}function Hh(r){const t=h2("equirect");return t.fragmentNode=dt(r,Hp(p2),0),t}const qh=new WeakMap,pS=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),v0=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class t9{constructor(t,e,s){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=s,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=W0(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new Zl,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let t=qh.get(this.renderer);return t===void 0&&(t=new ri,qh.set(this.renderer,t)),t}createRenderTarget(t,e,s){return new fn(t,e,s)}createCubeRenderTarget(t,e){return new z6(t,e)}createPMREMGenerator(){return new cS(this.renderer)}includes(t){return this.nodes.includes(t)}_getBindGroup(t,e){const s=this.getBindGroupsCache(),i=[];let n=!0;for(const a of e)i.push(a),n=n&&a.groupNode.shared!==!0;let o;return n?(o=s.get(i),o===void 0&&(o=new yu(t,i,this.bindingsIndexes[t].group,i),s.set(i,o))):o=new yu(t,i,this.bindingsIndexes[t].group,i),o}getBindGroupArray(t,e){const s=this.bindings[e];let i=s[t];return i===void 0&&(this.bindingsIndexes[t]===void 0&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),s[t]=i=[]),i}getBindings(){let t=this.bindGroups;if(t===null){const e={},s=this.bindings;for(const i of eu)for(const n in s[i]){const o=s[i][n];(e[n]||(e[n]=[])).push(...o)}t=[];for(const i in e){const n=e[i],o=this._getBindGroup(i,n);t.push(o)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort((e,s)=>e.bindings[0].groupNode.order-s.bindings[0].groupNode.order);for(let e=0;e<t.length;e++){const s=t[e];this.bindingsIndexes[s.name].group=e,s.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){this.nodes.includes(t)===!1&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){this.sequentialNodes.includes(t)===!1&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes)t.getUpdateType()!==st.NONE&&this.updateNodes.push(t.getSelf());for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),s=t.getUpdateAfterType();e!==st.NONE&&this.updateBeforeNodes.push(t.getSelf()),s!==st.NONE&&this.updateAfterNodes.push(t.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===ps||t.magFilter===R1||t.magFilter===Jo||t.magFilter===vi||t.minFilter===ps||t.minFilter===R1||t.minFilter===Jo||t.minFilter===vi}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const s=this.getDataFromNode(t);return s.cache===void 0&&(s.cache=new Zl(e?this.getCache():null)),s.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=e.usageCount===void 0?1:e.usageCount+1,e.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(t,e=null){if(e===null&&(t==="float"||t==="int"||t==="uint"?e=0:t==="bool"?e=!1:t==="color"?e=new W:t==="vec2"?e=new q:t==="vec3"?e=new v:t==="vec4"&&(e=new yt)),t==="float")return v0(e);if(t==="int")return`${Math.round(e)}`;if(t==="uint")return e>=0?`${Math.round(e)}u`:"0u";if(t==="bool")return e?"true":"false";if(t==="color")return`${this.getType("vec3")}( ${v0(e.r)}, ${v0(e.g)}, ${v0(e.b)} )`;const s=this.getTypeLength(t),i=this.getComponentType(t),n=o=>this.generateConst(i,o);if(s===2)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)} )`;if(s===3)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)}, ${n(e.z)} )`;if(s===4)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)}, ${n(e.z)}, ${n(e.w)} )`;if(s>4&&e&&(e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(n).join(", ")} )`;if(s>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return t==="color"?"vec3":t}hasGeometryAttribute(t){return this.geometry&&this.geometry.getAttribute(t)!==void 0}getAttribute(t,e){const s=this.attributes;for(const n of s)if(n.name===t)return n;const i=new Vh(t,e);return s.push(i),i}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return t==="void"||t==="property"||t==="sampler"||t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="depthTexture"||t==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===ke)return"int";if(e===Ae)return"uint"}return"float"}getElementType(t){return t==="mat2"?"vec2":t==="mat3"?"vec3":t==="mat4"?"vec4":this.getComponentType(t)}getComponentType(t){if(t=this.getVectorType(t),t==="float"||t==="bool"||t==="int"||t==="uint")return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return e===null?null:e[1]==="b"?"bool":e[1]==="i"?"int":e[1]==="u"?"uint":"float"}getVectorType(t){return t==="color"?"vec3":t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"?"vec4":t}getTypeFromLength(t,e="float"){if(t===1)return e;const s=U5(t);return(e==="float"?"":e[0])+s}getTypeFromArray(t){return pS.get(t.constructor)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const s=e.array,i=t.itemSize,n=t.normalized;let o;return!(t instanceof g5)&&n!==!0&&(o=this.getTypeFromArray(s)),this.getTypeFromLength(i,o)}getTypeLength(t){const e=this.getVectorType(t),s=/vec([2-4])/.exec(e);return s!==null?Number(s[1]):e==="float"||e==="bool"||e==="int"||e==="uint"?1:/mat2/.test(t)===!0?4:/mat3/.test(t)===!0?9:/mat4/.test(t)===!0?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return e==="int"||e==="uint"?t:this.changeComponentType(t,"int")}addStack(){return this.stack=W0(this.stack),this.stacks.push(lp()||this.stack),ma(this.stack),this.stack}removeStack(){const t=this.stack;return this.stack=t.parent,ma(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,s=null){s=s===null?t.isGlobal(this)?this.globalCache:this.cache:s;let i=s.getData(t);return i===void 0&&(i={},s.setData(t,i)),i[e]===void 0&&(i[e]={}),i[e]}getNodeProperties(t,e="any"){const s=this.getDataFromNode(t,e);return s.properties||(s.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const s=this.getDataFromNode(t);let i=s.bufferAttribute;if(i===void 0){const n=this.uniforms.index++;i=new Vh("nodeAttribute"+n,e,t),this.bufferAttributes.push(i),s.bufferAttribute=i}return i}getStructTypeFromNode(t,e=this.shaderStage){const s=this.getDataFromNode(t,e);if(s.structType===void 0){const i=this.structs.index++;t.name=`StructType${i}`,this.structs[e].push(t),s.structType=t}return t}getUniformFromNode(t,e,s=this.shaderStage,i=null){const n=this.getDataFromNode(t,s,this.globalCache);let o=n.uniform;if(o===void 0){const a=this.uniforms.index++;o=new GT(i||"nodeUniform"+a,e,t),this.uniforms[s].push(o),n.uniform=o}return o}getVarFromNode(t,e=null,s=t.getNodeType(this),i=this.shaderStage){const n=this.getDataFromNode(t,i);let o=n.variable;if(o===void 0){const a=this.vars[i]||(this.vars[i]=[]);e===null&&(e="nodeVar"+a.length),o=new Q7(e,s),a.push(o),n.variable=o}return o}getVaryingFromNode(t,e=null,s=t.getNodeType(this)){const i=this.getDataFromNode(t,"any");let n=i.varying;if(n===void 0){const o=this.varyings,a=o.length;e===null&&(e="nodeVarying"+a),n=new WT(e,s),o.push(n),i.varying=n}return n}getCodeFromNode(t,e,s=this.shaderStage){const i=this.getDataFromNode(t);let n=i.code;if(n===void 0){const o=this.codes[s]||(this.codes[s]=[]),a=o.length;n=new $T("nodeCode"+a,e),o.push(n),i.code=n}return n}addFlowCodeHierarchy(t,e){const{flowCodes:s,flowCodeBlock:i}=this.getDataFromNode(t);let n=!0,o=e;for(;o;){if(i.get(o)===!0){n=!1;break}o=this.getDataFromNode(o).parentNodeBlock}if(n)for(const a of s)this.addLineFlowCode(a)}addLineFlowCodeBlock(t,e,s){const i=this.getDataFromNode(t),n=i.flowCodes||(i.flowCodes=[]),o=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);n.push(e),o.set(s,!0)}addLineFlowCode(t,e=null){return t===""?this:(e!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t=t+`;
`),this.flow.code+=t,this)}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),s=this.flowChildNode(t,e);return this.flowsData.set(t,s),s}buildFunctionNode(t){const e=new C7,s=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=s,e}flowShaderNode(t){const e=t.layout,s={[Symbol.iterator](){let o=0;const a=Object.values(this);return{next:()=>({value:a[o],done:o++>=a.length})}}};for(const o of e.inputs)s[o.name]=new o7(o.type,o.name);t.layout=null;const i=t.call(s),n=this.flowStagesNode(i,e.type);return t.layout=e,n}flowStagesNode(t,e=null){const s=this.flow,i=this.vars,n=this.cache,o=this.buildStage,a=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new Zl,this.stack=W0();for(const l of tu)this.setBuildStage(l),c.result=t.build(this,e);return c.vars=this.getVars(this.shaderStage),this.flow=s,this.vars=i,this.cache=n,this.stack=a,this.setBuildStage(o),c}getFunctionOperator(){return null}flowChildNode(t,e=null){const s=this.flow,i={code:""};return this.flow=i,i.result=t.build(this,e),this.flow=s,i}flowNodeFromShaderStage(t,e,s=null,i=null){const n=this.shaderStage;this.setShaderStage(t);const o=this.flowChildNode(e,s);return i!==null&&(o.code+=`${this.tab+i} = ${o.result};
`),this.flowCode[t]=this.flowCode[t]+o.code,this.setShaderStage(n),o}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(t,e){return`${this.getType(t)} ${e}`}getVars(t){let e="";const s=this.vars[t];if(s!==void 0)for(const i of s)e+=`${this.getVar(i.type,i.name)}; `;return e}getUniforms(){console.warn("Abstract function.")}getCodes(t){const e=this.codes[t];let s="";if(e!==void 0)for(const i of e)s+=i.code+`
`;return s}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:t,material:e,renderer:s}=this;if(e!==null){let i=s.library.fromMaterial(e);i===null&&(console.error(`NodeMaterial: Material "${e.type}" is not compatible.`),i=new Qt),i.build(this)}else this.addFlow("compute",t);for(const i of tu){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const n of eu){this.setShaderStage(n);const o=this.flowNodes[n];for(const a of o)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(t,e){if(e==="float"||e==="int"||e==="uint")return new QT(t);if(e==="vec2"||e==="ivec2"||e==="uvec2")return new tS(t);if(e==="vec3"||e==="ivec3"||e==="uvec3")return new eS(t);if(e==="vec4"||e==="ivec4"||e==="uvec4")return new sS(t);if(e==="color")return new iS(t);if(e==="mat3")return new nS(t);if(e==="mat4")return new oS(t);throw new Error(`Uniform "${e}" not declared.`)}createNodeMaterial(t="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${t}() instead.`)}format(t,e,s){if(e=this.getVectorType(e),s=this.getVectorType(s),e===s||s===null||this.isReference(s))return t;const i=this.getTypeLength(e),n=this.getTypeLength(s);return i===16&&n===9?`${this.getType(s)}(${t}[0].xyz, ${t}[1].xyz, ${t}[2].xyz)`:i===9&&n===4?`${this.getType(s)}(${t}[0].xy, ${t}[1].xy)`:i>4||n>4||n===0?t:i===n?`${this.getType(s)}( ${t} )`:i>n?this.format(`${t}.${"xyz".slice(0,n)}`,this.getTypeFromLength(n,this.getComponentType(e)),s):n===4&&i>1?`${this.getType(s)}( ${this.format(t,e,"vec3")}, 1.0 )`:i===2?`${this.getType(s)}( ${this.format(t,e,"vec2")}, 0.0 )`:(i===1&&n>1&&e!==this.getComponentType(s)&&(t=`${this.getType(this.getComponentType(s))}( ${t} )`),`${this.getType(s)}( ${t} )`)}getSignature(){return`// Three.js r${Rc} - Node System
`}}class Yh{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let s=t.get(e);return s===void 0&&(s={renderMap:new WeakMap,frameMap:new WeakMap},t.set(e,s)),s}updateBeforeNode(t){const e=t.getUpdateBeforeType(),s=t.updateReference(this);if(e===st.FRAME){const{frameMap:i}=this._getMaps(this.updateBeforeMap,s);i.get(s)!==this.frameId&&t.updateBefore(this)!==!1&&i.set(s,this.frameId)}else if(e===st.RENDER){const{renderMap:i}=this._getMaps(this.updateBeforeMap,s);i.get(s)!==this.renderId&&t.updateBefore(this)!==!1&&i.set(s,this.renderId)}else e===st.OBJECT&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),s=t.updateReference(this);if(e===st.FRAME){const{frameMap:i}=this._getMaps(this.updateAfterMap,s);i.get(s)!==this.frameId&&t.updateAfter(this)!==!1&&i.set(s,this.frameId)}else if(e===st.RENDER){const{renderMap:i}=this._getMaps(this.updateAfterMap,s);i.get(s)!==this.renderId&&t.updateAfter(this)!==!1&&i.set(s,this.renderId)}else e===st.OBJECT&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),s=t.updateReference(this);if(e===st.FRAME){const{frameMap:i}=this._getMaps(this.updateMap,s);i.get(s)!==this.frameId&&t.update(this)!==!1&&i.set(s,this.frameId)}else if(e===st.RENDER){const{renderMap:i}=this._getMaps(this.updateMap,s);i.get(s)!==this.renderId&&t.update(this)!==!1&&i.set(s,this.renderId)}else e===st.OBJECT&&t.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class d2{constructor(t,e,s=null,i="",n=!1){this.type=t,this.name=e,this.count=s,this.qualifier=i,this.isConst=n}}d2.isNodeFunctionInput=!0;class hS extends ao{static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,s=this.colorNode,i=r2(this.light),n=t.context.reflectedLight;e.direct({lightDirection:i,lightColor:s,reflectedLight:n},t.stack,t)}}const s1=new pt,M0=new pt;let Dr=null;class dS extends ao{static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=j(new v).setGroup(Q),this.halfWidth=j(new v).setGroup(Q),this.updateType=st.RENDER}update(t){super.update(t);const{light:e}=this,s=t.camera.matrixWorldInverse;M0.identity(),s1.copy(e.matrixWorld),s1.premultiply(s),M0.extractRotation(s1),this.halfWidth.value.set(e.width*.5,0,0),this.halfHeight.value.set(0,e.height*.5,0),this.halfWidth.value.applyMatrix4(M0),this.halfHeight.value.applyMatrix4(M0)}setup(t){super.setup(t);let e,s;t.isAvailable("float32Filterable")?(e=dt(Dr.LTC_FLOAT_1),s=dt(Dr.LTC_FLOAT_2)):(e=dt(Dr.LTC_HALF_1),s=dt(Dr.LTC_HALF_2));const{colorNode:i,light:n}=this,o=t.context.lightingModel,a=il(n),c=t.context.reflectedLight;o.directRectArea({lightColor:i,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:e,ltc_2:s},t.stack,t)}static setLTC(t){Dr=t}}class e9 extends ao{static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=j(0).setGroup(Q),this.penumbraCosNode=j(0).setGroup(Q),this.cutoffDistanceNode=j(0).setGroup(Q),this.decayExponentNode=j(0).setGroup(Q)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:s}=this;return Di(e,s,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:s,cutoffDistanceNode:i,decayExponentNode:n,light:o}=this,a=il(o).sub(le),c=a.normalize(),l=c.dot(r2(o)),u=this.getSpotAttenuation(l),p=a.length(),h=c2({lightDistance:p,cutoffDistance:i,decayExponent:n});let d=s.mul(u).mul(h);if(o.map){const f=D7(o),y=dt(o.map,f.xy).onRenderUpdate(()=>o.map);d=f.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(y),d)}const g=t.context.reflectedLight;e.direct({lightDirection:c,lightColor:d,reflectedLight:g},t.stack,t)}}class gS extends e9{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t){const e=this.light.iesMap;let s=null;if(e&&e.isTexture===!0){const i=t.acos().mul(1/Math.PI);s=dt(e,k(i,0),0).r}else s=super.getSpotAttenuation(t);return s}}class fS extends ao{static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class mS extends ao{static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=o2(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=j(new W).setGroup(Q)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:s,lightDirectionNode:i}=this,o=_s.dot(i).mul(.5).add(.5),a=_t(s,e,o);t.context.irradiance.addAssign(a)}}class yS extends ao{static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let s=0;s<9;s++)e.push(new v);this.lightProbe=Ti(e)}update(t){const{light:e}=this;super.update(t);for(let s=0;s<9;s++)this.lightProbe.array[s].copy(e.sh.coefficients[s]).multiplyScalar(e.intensity)}setup(t){const e=J7(qc,this.lightProbe);t.context.irradiance.addAssign(e)}}class s9{parseFunction(){console.warn("Abstract function.")}}class g2{constructor(t,e,s="",i=""){this.type=t,this.inputs=e,this.name=s,this.precision=i}getCode(){console.warn("Abstract function.")}}g2.isNodeFunction=!0;const xS=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,bS=/[a-z_0-9]+/ig,Xh="#pragma main",wS=r=>{r=r.trim();const t=r.indexOf(Xh),e=t!==-1?r.slice(t+Xh.length):r,s=e.match(xS);if(s!==null&&s.length===5){const i=s[4],n=[];let o=null;for(;(o=bS.exec(i))!==null;)n.push(o);const a=[];let c=0;for(;c<n.length;){const g=n[c][0]==="const";g===!0&&c++;let f=n[c][0];f==="in"||f==="out"||f==="inout"?c++:f="";const y=n[c++][0];let x=Number.parseInt(n[c][0]);Number.isNaN(x)===!1?c++:x=null;const b=n[c++][0];a.push(new d2(y,b,x,f,g))}const l=e.substring(s[0].length),u=s[3]!==void 0?s[3]:"",p=s[2],h=s[1]!==void 0?s[1]:"",d=t!==-1?r.slice(0,t):"";return{type:p,inputs:a,name:u,precision:h,inputsCode:i,blockCode:l,headerCode:d}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class _S extends g2{constructor(t){const{type:e,inputs:s,name:i,precision:n,inputsCode:o,blockCode:a,headerCode:c}=wS(t);super(e,s,i,n),this.inputsCode=o,this.blockCode=a,this.headerCode=c}getCode(t=this.name){let e;const s=this.blockCode;if(s!==""){const{type:i,inputsCode:n,headerCode:o,precision:a}=this;let c=`${i} ${t} ( ${n.trim()} )`;a!==""&&(c=`${a} ${c}`),e=o+c+s}else e="";return e}}class TS extends s9{parseFunction(t){return new _S(t)}}const jh=new WeakMap;class SS extends bn{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new Yh,this.nodeBuilderCache=new Map,this.callHashCache=new ri,this.groupsData=new ri}updateGroup(t){const e=t.groupNode,s=e.name;if(s===hp.name)return!0;if(s===Q.name){const o=this.get(t),a=this.nodeFrame.renderId;return o.renderId!==a?(o.renderId=a,!0):!1}if(s===r4.name){const o=this.get(t),a=this.nodeFrame.frameId;return o.frameId!==a?(o.frameId=a,!0):!1}const i=[e,t];let n=this.groupsData.get(i);return n===void 0&&this.groupsData.set(i,n={}),n.version!==e.version?(n.version=e.version,!0):!1}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let s=e.nodeBuilderState;if(s===void 0){const{nodeBuilderCache:i}=this,n=this.getForRenderCacheKey(t);if(s=i.get(n),s===void 0){const o=this.backend.createNodeBuilder(t.object,this.renderer);o.scene=t.scene,o.material=t.material,o.camera=t.camera,o.context.material=t.material,o.lightsNode=t.lightsNode,o.environmentNode=this.getEnvironmentNode(t.scene),o.fogNode=this.getFogNode(t.scene),o.clippingContext=t.clippingContext,o.build(),s=this._createNodeBuilderState(o),i.set(n,s)}s.usedTimes++,e.nodeBuilderState=s}return s}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,e.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let s=e.nodeBuilderState;if(s===void 0){const i=this.backend.createNodeBuilder(t,this.renderer);i.build(),s=this._createNodeBuilderState(i),e.nodeBuilderState=s}return s}_createNodeBuilderState(t){return new OT(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.monitor,t.transforms)}getEnvironmentNode(t){return t.environmentNode||this.get(t).environmentNode||null}getBackgroundNode(t){return t.backgroundNode||this.get(t).backgroundNode||null}getFogNode(t){return t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){const s=[t,e],i=this.renderer.info.calls;let n=this.callHashCache.get(s);if(n===void 0||n.callId!==i){const o=this.getEnvironmentNode(t),a=this.getFogNode(t),c=[];e&&c.push(e.getCacheKey(!0)),o&&c.push(o.getCacheKey()),a&&c.push(a.getCacheKey()),c.push(this.renderer.shadowMap.enabled?1:0),n={callId:i,cacheKey:np(c)},this.callHashCache.set(s,n)}return n.cacheKey}updateScene(t){this.updateEnvironment(t),this.updateFog(t),this.updateBackground(t)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),s=t.background;if(s){const i=t.backgroundBlurriness===0&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&e.backgroundBlurriness===0;if(e.background!==s||i){let n=null;if(s.isCubeTexture===!0||s.mapping===va||s.mapping===Ma||s.mapping===N1)if(t.backgroundBlurriness>0||s.mapping===N1)n=Zp(s);else{let o;s.isCubeTexture===!0?o=cr(s):o=dt(s),n=k6(o)}else s.isTexture===!0?n=dt(s,oi.flipY()).setUpdateMatrix(!0):s.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",s);e.backgroundNode=n,e.background=s,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}updateFog(t){const e=this.get(t),s=t.fog;if(s){if(e.fog!==s){let i=null;if(s.isFogExp2){const n=Mt("color","color",s).setGroup(Q),o=Mt("density","float",s).setGroup(Q);i=B7(n,o)}else if(s.isFog){const n=Mt("color","color",s).setGroup(Q),o=Mt("near","float",s).setGroup(Q),a=Mt("far","float",s).setGroup(Q);i=E7(n,o,a)}else console.error("WebGPUNodes: Unsupported fog configuration.",s);e.fogNode=i,e.fog=s}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),s=t.environment;if(s){if(e.environment!==s){let i=null;s.isCubeTexture===!0?i=cr(s):s.isTexture===!0?i=dt(s):console.error("Nodes: Unsupported environment configuration.",s),e.environmentNode=i,e.environment=s}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,s=null,i=null,n=null){const o=this.nodeFrame;return o.renderer=t,o.scene=e,o.object=s,o.camera=i,o.material=n,o}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace}hasOutputChange(t){return jh.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,s=this.getOutputCacheKey(),i=dt(t,oi).renderOutput(e.toneMapping,e.currentColorSpace);return jh.set(t,s),i}updateBefore(t){const e=t.getNodeBuilderState();for(const s of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(s)}updateAfter(t){const e=t.getNodeBuilderState();for(const s of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(s)}updateForCompute(t){const e=this.getNodeFrame(),s=this.getForCompute(t);for(const i of s.updateNodes)e.updateNode(i)}updateForRender(t){const e=this.getNodeFrameForRender(t),s=t.getNodeBuilderState();for(const i of s.updateNodes)e.updateNode(i)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new Yh,this.nodeBuilderCache=new Map}}const i1=new qi;class bc{constructor(t=null){this.version=0,this.clipIntersection=null,this.cacheKey="",t===null?(this.intersectionPlanes=[],this.unionPlanes=[],this.viewNormalMatrix=new ts,this.clippingGroupContexts=new WeakMap,this.shadowPass=!1):(this.viewNormalMatrix=t.viewNormalMatrix,this.clippingGroupContexts=t.clippingGroupContexts,this.shadowPass=t.shadowPass,this.viewMatrix=t.viewMatrix),this.parentVersion=null}projectPlanes(t,e,s){const i=t.length;for(let n=0;n<i;n++){i1.copy(t[n]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const o=e[s+n],a=i1.normal;o.x=-a.x,o.y=-a.y,o.z=-a.z,o.w=i1.constant}}updateGlobal(t,e){this.shadowPass=t.overrideMaterial!==null&&t.overrideMaterial.isShadowNodeMaterial,this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(t,e){let s=!1;t.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(t.intersectionPlanes),this.unionPlanes=Array.from(t.unionPlanes),this.parentVersion=t.version),this.clipIntersection!==e.clipIntersection&&(this.clipIntersection=e.clipIntersection,this.clipIntersection?this.unionPlanes.length=t.unionPlanes.length:this.intersectionPlanes.length=t.intersectionPlanes.length);const i=e.clippingPlanes,n=i.length;let o,a;if(this.clipIntersection?(o=this.intersectionPlanes,a=t.intersectionPlanes.length):(o=this.unionPlanes,a=t.unionPlanes.length),o.length!==a+n){o.length=a+n;for(let c=0;c<n;c++)o[a+c]=new yt;s=!0}this.projectPlanes(i,o,a),s&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let e=this.clippingGroupContexts.get(t);return e===void 0&&(e=new bc(this),this.clippingGroupContexts.set(t,e)),e.update(this,t),e}get unionClippingCount(){return this.unionPlanes.length}}class vS{constructor(t,e){this.scene=t,this.camera=e}clone(){return Object.assign(new this.constructor,this)}}class MS{constructor(){this.lists=new ri}get(t,e){const s=this.lists,i=[t,e];let n=s.get(i);return n===void 0&&(n=new vS(t,e),s.set(i,n)),n}dispose(){this.lists=new ri}}class i9{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const s=this.getMaterialNodeClass(t.type);if(s!==null){e=new s;for(const i in t)e[i]=t[i]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,s){if(s.has(e)){console.warn(`Redefinition of node ${e}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e=="function"||typeof e=="object")throw new Error(`Base class ${e} is not a class.`);s.set(e,t)}addClass(t,e,s){if(s.has(e)){console.warn(`Redefinition of node ${e.name}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e!="function")throw new Error(`Base class ${e.name} is not a class.`);s.set(e,t)}}const AS=new a2;class NS extends ri{constructor(){super()}createNode(t=[]){return new a2().setLights(t)}getNode(t,e){if(t.isQuadMesh)return AS;const s=[t,e];let i=this.get(s);return i===void 0&&(i=this.createNode(),this.set(s,i)),i}}const Zh=new Hu,A0=new q,n1=new yt,o1=new Xu,N0=new pt,$i=new yt;class CS{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:s=!1,alpha:i=!0,depth:n=!0,stencil:o=!1,antialias:a=!1,samples:c=0,getFallback:l=null}=e;this.domElement=t.getDomElement(),this.backend=t,this.samples=c||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=s,this.outputColorSpace=J,this.toneMapping=Ko,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=n,this.stencil=o,this.info=new Wx,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new i9,this.lighting=new NS,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new yt(0,0,this._width,this._height),this._scissor=new yt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new e2(new Qt),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const u=this.alpha===!0?0:1;this._clearColor=new Qp(0,0,0,u),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:Y9},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(p,h,d)=>{await this.compileAsync(p,h);const g=this._renderLists.get(p,h),f=this._renderContexts.get(p,h,this._renderTarget),y=p.overrideMaterial||d.material,x=this._objects.get(d,y,p,h,g.lightsNode,f,f.clippingContext),{fragmentShader:b,vertexShader:w}=x.getNodeBuilderState();return{fragmentShader:b,vertexShader:w}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(t,e)=>{let s=this.backend;try{await s.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=s=this._getFallback(i),await s.init(this)}catch(n){e(n);return}else{e(i);return}}this._nodes=new SS(this,s),this._animation=new Dx(this._nodes,this.info),this._attributes=new kx(s),this._background=new VT(this,this._nodes),this._geometries=new Gx(this._attributes,this.info),this._textures=new sb(this,s,this.info),this._pipelines=new Yx(s,this._nodes),this._bindings=new Xx(s,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new Ux(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new Kx(this.lighting),this._bundles=new MS,this._renderContexts=new tb,this._animation.start(),this._initialized=!0,t()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,s=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,n=i.renderId,o=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,l=t.isScene===!0?t:Zh;s===null&&(s=t);const u=this._renderTarget,p=this._renderContexts.get(s,e,u),h=this._activeMipmapLevel,d=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,i.renderId++,i.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new bc),p.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,u);const g=this._renderLists.get(t,e);if(g.begin(),this._projectObject(t,e,0,g,p.clippingContext),s!==t&&s.traverseVisible(function(w){w.isLight&&w.layers.test(e.layers)&&g.pushLight(w)}),g.finish(),u!==null){this._textures.updateRenderTarget(u,h);const w=this._textures.get(u);p.textures=w.textures,p.depthTexture=w.depthTexture}else p.textures=null,p.depthTexture=null;this._nodes.updateScene(l),this._background.update(l,g,p);const f=g.opaque,y=g.transparent,x=g.transparentDoublePass,b=g.lightsNode;this.opaque===!0&&f.length>0&&this._renderObjects(f,e,l,b),this.transparent===!0&&y.length>0&&this._renderTransparents(y,x,e,l,b),i.renderId=n,this._currentRenderContext=o,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(t,e){this._initialized===!1&&await this.init();const s=this._renderScene(t,e);await this.backend.resolveTimestampAsync(s,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:

Message: ${t.message}`;t.reason&&(e+=`
Reason: ${t.reason}`),console.error(e),this._isDeviceLost=!0}_renderBundle(t,e,s){const{bundleGroup:i,camera:n,renderList:o}=t,a=this._currentRenderContext,c=this._bundles.get(i,n),l=this.backend.get(c);l.renderContexts===void 0&&(l.renderContexts=new Set);const u=i.version!==l.version,p=l.renderContexts.has(a)===!1||u;if(l.renderContexts.add(a),p){this.backend.beginBundle(a),(l.renderObjects===void 0||u)&&(l.renderObjects=[]),this._currentRenderBundle=c;const h=o.opaque;this.opaque===!0&&h.length>0&&this._renderObjects(h,n,e,s),this._currentRenderBundle=null,this.backend.finishBundle(a,c),l.version=i.version}else{const{renderObjects:h}=l;for(let d=0,g=h.length;d<g;d++){const f=h[d];this._nodes.needsRefresh(f)&&(this._nodes.updateBefore(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._nodes.updateAfter(f))}}this.backend.addBundle(a,c)}render(t,e){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(t,e);this._renderScene(t,e)}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this;if(t!==Ko===!1&&e!==Mi===!1)return null;const{width:n,height:o}=this.getDrawingBufferSize(A0),{depth:a,stencil:c}=this;let l=this._frameBufferTarget;return l===null&&(l=new fn(n,o,{depthBuffer:a,stencilBuffer:c,type:Bs,format:an,colorSpace:Mi,generateMipmaps:!1,minFilter:ps,magFilter:ps,samples:this.samples}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l),l.depthBuffer=a,l.stencilBuffer=c,l.setSize(n,o),l.viewport.copy(this._viewport),l.scissor.copy(this._scissor),l.viewport.multiplyScalar(this._pixelRatio),l.scissor.multiplyScalar(this._pixelRatio),l.scissorTest=this._scissorTest,l}_renderScene(t,e,s=!0){if(this._isDeviceLost===!0)return;const i=s?this._getFrameBufferTarget():null,n=this._nodes.nodeFrame,o=n.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,l=t.isScene===!0?t:Zh,u=this._renderTarget,p=this._activeCubeFace,h=this._activeMipmapLevel;let d;i!==null?(d=i,this.setRenderTarget(d)):d=u;const g=this._renderContexts.get(t,e,d);this._currentRenderContext=g,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,n.renderId=this.info.calls;const f=this.coordinateSystem;e.coordinateSystem!==f&&(e.coordinateSystem=f,e.updateProjectionMatrix()),t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld();let y=this._viewport,x=this._scissor,b=this._pixelRatio;d!==null&&(y=d.viewport,x=d.scissor,b=1),this.getDrawingBufferSize(A0),n1.set(0,0,A0.width,A0.height);const w=y.minDepth===void 0?0:y.minDepth,_=y.maxDepth===void 0?1:y.maxDepth;g.viewportValue.copy(y).multiplyScalar(b).floor(),g.viewportValue.width>>=h,g.viewportValue.height>>=h,g.viewportValue.minDepth=w,g.viewportValue.maxDepth=_,g.viewport=g.viewportValue.equals(n1)===!1,g.scissorValue.copy(x).multiplyScalar(b).floor(),g.scissor=this._scissorTest&&g.scissorValue.equals(n1)===!1,g.scissorValue.width>>=h,g.scissorValue.height>>=h,g.clippingContext||(g.clippingContext=new bc),g.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,d),N0.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),o1.setFromProjectionMatrix(N0,f);const T=this._renderLists.get(t,e);if(T.begin(),this._projectObject(t,e,0,T,g.clippingContext),T.finish(),this.sortObjects===!0&&T.sort(this._opaqueSort,this._transparentSort),d!==null){this._textures.updateRenderTarget(d,h);const V=this._textures.get(d);g.textures=V.textures,g.depthTexture=V.depthTexture,g.width=V.width,g.height=V.height,g.renderTarget=d,g.depth=d.depthBuffer,g.stencil=d.stencilBuffer}else g.textures=null,g.depthTexture=null,g.width=this.domElement.width,g.height=this.domElement.height,g.depth=this.depth,g.stencil=this.stencil;g.width>>=h,g.height>>=h,g.activeCubeFace=p,g.activeMipmapLevel=h,g.occlusionQueryCount=T.occlusionQueryCount,this._nodes.updateScene(l),this._background.update(l,T,g),this.backend.beginRender(g);const{bundles:M,lightsNode:A,transparentDoublePass:C,transparent:P,opaque:D}=T;if(M.length>0&&this._renderBundles(M,l,A),this.opaque===!0&&D.length>0&&this._renderObjects(D,e,l,A),this.transparent===!0&&P.length>0&&this._renderTransparents(P,C,e,l,A),this.backend.finishRender(g),n.renderId=o,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null){this.setRenderTarget(u,p,h);const V=this._quad;this._nodes.hasOutputChange(d.texture)&&(V.material.fragmentNode=this._nodes.getOutputNode(d.texture),V.material.needsUpdate=!0),this._renderScene(V,V.camera,!1)}return l.onAfterRender(this,t,e,d),g}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(t)}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,s){this._width=t,this._height=e,this._pixelRatio=s,this.domElement.width=Math.floor(t*s),this.domElement.height=Math.floor(e*s),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setSize(t,e,s=!0){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),s===!0&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,s,i){const n=this._scissor;t.isVector4?n.copy(t):n.set(t,e,s,i)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t,this.backend.setScissorTest(t)}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,s,i,n=0,o=1){const a=this._viewport;t.isVector4?a.copy(t):a.set(t,e,s,i),a.minDepth=n,a.maxDepth=o}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,s=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(t,e,s);const i=this._renderTarget||this._getFrameBufferTarget();let n=null;if(i!==null&&(this._textures.updateRenderTarget(i),n=this._textures.get(i)),this.backend.clear(t,e,s,n),i!==null&&this._renderTarget===null){const o=this._quad;this._nodes.hasOutputChange(i.texture)&&(o.material.fragmentNode=this._nodes.getOutputNode(i.texture),o.material.needsUpdate=!0),this._renderScene(o,o.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,s=!0){this._initialized===!1&&await this.init(),this.clear(t,e,s)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?Ko:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?Mi:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,s=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=s}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t);const e=this._nodes.nodeFrame,s=e.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,e.renderId=this.info.calls;const i=this.backend,n=this._pipelines,o=this._bindings,a=this._nodes,c=Array.isArray(t)?t:[t];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(t);for(const l of c){if(n.has(l)===!1){const h=()=>{l.removeEventListener("dispose",h),n.delete(l),o.delete(l),a.delete(l)};l.addEventListener("dispose",h);const d=l.onInitFunction;d!==null&&d.call(l,{renderer:this})}a.updateForCompute(l),o.updateForCompute(l);const u=o.getForCompute(l),p=n.getForCompute(l,u);i.compute(t,l,u,p)}i.finishCompute(t),e.renderId=s}async computeAsync(t){this._initialized===!1&&await this.init(),this.compute(t),await this.backend.resolveTimestampAsync(t,"compute")}async hasFeatureAsync(t){return this._initialized===!1&&await this.init(),this.backend.hasFeature(t)}hasFeature(t){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(t)}hasInitialized(){return this._initialized}async initTextureAsync(t){this._initialized===!1&&await this.init(),this._textures.updateTexture(t)}initTexture(t){if(this._initialized===!1)return console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),!1;this._textures.updateTexture(t)}copyFramebufferToTexture(t,e=null){if(e!==null)if(e.isVector2)e=$i.set(e.x,e.y,t.image.width,t.image.height).floor();else if(e.isVector4)e=$i.copy(e).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else e=$i.set(0,0,t.image.width,t.image.height);let s=this._currentRenderContext,i;s!==null?i=s.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),s=this._textures.get(i))),this._textures.updateTexture(t,{renderTarget:i}),this.backend.copyFramebufferToTexture(t,s,e)}copyTextureToTexture(t,e,s=null,i=null,n=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,s,i,n)}readRenderTargetPixelsAsync(t,e,s,i,n,o=0,a=0){return this.backend.copyTextureToBuffer(t.textures[o],e,s,i,n,a)}_projectObject(t,e,s,i,n){if(t.visible===!1)return;if(t.layers.test(e.layers)){if(t.isGroup)s=t.renderOrder,t.isClippingGroup&&t.enabled&&(n=n.getGroupContext(t));else if(t.isLOD)t.autoUpdate===!0&&t.update(e);else if(t.isLight)i.pushLight(t);else if(t.isSprite){if(!t.frustumCulled||o1.intersectsSprite(t)){this.sortObjects===!0&&$i.setFromMatrixPosition(t.matrixWorld).applyMatrix4(N0);const{geometry:c,material:l}=t;l.visible&&i.push(t,c,l,s,$i.z,null,n)}}else if(t.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||o1.intersectsObject(t))){const{geometry:c,material:l}=t;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),$i.copy(c.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(N0)),Array.isArray(l)){const u=c.groups;for(let p=0,h=u.length;p<h;p++){const d=u[p],g=l[d.materialIndex];g&&g.visible&&i.push(t,c,g,s,$i.z,d,n)}}else l.visible&&i.push(t,c,l,s,$i.z,null,n)}}if(t.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(t,e),i.begin(),c.pushBundle({bundleGroup:t,camera:e,renderList:i}),i.finish()}const a=t.children;for(let c=0,l=a.length;c<l;c++)this._projectObject(a[c],e,s,i,n)}_renderBundles(t,e,s){for(const i of t)this._renderBundle(i,e,s)}_renderTransparents(t,e,s,i,n){if(e.length>0){for(const{material:o}of e)o.side=je;this._renderObjects(e,s,i,n,"backSide");for(const{material:o}of e)o.side=$n;this._renderObjects(t,s,i,n);for(const{material:o}of e)o.side=se}else this._renderObjects(t,s,i,n)}_renderObjects(t,e,s,i,n=null){for(let o=0,a=t.length;o<a;o++){const c=t[o],{object:l,geometry:u,material:p,group:h,clippingContext:d}=c;if(e.isArrayCamera){const g=e.cameras;for(let f=0,y=g.length;f<y;f++){const x=g[f];if(l.layers.test(x.layers)){const b=x.viewport,w=b.minDepth===void 0?0:b.minDepth,_=b.maxDepth===void 0?1:b.maxDepth,T=this._currentRenderContext.viewportValue;T.copy(b).multiplyScalar(this._pixelRatio).floor(),T.minDepth=w,T.maxDepth=_,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(l,s,x,u,p,h,i,d,n)}}}else this._currentRenderObjectFunction(l,s,e,u,p,h,i,d,n)}}renderObject(t,e,s,i,n,o,a,c=null,l=null){let u,p,h;if(t.onBeforeRender(this,e,s,i,n,o),e.overrideMaterial!==null){const d=e.overrideMaterial;n.positionNode&&n.positionNode.isNode&&(u=d.positionNode,d.positionNode=n.positionNode),d.alphaTest=n.alphaTest,d.alphaMap=n.alphaMap,d.isShadowNodeMaterial&&(d.side=n.shadowSide===null?n.side:n.shadowSide,n.depthNode&&n.depthNode.isNode&&(h=d.depthNode,d.depthNode=n.depthNode),n.castShadowNode&&n.castShadowNode.isNode&&(p=d.colorNode,d.colorNode=n.castShadowNode)),n=d}n.transparent===!0&&n.side===se&&n.forceSinglePass===!1?(n.side=je,this._handleObjectFunction(t,n,e,s,a,o,c,"backSide"),n.side=$n,this._handleObjectFunction(t,n,e,s,a,o,c,l),n.side=se):this._handleObjectFunction(t,n,e,s,a,o,c,l),u!==void 0&&(e.overrideMaterial.positionNode=u),h!==void 0&&(e.overrideMaterial.depthNode=h),p!==void 0&&(e.overrideMaterial.colorNode=p),t.onAfterRender(this,e,s,i,n,o)}_renderObjectDirect(t,e,s,i,n,o,a,c){const l=this._objects.get(t,e,s,i,n,this._currentRenderContext,a,c);l.drawRange=t.geometry.drawRange,l.group=o;const u=this._nodes.needsRefresh(l);u&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.scene),this.backend.draw(l,this.info),u&&this._nodes.updateAfter(l)}_createObjectPipeline(t,e,s,i,n,o,a){const c=this._objects.get(t,e,s,i,n,this._currentRenderContext,o,a);this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}get compile(){return this.compileAsync}}class f2{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}clone(){return Object.assign(new this.constructor,this)}}function RS(r){return r+(Ji-r%Ji)%Ji}class n9 extends f2{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e}get byteLength(){return RS(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class o9 extends n9{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let FS=0;class r9 extends o9{constructor(t,e){super("UniformBuffer_"+FS++,t?t.value:null),this.nodeUniform=t,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class ES extends o9{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(t===null){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){let t=0;for(let e=0,s=this.uniforms.length;e<s;e++){const i=this.uniforms[e],{boundary:n,itemSize:o}=i,a=t%Ji,c=Ji-a;a!==0&&c-n<0?t+=Ji-a:a%n!==0&&(t+=a%n),i.offset=t/this.bytesPerElement,t+=o*this.bytesPerElement}return Math.ceil(t/Ji)*Ji}update(){let t=!1;for(const e of this.uniforms)this.updateByType(e)===!0&&(t=!0);return t}updateByType(t){if(t.isNumberUniform)return this.updateNumber(t);if(t.isVector2Uniform)return this.updateVector2(t);if(t.isVector3Uniform)return this.updateVector3(t);if(t.isVector4Uniform)return this.updateVector4(t);if(t.isColorUniform)return this.updateColor(t);if(t.isMatrix3Uniform)return this.updateMatrix3(t);if(t.isMatrix4Uniform)return this.updateMatrix4(t);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,o=t.getType();if(s[n]!==i){const a=this._getBufferForType(o);a[n]=s[n]=i,e=!0}return e}updateVector2(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,o=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y){const a=this._getBufferForType(o);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,e=!0}return e}updateVector3(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,o=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y||s[n+2]!==i.z){const a=this._getBufferForType(o);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,a[n+2]=s[n+2]=i.z,e=!0}return e}updateVector4(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,o=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y||s[n+2]!==i.z||s[n+4]!==i.w){const a=this._getBufferForType(o);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,a[n+2]=s[n+2]=i.z,a[n+3]=s[n+3]=i.w,e=!0}return e}updateColor(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset;if(s[n+0]!==i.r||s[n+1]!==i.g||s[n+2]!==i.b){const o=this.buffer;o[n+0]=s[n+0]=i.r,o[n+1]=s[n+1]=i.g,o[n+2]=s[n+2]=i.b,e=!0}return e}updateMatrix3(t){let e=!1;const s=this.values,i=t.getValue().elements,n=t.offset;if(s[n+0]!==i[0]||s[n+1]!==i[1]||s[n+2]!==i[2]||s[n+4]!==i[3]||s[n+5]!==i[4]||s[n+6]!==i[5]||s[n+8]!==i[6]||s[n+9]!==i[7]||s[n+10]!==i[8]){const o=this.buffer;o[n+0]=s[n+0]=i[0],o[n+1]=s[n+1]=i[1],o[n+2]=s[n+2]=i[2],o[n+4]=s[n+4]=i[3],o[n+5]=s[n+5]=i[4],o[n+6]=s[n+6]=i[5],o[n+8]=s[n+8]=i[6],o[n+9]=s[n+9]=i[7],o[n+10]=s[n+10]=i[8],e=!0}return e}updateMatrix4(t){let e=!1;const s=this.values,i=t.getValue().elements,n=t.offset;return DS(s,i,n)===!1&&(this.buffer.set(i,n),BS(s,i,n),e=!0),e}_getBufferForType(t){return t==="int"||t==="ivec2"||t==="ivec3"||t==="ivec4"?new Int32Array(this.buffer.buffer):t==="uint"||t==="uvec2"||t==="uvec3"||t==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function BS(r,t,e){for(let s=0,i=t.length;s<i;s++)r[e+s]=t[s]}function DS(r,t,e){for(let s=0,i=t.length;s<i;s++)if(r[e+s]!==t[s])return!1;return!0}let PS=0;class a9 extends ES{constructor(t,e){super(t),this.id=PS++,this.groupNode=e,this.isNodeUniformsGroup=!0}getNodes(){const t=[];for(const e of this.uniforms){const s=e.nodeUniform.node;if(!s)throw new Error("NodeUniformsGroup: Uniform has no node.");t.push(s)}return t}}let IS=0;class LS extends f2{constructor(t,e){super(t),this.id=IS++,this.texture=e,this.version=e?e.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(t){const{texture:e}=this;return t!==this.generation?(this.generation=t,!0):e.isVideoTexture}update(){const{texture:t,version:e}=this;return e!==t.version?(this.version=t.version,!0):!1}}class nl extends LS{constructor(t,e,s,i=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=s,this.access=i}needsBindingsUpdate(t){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(t)}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class c9 extends nl{constructor(t,e,s,i){super(t,e,s,i),this.isSampledCubeTexture=!0}}class l9 extends nl{constructor(t,e,s,i){super(t,e,s,i),this.isSampledTexture3D=!0}}const US={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},zS={low:"lowp",medium:"mediump",high:"highp"},Kh={swizzleAssign:!0,storageBuffer:!1},Jh=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class VS extends t9{constructor(t,e){super(t,e,new TS),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==Yn}getMethod(t){return US[t]||t}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,s=this.flowShaderNode(t),i=[];for(const o of e.inputs)i.push(this.getType(o.type)+" "+o.name);return`${this.getType(e.type)} ${e.name}( ${i.join(", ")} ) {

	${s.vars}

${s.code}
	return ${s.result};

}`}setupPBO(t){const e=t.value;if(e.pbo===void 0){const s=e.array,i=e.count*e.itemSize,{itemSize:n}=e,o=e.array.constructor.name.toLowerCase().includes("int");let a=o?Uu:Ec;n===2?a=o?zu:aa:n===3?a=o?ld:Lu:n===4&&(a=o?Vu:an);const c={Float32Array:qe,Uint8Array:nn,Uint16Array:$o,Uint32Array:Ae,Int8Array:$r,Int16Array:Hr,Int32Array:ke,Uint8ClampedArray:nn},l=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/n))));let u=Math.ceil(i/n/l);l*u*n<i&&u++;const p=l*u*n,h=new s.constructor(p);h.set(s,0),e.array=h;const d=new Yu(e.array,l,u,a,c[e.array.constructor.name]||qe);d.needsUpdate=!0,d.isPBOTexture=!0;const g=new ii(d,null,null);g.setPrecision("high"),e.pboNode=g,e.pbo=g.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&t.node.isTextureNode!==!0&&t.node.isBufferNode!==!0?e.charAt(0)+"_"+t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:s}=t,i=e.value;if(this.renderer.backend.has(i)){const u=this.renderer.backend.get(i);u.pbo=i.pbo}const n=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),o=this.getPropertyName(n);this.increaseUsage(s);const a=s.build(this,"uint"),c=this.getDataFromNode(t);let l=c.propertyName;if(l===void 0){const u=this.getVarFromNode(t);l=this.getPropertyName(u);const p=this.getDataFromNode(e);let h=p.propertySizeName;h===void 0&&(h=l+"Size",this.getVarFromNode(e,h,"uint"),this.addLineFlowCode(`${h} = uint( textureSize( ${o}, 0 ).x )`,t),p.propertySizeName=h);const{itemSize:d}=i,g="."+io.join("").slice(0,d),f=`ivec2(${a} % ${h}, ${a} / ${h})`,y=this.generateTextureLoad(null,o,f,null,"0");let x="vec4";i.pbo.type===Ae?x="uvec4":i.pbo.type===ke&&(x="ivec4"),this.addLineFlowCode(`${l} = ${x}(${y})${g}`,t),c.propertyName=l}return l}generateTextureLoad(t,e,s,i,n="0"){return i?`texelFetch( ${e}, ivec3( ${s}, ${i} ), ${n} )`:`texelFetch( ${e}, ${s}, ${n} )`}generateTexture(t,e,s,i){return t.isDepthTexture?`texture( ${e}, ${s} ).x`:(i&&(s=`vec3( ${s}, ${i} )`),`texture( ${e}, ${s} )`)}generateTextureLevel(t,e,s,i){return`textureLod( ${e}, ${s}, ${i} )`}generateTextureBias(t,e,s,i){return`texture( ${e}, ${s}, ${i} )`}generateTextureGrad(t,e,s,i){return`textureGrad( ${e}, ${s}, ${i[0]}, ${i[1]} )`}generateTextureCompare(t,e,s,i,n,o=this.shaderStage){if(o==="fragment")return`texture( ${e}, vec3( ${s}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}getVars(t){const e=[],s=this.vars[t];if(s!==void 0)for(const i of s)e.push(`${this.getVar(i.type,i.name)};`);return e.join(`
	`)}getUniforms(t){const e=this.uniforms[t],s=[],i={};for(const o of e){let a=null,c=!1;if(o.type==="texture"){const u=o.node.value;let p="";u.isDataTexture===!0&&(u.type===Ae?p="u":u.type===ke&&(p="i")),u.compareFunction?a=`sampler2DShadow ${o.name};`:u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?a=`${p}sampler2DArray ${o.name};`:a=`${p}sampler2D ${o.name};`}else if(o.type==="cubeTexture")a=`samplerCube ${o.name};`;else if(o.type==="texture3D")a=`sampler3D ${o.name};`;else if(o.type==="buffer"){const u=o.node,p=this.getType(u.bufferType),h=u.bufferCount,d=h>0?h:"";a=`${u.name} {
	${p} ${o.name}[${d}];
};
`}else a=`${this.getVectorType(o.type)} ${this.getPropertyName(o,t)};`,c=!0;const l=o.node.precision;if(l!==null&&(a=zS[l]+" "+a),c){a="	"+a;const u=o.groupNode.name;(i[u]||(i[u]=[])).push(a)}else a="uniform "+a,s.push(a)}let n="";for(const o in i){const a=i[o];n+=this._getGLSLUniformStruct(t+"_"+o,a.join(`
`))+`
`}return n+=s.join(`
`),n}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==ke){let s=t;t.isInterleavedBufferAttribute&&(s=t.data);const i=s.array;i instanceof Uint32Array||i instanceof Int32Array||(e=e.slice(1))}return e}getAttributes(t){let e="";if(t==="vertex"||t==="compute"){const s=this.getAttributesArray();let i=0;for(const n of s)e+=`layout( location = ${i++} ) in ${n.type} ${n.name};
`}return e}getStructMembers(t){const e=[],s=t.getMemberTypes();for(let i=0;i<s.length;i++){const n=s[i];e.push(`layout( location = ${i} ) out ${n} m${i};`)}return e.join(`
`)}getStructs(t){const e=[],s=this.structs[t];if(s.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let i=0,n=s.length;i<n;i++){const o=s[i];let a=`
`;a+=this.getStructMembers(o),a+=`
`,e.push(a)}return e.join(`

`)}getVaryings(t){let e="";const s=this.varyings;if(t==="vertex"||t==="compute")for(const i of s){t==="compute"&&(i.needsInterpolation=!0);const n=this.getType(i.type),o=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";e+=`${o}${i.needsInterpolation?"out":"/*out*/"} ${n} ${i.name};
`}else if(t==="fragment"){for(const i of s)if(i.needsInterpolation){const n=this.getType(i.type),o=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";e+=`${o}in ${n} ${i.name};
`}}for(const i of this.builtins[t])e+=`${i};
`;return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((s,i)=>s*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,s=this.shaderStage){const i=this.extensions[s]||(this.extensions[s]=new Map);i.has(t)===!1&&i.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if(t==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const s=this.extensions[t];if(s!==void 0)for(const{name:i,behavior:n}of s.values())e.push(`#extension ${i} : ${n}`);return e.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(t){let e=Kh[t];if(e===void 0){let s;switch(e=!1,t){case"float32Filterable":s="OES_texture_float_linear";break;case"clipDistance":s="WEBGL_clip_cull_distance";break}if(s!==void 0){const i=this.renderer.backend.extensions;i.has(s)&&(i.get(s),e=!0)}Kh[t]=e}return e}isFlipY(){return!0}enableHardwareClipping(t){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${t} ]`)}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let s=0;s<t.length;s++){const i=t[s],n=this.getPropertyName(i.attributeNode);e+=`${i.varyingName} = ${n};
	`}return e}_getGLSLUniformStruct(t,e){return`
layout( std140 ) uniform ${t} {
${e}
};`}_getGLSLVertexCode(t){return`#version 300 es

${this.getSignature()}

// extensions 
${t.extensions}

// precision
${Jh}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// attributes
${t.attributes}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// transforms
	${t.transforms}

	// flow
	${t.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(t){return`#version 300 es

${this.getSignature()}

// precision
${Jh}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// codes
${t.codes}

${t.structs}

void main() {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let s=`// code

`;s+=this.flowCode[e];const i=this.flowNodes[e],n=i[i.length-1];for(const a of i){const c=this.getFlowData(a),l=a.name;l&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${l}
	`),s+=`${c.code}
	`,a===n&&e!=="compute"&&(s+=`// result
	`,e==="vertex"?(s+="gl_Position = ",s+=`${c.result};`):e==="fragment"&&(a.outputNode.isOutputStructNode||(s+="fragColor = ",s+=`${c.result};`)))}const o=t[e];o.extensions=this.getExtensions(e),o.uniforms=this.getUniforms(e),o.attributes=this.getAttributes(e),o.varyings=this.getVaryings(e),o.vars=this.getVars(e),o.structs=this.getStructs(e),o.codes=this.getCodes(e),o.transforms=this.getTransforms(e),o.flow=s}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,s,i=null){const n=super.getUniformFromNode(t,e,s,i),o=this.getDataFromNode(t,s,this.globalCache);let a=o.uniformGPU;if(a===void 0){const c=t.groupNode,l=c.name,u=this.getBindGroupArray(l,s);if(e==="texture")a=new nl(n.name,n.node,c),u.push(a);else if(e==="cubeTexture")a=new c9(n.name,n.node,c),u.push(a);else if(e==="texture3D")a=new l9(n.name,n.node,c),u.push(a);else if(e==="buffer"){t.name=`NodeBuffer_${t.id}`,n.name=`buffer${t.id}`;const p=new r9(t,c);p.name=t.name,u.push(p),a=p}else{const p=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=p[l];h===void 0&&(h=new a9(s+"_"+l,c),p[l]=h,u.push(h)),a=this.getNodeUniform(n,e),h.addUniform(a)}o.uniformGPU=a}return n}}let r1=null,a1=null,Eo=null;class u9{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(t){this.renderer=t}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(t){const{object:e,geometry:s}=t;return s.isInstancedBufferGeometry?s.instanceCount:e.count>1?e.count:1}getDrawingBufferSize(){return r1=r1||new q,this.renderer.getDrawingBufferSize(r1)}getScissor(){return a1=a1||new yt,this.renderer.getScissor(a1)}setScissorTest(){}getClearColor(){const t=this.renderer;return Eo=Eo||new Qp,t.getClearColor(Eo),Eo.getRGB(Eo,this.renderer.currentColorSpace),Eo}getDomElement(){let t=this.domElement;return t===null&&(t=this.parameters.canvas!==void 0?this.parameters.canvas:Wd(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Rc} webgpu`),this.domElement=t),t}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}dispose(){}}let kS=0;class OS{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class GS{constructor(t){this.backend=t}createAttribute(t,e){const s=this.backend,{gl:i}=s,n=t.array,o=t.usage||i.STATIC_DRAW,a=t.isInterleavedBufferAttribute?t.data:t,c=s.get(a);let l=c.bufferGPU;l===void 0&&(l=this._createBuffer(i,e,n,o),c.bufferGPU=l,c.bufferType=e,c.version=a.version);let u;if(n instanceof Float32Array)u=i.FLOAT;else if(n instanceof Uint16Array)t.isFloat16BufferAttribute?u=i.HALF_FLOAT:u=i.UNSIGNED_SHORT;else if(n instanceof Int16Array)u=i.SHORT;else if(n instanceof Uint32Array)u=i.UNSIGNED_INT;else if(n instanceof Int32Array)u=i.INT;else if(n instanceof Int8Array)u=i.BYTE;else if(n instanceof Uint8Array)u=i.UNSIGNED_BYTE;else if(n instanceof Uint8ClampedArray)u=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+n);let p={bufferGPU:l,bufferType:e,type:u,byteLength:n.byteLength,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:u===i.INT||u===i.UNSIGNED_INT||t.gpuType===ke,id:kS++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const h=this._createBuffer(i,e,n,o);p=new OS(p,h)}s.set(t,p)}updateAttribute(t){const e=this.backend,{gl:s}=e,i=t.array,n=t.isInterleavedBufferAttribute?t.data:t,o=e.get(n),a=o.bufferType,c=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(s.bindBuffer(a,o.bufferGPU),c.length===0)s.bufferSubData(a,0,i);else{for(let l=0,u=c.length;l<u;l++){const p=c[l];s.bufferSubData(a,p.start*i.BYTES_PER_ELEMENT,i,p.start,p.count)}n.clearUpdateRanges()}s.bindBuffer(a,null),o.version=n.version}destroyAttribute(t){const e=this.backend,{gl:s}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const i=e.get(t);s.deleteBuffer(i.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:s}=e,i=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:n}=e.get(i),o=t.array,a=o.byteLength;s.bindBuffer(s.COPY_READ_BUFFER,n);const c=s.createBuffer();s.bindBuffer(s.COPY_WRITE_BUFFER,c),s.bufferData(s.COPY_WRITE_BUFFER,a,s.STREAM_READ),s.copyBufferSubData(s.COPY_READ_BUFFER,s.COPY_WRITE_BUFFER,0,0,a),await e.utils._clientWaitAsync();const l=new t.array.constructor(o.length);return s.bindBuffer(s.COPY_WRITE_BUFFER,c),s.getBufferSubData(s.COPY_WRITE_BUFFER,0,l),s.deleteBuffer(c),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(t,e,s,i){const n=t.createBuffer();return t.bindBuffer(e,n),t.bufferData(e,s,i),t.bindBuffer(e,null),n}}let Qh=!1,c1,Pr;class WS{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},Qh===!1&&(this._init(this.gl),Qh=!0)}_init(t){c1={[ji]:t.FUNC_ADD,[L3]:t.FUNC_SUBTRACT,[U3]:t.FUNC_REVERSE_SUBTRACT},Pr={[z3]:t.ZERO,[V3]:t.ONE,[k3]:t.SRC_COLOR,[sc]:t.SRC_ALPHA,[q3]:t.SRC_ALPHA_SATURATE,[$3]:t.DST_COLOR,[G3]:t.DST_ALPHA,[O3]:t.ONE_MINUS_SRC_COLOR,[ic]:t.ONE_MINUS_SRC_ALPHA,[H3]:t.ONE_MINUS_DST_COLOR,[W3]:t.ONE_MINUS_DST_ALPHA}}enable(t){const{enabled:e}=this;e[t]!==!0&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;e[t]!==!1&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;t!==W9?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===$9?e.cullFace(e.BACK):t===H9?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:s}=this;t!==e&&(s.lineWidth(t),this.currentLineWidth=t)}setBlending(t,e,s,i,n,o,a,c){const{gl:l}=this;if(t===Hn){this.currentBlendingEnabled===!0&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),t!==I3){if(t!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==ji||this.currentBlendEquationAlpha!==ji)&&(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=ji,this.currentBlendEquationAlpha=ji),c)switch(t){case sn:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case pe:l.blendFunc(l.ONE,l.ONE);break;case tc:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case ec:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}else switch(t){case sn:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case pe:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case tc:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case ec:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=c}return}n=n||e,o=o||s,a=a||i,(e!==this.currentBlendEquation||n!==this.currentBlendEquationAlpha)&&(l.blendEquationSeparate(c1[e],c1[n]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=n),(s!==this.currentBlendSrc||i!==this.currentBlendDst||o!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(l.blendFuncSeparate(Pr[s],Pr[i],Pr[o],Pr[a]),this.currentBlendSrc=s,this.currentBlendDst=i,this.currentBlendSrcAlpha=o,this.currentBlendDstAlpha=a),this.currentBlending=t,this.currentPremultipledAlpha=!1}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case Y3:e.depthFunc(e.NEVER);break;case X3:e.depthFunc(e.ALWAYS);break;case j3:e.depthFunc(e.LESS);break;case nc:e.depthFunc(e.LEQUAL);break;case Z3:e.depthFunc(e.EQUAL);break;case K3:e.depthFunc(e.GEQUAL);break;case J3:e.depthFunc(e.GREATER);break;case Q3:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}this.currentDepthFunc=t}}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,s){(this.currentStencilFunc!==t||this.currentStencilRef!==e||this.currentStencilFuncMask!==s)&&(this.gl.stencilFunc(t,e,s),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=s)}setStencilOp(t,e,s){(this.currentStencilFail!==t||this.currentStencilZFail!==e||this.currentStencilZPass!==s)&&(this.gl.stencilOp(t,e,s),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=s)}setMaterial(t,e,s){const{gl:i}=this;t.side===se?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let n=t.side===je;e&&(n=!n),this.setFlipSided(n),t.blending===sn&&t.transparent===!1?this.setBlending(Hn):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const o=t.stencilWrite;if(this.setStencilTest(o),o&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),t.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),s>0&&this.currentClippingPlanes!==s)for(let c=0;c<8;c++)c<s?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(t,e,s){const{gl:i}=this;t?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==e||this.currentPolygonOffsetUnits!==s)&&(i.polygonOffset(e,s),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=s)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t?(this.gl.useProgram(t),this.currentProgram=t,!0):!1}bindFramebuffer(t,e){const{gl:s,currentBoundFramebuffers:i}=this;return i[t]!==e?(s.bindFramebuffer(t,e),i[t]=e,t===s.DRAW_FRAMEBUFFER&&(i[s.FRAMEBUFFER]=e),t===s.FRAMEBUFFER&&(i[s.DRAW_FRAMEBUFFER]=e),!0):!1}drawBuffers(t,e){const{gl:s}=this;let i=[],n=!1;if(t.textures!==null){i=this.currentDrawbuffers.get(e),i===void 0&&(i=[],this.currentDrawbuffers.set(e,i));const o=t.textures;if(i.length!==o.length||i[0]!==s.COLOR_ATTACHMENT0){for(let a=0,c=o.length;a<c;a++)i[a]=s.COLOR_ATTACHMENT0+a;i.length=o.length,n=!0}}else i[0]!==s.BACK&&(i[0]=s.BACK,n=!0);n&&s.drawBuffers(i)}activeTexture(t){const{gl:e,currentTextureSlot:s,maxTextures:i}=this;t===void 0&&(t=e.TEXTURE0+i-1),s!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,s){const{gl:i,currentTextureSlot:n,currentBoundTextures:o,maxTextures:a}=this;s===void 0&&(n===null?s=i.TEXTURE0+a-1:s=n);let c=o[s];c===void 0&&(c={type:void 0,texture:void 0},o[s]=c),(c.type!==t||c.texture!==e)&&(n!==s&&(i.activeTexture(s),this.currentTextureSlot=s),i.bindTexture(t,e),c.type=t,c.texture=e)}bindBufferBase(t,e,s){const{gl:i}=this,n=`${t}-${e}`;return this.currentBoundBufferBases[n]!==s?(i.bindBufferBase(t,e,s),this.currentBoundBufferBases[n]=s,!0):!1}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:s}=this,i=s[e];i!==void 0&&i.type!==void 0&&(t.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class $S{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=Yn){const{gl:s,extensions:i}=this;let n;if(t===nn)return s.UNSIGNED_BYTE;if(t===nd)return s.UNSIGNED_SHORT_4_4_4_4;if(t===od)return s.UNSIGNED_SHORT_5_5_5_1;if(t===e5)return s.UNSIGNED_INT_5_9_9_9_REV;if(t===$r)return s.BYTE;if(t===Hr)return s.SHORT;if(t===$o)return s.UNSIGNED_SHORT;if(t===ke)return s.INT;if(t===Ae)return s.UNSIGNED_INT;if(t===qe)return s.FLOAT;if(t===Bs)return s.HALF_FLOAT;if(t===rd)return s.ALPHA;if(t===Lu)return s.RGB;if(t===an)return s.RGBA;if(t===ad)return s.LUMINANCE;if(t===cd)return s.LUMINANCE_ALPHA;if(t===zn)return s.DEPTH_COMPONENT;if(t===or)return s.DEPTH_STENCIL;if(t===Ec)return s.RED;if(t===Uu)return s.RED_INTEGER;if(t===aa)return s.RG;if(t===zu)return s.RG_INTEGER;if(t===Vu)return s.RGBA_INTEGER;if(t===al||t===z0||t===V0||t===k0)if(e===J)if(n=i.get("WEBGL_compressed_texture_s3tc_srgb"),n!==null){if(t===al)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===z0)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===V0)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===k0)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(n=i.get("WEBGL_compressed_texture_s3tc"),n!==null){if(t===al)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===z0)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===V0)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===k0)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(t===w2||t===_2||t===T2||t===S2)if(n=i.get("WEBGL_compressed_texture_pvrtc"),n!==null){if(t===w2)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===_2)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===T2)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===S2)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(t===v2||t===F1||t===E1)if(n=i.get("WEBGL_compressed_texture_etc"),n!==null){if(t===v2||t===F1)return e===J?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(t===E1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(t===B1||t===D1||t===P1||t===I1||t===L1||t===U1||t===z1||t===V1||t===k1||t===O1||t===G1||t===W1||t===$1||t===H1)if(n=i.get("WEBGL_compressed_texture_astc"),n!==null){if(t===B1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===D1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===P1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===I1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===L1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===U1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===z1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===V1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===k1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===O1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===G1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===W1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===$1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===H1)return e===J?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(t===cl)if(n=i.get("EXT_texture_compression_bptc"),n!==null){if(t===cl)return e===J?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(t===ud||t===M2||t===A2||t===N2)if(n=i.get("EXT_texture_compression_rgtc"),n!==null){if(t===cl)return n.COMPRESSED_RED_RGTC1_EXT;if(t===M2)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===A2)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===N2)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return t===Aa?s.UNSIGNED_INT_24_8:s[t]!==void 0?s[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise((s,i)=>{function n(){const o=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(o===t.WAIT_FAILED){t.deleteSync(e),i();return}if(o===t.TIMEOUT_EXPIRED){requestAnimationFrame(n);return}t.deleteSync(e),s()}n()})}}let t3=!1,C0,l1,e3;class HS{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},t3===!1&&(this._init(this.gl),t3=!0)}_init(t){C0={[rn]:t.REPEAT,[Qi]:t.CLAMP_TO_EDGE,[nr]:t.MIRRORED_REPEAT},l1={[we]:t.NEAREST,[C1]:t.NEAREST_MIPMAP_NEAREST,[Jo]:t.NEAREST_MIPMAP_LINEAR,[ps]:t.LINEAR,[R1]:t.LINEAR_MIPMAP_NEAREST,[vi]:t.LINEAR_MIPMAP_LINEAR},e3={[s5]:t.NEVER,[c5]:t.ALWAYS,[ku]:t.LESS,[n5]:t.LEQUAL,[i5]:t.EQUAL,[a5]:t.GEQUAL,[o5]:t.GREATER,[r5]:t.NOTEQUAL}}filterFallback(t){const{gl:e}=this;return t===we||t===C1||t===Jo?e.NEAREST:e.LINEAR}getGLTextureType(t){const{gl:e}=this;let s;return t.isCubeTexture===!0?s=e.TEXTURE_CUBE_MAP:t.isDataArrayTexture===!0||t.isCompressedArrayTexture===!0?s=e.TEXTURE_2D_ARRAY:t.isData3DTexture===!0?s=e.TEXTURE_3D:s=e.TEXTURE_2D,s}getInternalFormat(t,e,s,i,n=!1){const{gl:o,extensions:a}=this;if(t!==null){if(o[t]!==void 0)return o[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let c=e;return e===o.RED&&(s===o.FLOAT&&(c=o.R32F),s===o.HALF_FLOAT&&(c=o.R16F),s===o.UNSIGNED_BYTE&&(c=o.R8),s===o.UNSIGNED_SHORT&&(c=o.R16),s===o.UNSIGNED_INT&&(c=o.R32UI),s===o.BYTE&&(c=o.R8I),s===o.SHORT&&(c=o.R16I),s===o.INT&&(c=o.R32I)),e===o.RED_INTEGER&&(s===o.UNSIGNED_BYTE&&(c=o.R8UI),s===o.UNSIGNED_SHORT&&(c=o.R16UI),s===o.UNSIGNED_INT&&(c=o.R32UI),s===o.BYTE&&(c=o.R8I),s===o.SHORT&&(c=o.R16I),s===o.INT&&(c=o.R32I)),e===o.RG&&(s===o.FLOAT&&(c=o.RG32F),s===o.HALF_FLOAT&&(c=o.RG16F),s===o.UNSIGNED_BYTE&&(c=o.RG8),s===o.UNSIGNED_SHORT&&(c=o.RG16),s===o.UNSIGNED_INT&&(c=o.RG32UI),s===o.BYTE&&(c=o.RG8I),s===o.SHORT&&(c=o.RG16I),s===o.INT&&(c=o.RG32I)),e===o.RG_INTEGER&&(s===o.UNSIGNED_BYTE&&(c=o.RG8UI),s===o.UNSIGNED_SHORT&&(c=o.RG16UI),s===o.UNSIGNED_INT&&(c=o.RG32UI),s===o.BYTE&&(c=o.RG8I),s===o.SHORT&&(c=o.RG16I),s===o.INT&&(c=o.RG32I)),e===o.RGB&&(s===o.FLOAT&&(c=o.RGB32F),s===o.HALF_FLOAT&&(c=o.RGB16F),s===o.UNSIGNED_BYTE&&(c=o.RGB8),s===o.UNSIGNED_SHORT&&(c=o.RGB16),s===o.UNSIGNED_INT&&(c=o.RGB32UI),s===o.BYTE&&(c=o.RGB8I),s===o.SHORT&&(c=o.RGB16I),s===o.INT&&(c=o.RGB32I),s===o.UNSIGNED_BYTE&&(c=i===J&&n===!1?o.SRGB8:o.RGB8),s===o.UNSIGNED_SHORT_5_6_5&&(c=o.RGB565),s===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1),s===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGB4),s===o.UNSIGNED_INT_5_9_9_9_REV&&(c=o.RGB9_E5)),e===o.RGB_INTEGER&&(s===o.UNSIGNED_BYTE&&(c=o.RGB8UI),s===o.UNSIGNED_SHORT&&(c=o.RGB16UI),s===o.UNSIGNED_INT&&(c=o.RGB32UI),s===o.BYTE&&(c=o.RGB8I),s===o.SHORT&&(c=o.RGB16I),s===o.INT&&(c=o.RGB32I)),e===o.RGBA&&(s===o.FLOAT&&(c=o.RGBA32F),s===o.HALF_FLOAT&&(c=o.RGBA16F),s===o.UNSIGNED_BYTE&&(c=o.RGBA8),s===o.UNSIGNED_SHORT&&(c=o.RGBA16),s===o.UNSIGNED_INT&&(c=o.RGBA32UI),s===o.BYTE&&(c=o.RGBA8I),s===o.SHORT&&(c=o.RGBA16I),s===o.INT&&(c=o.RGBA32I),s===o.UNSIGNED_BYTE&&(c=i===J&&n===!1?o.SRGB8_ALPHA8:o.RGBA8),s===o.UNSIGNED_SHORT_4_4_4_4&&(c=o.RGBA4),s===o.UNSIGNED_SHORT_5_5_5_1&&(c=o.RGB5_A1)),e===o.RGBA_INTEGER&&(s===o.UNSIGNED_BYTE&&(c=o.RGBA8UI),s===o.UNSIGNED_SHORT&&(c=o.RGBA16UI),s===o.UNSIGNED_INT&&(c=o.RGBA32UI),s===o.BYTE&&(c=o.RGBA8I),s===o.SHORT&&(c=o.RGBA16I),s===o.INT&&(c=o.RGBA32I)),e===o.DEPTH_COMPONENT&&(s===o.UNSIGNED_INT&&(c=o.DEPTH24_STENCIL8),s===o.FLOAT&&(c=o.DEPTH_COMPONENT32F)),e===o.DEPTH_STENCIL&&s===o.UNSIGNED_INT_24_8&&(c=o.DEPTH24_STENCIL8),(c===o.R16F||c===o.R32F||c===o.RG16F||c===o.RG32F||c===o.RGBA16F||c===o.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(t,e){const{gl:s,extensions:i,backend:n}=this;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texParameteri(t,s.TEXTURE_WRAP_S,C0[e.wrapS]),s.texParameteri(t,s.TEXTURE_WRAP_T,C0[e.wrapT]),(t===s.TEXTURE_3D||t===s.TEXTURE_2D_ARRAY)&&s.texParameteri(t,s.TEXTURE_WRAP_R,C0[e.wrapR]),s.texParameteri(t,s.TEXTURE_MAG_FILTER,l1[e.magFilter]);const o=e.mipmaps!==void 0&&e.mipmaps.length>0,a=e.minFilter===ps&&o?vi:e.minFilter;if(s.texParameteri(t,s.TEXTURE_MIN_FILTER,l1[a]),e.compareFunction&&(s.texParameteri(t,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(t,s.TEXTURE_COMPARE_FUNC,e3[e.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(e.magFilter===we||e.minFilter!==Jo&&e.minFilter!==vi||e.type===qe&&i.has("OES_texture_float_linear")===!1)return;if(e.anisotropy>1){const c=i.get("EXT_texture_filter_anisotropic");s.texParameterf(t,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,n.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:s,defaultTextures:i}=this,n=this.getGLTextureType(t);let o=i[n];o===void 0&&(o=e.createTexture(),s.state.bindTexture(n,o),e.texParameteri(n,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),i[n]=o),s.set(t,{textureGPU:o,glTextureType:n,isDefault:!0})}createTexture(t,e){const{gl:s,backend:i}=this,{levels:n,width:o,height:a,depth:c}=e,l=i.utils.convert(t.format,t.colorSpace),u=i.utils.convert(t.type),p=this.getInternalFormat(t.internalFormat,l,u,t.colorSpace,t.isVideoTexture),h=s.createTexture(),d=this.getGLTextureType(t);i.state.bindTexture(d,h),this.setTextureParameters(d,t),t.isDataArrayTexture||t.isCompressedArrayTexture?s.texStorage3D(s.TEXTURE_2D_ARRAY,n,p,o,a,c):t.isData3DTexture?s.texStorage3D(s.TEXTURE_3D,n,p,o,a,c):t.isVideoTexture||s.texStorage2D(d,n,p,o,a),i.set(t,{textureGPU:h,glTextureType:d,glFormat:l,glType:u,glInternalFormat:p})}copyBufferToTexture(t,e){const{gl:s,backend:i}=this,{textureGPU:n,glTextureType:o,glFormat:a,glType:c}=i.get(e),{width:l,height:u}=e.source.data;s.bindBuffer(s.PIXEL_UNPACK_BUFFER,t),i.state.bindTexture(o,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texSubImage2D(o,0,0,0,l,u,a,c,0),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(t,e){const{gl:s}=this,{width:i,height:n}=e,{textureGPU:o,glTextureType:a,glFormat:c,glType:l,glInternalFormat:u}=this.backend.get(t);if(t.isRenderTargetTexture||o===void 0)return;const p=h=>h.isDataTexture?h.image.data:typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap||h instanceof OffscreenCanvas?h:h.data;if(this.backend.state.bindTexture(a,o),this.setTextureParameters(a,t),t.isCompressedTexture){const h=t.mipmaps,d=e.image;for(let g=0;g<h.length;g++){const f=h[g];t.isCompressedArrayTexture?t.format!==s.RGBA?c!==null?s.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,g,0,0,0,f.width,f.height,d.depth,c,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):s.texSubImage3D(s.TEXTURE_2D_ARRAY,g,0,0,0,f.width,f.height,d.depth,c,l,f.data):c!==null?s.compressedTexSubImage2D(s.TEXTURE_2D,g,0,0,f.width,f.height,c,f.data):console.warn("Unsupported compressed texture format")}}else if(t.isCubeTexture){const h=e.images;for(let d=0;d<6;d++){const g=p(h[d]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,i,n,c,l,g)}}else if(t.isDataArrayTexture){const h=e.image;s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,h.width,h.height,h.depth,c,l,h.data)}else if(t.isData3DTexture){const h=e.image;s.texSubImage3D(s.TEXTURE_3D,0,0,0,0,h.width,h.height,h.depth,c,l,h.data)}else if(t.isVideoTexture)t.update(),s.texImage2D(a,0,u,c,l,e.image);else{const h=p(e.image);s.texSubImage2D(a,0,0,0,i,n,c,l,h)}}generateMipmaps(t){const{gl:e,backend:s}=this,{textureGPU:i,glTextureType:n}=s.get(t);s.state.bindTexture(n,i),e.generateMipmap(n)}deallocateRenderBuffers(t){const{gl:e,backend:s}=this;if(t){const i=s.get(t);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const n in i.framebuffers)e.deleteFramebuffer(i.framebuffers[n]);delete i.framebuffers}if(i.depthRenderbuffer&&(e.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(e.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(e.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let n=0;n<i.msaaRenderbuffers.length;n++)e.deleteRenderbuffer(i.msaaRenderbuffers[n]);delete i.msaaRenderbuffers}}}destroyTexture(t){const{gl:e,backend:s}=this,{textureGPU:i,renderTarget:n}=s.get(t);this.deallocateRenderBuffers(n),e.deleteTexture(i),s.delete(t)}copyTextureToTexture(t,e,s=null,i=null,n=0){const{gl:o,backend:a}=this,{state:c}=this.backend,{textureGPU:l,glTextureType:u,glType:p,glFormat:h}=a.get(e);let d,g,f,y,x,b;s!==null?(d=s.max.x-s.min.x,g=s.max.y-s.min.y,f=s.min.x,y=s.min.y):(d=t.image.width,g=t.image.height,f=0,y=0),i!==null?(x=i.x,b=i.y):(x=0,b=0),c.bindTexture(u,l),o.pixelStorei(o.UNPACK_ALIGNMENT,e.unpackAlignment),o.pixelStorei(o.UNPACK_FLIP_Y_WEBGL,e.flipY),o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),o.pixelStorei(o.UNPACK_ALIGNMENT,e.unpackAlignment);const w=o.getParameter(o.UNPACK_ROW_LENGTH),_=o.getParameter(o.UNPACK_IMAGE_HEIGHT),T=o.getParameter(o.UNPACK_SKIP_PIXELS),M=o.getParameter(o.UNPACK_SKIP_ROWS),A=o.getParameter(o.UNPACK_SKIP_IMAGES),C=t.isCompressedTexture?t.mipmaps[n]:t.image;if(o.pixelStorei(o.UNPACK_ROW_LENGTH,C.width),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,C.height),o.pixelStorei(o.UNPACK_SKIP_PIXELS,f),o.pixelStorei(o.UNPACK_SKIP_ROWS,y),t.isRenderTargetTexture||t.isDepthTexture){const P=a.get(t),D=a.get(e),V=a.get(P.renderTarget),$=a.get(D.renderTarget),Y=V.framebuffers[P.cacheKey],tt=$.framebuffers[D.cacheKey];c.bindFramebuffer(o.READ_FRAMEBUFFER,Y),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,tt);let ot=o.COLOR_BUFFER_BIT;t.isDepthTexture&&(ot=o.DEPTH_BUFFER_BIT),o.blitFramebuffer(f,y,d,g,x,b,d,g,ot,o.NEAREST),c.bindFramebuffer(o.READ_FRAMEBUFFER,null),c.bindFramebuffer(o.DRAW_FRAMEBUFFER,null)}else t.isDataTexture?o.texSubImage2D(o.TEXTURE_2D,n,x,b,d,g,h,p,C.data):t.isCompressedTexture?o.compressedTexSubImage2D(o.TEXTURE_2D,n,x,b,C.width,C.height,h,C.data):o.texSubImage2D(o.TEXTURE_2D,n,x,b,d,g,h,p,C);o.pixelStorei(o.UNPACK_ROW_LENGTH,w),o.pixelStorei(o.UNPACK_IMAGE_HEIGHT,_),o.pixelStorei(o.UNPACK_SKIP_PIXELS,T),o.pixelStorei(o.UNPACK_SKIP_ROWS,M),o.pixelStorei(o.UNPACK_SKIP_IMAGES,A),n===0&&e.generateMipmaps&&o.generateMipmap(o.TEXTURE_2D),c.unbindTexture()}copyFramebufferToTexture(t,e,s){const{gl:i}=this,{state:n}=this.backend,{textureGPU:o}=this.backend.get(t),{x:a,y:c,z:l,w:u}=s,p=t.isDepthTexture===!0||e.renderTarget&&e.renderTarget.samples>0,h=e.renderTarget?e.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(p){const d=a!==0||c!==0;let g,f;if(t.isDepthTexture===!0?(g=i.DEPTH_BUFFER_BIT,f=i.DEPTH_ATTACHMENT,e.stencil&&(g|=i.STENCIL_BUFFER_BIT)):(g=i.COLOR_BUFFER_BIT,f=i.COLOR_ATTACHMENT0),d){const y=this.backend.get(e.renderTarget),x=y.framebuffers[e.getCacheKey()],b=y.msaaFrameBuffer;n.bindFramebuffer(i.DRAW_FRAMEBUFFER,x),n.bindFramebuffer(i.READ_FRAMEBUFFER,b);const w=h-c-u;i.blitFramebuffer(a,w,a+l,w+u,a,w,a+l,w+u,g,i.NEAREST),n.bindFramebuffer(i.READ_FRAMEBUFFER,x),n.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,w,l,u),n.unbindTexture()}else{const y=i.createFramebuffer();n.bindFramebuffer(i.DRAW_FRAMEBUFFER,y),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,f,i.TEXTURE_2D,o,0),i.blitFramebuffer(0,0,l,u,0,0,l,u,g,i.NEAREST),i.deleteFramebuffer(y)}}else n.bindTexture(i.TEXTURE_2D,o),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,h-u-c,l,u),n.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e){const{gl:s}=this,i=e.renderTarget,{samples:n,depthTexture:o,depthBuffer:a,stencilBuffer:c,width:l,height:u}=i;if(s.bindRenderbuffer(s.RENDERBUFFER,t),a&&!c){let p=s.DEPTH_COMPONENT24;n>0?(o&&o.isDepthTexture&&o.type===s.FLOAT&&(p=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,p,l,u)):s.renderbufferStorage(s.RENDERBUFFER,p,l,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t)}else a&&c&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,l,u):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,l,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t))}async copyTextureToBuffer(t,e,s,i,n,o){const{backend:a,gl:c}=this,{textureGPU:l,glFormat:u,glType:p}=this.backend.get(t),h=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,h);const d=t.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+o:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,d,l,0);const g=this._getTypedArrayType(p),f=this._getBytesPerTexel(p,u),x=i*n*f,b=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,b),c.bufferData(c.PIXEL_PACK_BUFFER,x,c.STREAM_READ),c.readPixels(e,s,i,n,u,p,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const w=new g(x/g.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,b),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,w),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(h),w}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4||t===e.UNSIGNED_SHORT_5_5_5_1||t===e.UNSIGNED_SHORT_5_6_5||t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:s}=this;let i=0;if(t===s.UNSIGNED_BYTE&&(i=1),(t===s.UNSIGNED_SHORT_4_4_4_4||t===s.UNSIGNED_SHORT_5_5_5_1||t===s.UNSIGNED_SHORT_5_6_5||t===s.UNSIGNED_SHORT||t===s.HALF_FLOAT)&&(i=2),(t===s.UNSIGNED_INT||t===s.FLOAT)&&(i=4),e===s.RGBA)return i*4;if(e===s.RGB)return i*3;if(e===s.ALPHA)return i}}class qS{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return e===void 0&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class YS{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(e.has("EXT_texture_filter_anisotropic")===!0){const s=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const s3={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class XS{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:s,mode:i,object:n,type:o,info:a,index:c}=this;c!==0?s.drawElements(i,e,o,t):s.drawArrays(i,t,e),a.update(n,e,i,1)}renderInstances(t,e,s){const{gl:i,mode:n,type:o,index:a,object:c,info:l}=this;s!==0&&(a!==0?i.drawElementsInstanced(n,e,o,t,s):i.drawArraysInstanced(n,t,e,s),l.update(c,e,n,s))}renderMultiDraw(t,e,s){const{extensions:i,mode:n,object:o,info:a}=this;if(s===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let l=0;l<s;l++)this.render(t[l],e[l]);else{this.index!==0?c.multiDrawElementsWEBGL(n,e,0,this.type,t,0,s):c.multiDrawArraysWEBGL(n,t,0,e,0,s);let l=0;for(let u=0;u<s;u++)l+=e[u];a.update(o,l,n,1)}}renderMultiDrawInstances(t,e,s,i){const{extensions:n,mode:o,object:a,info:c}=this;if(s===0)return;const l=n.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<s;u++)this.renderInstances(t[u],e[u],i[u]);else{this.index!==0?l.multiDrawElementsInstancedWEBGL(o,e,0,this.type,t,0,i,0,s):l.multiDrawArraysInstancedWEBGL(o,t,0,e,0,i,0,s);let u=0;for(let p=0;p<s;p++)u+=e[p]*i[p];c.update(a,u,o,1)}}}class i3 extends u9{constructor(t={}){super(t),this.isWebGLBackend=!0}init(t){super.init(t);const e=this.parameters,s=e.context!==void 0?e.context:t.domElement.getContext("webgl2");function i(n){n.preventDefault();const o={api:"WebGL",message:n.statusMessage||"Unknown reason",reason:null,originalEvent:n};t.onDeviceLost(o)}this._onContextLost=i,t.domElement.addEventListener("webglcontextlost",i,!1),this.gl=s,this.extensions=new qS(this),this.capabilities=new YS(this),this.attributeUtils=new GS(this),this.textureUtils=new HS(this),this.bufferRenderer=new XS(this),this.state=new WS(this),this.utils=new $S(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=e.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return Rs}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(this.queryRunning){e.queryQueue||(e.queryQueue=[]),e.queryQueue.push(t);return}e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.activeQuery=null),e.activeQuery=this.gl.createQuery(),e.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,e.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.gpuQueries||(e.gpuQueries=[]),e.gpuQueries.push({query:e.activeQuery}),e.activeQuery=null,this.queryRunning=!1,e.queryQueue&&e.queryQueue.length>0)){const s=e.queryQueue.shift();this.initTimestampQuery(s)}}async resolveTimestampAsync(t,e="render"){if(!this.disjoint||!this.trackTimestamp)return;const s=this.get(t);s.gpuQueries||(s.gpuQueries=[]);for(let i=0;i<s.gpuQueries.length;i++){const n=s.gpuQueries[i],o=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(o&&!a){const c=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT),l=Number(c)/1e6;this.gl.deleteQuery(n.query),s.gpuQueries.splice(i,1),i--,this.renderer.info.updateTimestamp(e,l)}}}getContext(){return this.gl}beginRender(t){const{gl:e}=this,s=this.get(t);if(this.initTimestampQuery(t),s.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1),t.viewport?this.updateViewport(t):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.scissor){const{x:n,y:o,width:a,height:c}=t.scissorValue;e.scissor(n,t.height-c-o,a,c)}const i=t.occlusionQueryCount;i>0&&(s.currentOcclusionQueries=s.occlusionQueries,s.currentOcclusionQueryObjects=s.occlusionQueryObjects,s.lastOcclusionObject=null,s.occlusionQueries=new Array(i),s.occlusionQueryObjects=new Array(i),s.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:s}=this,i=this.get(t),n=i.previousContext,o=t.occlusionQueryCount;o>0&&(o>i.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const a=t.textures;if(a!==null)for(let c=0;c<a.length;c++){const l=a[c];l.generateMipmaps&&this.generateMipmaps(l)}if(this._currentContext=n,t.textures!==null&&t.renderTarget){const c=this.get(t.renderTarget),{samples:l}=t.renderTarget;if(l>0){const u=c.framebuffers[t.getCacheKey()],p=e.COLOR_BUFFER_BIT,h=c.msaaFrameBuffer,d=t.textures;s.bindFramebuffer(e.READ_FRAMEBUFFER,h),s.bindFramebuffer(e.DRAW_FRAMEBUFFER,u);for(let g=0;g<d.length;g++)if(t.scissor){const{x:f,y,width:x,height:b}=t.scissorValue,w=t.height-b-y;e.blitFramebuffer(f,w,f+x,w+b,f,w,f+x,w+b,p,e.NEAREST),e.invalidateSubFramebuffer(e.READ_FRAMEBUFFER,c.invalidationArray,f,w,x,b)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,p,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,c.invalidationArray)}}n!==null&&(this._setFramebuffer(n),n.viewport?this.updateViewport(n):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)),this.prepareTimestampBuffer(t)}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:s,currentOcclusionQueryObjects:i}=e;if(s&&i){const n=new WeakSet,{gl:o}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const a=()=>{let c=0;for(let l=0;l<s.length;l++){const u=s[l];u!==null&&o.getQueryParameter(u,o.QUERY_RESULT_AVAILABLE)&&(o.getQueryParameter(u,o.QUERY_RESULT)>0&&n.add(i[l]),s[l]=null,o.deleteQuery(u),c++)}c<s.length?requestAnimationFrame(a):e.occluded=n};a()}}isOccluded(t,e){const s=this.get(t);return s.occluded&&s.occluded.has(e)}updateViewport(t){const e=this.gl,{x:s,y:i,width:n,height:o}=t.viewportValue;e.viewport(s,t.height-o-i,n,o)}setScissorTest(t){const e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)}clear(t,e,s,i=null,n=!0){const{gl:o}=this;if(i===null){const c=this.getClearColor();c.r*=c.a,c.g*=c.a,c.b*=c.a,i={textures:null,clearColorValue:c}}let a=0;if(t&&(a|=o.COLOR_BUFFER_BIT),e&&(a|=o.DEPTH_BUFFER_BIT),s&&(a|=o.STENCIL_BUFFER_BIT),a!==0){let c;if(i.clearColorValue?c=i.clearColorValue:(c=this.getClearColor(),c.r*=c.a,c.g*=c.a,c.b*=c.a),e&&this.state.setDepthMask(!0),i.textures===null)o.clearColor(c.r,c.g,c.b,c.a),o.clear(a);else{if(n&&this._setFramebuffer(i),t)for(let l=0;l<i.textures.length;l++)o.clearBufferfv(o.COLOR,l,[c.r,c.g,c.b,c.a]);e&&s?o.clearBufferfi(o.DEPTH_STENCIL,0,1,0):e?o.clearBufferfv(o.DEPTH,0,[1]):s&&o.clearBufferiv(o.STENCIL,0,[0])}}}beginCompute(t){const{state:e,gl:s}=this;e.bindFramebuffer(s.FRAMEBUFFER,null),this.initTimestampQuery(t)}compute(t,e,s,i){const{state:n,gl:o}=this;this.discard||(o.enable(o.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:c,attributes:l}=this.get(i),u=this._getVaoKey(null,l),p=this.vaoCache[u];p===void 0?this._createVao(null,l):o.bindVertexArray(p),n.useProgram(a),this._bindUniforms(s);const h=this._getTransformFeedback(c);o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,h),o.beginTransformFeedback(o.POINTS),l[0].isStorageInstancedBufferAttribute?o.drawArraysInstanced(o.POINTS,0,1,e.count):o.drawArrays(o.POINTS,0,e.count),o.endTransformFeedback(),o.bindTransformFeedback(o.TRANSFORM_FEEDBACK,null);for(let d=0;d<c.length;d++){const g=c[d];g.pbo&&this.textureUtils.copyBufferToTexture(g.transformBuffer,g.pbo),g.switchBuffers()}}finishCompute(t){const e=this.gl;this.discard=!1,e.disable(e.RASTERIZER_DISCARD),this.prepareTimestampBuffer(t),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(t){const{object:e,pipeline:s,material:i,context:n,hardwareClippingPlanes:o}=t,{programGPU:a}=this.get(s),{gl:c,state:l}=this,u=this.get(n),p=t.getDrawParameters();if(p===null)return;this._bindUniforms(t.getBindings());const h=e.isMesh&&e.matrixWorld.determinant()<0;l.setMaterial(i,h,o),l.useProgram(a);const d=this.get(t);let g=d.staticVao;if(g===void 0||d.geometryId!==t.geometry.id){const T=this._getVaoKey(t.getIndex(),t.getAttributes());if(g=this.vaoCache[T],g===void 0){let M;({vaoGPU:g,staticVao:M}=this._createVao(t.getIndex(),t.getAttributes())),M&&(d.staticVao=g,d.geometryId=t.geometry.id)}}c.bindVertexArray(g);const f=t.getIndex(),y=u.lastOcclusionObject;if(y!==e&&y!==void 0){if(y!==null&&y.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),e.occlusionTest===!0){const T=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,T),u.occlusionQueries[u.occlusionQueryIndex]=T,u.occlusionQueryObjects[u.occlusionQueryIndex]=e}u.lastOcclusionObject=e}const x=this.bufferRenderer;e.isPoints?x.mode=c.POINTS:e.isLineSegments?x.mode=c.LINES:e.isLine?x.mode=c.LINE_STRIP:e.isLineLoop?x.mode=c.LINE_LOOP:i.wireframe===!0?(l.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),x.mode=c.LINES):x.mode=c.TRIANGLES;const{vertexCount:b,instanceCount:w}=p;let{firstVertex:_}=p;if(x.object=e,f!==null){_*=f.array.BYTES_PER_ELEMENT;const T=this.get(f);x.index=f.count,x.type=T.type}else x.index=0;e.isBatchedMesh?e._multiDrawInstances!==null?x.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?x.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):$d("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):w>1?x.renderInstances(_,b,w):x.render(_,b),c.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,s,i,n,o){return this.textureUtils.copyTextureToBuffer(t,e,s,i,n,o)}createSampler(){}destroySampler(){}createNodeBuilder(t,e){return new VS(t,e)}createProgram(t){const e=this.gl,{stage:s,code:i}=t,n=s==="fragment"?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(n,i),e.compileShader(n),this.set(t,{shaderGPU:n})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(t,e){const s=this.gl,i=t.pipeline,{fragmentProgram:n,vertexProgram:o}=i,a=s.createProgram(),c=this.get(n).shaderGPU,l=this.get(o).shaderGPU;if(s.attachShader(a,c),s.attachShader(a,l),s.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:l}),e!==null&&this.parallel){const u=new Promise(p=>{const h=this.parallel,d=()=>{s.getProgramParameter(a,h.COMPLETION_STATUS_KHR)?(this._completeCompile(t,i),p()):requestAnimationFrame(d)};d()});e.push(u);return}this._completeCompile(t,i)}_handleSource(t,e){const s=t.split(`
`),i=[],n=Math.max(e-6,0),o=Math.min(e+6,s.length);for(let a=n;a<o;a++){const c=a+1;i.push(`${c===e?">":" "} ${c}: ${s[a]}`)}return i.join(`
`)}_getShaderErrors(t,e,s){const i=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(i&&n==="")return"";const o=/ERROR: 0:(\d+)/.exec(n);if(o){const a=parseInt(o[1]);return s.toUpperCase()+`

`+n+`

`+this._handleSource(t.getShaderSource(e),a)}else return n}_logProgramError(t,e,s){if(this.renderer.debug.checkShaderErrors){const i=this.gl,n=i.getProgramInfoLog(t).trim();if(i.getProgramParameter(t,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,t,s,e);else{const o=this._getShaderErrors(i,s,"vertex"),a=this._getShaderErrors(i,e,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(t,i.VALIDATE_STATUS)+`

Program Info Log: `+n+`
`+o+`
`+a)}else n!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",n)}}_completeCompile(t,e){const{state:s,gl:i}=this,n=this.get(e),{programGPU:o,fragmentShader:a,vertexShader:c}=n;i.getProgramParameter(o,i.LINK_STATUS)===!1&&this._logProgramError(o,a,c),s.useProgram(o);const l=t.getBindings();this._setupBindings(l,o),this.set(e,{programGPU:o})}createComputePipeline(t,e){const{state:s,gl:i}=this,n={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(n);const{computeProgram:o}=t,a=i.createProgram(),c=this.get(n).shaderGPU,l=this.get(o).shaderGPU,u=o.transforms,p=[],h=[];for(let y=0;y<u.length;y++){const x=u[y];p.push(x.varyingName),h.push(x.attributeNode)}i.attachShader(a,c),i.attachShader(a,l),i.transformFeedbackVaryings(a,p,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,l),s.useProgram(a),this._setupBindings(e,a);const d=o.attributes,g=[],f=[];for(let y=0;y<d.length;y++){const x=d[y].node.attribute;g.push(x),this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER)}for(let y=0;y<h.length;y++){const x=h[y].attribute;this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER);const b=this.get(x);f.push(b)}this.set(t,{programGPU:a,transformBuffers:f,attributes:g})}createBindings(t,e){if(this._knownBindings.has(e)===!1){this._knownBindings.add(e);let s=0,i=0;for(const n of e){this.set(n,{textures:i,uniformBuffers:s});for(const o of n.bindings)o.isUniformBuffer&&s++,o.isSampledTexture&&i++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,s=this.get(t);let i=s.uniformBuffers,n=s.textures;for(const o of t.bindings)if(o.isUniformsGroup||o.isUniformBuffer){const a=o.buffer,c=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,c),e.bufferData(e.UNIFORM_BUFFER,a,e.DYNAMIC_DRAW),this.set(o,{index:i++,bufferGPU:c})}else if(o.isSampledTexture){const{textureGPU:a,glTextureType:c}=this.get(o.texture);this.set(o,{index:n++,textureGPU:a,glTextureType:c})}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const i=this.get(t).bufferGPU,n=t.buffer;e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,n,e.DYNAMIC_DRAW)}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){}hasFeature(t){const e=Object.keys(s3).filter(i=>s3[i]===t),s=this.extensions;for(let i=0;i<e.length;i++)if(s.has(e[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,s,i,n){this.textureUtils.copyTextureToTexture(t,e,s,i,n)}copyFramebufferToTexture(t,e,s){this.textureUtils.copyFramebufferToTexture(t,e,s)}_setFramebuffer(t){const{gl:e,state:s}=this;let i=null;if(t.textures!==null){const n=t.renderTarget,o=this.get(n),{samples:a,depthBuffer:c,stencilBuffer:l}=n,u=n.isWebGLCubeRenderTarget===!0;let p=o.msaaFrameBuffer,h=o.depthRenderbuffer;const d=n7(t);let g;if(u?(o.cubeFramebuffers||(o.cubeFramebuffers={}),g=o.cubeFramebuffers[d]):(o.framebuffers||(o.framebuffers={}),g=o.framebuffers[d]),g===void 0){g=e.createFramebuffer(),s.bindFramebuffer(e.FRAMEBUFFER,g);const f=t.textures;if(u){o.cubeFramebuffers[d]=g;const{textureGPU:y}=this.get(f[0]),x=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+x,y,0)}else{o.framebuffers[d]=g;for(let y=0;y<f.length;y++){const x=f[y],b=this.get(x);b.renderTarget=t.renderTarget,b.cacheKey=d;const w=e.COLOR_ATTACHMENT0+y;e.framebufferTexture2D(e.FRAMEBUFFER,w,e.TEXTURE_2D,b.textureGPU,0)}s.drawBuffers(t,g)}if(t.depthTexture!==null){const y=this.get(t.depthTexture),x=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;y.renderTarget=t.renderTarget,y.cacheKey=d,e.framebufferTexture2D(e.FRAMEBUFFER,x,e.TEXTURE_2D,y.textureGPU,0)}}if(a>0){if(p===void 0){const f=[];p=e.createFramebuffer(),s.bindFramebuffer(e.FRAMEBUFFER,p);const y=[],x=t.textures;for(let b=0;b<x.length;b++){if(y[b]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,y[b]),f.push(e.COLOR_ATTACHMENT0+b),c){const T=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;f.push(T)}const w=t.textures[b],_=this.get(w);e.renderbufferStorageMultisample(e.RENDERBUFFER,a,_.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+b,e.RENDERBUFFER,y[b])}if(o.msaaFrameBuffer=p,o.msaaRenderbuffers=y,h===void 0){h=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(h,t),o.depthRenderbuffer=h;const b=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;f.push(b)}o.invalidationArray=f}i=o.msaaFrameBuffer}else i=g}s.bindFramebuffer(e.FRAMEBUFFER,i)}_getVaoKey(t,e){let s=[];if(t!==null){const i=this.get(t);s+=":"+i.id}for(let i=0;i<e.length;i++){const n=this.get(e[i]);s+=":"+n.id}return s}_createVao(t,e){const{gl:s}=this,i=s.createVertexArray();let n="",o=!0;if(s.bindVertexArray(i),t!==null){const a=this.get(t);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,a.bufferGPU),n+=":"+a.id}for(let a=0;a<e.length;a++){const c=e[a],l=this.get(c);n+=":"+l.id,s.bindBuffer(s.ARRAY_BUFFER,l.bufferGPU),s.enableVertexAttribArray(a),(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&(o=!1);let u,p;c.isInterleavedBufferAttribute===!0?(u=c.data.stride*l.bytesPerElement,p=c.offset*l.bytesPerElement):(u=0,p=0),l.isInteger?s.vertexAttribIPointer(a,c.itemSize,l.type,u,p):s.vertexAttribPointer(a,c.itemSize,l.type,c.normalized,u,p),c.isInstancedBufferAttribute&&!c.isInterleavedBufferAttribute?s.vertexAttribDivisor(a,c.meshPerAttribute):c.isInterleavedBufferAttribute&&c.data.isInstancedInterleavedBuffer&&s.vertexAttribDivisor(a,c.data.meshPerAttribute)}return s.bindBuffer(s.ARRAY_BUFFER,null),this.vaoCache[n]=i,{vaoGPU:i,staticVao:o}}_getTransformFeedback(t){let e="";for(let n=0;n<t.length;n++)e+=":"+t[n].id;let s=this.transformFeedbackCache[e];if(s!==void 0)return s;const{gl:i}=this;s=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s);for(let n=0;n<t.length;n++){const o=t[n];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,n,o.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=s,s}_setupBindings(t,e){const s=this.gl;for(const i of t)for(const n of i.bindings){const a=this.get(n).index;if(n.isUniformsGroup||n.isUniformBuffer){const c=s.getUniformBlockIndex(e,n.name);s.uniformBlockBinding(e,c,a)}else if(n.isSampledTexture){const c=s.getUniformLocation(e,n.name);s.uniform1i(c,a)}}}_bindUniforms(t){const{gl:e,state:s}=this;for(const i of t)for(const n of i.bindings){const o=this.get(n),a=o.index;n.isUniformsGroup||n.isUniformBuffer?s.bindBufferBase(e.UNIFORM_BUFFER,a,o.bufferGPU):n.isSampledTexture&&s.bindTexture(o.glTextureType,o.textureGPU,e.TEXTURE0+a)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const jo={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},Te={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},ve={Store:"store"},re={Load:"load",Clear:"clear"},u1={CCW:"ccw"},p1={None:"none",Front:"front",Back:"back"},ur={Uint16:"uint16",Uint32:"uint32"},R={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},h1={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Bn={Linear:"linear",Nearest:"nearest"},nt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Nn={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},n3={None:0,All:15},Hi={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},d1={Storage:"storage",ReadOnlyStorage:"read-only-storage"},g1={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},Ir={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},o3={TwoD:"2d",ThreeD:"3d"},ms={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},jS={All:"all"},R0={Vertex:"vertex",Instance:"instance"},xu={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class ZS extends f2{constructor(t,e){super(t),this.texture=e,this.version=e?e.version:0,this.isSampler=!0}}class KS extends ZS{constructor(t,e,s){super(t,e?e.value:null),this.textureNode=e,this.groupNode=s}update(){this.texture=this.textureNode.value}}class JS extends n9{constructor(t,e){super(t,e?e.array:null),this.attribute=e,this.isStorageBuffer=!0}}let QS=0;class tv extends JS{constructor(t,e){super("StorageBuffer_"+QS++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:Ie.READ_WRITE,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class ev extends bn{constructor(t){super(),this.device=t;const e=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=t.createSampler({minFilter:Bn.Linear}),this.flipYSampler=t.createSampler({minFilter:Bn.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=t.createShaderModule({label:"mipmapVertex",code:e}),this.mipmapFragmentShaderModule=t.createShaderModule({label:"mipmapFragment",code:s}),this.flipYFragmentShaderModule=t.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(t){let e=this.transferPipelines[t];return e===void 0&&(e=this.device.createRenderPipeline({label:`mipmap-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:jo.TriangleStrip,stripIndexFormat:ur.Uint32},layout:"auto"}),this.transferPipelines[t]=e),e}getFlipYPipeline(t){let e=this.flipYPipelines[t];return e===void 0&&(e=this.device.createRenderPipeline({label:`flipY-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:jo.TriangleStrip,stripIndexFormat:ur.Uint32},layout:"auto"}),this.flipYPipelines[t]=e),e}flipY(t,e,s=0){const i=e.format,{width:n,height:o}=e.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),l=this.device.createTexture({size:{width:n,height:o,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:ms.TwoD,baseArrayLayer:s}),p=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:ms.TwoD,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),d=(g,f,y)=>{const x=g.getBindGroupLayout(0),b=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:f}]}),w=h.beginRenderPass({colorAttachments:[{view:y,loadOp:re.Clear,storeOp:ve.Store,clearValue:[0,0,0,0]}]});w.setPipeline(g),w.setBindGroup(0,b),w.draw(4,1,0,0),w.end()};d(a,u,p),d(c,p,u),this.device.queue.submit([h.finish()]),l.destroy()}generateMipmaps(t,e,s=0){const i=this.get(t);i.useCount===void 0&&(i.useCount=0,i.layers=[]);const n=i.layers[s]||this._mipmapCreateBundles(t,e,s),o=this.device.createCommandEncoder({});this._mipmapRunBundles(o,n),this.device.queue.submit([o.finish()]),i.useCount!==0&&(i.layers[s]=n),i.useCount++}_mipmapCreateBundles(t,e,s){const i=this.getTransferPipeline(e.format),n=i.getBindGroupLayout(0);let o=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:ms.TwoD,baseArrayLayer:s});const a=[];for(let c=1;c<e.mipLevelCount;c++){const l=this.device.createBindGroup({layout:n,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:o}]}),u=t.createView({baseMipLevel:c,mipLevelCount:1,dimension:ms.TwoD,baseArrayLayer:s}),p={colorAttachments:[{view:u,loadOp:re.Clear,storeOp:ve.Store,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[e.format]});h.setPipeline(i),h.setBindGroup(0,l),h.draw(4,1,0,0),a.push({renderBundles:[h.finish()],passDescriptor:p}),o=u}return a}_mipmapRunBundles(t,e){const s=e.length;for(let i=0;i<s;i++){const n=e[i],o=t.beginRenderPass(n.passDescriptor);o.executeBundles(n.renderBundles),o.end()}}}const sv={[s5]:"never",[ku]:"less",[i5]:"equal",[n5]:"less-equal",[o5]:"greater",[a5]:"greater-equal",[c5]:"always",[r5]:"not-equal"},iv=[0,1,3,2,4,5];class nv{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new eo,this.depthTexture.name="depthBuffer"}createSampler(t){const e=this.backend,s=e.device,i=e.get(t),n={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};n.magFilter===Bn.Linear&&n.minFilter===Bn.Linear&&n.mipmapFilter===Bn.Linear&&(n.maxAnisotropy=t.anisotropy),t.isDepthTexture&&t.compareFunction!==null&&(n.compare=sv[t.compareFunction]),i.sampler=s.createSampler(n)}createDefaultTexture(t){let e;const s=bu(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(s):t.isVideoTexture?this.backend.get(t).externalTexture=this._getDefaultVideoFrame():e=this._getDefaultTextureGPU(s),this.backend.get(t).texture=e}createTexture(t,e={}){const s=this.backend,i=s.get(t);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");e.needsMipmaps===void 0&&(e.needsMipmaps=!1),e.levels===void 0&&(e.levels=1),e.depth===void 0&&(e.depth=1);const{width:n,height:o,depth:a,levels:c}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(t),u=t.internalFormat||e.format||bu(t,s.device);i.format=u;let p=e.sampleCount!==void 0?e.sampleCount:1;p=s.utils.getSampleCount(p);const h=t.isRenderTargetTexture&&!t.isMultisampleRenderTargetTexture?1:p;let d=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;t.isStorageTexture===!0&&(d|=GPUTextureUsage.STORAGE_BINDING),t.isCompressedTexture!==!0&&t.isCompressedArrayTexture!==!0&&(d|=GPUTextureUsage.RENDER_ATTACHMENT);const g={label:t.name,size:{width:n,height:o,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:h,dimension:l,format:u,usage:d};if(t.isVideoTexture){const f=t.source.data,y=new VideoFrame(f);g.size.width=y.displayWidth,g.size.height=y.displayHeight,y.close(),i.externalTexture=f}else{if(u===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);i.texture=s.device.createTexture(g)}if(t.isRenderTargetTexture&&p>1&&!t.isMultisampleRenderTargetTexture){const f=Object.assign({},g);f.label=f.label+"-msaa",f.sampleCount=p,i.msaaTexture=s.device.createTexture(f)}i.initialized=!0,i.textureDescriptorGPU=g}destroyTexture(t){const e=this.backend,s=e.get(t);s.texture!==void 0&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),e.delete(t)}destroySampler(t){const s=this.backend.get(t);delete s.sampler}generateMipmaps(t){const e=this.backend.get(t);if(t.isCubeTexture)for(let s=0;s<6;s++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,s);else{const s=t.image.depth||1;for(let i=0;i<s;i++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,i)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const t=this.backend,{width:e,height:s}=t.getDrawingBufferSize();return this.colorBuffer=t.device.createTexture({label:"colorBuffer",size:{width:e,height:s,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.samples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(t=!0,e=!1){const s=this.backend,{width:i,height:n}=s.getDrawingBufferSize(),o=this.depthTexture,a=s.get(o).texture;let c,l;if(e?(c=or,l=Aa):t&&(c=zn,l=Ae),a!==void 0){if(o.image.width===i&&o.image.height===n&&o.format===c&&o.type===l)return a;this.destroyTexture(o)}return o.name="depthBuffer",o.format=c,o.type=l,o.image.width=i,o.image.height=n,this.createTexture(o,{sampleCount:s.utils.getSampleCount(s.renderer.samples),width:i,height:n}),s.get(o).texture}updateTexture(t,e){const s=this.backend.get(t),{textureDescriptorGPU:i}=s;if(!(t.isRenderTargetTexture||i===void 0)){if(t.isDataTexture)this._copyBufferToTexture(e.image,s.texture,i,0,t.flipY);else if(t.isDataArrayTexture||t.isData3DTexture)for(let n=0;n<e.image.depth;n++)this._copyBufferToTexture(e.image,s.texture,i,n,t.flipY,n);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,s.texture,i);else if(t.isCubeTexture)this._copyCubeMapToTexture(e.images,s.texture,i,t.flipY);else if(t.isVideoTexture){const n=t.source.data;s.externalTexture=n}else this._copyImageToTexture(e.image,s.texture,i,0,t.flipY);s.version=t.version,t.onUpdate&&t.onUpdate(t)}}async copyTextureToBuffer(t,e,s,i,n,o){const a=this.backend.device,c=this.backend.get(t),l=c.texture,u=c.textureDescriptorGPU.format,p=this._getBytesPerTexel(u);let h=i*p;h=Math.ceil(h/256)*256;const d=a.createBuffer({size:i*n*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),g=a.createCommandEncoder();g.copyTextureToBuffer({texture:l,origin:{x:e,y:s,z:o}},{buffer:d,bytesPerRow:h},{width:i,height:n});const f=this._getTypedArrayType(u);a.queue.submit([g.finish()]),await d.mapAsync(GPUMapMode.READ);const y=d.getMappedRange();return new f(y)}_isEnvironmentTexture(t){const e=t.mapping;return e===va||e===Ma||e===qn||e===ir}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const s=new Ge;s.minFilter=we,s.magFilter=we,this.createTexture(s,{width:1,height:1,format:t}),this.defaultTexture[t]=e=s}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const s=new Gu;s.minFilter=we,s.magFilter=we,this.createTexture(s,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=s}return this.backend.get(e).texture}_getDefaultVideoFrame(){let t=this.defaultVideoFrame;if(t===null){const e={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=t=new VideoFrame(new Uint8Array([0,0,0,255]),e)}return t}_copyCubeMapToTexture(t,e,s,i){for(let n=0;n<6;n++){const o=t[n],a=i===!0?iv[n]:n;o.isDataTexture?this._copyBufferToTexture(o.image,e,s,a,i):this._copyImageToTexture(o,e,s,a,i)}}_copyImageToTexture(t,e,s,i,n){this.backend.device.queue.copyExternalImageToTexture({source:t},{texture:e,mipLevel:0,origin:{x:0,y:0,z:i}},{width:t.width,height:t.height,depthOrArrayLayers:1}),n===!0&&this._flipY(e,s,i)}_getPassUtils(){let t=this._passUtils;return t===null&&(this._passUtils=t=new ev(this.backend.device)),t}_generateMipmaps(t,e,s=0){this._getPassUtils().generateMipmaps(t,e,s)}_flipY(t,e,s=0){this._getPassUtils().flipY(t,e,s)}_copyBufferToTexture(t,e,s,i,n,o=0){const a=this.backend.device,c=t.data,l=this._getBytesPerTexel(s.format),u=t.width*l;a.queue.writeTexture({texture:e,mipLevel:0,origin:{x:0,y:0,z:i}},c,{offset:t.width*t.height*l*o,bytesPerRow:u},{width:t.width,height:t.height,depthOrArrayLayers:1}),n===!0&&this._flipY(e,s,i)}_copyCompressedBufferToTexture(t,e,s){const i=this.backend.device,n=this._getBlockData(s.format),o=s.size.depthOrArrayLayers>1;for(let a=0;a<t.length;a++){const c=t[a],l=c.width,u=c.height,p=o?s.size.depthOrArrayLayers:1,h=Math.ceil(l/n.width)*n.byteLength,d=h*Math.ceil(u/n.height);for(let g=0;g<p;g++)i.queue.writeTexture({texture:e,mipLevel:a,origin:{x:0,y:0,z:g}},c.data,{offset:g*d,bytesPerRow:h,rowsPerImage:Math.ceil(u/n.height)},{width:Math.ceil(l/n.width)*n.width,height:Math.ceil(u/n.height)*n.height,depthOrArrayLayers:1})}}_getBlockData(t){if(t===R.BC1RGBAUnorm||t===R.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.BC2RGBAUnorm||t===R.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.BC3RGBAUnorm||t===R.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.BC4RUnorm||t===R.BC4RSNorm)return{byteLength:8,width:4,height:4};if(t===R.BC5RGUnorm||t===R.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(t===R.BC6HRGBUFloat||t===R.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(t===R.BC7RGBAUnorm||t===R.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.ETC2RGB8Unorm||t===R.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.ETC2RGB8A1Unorm||t===R.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.ETC2RGBA8Unorm||t===R.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.EACR11Unorm)return{byteLength:8,width:4,height:4};if(t===R.EACR11Snorm)return{byteLength:8,width:4,height:4};if(t===R.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(t===R.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(t===R.ASTC4x4Unorm||t===R.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.ASTC5x4Unorm||t===R.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(t===R.ASTC5x5Unorm||t===R.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(t===R.ASTC6x5Unorm||t===R.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(t===R.ASTC6x6Unorm||t===R.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(t===R.ASTC8x5Unorm||t===R.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(t===R.ASTC8x6Unorm||t===R.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(t===R.ASTC8x8Unorm||t===R.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(t===R.ASTC10x5Unorm||t===R.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(t===R.ASTC10x6Unorm||t===R.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(t===R.ASTC10x8Unorm||t===R.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(t===R.ASTC10x10Unorm||t===R.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(t===R.ASTC12x10Unorm||t===R.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(t===R.ASTC12x12Unorm||t===R.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(t){let e=h1.ClampToEdge;return t===rn?e=h1.Repeat:t===nr&&(e=h1.MirrorRepeat),e}_convertFilterMode(t){let e=Bn.Linear;return(t===we||t===C1||t===Jo)&&(e=Bn.Nearest),e}_getBytesPerTexel(t){if(t===R.R8Unorm||t===R.R8Snorm||t===R.R8Uint||t===R.R8Sint)return 1;if(t===R.R16Uint||t===R.R16Sint||t===R.R16Float||t===R.RG8Unorm||t===R.RG8Snorm||t===R.RG8Uint||t===R.RG8Sint)return 2;if(t===R.R32Uint||t===R.R32Sint||t===R.R32Float||t===R.RG16Uint||t===R.RG16Sint||t===R.RG16Float||t===R.RGBA8Unorm||t===R.RGBA8UnormSRGB||t===R.RGBA8Snorm||t===R.RGBA8Uint||t===R.RGBA8Sint||t===R.BGRA8Unorm||t===R.BGRA8UnormSRGB||t===R.RGB9E5UFloat||t===R.RGB10A2Unorm||t===R.RG11B10UFloat||t===R.Depth32Float||t===R.Depth24Plus||t===R.Depth24PlusStencil8||t===R.Depth32FloatStencil8)return 4;if(t===R.RG32Uint||t===R.RG32Sint||t===R.RG32Float||t===R.RGBA16Uint||t===R.RGBA16Sint||t===R.RGBA16Float)return 8;if(t===R.RGBA32Uint||t===R.RGBA32Sint||t===R.RGBA32Float)return 16}_getTypedArrayType(t){if(t===R.R8Uint)return Uint8Array;if(t===R.R8Sint)return Int8Array;if(t===R.R8Unorm)return Uint8Array;if(t===R.R8Snorm)return Int8Array;if(t===R.RG8Uint)return Uint8Array;if(t===R.RG8Sint)return Int8Array;if(t===R.RG8Unorm)return Uint8Array;if(t===R.RG8Snorm)return Int8Array;if(t===R.RGBA8Uint)return Uint8Array;if(t===R.RGBA8Sint)return Int8Array;if(t===R.RGBA8Unorm)return Uint8Array;if(t===R.RGBA8Snorm)return Int8Array;if(t===R.R16Uint)return Uint16Array;if(t===R.R16Sint)return Int16Array;if(t===R.RG16Uint)return Uint16Array;if(t===R.RG16Sint)return Int16Array;if(t===R.RGBA16Uint)return Uint16Array;if(t===R.RGBA16Sint)return Int16Array;if(t===R.R16Float||t===R.RG16Float||t===R.RGBA16Float)return Uint16Array;if(t===R.R32Uint)return Uint32Array;if(t===R.R32Sint)return Int32Array;if(t===R.R32Float)return Float32Array;if(t===R.RG32Uint)return Uint32Array;if(t===R.RG32Sint)return Int32Array;if(t===R.RG32Float)return Float32Array;if(t===R.RGBA32Uint)return Uint32Array;if(t===R.RGBA32Sint)return Int32Array;if(t===R.RGBA32Float)return Float32Array;if(t===R.BGRA8Unorm||t===R.BGRA8UnormSRGB)return Uint8Array;if(t===R.RGB10A2Unorm||t===R.RGB9E5UFloat||t===R.RG11B10UFloat)return Uint32Array;if(t===R.Depth32Float)return Float32Array;if(t===R.Depth24Plus||t===R.Depth24PlusStencil8)return Uint32Array;if(t===R.Depth32FloatStencil8)return Float32Array}_getDimension(t){let e;return t.isData3DTexture?e=o3.ThreeD:e=o3.TwoD,e}}function bu(r,t=null){const e=r.format,s=r.type,i=r.colorSpace;let n;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(e){case z0:n=i===J?R.BC1RGBAUnormSRGB:R.BC1RGBAUnorm;break;case V0:n=i===J?R.BC2RGBAUnormSRGB:R.BC2RGBAUnorm;break;case k0:n=i===J?R.BC3RGBAUnormSRGB:R.BC3RGBAUnorm;break;case F1:n=i===J?R.ETC2RGB8UnormSRGB:R.ETC2RGB8Unorm;break;case E1:n=i===J?R.ETC2RGBA8UnormSRGB:R.ETC2RGBA8Unorm;break;case B1:n=i===J?R.ASTC4x4UnormSRGB:R.ASTC4x4Unorm;break;case D1:n=i===J?R.ASTC5x4UnormSRGB:R.ASTC5x4Unorm;break;case P1:n=i===J?R.ASTC5x5UnormSRGB:R.ASTC5x5Unorm;break;case I1:n=i===J?R.ASTC6x5UnormSRGB:R.ASTC6x5Unorm;break;case L1:n=i===J?R.ASTC6x6UnormSRGB:R.ASTC6x6Unorm;break;case U1:n=i===J?R.ASTC8x5UnormSRGB:R.ASTC8x5Unorm;break;case z1:n=i===J?R.ASTC8x6UnormSRGB:R.ASTC8x6Unorm;break;case V1:n=i===J?R.ASTC8x8UnormSRGB:R.ASTC8x8Unorm;break;case k1:n=i===J?R.ASTC10x5UnormSRGB:R.ASTC10x5Unorm;break;case O1:n=i===J?R.ASTC10x6UnormSRGB:R.ASTC10x6Unorm;break;case G1:n=i===J?R.ASTC10x8UnormSRGB:R.ASTC10x8Unorm;break;case W1:n=i===J?R.ASTC10x10UnormSRGB:R.ASTC10x10Unorm;break;case $1:n=i===J?R.ASTC12x10UnormSRGB:R.ASTC12x10Unorm;break;case H1:n=i===J?R.ASTC12x12UnormSRGB:R.ASTC12x12Unorm;break;case an:n=i===J?R.RGBA8UnormSRGB:R.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",e)}else switch(e){case an:switch(s){case $r:n=R.RGBA8Snorm;break;case Hr:n=R.RGBA16Sint;break;case $o:n=R.RGBA16Uint;break;case Ae:n=R.RGBA32Uint;break;case ke:n=R.RGBA32Sint;break;case nn:n=i===J?R.RGBA8UnormSRGB:R.RGBA8Unorm;break;case Bs:n=R.RGBA16Float;break;case qe:n=R.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",s)}break;case Lu:s===e5?n=R.RGB9E5UFloat:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",s);break;case Ec:switch(s){case $r:n=R.R8Snorm;break;case Hr:n=R.R16Sint;break;case $o:n=R.R16Uint;break;case Ae:n=R.R32Uint;break;case ke:n=R.R32Sint;break;case nn:n=R.R8Unorm;break;case Bs:n=R.R16Float;break;case qe:n=R.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",s)}break;case aa:switch(s){case $r:n=R.RG8Snorm;break;case Hr:n=R.RG16Sint;break;case $o:n=R.RG16Uint;break;case Ae:n=R.RG32Uint;break;case ke:n=R.RG32Sint;break;case nn:n=R.RG8Unorm;break;case Bs:n=R.RG16Float;break;case qe:n=R.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",s)}break;case zn:switch(s){case $o:n=R.Depth16Unorm;break;case Ae:n=R.Depth24Plus;break;case qe:n=R.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",s)}break;case or:switch(s){case Aa:n=R.Depth24PlusStencil8;break;case qe:t&&t.features.has(xu.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),n=R.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",s)}break;case Uu:switch(s){case ke:n=R.R32Sint;break;case Ae:n=R.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",s)}break;case zu:switch(s){case ke:n=R.RG32Sint;break;case Ae:n=R.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",s)}break;case Vu:switch(s){case ke:n=R.RGBA32Sint;break;case Ae:n=R.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",s)}break;default:console.error("WebGPURenderer: Unsupported texture format.",e)}return n}const ov=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,rv=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,r3={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},av=r=>{r=r.trim();const t=r.match(ov);if(t!==null&&t.length===4){const e=t[2],s=[];let i=null;for(;(i=rv.exec(e))!==null;)s.push({name:i[1],type:i[2]});const n=[];for(let u=0;u<s.length;u++){const{name:p,type:h}=s[u];let d=h;d.startsWith("ptr")?d="pointer":(d.startsWith("texture")&&(d=h.split("<")[0]),d=r3[d]),n.push(new d2(d,p))}const o=r.substring(t[0].length),a=t[3]||"void",c=t[1]!==void 0?t[1]:"";return{type:r3[a]||a,inputs:n,name:c,inputsCode:e,blockCode:o,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class cv extends g2{constructor(t){const{type:e,inputs:s,name:i,inputsCode:n,blockCode:o,outputType:a}=av(t);super(e,s,i),this.inputsCode=n,this.blockCode=o,this.outputType=a}getCode(t=this.name){const e=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class lv extends s9{parseFunction(t){return new cv(t)}}const Bo=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},uv={[Ie.READ_ONLY]:"read",[Ie.WRITE_ONLY]:"write",[Ie.READ_WRITE]:"read_write"},a3={[rn]:"repeat",[Qi]:"clamp",[nr]:"mirror"},F0={vertex:Bo?Bo.VERTEX:1,fragment:Bo?Bo.FRAGMENT:2,compute:Bo?Bo.COMPUTE:4},c3={instance:!0,swizzleAssign:!1,storageBuffer:!0},pv={"^^":"tsl_xor"},hv={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},l3={},ys={tsl_xor:new ae("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new ae("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new ae("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new ae("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new ae("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new ae("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new ae("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new ae("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new ae("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new ae("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new ae("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new ae("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new ae(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},Vr={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(ys.pow_float=new ae("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),ys.pow_vec2=new ae("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[ys.pow_float]),ys.pow_vec3=new ae("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[ys.pow_float]),ys.pow_vec4=new ae("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[ys.pow_float]),Vr.pow_float="tsl_pow_float",Vr.pow_vec2="tsl_pow_vec2",Vr.pow_vec3="tsl_pow_vec3",Vr.pow_vec4="tsl_pow_vec4");let p9="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(p9+=`diagnostic( off, derivative_uniformity );
`);class dv extends t9{constructor(t,e){super(t,e,new lv),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==Yn}_generateTextureSample(t,e,s,i,n=this.shaderStage){return n==="fragment"?i?`textureSample( ${e}, ${e}_sampler, ${s}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,s):this.generateTextureLod(t,e,s,i,"0")}_generateVideoSample(t,e,s=this.shaderStage){if(s==="fragment")return`textureSampleBaseClampToEdge( ${t}, ${t}_sampler, vec2<f32>( ${e}.x, 1.0 - ${e}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${s} shader.`)}_generateTextureSampleLevel(t,e,s,i,n,o=this.shaderStage){return o==="fragment"&&this.isUnfilterable(t)===!1?`textureSampleLevel( ${e}, ${e}_sampler, ${s}, ${i} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,s,i):this.generateTextureLod(t,e,s,n,i)}generateWrapFunction(t){const e=`tsl_coord_${a3[t.wrapS]}S_${a3[t.wrapT]}T`;let s=l3[e];if(s===void 0){const i=[];let n=`fn ${e}( coord : vec2f ) -> vec2f {

	return vec2f(
`;const o=(a,c)=>{a===rn?(i.push(ys.repeatWrapping_float),n+=`		tsl_repeatWrapping_float( coord.${c} )`):a===Qi?(i.push(ys.clampWrapping_float),n+=`		tsl_clampWrapping_float( coord.${c} )`):a===nr?(i.push(ys.mirrorWrapping_float),n+=`		tsl_mirrorWrapping_float( coord.${c} )`):(n+=`		coord.${c}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${a}" for vertex shader.`))};o(t.wrapS,"x"),n+=`,
`,o(t.wrapT,"y"),n+=`
	);

}
`,l3[e]=s=new ae(n,i)}return s.build(this),e}generateTextureDimension(t,e,s){const i=this.getDataFromNode(t,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let n=i.dimensionsSnippet[s];if(i.dimensionsSnippet[s]===void 0){let o;t.isMultisampleRenderTargetTexture===!0?o=e:o=`${e}, u32( ${s} )`,n=new r8(new v8(`textureDimensions( ${o} )`,"uvec2")),i.dimensionsSnippet[s]=n}return n.build(this)}generateFilteredTexture(t,e,s,i="0u"){this._include("biquadraticTexture");const n=this.generateWrapFunction(t),o=this.generateTextureDimension(t,e,i);return`tsl_biquadraticTexture( ${e}, ${n}( ${s} ), ${o}, u32( ${i} ) )`}generateTextureLod(t,e,s,i,n="0u"){const o=this.generateWrapFunction(t),a=this.generateTextureDimension(t,e,n),c=`vec2u( ${o}( ${s} ) * vec2f( ${a} ) )`;return this.generateTextureLoad(t,e,c,i,n)}generateTextureLoad(t,e,s,i,n="0u"){return t.isVideoTexture===!0||t.isStorageTexture===!0?`textureLoad( ${e}, ${s} )`:i?`textureLoad( ${e}, ${s}, ${i}, u32( ${n} ) )`:`textureLoad( ${e}, ${s}, u32( ${n} ) )`}generateTextureStore(t,e,s,i){return`textureStore( ${e}, ${s}, ${i} )`}isSampleCompare(t){return t.isDepthTexture===!0&&t.compareFunction!==null}isUnfilterable(t){return this.getComponentTypeFromTexture(t)!=="float"||!this.isAvailable("float32Filterable")&&t.isDataTexture===!0&&t.type===qe||this.isSampleCompare(t)===!1&&t.minFilter===we&&t.magFilter===we||t.isMultisampleRenderTargetTexture===!0}generateTexture(t,e,s,i,n=this.shaderStage){let o=null;return t.isVideoTexture===!0?o=this._generateVideoSample(e,s,n):this.isUnfilterable(t)?o=this.generateTextureLod(t,e,s,i,"0",n):o=this._generateTextureSample(t,e,s,i,n),o}generateTextureGrad(t,e,s,i,n,o=this.shaderStage){if(o==="fragment")return`textureSampleGrad( ${e}, ${e}_sampler, ${s},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${o} shader.`)}generateTextureCompare(t,e,s,i,n,o=this.shaderStage){if(o==="fragment")return`textureSampleCompare( ${e}, ${e}_sampler, ${s}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${o} shader.`)}generateTextureLevel(t,e,s,i,n,o=this.shaderStage){let a=null;return t.isVideoTexture===!0?a=this._generateVideoSample(e,s,o):a=this._generateTextureSampleLevel(t,e,s,i,n,o),a}generateTextureBias(t,e,s,i,n,o=this.shaderStage){if(o==="fragment")return`textureSampleBias( ${e}, ${e}_sampler, ${s}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${o} shader.`)}getPropertyName(t,e=this.shaderStage){if(t.isNodeVarying===!0&&t.needsInterpolation===!0){if(e==="vertex")return`varyings.${t.name}`}else if(t.isNodeUniform===!0){const s=t.name,i=t.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?s:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?`NodeBuffer_${t.id}.${s}`:t.groupNode.name+"."+s}return super.getPropertyName(t)}getOutputStructName(){return"output"}_getUniformGroupCount(t){return Object.keys(this.uniforms[t]).length}getFunctionOperator(t){const e=pv[t];return e!==void 0?(this._include(e),e):null}getNodeAccess(t,e){return e!=="compute"?Ie.READ_ONLY:t.access}getStorageAccess(t,e){return uv[this.getNodeAccess(t,e)]}getUniformFromNode(t,e,s,i=null){const n=super.getUniformFromNode(t,e,s,i),o=this.getDataFromNode(t,s,this.globalCache);if(o.uniformGPU===void 0){let a;const c=t.groupNode,l=c.name,u=this.getBindGroupArray(l,s);if(e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"){let p=null;const h=this.getNodeAccess(t,s);if(e==="texture"||e==="storageTexture"?p=new nl(n.name,n.node,c,h):e==="cubeTexture"?p=new c9(n.name,n.node,c,h):e==="texture3D"&&(p=new l9(n.name,n.node,c,h)),p.store=t.isStorageTextureNode===!0,p.setVisibility(F0[s]),s==="fragment"&&this.isUnfilterable(t.value)===!1&&p.store===!1){const d=new KS(`${n.name}_sampler`,n.node,c);d.setVisibility(F0[s]),u.push(d,p),a=[d,p]}else u.push(p),a=[p]}else if(e==="buffer"||e==="storageBuffer"||e==="indirectStorageBuffer"){const p=e==="buffer"?r9:tv,h=new p(t,c);h.setVisibility(F0[s]),u.push(h),a=h}else{const p=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=p[l];h===void 0&&(h=new a9(l,c),h.setVisibility(F0[s]),p[l]=h,u.push(h)),a=this.getNodeUniform(n,e),h.addUniform(a)}o.uniformGPU=a}return n}getBuiltin(t,e,s,i=this.shaderStage){const n=this.builtins[i]||(this.builtins[i]=new Map);return n.has(t)===!1&&n.set(t,{name:t,property:e,type:s}),e}hasBuiltin(t,e=this.shaderStage){return this.builtins[e]!==void 0&&this.builtins[e].has(t)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,s=this.flowShaderNode(t),i=[];for(const o of e.inputs)i.push(o.name+" : "+this.getType(o.type));let n=`fn ${e.name}( ${i.join(", ")} ) -> ${this.getType(e.type)} {
${s.vars}
${s.code}
`;return s.result&&(n+=`	return ${s.result};
`),n+=`
}
`,n}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],s=this.directives[t];if(s!==void 0)for(const i of s)e.push(`enable ${i};`);return e.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(t){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${t} >`,"vertex")}getBuiltins(t){const e=[],s=this.builtins[t];if(s!==void 0)for(const{name:i,property:n,type:o}of s.values())e.push(`@builtin( ${i} ) ${n} : ${o}`);return e.join(`,
	`)}getScopedArray(t,e,s,i){return this.scopedArrays.has(t)===!1&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:s,bufferCount:i}),t}getScopedArrays(t){if(t!=="compute")return;const e=[];for(const{name:s,scope:i,bufferType:n,bufferCount:o}of this.scopedArrays.values()){const a=this.getType(n);e.push(`var<${i}> ${s}: array< ${a}, ${o} >;`)}return e.join(`
`)}getAttributes(t){const e=[];if(t==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),t==="vertex"||t==="compute"){const s=this.getBuiltins("attribute");s&&e.push(s);const i=this.getAttributesArray();for(let n=0,o=i.length;n<o;n++){const a=i[n],c=a.name,l=this.getType(a.type);e.push(`@location( ${n} ) ${c} : ${l}`)}}return e.join(`,
	`)}getStructMembers(t){const e=[],s=t.getMemberTypes();for(let n=0;n<s.length;n++){const o=s[n];e.push(`	@location( ${n} ) m${n} : ${o}<f32>`)}const i=this.getBuiltins("output");return i&&e.push("	"+i),e.join(`,
`)}getStructs(t){const e=[],s=this.structs[t];for(let i=0,n=s.length;i<n;i++){const o=s[i],a=o.name;let c=`struct ${a} {
`;c+=this.getStructMembers(o),c+=`
}`,e.push(c),e.push(`
var<private> output : ${a};

`)}return e.join(`

`)}getVar(t,e){return`var ${e} : ${this.getType(t)}`}getVars(t){const e=[],s=this.vars[t];if(s!==void 0)for(const i of s)e.push(`	${this.getVar(i.type,i.name)};`);return`
${e.join(`
`)}
`}getVaryings(t){const e=[];if(t==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),t==="vertex"||t==="fragment"){const n=this.varyings,o=this.vars[t];for(let a=0;a<n.length;a++){const c=n[a];if(c.needsInterpolation){let l=`@location( ${a} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(l+=" @interpolate( flat )"),e.push(`${l} ${c.name} : ${this.getType(c.type)}`)}else t==="vertex"&&o.includes(c)===!1&&o.push(c)}}const s=this.getBuiltins(t);s&&e.push(s);const i=e.join(`,
	`);return t==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}getUniforms(t){const e=this.uniforms[t],s=[],i=[],n=[],o={};for(const c of e){const l=c.groupNode.name,u=this.bindingsIndexes[l];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const p=c.node.value;t==="fragment"&&this.isUnfilterable(p)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler_comparison;`):s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler;`));let h,d="";if(p.isMultisampleRenderTargetTexture===!0&&(d="_multisampled"),p.isCubeTexture===!0)h="texture_cube<f32>";else if(p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)h="texture_2d_array<f32>";else if(p.isDepthTexture===!0)h=`texture_depth${d}_2d`;else if(p.isVideoTexture===!0)h="texture_external";else if(p.isData3DTexture===!0)h="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const g=bu(p),f=this.getStorageAccess(c.node,t);h=`texture_storage_2d<${g}, ${f}>`}else{const g=this.getComponentTypeFromTexture(p).charAt(0);h=`texture${d}_2d<${g}32>`}s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name} : ${h};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const p=c.node,h=this.getType(p.bufferType),d=p.bufferCount,g=d>0&&c.type==="buffer"?", "+d:"",f=p.isAtomic?`atomic<${h}>`:`${h}`,y=`	${c.name} : array< ${f}${g} >
`,x=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,t)}`:"uniform";i.push(this._getWGSLStructBinding("NodeBuffer_"+p.id,y,x,u.binding++,u.group))}else{const p=this.getType(this.getVectorType(c.type)),h=c.groupNode.name;(o[h]||(o[h]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${c.name} : ${p}`)}}for(const c in o){const l=o[c];n.push(this._getWGSLStructBinding(c,l.snippets.join(`,
`),"uniform",l.index,l.id))}let a=s.join(`
`);return a+=i.join(`
`),a+=n.join(`
`),a}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){const s=t[e];s.uniforms=this.getUniforms(e),s.attributes=this.getAttributes(e),s.varyings=this.getVaryings(e),s.structs=this.getStructs(e),s.vars=this.getVars(e),s.codes=this.getCodes(e),s.directives=this.getDirectives(e),s.scopedArrays=this.getScopedArrays(e);let i=`// code

`;i+=this.flowCode[e];const n=this.flowNodes[e],o=n[n.length-1],a=o.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const l of n){const u=this.getFlowData(l),p=l.name;if(p&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${p}
	`),i+=`${u.code}
	`,l===o&&e!=="compute"){if(i+=`// result

	`,e==="vertex")i+=`varyings.Vertex = ${u.result};`;else if(e==="fragment")if(c)s.returnType=a.nodeType,i+=`return ${u.result};`;else{let h="	@location(0) color: vec4<f32>";const d=this.getBuiltins("output");d&&(h+=`,
	`+d),s.returnType="OutputStruct",s.structs+=this._getWGSLStruct("OutputStruct",h),s.structs+=`
var<private> output : OutputStruct;

`,i+=`output.color = ${u.result};

	return output;`}}}s.flow=i}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment)):this.computeShader=this._getWGSLComputeCode(t.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(t,e=null){let s;return e!==null&&(s=this._getWGSLMethod(t+"_"+e)),s===void 0&&(s=this._getWGSLMethod(t)),s||t}getType(t){return hv[t]||t}isAvailable(t){let e=c3[t];return e===void 0&&(t==="float32Filterable"?e=this.renderer.hasFeature("float32-filterable"):t==="clipDistance"&&(e=this.renderer.hasFeature("clip-distances")),c3[t]=e),e}_getWGSLMethod(t){return ys[t]!==void 0&&this._include(t),Vr[t]}_include(t){const e=ys[t];return e.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}
// directives
${t.directives}

// uniforms
${t.uniforms}

// varyings
${t.varyings}
var<private> varyings : VaryingsStruct;

// codes
${t.codes}

@vertex
fn main( ${t.attributes} ) -> VaryingsStruct {

	// vars
	${t.vars}

	// flow
	${t.flow}

	return varyings;

}
`}_getWGSLFragmentCode(t){return`${this.getSignature()}
// global
${p9}

// uniforms
${t.uniforms}

// structs
${t.structs}

// codes
${t.codes}

@fragment
fn main( ${t.varyings} ) -> ${t.returnType} {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLComputeCode(t,e){return`${this.getSignature()}
// directives
${t.directives}

// system
var<private> instanceIndex : u32;

// locals
${t.scopedArrays}

// uniforms
${t.uniforms}

// codes
${t.codes}

@compute @workgroup_size( ${e} )
fn main( ${t.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${e}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${e});

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLStruct(t,e){return`
struct ${t} {
${e}
};`}_getWGSLStructBinding(t,e,s,i=0,n=0){const o=t+"Struct";return`${this._getWGSLStruct(o,e)}
@binding( ${i} ) @group( ${n} )
var<${s}> ${t} : ${o};`}}class gv{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return t.depthTexture!==null?e=this.getTextureFormatGPU(t.depthTexture):t.depth&&t.stencil?e=R.Depth24PlusStencil8:t.depth&&(e=R.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getCurrentColorFormat(t){let e;return t.textures!==null?e=this.getTextureFormatGPU(t.textures[0]):e=this.getPreferredCanvasFormat(),e}getCurrentColorSpace(t){return t.textures!==null?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){if(t.isPoints)return jo.PointList;if(t.isLineSegments||t.isMesh&&e.wireframe===!0)return jo.LineList;if(t.isLine)return jo.LineStrip;if(t.isMesh)return jo.TriangleList}getSampleCount(t){let e=1;return t>1&&(e=Math.pow(2,Math.floor(Math.log2(t))),e===2&&(e=4)),e}getSampleCountRenderContext(t){return t.textures!==null?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?R.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const fv=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),mv=new Map([[g5,["float16"]]]),yv=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class xv{constructor(t){this.backend=t}createAttribute(t,e){const s=this._getBufferAttribute(t),i=this.backend,n=i.get(s);let o=n.buffer;if(o===void 0){const a=i.device;let c=s.array;if(t.normalized===!1&&(c.constructor===Int16Array||c.constructor===Uint16Array)){const u=new Uint32Array(c.length);for(let p=0;p<c.length;p++)u[p]=c[p];c=u}if(s.array=c,(s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute)&&s.itemSize===3){c=new c.constructor(s.count*4);for(let u=0;u<s.count;u++)c.set(s.array.subarray(u*3,u*3+3),u*4);s.itemSize=4,s.array=c}const l=c.byteLength+(4-c.byteLength%4)%4;o=a.createBuffer({label:s.name,size:l,usage:e,mappedAtCreation:!0}),new c.constructor(o.getMappedRange()).set(c),o.unmap(),n.buffer=o}}updateAttribute(t){const e=this._getBufferAttribute(t),s=this.backend,i=s.device,n=s.get(e).buffer,o=e.array,a=this._isTypedArray(o),c=e.updateRanges;if(c.length===0)i.queue.writeBuffer(n,0,o,0);else{const l=a?1:o.BYTES_PER_ELEMENT;for(let u=0,p=c.length;u<p;u++){const h=c[u],d=h.start*l,g=h.count*l;i.queue.writeBuffer(n,0,o,d,g)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),s=new Map;for(let i=0;i<e.length;i++){const n=e[i],o=n.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(n);let c=s.get(a);if(c===void 0){let p,h;n.isInterleavedBufferAttribute===!0?(p=n.data.stride*o,h=n.data.isInstancedInterleavedBuffer?R0.Instance:R0.Vertex):(p=n.itemSize*o,h=n.isInstancedBufferAttribute?R0.Instance:R0.Vertex),n.normalized===!1&&(n.array.constructor===Int16Array||n.array.constructor===Uint16Array)&&(p=4),c={arrayStride:p,attributes:[],stepMode:h},s.set(a,c)}const l=this._getVertexFormat(n),u=n.isInterleavedBufferAttribute===!0?n.offset*o:0;c.attributes.push({shaderLocation:i,offset:u,format:l})}return Array.from(s.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,s=e.device,n=e.get(this._getBufferAttribute(t)).buffer,o=n.size,a=s.createBuffer({label:t.name,size:o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=s.createCommandEncoder({});c.copyBufferToBuffer(n,0,a,0,o),a.unmap();const l=c.finish();return s.queue.submit([l]),await a.mapAsync(GPUMapMode.READ),a.getMappedRange()}_getVertexFormat(t){const{itemSize:e,normalized:s}=t,i=t.array.constructor,n=t.constructor;let o;if(e==1)o=yv.get(i);else{const c=(mv.get(n)||fv.get(i))[s?1:0];if(c){const l=i.BYTES_PER_ELEMENT*e,p=Math.floor((l+3)/4)*4/i.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");o=`${c}x${p}`}}return o||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),o}_isTypedArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class bv{constructor(t){this.backend=t,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(t){const s=this.backend.device,i=[];let n=0;for(const o of t.bindings){const a={binding:n++,visibility:o.visibility};if(o.isUniformBuffer||o.isStorageBuffer){const c={};o.isStorageBuffer&&(o.visibility&4&&(o.access===Ie.READ_WRITE||o.access===Ie.WRITE_ONLY)?c.type=d1.Storage:c.type=d1.ReadOnlyStorage),a.buffer=c}else if(o.isSampler){const c={};o.texture.isDepthTexture&&o.texture.compareFunction!==null&&(c.type="comparison"),a.sampler=c}else if(o.isSampledTexture&&o.texture.isVideoTexture)a.externalTexture={};else if(o.isSampledTexture&&o.store){const c={};c.format=this.backend.get(o.texture).texture.format;const l=o.access;l===Ie.READ_WRITE?c.access=g1.ReadWrite:l===Ie.WRITE_ONLY?c.access=g1.WriteOnly:c.access=g1.ReadOnly,a.storageTexture=c}else if(o.isSampledTexture){const c={};if(o.texture.isMultisampleRenderTargetTexture===!0&&(c.multisampled=!0),o.texture.isDepthTexture)c.sampleType=Ir.Depth;else if(o.texture.isDataTexture||o.texture.isDataArrayTexture||o.texture.isData3DTexture){const l=o.texture.type;l===ke?c.sampleType=Ir.SInt:l===Ae?c.sampleType=Ir.UInt:l===qe&&(this.backend.hasFeature("float32-filterable")?c.sampleType=Ir.Float:c.sampleType=Ir.UnfilterableFloat)}o.isSampledCubeTexture?c.viewDimension=ms.Cube:o.texture.isDataArrayTexture||o.texture.isCompressedArrayTexture?c.viewDimension=ms.TwoDArray:o.isSampledTexture3D&&(c.viewDimension=ms.ThreeD),a.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${o}".`);i.push(a)}return s.createBindGroupLayout({entries:i})}createBindings(t,e,s,i=0){const{backend:n,bindGroupLayoutCache:o}=this,a=n.get(t);let c=o.get(t.bindingsReference);c===void 0&&(c=this.createBindingsLayout(t),o.set(t.bindingsReference,c));let l;s>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[s]===i&&(l=a.groups[s])),l===void 0&&(l=this.createBindGroup(t,c),s>0&&(a.groups[s]=l,a.versions[s]=i)),a.group=l,a.layout=c}updateBinding(t){const e=this.backend,s=e.device,i=t.buffer,n=e.get(t).buffer;s.queue.writeBuffer(n,0,i,0)}createBindGroup(t,e){const s=this.backend,i=s.device;let n=0;const o=[];for(const a of t.bindings){if(a.isUniformBuffer){const c=s.get(a);if(c.buffer===void 0){const l=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=i.createBuffer({label:"bindingBuffer_"+a.name,size:l,usage:u});c.buffer=p}o.push({binding:n,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=s.get(a);if(c.buffer===void 0){const l=a.attribute;c.buffer=s.get(l).buffer}o.push({binding:n,resource:{buffer:c.buffer}})}else if(a.isSampler){const c=s.get(a.texture);o.push({binding:n,resource:c.sampler})}else if(a.isSampledTexture){const c=s.get(a.texture);let l;if(c.externalTexture!==void 0)l=i.importExternalTexture({source:c.externalTexture});else{const u=a.store?1:c.texture.mipLevelCount,p=`view-${c.texture.width}-${c.texture.height}-${u}`;if(l=c[p],l===void 0){const h=jS.All;let d;a.isSampledCubeTexture?d=ms.Cube:a.isSampledTexture3D?d=ms.ThreeD:a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?d=ms.TwoDArray:d=ms.TwoD,l=c[p]=c.texture.createView({aspect:h,dimension:d,mipLevelCount:u})}}o.push({binding:n,resource:l})}n++}return i.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:o})}}class wv{constructor(t){this.backend=t}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:s,material:i,geometry:n,pipeline:o}=t,{vertexProgram:a,fragmentProgram:c}=o,l=this.backend,u=l.device,p=l.utils,h=l.get(o),d=[];for(const Y of t.getBindings()){const tt=l.get(Y);d.push(tt.layout)}const g=l.attributeUtils.createShaderVertexBuffers(t);let f;i.transparent===!0&&i.blending!==Hn&&(f=this._getBlending(i));let y={};i.stencilWrite===!0&&(y={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const x=this._getColorWriteMask(i),b=[];if(t.context.textures!==null){const Y=t.context.textures;for(let tt=0;tt<Y.length;tt++){const ot=p.getTextureFormatGPU(Y[tt]);b.push({format:ot,blend:f,writeMask:x})}}else{const Y=p.getCurrentColorFormat(t.context);b.push({format:Y,blend:f,writeMask:x})}const w=l.get(a).module,_=l.get(c).module,T=this._getPrimitiveState(s,n,i),M=this._getDepthCompare(i),A=p.getCurrentDepthStencilFormat(t.context),C=this._getSampleCount(t.context),P={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},w,{buffers:g}),fragment:Object.assign({},_,{targets:b}),primitive:T,multisample:{count:C,alphaToCoverageEnabled:i.alphaToCoverage&&C>1},layout:u.createPipelineLayout({bindGroupLayouts:d})},D={},V=t.context.depth,$=t.context.stencil;if((V===!0||$===!0)&&(V===!0&&(D.format=A,D.depthWriteEnabled=i.depthWrite,D.depthCompare=M),$===!0&&(D.stencilFront=y,D.stencilBack={},D.stencilReadMask=i.stencilFuncMask,D.stencilWriteMask=i.stencilWriteMask),P.depthStencil=D),e===null)h.pipeline=u.createRenderPipeline(P);else{const Y=new Promise(tt=>{u.createRenderPipelineAsync(P).then(ot=>{h.pipeline=ot,tt()})});e.push(Y)}}createBundleEncoder(t){const e=this.backend,{utils:s,device:i}=e,n=s.getCurrentDepthStencilFormat(t),o=s.getCurrentColorFormat(t),a=this._getSampleCount(t),c={label:"renderBundleEncoder",colorFormats:[o],depthStencilFormat:n,sampleCount:a};return i.createRenderBundleEncoder(c)}createComputePipeline(t,e){const s=this.backend,i=s.device,n=s.get(t.computeProgram).module,o=s.get(t),a=[];for(const c of e){const l=s.get(c);a.push(l.layout)}o.pipeline=i.createComputePipeline({compute:n,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(t){let e,s;const i=t.blending,n=t.blendSrc,o=t.blendDst,a=t.blendEquation;if(i===I3){const c=t.blendSrcAlpha!==null?t.blendSrcAlpha:n,l=t.blendDstAlpha!==null?t.blendDstAlpha:o,u=t.blendEquationAlpha!==null?t.blendEquationAlpha:a;e={srcFactor:this._getBlendFactor(n),dstFactor:this._getBlendFactor(o),operation:this._getBlendOperation(a)},s={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)}}else{const c=t.premultipliedAlpha,l=(u,p,h,d)=>{e={srcFactor:u,dstFactor:p,operation:Nn.Add},s={srcFactor:h,dstFactor:d,operation:Nn.Add}};if(c)switch(i){case sn:l(nt.One,nt.OneMinusSrcAlpha,nt.One,nt.OneMinusSrcAlpha);break;case pe:l(nt.One,nt.One,nt.One,nt.One);break;case tc:l(nt.Zero,nt.OneMinusSrc,nt.Zero,nt.One);break;case ec:l(nt.Zero,nt.Src,nt.Zero,nt.SrcAlpha);break}else switch(i){case sn:l(nt.SrcAlpha,nt.OneMinusSrcAlpha,nt.One,nt.OneMinusSrcAlpha);break;case pe:l(nt.SrcAlpha,nt.One,nt.SrcAlpha,nt.One);break;case tc:l(nt.Zero,nt.OneMinusSrc,nt.Zero,nt.One);break;case ec:l(nt.Zero,nt.Src,nt.Zero,nt.Src);break}}if(e!==void 0&&s!==void 0)return{color:e,alpha:s};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(t){let e;switch(t){case z3:e=nt.Zero;break;case V3:e=nt.One;break;case k3:e=nt.Src;break;case O3:e=nt.OneMinusSrc;break;case sc:e=nt.SrcAlpha;break;case ic:e=nt.OneMinusSrcAlpha;break;case $3:e=nt.Dst;break;case H3:e=nt.OneMinusDstColor;break;case G3:e=nt.DstAlpha;break;case W3:e=nt.OneMinusDstAlpha;break;case q3:e=nt.SrcAlphaSaturated;break;case zx:e=nt.Constant;break;case Vx:e=nt.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const s=t.stencilFunc;switch(s){case bd:e=Te.Never;break;case q1:e=Te.Always;break;case wd:e=Te.Less;break;case Td:e=Te.LessEqual;break;case _d:e=Te.Equal;break;case Md:e=Te.GreaterEqual;break;case Sd:e=Te.Greater;break;case vd:e=Te.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",s)}return e}_getStencilOperation(t){let e;switch(t){case Rn:e=Hi.Keep;break;case hd:e=Hi.Zero;break;case dd:e=Hi.Replace;break;case xd:e=Hi.Invert;break;case gd:e=Hi.IncrementClamp;break;case fd:e=Hi.DecrementClamp;break;case md:e=Hi.IncrementWrap;break;case yd:e=Hi.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case ji:e=Nn.Add;break;case L3:e=Nn.Subtract;break;case U3:e=Nn.ReverseSubtract;break;case X9:e=Nn.Min;break;case j9:e=Nn.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,s){const i={},n=this.backend.utils;switch(i.topology=n.getPrimitiveTopology(t,s),e.index!==null&&t.isLine===!0&&t.isLineSegments!==!0&&(i.stripIndexFormat=e.index.array instanceof Uint16Array?ur.Uint16:ur.Uint32),s.side){case $n:i.frontFace=u1.CCW,i.cullMode=p1.Back;break;case je:i.frontFace=u1.CCW,i.cullMode=p1.Front;break;case se:i.frontFace=u1.CCW,i.cullMode=p1.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",s.side);break}return i}_getColorWriteMask(t){return t.colorWrite===!0?n3.All:n3.None}_getDepthCompare(t){let e;if(t.depthTest===!1)e=Te.Always;else{const s=t.depthFunc;switch(s){case Y3:e=Te.Never;break;case X3:e=Te.Always;break;case j3:e=Te.Less;break;case nc:e=Te.LessEqual;break;case Z3:e=Te.Equal;break;case K3:e=Te.GreaterEqual;break;case J3:e=Te.Greater;break;case Q3:e=Te.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",s)}}return e}}class _v extends u9{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=t.alpha===void 0?!0:t.alpha,this.parameters.requiredLimits=t.requiredLimits===void 0?{}:t.requiredLimits,this.trackTimestamp=t.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new gv(this),this.attributeUtils=new xv(this),this.bindingUtils=new bv(this),this.pipelineUtils=new wv(this),this.textureUtils=new nv(this),this.occludedResolveCache=new Map}async init(t){await super.init(t);const e=this.parameters;let s;if(e.device===void 0){const o={powerPreference:e.powerPreference},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(o):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(xu),l=[];for(const p of c)a.features.has(p)&&l.push(p);const u={requiredFeatures:l,requiredLimits:e.requiredLimits};s=await a.requestDevice(u)}else s=e.device;s.lost.then(o=>{const a={api:"WebGPU",message:o.message||"Unknown reason",reason:o.reason||null,originalEvent:o};t.onDeviceLost(a)});const i=e.context!==void 0?e.context:t.domElement.getContext("webgpu");this.device=s,this.context=i;const n=e.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(xu.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:n}),this.updateSize()}get coordinateSystem(){return Fi}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let t=this.defaultRenderPassdescriptor;if(t===null){const s=this.renderer;t={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(t.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(s.depth,s.stencil).createView()});const i=t.colorAttachments[0];this.renderer.samples>0?i.view=this.colorBuffer.createView():i.resolveTarget=void 0,this.defaultRenderPassdescriptor=t}const e=t.colorAttachments[0];return this.renderer.samples>0?e.resolveTarget=this.context.getCurrentTexture().createView():e.view=this.context.getCurrentTexture().createView(),t}_getRenderPassDescriptor(t){const e=t.renderTarget,s=this.get(e);let i=s.descriptors;if(i===void 0||s.width!==e.width||s.height!==e.height||s.activeMipmapLevel!==e.activeMipmapLevel||s.samples!==e.samples){i={},s.descriptors=i;const a=()=>{e.removeEventListener("dispose",a),this.delete(e)};e.addEventListener("dispose",a)}const n=t.getCacheKey();let o=i[n];if(o===void 0){const a=t.textures,c=[];for(let l=0;l<a.length;l++){const u=this.get(a[l]),p=u.texture.createView({baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,dimension:ms.TwoD});let h,d;u.msaaTexture!==void 0?(h=u.msaaTexture.createView(),d=p):(h=p,d=void 0),c.push({view:h,resolveTarget:d,loadOp:re.Load,storeOp:ve.Store})}if(o={colorAttachments:c},t.depth){const u={view:this.get(t.depthTexture).texture.createView()};o.depthStencilAttachment=u}i[n]=o,s.width=e.width,s.height=e.height,s.samples=e.samples,s.activeMipmapLevel=e.activeMipmapLevel}return o}beginRender(t){const e=this.get(t),s=this.device,i=t.occlusionQueryCount;let n;i>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,n=s.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${t.id}`}),e.occlusionQuerySet=n,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(i),e.lastOcclusionObject=null);let o;t.textures===null?o=this._getDefaultRenderPassDescriptor():o=this._getRenderPassDescriptor(t),this.initTimestampQuery(t,o),o.occlusionQuerySet=n;const a=o.depthStencilAttachment;if(t.textures!==null){const u=o.colorAttachments;for(let p=0;p<u.length;p++){const h=u[p];t.clearColor?(h.clearValue=p===0?t.clearColorValue:{r:0,g:0,b:0,a:1},h.loadOp=re.Clear,h.storeOp=ve.Store):(h.loadOp=re.Load,h.storeOp=ve.Store)}}else{const u=o.colorAttachments[0];t.clearColor?(u.clearValue=t.clearColorValue,u.loadOp=re.Clear,u.storeOp=ve.Store):(u.loadOp=re.Load,u.storeOp=ve.Store)}t.depth&&(t.clearDepth?(a.depthClearValue=t.clearDepthValue,a.depthLoadOp=re.Clear,a.depthStoreOp=ve.Store):(a.depthLoadOp=re.Load,a.depthStoreOp=ve.Store)),t.stencil&&(t.clearStencil?(a.stencilClearValue=t.clearStencilValue,a.stencilLoadOp=re.Clear,a.stencilStoreOp=ve.Store):(a.stencilLoadOp=re.Load,a.stencilStoreOp=ve.Store));const c=s.createCommandEncoder({label:"renderContext_"+t.id}),l=c.beginRenderPass(o);if(e.descriptor=o,e.encoder=c,e.currentPass=l,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[],t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:p,width:h,height:d}=t.scissorValue;l.setScissorRect(u,p,h,d)}}finishRender(t){const e=this.get(t),s=t.occlusionQueryCount;if(e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),s>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery(),e.currentPass.end(),s>0){const i=s*8;let n=this.occludedResolveCache.get(i);n===void 0&&(n=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,n));const o=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,s,n,0),e.encoder.copyBufferToBuffer(n,0,o,0,i),e.occlusionQueryBuffer=o,this.resolveOccludedAsync(t)}if(this.prepareTimestampBuffer(t,e.encoder),this.device.queue.submit([e.encoder.finish()]),t.textures!==null){const i=t.textures;for(let n=0;n<i.length;n++){const o=i[n];o.generateMipmaps===!0&&this.textureUtils.generateMipmaps(o)}}}isOccluded(t,e){const s=this.get(t);return s.occluded&&s.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:s,currentOcclusionQueryObjects:i}=e;if(s&&i){const n=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await s.mapAsync(GPUMapMode.READ);const o=s.getMappedRange(),a=new BigUint64Array(o);for(let c=0;c<i.length;c++)a[c]!==BigInt(0)&&n.add(i[c]);s.destroy(),e.occluded=n}}updateViewport(t){const{currentPass:e}=this.get(t),{x:s,y:i,width:n,height:o,minDepth:a,maxDepth:c}=t.viewportValue;e.setViewport(s,i,n,o,a,c)}clear(t,e,s,i=null){const n=this.device,o=this.renderer;let a=[],c,l,u,p;if(t){const g=this.getClearColor();if(this.renderer.alpha===!0){const f=g.a;l={r:g.r*f,g:g.g*f,b:g.b*f,a:f}}else l={r:g.r,g:g.g,b:g.b,a:g.a}}if(i===null){u=o.depth,p=o.stencil;const g=this._getDefaultRenderPassDescriptor();if(t){a=g.colorAttachments;const f=a[0];f.clearValue=l,f.loadOp=re.Clear,f.storeOp=ve.Store}(u||p)&&(c=g.depthStencilAttachment)}else{if(u=i.depth,p=i.stencil,t)for(const g of i.textures){const f=this.get(g),y=f.texture.createView();let x,b;f.msaaTexture!==void 0?(x=f.msaaTexture.createView(),b=y):(x=y,b=void 0),a.push({view:x,resolveTarget:b,clearValue:l,loadOp:re.Clear,storeOp:ve.Store})}(u||p)&&(c={view:this.get(i.depthTexture).texture.createView()})}u&&(e?(c.depthLoadOp=re.Clear,c.depthClearValue=o.getClearDepth(),c.depthStoreOp=ve.Store):(c.depthLoadOp=re.Load,c.depthStoreOp=ve.Store)),p&&(s?(c.stencilLoadOp=re.Clear,c.stencilClearValue=o.getClearStencil(),c.stencilStoreOp=ve.Store):(c.stencilLoadOp=re.Load,c.stencilStoreOp=ve.Store));const h=n.createCommandEncoder({});h.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),n.queue.submit([h.finish()])}beginCompute(t){const e=this.get(t),s={};this.initTimestampQuery(t,s),e.cmdEncoderGPU=this.device.createCommandEncoder(),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(s)}compute(t,e,s,i){const{passEncoderGPU:n}=this.get(t),o=this.get(i).pipeline;n.setPipeline(o);for(let u=0,p=s.length;u<p;u++){const h=s[u],d=this.get(h);n.setBindGroup(u,d.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(e);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=c;e.dispatchCount>a?(l.x=Math.min(e.dispatchCount,a),l.y=Math.ceil(e.dispatchCount/a)):l.x=e.dispatchCount,n.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.prepareTimestampBuffer(t,e.cmdEncoderGPU),this.device.queue.submit([e.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(t,e){const{object:s,context:i,pipeline:n}=t,o=t.getBindings(),a=this.get(i),c=this.get(n).pipeline,l=a.currentSets,u=a.currentPass,p=t.getDrawParameters();if(p===null)return;l.pipeline!==c&&(u.setPipeline(c),l.pipeline=c);const h=l.bindingGroups;for(let y=0,x=o.length;y<x;y++){const b=o[y],w=this.get(b);h[b.index]!==b.id&&(u.setBindGroup(b.index,w.group),h[b.index]=b.id)}const d=t.getIndex(),g=d!==null;if(g===!0&&l.index!==d){const y=this.get(d).buffer,x=d.array instanceof Uint16Array?ur.Uint16:ur.Uint32;u.setIndexBuffer(y,x),l.index=d}const f=t.getVertexBuffers();for(let y=0,x=f.length;y<x;y++){const b=f[y];if(l.attributes[y]!==b){const w=this.get(b).buffer;u.setVertexBuffer(y,w),l.attributes[y]=b}}if(a.occlusionQuerySet!==void 0){const y=a.lastOcclusionObject;y!==s&&(y!==null&&y.occlusionTest===!0&&(u.endOcclusionQuery(),a.occlusionQueryIndex++),s.occlusionTest===!0&&(u.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=s),a.lastOcclusionObject=s)}if(s.isBatchedMesh===!0){const y=s._multiDrawStarts,x=s._multiDrawCounts,b=s._multiDrawCount,w=s._multiDrawInstances,_=g?d.array.BYTES_PER_ELEMENT:1;for(let T=0;T<b;T++){const M=w?w[T]:1,A=M>1?0:T;u.drawIndexed(x[T],M,y[T]/_,0,A)}}else if(g===!0){const{vertexCount:y,instanceCount:x,firstVertex:b}=p,w=t.getIndirect();if(w!==null){const _=this.get(w).buffer;u.drawIndexedIndirect(_,0)}else u.drawIndexed(y,x,b,0,0);e.update(s,y,x)}else{const{vertexCount:y,instanceCount:x,firstVertex:b}=p,w=t.getIndirect();if(w!==null){const _=this.get(w).buffer;u.drawIndirect(_,0)}else u.draw(y,x,b,0);e.update(s,y,x)}}needsRenderUpdate(t){const e=this.get(t),{object:s,material:i}=t,n=this.utils,o=n.getSampleCountRenderContext(t.context),a=n.getCurrentColorSpace(t.context),c=n.getCurrentColorFormat(t.context),l=n.getCurrentDepthStencilFormat(t.context),u=n.getPrimitiveTopology(s,i);let p=!1;return(e.material!==i||e.materialVersion!==i.version||e.transparent!==i.transparent||e.blending!==i.blending||e.premultipliedAlpha!==i.premultipliedAlpha||e.blendSrc!==i.blendSrc||e.blendDst!==i.blendDst||e.blendEquation!==i.blendEquation||e.blendSrcAlpha!==i.blendSrcAlpha||e.blendDstAlpha!==i.blendDstAlpha||e.blendEquationAlpha!==i.blendEquationAlpha||e.colorWrite!==i.colorWrite||e.depthWrite!==i.depthWrite||e.depthTest!==i.depthTest||e.depthFunc!==i.depthFunc||e.stencilWrite!==i.stencilWrite||e.stencilFunc!==i.stencilFunc||e.stencilFail!==i.stencilFail||e.stencilZFail!==i.stencilZFail||e.stencilZPass!==i.stencilZPass||e.stencilFuncMask!==i.stencilFuncMask||e.stencilWriteMask!==i.stencilWriteMask||e.side!==i.side||e.alphaToCoverage!==i.alphaToCoverage||e.sampleCount!==o||e.colorSpace!==a||e.colorFormat!==c||e.depthStencilFormat!==l||e.primitiveTopology!==u||e.clippingContextCacheKey!==t.clippingContextCacheKey)&&(e.material=i,e.materialVersion=i.version,e.transparent=i.transparent,e.blending=i.blending,e.premultipliedAlpha=i.premultipliedAlpha,e.blendSrc=i.blendSrc,e.blendDst=i.blendDst,e.blendEquation=i.blendEquation,e.blendSrcAlpha=i.blendSrcAlpha,e.blendDstAlpha=i.blendDstAlpha,e.blendEquationAlpha=i.blendEquationAlpha,e.colorWrite=i.colorWrite,e.depthWrite=i.depthWrite,e.depthTest=i.depthTest,e.depthFunc=i.depthFunc,e.stencilWrite=i.stencilWrite,e.stencilFunc=i.stencilFunc,e.stencilFail=i.stencilFail,e.stencilZFail=i.stencilZFail,e.stencilZPass=i.stencilZPass,e.stencilFuncMask=i.stencilFuncMask,e.stencilWriteMask=i.stencilWriteMask,e.side=i.side,e.alphaToCoverage=i.alphaToCoverage,e.sampleCount=o,e.colorSpace=a,e.colorFormat=c,e.depthStencilFormat=l,e.primitiveTopology=u,e.clippingContextCacheKey=t.clippingContextCacheKey,p=!0),p}getRenderCacheKey(t){const{object:e,material:s}=t,i=this.utils,n=t.context;return[s.transparent,s.blending,s.premultipliedAlpha,s.blendSrc,s.blendDst,s.blendEquation,s.blendSrcAlpha,s.blendDstAlpha,s.blendEquationAlpha,s.colorWrite,s.depthWrite,s.depthTest,s.depthFunc,s.stencilWrite,s.stencilFunc,s.stencilFail,s.stencilZFail,s.stencilZPass,s.stencilFuncMask,s.stencilWriteMask,s.side,i.getSampleCountRenderContext(n),i.getCurrentColorSpace(n),i.getCurrentColorFormat(n),i.getCurrentDepthStencilFormat(n),i.getPrimitiveTopology(e,s),t.getGeometryCacheKey(),t.clippingContextCacheKey].join()}createSampler(t){this.textureUtils.createSampler(t)}destroySampler(t){this.textureUtils.destroySampler(t)}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,s,i,n,o){return this.textureUtils.copyTextureToBuffer(t,e,s,i,n,o)}initTimestampQuery(t,e){if(!this.trackTimestamp)return;const s=this.get(t);if(!s.timeStampQuerySet){const i=t.isComputeNode?"compute":"render",n=this.device.createQuerySet({type:"timestamp",count:2,label:`timestamp_${i}_${t.id}`});Object.assign(e,{timestampWrites:{querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),s.timeStampQuerySet=n}}prepareTimestampBuffer(t,e){if(!this.trackTimestamp)return;const s=this.get(t),i=2*BigInt64Array.BYTES_PER_ELEMENT;s.currentTimestampQueryBuffers===void 0&&(s.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})});const{resolveBuffer:n,resultBuffer:o}=s.currentTimestampQueryBuffers;e.resolveQuerySet(s.timeStampQuerySet,0,2,n,0),o.mapState==="unmapped"&&e.copyBufferToBuffer(n,0,o,0,i)}async resolveTimestampAsync(t,e="render"){if(!this.trackTimestamp)return;const s=this.get(t);if(s.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:i}=s.currentTimestampQueryBuffers;await this.device.queue.onSubmittedWorkDone(),i.mapState==="unmapped"&&i.mapAsync(GPUMapMode.READ).then(()=>{const n=new BigUint64Array(i.getMappedRange()),o=Number(n[1]-n[0])/1e6;this.renderer.info.updateTimestamp(e,o),i.unmap()})}createNodeBuilder(t,e){return new dv(t,e)}createProgram(t){const e=this.get(t);e.module={module:this.device.createShaderModule({code:t.code,label:t.stage}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const s=this.get(t),n=s.currentPass.finish();this.get(e).bundleGPU=n,s.currentSets=s._currentSets,s.currentPass=s._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t,e,s,i){this.bindingUtils.createBindings(t,e,s,i)}updateBindings(t,e,s,i){this.bindingUtils.createBindings(t,e,s,i)}updateBinding(t){this.bindingUtils.updateBinding(t)}createIndexAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(t){return this.device.features.has(t)}copyTextureToTexture(t,e,s=null,i=null,n=0){let o=0,a=0,c=0,l=0,u=0,p=0,h=t.image.width,d=t.image.height;s!==null&&(l=s.x,u=s.y,p=s.z||0,h=s.width,d=s.height),i!==null&&(o=i.x,a=i.y,c=i.z||0);const g=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),f=this.get(t).texture,y=this.get(e).texture;g.copyTextureToTexture({texture:f,mipLevel:n,origin:{x:l,y:u,z:p}},{texture:y,mipLevel:n,origin:{x:o,y:a,z:c}},[h,d,1]),this.device.queue.submit([g.finish()])}copyFramebufferToTexture(t,e,s){const i=this.get(e);let n=null;e.renderTarget?t.isDepthTexture?n=this.get(e.depthTexture).texture:n=this.get(e.textures[0]).texture:t.isDepthTexture?n=this.textureUtils.getDepthBuffer(e.depth,e.stencil):n=this.context.getCurrentTexture();const o=this.get(t).texture;if(n.format!==o.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",n.format,o.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),a.copyTextureToTexture({texture:n,origin:[s.x,s.y,0]},{texture:o},[s.z,s.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t),i.currentPass){const{descriptor:c}=i;for(let l=0;l<c.colorAttachments.length;l++)c.colorAttachments[l].loadOp=re.Load;if(e.depth&&(c.depthStencilAttachment.depthLoadOp=re.Load),e.stencil&&(c.depthStencilAttachment.stencilLoadOp=re.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.viewport&&this.updateViewport(e),e.scissor){const{x:l,y:u,width:p,height:h}=e.scissorValue;i.currentPass.setScissorRect(l,u,p,h)}}else this.device.queue.submit([a.finish()])}}class Tv extends B5{constructor(t,e,s,i,n,o){super(t,e,s,i,n,o),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class Sv extends i9{constructor(){super(),this.addMaterial(Uy,"MeshPhongMaterial"),this.addMaterial(Qe,"MeshStandardMaterial"),this.addMaterial(fx,"MeshPhysicalMaterial"),this.addMaterial(bx,"MeshToonMaterial"),this.addMaterial(Yp,"MeshBasicMaterial"),this.addMaterial(Iy,"MeshLambertMaterial"),this.addMaterial(My,"MeshNormalMaterial"),this.addMaterial(Tx,"MeshMatcapMaterial"),this.addMaterial(xy,"LineBasicMaterial"),this.addMaterial(wy,"LineDashedMaterial"),this.addMaterial(Kp,"PointsMaterial"),this.addMaterial(Ax,"SpriteMaterial"),this.addMaterial(Rx,"ShadowMaterial"),this.addLight(v_,yn),this.addLight(hS,D5),this.addLight(dS,af),this.addLight(e9,B5),this.addLight(fS,rf),this.addLight(mS,E5),this.addLight(yS,lf),this.addLight(gS,Tv),this.addToneMapping(T7,J9),this.addToneMapping(S7,Q9),this.addToneMapping(v7,td),this.addToneMapping(M7,t5),this.addToneMapping(A7,ed),this.addToneMapping(N7,sd)}}class vv extends CS{constructor(t={}){let e;t.forceWebGL?e=i3:(e=_v,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new i3(t)));const s=new e(t);super(s,t),this.library=new Sv,this.isWebGPURenderer=!0}}m.BRDF_GGX;m.BRDF_Lambert;m.BasicShadowFilter;m.Break;m.Continue;m.DFGApprox;m.D_GGX;m.Discard;m.EPSILON;m.F_Schlick;const ol=m.Fn;m.INFINITY;m.If;m.Loop;m.NodeShaderStage;m.NodeType;m.NodeUpdateType;m.NodeAccess;m.PCFShadowFilter;m.PCFSoftShadowFilter;m.PI;m.PI2;m.Return;m.Schlick_to_F0;m.ScriptableNodeResources;m.ShaderNode;m.TBNViewMatrix;m.VSMShadowFilter;m.V_GGX_SmithCorrelated;const h9=m.abs;m.acesFilmicToneMapping;m.acos;m.add;m.addMethodChaining;m.addNodeElement;m.agxToneMapping;m.all;m.alphaT;m.and;m.anisotropy;m.anisotropyB;m.anisotropyT;m.any;m.append;m.arrayBuffer;m.asin;m.assign;m.atan;m.atan2;m.atomicAdd;m.atomicAnd;m.atomicFunc;m.atomicMax;m.atomicMin;m.atomicOr;m.atomicStore;m.atomicSub;m.atomicXor;m.attenuationColor;m.attenuationDistance;const oa=m.attribute;m.attributeArray;m.backgroundBlurriness;m.backgroundIntensity;m.backgroundRotation;m.batch;m.billboarding;m.bitAnd;m.bitNot;m.bitOr;m.bitXor;m.bitangentGeometry;m.bitangentLocal;m.bitangentView;m.bitangentWorld;m.bitcast;m.blendBurn;m.blendColor;m.blendDodge;m.blendOverlay;m.blendScreen;m.blur;m.bool;m.buffer;m.bufferAttribute;m.bumpMap;m.burn;m.bvec2;m.bvec3;m.bvec4;m.bypass;m.cache;m.call;m.cameraFar;m.cameraNear;m.cameraNormalMatrix;const Mv=m.cameraPosition;m.cameraProjectionMatrix;m.cameraProjectionMatrixInverse;m.cameraViewMatrix;m.cameraWorldMatrix;m.cbrt;m.cdl;m.ceil;m.checker;m.cineonToneMapping;m.clamp;m.clearcoat;m.clearcoatRoughness;m.code;const Tt=m.color;m.colorSpaceToWorking;m.colorToDirection;m.compute;m.cond;m.context;m.convert;m.convertColorSpace;m.convertToTexture;const er=m.cos;m.cross;m.cubeTexture;m.dFdx;m.dFdy;m.dashSize;m.defaultBuildStages;m.defaultShaderStages;m.defined;m.degrees;m.deltaTime;m.densityFog;m.depth;m.depthPass;m.difference;m.diffuseColor;m.directPointLight;m.directionToColor;m.dispersion;m.distance;m.div;m.dodge;const wc=m.dot;m.drawIndex;m.dynamicBufferAttribute;m.element;m.emissive;m.equal;m.equals;m.equirectUV;const Av=m.exp;m.exp2;m.expression;m.faceDirection;m.faceForward;const Dt=m.float;m.floor;m.fog;m.fract;m.frameGroup;m.frameId;m.frontFacing;m.fwidth;m.gain;m.gapSize;m.getConstNodeType;m.getCurrentStack;m.getDirection;m.getDistanceAttenuation;m.getGeometryRoughness;m.getNormalFromDepth;m.getParallaxCorrectNormal;m.getRoughness;m.getScreenPosition;m.getShIrradianceAt;m.getTextureIndex;m.getViewPosition;m.glsl;m.glslFn;m.grayscale;m.greaterThan;m.greaterThanEqual;m.hash;m.highPrecisionModelNormalViewMatrix;m.highPrecisionModelViewMatrix;m.hue;m.instance;m.instanceIndex;m.instancedArray;m.instancedBufferAttribute;m.instancedDynamicBufferAttribute;m.instancedMesh;m.int;m.inverseSqrt;m.invocationLocalIndex;m.invocationSubgroupIndex;m.ior;m.iridescence;m.iridescenceIOR;m.iridescenceThickness;m.ivec2;m.ivec3;m.ivec4;m.js;m.label;const Nv=m.length;m.lengthSq;m.lessThan;m.lessThanEqual;m.lightPosition;m.lightTargetDirection;m.lightTargetPosition;m.lightViewPosition;m.lightingContext;m.lights;m.linearDepth;m.linearToneMapping;m.localId;m.log;m.log2;m.logarithmicDepthToViewZ;m.loop;m.luminance;m.mat2;m.mat3;m.mat4;m.matcapUV;m.materialAOMap;m.materialAlphaTest;m.materialAnisotropy;m.materialAnisotropyVector;m.materialAttenuationColor;m.materialAttenuationDistance;m.materialClearcoat;m.materialClearcoatNormal;m.materialClearcoatRoughness;m.materialColor;m.materialDispersion;m.materialEmissive;m.materialIOR;m.materialIridescence;m.materialIridescenceIOR;m.materialIridescenceThickness;m.materialLightMap;m.materialLineDashOffset;m.materialLineDashSize;m.materialLineGapSize;m.materialLineScale;m.materialLineWidth;m.materialMetalness;m.materialNormal;m.materialOpacity;m.materialPointWidth;m.materialReference;m.materialReflectivity;m.materialRefractionRatio;m.materialRotation;m.materialRoughness;m.materialSheen;m.materialSheenRoughness;m.materialShininess;m.materialSpecular;m.materialSpecularColor;m.materialSpecularIntensity;m.materialSpecularStrength;m.materialThickness;m.materialTransmission;const m2=m.max;m.maxMipLevel;m.metalness;m.min;const xs=m.mix;m.mixElement;m.mod;m.modInt;m.modelDirection;m.modelNormalMatrix;m.modelPosition;m.modelScale;m.modelViewMatrix;m.modelViewPosition;m.modelViewProjection;m.modelWorldMatrix;m.modelWorldMatrixInverse;m.morphReference;m.mrt;m.mul;m.mx_aastep;m.mx_cell_noise_float;m.mx_contrast;m.mx_fractal_noise_float;m.mx_fractal_noise_vec2;m.mx_fractal_noise_vec3;m.mx_fractal_noise_vec4;m.mx_hsvtorgb;const en=m.mx_noise_float;m.mx_noise_vec3;m.mx_noise_vec4;m.mx_ramplr;m.mx_ramptb;m.mx_rgbtohsv;m.mx_safepower;m.mx_splitlr;m.mx_splittb;m.mx_srgb_texture_to_lin_rec709;m.mx_transform_uv;m.mx_worley_noise_float;m.mx_worley_noise_vec2;m.mx_worley_noise_vec3;m.negate;m.neutralToneMapping;m.nodeArray;m.nodeImmutable;m.nodeObject;m.nodeObjects;m.nodeProxy;m.normalFlat;m.normalGeometry;m.normalLocal;m.normalMap;const Cv=m.normalView,q0=m.normalWorld,wu=m.normalize;m.not;m.notEqual;m.numWorkgroups;m.objectDirection;m.objectGroup;m.objectPosition;m.objectScale;m.objectViewPosition;m.objectWorldMatrix;m.oneMinus;m.or;m.orthographicDepthToViewZ;m.oscSawtooth;m.oscSine;m.oscSquare;m.oscTriangle;m.output;m.outputStruct;m.overlay;m.overloadingFn;m.parabola;m.parallaxDirection;m.parallaxUV;m.parameter;m.pass;m.passTexture;m.pcurve;m.perspectiveDepthToViewZ;m.pmremTexture;m.pointUV;m.pointWidth;m.positionGeometry;const Zs=m.positionLocal;m.positionPrevious;m.positionView;m.positionViewDirection;const d9=m.positionWorld;m.positionWorldDirection;m.posterize;m.pow;m.pow2;m.pow3;m.pow4;m.property;m.radians;m.rand;m.range;m.rangeFog;m.reciprocal;m.reference;m.referenceBuffer;m.reflect;m.reflectVector;m.reflectView;m.reflector;m.refract;m.refractVector;m.refractView;m.reinhardToneMapping;m.remainder;m.remap;m.remapClamp;m.renderGroup;m.renderOutput;m.rendererReference;m.rotate;m.rotateUV;m.roughness;m.round;m.rtt;m.sRGBTransferEOTF;m.sRGBTransferOETF;m.sampler;m.saturate;m.saturation;m.screen;m.screenCoordinate;m.screenSize;m.screenUV;m.scriptable;m.scriptableValue;m.select;m.setCurrentStack;m.shaderStages;m.shadow;m.sharedUniformGroup;m.sheen;m.sheenRoughness;m.shiftLeft;m.shiftRight;m.shininess;m.sign;const me=m.sin;m.sinc;m.skinning;m.skinningReference;const Me=m.smoothstep;m.smoothstepElement;m.specularColor;m.specularF90;m.spherizeUV;m.split;m.spritesheetUV;m.sqrt;m.stack;m.step;m.storage;m.storageBarrier;m.storageObject;m.storageTexture;m.string;m.sub;m.subgroupIndex;m.subgroupSize;m.tan;m.tangentGeometry;m.tangentLocal;m.tangentView;m.tangentWorld;m.temp;m.texture;m.texture3D;m.textureBarrier;m.textureBicubic;m.textureCubeUV;m.textureLoad;m.textureSize;m.textureStore;m.thickness;m.threshold;const We=m.time;m.timerDelta;m.timerGlobal;m.timerLocal;m.toOutputColorSpace;m.toWorkingColorSpace;m.toneMapping;m.toneMappingExposure;m.toonOutlinePass;m.transformDirection;m.transformNormal;m.transformNormalToView;m.transformedBentNormalView;m.transformedBitangentView;m.transformedBitangentWorld;m.transformedClearcoatNormalView;m.transformedNormalView;m.transformedNormalWorld;m.transformedTangentView;m.transformedTangentWorld;m.transmission;m.transpose;m.tri;m.tri3;m.triNoise3D;m.triplanarTexture;m.triplanarTextures;m.trunc;m.tslFn;m.uint;const ye=m.uniform;m.uniformArray;m.uniformGroup;m.uniforms;m.userData;const sr=m.uv;m.uvec2;m.uvec3;m.uvec4;m.varying;m.varyingProperty;const Rv=m.vec2,ue=m.vec3,g9=m.vec4;m.vectorComponents;m.velocity;m.vertexColor;m.vertexIndex;m.vibrance;m.viewZToLogarithmicDepth;m.viewZToOrthographicDepth;m.viewZToPerspectiveDepth;m.viewport;m.viewportBottomLeft;m.viewportCoordinate;m.viewportDepthTexture;m.viewportLinearDepth;m.viewportMipTexture;m.viewportResolution;m.viewportSafeUV;m.viewportSharedTexture;m.viewportSize;m.viewportTexture;m.viewportTopLeft;m.viewportUV;m.wgsl;m.wgslFn;m.workgroupArray;m.workgroupBarrier;m.workgroupId;m.workingToColorSpace;m.xor;const xt={unitSphere:new Et(1,16,16),unitCylinder:new Le(1,1,1,12).translate(0,.5,0),unitCone:new mn(1,1,16).translate(0,.5,0),quad:new on(1,1),sphere:new Et(1,16,16),sphereLow:new Et(1,8,8),cylinder:new Le(1,1,1,12).translate(0,.5,0),cylinderLow:new Le(1,1,1,8).translate(0,.5,0),capsule:new Dc(.5,1,6,8),eye:new Et(.12,16,16),pupil:new Et(.05,12,12)},u3=xt.eye;let Fv=0;const Y0=[],f1=new W,_u=ye(0),Tu=ye(ue(1,0,0)),p3=ye(0);function Ev(r){if(r.length===0)return 0;const t=[...r].sort((s,i)=>s-i),e=Math.floor(t.length/2);return t.length%2!==0?t[e]:(t[e-1]+t[e])/2}function Bv(r=256){const t=new Uint8Array(r*r*4);for(let s=0;s<r*r*4;s++)t[s]=Math.random()*255;const e=new Yu(t,r,r,an);return e.needsUpdate=!0,e.wrapS=rn,e.wrapT=rn,e}const Dv=ol(([r,t])=>{const e=r.mul(t),s=h9(q0),i=en(ue(e.y,e.z,0)),n=en(ue(e.x,e.z,0)),o=en(ue(e.x,e.y,0)),a=s.div(s.x.add(s.y).add(s.z));return i.mul(a.x).add(n.mul(a.y)).add(o.mul(a.z))}),Pv=ol(([r,t,e,s])=>{const i=Dt(.01),n=e,o=en(r.mul(n)),a=en(r.add(ue(i,0,0)).mul(n)),c=en(r.add(ue(0,i,0)).mul(n)),l=en(r.add(ue(0,0,i)).mul(n)),u=a.sub(o).div(i),p=c.sub(o).div(i),h=l.sub(o).div(i),d=ue(u,p,h);return wu(t.sub(d.mul(s)))});ol(([r,t,e])=>{const s=Dt(3),i=Dt(.5),n=m2(0,wc(t,e)),o=Dt(1).sub(n).pow(s).mul(i);return r.add(o)});function Hs(r,t={}){const{roughness:e=.5,metalness:s=0,bumpStrength:i=0,noiseScale:n=5,triplanar:o=!1,side:a=$n,transmission:c=0,thickness:l=0,ior:u=1.5,thicknessDistortion:p=0,subsurfaceStrength:h=0,subsurfaceColor:d=16777215,iridescenceStrength:g=0,iridescenceFresnelPower:f=4,sheen:y=0,sheenColor:x=16777215,sheenRoughness:b=1,animateMoisture:w=!1,animatePulse:_=!1}=t,T=new Qe;T.colorNode=Tt(r),T.roughnessNode=Dt(e),T.metalnessNode=Dt(s),T.side=a;let M=Dt(0);if(i>0||p>0||w){let A=Zs;if(w){const C=ue(0,p3.mul(.2),0);A=A.add(C)}o?M=Dv(A,Dt(n)):M=en(A.mul(Dt(n)))}if(i>0){T.normalNode=Pv(Zs,q0,Dt(n),Dt(i));const A=Me(.3,.7,M);T.colorNode=T.colorNode.mul(A.mul(.5).add(.5))}if(w){const A=M.mul(.3);T.roughnessNode=T.roughnessNode.sub(A)}if(c>0){T.transmissionNode=Dt(c),T.iorNode=Dt(u),T.transparent=!0;let A=Dt(l);p>0&&(A=A.mul(M.mul(p).add(1))),T.thicknessNode=A;const C=Av(A.negate().mul(.5));T.colorNode=T.colorNode.mul(C.add(.2))}if(h>0){const A=wu(ue(.5,1,.5)),C=wc(q0,A),P=Dt(1).sub(m2(0,C)).pow(2),D=Tt(d),V=P.mul(h).mul(D);T.colorNode=T.colorNode.add(V)}if(g>0){const A=wu(Mv.sub(d9)),C=h9(wc(q0,A)),P=Dt(1).sub(C).pow(Dt(f)),D=me(P.mul(10)),V=me(P.mul(10).add(2)),$=me(P.mul(10).add(4)),Y=ue(D,V,$).mul(.5).add(.5);T.emissiveNode=Y.mul(g).mul(P)}if(_){const A=me(p3.mul(3)).mul(.2).add(.8);T.emissiveNode=(T.emissiveNode||Tt(0)).add(T.colorNode.mul(A.mul(.2)))}return y>0&&(T.sheen=y,T.sheenColorNode=Tt(x),T.sheenRoughnessNode=Dt(b)),T.userData.isUnified=!0,T}const Ht={Clay:(r,t={})=>Hs(r,{roughness:.8,bumpStrength:.15,noiseScale:8,triplanar:!0,...t}),Sugar:(r,t={})=>Hs(r,{roughness:.6,bumpStrength:.8,noiseScale:60,sheen:1,sheenColor:16777215,sheenRoughness:.5,...t}),Gummy:(r,t={})=>Hs(r,{transmission:.9,thickness:1.5,roughness:.2,ior:1.4,subsurfaceStrength:.6,subsurfaceColor:r,thicknessDistortion:.3,...t}),SeaJelly:(r,t={})=>Hs(r,{transmission:.95,thickness:.8,ior:1.33,roughness:.05,subsurfaceStrength:.4,subsurfaceColor:13434879,animateMoisture:!0,thicknessDistortion:.5,...t}),Crystal:(r,t={})=>Hs(r,{transmission:1,thickness:4,roughness:0,ior:2,iridescenceStrength:.7,iridescenceFresnelPower:2.5,...t}),Velvet:(r,t={})=>Hs(r,{roughness:1,sheen:1,sheenColor:r,sheenRoughness:1,bumpStrength:.05,...t}),OilSlick:(r=2236962,t={})=>Hs(r,{roughness:.3,metalness:.8,iridescenceStrength:1,iridescenceFresnelPower:1.5,...t})};function Rt(r){return Ht.Clay(r)}function Ga(r){return Ht.Gummy(r)}function fr(r={}){const t=new Qe;return r.color!==void 0&&(t.colorNode=Tt(r.color)),r.roughness!==void 0&&(t.roughnessNode=Dt(r.roughness)),r.metalness!==void 0&&(t.metalnessNode=Dt(r.metalness)),r.emissive!==void 0&&(t.emissiveNode=Tt(r.emissive)),r.emissiveIntensity!==void 0&&r.emissive!==void 0&&(t.emissiveNode=Tt(r.emissive).mul(Dt(r.emissiveIntensity))),r.transparent&&(t.transparent=!0),r.opacity!==void 0&&(t.opacity=r.opacity),r.side!==void 0&&(t.side=r.side),r.blending!==void 0&&(t.blending=r.blending),r.depthWrite!==void 0&&(t.depthWrite=r.depthWrite),t}function X0(r={}){const t=fr(r);return t.transparent=!0,t.depthWrite=r.depthWrite!==void 0?r.depthWrite:!1,t}const Ct={stem:Ht.Clay(6728277),flowerCenter:Ht.Velvet(4465169),vine:Ht.Clay(5605427),wood:Hs(9127187,{roughness:.9,bumpStrength:.3,noiseScale:3}),leaf:Hs(2263842,{roughness:.6,side:se,bumpStrength:.1}),flowerStem:Ht.Clay(6728277),lotusRing:Ht.Gummy(16777215),opticCable:Hs(1118481,{roughness:.4}),opticTip:fr({color:16777215,emissive:16711935,emissiveIntensity:1,roughness:.2}),lightBeam:new Qe({color:16777215,transparent:!0,opacity:.2,blending:pe,depthWrite:!1,roughness:1}),mushroomStem:Ht.Clay(16119260),mushroomCap:[Ht.Clay(16739179),Ht.Gummy(16752451),Ht.Sugar(16632686),Ht.Crystal(5546239),Ht.OilSlick()],mushroomCheek:Ht.Velvet(16755404),mushroomGills:Ht.Clay(3351057,{side:se}),mushroomSpots:Ht.Sugar(16777215),flowerPetal:[Ht.Velvet(16738740,{side:se}),Ht.Gummy(16766720,{side:se}),Ht.Crystal(16777215,{side:se}),Ht.Sugar(10040319,{side:se})],eye:Ht.Gummy(16777215),pupil:new Qe({color:0,roughness:0}),mouth:Ht.Clay(2962486),clayMouth:Ht.Clay(2962486)};function jt(r){Y0.push(r)}function mr(r){return r[Math.floor(Math.random()*r.length)]}function Wt(r,t={}){r.userData.reactivityType=t.type||r.userData.reactivityType||"flora",typeof r.userData.reactivityId>"u"&&(r.userData.reactivityId=Fv++);const e=t.lightPreference||{};return r.userData.minLight=typeof e.min<"u"?e.min:r.userData.minLight??0,r.userData.maxLight=typeof e.max<"u"?e.max:r.userData.maxLight??1,r}function Iv(){const r=["lightBeam","mushroomCap","opticTip","lotusRing","flowerStem"];let t=!0;return r.forEach(e=>{Ct[e]||(console.error(`[Foliage] Missing material: ${e}. Using fallback.`),Ct[e]=new Qe({color:16711935}),t=!1)}),t}function Lv(r){const t=[];function e(i){if(!i)return 0;if(i.index)return i.index.count;let n=0;for(const o in i.attributes)if(Object.prototype.hasOwnProperty.call(i.attributes,o)){const a=i.attributes[o];a&&a.count>n&&(n=a.count)}return n}function s(i){const n=[];let o=i;for(;o;){const a=o.name||o.type||o.uuid;n.unshift(a),o=o.parent}return n.join("/")||i.uuid}if(r.traverse(i=>{if(i.isMesh||i.isPoints){const n=i.geometry;if(n){if(!n.attributes.position){const o=Object.keys(n.attributes||{}).join(", ")||"(none)",a=e(n);if(a>0){const c=new Float32Array(a*3);n.setAttribute("position",new lt(c,3))}else try{const c=new v;i.getWorldPosition(c);const l=new Float32Array(3);l[0]=c.x,l[1]=c.y,l[2]=c.z,n.setAttribute("position",new lt(l,3));const u=new Float32Array(3);u[0]=0,u[1]=1,u[2]=0,n.setAttribute("normal",new lt(u,3)),i.userData._patchedByValidate=!0;const p=i.name||"Unnamed",h=i.userData?.type||"Unknown Type",d=Object.keys(n.attributes||{}).join(", ")||"(none)",g=n.type||n.constructor?.name||"UnknownGeo";let f=i.parent,y=null,x=null,b=0;for(;f&&b<10;){if(f.userData&&f.userData.type){y=f.userData.type,x=f.name||f.userData.type;break}f=f.parent,b++}t.push({name:p,type:h,obj:i,geoType:g,attrKeys:d,path:s(i),patched:!0,ancestorType:y,ancestorName:x,preAttrKeys:o})}catch{const l=i.name||"Unnamed",u=i.userData?.type||"Unknown Type",p=Object.keys(n.attributes||{}).join(", ")||"(none)",h=n.type||n.constructor?.name||"UnknownGeo";t.push({name:l,type:u,obj:i,geoType:h,attrKeys:p,path:s(i),preAttrKeys:o})}}if(!n.attributes.normal){const o=n.attributes.position?n.attributes.position.count:e(n);if(o>0){const a=new Float32Array(o*3);for(let c=0;c<o*3;c+=3)a[c]=0,a[c+1]=1,a[c+2]=0;n.setAttribute("normal",new lt(a,3))}}}}}),t.length>0){const i=`[TSL] ${t.length} geometries missing 'position' attribute.`,n=t.slice(0,10).map(l=>`${l.path} -> ${l.name}(${l.type}) [${l.geoType}] attrs: ${l.attrKeys}${l.patched?" (patched)":""}${l.ancestorType?` ancestor:${l.ancestorType}`:""}`),o=t.filter(l=>l.patched).length,a=t.length>10?` + ${t.length-10} more`:"";let c=`${i} Examples: ${n.join("; ")}${a}.`;o>0&&(c+=` Note: ${o} were auto-patched with minimal position/normal data; consider fixing the source constructor.`),console.warn(c)}}new W(3346688);new W;new W;function h3(r,t){r.userData&&(r.userData.weatherGlow=Math.min(2,(r.userData.weatherGlow||0)+t))}function d3(r,t,e){if(!r.userData.berries)return;r.userData.originalBerryScales||(r.userData.originalBerryScales=r.userData.berries.map(i=>i.scale.x));let s=1;switch(t){case"sunset":s=1+e*.3;break;case"dusk":s=1.3-e*.1;break;case"deepNight":s=1.2-e*.4;break;case"preDawn":s=.8+e*.2;break;default:s=1}r.userData.berries.forEach((i,n)=>{const a=r.userData.originalBerryScales[n]*s;i.scale.setScalar(a)})}let Sa=[];const Uv=50;let kr=null;function zv(r){kr=new K,kr.name="fallingBerries";const t=new Et(.06,8,8);for(let e=0;e<Uv;e++){const s=new Is({color:16737792,emissive:16737792,emissiveIntensity:.5}),i=new O(t,s);i.visible=!1,i.userData.velocity=new v,i.userData.active=!1,i.userData.age=0,kr.add(i),Sa.push(i)}r.add(kr)}function Vv(r,t=16737792){const e=Sa.find(s=>!s.userData.active);e&&(e.position.copy(r),e.material.color.setHex(t),e.material.emissive.setHex(t),e.userData.velocity.set((Math.random()-.5)*2,-2-Math.random()*3,(Math.random()-.5)*2),e.userData.active=!0,e.userData.age=0,e.visible=!0)}function kv(r){if(!kr)return;const t=-9.8,e=3;Sa.forEach(s=>{s.userData.active&&(s.userData.age+=r,s.userData.velocity.y+=t*r,s.position.x+=s.userData.velocity.x*r,s.position.y+=s.userData.velocity.y*r,s.position.z+=s.userData.velocity.z*r,s.material.opacity=1-s.userData.age/e,(s.position.y<0||s.userData.age>e)&&(s.userData.active=!1,s.visible=!1))})}function g3(r,t){r.userData.berries&&r.userData.berries.forEach(e=>{if(Math.random()<t*.02){const s=new v;e.getWorldPosition(s),Vv(s,r.userData.berryColor||16737792)}})}function Ov(r,t=1){if(!Sa)return 0;let e=0;const s=t*t;return Sa.forEach(i=>{if(!i.userData.active)return;i.position.distanceToSquared(r)<s&&(i.userData.active=!1,i.visible=!1,e++)}),e}let j0=[];const Lr=new Yt,m1=1e3;function Gv(r,t=5e3){j0=[];const e=.8,s=new to(.05,e,.05);s.translate(0,e/2,0),s.computeVertexNormals();const i=new Qe({color:8190976,roughness:.8,metalness:0}),n=We.mul(_u.max(.5)),o=Zs.x.add(Zs.z).add(n),a=Zs.y.mul(.3).mul(me(o)),c=a.mul(Tu.x),l=a.mul(Tu.z);i.positionNode=Zs.add(ue(c,0,l));const u=ue(0,0,1),p=m2(0,wc(Cv,u)),h=Dt(1).sub(p).pow(3).mul(.6),d=Tt(8190976),g=Tt(11206570);i.colorNode=d.add(g.mul(h));const f=Math.ceil(t/m1);for(let y=0;y<f;y++){const x=Math.min(m1,t-y*m1),b=new mg(s,i,x);b.instanceMatrix.setUsage(In),b.count=0,b.receiveShadow=!0,r.add(b),j0.push(b)}return j0}function Wv(r,t,e){const s=j0.find(o=>o.count<o.instanceMatrix.count);if(!s)return;const i=s.count;Lr.position.set(r,t,e),Lr.rotation.y=Math.random()*Math.PI;const n=.8+Math.random()*.4;Lr.scale.set(n,n,n),Lr.updateMatrix(),s.setMatrixAt(i,Lr.matrix),s.count++,s.instanceMatrix.needsUpdate=!0}function Wn(r={}){const{size:t="regular",scale:e=1,colorIndex:s=-1,hasFace:i=!1,isBouncy:n=!1}=r,o=new K,a=t==="giant",c=a||i,l=a?8*e:1*e,u=(1+Math.random()*.5)*l,p=(.15+Math.random()*.1)*l,h=p*(2.5+Math.random())*(a?1:1.2),d=[];for(let V=0;V<=10;V++){const $=V/10,Y=p*(1-Math.pow($-.3,2)*.5),tt=$*u;d.push(new q(Y,tt))}const g=new Bc(d,16),f=new O(g,Ct.mushroomStem);f.castShadow=!0,f.receiveShadow=!0,o.add(f);const y=new Et(h,24,24,0,Math.PI*2,0,Math.PI/1.8);let x,b;s>=0&&s<Ct.mushroomCap.length?(b=s,x=Ct.mushroomCap[b]):(b=Math.floor(Math.random()*Ct.mushroomCap.length),x=Ct.mushroomCap[b]);const w=x.clone();w.userData.baseEmissive=new W(0);const _=new O(y,w);_.position.y=u-h*.2,_.castShadow=!0,_.receiveShadow=!0,o.add(_);const T=new mn(h*.9,h*.4,24,1,!0),M=Ct.mushroomGills,A=new O(T,M);A.position.y=u-h*.2,A.rotation.x=Math.PI,o.add(A);const C=3+Math.floor(Math.random()*5),P=new Et(h*.15,6,6),D=Ct.mushroomSpots;for(let V=0;V<C;V++){const $=Math.random(),Y=Math.random()*.5,tt=2*Math.PI*$,ot=Math.acos(1-Y),Nt=Math.sin(ot)*Math.cos(tt)*h,de=Math.cos(ot)*h,ut=Math.sin(ot)*Math.sin(tt)*h,gt=new O(P,D);gt.position.set(Nt,de+u-h*.2,ut),gt.scale.set(1,.2,1),gt.lookAt(0,u+h,0),o.add(gt)}if(c){const V=new K;V.position.set(0,u*.6,p*.85);const $=a?l:l*.6;V.scale.set($,$,$);const Y=new O(u3,Ct.eye);Y.position.set(-.15,.1,.1);const tt=new O(u3,Ct.eye);tt.position.set(.15,.1,.1);const ot=new Et(.06,8,8),Nt=new O(ot,Ct.pupil);Nt.position.set(0,0,.1),Y.add(Nt);const de=new O(ot,Ct.pupil);de.position.set(0,0,.1),tt.add(de);const ut=new Pi(.12,.04,6,12,Math.PI),gt=new O(ut,Ct.clayMouth);gt.rotation.z=Math.PI,gt.position.set(0,-.05,.1);const Bt=new Et(.08,8,8),Ot=new O(Bt,Ct.mushroomCheek);Ot.position.set(-.25,0,.05),Ot.scale.set(1,.6,.5);const Lt=new O(Bt,Ct.mushroomCheek);Lt.position.set(.25,0,.05),Lt.scale.set(1,.6,.5),V.add(Y,tt,gt,Ot,Lt),o.add(V)}if(a){const V=new Qe({color:w.color,roughness:.8,metalness:0}),$=Zs,Y=We.mul(2),tt=me(Y).mul(.1).add(1);V.positionNode=$.mul(tt);const ut=me($.y.mul(10).sub(We.mul(2))).add(1).mul(.5).pow(2),gt=me(Y.mul(2)).mul(.1).add(.2),Bt=ut.mul(.3).add(gt);V.emissiveNode=Tt(w.color).mul(Bt),_.material=V,w.colorNode=V.colorNode}if(o.userData.animationType=mr(["wobble","bounce","accordion"]),o.userData.animationOffset=Math.random()*10,o.userData.type="mushroom",o.userData.colorIndex=typeof b=="number"?b:-1,r.isBioluminescent){const V=w&&w.color?w.color:new W(65416),$=new yn(V,.5,4);$.position.set(0,u*.5,0),o.add($),A&&A.material&&(A.material=A.material.clone(),A.material.emissive=V,A.material.emissiveIntensity=.5),o.userData.isBioluminescent=!0}return o.userData.size=t,o.userData.capRadius=h,o.userData.capHeight=u,o.userData.stemRadius=p,o.userData.reactiveMeshes=[_],(a||n)&&(o.userData.isTrampoline=!0),Wt(o,{type:"flora"}),o.reactToNote=(V,$,Y)=>{_.userData.flashColor=new W($),_.userData.flashIntensity=1+Y*2,_.userData.flashDecay=.1;const tt=1-Y*.3,ot=1+Y*.3;o.scale.set(l*ot,l*tt,l*ot),setTimeout(()=>{o&&o.scale.setScalar(l)},80)},o}function rl(r={}){const{color:t=null,shape:e="simple"}=r,s=new K,i=.6+Math.random()*.4,n=new O(xt.unitCylinder,Ct.flowerStem);n.scale.set(.05,i,.05),n.castShadow=!0,s.add(n);const o=new K;o.position.y=i,s.add(o);const a=new O(xt.unitSphere,Ct.flowerCenter);a.scale.setScalar(.1),a.name="flowerCenter",o.add(a);const c=3,l=Rt(16776960);for(let p=0;p<c;p++){const h=new O(xt.unitCylinder,l);h.position.y=.075,h.scale.set(.01,.15,.01),h.rotation.z=(Math.random()-.5)*1,h.rotation.x=(Math.random()-.5)*1,o.add(h)}let u;if(t?(u=Rt(t),jt(u)):u=Ct.flowerPetal[Math.floor(Math.random()*Ct.flowerPetal.length)],e==="simple"){const p=5+Math.floor(Math.random()*2),h=new da(.15,0);h.scale(1,.5,1);for(let d=0;d<p;d++){const g=d/p*Math.PI*2,f=new O(h,u);f.position.set(Math.cos(g)*.18,0,Math.sin(g)*.18),f.rotation.z=Math.PI/4,o.add(f)}}else if(e==="multi"){const p=8+Math.floor(Math.random()*4);for(let h=0;h<p;h++){const d=h/p*Math.PI*2,g=new O(xt.unitSphere,u);g.scale.setScalar(.12),g.position.set(Math.cos(d)*.2,Math.sin(h*.5)*.1,Math.sin(d)*.2),o.add(g)}}else if(e==="spiral")for(let h=0;h<10;h++){const d=h/10*Math.PI*4,g=.05+h/10*.15,f=new O(xt.unitCone,u);f.scale.set(.1,.2,.1),f.position.set(Math.cos(d)*g,h/10*.1,Math.sin(d)*g),f.rotation.z=d,o.add(f)}else if(e==="layered")for(let p=0;p<2;p++){const d=new da(.12,0);d.scale(1,.5,1);const g=p===0?u:Rt(t?t+1118481:16766720);p!==0&&jt(g);for(let f=0;f<5;f++){const y=f/5*Math.PI*2+p*Math.PI/5,x=new O(d,g);x.position.set(Math.cos(y)*(.15+p*.05),p*.05,Math.sin(y)*(.15+p*.05)),x.rotation.z=Math.PI/4,o.add(x)}}if(Math.random()>.5){const p=new O(xt.unitCone,Ct.lightBeam.clone());p.scale.set(.1,1,.1),p.position.y=i,p.userData.isBeam=!0,s.add(p)}return s.userData.animationOffset=Math.random()*10,s.userData.animationType=mr(["sway","wobble","accordion"]),s.userData.type="flower",s.userData.isFlower=!0,e==="sunflower"||e==="multi"?Wt(s,{}):Wt(s,{})}function f9(r={}){const{color:t=16766720,intensity:e=1.5}=r,s=new K,i=.6+Math.random()*.4,n=new O(xt.unitCylinder,Ct.flowerStem);n.scale.set(.05,i,.05),n.castShadow=!0,s.add(n);const o=fr({color:t,emissive:t,emissiveIntensity:e,roughness:.8});jt(o);const a=new O(xt.unitSphere,o);a.scale.setScalar(.2),a.position.y=i,s.add(a);const c=new O(xt.unitSphere,Ct.lightBeam);c.scale.setScalar(1.5),c.position.y=i,c.userData.isWash=!0,s.add(c);const l=new yn(t,.5,3);return l.position.y=i,s.add(l),s.userData.animationType="glowPulse",s.userData.animationOffset=Math.random()*10,s.userData.type="flower",Wt(s,{})}function $v(r={}){const{color:t=16740039}=r,e=new K,s=.7+Math.random()*.4,i=new O(xt.unitCylinder,Rt(2263842));i.scale.set(.04,s,.04),i.castShadow=!0,e.add(i);const n=new O(xt.unitSphere,Ct.flowerCenter);n.scale.setScalar(.09),n.position.y=s,e.add(n);const o=Rt(t);jt(o);const a=6+Math.floor(Math.random()*3);for(let u=0;u<a;u++){const p=new O(xt.unitCone,o);p.scale.set(.09,.2,.09);const h=u/a*Math.PI*2;p.position.set(Math.cos(h)*.16,s,Math.sin(h)*.16),p.rotation.x=Math.PI*.5,p.rotation.z=h,e.add(p)}const c=Ct.lightBeam.clone();c.colorNode=Tt(t);const l=new O(xt.unitCone,c);return l.position.y=s,l.scale.set(.02,4,.02),l.userData.isBeam=!0,e.add(l),e.userData.animationType="spin",e.userData.animationOffset=Math.random()*10,e.userData.type="starflower",Wt(e,{})}function Hv(r={}){const t=new K,e=Rt(6111287),s=1+Math.random()*.5,i=new O(xt.unitCylinder,e);i.scale.set(.15,s,.15),i.castShadow=!0,t.add(i);const n=3+Math.floor(Math.random()*3),o=[16711765,16755200,52479,16711935,65416];for(let a=0;a<n;a++){const c=new K;c.position.y=s*.8,c.rotation.y=a/n*Math.PI*2,c.rotation.z=Math.PI/4;const l=.8+Math.random()*.5,u=new O(xt.unitCylinder,e);u.scale.set(.08,l,.08),c.add(u);const p=new K;p.position.y=l;const h=o[Math.floor(Math.random()*o.length)],d=fr({color:h,roughness:.7,emissive:0,emissiveIntensity:0});jt(d);const g=new tp(.25,.08,64,8,2,3),f=new O(g,d);f.scale.set(1,.6,1),p.add(f);const y=new O(xt.unitSphere,d);y.scale.setScalar(.15),y.position.y=.05,p.add(y);const x=Ct.lightBeam.clone();x.colorNode=Tt(h);const b=new O(xt.unitSphere,x);b.scale.setScalar(1.2),b.userData.isWash=!0,p.add(b),c.add(p),t.add(c)}return t.userData.animationType=mr(["sway","wobble"]),t.userData.animationOffset=Math.random()*10,t.userData.type="flower",Wt(t,{})}function qv(r={}){const{color:t=3050327}=r,e=new K,s=new O(xt.unitCylinder,Rt(t));s.scale.set(1.5,.5,1.5),s.position.y=0,s.castShadow=!0,s.receiveShadow=!0;const i=Ct.lotusRing.clone();i.emissiveNode=Tt(0),s.userData.ringMaterial=i,jt(i);for(let n=1;n<=3;n++){const o=new Pi(n*.3,.05,8,24),a=new O(o,i);a.rotation.x=-Math.PI/2,a.position.y=.51,s.add(a)}return e.add(s),e.userData.animationType="speakerPulse",e.userData.animationOffset=Math.random()*10,e.userData.type="lotus",Wt(e,{})}function Yv(r={}){const{color:t=9055202,intensity:e=1}=r,s=new K,i=.5+Math.random()*.3,n=new O(xt.unitCylinder,Rt(2263842));n.scale.set(.03,i,.03),n.castShadow=!0,s.add(n);const o=new K;o.position.y=i,s.add(o);const a=fr({color:t,emissive:t,emissiveIntensity:.8*e,roughness:.3});jt(a);const c=new O(xt.unitSphere,a);c.scale.setScalar(.08),o.add(c);const l=5,u=new Ku(.15,8),p=X0({color:t,emissive:t,emissiveIntensity:.4*e,roughness:.4,opacity:.7,side:se});jt(p);for(let d=0;d<l;d++){const g=new O(u,p),f=d/l*Math.PI*2;g.position.set(Math.cos(f)*.12,0,Math.sin(f)*.12),g.rotation.x=-Math.PI/2+Math.random()*.3,g.rotation.z=f,g.userData.vibratoPhase=Math.random()*Math.PI*2,o.add(g)}const h=new yn(t,.3*e,2);return h.position.y=0,o.add(h),s.userData.animationType="vibratoShake",s.userData.animationOffset=Math.random()*10,s.userData.type="vibratoViolet",s.userData.headGroup=o,Wt(s,{})}function m9(r={}){const{color:t=16737095,size:e=1}=r,s=new K,i=(.8+Math.random()*.4)*e,n=new O(xt.unitCylinder,Rt(2263842));n.scale.set(.04*e,i,.04*e),n.castShadow=!0,s.add(n);const o=new K;o.position.y=i,s.add(o);const a=new Le(.2*e,.05*e,.25*e,12,1,!0);a.translate(0,-.125*e,0);const c=X0({color:t,emissive:t,emissiveIntensity:.3,roughness:.5,opacity:.9,side:se});jt(c);const l=new O(a,c);l.rotation.x=Math.PI,o.add(l);const u=X0({color:16777215,opacity:.5,blending:pe,depthWrite:!1}),p=new O(xt.unitSphere,u);p.scale.setScalar(.08*e),p.position.y=-.1*e,o.add(p),s.userData.vortex=p;const h=new Pi(.2*e,.02,8,16),d=X0({color:t,opacity:.6,blending:pe}),g=new O(h,d);return g.rotation.x=Math.PI/2,g.position.y=-.02*e,o.add(g),s.userData.animationType="tremeloPulse",s.userData.animationOffset=Math.random()*10,s.userData.type="tremoloTulip",s.userData.headGroup=o,s.userData.bellMaterial=c,Wt(s,{})}function Xv(r={}){const{color:t=16753920,height:e=2.5}=r,s=new K,i=Rt(3100495),n=new O(xt.unitCylinder,i);n.scale.set(.1,e,.1),n.position.y=e*.5,n.castShadow=!0,s.add(n);const o=new K;o.position.set(0,e,0);const a=new Pi(.5,.08,6,8,Math.PI),c=new O(a,i);c.rotation.z=-Math.PI/2,c.position.set(.5,0,0),o.add(c),s.add(o);const l=new K;l.position.set(1,e-.2,0),s.add(l);const u=new mn(.2,.2,6),p=new O(u,i);l.add(p);const h=fr({color:16777215,emissive:t,emissiveIntensity:2,roughness:.2});jt(h);const d=new O(xt.unitSphere,h);d.scale.set(.25,.4,.25),d.position.y=-.3,l.add(d);const g=new yn(t,1,8);g.position.y=-.5,g.castShadow=!0,l.add(g),s.userData.animationType="sway",s.userData.animationOffset=Math.random()*10,s.userData.type="lanternFlower";const f=Wt(s,{});return f.reactToNote=(y,x,b)=>{h.emissiveIntensity=2+b*3,g.intensity=1+b*2},f}function jv(r={}){const{color:t=65280}=r,e=new A5;e.moveTo(0,0),e.quadraticCurveTo(.1,.1,0,.2),e.quadraticCurveTo(-.1,.1,0,0);const s=new Qu(e),i=Rt(t),n=new O(s,i);return n.castShadow=!0,n}function Zv(r={}){const{color:t=13607167,strands:e=4}=r,s=new K,i=Rt(t);jt(i);for(let n=0;n<e;n++){const o=new K,a=3+Math.floor(Math.random()*3);for(let c=0;c<a;c++){const l=new O(xt.cylinderLow,Rt(3050327));if(l.scale.set(.03,.4,.03),l.position.y=-c*.35,l.rotation.z=Math.sin(c*.5)*.15,o.add(l),c>0&&Math.random()>.6){const u=new O(xt.sphereLow,i);u.scale.setScalar(.05),u.position.y=l.position.y-.1,u.position.x=(Math.random()-.5)*.06,u.position.z=(Math.random()-.5)*.06,o.add(u)}}o.position.x=(Math.random()-.5)*.6,o.position.y=0,s.add(o)}return s.userData.animationType=mr(["vineSway","spiralWave"]),s.userData.animationOffset=Math.random()*10,s.userData.type="vine",s}function y9(r={}){const{color:t=9055202}=r,e=new K,s=2.5+Math.random(),i=new O(xt.cylinder,Rt(6111287));i.scale.set(.5,s,.5),i.position.y=s/2,i.castShadow=!0,e.add(i);const n=4+Math.floor(Math.random()*2),o=Rt(t);jt(o);for(let a=0;a<n;a++){const c=new K;c.position.y=s*.9,c.rotation.y=a/n*Math.PI*2;const l=1.5+Math.random(),u=new Dc(.2,l,8,16),p=new O(u,o);p.position.set(.5,-l/2,0),p.rotation.z=-Math.PI/6,c.add(p),e.add(c)}return e.userData.animationType="gentleSway",e.userData.animationOffset=Math.random()*10,e.userData.type="tree",Wt(e)}function x9(r={}){const{color:t=64154}=r,e=new K;class s extends Us{constructor(h=1){super(),this.scale=h}getPoint(h,d=new v){const g=Math.cos(h*Math.PI*4)*.2*h*this.scale,f=h*2*this.scale,y=Math.sin(h*Math.PI*4)*.2*h*this.scale;return d.set(g,f,y)}}const i=new s(1+Math.random()*.5),n=new ep(i,20,.08,8,!1),o=Rt(t);jt(o);const a=new O(n,o);a.castShadow=!0,e.add(a);const c=new Is({color:16777215,emissive:16775885,emissiveIntensity:.5,roughness:.5});jt(c);const l=new O(xt.sphereLow,c);l.scale.setScalar(.15);const u=i.getPoint(1);return l.position.copy(u),e.add(l),e.userData.animationType=mr(["spring","wobble"]),e.userData.animationOffset=Math.random()*10,e.userData.type="shrub",Wt(e)}function b9(r={}){const{color:t=16729344}=r,e=new K,s=5+Math.floor(Math.random()*5),i=Rt(t);jt(i);for(let n=0;n<s;n++){const o=.3+Math.random()*.4,a=new O(xt.sphere,i);a.scale.setScalar(o),a.position.set((Math.random()-.5)*.8,o+Math.random()*.8,(Math.random()-.5)*.8),a.castShadow=!0,e.add(a)}return e.userData.animationType=mr(["bounce","accordion","hop"]),e.userData.animationOffset=Math.random()*10,e.userData.type="shrub",Wt(e)}function Kv(r={}){const{color:t=16766720}=r,e=new K,s=3,i=10,n=new K,o=new Pi(.3,.15,8,16),a=Rt(9127187);for(let h=0;h<i;h++){const d=new O(o,a);d.rotation.x=Math.PI/2,d.position.y=h*(s/i),h%2===0&&(d.material=Rt(10506797)),n.add(d)}e.add(n);const c=6,l=new Le(.05,.1,1.5,8);l.translate(0,.75,0);const u=Rt(t);jt(u);const p=new K;p.position.y=s,n.add(p);for(let h=0;h<c;h++){const d=new O(l,u);d.rotation.z=Math.PI/3,d.rotation.y=h/c*Math.PI*2,p.add(d)}return e.userData.animationType="accordionStretch",e.userData.animationOffset=Math.random()*10,e.userData.type="tree",e.userData.trunk=n,e}function Jv(r={}){const{color:t=16777215}=r,e=new K,s=2.5+Math.random(),i=new O(xt.cylinder,Rt(2236962));i.scale.set(.3,s,.3),i.position.y=s/2,i.castShadow=!0,e.add(i);const n=8,o=Ct.opticCable,a=Ct.opticTip.clone();jt(a);for(let c=0;c<n;c++){const l=new K;l.position.y=s*.9,l.rotation.y=c/n*Math.PI*2;const u=1.5+Math.random(),p=new K;p.rotation.z=Math.PI/4;const h=new O(xt.cylinderLow,o);h.scale.set(.02,u,.02),h.position.set(0,-u/2,0),p.add(h);const d=new O(xt.sphereLow,a);d.scale.setScalar(.08),d.position.set(0,-u,0),p.add(d),l.add(p),e.add(l)}return e.userData.animationType="fiberWhip",e.userData.animationOffset=Math.random()*10,e.userData.type="willow",Wt(e)}class Qv{constructor(t,e=8){this.vine=t,this.anchorPoint=t.position.clone(),this.length=e,this.isPlayerAttached=!1,this.swingAngle=0,this.swingAngularVel=0,this.swingPlane=new v(1,0,0),this.rotationAxis=new v(0,0,1),this.defaultDown=new v(0,-1,0)}update(t,e,s){const n=-20/this.length*Math.sin(this.swingAngle);this.swingAngularVel+=n*e,this.swingAngularVel*=.99,this.isPlayerAttached&&s&&(s.forward?Math.abs(this.swingAngularVel)>.1?this.swingAngularVel+=Math.sign(this.swingAngularVel)*3*e:this.swingAngularVel+=3*e:s.backward&&(this.swingAngularVel-=Math.sign(this.swingAngularVel)*3*e)),this.swingAngle+=this.swingAngularVel*e;const o=Math.PI*.45;this.swingAngle>o?(this.swingAngle=o,this.swingAngularVel*=-.5):this.swingAngle<-o&&(this.swingAngle=-o,this.swingAngularVel*=-.5);const a=-Math.cos(this.swingAngle)*this.length,c=Math.sin(this.swingAngle)*this.length,l=this.anchorPoint.clone();l.y+=a,l.addScaledVector(this.swingPlane,c),this.isPlayerAttached&&t.position.copy(l);const u=new v().subVectors(l,this.anchorPoint).normalize();this.vine.quaternion.setFromUnitVectors(this.defaultDown,u)}attach(t,e){this.isPlayerAttached=!0;const s=new v(e.x,0,e.z);if(s.lengthSq()>1)this.swingPlane.copy(s.normalize());else{const h=new v().subVectors(t.position,this.anchorPoint);h.y=0,h.lengthSq()>.1&&this.swingPlane.copy(h.normalize())}const i=new v().subVectors(t.position,this.anchorPoint),n=i.y,o=i.dot(this.swingPlane);this.swingAngle=Math.atan2(o,-n);const a=Math.cos(this.swingAngle),c=Math.sin(this.swingAngle),l=s.length()*(e.dot(this.swingPlane)>0?1:-1),u=e.y,p=l*a+u*c;this.swingAngularVel=p/this.length}detach(t){this.isPlayerAttached=!1;const e=this.swingAngularVel*this.length,s=Math.cos(this.swingAngle),i=Math.sin(this.swingAngle),n=e*s,o=e*i;return t.velocity.x=this.swingPlane.x*n,t.velocity.z=this.swingPlane.z*n,t.velocity.y=o,t.velocity.y+=5,Date.now()}}function tM(r={}){const{length:t=12,color:e=3050327}=r,s=new K,i=8,n=t/i;for(let l=0;l<i;l++){const u=Rt(e),p=new K;p.position.y=-l*n;const h=new O(xt.cylinderLow,u);if(h.scale.set(.15,n,.15),h.position.y=-n/2,h.rotation.z=(Math.random()-.5)*.1,h.rotation.x=(Math.random()-.5)*.1,p.add(h),Math.random()>.4){const d=jv({color:3329330});d.position.y=-n*.5,d.position.x=.1,d.rotation.z=Math.PI/4,p.add(d)}s.add(p)}const o=new Le(.5,.5,t,8);o.translate(0,-t/2,0);const a=new Ds({color:16776960,wireframe:!0,visible:!1}),c=new O(o,a);return c.userData.isVineHitbox=!0,s.add(c),s.userData.type="vine",s.userData.isSwingable=!0,s.userData.vineLength=t,s}const Su=ye(0),vu=ye(0),Or=ye(Tt(16777215));function w9(r={}){const{color:t=null,rainIntensity:e=30,shape:s="random",size:i=1}=r,n=new K,o=[16119285,16770273,15132410,11584734,16761035,14524637,10025880],a=t!==null?t:o[Math.floor(Math.random()*o.length)],c=sM(a),l=s==="random"?["fluffy","long","tall","puffy"][Math.floor(Math.random()*4)]:s;switch(l){case"fluffy":{const u=5+Math.floor(Math.random()*3);for(let p=0;p<u;p++){const h=(.8+Math.random()*.8)*i,d=new Et(h,16,16),g=new O(d,c);g.position.set((Math.random()-.5)*2.5*i,(Math.random()-.3)*1*i,(Math.random()-.5)*1.5*i),g.castShadow=!0,n.add(g)}break}case"long":{for(let u=0;u<6;u++){const p=(.6+Math.random()*.4)*i,h=new Et(p,16,16),d=new O(h,c);d.position.set((u-2.5)*1.2*i,(Math.random()-.5)*.5*i,(Math.random()-.5)*.8*i),d.scale.set(1.3,.7,1),d.castShadow=!0,n.add(d)}break}case"tall":{for(let p=0;p<3;p++){const h=4-p,d=p*1.2*i;for(let g=0;g<h;g++){const f=(1-p*.2+Math.random()*.3)*i,y=new Et(f,16,16),x=new O(y,c),b=g/h*Math.PI*2,w=(1.5-p*.4)*i;x.position.set(Math.cos(b)*w,d,Math.sin(b)*w),x.castShadow=!0,n.add(x)}}break}case"puffy":{const u=new O(new Et(1.5*i,16,16),c);u.castShadow=!0,n.add(u);for(let p=0;p<8;p++){const h=(.5+Math.random()*.4)*i,d=new Et(h,12,12),g=new O(d,c),f=Math.random()*Math.PI*2,y=Math.random()*Math.PI*.6;g.position.set(Math.sin(y)*Math.cos(f)*1.4*i,Math.cos(y)*.8*i,Math.sin(y)*Math.sin(f)*1.4*i),g.castShadow=!0,n.add(g)}break}}if(e>0){const u=new It,p=e,h=new Float32Array(p*3),d=new Float32Array(p*3);for(let y=0;y<p;y++)h[y*3]=(Math.random()-.5)*4*i,h[y*3+1]=Math.random()*-2,h[y*3+2]=(Math.random()-.5)*4*i,d[y*3]=0,d[y*3+1]=1,d[y*3+2]=0;u.setAttribute("position",new lt(h,3)),u.setAttribute("normal",new lt(d,3));const g=new ln({color:8900331,size:.05}),f=new un(u,g);f.name="RainParticles",n.add(f)}return n.userData.animationType=e>0?"rain":"cloudBob",n.userData.animationOffset=Math.random()*10,n.userData.type="cloud",n.userData.shapeType=l,n.userData.cloudColor=a,n.userData.reactivityType="sky",n.userData.reactivityType="sky",n.userData.stormIntensity=1,Wt(n,{})}function eM(r,t){const e=r.y.add(r.x.mul(.5)).add(t),s=er(e.mul(6.28).add(0)).mul(.5).add(.5),i=er(e.mul(6.28).add(.33*6.28)).mul(.5).add(.5),n=er(e.mul(6.28).add(.67*6.28)).mul(.5).add(.5);return ue(s,i,n)}function sM(r){if(!Bv())return new Is({color:r});const t=new Qe({color:r,roughness:.8,metalness:.1}),e=eM(Zs,We.mul(.5)),s=Or,i=e.mul(Su),n=s.mul(vu.mul(5));return t.emissiveNode=i.add(n),t}function iM(r,t,e){for(let s=t.length-1;s>=0;s--){const i=t[s];if(i.userData.isFalling){i.userData.velocity.y-=20*r,i.position.addScaledVector(i.userData.velocity,r),i.rotation.z+=r,i.rotation.x+=r*.5;const n=e(i.position.x,i.position.z);i.position.y<n-2&&nM(i)}}}function nM(r){r.userData.isFalling=!1,r.position.set((Math.random()-.5)*200,40+Math.random()*20,(Math.random()-.5)*200),r.rotation.set(0,0,0),r.traverse(t=>{t.isMesh&&t.material&&(t.material.emissive.setHex(0),t.material.emissiveIntensity=0)})}function oM(r,t,e=5){const s=new K;s.name="Waterfall";const i=r.y-t.y,n=(r.y+t.y)/2,o=new Le(e,e*1.5,i,16,8,!0),a=new Qe({color:65535,roughness:.2,metalness:.1,transparent:!0,side:se}),l=sr().add(Rv(0,We.mul(2).negate())),u=me(l.y.mul(20).add(l.x.mul(10))).mul(.5).add(.5),p=me(We.mul(3)).mul(.2).add(.8),h=xs(Tt(16711935),Tt(65535),sr().y);a.colorNode=h,a.opacityNode=Dt(.7).mul(u.add(.5)),a.emissiveNode=h.mul(p).mul(u);const d=new O(o,a);d.position.set(r.x,n,r.z),jt(a),s.add(d);const g=5;for(let f=0;f<g;f++){const y=new Et(e*.2,8,8),x=new Ds({color:16777215,transparent:!0,opacity:.5}),b=new O(y,x);b.position.set(r.x+(Math.random()-.5)*e,t.y,r.z+(Math.random()-.5)*e),b.userData={velocity:new v(Math.random()-.5,Math.random()*5,Math.random()-.5),originalY:t.y},s.add(b)}return s.userData.type="waterfall",s.userData.splashes=s.children.slice(1),s.onAnimate=(f,y)=>{s.userData.splashes.forEach(x=>{x.position.addScaledVector(x.userData.velocity,f),x.userData.velocity.y-=9.8*f,x.position.y<x.userData.originalY-1&&(x.position.y=x.userData.originalY,x.userData.velocity.y=Math.random()*5+2,x.position.x=r.x+(Math.random()-.5)*e,x.position.z=r.z+(Math.random()-.5)*e)})},s}function rM(r=200,t=200){const e=new on(r,t,64,64);e.rotateX(-Math.PI/2);const s=new Qe({color:4251856,roughness:.1,metalness:.5,transparent:!0,opacity:.8}),i=Zs,n=Nv(i.xz),o=me(n.mul(.5).sub(We.mul(2))).mul(.5),a=me(i.x.mul(.2).add(We)).mul(er(i.z.mul(.2).add(We))).mul(.5);s.positionNode=ue(i.x,i.y.add(o).add(a),i.z);const c=new O(e,s);return c.receiveShadow=!0,c.userData.type="lake",c}function aM(r={}){const{color:t=8900331,size:e=.5}=r,s=new Et(e,8,8),i=new Is({color:t,emissive:t,emissiveIntensity:.8});jt(i);const n=new O(s,i);n.castShadow=!0,n.userData.animationType="float",n.userData.animationOffset=Math.random()*10,n.userData.type="orb";const o=new yn(t,.5,4);return n.add(o),Wt(n)}function _9(r={}){const{color:t=16729344,maxHeight:e=5}=r,s=new K,i=new Na(.1,.4,8,1);i.rotateX(-Math.PI/2);const n=new Is({color:1706496,roughness:.9,emissive:t,emissiveIntensity:.1}),o=new O(i,n);s.add(o);const a=new Le(.08,.12,.1,8);a.translate(0,-.05,0);const c=new Is({color:t,emissive:t,emissiveIntensity:.8,roughness:.3});jt(c);const l=new O(a,c);s.add(l);const u=50,p=new It,h=new Float32Array(u*3),d=new Float32Array(u*3),g=new Float32Array(u);for(let b=0;b<u;b++)h[b*3]=(Math.random()-.5)*.2,h[b*3+1]=0,h[b*3+2]=(Math.random()-.5)*.2,d[b*3]=0,d[b*3+1]=1,d[b*3+2]=0,g[b]=.5+Math.random()*.5;p.setAttribute("position",new lt(h,3)),p.setAttribute("normal",new lt(d,3)),p.setAttribute("velocity",new lt(g,1));const f=new ln({color:t,size:.15,transparent:!0,opacity:.8,blending:pe,depthWrite:!1}),y=new un(p,f);y.visible=!1,s.add(y);const x=new yn(t,0,5);return x.position.y=1,s.add(x),s.userData.animationType="geyserErupt",s.userData.animationOffset=Math.random()*10,s.userData.type="geyser",s.userData.plume=y,s.userData.plumeLight=x,s.userData.coreMaterial=c,s.userData.maxHeight=e,s.userData.eruptionStrength=0,Wt(s)}function cM(r=80,t=100){const e=new It,s=new Float32Array(r*3),i=new Float32Array(r*3),n=new Float32Array(r),o=new Float32Array(r);for(let g=0;g<r;g++)s[g*3]=(Math.random()-.5)*t,s[g*3+1]=.5+Math.random()*4,s[g*3+2]=(Math.random()-.5)*t,i[g*3]=0,i[g*3+1]=1,i[g*3+2]=0,n[g]=Math.random()*Math.PI*2,o[g]=.5+Math.random()*1.5;e.setAttribute("position",new lt(s,3)),e.setAttribute("normal",new lt(i,3)),e.setAttribute("phase",new lt(n,1)),e.setAttribute("speed",new lt(o,1));const a=new Kp({size:.2,transparent:!0,depthWrite:!1,blending:pe}),c=oa("phase"),l=oa("speed"),p=me(We.mul(l).add(c)).sub(.7).max(0).mul(3.33),h=xs(Tt(8978176),Tt(16776960),p);a.colorNode=h.mul(p.add(.1)),a.opacityNode=p.add(.05).min(1);const d=new un(e,a);return d.userData.isFireflies=!0,d.visible=!1,d}function lM(r,t,e){if(!r||!r.visible)return;const s=r.geometry.attributes.position.array,i=r.geometry.attributes.phase.array;for(let n=0;n<s.length/3;n++){const o=n*3,a=i[n],c=Math.sin(t*.3+a)*.02,l=Math.cos(t*.5+a*1.3)*.01,u=Math.sin(t*.4+a*.7)*.02;s[o]+=c,s[o+1]+=l,s[o+2]+=u,s[o]>50&&(s[o]=-50),s[o]<-50&&(s[o]=50),s[o+1]<.3&&(s[o+1]=.3),s[o+1]>5&&(s[o+1]=5),s[o+2]>50&&(s[o+2]=-50),s[o+2]<-50&&(s[o+2]=50)}r.geometry.attributes.position.needsUpdate=!0}const uM="modulepreload",pM=function(r){return"/"+r},f3={},m3=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let c=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(p=>({status:"fulfilled",value:p}),p=>({status:"rejected",reason:p}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=o?.nonce||o?.getAttribute("nonce");i=c(e.map(l=>{if(l=pM(l),l in f3)return;f3[l]=!0;const u=l.endsWith(".css"),p=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${p}`))return;const h=document.createElement("link");if(h.rel=u?"stylesheet":uM,u||(h.as="script"),h.crossOrigin="",h.href=l,a&&h.setAttribute("nonce",a),document.head.appendChild(h),u)return new Promise((d,g)=>{h.addEventListener("load",d),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})};let Ut=null,y3=null,Oo=null,Go=null,Dn=null,Mu=null,Au=null,hM=null,Nu=null,dM=null,Pn=null,x3=null;const gM=0,fM=4096,mM=8192;async function yM(){if(typeof SharedArrayBuffer>"u")return console.error("[Native] SharedArrayBuffer is missing. Pthreads will NOT work."),console.error("[Native] If hosting statically, ensure you have COOP/COEP headers configured."),console.error("[Native] (Cross-Origin-Opener-Policy: same-origin, Cross-Origin-Embedder-Policy: require-corp)"),!1;try{await _c("Loading Native Engine...");let r,t="/candy-world";try{r=(await m3(()=>import(`/candy-world/candy_native.js?v=${Date.now()}`),[])).default}catch{console.log("[WASM] Production path failed, trying local fallback..."),r=(await m3(()=>import(`/candy_native.js?v=${Date.now()}`),[])).default,t=""}return await _c("Spawning Physics Workers..."),Pn=await r({locateFile:(e,s)=>e.endsWith(".wasm")?`${t}/candy_native.wasm`:e.endsWith(".worker.js")?`${t}/candy_native.worker.js`:s+e,print:e=>console.log("[Native]",e),printErr:e=>console.warn("[Native Err]",e)}),console.log("[WASM] Emscripten Pthreads Ready"),Pn.wasmMemory?x3=Pn.wasmMemory:Pn.HEAP8&&(x3=Pn.HEAP8.buffer),!0}catch(r){return console.warn("Failed to load Native Emscripten module:",r),!1}}function us(r){return Pn&&Pn["_"+r]||null}async function _c(r){window.setLoadingStatus&&window.setLoadingStatus(r);const t=document.getElementById("startButton");t&&(t.textContent=r),console.log("[WASM Progress]",r),await new Promise(e=>setTimeout(e,20))}async function xM(){if(Ut)return!0;const r=document.getElementById("startButton");r&&(r.disabled=!0,r.style.cursor="wait"),console.log("[WASM] initWasm started"),await _c("Downloading Physics Engine...");try{const t="./candy_physics.wasm?v="+Date.now();console.log("[WASM] Fetching:",t);const e=await fetch(t);if(console.log("[WASM] Fetch response:",e.status,e.statusText),!e.ok)return console.warn("WASM not found, using JS fallbacks"),r&&(r.disabled=!1,r.textContent="Start Exploration ",r.style.cursor="pointer"),!1;const s=await e.arrayBuffer();console.log("WASM buffer size:",s.byteLength,"bytes");const i=new Uint8Array(s.slice(0,4)),n=Array.from(i).map(p=>p.toString(16).padStart(2,"0")).join("");if(console.log("[WASM] Magic number:",n,"(expected: 0061736d)"),n!=="0061736d")return console.error("[WASM] Invalid file - not a WebAssembly binary!"),r&&(r.disabled=!1,r.textContent="Start Exploration ",r.style.cursor="pointer"),!1;const o={fd_close:()=>0,fd_seek:()=>0,fd_write:()=>0,fd_read:()=>0,fd_fdstat_get:()=>0,fd_prestat_get:()=>0,fd_prestat_dir_name:()=>0,path_open:()=>0,environ_sizes_get:()=>0,environ_get:()=>0,proc_exit:()=>{},clock_time_get:()=>0};await _c("Compiling Physics (WASM)...");const a=window.NativeWebAssembly||WebAssembly;console.log("Using WebAssembly API:",a===WebAssembly?"Standard (potentially hijacked)":"Native (saved)"),console.log("Attempting WebAssembly.instantiate...");const c={env:{abort:(p,h,d,g)=>{console.error(`WASM abort at ${h}:${d}:${g}: ${p}`)}},wasi_snapshot_preview1:o},l=await a.instantiate(s,c);console.log("Instantiation successful"),window.setLoadingStatus&&window.setLoadingStatus("Physics Engine Ready..."),Ut=l.instance;const u=Object.keys(Ut.exports);if(console.log("WASM exports:",u),console.log("Export count:",u.length),!Ut.exports.getGroundHeight)return console.error("WASM exports missing getGroundHeight. Available:",u),Ut=null,r&&(r.disabled=!1,r.textContent="Start Exploration ",r.style.cursor="pointer"),!1;if(Ut.exports.memory){y3=Ut.exports.memory;const p=y3.buffer;Oo=new Float32Array(p,gM,1024),Go=new Float32Array(p,fM,1024),Dn=new Float32Array(p,mM,1024)}return Mu=Ut.exports.getGroundHeight,Au=Ut.exports.freqToHue,hM=Ut.exports.lerp,Nu=Ut.exports.batchMushroomSpawnCandidates||null,dM=Ut.exports.updateFoliageBatch||null,console.log("[WASM] AssemblyScript module loaded successfully"),await yM(),r&&(r.disabled=!1,r.textContent="Start Exploration ",r.style.cursor="pointer"),!0}catch(t){return console.warn("Failed to load WASM:",t),Ut=null,r&&(r.disabled=!1,r.textContent="Start Exploration ",r.style.cursor="pointer"),!1}}function bM(){return Ut!==null}function Ur(){return Ut}function dn(r,t){return Mu?Mu(r,t):isNaN(r)||isNaN(t)?0:Math.sin(r*.05)*2+Math.cos(t*.05)*2+Math.sin(r*.2)*.3+Math.cos(t*.15)*.3}function wM(r){return Au?Au(r):!r||r<50?0:Math.log2(r/55)*.1%1}function T9(r){if(!Oo)return;const t=Math.min(r.length,256);for(let e=0;e<t;e++){const s=r[e],i=e*4;Oo[i]=s.x||0,Oo[i+1]=s.y||0,Oo[i+2]=s.z||0,Oo[i+3]=s.radius||1}}function _M(r){if(!Go)return;const t=Math.min(r.length,256);for(let e=0;e<t;e++){const s=r[e],i=e*4;Go[i]=s.offset||0,Go[i+1]=s.type||0,Go[i+2]=s.originalY||0,Go[i+3]=typeof s.colorIndex=="number"?s.colorIndex:0}}function b3(r,t,e,s,i,n,o,a){return Nu&&Ut?Nu(r,t,e,s,i,n,o,a):0}function TM(r){if(!Dn)return[];const t=[],e=Math.min(r,128);for(let s=0;s<e;s++){const i=s*4,n=Dn[i],o=Dn[i+1],a=Dn[i+2],c=Dn[i+3];isNaN(n)||isNaN(o)||isNaN(a)||t.push({x:n,y:o,z:a,colorIndex:Math.round(c)})}return t}function SM(r,t,e,s){return Ut?(Ut.exports.batchAnimationCalc(r,t,e,s),Dn.slice(0,s*4)):null}let Do={targetStep:0,unfurlStep:0};function vM(r,t,e,s,i,n){const o=us("calcArpeggioStep_c");if(o){o(r,t,e?1:0,s?1:0,i?1:0,n);const u=us("getArpeggioTargetStep_c"),p=us("getArpeggioUnfurlStep_c");if(u&&p)return Do.targetStep=u(),Do.unfurlStep=p(),Do}if(Ut&&Ut.exports.calcArpeggioStep)return Ut.exports.calcArpeggioStep(r,t,e?1:0,s?1:0,i?1:0,n),Do.targetStep=Ut.exports.getArpeggioTargetStep(),Do.unfurlStep=Ut.exports.getArpeggioUnfurlStep(),Do;let a=t;s?i&&!e&&(a=Math.min(n,a+1)):a=0;const c=a>r?.3:.05,l=r+(a-r)*c;return{targetStep:a,unfurlStep:l}}function MM(r,t,e,s){if(Ut)return Ut.exports.calcRainDropY(r,t,e,s);const n=t*e%s;return r-n}function AM(r,t,e,s,i,n,o,a){const c=us("updatePhysicsCPP");return c?c(r,t,e,s,i?1:0,n?1:0,o?1:0,a):-1}function NM(r,t,e){const s=us("initPhysics");s&&s(r,t,e)}function y1(r,t,e,s,i,n,o,a,c){const l=us("addObstacle");l&&l(r,t,e,s,i,n,o,a,c?1:0)}function CM(r,t,e,s,i,n){const o=us("setPlayerState");o&&o(r,t,e,s,i,n)}function RM(){const r=us("getPlayerX")(),t=us("getPlayerY")(),e=us("getPlayerZ")(),s=us("getPlayerVX")(),i=us("getPlayerVY")(),n=us("getPlayerVZ")();return{x:r,y:t,z:e,vx:s,vy:i,vz:n}}const Ps=60,Zn=420,Ri=60,Tc=180,Sc=120,S9=120,Es=Ps+Zn+Ri+Tc+Sc+S9,De={day:{skyTop:new W(8900331),skyBot:new W(12117744),horizon:new W(16770508),fog:new W(16762323),sun:new W(16775920),amb:new W(16774638),sunInt:.9,ambInt:.65,atmosphereIntensity:.3},sunset:{skyTop:new W(4930959),skyBot:new W(16739146),horizon:new W(16757575),fog:new W(15235999),sun:new W(16752704),amb:new W(10178640),sunInt:.55,ambInt:.45,atmosphereIntensity:.7},night:{skyTop:new W(657966),skyBot:new W(1710645),horizon:new W(2763338),fog:new W(657944),sun:new W(3359846),amb:new W(526357),sunInt:.12,ambInt:.08,atmosphereIntensity:.15},sunrise:{skyTop:new W(4774120),skyBot:new W(16751532),horizon:new W(16766115),fog:new W(16770250),sun:new W(16769126),amb:new W(16763096),sunInt:.65,ambInt:.55,atmosphereIntensity:.6}},Ne={colors:{ground:9498256},noteColorMap:{global:{C:16711680,"C#":16744192,D:16776960,"D#":8388352,E:65280,F:65407,"F#":65535,G:32767,"G#":255,A:8323327,"A#":16711935,B:16711807},mushroom:{C:16728128,"C#":15667840,D:12591296,"D#":8397039,E:4210943,F:1212655,"F#":49344,G:1240960,"G#":4259648,A:8449810,"A#":12632064,B:15695890},flower:{C:16738740,"C#":16716947,D:16758465,"D#":16761035,E:14524637,F:15631086,"F#":14315734,G:12211667,"G#":9662683,A:9055202,"A#":9699539,B:10040012},tree:{C:25600,"C#":2263842,D:3329330,"D#":9498256,E:10025880,F:65280,"F#":11403055,G:8388352,"G#":8190976,A:7048739,"A#":5597999,B:8421376},cloud:{C:15792383,"C#":15132410,D:11584734,"D#":11393254,E:8900331,F:8900346,"F#":49151,G:2003199,"G#":6591981,A:4620980,"A#":6266528,B:3100495}},reactivity:{mushroom:{smoothingRate:8,scale:.6,maxAmplitude:1,minThreshold:.02}},flashScale:2};function FM(r,t,e){let s=!1,i=!1;if(e&&e.channelData)for(const l of e.channelData)(l.activeEffect===4||l.activeEffect===0&&l.effectValue&&l.effectValue>0)&&(s=!0),l.trigger>.1&&(i=!0);r.userData.unfurlStep===void 0&&(r.userData.unfurlStep=0),r.userData.targetStep===void 0&&(r.userData.targetStep=0),r.userData.lastTrigger===void 0&&(r.userData.lastTrigger=!1);const n=12,o=vM(r.userData.unfurlStep,r.userData.targetStep,r.userData.lastTrigger,s,i,n);r.userData.targetStep=o.targetStep,r.userData.unfurlStep=o.unfurlStep,r.userData.lastTrigger=i;const a=(r.userData.unfurlStep||0)/n,c=r.userData.fronds;c&&c.forEach((l,u)=>{l.forEach((p,h)=>{const d=Pe.lerp(p.initialCurl,.2,a),g=Math.sin(t*5+h*.5)*.1*a;p.pivot.rotation.x=d+g})}),r.userData.originalY===void 0&&(r.userData.originalY=r.position.y),r.position.y=r.userData.originalY+a*.2}const yi=4e3,w3=16384,As=yi*4;class Zo{constructor(){this.initialized=!1,this.batches={sway:this.createBatch(),bounce:this.createBatch(!0),hop:this.createBatch(!0),gentleSway:this.createBatch(),wobble:this.createBatch(!1,!0,!0)}}static getInstance(){return Zo.instance||(Zo.instance=new Zo),Zo.instance}createBatch(t=!1,e=!1,s=!1){return{count:0,offsets:new Float32Array(yi),intensities:new Float32Array(yi),originalYs:t?new Float32Array(yi):void 0,wobbleBoosts:e?new Float32Array(yi):void 0,outScalars:new Float32Array(yi),outScalars2:s?new Float32Array(yi):void 0,objects:new Array(yi),ptrOffsets:0,ptrIntensities:0,ptrOriginalYs:0,ptrWobbleBoosts:0,ptrOutScalars:0,ptrOutScalars2:0}}initBatchMemory(t,e){if(t.ptrOffsets!==0||!Ur())return;let i=e;t.ptrOffsets=i,i+=As,t.ptrIntensities=i,i+=As,t.ptrOutScalars=i,i+=As,t.originalYs&&(t.ptrOriginalYs=i,i+=As),t.wobbleBoosts&&(t.ptrWobbleBoosts=i,i+=As),t.outScalars2&&(t.ptrOutScalars2=i,i+=As)}init(){const t=Ur();if(this.initialized||!t)return;let e=w3;this.initBatchMemory(this.batches.sway,e),e+=As*3,this.initBatchMemory(this.batches.bounce,e),e+=As*4,this.initBatchMemory(this.batches.hop,e),e+=As*4,this.initBatchMemory(this.batches.gentleSway,e),e+=As*3,this.initBatchMemory(this.batches.wobble,e),e+=As*5,this.initialized=!0,console.log("[FoliageBatcher] WASM memory allocated using fixed offsets for batching"),console.log(`[FoliageBatcher] Total memory used: ${e-w3} bytes`)}queue(t,e,s,i){if(this.initialized||this.init(),!this.initialized)return!1;let n;if(e==="sway"?n=this.batches.sway:e==="bounce"?n=this.batches.bounce:e==="hop"?n=this.batches.hop:e==="gentleSway"?n=this.batches.gentleSway:e==="wobble"&&(n=this.batches.wobble),!n||n.count>=yi)return!1;const o=n.count;return n.objects[o]=t,n.offsets[o]=t.userData.animationOffset||0,n.intensities[o]=s,n.originalYs&&(t.userData.originalY===void 0&&(t.userData.originalY=t.position.y),n.originalYs[o]=t.userData.originalY),n.wobbleBoosts&&(n.wobbleBoosts[o]=t.userData.wobbleCurrent||0),n.count++,!0}flush(t,e){this.initialized&&(this.processSimpleBatch(this.batches.sway,"computeSway",t,(s,i)=>{s.rotation.z=i}),this.processSimpleBatch(this.batches.gentleSway,"computeGentleSway",t,(s,i)=>{s.rotation.z=i}),this.processPhysicsBatch(this.batches.bounce,"computeBounce",t,e,(s,i)=>{s.position.y=i}),this.processPhysicsBatch(this.batches.hop,"computeHop",t,e,(s,i)=>{s.position.y=i}),this.processWobbleBatch(this.batches.wobble,t))}processSimpleBatch(t,e,s,i){if(t.count===0)return;const n=Ur();if(!n)return;const o=new Float32Array(n.exports.memory.buffer),a=t.ptrOffsets>>>2,c=t.ptrIntensities>>>2;o.set(t.offsets.subarray(0,t.count),a),o.set(t.intensities.subarray(0,t.count),c);const l=n.exports[e];if(l){l(t.count,s,t.ptrOffsets,t.ptrIntensities,t.ptrOutScalars);const u=t.ptrOutScalars>>>2,p=o.subarray(u,u+t.count);for(let h=0;h<t.count;h++)i(t.objects[h],p[h]),t.objects[h]=void 0}t.count=0}processPhysicsBatch(t,e,s,i,n){if(t.count===0)return;const o=Ur();if(!o)return;const a=new Float32Array(o.exports.memory.buffer),c=t.ptrOffsets>>>2,l=t.ptrIntensities>>>2,u=t.ptrOriginalYs>>>2;a.set(t.offsets.subarray(0,t.count),c),a.set(t.intensities.subarray(0,t.count),l),a.set(t.originalYs.subarray(0,t.count),u);const p=o.exports[e];if(p){p(t.count,s,t.ptrOriginalYs,t.ptrOffsets,t.ptrIntensities,i,t.ptrOutScalars);const h=t.ptrOutScalars>>>2,d=a.subarray(h,h+t.count);for(let g=0;g<t.count;g++)n(t.objects[g],d[g]),t.objects[g]=void 0}t.count=0}processWobbleBatch(t,e){if(t.count===0)return;const s=Ur();if(!s)return;const i=new Float32Array(s.exports.memory.buffer),n=t.ptrOffsets>>>2,o=t.ptrIntensities>>>2,a=t.ptrWobbleBoosts>>>2;i.set(t.offsets.subarray(0,t.count),n),i.set(t.intensities.subarray(0,t.count),o),i.set(t.wobbleBoosts.subarray(0,t.count),a);const c=s.exports.computeWobble;if(c){c(t.count,e,t.ptrOffsets,t.ptrIntensities,t.ptrWobbleBoosts,t.ptrOutScalars,t.ptrOutScalars2);const l=t.ptrOutScalars>>>2,u=t.ptrOutScalars2>>>2;for(let p=0;p<t.count;p++){const h=t.objects[p];h.rotation.x=i[l+p],h.rotation.z=i[u+p],h.userData.wobbleCurrent&&(h.userData.wobbleCurrent*=.9),t.objects[p]=void 0}}t.count=0}}const v9=Zo.getInstance();function zr(r,t){r.forEach(e=>{if(e.userData.maxScale||(e.userData.maxScale=e.scale.x*1.5),e.scale.x<e.userData.maxScale){const s=t*.01,i=e.scale.x+s;e.scale.setScalar(i)}})}function EM(r,t){r.forEach(e=>{if(e.userData.type==="flower"&&(e.userData.isFlower||e.userData.type==="flower")&&(e.userData.maxBloom||(e.userData.maxBloom=e.scale.x*1.3),e.scale.x<e.userData.maxBloom)){const s=t*.02;e.scale.addScalar(s)}})}function BM(r,t){if(r.userData.dryRoughness===void 0&&(r.userData.dryRoughness=r.roughness||.5,r.userData.dryMetalness=r.metalness||0,r.color&&(r.userData.dryColor=r.color.clone())),r.roughness!==void 0&&r.userData.dryRoughness!==void 0){const e=Pe.lerp(r.userData.dryRoughness,.2,t);r.roughness=e}if(r.metalness!==void 0&&r.userData.dryMetalness!==void 0){const e=Pe.lerp(r.userData.dryMetalness,.15,t);r.metalness=e}if(r.color&&r.userData.dryColor){const e=r.userData.dryColor.clone().multiplyScalar(1-t*.3);r.color.lerp(e,.1)}}function DM(r,t,e){r.forEach(s=>{if(!s||!s.isMaterial)return;let i=0;t==="rain"?i=e*.5:t==="storm"&&(i=e*.8),BM(s,i)})}function PM(r,t,e=null,s=0){if(r){if(t){const i=r.channelData;i&&i.length>0&&Y0.forEach((n,o)=>{const a=o%4+1,c=i[Math.min(a,i.length-1)];if(c&&c.freq>0){const u=wM(c.freq);f1.setHSL(u,1,.6),n.isMeshBasicMaterial&&n.color?n.color.lerp(f1,.3):n.emissive&&n.emissive.lerp(f1,.3)}const l=.2+(c?.volume||0)+(c?.trigger||0)*2;!n.isMeshBasicMaterial&&n.emissiveIntensity!==void 0&&(n.emissiveIntensity=l)})}else Y0.forEach(i=>{i.emissive&&(i.emissive.setHex(0),i.emissiveIntensity=0)});e&&s>0&&DM(Y0,e,s)}}function IM(r,t,e,s,i=!1){const n=r.userData.animationOffset||0,o=r.userData.animationType,a=r.userData.reactiveMeshes||[];if(a.length>0){let f=!1,y=!1;for(let x=0;x<a.length;x++){const b=a[x];if((b.userData.flashIntensity||0)>0&&(f=!0),b.userData._needsFadeBack&&(y=!0),f&&y)break}if(f||y)for(let x=0;x<a.length;x++){const b=a[x];let w=b.userData.flashIntensity||0;const _=b.userData.flashDecay??.05,T=Array.isArray(b.material)?b.material:b.material?[b.material]:[];if(w>0){const M=b.userData.flashColor||new W(16777215);for(const A of T){if(!A)continue;const C=Math.min(1,w*1.2)*.8;A.isMeshBasicMaterial&&A.color?w>.7?A.color.copy(M):A.color.lerp(M,C):A.emissive&&(w>.7?A.emissive.copy(M):A.emissive.lerp(M,C),A.emissiveIntensity=Math.max(.2,w*Ne.flashScale))}b.userData.flashIntensity=Math.max(0,w-_),b.userData.flashIntensity===0&&(delete b.userData.flashColor,delete b.userData.flashDecay,b.userData._needsFadeBack=!0)}else if(b.userData._needsFadeBack){const M=Ne.reactivity?.fadeSpeed??.06,A=Ne.reactivity?.fadeSnapThreshold??.06,C=A*A;let P=!0;for(const D of T)if(D){if(D.isMeshBasicMaterial)D.userData&&D.userData.baseColor&&D.color&&(D.color.distanceToSquared(D.userData.baseColor)>C?(D.color.lerp(D.userData.baseColor,M),P=!1):D.color.copy(D.userData.baseColor));else if(D.emissive){D.userData&&D.userData.baseEmissive&&D.emissive.lerp(D.userData.baseEmissive,M);const V=D.emissiveIntensity||0;V>A?(D.emissiveIntensity=Pe.lerp(V,0,M),P=!1):(D.userData&&D.userData.baseEmissive&&D.emissive.copy(D.userData.baseEmissive),D.emissiveIntensity=0)}}P&&(b.userData._needsFadeBack=!1)}}}if(r.userData.type==="mushroom"){const f=r.userData.noteBuffer||[],y=Ev(f),x=Ne.reactivity?.mushroom||{},b=x.scale||1,w=Math.min(x.maxAmplitude??1,Math.max(x.minThreshold??.01,y*b)),_=r.userData.wobbleCurrent||0,T=Math.min(.25,(x.smoothingRate||8)*.02);r.userData.wobbleCurrent=Pe.lerp(_,w,T)}if(i&&!(r.userData.type==="flower"&&r.userData.animationType==="glowPulse")){const b=Math.sin(t*.5+n)*.02;r.rotation.z=b,r.rotation.x=b*.5;return}let c=0,l=0,u=0,p=0;e&&(c=e.kickTrigger||0,l=e.grooveAmount||0,u=e.beatPhase||0,p=e.channelData?.[2]?.volume||0);const h=!s,d=h?1+l*5:.2,g=t+u;if(!(o&&["sway","bounce","hop","gentleSway","wobble"].includes(o)&&v9.queue(r,o,d,g,c))){if(o==="speakerPulse"){r.position.y=(r.userData.originalY||0)+Math.sin(t+n)*.2;const f=c*.5,y=r.children[0];if(y&&(y.scale.set(1+f*.2,1-f*.5,1+f*.2),h&&y.userData.ringMaterial)){const x=y.userData.ringMaterial,b=f*5;x.emissive?.setHSL(0+f*.21,1,.5),x.emissiveIntensity=b}}else if(o==="arpeggioUnfurl")FM(r,t,e);else if(o==="snareSnap"){let f=0;e&&e.channelData&&e.channelData[1]&&(f=e.channelData[1].trigger||0);const y=r.userData.leftJaw,x=r.userData.rightJaw;if(y&&x){f>.2?r.userData.snapState=1:r.userData.snapState=Math.max(0,(r.userData.snapState||0)-.1);const b=r.userData.snapState||0;y.rotation.x=Pe.lerp(-.5,0,b),x.rotation.x=Pe.lerp(.5+Math.PI,Math.PI,b)}}else if(o==="accordionStretch"){const f=r.userData.trunk;if(f){const y=1+Math.max(0,Math.sin(g*10+n))*.31*d;f.scale.y=y;const x=1/Math.sqrt(y);f.scale.x=x,f.scale.z=x}}else if(o==="fiberWhip"){r.rotation.y=Math.sin(t*.5+n)*.111;const f=p*2;r.children.forEach((y,x)=>{if(y===r.children[0])return;const b=x*.51,w=y.children[0];let _=Math.PI/4+Math.sin(t*2+b)*.13;if(h){_+=Math.sin(t*10+b)*f;const T=w.children[0];T&&(T.visible=Math.random()<.5+f)}w&&(w.rotation.z=_)})}else if(o==="bounce"){const f=r.userData.originalY??r.position.y;r.userData.originalY=f,r.position.y=f+Math.sin(g*3+n)*.12*d,h&&c>.12&&(r.position.y+=c*.21)}else if(o==="sway")r.rotation.z=Math.sin(t+n)*.11*d;else if(o==="wobble"){const f=r.userData.wobbleCurrent||0;r.rotation.x=Math.sin(g*3+n)*.15*d*(1+f),r.rotation.z=Math.cos(g*3+n)*.16*d*(1+f)}else if(o==="accordion"){const f=r.userData.trunk||r,y=1+Math.max(0,Math.sin(g*10+n))*.3*d;if(f.scale.y=y,r.userData.trunk){const x=1/Math.sqrt(y);f.scale.x=x,f.scale.z=x}}else if(o==="hop"){const f=r.userData.originalY??r.position.y;r.userData.originalY=f;const y=g*4+n,x=Math.max(0,Math.sin(y))*.3*d;r.position.y=f+x,h&&c>.1&&(r.position.y+=c*.15)}else if(o==="shiver"){const f=Math.sin(g*20+n)*.05*d;r.rotation.z=f,r.rotation.x=f*.5}else if(o==="spring"){const f=g*5+n;r.scale.y=1+Math.sin(f)*.1*d,r.scale.x=1-Math.sin(f)*.05*d,r.scale.z=1-Math.sin(f)*.05*d}else if(o==="gentleSway")r.rotation.z=Math.sin(t*.5+n)*.05*d;else if(o==="vineSway")r.rotation.z=Math.sin(t*1.5+n)*.2*d,r.rotation.x=Math.cos(t*1.2+n)*.1*d;else if(o==="spiralWave")r.children.forEach((f,y)=>{f.rotation.y=Math.sin(t*2+n+y*.5)*.3*d});else if(o==="float"){const f=r.userData.originalY??r.position.y;r.userData.originalY=f,r.position.y=f+Math.sin(t*2+n)*.5*d}else if(o==="spin")r.rotation.y+=.01*d;else if(o==="glowPulse"){const f=r.userData.originalY??r.position.y;r.userData.originalY=f,r.position.y=f+Math.sin(t*2+n)*.1}else if(o==="rain"){const f=r.children.find(x=>x.type==="Points");if(f&&f.geometry&&f.geometry.attributes.position){const x=f.geometry.attributes.position.array;for(let b=0;b<x.length;b+=3)x[b+1]-=.1,x[b+1]<-6&&(x[b+1]=0);f.geometry.attributes.position.needsUpdate=!0}const y=r.userData.originalY??r.position.y;r.userData.originalY=y,r.position.y=y+Math.sin(t*.3+n)*.2}else if(o==="cloudBob"){const f=r.userData.originalY??r.position.y;r.userData.originalY=f,r.position.y=f+Math.sin(t*.5+n)*.3,r.rotation.y=Math.sin(t*.2+n*.5)*.05}else if(o==="vibratoShake"){const f=r.userData.headGroup;if(f){let y=0;if(e&&e.channelData)for(const w of e.channelData)w.activeEffect===1&&(y=Math.max(y,w.effectValue||0));y=Math.max(y,l*.5);const x=50+y*100,b=.05+y*.25;f.children.forEach((w,_)=>{if(_===0)return;const T=w.userData.vibratoPhase||_*.5;w.rotation.x=-Math.PI/2+Math.sin(t*x+T)*b,w.rotation.y=Math.cos(t*x*1.3+T)*b*.8;const M=1+Math.random()*y*.2;w.scale.setScalar(M)}),f.rotation.z=Math.sin(t*15+n)*.1*d}}else if(o==="tremeloPulse"){const f=r.userData.headGroup,y=r.userData.bellMaterial,x=r.userData.vortex;let b=0;if(e&&e.channelData)for(const w of e.channelData)w.activeEffect===3&&(b=Math.max(b,w.effectValue||0));if(b=Math.max(b,Math.sin(u*Math.PI*2)*.3),f){const w=8+b*15,_=.1+b*.3,T=1+Math.sin(t*w+n)*_;f.scale.set(T,T,T),y&&(y.opacity=.7+Math.sin(t*w+n)*.2*d,y.emissiveIntensity=.3+b*.7),x&&(x.scale.setScalar(1-Math.sin(t*w+n)*.4),x.material.opacity=.3+Math.sin(t*w+n+Math.PI)*.4)}r.rotation.z=Math.sin(t+n)*.03*d}else if(o==="cymbalShake"){const f=r.children[1];if(f){let y=0;if(e&&e.channelData){const x=e.channelData[3]?.volume||0,b=e.channelData[4]?.volume||0;y=Math.max(x,b)}if(y>.05){const x=y*.2;f.rotation.z=(Math.random()-.5)*x,f.rotation.x=(Math.random()-.5)*x,f.children.forEach(b=>{b.rotation.z+=(Math.random()-.5)*x*2,b.rotation.z*=.8})}else f.rotation.z*=.9,f.rotation.x*=.9;if(y>.4){const x=1+(y-.4)*.5;f.scale.set(x,x,x)}else f.scale.lerp(new v(1,1,1),.1)}}else if(o==="geyserErupt"){const f=r.userData.plume,y=r.userData.plumeLight,x=r.userData.coreMaterial,b=r.userData.maxHeight||5,w=.3;let _=r.userData.eruptionStrength||0;if(c>w?_=Math.min(1,_+c*.5):_=Math.max(0,_-.03),r.userData.eruptionStrength=_,f){if(f.visible=_>.05,f.visible&&f.geometry.attributes.position){const T=f.geometry.attributes.position.array,M=f.geometry.attributes.velocity.array,A=b*_;for(let C=0;C<T.length/3;C++){const P=C*3,D=M[C];T[P+1]+=D*_*.3;const V=T[P+1]/A;T[P]+=(Math.random()-.5)*.02*V,T[P+2]+=(Math.random()-.5)*.02*V,(T[P+1]>A||T[P+1]<0)&&(T[P]=(Math.random()-.5)*.2,T[P+1]=0,T[P+2]=(Math.random()-.5)*.2)}f.geometry.attributes.position.needsUpdate=!0}f.material.opacity!==void 0&&(f.material.opacity=.5+_*.5)}y&&(y.intensity=_*2,y.position.y=1+_*b*.3),x&&(x.emissiveIntensity=.3+_*1.5+Math.sin(t*20)*.2*_)}}}const M9=ye(Tt(8308963)),A9=ye(Tt(16762323)),Cu=ye(Tt(16770508)),N9=ye(.3),C9=ye(0);function LM(){const r=new Et(1e3,32,24),t=Dt(40),e=Dt(.6),s=d9.add(t).normalize().y,i=s.max(0).pow(e),o=Me(0,.15,s).mul(Me(.4,.15,s)).mul(N9),a=xs(Cu,A9,Me(0,.3,i)),c=xs(a,M9,Me(.2,1,i)),u=xs(c,Cu,o).mul(Dt(1).sub(C9)),p=new Yp;return p.colorNode=u,p.side=je,new O(r,p)}const ra=ye(0),x1=ye(Tt(16777215)),Ru=ye(0);function UM(r=1500){const t=new It,e=new Float32Array(r*3),s=new Float32Array(r),i=new Float32Array(r),n=new Float32Array(r*3),o=new Float32Array(r*3),a=400;for(let D=0;D<r;D++){const V=Math.random(),$=Math.random(),Y=2*Math.PI*V,tt=Math.acos(2*$-1),ot=a*(.9+Math.random()*.2),Nt=ot*Math.sin(tt)*Math.cos(Y),de=ot*Math.sin(tt)*Math.sin(Y),ut=ot*Math.cos(tt);e[D*3]=Nt,e[D*3+1]=Math.abs(de),e[D*3+2]=ut,o[D*3]=0,o[D*3+1]=1,o[D*3+2]=0,s[D]=Math.random()*2.5+.3,i[D]=Math.random()*100;const gt=Math.random();gt<.7?(n[D*3]=1,n[D*3+1]=1,n[D*3+2]=1):gt<.85?(n[D*3]=.8,n[D*3+1]=.9,n[D*3+2]=1):(n[D*3]=1,n[D*3+1]=.9,n[D*3+2]=.7)}t.setAttribute("position",new lt(e,3)),t.setAttribute("normal",new lt(o,3)),t.setAttribute("size",new lt(s,1)),t.setAttribute("offset",new lt(i,1)),t.setAttribute("starColor",new lt(n,3));const c=new Kp({size:1.5,transparent:!0,opacity:0,blending:pe,depthWrite:!1,fog:!1}),l=oa("offset","float"),u=oa("size","float"),p=oa("starColor","vec3"),h=We.add(l).sin().mul(.3).add(.5),d=We.mul(2.3).add(l.mul(.7)).sin().mul(.2).add(.5),f=h.mul(d).add(ra.mul(.5)),y=ue(p.x,p.y,p.z),x=ue(x1.r,x1.g,x1.b),b=xs(y,x,ra.mul(.6));c.colorNode=g9(b,Ru).mul(c.color),c.sizeNode=u.mul(f.max(.3));const w=Zs,_=ra.mul(30),T=w.add(w.normalize().mul(_)),M=We.mul(.05),A=T.x.mul(er(M)).sub(T.z.mul(me(M))),C=T.x.mul(me(M)).add(T.z.mul(er(M)));c.positionNode=ue(A,T.y,C);const P=new un(t,c);return P.userData.isStars=!0,P}const Gr={blinkDuration:.2,danceAmplitude:.5,danceSpeed:2};function zM(){const r=new K;r.name="Moon";const t=new Et(15,32,32),e=new Qe({roughness:.8,metalness:.1}),s=Tt(14544639),i=ye(0);e.uBlink=i;const n=i.mul(2);e.colorNode=s,e.emissiveNode=Tt(16777215).mul(n);const o=new O(t,e);o.castShadow=!0,r.add(o);const a=new K;a.position.z=14.5;const c=new Et(1.5,16,16),l=new Is({color:1118481,roughness:.2}),u=new O(c,l);u.position.set(-4,3,0),u.scale.z=.5;const p=new O(c,l);p.position.set(4,3,0),p.scale.z=.5,r.userData.eyes=[u,p];const h=new Pi(3,.5,8,16,Math.PI),d=new Is({color:1118481,roughness:.5}),g=new O(h,d);return g.rotation.z=Math.PI,g.position.set(0,-2,0),a.add(u,p,g),a.lookAt(0,0,100),r.add(a),r.userData.isMoon=!0,r.userData.originalPosition=new v,r.userData.velocity=new v,r.userData.blinkTimer=0,r.userData.type="moon",r.userData.reactivityType="sky",Wt(r)}function VM(r,t,e){if(!r||!r.userData.isMoon)return;const s=performance.now()*.001,i=e?.beatPhase||0,n=e?.grooveAmount||0,o=Math.sin(s*Gr.danceSpeed)*Gr.danceAmplitude,a=Math.max(0,Math.sin(i*Math.PI*2))*n*2,c=r.children[0];if(c&&(c.position.y=o+a,c.rotation.z=Math.sin(s)*.05),r.userData.blinkTimer>0){if(r.userData.blinkTimer-=t,c.material.uBlink){const u=1-r.userData.blinkTimer/Gr.blinkDuration,p=Math.sin(u*Math.PI);c.material.uBlink.value=p}const l=r.userData.eyes;l&&l.forEach(u=>u.scale.y=.1+(1-Math.sin(Math.PI*(1-r.userData.blinkTimer/Gr.blinkDuration)))*.9)}else{const l=r.userData.eyes;l&&l.forEach(u=>u.scale.y=1),c.material.uBlink&&(c.material.uBlink.value=0),Math.random()<.005&&Fu(r),r.userData.flashIntensity>.1&&(Fu(r),r.userData.flashIntensity=0)}}function Fu(r){r.userData.blinkTimer=Gr.blinkDuration}const Eu=ye(0),Z0=ye(Tt(65433)),kM=ye(.2);function OM(){const r=new Le(800,800,400,64,16,!0);r.translate(0,300,0);const t=ol(()=>{const i=sr(),n=We.mul(kM),o=me(i.x.mul(20).add(n)).mul(.1),a=me(i.x.mul(45).sub(n.mul(1.5))).mul(.05),c=i.x.add(o).add(a),l=me(c.mul(60)).mul(.5).add(.5),u=Me(0,.2,i.y).mul(Me(1,.6,i.y)),p=ue(i.y.mul(.5),0,i.y.mul(.2).negate()),d=ue(Z0.r,Z0.g,Z0.b).add(p),g=l.mul(u).mul(Eu).mul(.6);return g9(d,g)}),e=new Yp;e.colorNode=t(),e.transparent=!0,e.blending=pe,e.side=se,e.depthWrite=!1,e.fog=!1;const s=new O(r,e);return s.userData.type="aurora",s.userData.isAurora=!0,s.frustumCulled=!1,s}function R9(r={}){const{color:t=65416,scale:e=1}=r,s=new K,i=new mn(.2*e,.5*e,6),n=Rt(3050327),o=new O(i,n);o.position.y=.25*e,s.add(o);const a=5,c=8,l=Ga(t);jt(l),s.userData.fronds=[];for(let u=0;u<a;u++){const p=new K;p.rotation.y=u/a*Math.PI*2,p.position.y=.4*e;const h=[];let d=p;for(let g=0;g<c;g++){const f=new to(.1*e,.3*e,.02*e);f.scale(1-g/c*.8,1,1),f.translate(0,.15*e,0);const y=new O(f,l),x=new K;x.position.y=g===0?0:.28*e;const b=-.5;x.rotation.x=b,x.add(y),d.add(x),d=x,h.push({pivot:x,initialCurl:b})}s.add(p),s.userData.fronds.push(h)}return s.userData.animationType="arpeggioUnfurl",s.userData.type="fern",Wt(s)}function GM(r={}){const{color:t=13467442,height:e=4}=r,s=new K,i=6,n=e/i,o=Rt(9127187),a=Ga(3050327);let c=s;for(let l=0;l<i;l++){const u=new K;u.position.y=l===0?0:n;const p=.4*(1-l/i)+.1,h=.4*(1-(l+1)/i)+.1,d=new Le(h,p,n,8);d.translate(0,n/2,0);const g=new O(d,o);if(l>1)for(let y=0;y<8;y++){const x=new O(new mn(.1,.6,4),a);x.position.y=n*.5,x.rotation.y=y/8*Math.PI*2,x.rotation.z=1.5,x.position.x=p,g.add(x)}u.add(g),c.add(u),c=u,s.userData.segments||(s.userData.segments=[]),s.userData.segments.push(u)}return s.userData.animationType="portamentoBend",s.userData.type="tree",s}function F9(r={}){const{scale:t=1}=r,e=new K,s=new O(new Le(.02*t,.02*t,1.5*t),Rt(5597999));s.position.y=.75*t,e.add(s);const i=new K;i.position.y=1.5*t,e.add(i);const n=24,o=new Le(.01,.01,.4*t);o.translate(0,.2*t,0);const a=new Et(.04*t),c=Ga(16766720);jt(c);for(let l=0;l<n;l++){const u=new K,p=Math.acos(-1+2*l/n),h=Math.sqrt(n*Math.PI)*p;u.rotation.setFromVector3(new v(Math.sin(p)*Math.cos(h),Math.sin(p)*Math.sin(h),Math.cos(p)).normalize().multiplyScalar(1.5)),u.lookAt(u.position.clone().add(new v(0,1,0)));const d=new O(o,Rt(16777215)),g=new O(a,c);g.position.y=.4*t,d.add(g),i.add(d),d.quaternion.setFromUnitVectors(new v(0,1,0),new v(Math.sin(p)*Math.cos(h),Math.cos(p),Math.sin(p)*Math.sin(h)))}return e.userData.animationType="cymbalShake",e.userData.type="flower",Wt(e)}function E9(r={}){const{color:t=16729344,scale:e=1}=r,s=new K,i=new O(new Le(.4,.5,.2),Rt(3026478));s.add(i);const n=Ga(t);jt(n);const o=Rt(16777215),a=new K,c=new K,l=new Pi(.5*e,.1*e,8,16,Math.PI),u=new O(l,n);u.rotation.x=Math.PI/2,a.add(u);const p=new O(l,n);p.rotation.x=Math.PI/2,c.add(p);for(let h=0;h<5;h++){const d=new O(new mn(.05,.2),o);d.position.set((h-2)*.2,0,.1),d.rotation.x=-1,a.add(d);const g=d.clone();g.rotation.x=1,g.position.z=-.1,c.add(g)}return a.position.set(0,.2,-.2),c.position.set(0,.2,.2),a.rotation.x=-.5,c.rotation.x=.5+Math.PI,s.add(a),s.add(c),s.userData.leftJaw=a,s.userData.rightJaw=c,s.userData.animationType="snareSnap",s.userData.type="trap",Wt(s)}class WM{constructor(){this.systems=new Map,this.dummy=new Yt,this._position=new v,this._quaternion=new pr,this._scale=new v,this.instanceColors=null}register(t,e,s){!e||!s||s.length===0||(console.log(`[MusicalFlora] Registering system: ${t} (${s.length} items)`),T9(s),this.systems.set(t,{mesh:e,data:s,count:s.length}))}update(t,e,s){const i=s?.kickTrigger||0,n=s?.energy||0;for(const[o,a]of this.systems)this.animateSystem(a,t,n,i)}animateSystem(t,e,s,i){const{mesh:n,count:o,data:a}=t,c=SM(e,s,i,o);if(c){for(let l=0;l<o;l++){const u=a[l],p=l*4,h=c[p],d=c[p+1],g=c[p+2];this._position.set(u.x,u.y+h,u.z),this._quaternion.setFromEuler(new hs(d,0,g));const f=1+i*.2*s,y=1+h*.5,x=u.scale||1;this._scale.set(x*f,x*y,x*f),this.dummy.position.copy(this._position),this.dummy.quaternion.copy(this._quaternion),this.dummy.scale.copy(this._scale),this.dummy.updateMatrix(),n.setMatrixAt(l,this.dummy.matrix)}n.instanceMatrix.needsUpdate=!0}}}new WM;function b1(r){const t=Math.acos(Math.random()*2-1),e=Math.random()*Math.PI*2,s=r*Math.sin(t)*Math.cos(e),i=Math.abs(r*Math.cos(t)),n=r*Math.sin(t)*Math.sin(e);return new v(s,Math.max(100,i),n)}function $M(){const r=new K,t=new Et(4,16,16),e=new Ds({color:11206655}),s=new O(t,e);r.add(s);const i=new Et(8,16,16),n=new Ds({color:65535,transparent:!0,opacity:.3,blending:pe,side:je}),o=new O(i,n);return r.add(o),r.userData.type="pulsar",r.userData.reactivityType="sky",r.userData.minLight=0,r.userData.maxLight=1,Wt(r)}function HM(){const r=new K,t=new da(15,2),e=new Is({color:16729156,flatShading:!0,roughness:.8}),s=new O(t,e);r.add(s);const i=new Na(20,35,32),n=new Ds({color:16755336,side:se,transparent:!0,opacity:.6}),o=new O(i,n);return o.rotation.x=Math.PI/2.5,r.add(o),r.userData.type="planet",r.userData.reactivityType="flora",r.userData.reactivityId=0,Wt(r)}function qM(){const t=new It,e=new Float32Array(1e3*3),s=new Float32Array(1e3*3),i=new Float32Array(1e3),n=new W(16736304),o=new W(1784196);for(let u=0;u<1e3;u++){const p=Math.random()*40,h=p*.5,d=u%3*(Math.PI*2/3),g=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),f=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),y=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),x=Math.cos(h+d)*p+g,b=Math.random()*2+f,w=Math.sin(h+d)*p+y;e[u*3]=x,e[u*3+1]=b,e[u*3+2]=w;const _=n.clone();_.lerp(o,p/40),s[u*3]=_.r,s[u*3+1]=_.g,s[u*3+2]=_.b,i[u]=Math.random()*2}t.setAttribute("position",new lt(e,3));const a=new Float32Array(1e3*3);for(let u=0;u<1e3*3;u+=3)a[u]=0,a[u+1]=1,a[u+2]=0;t.setAttribute("normal",new lt(a,3)),t.setAttribute("color",new lt(s,3)),t.setAttribute("size",new lt(i,1));const c=new ln({size:.8,vertexColors:!0,blending:pe,depthWrite:!1,transparent:!0}),l=new un(t,c);return l.userData.type="galaxy",l.userData.reactivityType="flora",l.userData.baseRotationSpeed=5e-4,Wt(l)}function YM(r){const t=[],e=qM();e.position.copy(b1(900)),e.lookAt(0,0,0),r.add(e),t.push(e);for(let i=0;i<2;i++){const n=$M();n.position.copy(b1(950)),r.add(n),t.push(n)}const s=HM();return s.position.copy(b1(800)),r.add(s),t.push(s),t}const w1=new Xu,_3=new pt,_1=new Qn,XM=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],T1={},E0={};function jM(r,t="global"){let e="";if(typeof r=="number"){const i=r%12;e=XM[i]}else typeof r=="string"&&(E0[r]?e=E0[r]:(e=r.replace(/[0-9-]/g,""),Object.keys(E0).length<200&&(E0[r]=e)));let s=Ne.noteColorMap[t];if(!s)if(T1[t])s=T1[t];else{const i=(t||"").toLowerCase();i.includes("flower")||i.includes("tulip")||i.includes("violet")||i.includes("rose")||i.includes("bloom")||i.includes("lotus")||i.includes("puff")?s=Ne.noteColorMap.flower:i.includes("mushroom")||i.includes("mush")?s=Ne.noteColorMap.mushroom:i.includes("tree")||i.includes("willow")||i.includes("palm")||i.includes("bush")?s=Ne.noteColorMap.tree:i.includes("cloud")||i.includes("orb")||i.includes("geyser")||i.includes("moon")?s=Ne.noteColorMap.cloud||Ne.noteColorMap.global:s=Ne.noteColorMap.global,T1[t]=s}return s[e]||16777215}class ZM{constructor(t,e={}){this.scene=t,this.config=e,this.updateStartIndex=0,this._lastCameraVersion=-1}getUpdateStartIndex(){return this.updateStartIndex}reactObject(t,e,s){if(!t.userData.type)return;const i=t.userData.type;if(typeof t.reactToNote=="function"){const n=jM(e,i);t.reactToNote(e,n,s)}if(t.userData.type==="pulsar"){const n=1+s*.5;t.scale.setScalar(n),t.children[1]&&(t.children[1].material.opacity=.3+s*.7)}else if(t.userData.type==="planet"){const n=1+s*.1;t.scale.setScalar(n),t.children[1]&&(t.children[1].rotation.z+=s*.1)}else t.userData.type==="galaxy"&&(t.rotation.y-=t.userData.baseRotationSpeed+s*.02)}isObjectActive(t){return t.visible}update(t,e,s,i,n,o,a,c){if(e&&e.channelData&&o&&c){for(const Nt of e.channelData)if(Nt.trigger>.5&&Nt.instrument===2){Fu(c);break}}const l=s&&typeof s.getGlobalLightLevel=="function"?s.currentLightLevel:1,u=n.matrixWorldAutoUpdate?n.matrixWorld.elements[0]:this._lastCameraVersion;u!==this._lastCameraVersion&&(_3.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),w1.setFromProjectionMatrix(_3),this._lastCameraVersion=u);const p=n.position,h=p.x,d=p.y,g=p.z,f=30,y=f*f,x=2,b=typeof performance<"u"?performance.now():Date.now();let w=0;const _=100,T=20,M=e&&e.channelData?e.channelData:null,A=M?M.length:0,C=Math.ceil(A/2),P=i.length,D=this.updateStartIndex;let V=0;for(let Nt=0;Nt<P;Nt++){const de=(D+Nt)%P,ut=i[de],gt=ut.position.x-h,Bt=ut.position.y-d,Ot=ut.position.z-g;if(gt*gt+Bt*Bt+Ot*Ot>y)continue;let $e=!1;if(ut.geometry&&ut.geometry.boundingSphere?$e=w1.intersectsObject(ut):(_1.center.copy(ut.position),_1.radius=ut.userData.radius||5,$e=w1.intersectsSphere(_1)),!$e)continue;if(V%T===0&&typeof performance<"u"&&performance.now()-b>x||w>=_)break;if(V++,ut.userData.animationType==="wobble"&&(ut.userData.animationOffset+=.05),IM(ut,t,e,!o,a),w++,M){const li=ut.userData.minLight!==void 0?ut.userData.minLight:0,yr=ut.userData.maxLight!==void 0?ut.userData.maxLight:1,lo=.1,uo=(l-li)/lo,Ts=(yr-l)/lo,x2=Math.min(Math.max(uo,0),Math.max(Ts,0),1);if(x2>0){const G9=ut.userData.reactivityType||"flora",b2=ut.userData.reactivityId||0;let po=0;if(G9==="sky"){const Vs=A-C;Vs>0?po=C+b2%Vs:po=A-1}else{const Vs=C;Vs>0?po=b2%Vs:po=0}if(po<A){const Vs=M[po];Vs&&Vs.trigger>.1&&this.reactObject(ut,Vs.note,Vs.trigger*x2)}}}}let $=0;e&&($=e.kickTrigger||0);const Y=e&&e.beatPhase?e.beatPhase:0;v9.flush(t+Y,$);const tt=Math.min(10,P),ot=Math.max(V,tt);this.updateStartIndex=(D+ot)%P,typeof window<"u"&&window.updatePerfStats&&window.updatePerfStats(P,V,w)}applyReaction(t,e,s){this.reactObject(t,e,s)}}const KM=44100,JM=(r,t,e)=>r+(t-r)*e,S1=(r,t,e,s)=>JM(r,t,1-Math.exp(-e*s)),QM=r=>{if(!r)return 0;const t=r.toUpperCase(),e={C:0,"C#":1,DB:1,D:2,"D#":3,EB:3,E:4,F:5,"F#":6,GB:6,G:7,"G#":8,AB:8,A:9,"A#":10,BB:10,B:11},s=t.match(/^([A-G](?:#|B)?)\-?(\d)$/);if(!s)return 0;const i=e[s[1]]??0,n=(parseInt(s[2],10)+1)*12+i;return 440*Math.pow(2,(n-69)/12)};class tA{constructor(){this.libopenmpt=null,this.currentModulePtr=0,this.audioContext=null,this.scriptNode=null,this.stereoPanner=null,this.gainNode=null,this.leftBufferPtr=0,this.rightBufferPtr=0,this.moduleInfo={title:"...",order:0,row:0,bpm:0,numChannels:0},this.patternMatrices={},this.isPlaying=!1,this.isReady=!1,this.volume=1,this.playlist=[],this.currentIndex=-1,this.onPlaylistUpdate=null,this.onTrackChange=null,this.visualState={beatPhase:0,kickTrigger:0,grooveAmount:0,activeChannels:0,channelData:[],bpm:120},this.init()}async init(){window.setLoadingStatus&&window.setLoadingStatus("Starting Audio System...");try{const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t;const s=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"js/audio-processor.js";console.log(`[AudioSystem] Attempting to load Worklet from: ${s}`);try{const i=await fetch(s,{cache:"no-store"});if(!i.ok)throw console.error(`[AudioSystem] Worklet fetch failed with status=${i.status} for ${s}`),new Error(`Worklet fetch failed: ${i.status}`);const n=i.headers.get("content-type")||"";let o=await i.text();const a=o.trim().startsWith("<");if(o.trim().length<20||a){console.warn(`[AudioSystem] Worklet content at ${s} looks suspicious (length=${o.length}, looksLikeHTML=${a}). Trying root '/js/audio-processor.js' as a fallback.`);try{const u=await fetch("/js/audio-processor.js",{cache:"no-store"});if(u.ok){const p=u.headers.get("content-type")||"",h=await u.text();h.trim().length>20&&(/javascript|ecmascript|module/.test(p)||/\b(import|registerProcessor|class)\b/.test(h.slice(0,200)))?(console.log("[AudioSystem] Fallback /js/audio-processor.js looks like valid JS. Using it."),o=h):console.warn("[AudioSystem] Fallback /js/audio-processor.js did not contain valid JS.")}else console.warn(`[AudioSystem] Fallback fetch failed with status=${u.status}`)}catch(u){console.warn("[AudioSystem] Fallback fetch for /js/audio-processor.js failed",u)}if(o.trim().length<20||o.trim().startsWith("<"))throw console.error(`[AudioSystem] Worklet content is invalid after fallback. First chars: ${o.slice(0,160)}`),new Error("Worklet content invalid or HTML fallback")}!/javascript|ecmascript|module/.test(n)&&!/\b(import|registerProcessor|class)\b/.test(o.slice(0,200))&&console.warn(`[AudioSystem] Worklet content-type="${n}" and file does not look like JS. First chars: ${o.slice(0,120)}`);let c=o;try{const u=p=>{if(/^[a-zA-Z][a-zA-Z0-9+-.]*:\/\//.test(p)||p.startsWith("//")||!p.startsWith(".")&&!p.startsWith("/"))return p;try{return new URL(p,s).href}catch{return p}};c=c.replace(/(from\s+)(['"])([^'"\n]+)\2/g,(p,h,d,g)=>{const f=u(g);return`${h}${d}${f}${d}`}),c=c.replace(/(import\s+)(['"])([^'"\n]+)\2/g,(p,h,d,g)=>{const f=u(g);return`${h}${d}${f}${d}`}),c=c.replace(/(import\()(['"])([^'"\n]+)\2(\))/g,(p,h,d,g,f)=>{const y=u(g);return`${h}${d}${y}${d}${f}`}),c!==o&&console.log("[AudioSystem] Rewrote import specifiers in worklet to absolute URLs to avoid blob-relative resolution issues.")}catch(u){console.warn("[AudioSystem] Failed to rewrite import specifiers, proceeding with original text",u)}const l=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));try{await this.audioContext.audioWorklet.addModule(l),window.setLoadingStatus&&window.setLoadingStatus("Audio Worklet Ready..."),URL.revokeObjectURL(l)}catch(u){throw console.error(`[AudioSystem] addModule failed for blob derived from ${s}`),u}}catch(i){throw console.error(`[AudioSystem] Failed to load worklet at ${s}. Check the Network tab in DevTools for 404s or HTML responses.`),i}this.workletNode=new AudioWorkletNode(this.audioContext,"chiptune-processor"),this.workletNode.port.onmessage=i=>{const{type:n,data:o}=i.data||{};n==="VISUAL_UPDATE"?this.handleVisualUpdate(o):n==="SONG_END"?(console.log("AudioSystem: Song finished (Worklet)."),this.playNext()):n==="READY"&&(this.isReady=!0,console.log("AudioSystem: Worklet Ready."),this.playlist.length>0&&this.currentIndex===-1&&this.playNext(0))},this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.volume,this.workletNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)}catch(t){console.error("AudioSystem Init Failed:",t)}}async addToQueue(t){if(!this.isReady)return;const e=this.playlist.length;for(let s=0;s<t.length;s++)this.playlist.push(t[s]),console.log(`Added to queue: ${t[s].name}`);this.onPlaylistUpdate&&this.onPlaylistUpdate(this.playlist),(this.currentIndex===-1||!this.isPlaying)&&this.playNext(e)}async playNext(t=null){if(this.playlist.length===0)return;let e=t!==null?t:this.currentIndex+1;e>=this.playlist.length&&(console.log("Playlist finished. Looping to start."),e=0),this.currentIndex=e,this.onTrackChange&&this.onTrackChange(this.currentIndex);const s=this.playlist[this.currentIndex];console.log(`Loading track ${this.currentIndex+1}/${this.playlist.length}: ${s.name}`),await this.loadModule(s)}playAtIndex(t){t>=0&&t<this.playlist.length&&this.playNext(t)}getPlaylist(){return this.playlist}getCurrentIndex(){return this.currentIndex}async loadModule(t){this.audioContext&&this.audioContext.state==="suspended"&&await this.audioContext.resume();try{const e=await t.arrayBuffer();if(this.workletNode&&this.workletNode.port)try{this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name},[e])}catch{this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name})}else console.warn("Worklet not ready to receive LOAD message. Attempting to init worklet and retry."),await this.init(),this.workletNode&&this.workletNode.port&&this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name},[e]);await this.play()}catch(e){console.error("Error loading file:",e),this.playNext()}}processModuleData(t,e){if(this.libopenmpt){this.stop(!1),this.currentModulePtr!==0&&(this.libopenmpt._openmpt_module_destroy(this.currentModulePtr),this.currentModulePtr=0);try{const s=this.libopenmpt,i=s._malloc(t.length);s.HEAPU8.set(t,i);const n=s._openmpt_module_create_from_memory2(i,t.length,0,0,0,0,0,0,0);if(s._free(i),n===0)throw new Error(`Failed to load module "${e}".`);this.currentModulePtr=n;const o=s.stringToUTF8("title"),a=s._openmpt_module_get_metadata(n,o),c=s.UTF8ToString(a)||e;s._free(o),s._openmpt_free_string(a),this.moduleInfo.title=c,this.preCachePatternData(n),this.play()}catch(s){console.error("Failed to load module:",s),this.playNext()}}}preCachePatternData(t){const e=this.libopenmpt;this.patternMatrices={};try{const s=e._openmpt_module_get_num_orders(t),i=e._openmpt_module_get_num_channels(t);this.moduleInfo.numChannels=i;for(let n=0;n<s;n++){const o=e._openmpt_module_get_order_pattern(t,n);if(o>=e._openmpt_module_get_num_patterns(t))continue;const a=e._openmpt_module_get_pattern_num_rows(t,o),c=[];for(let l=0;l<a;l++){const u=[];for(let p=0;p<i;p++){const h=e._openmpt_module_format_pattern_row_channel(t,o,l,p,12,1),d=e.UTF8ToString(h);e._openmpt_free_string(h),u.push({text:(d||"").trim()})}c.push(u)}this.patternMatrices[n]={rows:c,numRows:a,numChannels:i}}}catch(s){console.error("Pattern caching error:",s)}}async play(){if(!this.isPlaying){if(!this.audioContext){const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t({sampleRate:KM})}if(this.audioContext.state==="suspended"&&await this.audioContext.resume(),!this.workletNode)try{await this.init()}catch(t){console.warn("Worklet init failed in play()",t)}this.isPlaying=!0}}stop(t=!0){try{this.workletNode&&this.workletNode.port&&this.workletNode.port.postMessage({type:"STOP"})}catch(e){console.warn("Failed to signal STOP to worklet",e)}try{if(this.workletNode){try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.gainNode){try{this.gainNode.disconnect()}catch{}this.gainNode=null}}catch(e){console.warn("Error disconnecting audio nodes:",e)}if(this.libopenmpt)try{this.leftBufferPtr&&(this.libopenmpt._free(this.leftBufferPtr),this.leftBufferPtr=0),this.rightBufferPtr&&(this.libopenmpt._free(this.rightBufferPtr),this.rightBufferPtr=0)}catch{}this.isPlaying=!1}handleVisualUpdate(t){const{bpm:e,channelData:s,anyTrigger:i}=t;for(this.visualState.bpm=e||120,i&&(this.visualState.kickTrigger=1);this.visualState.channelData.length<s.length;)this.visualState.channelData.push({volume:0,pan:0,trigger:0,note:"",freq:0,instrument:0,activeEffect:0,effectValue:0});for(let n=0;n<s.length;n++){const o=s[n],a=this.visualState.channelData[n];a.volume=o.volume,o.note&&(a.trigger=1,a.note=o.note,a.freq=QM(o.note)),a.instrument=o.instrument,a.activeEffect=o.activeEffect,a.effectValue=o.effectValue}}update(){this.visualState.kickTrigger=S1(this.visualState.kickTrigger,0,8,1/60),this.visualState.grooveAmount=S1(this.visualState.grooveAmount,0,3,1/60),this.visualState.beatPhase=(this.visualState.beatPhase+this.visualState.bpm/60*(1/60))%1;for(const t of this.visualState.channelData)t.trigger=S1(t.trigger,0,10,1/60);return this.visualState}}class eA{constructor(t){this.audio=t,this.lastBeatPhase=0,this.beatCallbacks=[]}onBeat(t){typeof t=="function"&&this.beatCallbacks.push(t)}offBeat(t){const e=this.beatCallbacks.indexOf(t);e>=0&&this.beatCallbacks.splice(e,1)}update(){const t=this.audio.visualState||this.audio.update&&this.audio.update()||{beatPhase:0},e=t&&t.beatPhase?t.beatPhase:0;if(e<this.lastBeatPhase&&this.lastBeatPhase>.8)for(const s of this.beatCallbacks)try{s(t)}catch(i){console.warn("BeatSync callback error",i)}this.lastBeatPhase=e}getState(){return this.audio.visualState}}const Bu=ye(0);function sA(){const e=new Na(80,90,64,1,0,Math.PI),s=new Qe;s.transparent=!0,s.side=se,s.depthWrite=!1,s.blending=pe;const i=Tt(16711680),n=Tt(16753920),o=Tt(16776960),a=Tt(32768),c=Tt(255),l=Tt(4915330),u=Tt(15631086),p=sr().y;let h=xs(i,n,Me(0,.16,p));h=xs(h,o,Me(.16,.33,p)),h=xs(h,a,Me(.33,.5,p)),h=xs(h,c,Me(.5,.66,p)),h=xs(h,l,Me(.66,.83,p)),h=xs(h,u,Me(.83,1,p));const d=Me(0,.2,p).mul(Me(1,.8,p)),g=Me(0,.1,sr().x).mul(Me(1,.9,sr().x)),f=me(We.mul(2)).mul(.1).add(.9);s.colorNode=h,s.opacityNode=Bu.mul(d).mul(g).mul(f),s.emissiveNode=h.mul(.5);const y=new O(e,s);return y.name="Rainbow",y}const Os={skyTop:new W,skyBot:new W,horizon:new W,fog:new W,sun:new W,amb:new W,sunInt:0,ambInt:0,atmosphereIntensity:0};function B0(r,t,e){return Os.skyTop.copy(r.skyTop).lerp(t.skyTop,e),Os.skyBot.copy(r.skyBot).lerp(t.skyBot,e),Os.horizon.copy(r.horizon).lerp(t.horizon,e),Os.fog.copy(r.fog).lerp(t.fog,e),Os.sun.copy(r.sun).lerp(t.sun,e),Os.amb.copy(r.amb).lerp(t.amb,e),Os.sunInt=Pe.lerp(r.sunInt,t.sunInt,e),Os.ambInt=Pe.lerp(r.ambInt,t.ambInt,e),Os.atmosphereIntensity=Pe.lerp(r.atmosphereIntensity,t.atmosphereIntensity,e),Os}function iA(r){const t=r%Es;if(t<Ps)return B0(De.night,De.sunrise,t/Ps);let e=Ps;if(t<e+Zn){const s=t-e;return s<60?B0(De.sunrise,De.day,s/60):De.day}if(e+=Zn,t<e+Ri){const s=t-e;return B0(De.day,De.sunset,s/Ri)}if(e+=Ri,t<e+Tc){const s=t-e;return s<60?B0(De.sunset,De.night,s/60):De.night}return e+=Tc,t<e+Sc||(e+=Sc,t<e+S9),De.night}function B9(r){const t=r%Es,e=Ps,s=Ps+Zn,i=s+Ri;let n=0,o=0;if(t>=e&&t<=s)n=1,o=0;else if(t<e)n=t/Ps,o=1-n;else if(t>s&&t<i){const a=(t-s)/Ri;n=1-a,o=a}else n=0,o=1;return{sunIntensity:n,moonIntensity:o}}const T3=Es*40,S3=Es*8;function nA(r){const t=r%T3/T3;let e="Spring";t>.75?e="Winter":t>.5?e="Autumn":t>.25&&(e="Summer");const s=Math.sin(t*Math.PI*2-Math.PI/2)*.5+.5,i=r%S3/S3,n=1-Math.abs(i-.5)*2;return{season:e,sunInclination:s,moonPhase:n,yearProgress:t}}const mt={CLEAR:"clear",RAIN:"rain",STORM:"storm"},oA=new v(0,1,0),v3=new v,M3=new v,A3=new v,rA=new W(0);class aA{constructor(t){this.scene=t,this.state=mt.CLEAR,this.intensity=0,this.stormCharge=0,this.cloudDensity=1,this.cloudRegenRate=5e-4,this.percussionRain=null,this.melodicMist=null,this.mushroomWaterfalls=new Map,this.lightningLight=null,this.lightningTimer=0,this.lightningActive=!1,this.rainbow=null,this.rainbowTimer=0,this.lastState=mt.CLEAR,this.trackedTrees=[],this.trackedShrubs=[],this.trackedFlowers=[],this.trackedMushrooms=[],this.targetIntensity=0,this.transitionSpeed=.02,this.windDirection=new v(1,0,.3).normalize(),this.windSpeed=0,this.windTargetSpeed=0,this.onSpawnFoliage=null,this._lastSpawnCheck=0,this._spawnCapPerFrame=3,this._spawnThrottle=.5,this._spawnQueue=[],this._spawnThrottle=.5,this._lastSpawnCheck=0,this.fog=t.fog,this.baseFogNear=t.fog?t.fog.near:20,this.baseFogFar=t.fog?t.fog.far:100,this.initParticles(),this.initLightning(),this.initRainbow()}initRainbow(){this.rainbow=sA(),this.rainbow.position.set(0,-20,-100),this.rainbow.scale.setScalar(2),this.scene.add(this.rainbow)}initParticles(){const e=new It,s=new Float32Array(500*3),i=new Float32Array(500*3),n=new Float32Array(500),o=new Float32Array(500);for(let d=0;d<500;d++)s[d*3]=(Math.random()-.5)*100,s[d*3+1]=20+Math.random()*30,s[d*3+2]=(Math.random()-.5)*100,i[d*3]=0,i[d*3+1]=1,i[d*3+2]=0,n[d]=5+Math.random()*5,o[d]=Math.random()*50;e.setAttribute("position",new lt(s,3)),e.setAttribute("normal",new lt(i,3)),e.userData={velocities:n,offsets:o};const a=new ln({color:8965375,size:.3,transparent:!0,opacity:.8,blending:pe});this.percussionRain=new un(e,a),this.percussionRain.visible=!1,this.scene.add(this.percussionRain);const c=300,l=new It,u=new Float32Array(c*3),p=new Float32Array(c*3);for(let d=0;d<c;d++)u[d*3]=(Math.random()-.5)*80,u[d*3+1]=Math.random()*5,u[d*3+2]=(Math.random()-.5)*80,p[d*3]=0,p[d*3+1]=1,p[d*3+2]=0;l.setAttribute("position",new lt(u,3)),l.setAttribute("normal",new lt(p,3));const h=new ln({color:11206570,size:.15,transparent:!0,opacity:.4,blending:pe});this.melodicMist=new un(l,h),this.melodicMist.visible=!1,this.scene.add(this.melodicMist)}registerMushroom(t){t&&(this.trackedMushrooms.includes(t)||this.trackedMushrooms.push(t))}initLightning(){this.lightningLight=new yn(16777215,0,200),this.lightningLight.position.set(0,50,0),this.scene.add(this.lightningLight)}registerTree(t){this.trackedTrees.push(t)}registerShrub(t){this.trackedShrubs.push(t)}registerFlower(t){this.trackedFlowers.push(t)}notifyCloudShot(t){this.cloudDensity=Math.max(.2,this.cloudDensity-.05)}getGlobalLightLevel(t,e){const s=t.sunIntensity*(e?e.sunInclination:1),i=t.moonIntensity*(e?e.moonPhase:1)*.25,n=.05,o=this.cloudDensity,a=(s+i+n)*(1-o*.8);return Math.min(1,a)}update(t,e,s=null){if(!e)return;const i=.016;this.cloudDensity=Math.min(1,this.cloudDensity+this.cloudRegenRate);const n=e.kickTrigger||0,o=e.grooveAmount||0,a=e.channelData||[],c=a[2]?.volume||0,l=B9(t),u=nA(t);if(this.currentSeason=u.season,this.updateWeatherState(n,c,o,s,u),this.lastState===mt.STORM&&this.state!==mt.STORM&&(this.rainbowTimer=45),this.lastState=this.state,this.rainbowTimer>0){this.rainbowTimer-=i;let _=1;this.rainbowTimer>40?_=(45-this.rainbowTimer)/5:this.rainbowTimer<5&&(_=this.rainbowTimer/5),Bu.value=_*.6}else Bu.value=0;this.currentLightLevel=this.getGlobalLightLevel(l,u),this.targetIntensity*=this.cloudDensity;const p=a[3]?.volume||0,h=(c*.5+p*.5)*this.cloudDensity;try{Su.value+=(h-Su.value)*.05}catch{}if(this.state===mt.STORM&&(n>.8||Math.random()<.01)){try{vu.value=1}catch{}const _=Object.keys(Ne.noteColorMap&&Ne.noteColorMap.cloud||{});if(_.length>0){const T=_[Math.floor(Math.random()*_.length)],M=Ne.noteColorMap.cloud[T];try{Or&&Or.value&&Or.value.setHex&&Or.value.setHex(M)}catch{}this.lightningLight.color.setHex(M),this.lightningLight.intensity=10*this.cloudDensity,this.lightningLight.position.set((Math.random()-.5)*100,50,(Math.random()-.5)*100),this.lightningActive=!0}}else{try{vu.value*=.85}catch{}this.lightningActive&&(this.lightningLight.intensity*=.85,this.lightningLight.intensity<.1&&(this.lightningActive=!1))}this.applyDarknessLogic(l,u.moonPhase);const d=l.sunIntensity*(1-this.cloudDensity*.7),g=l.moonIntensity*.3,f=Math.max(0,d+g),y=this.intensity+this.stormCharge*.5;let x=f*(.5+y);y>.9&&(x*=.5);let b=(1-f)*(.2+y*1.5),w=(this.state===mt.STORM?1:0)+(1-f)*.2;this.percussionRain.visible&&(this.trackedTrees.length>0&&zr(this.trackedTrees,x*n*.1),this.trackedFlowers.length>0&&zr(this.trackedFlowers,x*n*.1),this.trackedMushrooms.length>0&&zr(this.trackedMushrooms,b*n*.15)),this.handleSpawning(t,b,w,f),this.updateMushroomWaterfalls(t,n),this.intensity+=(this.targetIntensity-this.intensity)*this.transitionSpeed,this.updatePercussionRain(t,n),this.updateMelodicMist(t,c),this.state===mt.STORM&&(this.updateLightning(t,n),this.chargeBerryGlow(n)),this.state!==mt.CLEAR?this.stormCharge=Math.min(2,this.stormCharge+.001):this.stormCharge=Math.max(0,this.stormCharge-5e-4),this.updateWind(t,e,l),this.updateFog(e)}handleSpawning(t,e,s,i){t-this._lastSpawnCheck<this._spawnThrottle||(this._lastSpawnCheck=t,e>.8&&Math.random()<.4&&this.spawnFoliage("mushroom",!0),s>.6&&Math.random()<.3&&this.spawnFoliage("lantern",!1),i>.7&&e<.3&&Math.random()<.2&&this.spawnFoliage("flower",!1))}spawnFoliage(t,e){if(!this.onSpawnFoliage)return;const s=(Math.random()-.5)*60,i=(Math.random()-.5)*60,n=dn(s,i);let o;if(t==="mushroom")o=Wn({size:"regular",scale:.5+Math.random()*.5,isBioluminescent:e});else if(t==="lantern")o=Xv({height:2+Math.random()*1.5,color:16755200});else if(t==="flower")return;o&&(o.position.set(s,n,i),o.scale.setScalar(.01),this.onSpawnFoliage(o,!0,0),t==="mushroom"&&this.registerMushroom(o),t==="lantern"&&this.registerFlower(o))}updateWind(t,e,s){const i=e.channelData||[],n=i[3]?.volume||0,o=i[2]?.volume||0;this.windTargetSpeed=Math.max(n,o*.5),this.windSpeed+=(this.windTargetSpeed-this.windSpeed)*.02;const a=(e.beatPhase||0)*.001;this.windDirection.applyAxisAngle(oA,a);const l=t%Es/Es*Math.PI*2;v3.set(Math.cos(l),Math.sin(l),0),M3.copy(v3).negate(),this.windDirection.lerp(M3,.1),this.windDirection.normalize();let u=0,p=0,h=0;if(this.trackedMushrooms.forEach(g=>{g.userData.size==="giant"&&(u+=g.position.x,p+=g.position.z,h++)}),h>0){const g=u/h,f=p/h;A3.set(g,0,f).normalize(),this.windDirection.lerp(A3,.05),this.windDirection.normalize()}const d=this.trackedMushrooms.length;if(this.windSpeed>.4&&d>0){const g=t;if(g-this._lastSpawnCheck>this._spawnThrottle)if(this._lastSpawnCheck=g,!bM()||typeof b3!="function"){let f=0;for(let y=0;y<this.trackedMushrooms.length&&f<this._spawnCapPerFrame;y++){const x=this.trackedMushrooms[y],b=x.userData?.colorIndex??-1,_=(b>=0&&b<=3?.02:.005)*this.windSpeed;if(Math.random()<_){const T=3+Math.random()*8,M=2+Math.random()*3,A=x.position.x+this.windDirection.x*T+(Math.random()-.5)*M,C=x.position.z+this.windDirection.z*T+(Math.random()-.5)*M,P=dn(A,C),D=Wn({size:"regular",scale:.7,colorIndex:b});if(D.position.set(A,P,C),D.rotation.y=Math.random()*Math.PI*2,this.onSpawnFoliage)try{this.onSpawnFoliage(D,!0,.5)}catch(V){console.warn("onSpawnFoliage failed",V)}else this.scene.add(D),this.registerMushroom(D);f++}}}else try{const f=this.trackedMushrooms.map(T=>({x:T.position.x,y:T.position.y,z:T.position.z,radius:T.userData?.radius||.5})),y=this.trackedMushrooms.map(T=>({offset:0,type:0,originalY:T.position.y,colorIndex:T.userData?.colorIndex||0}));T9(f),_M(y);const _=b3(t,this.windDirection.x,this.windDirection.z,this.windSpeed,d,1,3,8);if(_>0){const T=TM(_);let M=0;for(const A of T){if(M>=this._spawnCapPerFrame)break;const C=Wn({size:"regular",scale:.7,colorIndex:A.colorIndex});if(C.position.set(A.x,A.y,A.z),C.rotation.y=Math.random()*Math.PI*2,this.onSpawnFoliage)try{this.onSpawnFoliage(C,!0,.5)}catch(P){console.warn("onSpawnFoliage failed",P)}else this.scene.add(C),this.registerMushroom(C);M++}}}catch(f){console.warn("WASM spawn path failed, falling back to JS:",f)}}}updateMushroomWaterfalls(t,e){const s=this.state!==mt.CLEAR&&this.intensity>.4;this.trackedMushrooms.forEach(i=>{if(i.userData.size==="giant"){const n=i.uuid;if(s){if(!this.mushroomWaterfalls.has(n)){const a=i.userData.capRadius||5,c=i.userData.capHeight||8,l=oM(new v(i.position.x+a*.8,c*.8,i.position.z),new v(i.position.x+a*1.1,0,i.position.z),2);this.scene.add(l),this.mushroomWaterfalls.set(n,l)}const o=this.mushroomWaterfalls.get(n);o.onAnimate&&o.onAnimate(.016,t),e>.5&&o.scale.setScalar(1+e*.1)}else if(this.mushroomWaterfalls.has(n)){const o=this.mushroomWaterfalls.get(n);this.scene.remove(o),this.mushroomWaterfalls.delete(n)}}})}applyDarknessLogic(t,e){const s=t.moonIntensity,i=this.cloudDensity,n=1-(e||0)*.5,o=s*i*n*.95;this.scene.fog&&this.scene.fog.color&&this.scene.fog.color.lerp(rA,o),C9.value=o,this.darknessFactor=o}updateFog(t){if(!this.fog)return;let e=1;switch(this.state){case mt.RAIN:e=.8;break;case mt.STORM:e=.6;break;default:e=1}let s=0;t&&(s=(t.average||0)*.3);const i=1-this.intensity*(1-e),n=1-(this.darknessFactor||0)*.7,o=1-s,a=i*n*o,c=this.baseFogNear*a,l=this.baseFogFar*a;this.fog.near+=(c-this.fog.near)*.05,this.fog.far+=(l-this.fog.far)*.05}updateBerrySeasonalSize(t,e){let l="day",u=0;t<60?(l="sunrise",u=t/60):t<480?(l="day",u=(t-60)/420):t<540?(l="sunset",u=(t-60-420)/60):t<720?(l="dusk",u=(t-60-420-60)/180):t<840?(l="deepNight",u=(t-60-420-60-180)/120):(l="preDawn",u=(t-60-420-60-180-120)/120),this.trackedTrees.forEach(p=>{p.userData.berries&&d3(p.userData.berries,l,u)}),this.trackedShrubs.forEach(p=>{p.userData.berries&&d3(p.userData.berries,l,u)})}updateWeatherState(t,e,s,i=null,n=null){let o=mt.CLEAR,a=0;if(t>.7&&s>.5?(o=mt.STORM,a=1):(t>.3||e>.4)&&(o=mt.RAIN,a=.5),n){const c=Math.random();n.season==="Winter"&&o===mt.STORM&&c>.3&&(o=mt.RAIN),n.season==="Summer"&&o===mt.RAIN&&c>.7&&(o=mt.STORM),n.season==="Spring"&&o===mt.CLEAR&&c>.9&&(o=mt.RAIN,a=.3)}if(i){let l=mt.CLEAR;i.biasState==="storm"?l=mt.STORM:i.biasState==="rain"&&(l=mt.RAIN),o!==l?Math.random()<.4?(this.state=l,this.targetIntensity=i.biasIntensity):(this.state=o,this.targetIntensity=a):(this.state=o,this.targetIntensity=a*(1-.4)+i.biasIntensity*.4),this.weatherType=i.type||"default"}else this.state=o,this.targetIntensity=a,this.weatherType="audio"}updatePercussionRain(t,e){const s=e>.2||this.state!==mt.CLEAR;if(this.percussionRain.visible=s,!s)return;const i=this.percussionRain.geometry.attributes.position.array,n=this.percussionRain.geometry.userData.velocities,o=this.percussionRain.geometry.userData.offsets;this.percussionRain.material.size=.3+e*.5,this.percussionRain.material.opacity=.4+this.intensity*.6,this.weatherType==="mist"?this.percussionRain.material.color.setHex(14742783):this.weatherType==="drizzle"?this.percussionRain.material.color.setHex(10139080):this.weatherType==="thunderstorm"||this.state===mt.STORM?this.percussionRain.material.color.setHex(6328496):this.percussionRain.material.color.setHex(8965375);for(let a=0;a<i.length/3;a++){const c=50+o[a],l=n[a]*(1+e),u=MM(c,t,l,50);i[a*3+1]=u,u<0&&(i[a*3]=(Math.random()-.5)*100,i[a*3+2]=(Math.random()-.5)*100)}this.percussionRain.geometry.attributes.position.needsUpdate=!0}updateMelodicMist(t,e){const s=e>.2||this.weatherType==="mist"&&this.state===mt.RAIN;if(this.melodicMist.visible=s,!s)return;const i=this.melodicMist.geometry.attributes.position.array;for(let n=0;n<i.length/3;n++){const o=n*.1;i[n*3+1]=1+Math.sin(t+o)*2*Math.max(e,.3),i[n*3]+=Math.sin(t*.5+o)*.01,i[n*3+2]+=Math.cos(t*.4+o)*.01}this.melodicMist.material.opacity=.3+e*.4,this.weatherType==="mist"?(this.melodicMist.material.color.setHex(14548957),this.melodicMist.material.opacity=.6):this.melodicMist.material.color.setHex(11206570),this.melodicMist.geometry.attributes.position.needsUpdate=!0}updateLightning(t,e){this.lightningTimer-=.016,e>.8&&this.lightningTimer<=0&&Math.random()>.7&&(this.lightningActive=!0,this.lightningTimer=.5+Math.random()*1,this.lightningLight.intensity=5+Math.random()*5,this.lightningLight.position.set((Math.random()-.5)*60,40+Math.random()*20,(Math.random()-.5)*60)),this.lightningActive&&(this.lightningLight.intensity*=.85,this.lightningLight.intensity<.1&&(this.lightningActive=!1,this.lightningLight.intensity=0))}chargeBerryGlow(t){const e=t*.05;this.trackedTrees.forEach(s=>{s.userData.berries&&h3(s.userData.berries,e)}),this.trackedShrubs.forEach(s=>{s.userData.berries&&h3(s.userData.berries,e)}),t>.6&&(this.trackedTrees.forEach(s=>{s.userData.berries&&g3(s.userData.berries,t)}),this.trackedShrubs.forEach(s=>{s.userData.berries&&g3(s.userData.berries,t)}))}growPlants(t){zr(this.trackedTrees,t),zr(this.trackedMushrooms,t)}bloomFlora(t){EM(this.trackedFlowers,t)}getState(){return this.state}getStormCharge(){return this.stormCharge}getIntensity(){return this.intensity}forceState(t){switch(this.state=t,t){case mt.STORM:this.targetIntensity=1;break;case mt.RAIN:this.targetIntensity=.5;break;default:this.targetIntensity=0}}dispose(){this.percussionRain&&(this.scene.remove(this.percussionRain),this.percussionRain.geometry.dispose(),this.percussionRain.material.dispose()),this.melodicMist&&(this.scene.remove(this.melodicMist),this.melodicMist.geometry.dispose(),this.melodicMist.material.dispose()),this.lightningLight&&this.scene.remove(this.lightningLight),this.rainbow&&(this.scene.remove(this.rainbow),this.rainbow.geometry.dispose()),this.mushroomWaterfalls&&this.mushroomWaterfalls.size>0&&(this.mushroomWaterfalls.forEach(t=>{this.scene.remove(t)}),this.mushroomWaterfalls.clear())}}class cA{constructor(){this.enabled=!1,this.measures=new Map,this.frameStart=0,this.frameHistory=[],this.logThresholdMs=34,this.maxBars=10,this.canvas=document.createElement("canvas"),this.canvas.style.cssText="position:fixed; bottom:10px; right:10px; z-index:9999; pointer-events:none; display:none; background:rgba(0,0,0,0.8); border-radius:8px;",this.canvas.width=300,this.canvas.height=200,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}toggle(){this.enabled=!this.enabled,this.canvas.style.display=this.enabled?"block":"none",console.log(`[Profiler] ${this.enabled?"Enabled":"Disabled"}`)}startFrame(){this.enabled&&(this.measures.clear(),this.frameStart=performance.now())}measure(t,e){if(!this.enabled)return e();const s=performance.now(),i=e(),o=performance.now()-s,a=this.measures.get(t)||0;return this.measures.set(t,a+o),i}endFrame(){if(!this.enabled)return;const t=performance.now()-this.frameStart;if(t>this.logThresholdMs){console.warn(` LAG SPIKE: ${t.toFixed(1)}ms`);const e=[...this.measures.entries()].sort((s,i)=>i[1]-s[1]);console.table(e.map(([s,i])=>({System:s,"Time (ms)":i.toFixed(2),"% of Frame":(i/t*100).toFixed(1)+"%"})))}this.drawUI(t)}drawUI(t){const e=this.ctx,s=this.canvas.width,i=this.canvas.height;e.clearRect(0,0,s,i),e.fillStyle="#fff",e.font="12px monospace",e.fillText(`Frame: ${t.toFixed(1)}ms (${(1e3/t).toFixed(0)} FPS)`,10,20);let n=40;const o=s-20;[...this.measures.entries()].sort((c,l)=>l[1]-c[1]).forEach(([c,l])=>{if(n>i-10)return;const u=Math.min(l/t,1),p=Math.max(1,u*o);l>10?e.fillStyle="#ff4444":l>4?e.fillStyle="#ffbb33":e.fillStyle="#00C851",e.fillRect(10,n,p,14),e.fillStyle="#fff",e.fillText(`${c}: ${l.toFixed(1)}ms`,14,n+11),n+=20})}}const Ws=new cA;let vc=typeof navigator<"u"&&navigator.gpu!==void 0;typeof window<"u"&&vc&&(vc=await navigator.gpu.requestAdapter());class N3{static isAvailable(){return!!vc}static getStaticAdapter(){return vc}static getErrorMessage(){const t='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet',e=document.createElement("div");return e.id="webgpumessage",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.maxWidth="400px",e.style.margin="5em auto 0",e.innerHTML=t,e}}function lA(){const r=document.querySelector("#glCanvas"),t=new Hu;t.fog=new $u(De.day.fog,20,100);const e=new qs(60,window.innerWidth/window.innerHeight,.1,2e3);if(e.position.set(0,5,0),!N3.isAvailable()){const g=N3.getErrorMessage();throw document.body.appendChild(g),new Error("WebGPU not supported")}const s=new vv({canvas:r,antialias:!0});s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),s.toneMapping=t5,s.toneMappingExposure=1;const i=new E5(De.day.skyTop,Ne.colors.ground,1.1);t.add(i);const n=new D5(De.day.sun,.9);n.position.set(50,80,30),n.castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,t.add(n);const o=new Ds({color:16770457,transparent:!0,opacity:.25,blending:pe,side:se,depthWrite:!1}),a=new O(new on(80,80),o);a.position.copy(n.position.clone().normalize().multiplyScalar(400)),a.lookAt(0,0,0),t.add(a);const c=new Ds({color:16774358,transparent:!0,opacity:.15,blending:pe,side:se,depthWrite:!1}),l=new O(new on(150,150),c);l.position.copy(n.position.clone().normalize().multiplyScalar(390)),l.lookAt(0,0,0),t.add(l);const u=new K,p=12,h=new on(8,200),d=new Ds({color:16770464,transparent:!0,opacity:0,blending:pe,side:se,depthWrite:!1});for(let g=0;g<p;g++){const f=new O(h,d.clone()),y=g/p*Math.PI*2;f.rotation.z=y,u.add(f)}return u.position.copy(n.position.clone().normalize().multiplyScalar(380)),u.visible=!1,t.add(u),window.addEventListener("resize",()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}),{scene:t,camera:e,renderer:s,ambientLight:i,sunLight:n,sunGlow:a,sunCorona:l,lightShaftGroup:u,sunGlowMat:o,coronaMat:c}}async function uA(r,t,e){const s=e.layers.mask,i=e.position.clone(),n=e.rotation.clone(),o=r.autoClear,a=[];t.traverse(l=>{l.isMesh&&l.frustumCulled&&(l.frustumCulled=!1,a.push(l))});const c=new yt;r.getViewport(c),r.setViewport(0,0,1,1),e.layers.enableAll(),e.position.set(0,50,0),e.lookAt(0,0,0);try{r.render(t,e)}catch(l){console.warn("Warmup error",l)}r.setViewport(c),a.forEach(l=>l.frustumCulled=!0),e.layers.mask=s,e.position.copy(i),e.rotation.copy(n),r.autoClear=o,r.clear()}const Po=new hs(0,0,0,"YXZ"),Io=new v,pA={type:"change"},hA={type:"lock"},dA={type:"unlock"},C3=Math.PI/2;class gA extends hf{constructor(t,e=null){super(t,e),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=fA.bind(this),this._onPointerlockChange=mA.bind(this),this._onPointerlockError=yA.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(t){if(this.enabled===!1)return;const e=this.object;Io.setFromMatrixColumn(e.matrix,0),Io.crossVectors(e.up,Io),e.position.addScaledVector(Io,t)}moveRight(t){if(this.enabled===!1)return;const e=this.object;Io.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(Io,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function fA(r){if(this.enabled===!1||this.isLocked===!1)return;const t=this.object;Po.setFromQuaternion(t.quaternion),Po.y-=r.movementX*.002*this.pointerSpeed,Po.x-=r.movementY*.002*this.pointerSpeed,Po.x=Math.max(C3-this.maxPolarAngle,Math.min(C3-this.minPolarAngle,Po.x)),t.quaternion.setFromEuler(Po),this.dispatchEvent(pA)}function mA(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(hA),this.isLocked=!0):(this.dispatchEvent(dA),this.isLocked=!1)}function yA(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}const Se={forward:!1,backward:!1,left:!1,right:!1,jump:!1,sneak:!1,sprint:!1};function xA(r,t,e){const s=new gA(r,document.body),i=document.getElementById("instructions"),n=document.getElementById("startButton"),o=document.getElementById("playlist-overlay"),a=document.getElementById("playlist-list"),c=document.getElementById("closePlaylistBtn"),l=document.getElementById("playlistUploadInput");let u=!1;function p(){if(!a)return;a.innerHTML="";const T=t.getPlaylist(),M=t.getCurrentIndex();T.forEach((A,C)=>{const P=document.createElement("li");P.className=`playlist-item ${C===M?"active":""}`;const D=document.createElement("button");D.className="playlist-btn",D.setAttribute("aria-label",`Play ${A.name}`),C===M&&D.setAttribute("aria-current","true"),D.innerHTML=`
                <span class="song-title">${C+1}. ${A.name}</span>
                <span class="status-icon" aria-hidden="true">${C===M?"":""}</span>
            `,D.onclick=V=>{V.stopPropagation(),t.playAtIndex(C),p(),requestAnimationFrame(()=>{const $=a.querySelectorAll(".playlist-btn");$[C]&&$[C].focus()})},P.appendChild(D),a.appendChild(P)}),T.length===0&&(a.innerHTML='<li class="playlist-item" style="justify-content:center; color:#999;">No songs loaded... add some! </li>')}t.onPlaylistUpdate=()=>{u&&p()},t.onTrackChange=T=>{u&&p();const M=t.getPlaylist();if(M&&M[T]){const A=document.getElementById("now-playing-toast"),C=document.getElementById("now-playing-text");A&&C&&(C.innerText=`Now Playing: ${M[T].name}`,A.classList.add("visible"),A.timeout&&clearTimeout(A.timeout),A.timeout=setTimeout(()=>{A.classList.remove("visible")},4e3))}};function h(){u=!u,u?(s.unlock(),i&&(i.style.display="none"),o.style.display="flex",p(),requestAnimationFrame(()=>{c&&c.focus()})):(o.style.display="none",s.lock())}c&&c.addEventListener("click",h);const d=(T,M)=>{if(!T)return;T.dataset.originalText||(T.dataset.originalText=T.innerText);const A=T.dataset.originalText;T.innerText=` ${M} Song${M>1?"s":""} Added!`,setTimeout(()=>{T.innerText=A},2e3)};l&&l.addEventListener("change",T=>{const M=T.target.files;if(M&&M.length>0){t.addToQueue(M);const A=document.querySelector('label[for="playlistUploadInput"]');d(A,M.length)}}),n&&n.addEventListener("click",()=>{s.lock()}),i&&i.addEventListener("click",T=>{T.target===i&&s.lock()}),s.addEventListener("lock",()=>{i.style.display="none",u=!1,o&&(o.style.display="none")}),s.addEventListener("unlock",()=>{u||(i&&(i.style.display="flex"),n&&(n.innerText="Resume Exploration ",requestAnimationFrame(()=>n.focus())))});const g=function(T){if(T.ctrlKey&&T.code!=="ControlLeft"&&T.code!=="ControlRight"&&T.preventDefault(),u){if(T.code==="Escape"||T.code==="KeyQ"){T.preventDefault(),h();return}if(T.code==="Tab"){const M=o.querySelectorAll('button, input, [href], select, textarea, [tabindex]:not([tabindex="-1"])');if(M.length===0)return;const A=M[0],C=M[M.length-1];T.shiftKey?document.activeElement===A&&(C.focus(),T.preventDefault()):document.activeElement===C&&(A.focus(),T.preventDefault());return}return}switch(T.code){case"KeyQ":h();break;case"KeyW":Se.forward=!0;break;case"KeyA":Se.left=!0;break;case"KeyS":Se.backward=!0;break;case"KeyD":Se.right=!0;break;case"Space":Se.jump=!0;break;case"KeyN":e&&e();break;case"ControlLeft":case"ControlRight":Se.sneak=!0,T.preventDefault();break;case"ShiftLeft":case"ShiftRight":Se.sprint=!0;break}},f=function(T){switch(T.code){case"KeyW":Se.forward=!1;break;case"KeyA":Se.left=!1;break;case"KeyS":Se.backward=!1;break;case"KeyD":Se.right=!1;break;case"Space":Se.jump=!1;break;case"ControlLeft":case"ControlRight":Se.sneak=!1;break;case"ShiftLeft":case"ShiftRight":Se.sprint=!1;break}},y=function(T){u||T.button===2&&(Se.forward=!0)},x=function(T){u||T.button===2&&(Se.forward=!1)};document.addEventListener("keydown",g),document.addEventListener("keyup",f),document.addEventListener("mousedown",y),document.addEventListener("mouseup",x);const b=document.getElementById("musicUpload");b&&b.addEventListener("change",T=>{const M=T.target.files;if(M&&M.length>0){t.addToQueue(M);const A=document.querySelector('label[for="musicUpload"]');d(A,M.length)}});const w=document.getElementById("toggleDayNight");w&&e&&w.addEventListener("click",e);const _=document.getElementById("openJukeboxBtn");return _&&_.addEventListener("click",T=>{T.stopPropagation(),h()}),{controls:s,updateDayNightButtonState:T=>{w&&w.setAttribute("aria-pressed",T)}}}const wi=[],D9=[],Mc=[],Ac=[],Kn=[],Nc=[],P9=new K,Cc=new K;P9.add(Cc);let Wr=null,I9=0;function R3(r){Wr=r}function bA(r){I9=r}const F3=JSON.parse('[{"type":"mushroom","position":[72,0,-40],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[66,0,-29.607695154586736],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[54,0,-29.607695154586736],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[48,0,-40],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[53.99999999999999,0,-50.392304845413264],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[66,0,-50.392304845413264],"scale":1.5,"variant":"giant","hasFace":true},{"type":"portamento_pine","position":[-47.22911016463579,0,-0.1255438425534603],"scale":0.9374434605235864},{"type":"tremolo_tulip","position":[-40.543526587193824,0,-6.501984401399766],"scale":1.0453580444760104},{"type":"tremolo_tulip","position":[-47.64864023911153,0,-7.174714975268854],"scale":1.0930116674734562},{"type":"tremolo_tulip","position":[-47.83239902515943,0,-6.72533117503884],"scale":0.8031491105100604},{"type":"tremolo_tulip","position":[-48.63930823476214,0,-7.176793236973787],"scale":0.9306455807912338},{"type":"prism_rose_bush","position":[-48.049974851790104,0,-7.594525476036271],"scale":1.1636334853694503},{"type":"prism_rose_bush","position":[-52.777369041429615,0,-6.311771619973262],"scale":0.874331714198389},{"type":"prism_rose_bush","position":[-49.676046349699035,0,-11.18063119800394],"scale":0.9444590508448274},{"type":"prism_rose_bush","position":[119.76576256388121,0,11.282430741476926],"scale":0.8108908930982137},{"type":"tremolo_tulip","position":[124.40140164851591,0,10.30193958403372],"scale":1.1797933198653967},{"type":"portamento_pine","position":[119.52465877947792,0,11.206682617909273],"scale":1.1106525614033895},{"type":"portamento_pine","position":[119.18450529879063,0,7.866906129568365],"scale":1.1231816712992806},{"type":"arpeggio_fern","position":[118.3652948449315,0,7.325511979380682],"scale":1.0736005067797172},{"type":"vibrato_violet","position":[121.5129502246927,0,12.065561150703646],"scale":0.8798744832030643},{"type":"tremolo_tulip","position":[120.50944629578314,0,10.73012969003906],"scale":1.1582220855207417},{"type":"vibrato_violet","position":[116.16074926043052,0,7.0060833807841565],"scale":1.1687494973386434},{"type":"arpeggio_fern","position":[118.91040609820976,0,12.412317576902907],"scale":1.003077234405893},{"type":"portamento_pine","position":[119.57803860755212,0,10.527755360427552],"scale":1.1003052292476632},{"type":"prism_rose_bush","position":[104.29205958954961,0,-8.878971313154244],"scale":0.8479231986446575},{"type":"prism_rose_bush","position":[97.69989355674667,0,-17.640631483993353],"scale":0.946662538452866},{"type":"portamento_pine","position":[95.28384228595107,0,-5.220051339856421],"scale":1.1481714622834858},{"type":"prism_rose_bush","position":[97.4047452881846,0,-15.781343803804809],"scale":0.921761601297653},{"type":"portamento_pine","position":[98.14235900800283,0,-11.679187503160001],"scale":0.9743284807235675},{"type":"prism_rose_bush","position":[96.20048995883936,0,-18.743274581423755],"scale":0.9922194392383505},{"type":"arpeggio_fern","position":[99.4120568739739,0,-11.046351450552823],"scale":1.0742663314289531},{"type":"arpeggio_fern","position":[99.6642763637413,0,-10.172403990417576],"scale":0.9457034234272924},{"type":"arpeggio_fern","position":[102.58367871622582,0,-10.633298774869342],"scale":1.1326173456185114},{"type":"prism_rose_bush","position":[95.63961290175702,0,-8.5005662911608],"scale":1.1285766399365986},{"type":"arpeggio_fern","position":[99.01294247742509,0,-9.679037492657544],"scale":1.0639822437809596},{"type":"subwoofer_lotus","position":[39.918033770384966,0,2.34248769559657],"scale":0.8920341765134564},{"type":"accordion_palm","position":[43.88268020331673,0,16.002265511515958],"scale":0.9665690448394947},{"type":"accordion_palm","position":[40.60967918670037,0,10.206675748342915],"scale":0.8138140961668201},{"type":"kick_drum_geyser","position":[37.04981076183964,0,11.552361276774095],"scale":0.9155642394617505},{"type":"kick_drum_geyser","position":[45.673283591643994,0,12.723730784534336],"scale":1.1316616588614075},{"type":"kick_drum_geyser","position":[32.74655775193414,0,11.8814106868065],"scale":0.8640132495050038},{"type":"prism_rose_bush","position":[-99.65169122768516,0,-36.380677709583324],"scale":1.1334699000818218},{"type":"arpeggio_fern","position":[-97.46579158948322,0,-33.7393513523269],"scale":1.1833276174414797},{"type":"portamento_pine","position":[-95.48556747382372,0,-31.507488958036845],"scale":0.837793518018398},{"type":"arpeggio_fern","position":[-95.97381546251576,0,-29.447162118032537],"scale":1.0013096456670227},{"type":"arpeggio_fern","position":[-95.64106360813922,0,-32.55928153758976],"scale":0.8690088286979181},{"type":"portamento_pine","position":[90.1046498508956,0,-42.44591134699535],"scale":0.8536252065682787},{"type":"prism_rose_bush","position":[82.5550036309324,0,-38.98596623058435],"scale":1.102318085416236},{"type":"vibrato_violet","position":[81.41994275286038,0,-39.53985063934537],"scale":1.0674201155666885},{"type":"arpeggio_fern","position":[91.09436420864445,0,-41.370721372044386],"scale":0.8493853875562591},{"type":"tremolo_tulip","position":[80.43849951517944,0,-36.43411541217942],"scale":1.1347610897441633},{"type":"arpeggio_fern","position":[81.60695779566566,0,-35.39684489126519],"scale":0.944696990655058},{"type":"tremolo_tulip","position":[82.60027506822583,0,-38.73706157122184],"scale":0.9466725515883728},{"type":"prism_rose_bush","position":[84.59100053260772,0,-39.19773081498175],"scale":0.8750194763313562},{"type":"portamento_pine","position":[89.77372002057372,0,-42.47286406099562],"scale":0.9945574132115639},{"type":"tremolo_tulip","position":[81.87594915468183,0,-46.288160418635414],"scale":0.8141690528522924},{"type":"accordion_palm","position":[-88.79781334771123,0,-21.47799430383231],"scale":1.1692633794565368},{"type":"snare_trap","position":[-93.36328548677082,0,-25.097416223531713],"scale":0.9026880447042636},{"type":"subwoofer_lotus","position":[-95.32246624484179,0,-23.777569304397947],"scale":1.0984448013803905},{"type":"subwoofer_lotus","position":[-91.79341864776526,0,-25.014204193803696],"scale":1.1541500796019337},{"type":"kick_drum_geyser","position":[-92.95251901435498,0,-29.616094665185095],"scale":0.8863258223570595},{"type":"kick_drum_geyser","position":[-92.87465475196053,0,-23.455058811931234],"scale":0.870060281542649},{"type":"kick_drum_geyser","position":[-95.50621397742366,0,-17.496688497085024],"scale":1.151272144007872},{"type":"accordion_palm","position":[-98.60577158099797,0,-26.40784978073481],"scale":0.9733974941118964},{"type":"accordion_palm","position":[-93.93460216667681,0,-23.375752855572227],"scale":0.9664986119251022},{"type":"cymbal_dandelion","position":[-49.02594539931655,0,41.80285968724054],"scale":1.1593844099035353},{"type":"subwoofer_lotus","position":[-55.7572743700053,0,38.611148162407474],"scale":0.8717428391365759},{"type":"snare_trap","position":[-53.888109506291144,0,43.69816094730608],"scale":1.0631268082009424},{"type":"accordion_palm","position":[-49.80795495679224,0,37.43882274864475],"scale":1.1426974621911639},{"type":"kick_drum_geyser","position":[-52.819365828640876,0,39.16820592840743],"scale":1.1973553297204669},{"type":"accordion_palm","position":[-47.110669231448064,0,43.066031339207],"scale":0.9730255980682798},{"type":"snare_trap","position":[-53.929884143188964,0,44.541067389214156],"scale":0.8386436351003118},{"type":"accordion_palm","position":[-51.05104280105699,0,43.163743917169356],"scale":0.894441133007592},{"type":"accordion_palm","position":[-53.571898169233926,0,44.33184039918323],"scale":1.0716913563173793},{"type":"tremolo_tulip","position":[80.0538700300257,0,-47.97461837140477],"scale":0.9931466331590519},{"type":"arpeggio_fern","position":[83.07698620736448,0,-56.27617311301366],"scale":0.8861523958483911},{"type":"portamento_pine","position":[79.74878747347807,0,-53.12178396584419],"scale":1.1612366106565035},{"type":"prism_rose_bush","position":[73.26822726937327,0,-55.575242426011805],"scale":1.0395962617031744},{"type":"prism_rose_bush","position":[72.10499020338924,0,-57.61683409908401],"scale":1.0352898374864716},{"type":"tremolo_tulip","position":[83.05795130267002,0,-50.24113278290652],"scale":0.9503942362044122},{"type":"vibrato_violet","position":[-15.71990977028575,0,39.20101118643635],"scale":1.134646217031062},{"type":"portamento_pine","position":[-23.091694306750664,0,28.142528510800087],"scale":0.8267769608779887},{"type":"tremolo_tulip","position":[-24.882413058425335,0,33.6947885176295],"scale":1.0167508175324467},{"type":"arpeggio_fern","position":[-14.868592593420445,0,30.307129156833305],"scale":1.100392559261811},{"type":"arpeggio_fern","position":[-20.780749893443044,0,32.50885171941463],"scale":1.1550058296353567},{"type":"tremolo_tulip","position":[-11.664819385970105,0,30.69092538026287],"scale":1.0268907454210294},{"type":"arpeggio_fern","position":[-20.642246118339383,0,40.61753374980115],"scale":0.8561804216792663},{"type":"portamento_pine","position":[-18.552411988347693,0,34.575967745089095],"scale":1.077367955700064},{"type":"portamento_pine","position":[-18.141913525522366,0,34.047334290376895],"scale":1.1079360549594899},{"type":"vibrato_violet","position":[41.43027457741349,0,38.725662073221415],"scale":1.1204521709775725},{"type":"vibrato_violet","position":[47.0816688555319,0,41.85834446466186],"scale":1.014317464960814},{"type":"arpeggio_fern","position":[33.61017882998094,0,38.42058117719781],"scale":1.0986192346461519},{"type":"tremolo_tulip","position":[39.1173923791177,0,45.035345192366215],"scale":0.8406542303042778},{"type":"arpeggio_fern","position":[38.31824003596915,0,40.457264983806326],"scale":1.0604926701348498},{"type":"prism_rose_bush","position":[39.40445918545167,0,41.9625565691024],"scale":1.0004720561820766},{"type":"portamento_pine","position":[41.379974100611214,0,41.051512466018664],"scale":0.9460835320795433},{"type":"tremolo_tulip","position":[47.18247908706261,0,41.24321669412563],"scale":1.174098183821479},{"type":"vibrato_violet","position":[41.459549920041944,0,37.34116011843633],"scale":1.0599630403448388},{"type":"portamento_pine","position":[43.52217285428323,0,39.54746098716194],"scale":1.0308405813288084},{"type":"snare_trap","position":[-53.19984888470764,0,-100.6986158552477],"scale":1.120398482315219},{"type":"accordion_palm","position":[-51.99330342931394,0,-92.1796426746822],"scale":0.8834521833640497},{"type":"kick_drum_geyser","position":[-52.114259004061275,0,-94.72806306264009],"scale":0.8272330239842545},{"type":"kick_drum_geyser","position":[-53.977484149797526,0,-96.03216769503626],"scale":0.9430323097894462},{"type":"subwoofer_lotus","position":[-57.37118606552557,0,-98.69398862583571],"scale":1.1685840003531272},{"type":"snare_trap","position":[-51.88787451438698,0,-97.40223236593638],"scale":1.07003823102538},{"type":"cymbal_dandelion","position":[-53.74691847129073,0,-97.0894644626069],"scale":1.1046890666932239},{"type":"subwoofer_lotus","position":[-50.95267916857115,0,-99.79015135323348],"scale":0.8800259850275564},{"type":"subwoofer_lotus","position":[-55.51691349150403,0,-98.70619532262297],"scale":0.9430168103152341},{"type":"snare_trap","position":[-54.822457967133175,0,-90.87841072879833],"scale":0.8803625042547809},{"type":"kick_drum_geyser","position":[-46.49537875252543,0,-97.57283283960712],"scale":1.0607945299997539},{"type":"cymbal_dandelion","position":[-55.97060788546942,0,-97.88582412452101],"scale":0.9813741495979758},{"type":"fiber_optic_willow","position":[-107.83391007801761,0,-31.304563128740387],"scale":0.986015613534345},{"type":"fiber_optic_willow","position":[71.00201806116925,0,47.76280589100914],"scale":1.0043558984176926},{"type":"balloon_bush","position":[23.003398423838497,0,63.27106602963155],"scale":1.1415249369605789},{"type":"floating_orb","position":[-119.91615094415577,0,-8.494360014016742],"scale":1.4984708133513283},{"type":"cloud","position":[-112.59903565179454,41.63615848315962,-58.48214023426522],"size":2.034218205970102},{"type":"balloon_bush","position":[-33.1085219460295,0,-11.759038496727134],"scale":1.2972895722937567},{"type":"helix_plant","position":[3.470647443787697,0,-32.99105882090267],"scale":1.0790860445438026},{"type":"helix_plant","position":[-125.08161389322673,0,17.361933062987198],"scale":0.9505704219913998},{"type":"floating_orb","position":[75.59873844730139,0,75.66383441659225],"scale":1.0318142741849725},{"type":"cloud","position":[35.448837083688474,49.47437558121186,18.146314351559887],"size":2.4749023472949334},{"type":"floating_orb","position":[7.0740295471790935,0,39.42874167452246],"scale":1.001507242209681},{"type":"balloon_bush","position":[-54.69964294715163,0,-109.62700645327244],"scale":1.1475745948672675},{"type":"helix_plant","position":[3.247327553497337,0,104.60284542518704],"scale":1.2713343428676456},{"type":"bubble_willow","position":[4.624564515986328,0,138.43005278722208],"scale":1.3272631436263096},{"type":"balloon_bush","position":[116.95914985086107,0,-47.112467138511455],"scale":1.129679921064155},{"type":"cloud","position":[-77.88365076416657,61.61785651135781,-29.222142191437932],"size":1.8485854072985317},{"type":"bubble_willow","position":[-62.040498384346876,0,-131.79486809943518],"scale":1.4593245942918638},{"type":"floating_orb","position":[-13.313135586808585,0,-26.644503750210788],"scale":0.9144877618712476},{"type":"balloon_bush","position":[-138.95483832000707,0,4.96464566523048],"scale":1.2892614040242114},{"type":"fiber_optic_willow","position":[10.939949542176707,0,-47.0328187392231],"scale":1.3572706283509077},{"type":"balloon_bush","position":[-62.39315897867437,0,108.48174687940846],"scale":1.4320102665201349},{"type":"cloud","position":[95.2820050140259,59.57592577375578,109.52125877905935],"size":2.148591694424708},{"type":"floating_orb","position":[-1.9148714946786534,0,-52.96118856228077],"scale":1.3455090842904065},{"type":"helix_plant","position":[-0.6722842289604921,0,81.34560605788411],"scale":0.9247364512251874},{"type":"fiber_optic_willow","position":[72.95359853298517,0,37.095055480292444],"scale":1.3981079630771869},{"type":"cloud","position":[-33.48024635025627,46.63904710288556,89.85322107330335],"size":2.1069190705797576},{"type":"cloud","position":[14.930324832962643,47.826202054803005,14.161826203389708],"size":1.991394833695241},{"type":"bubble_willow","position":[-104.21039271332185,0,-69.85011091550493],"scale":0.981137013030323},{"type":"wisteria_cluster","position":[24.989091468563654,0,12.307082045536129],"scale":0.9819735000275821},{"type":"fiber_optic_willow","position":[24.534021839922204,0,118.61154111078731],"scale":1.2548326199633824},{"type":"balloon_bush","position":[-102.82792707431676,0,-9.21062646983854],"scale":0.913549055317636},{"type":"balloon_bush","position":[14.178878921321107,0,28.89571503316916],"scale":1.0982100939107595},{"type":"floating_orb","position":[95.30292078285586,0,61.02756011347877],"scale":1.0647393320123202},{"type":"cloud","position":[29.982936783662442,58.16298784565561,-91.5932686219503],"size":2.2209575619605175},{"type":"balloon_bush","position":[-44.73742867588362,0,133.22581135491507],"scale":1.3077755833205171},{"type":"bubble_willow","position":[-45.58541603736963,0,25.335591349028064],"scale":1.4249678222657163},{"type":"floating_orb","position":[-20.634351887090375,0,-23.779953163048646],"scale":1.3453369392137333},{"type":"balloon_bush","position":[106.78871809610276,0,-98.41562769696642],"scale":1.326730174699894},{"type":"fiber_optic_willow","position":[62.525230438392924,0,-37.79147650103577],"scale":1.2711981703221982},{"type":"fiber_optic_willow","position":[29.325436278883924,0,70.65249501956262],"scale":1.0447878689105452},{"type":"balloon_bush","position":[-11.56638016213383,0,-38.63287456836198],"scale":1.051979992215855},{"type":"bubble_willow","position":[-57.54095389482364,0,84.56635413617391],"scale":1.1728122071099474},{"type":"bubble_willow","position":[28.357897417889102,0,-69.33057899102269],"scale":1.082035145700773},{"type":"bubble_willow","position":[4.905169589238176,0,91.45344555338403],"scale":0.9605720199825255},{"type":"bubble_willow","position":[-35.682411039133186,0,-17.163509067393967],"scale":1.2792921808127935},{"type":"balloon_bush","position":[-107.56560131801643,0,-45.96977736187065],"scale":1.3795107807248075},{"type":"cloud","position":[53.50851949529446,57.90814990794311,-45.8710449501235],"size":2.318201819863587},{"type":"helix_plant","position":[-110.50945836523098,0,52.760747709629165],"scale":1.491778130896548},{"type":"bubble_willow","position":[58.03222162944969,0,-61.655233471599814],"scale":1.4506397184317592},{"type":"fiber_optic_willow","position":[34.27681368730905,0,-4.223024146425361],"scale":1.4020712593181388},{"type":"starflower","position":[-98.79378038230723,0,-68.61064464023659],"scale":0.8029768492342146},{"type":"mushroom","position":[83.56862436738759,0,113.66399809023576],"scale":1.0881989310243456,"variant":"regular"},{"type":"starflower","position":[5.570006436107278,0,32.285183744086574],"scale":1.1590957618300273},{"type":"starflower","position":[41.212353288792045,0,-69.04035700145205],"scale":1.0645568353373138},{"type":"flower","position":[-3.776269663569565,0,-38.500557312621005],"scale":0.9032645740452868},{"type":"starflower","position":[-54.54162581039797,0,21.684033226602367],"scale":0.7280974129239981},{"type":"starflower","position":[40.58140635793505,0,-61.00393179479322],"scale":1.0518047956384475},{"type":"starflower","position":[-33.79003737619261,0,-84.3201451708588],"scale":0.8213772682106502},{"type":"starflower","position":[-16.28595661245259,0,38.246187237442044],"scale":1.0154137903761857},{"type":"flower","position":[53.2447116961572,0,-91.01675821591172],"scale":0.8111344473446112},{"type":"mushroom","position":[-20.52167052064164,0,128.73583771838403],"scale":0.9471573969760896,"variant":"regular"},{"type":"starflower","position":[67.35700360134837,0,-13.421401746483115],"scale":1.0374444940777259},{"type":"flower","position":[-70.47955347726388,0,87.45965210683737],"scale":0.8656062069257846},{"type":"flower","position":[11.177346625237405,0,47.04180503327607],"scale":1.049798092900399},{"type":"starflower","position":[-65.6226279550783,0,54.15810314574154],"scale":1.0842171934982554},{"type":"starflower","position":[104.26010302283527,0,-1.9666461290503015],"scale":1.1225112230015404},{"type":"starflower","position":[70.19947425903855,0,17.89327607345151],"scale":0.9704218416640702},{"type":"mushroom","position":[127.65245559388775,0,-10.521860095943325],"scale":0.960408182250485,"variant":"regular"},{"type":"starflower","position":[54.599292958110055,0,-72.10958043082795],"scale":0.75481529918018},{"type":"starflower","position":[47.15614033555041,0,15.207426047120213],"scale":0.9059248363990436},{"type":"flower","position":[99.48796871329509,0,20.158728102388224],"scale":0.9423356832627282},{"type":"starflower","position":[131.97991646529772,0,-30.747861860286346],"scale":0.9240290946189861},{"type":"mushroom","position":[15.374004283617019,0,-64.86767645046045],"scale":0.8750333611668917,"variant":"regular"},{"type":"flower","position":[-8.755320756200314,0,-34.24754613098226],"scale":1.1699437175139953,"variant":"glowing"},{"type":"starflower","position":[-99.3284364203347,0,9.437123897389059],"scale":1.0186957925959232},{"type":"mushroom","position":[10.058729128353335,0,-24.231487428774233],"scale":0.7051809351607388,"variant":"regular"},{"type":"mushroom","position":[-3.1840933352870056,0,-52.39982925864937],"scale":1.0759040250392813,"variant":"regular"},{"type":"mushroom","position":[44.69993273495977,0,3.7886826487617955],"scale":1.0643661276559597,"variant":"regular"},{"type":"starflower","position":[59.39024926873719,0,84.77543522714831],"scale":0.7252649969339251},{"type":"flower","position":[-133.2096602986952,0,9.934495192558236],"scale":0.9111972666354243},{"type":"flower","position":[137.85458393663967,0,23.330387938583016],"scale":1.185868561075155},{"type":"starflower","position":[-33.18145734937935,0,0.3054941981711743],"scale":0.9161217340495502},{"type":"starflower","position":[-99.58500839882545,0,90.58686459961527],"scale":0.7911386626967758},{"type":"starflower","position":[-9.573106641160596,0,48.003524386981596],"scale":0.8990114835160267},{"type":"mushroom","position":[-31.307703798869326,0,37.07132263672781],"scale":1.1977549857047534,"variant":"regular"},{"type":"mushroom","position":[-35.27021366947536,0,-9.717393511360394],"scale":1.0770462848132514,"variant":"regular"},{"type":"flower","position":[-50.10775077340466,0,-3.3595290325641307],"scale":0.7182020866008991},{"type":"starflower","position":[-104.58565461571501,0,82.9475093707888],"scale":1.1989909478262528},{"type":"mushroom","position":[-68.06741741943826,0,-36.65417035427972],"scale":0.7787047295661882,"variant":"giant"},{"type":"mushroom","position":[-14.533722590821831,0,35.99621630983983],"scale":0.7126591122314838,"variant":"regular"},{"type":"starflower","position":[42.44703308655852,0,-120.42461373768079],"scale":1.1762138655600531},{"type":"mushroom","position":[-82.30544173086719,0,-85.75689974349531],"scale":1.1591572778342645,"variant":"regular"},{"type":"starflower","position":[17.74431308134437,0,-100.17371199446997],"scale":1.159124701704125},{"type":"flower","position":[-78.63505142398535,0,77.62193417582887],"scale":1.0821588668690536},{"type":"mushroom","position":[-13.86946547839286,0,37.615098984910965],"scale":0.924560198680102,"variant":"regular"},{"type":"starflower","position":[-76.95866768573926,0,-123.72005428992816],"scale":1.062105540705579},{"type":"starflower","position":[-54.185539218591956,0,103.99552217300639],"scale":0.8231500381519387},{"type":"starflower","position":[64.5165682386841,0,22.32166677818968],"scale":1.0450476769449328},{"type":"mushroom","position":[3.7878963745810026,0,94.0276170264386],"scale":1.0633484624027718,"variant":"regular"},{"type":"starflower","position":[-61.218140045781745,0,-16.626953384097867],"scale":1.0282124616470731},{"type":"grass","position":[-40.224606302122346,0,88.66716632004623],"scale":1.1155439666378004},{"type":"grass","position":[29.49670574023934,0,-11.485414893893623],"scale":1.2642570900883336},{"type":"grass","position":[78.87839350420535,0,45.642029960179705],"scale":1.1715374011178483},{"type":"grass","position":[13.399435175555215,0,6.888057722321276],"scale":1.256902535931454},{"type":"grass","position":[-8.94070652713972,0,-26.809920314078813],"scale":1.2489746936968593},{"type":"grass","position":[-0.9644812692296744,0,0.2696649023445153],"scale":1.29584274279433},{"type":"grass","position":[-75.04207845424102,0,-58.296982975678084],"scale":0.9227184537138231},{"type":"grass","position":[0.2559900583920787,0,33.11773198436068],"scale":1.1179576592720433},{"type":"grass","position":[118.38337354142848,0,-28.557459803157784],"scale":0.9277671782577481},{"type":"grass","position":[-101.62754927076448,0,74.43192957100437],"scale":0.8620193157613671},{"type":"grass","position":[72.26869644992071,0,46.24914757185332],"scale":1.00722981126795},{"type":"grass","position":[-14.672605923640598,0,-12.047672299378851],"scale":0.7354388371688114},{"type":"grass","position":[-9.537808167750951,0,-18.41845488220492],"scale":1.1730594024382723},{"type":"grass","position":[31.426693792322183,0,-12.711792148335114],"scale":0.7044156248131238},{"type":"grass","position":[-101.31012795084501,0,-53.1181267588117],"scale":1.0476540522148385},{"type":"grass","position":[-100.87663990202613,0,10.536084404174968],"scale":0.9661387102818664},{"type":"grass","position":[-40.3080550413268,0,-34.65671934411471],"scale":1.0177272081775828},{"type":"grass","position":[56.57395741385441,0,-3.3773113662074596],"scale":1.0317886364310742},{"type":"grass","position":[-45.2404789319899,0,7.466772125231933],"scale":1.0809817528640036},{"type":"grass","position":[16.068111889448797,0,64.86985327628564],"scale":1.085284103553197},{"type":"grass","position":[-41.62818670907434,0,-87.38687555497019],"scale":0.8356481578697109},{"type":"grass","position":[-65.42175138047715,0,108.3615457698386],"scale":1.0099896105693928},{"type":"grass","position":[3.971881311012148,0,136.78749839508885],"scale":1.1073403205007701},{"type":"grass","position":[-24.369870185780854,0,-32.79727000866275],"scale":1.253983845504835},{"type":"grass","position":[-87.87587192136053,0,-92.86017642291407],"scale":1.0642044837496578},{"type":"grass","position":[-19.888944562819358,0,3.828110019535847],"scale":0.744752744852209},{"type":"grass","position":[-78.42132942612078,0,-78.6380032844276],"scale":0.9062331823518183},{"type":"grass","position":[1.7479739568467076,0,2.1786920014301656],"scale":0.7674758288094435},{"type":"grass","position":[126.21233285670827,0,35.41415752493337],"scale":0.7455646044452199},{"type":"grass","position":[-82.26408504962181,0,-111.60783572264003],"scale":1.2692399559114054},{"type":"grass","position":[-62.957600523471946,0,-135.83717108837172],"scale":1.1483042328075783},{"type":"grass","position":[49.37886864212827,0,5.653326857734159],"scale":0.7756680556480327},{"type":"grass","position":[-17.490174341284597,0,-104.1916436877125],"scale":1.0357750553519014},{"type":"grass","position":[-11.556232869651264,0,-148.10720408246868],"scale":0.9793832305814709},{"type":"grass","position":[66.46743977626296,0,-69.22621322948915],"scale":0.9702030918129629},{"type":"grass","position":[38.52857435396466,0,69.56232389189513],"scale":0.725192081200262},{"type":"grass","position":[53.2902661504508,0,-87.40592258401516],"scale":0.7549662615789835},{"type":"grass","position":[36.47060835392114,0,4.094128987448922],"scale":0.9315459821818255},{"type":"grass","position":[-0.5802479146083404,0,-13.51591832464047],"scale":0.7653801114268988},{"type":"grass","position":[-53.432468492533665,0,4.184783760021439],"scale":0.9751625305040141},{"type":"grass","position":[-41.23659227571577,0,-11.152974027741402],"scale":1.0129793324556147},{"type":"grass","position":[-107.41014996111174,0,29.829447610531236],"scale":1.096008669466166},{"type":"grass","position":[-60.015246624834255,0,84.04451260143894],"scale":1.1524489956983919},{"type":"grass","position":[14.262701827865138,0,-83.96253227276596],"scale":1.226132738113743},{"type":"grass","position":[29.986461958201907,0,-97.25707725941047],"scale":1.2820111919711197},{"type":"grass","position":[77.93517982344933,0,-86.01117356637063],"scale":0.9285565658237587},{"type":"grass","position":[-122.95180133598735,0,3.734761362566861],"scale":1.0909808830839767},{"type":"grass","position":[-59.16438138400367,0,9.885803081603564],"scale":0.9471807240113808},{"type":"grass","position":[-72.48111655270569,0,-19.24235058541695],"scale":0.7355273855412952},{"type":"grass","position":[46.03616717814444,0,-22.958051844609383],"scale":0.7086354314425614},{"type":"grass","position":[26.37926469110247,0,-67.62543348055861],"scale":1.101147680898334},{"type":"grass","position":[3.871258035747109,0,-6.305249289625429],"scale":0.835335021876676},{"type":"grass","position":[28.881993886275296,0,-143.65781298623992],"scale":0.820149041437413},{"type":"grass","position":[-67.28800115376366,0,-125.34102037278332],"scale":1.1095847141427932},{"type":"grass","position":[3.3357624673472825,0,25.95123783555957],"scale":0.9567340409941774},{"type":"grass","position":[-38.97863663844068,0,-23.340201333473207],"scale":1.0964229385256783},{"type":"grass","position":[75.86050703822835,0,14.981788568422889],"scale":1.2589169852509818},{"type":"grass","position":[-3.182962957042341,0,-15.605750919440668],"scale":0.8929342238237636},{"type":"grass","position":[12.62315173755678,0,8.397871443563881],"scale":1.246297702121991},{"type":"grass","position":[-2.438376981172182,0,2.9546385029455418],"scale":0.9476291176531797},{"type":"grass","position":[65.2586796587984,0,40.811120473340154],"scale":1.0919341288392412},{"type":"grass","position":[-94.59676406253925,0,-113.02463265123276],"scale":1.297706187260823},{"type":"grass","position":[33.571238307956406,0,15.696813697512633],"scale":1.1517099317812785},{"type":"grass","position":[26.786718006246947,0,-45.36669674016031],"scale":0.9188595363697846},{"type":"grass","position":[-34.583516368154235,0,47.43458344228923],"scale":0.982543322257561},{"type":"grass","position":[132.1083331454044,0,64.23942120450255],"scale":0.7579322367735626},{"type":"grass","position":[84.47661745777776,0,32.13634127267056],"scale":0.9574729488534842},{"type":"grass","position":[4.225476128647864,0,-136.2286997261639],"scale":1.1553559764635464},{"type":"grass","position":[-31.22936655173142,0,-58.36328471846716],"scale":0.7978409360448993},{"type":"grass","position":[-79.07403735904492,0,18.34538990505383],"scale":0.8640403005014148},{"type":"grass","position":[53.06023881341177,0,-38.84548375586767],"scale":1.1755632981129944},{"type":"grass","position":[-25.92963926760198,0,14.269163447425788],"scale":1.1069476571635037},{"type":"grass","position":[-98.21111158201454,0,-40.41767800187973],"scale":0.7627131997969783},{"type":"grass","position":[-8.989363125916668,0,21.750818840253764],"scale":1.1355597944426061},{"type":"grass","position":[68.21535070417103,0,129.30889198883114],"scale":0.7785988530141723},{"type":"grass","position":[-120.59468602339827,0,-63.557219591057596],"scale":1.174990824412318},{"type":"grass","position":[-97.22178539733324,0,-2.196180166481396],"scale":1.2596998280451182},{"type":"grass","position":[38.88113456361245,0,2.2833717713519888],"scale":0.9552813215163449},{"type":"grass","position":[-2.3062701719183463,0,9.553126297272447],"scale":1.2167048319309415},{"type":"grass","position":[63.76774932483908,0,1.9757017700868549],"scale":0.7728121965770454},{"type":"grass","position":[66.39205640539981,0,40.226409240915956],"scale":1.1004284667198472},{"type":"grass","position":[10.900691156026,0,18.327557053344616],"scale":0.9565960933300692},{"type":"grass","position":[-60.69477845029607,0,18.7140336409257],"scale":1.2124293922007814},{"type":"grass","position":[68.48457527581287,0,119.18598998421061],"scale":1.0796497928324233},{"type":"grass","position":[-40.02642733317911,0,-8.879242690664865],"scale":1.212372194739609},{"type":"grass","position":[-33.74773885069591,0,-24.03254590383261],"scale":1.2848592126944782},{"type":"grass","position":[82.17638854402222,0,-111.97144179771927],"scale":0.8797457253478534},{"type":"grass","position":[-17.47298866734567,0,-9.63145457612079],"scale":0.8495715915189389},{"type":"grass","position":[18.020082621441933,0,36.869687132061024],"scale":1.0527448716865697},{"type":"grass","position":[-107.26716409027023,0,37.03109348082953],"scale":1.006342680253177},{"type":"grass","position":[73.20331680029467,0,6.796817425733018],"scale":0.7514542560463259},{"type":"grass","position":[90.2495008941049,0,-4.950676756320516],"scale":1.162959274471382},{"type":"grass","position":[-29.497846985344623,0,-2.8962142908417583],"scale":0.9518168170419025},{"type":"grass","position":[40.81243281664545,0,72.41243720861506],"scale":1.1881407607888659},{"type":"grass","position":[-99.39689396788162,0,99.6687403927573],"scale":0.9241058091321123},{"type":"grass","position":[16.82445162997113,0,-13.363781112466215],"scale":1.199425265270488},{"type":"grass","position":[69.12624955246363,0,-109.18066996710493],"scale":0.906962460027425},{"type":"grass","position":[105.74020279794098,0,14.542997525355494],"scale":0.8661279956047803},{"type":"grass","position":[69.37961668258872,0,-132.86388108517735],"scale":1.2797788930387188},{"type":"grass","position":[3.5679298720038473,0,-53.50321454671526],"scale":1.2337801600134752},{"type":"grass","position":[58.822363045620484,0,42.164812905633966],"scale":0.837139500363596},{"type":"grass","position":[-45.087399920015706,0,-20.63737199824753],"scale":0.8165825398330686},{"type":"grass","position":[18.20478243642269,0,-58.27135333060699],"scale":0.9825989418284244},{"type":"grass","position":[-30.596292555242268,0,120.01635672967058],"scale":0.7619032915999128},{"type":"grass","position":[7.115612927757553,0,-38.39253285373722],"scale":1.2680267723384664},{"type":"grass","position":[27.294591856016666,0,-100.64078016379078],"scale":0.8848519067976846},{"type":"grass","position":[-40.00927881398752,0,128.05491036419193],"scale":1.1230902266573688},{"type":"grass","position":[51.95600922694237,0,-16.448722927836137],"scale":0.9125142470871089},{"type":"grass","position":[11.115434623527168,0,-25.56189661738778],"scale":0.9940955465251295},{"type":"grass","position":[124.94179194251853,0,39.640017297819384],"scale":0.9360241845232811},{"type":"grass","position":[-1.234415980536876,0,-10.93507894278297],"scale":0.9466137166514864},{"type":"grass","position":[-81.46042280550279,0,31.01526981935986],"scale":0.8603365965140133},{"type":"grass","position":[-20.443173518626956,0,24.353662770343757],"scale":1.2452134261114667},{"type":"grass","position":[50.45894721231636,0,-47.315117825036225],"scale":1.1411953482418558},{"type":"grass","position":[95.36423403051465,0,70.62487536389473],"scale":0.9024007967116973},{"type":"grass","position":[129.6928056745914,0,-68.99239117079242],"scale":0.8847689272902186},{"type":"grass","position":[1.3432165667064246,0,-24.679635362721836],"scale":1.288368977908338},{"type":"grass","position":[-7.617108322124396,0,-14.00583882371436],"scale":0.9185627050053469},{"type":"grass","position":[79.79125889705239,0,38.91633066877678],"scale":1.1853640533067524},{"type":"grass","position":[-17.707975128657477,0,71.58123583990907],"scale":0.8885369625802138},{"type":"grass","position":[-20.297980752926637,0,-15.295896084810877],"scale":1.062349142705759},{"type":"grass","position":[7.524420481646106,0,-7.396444841829288],"scale":1.252747953420119},{"type":"grass","position":[-3.5214087081339907,0,1.5472164996784858],"scale":1.0312610989725175},{"type":"grass","position":[50.34676726826115,0,-66.18159847195496],"scale":1.0964591288241756},{"type":"grass","position":[145.23269593433395,0,15.143487987173172],"scale":0.7405223862964222},{"type":"grass","position":[59.39712003345788,0,58.01662381750592],"scale":0.7824587142730901},{"type":"grass","position":[59.62595401518529,0,38.059369899739835],"scale":1.1279431330381864},{"type":"grass","position":[70.48692167374313,0,53.58682544460579],"scale":1.048091778275365},{"type":"grass","position":[37.72046463162383,0,53.24193796982694],"scale":0.9832612185308076},{"type":"grass","position":[-2.7461959203503437,0,1.1866331220418662],"scale":1.2648869103156226},{"type":"grass","position":[38.957176548362504,0,-43.738171633984045],"scale":1.05694747981522},{"type":"grass","position":[34.785859799201226,0,132.73625909018705],"scale":1.2469940448617625},{"type":"grass","position":[-13.32359201840515,0,-68.65843824148907],"scale":0.8268691004988262},{"type":"grass","position":[-25.63762867797389,0,42.530542503039015],"scale":1.290117651433453},{"type":"grass","position":[102.4622466578651,0,103.87709799178009],"scale":1.1605086547296026},{"type":"grass","position":[-34.0785593189208,0,-26.927677544103382],"scale":1.2055610561400942},{"type":"grass","position":[-36.33219973519261,0,-143.98354405300543],"scale":0.7541482332892452},{"type":"grass","position":[17.449888781044667,0,-146.90391335931704],"scale":0.8733539193158654},{"type":"grass","position":[10.868461710317852,0,-7.01230392844783],"scale":1.044419418375287},{"type":"grass","position":[26.05307950882642,0,92.76414921188459],"scale":0.8261639467175707},{"type":"grass","position":[72.83420293576187,0,-15.027691418067164],"scale":1.2384427781525602},{"type":"grass","position":[148.13320828135176,0,5.4484203100501345],"scale":0.9105897556980781},{"type":"grass","position":[-32.285450704302484,0,81.43287601909033],"scale":1.2753119666771209},{"type":"grass","position":[-59.20789280293197,0,-24.88119227995956],"scale":1.0721616174855337},{"type":"grass","position":[46.240469559014485,0,35.80974153990875],"scale":1.146926334139364},{"type":"grass","position":[-42.840184905603486,0,1.7596100994103798],"scale":0.879369486552138},{"type":"grass","position":[-15.65933723208958,0,112.21488879153115],"scale":0.7761293193337429},{"type":"grass","position":[-56.81443665080664,0,-17.564588794574764],"scale":0.8345906044971283},{"type":"grass","position":[-24.151655781665323,0,30.690287523448962],"scale":1.1375824541591022},{"type":"grass","position":[-44.348414860027795,0,109.07293976394934],"scale":0.7096742968755095},{"type":"grass","position":[-127.82215325278719,0,43.06606793880819],"scale":0.7396849763450158},{"type":"grass","position":[-9.443102605200856,0,116.31351915024248],"scale":1.216661790024172},{"type":"grass","position":[-84.74596839126035,0,14.18139874007135],"scale":1.2694524676288816},{"type":"grass","position":[-4.521638749791105,0,-2.1873990325911015],"scale":0.9545803874605205},{"type":"grass","position":[85.42179965935324,0,-82.66865772963186],"scale":1.0574430809438413},{"type":"grass","position":[-26.622744206088775,0,-60.09973206499013],"scale":0.9234576403343066},{"type":"grass","position":[39.65360307748638,0,101.84437736108357],"scale":0.9126502477997942},{"type":"grass","position":[18.899665301984104,0,-80.2068784638265],"scale":1.1917818461617407},{"type":"grass","position":[102.07496773050401,0,35.767837452574206],"scale":0.720343726691334},{"type":"grass","position":[97.33935644564765,0,-0.9239341730813263],"scale":0.9722499743171693},{"type":"grass","position":[-83.25393310692475,0,-47.28744589920778],"scale":0.8899242046477293},{"type":"grass","position":[17.38430083111663,0,-0.38205017044511846],"scale":0.9958083244866308},{"type":"grass","position":[-8.886058510121066,0,5.817955644939584],"scale":0.7933525775572026},{"type":"grass","position":[-8.775833185442748,0,38.039141565498745],"scale":0.8454611895653577},{"type":"grass","position":[16.520015655596275,0,86.85528077091735],"scale":0.7812238079730128},{"type":"grass","position":[-8.227890481046225,0,-17.547631410319063],"scale":0.9678484429212852},{"type":"grass","position":[9.10638845308136,0,51.56851237197381],"scale":1.209947320573832},{"type":"grass","position":[-91.3009120257776,0,99.12582384304133],"scale":1.005434576378637},{"type":"grass","position":[93.59987669163357,0,76.61664778675878],"scale":1.1000596370081528},{"type":"grass","position":[-1.016673158917464,0,-6.656289786066545],"scale":1.1731602549399058},{"type":"grass","position":[66.53388798777246,0,52.24710466269961],"scale":0.7534773288334299},{"type":"grass","position":[37.90019563918074,0,-11.191452422252304],"scale":1.1913963423210456},{"type":"grass","position":[-148.04452324579466,0,-12.69364268125356],"scale":1.1272422567132536},{"type":"grass","position":[72.32318080411001,0,106.49655264352718],"scale":0.8993345479215611},{"type":"grass","position":[-76.77702829433937,0,-4.509956296218764],"scale":0.8707132545504399},{"type":"grass","position":[-4.510858115349918,0,-44.47453171351764],"scale":0.919920216887648},{"type":"grass","position":[-72.23624545951137,0,-38.862990120358184],"scale":0.9858983555744414},{"type":"grass","position":[41.19299520789998,0,4.580603579411891],"scale":1.2412662635237512},{"type":"grass","position":[-0.5435184586024664,0,-0.09103534048253643],"scale":1.1730513401095677},{"type":"grass","position":[-24.456833054952277,0,11.604677698250237],"scale":1.1613308499563817},{"type":"grass","position":[120.797996087196,0,57.405458404818575],"scale":1.2299916298943103},{"type":"grass","position":[-29.350235535136502,0,72.90409846033177],"scale":0.9204262847523583},{"type":"grass","position":[6.39509560218622,0,104.95448245735399],"scale":0.7798375194285542},{"type":"grass","position":[37.60564883418944,0,78.16841160547652],"scale":0.9308642717445313},{"type":"grass","position":[113.02663924207218,0,-33.73797545644238],"scale":1.0835738553482712},{"type":"grass","position":[102.6552528247468,0,-71.75546469735424],"scale":1.126310396493666},{"type":"grass","position":[-0.3704434176303861,0,-1.5256259574691227],"scale":1.241150370272407},{"type":"grass","position":[-32.04855480188744,0,1.5692356974688992],"scale":0.8008215370123453},{"type":"grass","position":[-99.59985870600033,0,43.93503227442674],"scale":1.110195936178879},{"type":"grass","position":[-43.06479895101122,0,71.59083446551689],"scale":0.9623867600426691},{"type":"grass","position":[-148.76271497383138,0,4.623855853527239],"scale":0.7815454924243685},{"type":"grass","position":[70.81613195769235,0,39.08174487063695],"scale":0.8089767631712371},{"type":"grass","position":[133.11960703625198,0,-43.69010843812184],"scale":1.1717033306414502},{"type":"grass","position":[95.08641088367814,0,-83.26009536896893],"scale":0.7926681440900515},{"type":"grass","position":[31.105524952916486,0,6.2816006161874585],"scale":1.0108419583066128},{"type":"grass","position":[-10.2906911012679,0,-133.3405365227227],"scale":1.0418690246714621},{"type":"grass","position":[-28.665831307186657,0,-10.571448062729752],"scale":1.2303607459138999},{"type":"grass","position":[9.166488176792258,0,-8.792990580525409],"scale":0.9864973643865113},{"type":"grass","position":[-63.935978124796684,0,47.28448596539051],"scale":1.1769404281756606},{"type":"grass","position":[4.650487162407939,0,-64.6921587207435],"scale":1.062003428717598},{"type":"grass","position":[-44.94991603417729,0,67.27971779845267],"scale":1.1769500322592368},{"type":"grass","position":[-131.09127290565868,0,-59.35353372031855],"scale":0.7656364385867788},{"type":"grass","position":[48.805488120415994,0,-17.787379628772904],"scale":0.7497939863990112},{"type":"grass","position":[22.24448168919144,0,66.09396324776273],"scale":0.8220126610188393},{"type":"grass","position":[66.16112756182204,0,-104.3482166182268],"scale":0.7713769823826204},{"type":"grass","position":[134.6853986162883,0,22.341843950368517],"scale":0.7963784554197731},{"type":"grass","position":[10.223468743292033,0,-12.602376859852116],"scale":1.0129214291108606},{"type":"grass","position":[102.23964718858161,0,-30.11652910336166],"scale":1.1716121605378633},{"type":"grass","position":[-33.64871161959679,0,-0.4468989078060573],"scale":0.8452922758548734},{"type":"grass","position":[82.98265674471371,0,73.06023048323623],"scale":1.021333007046529},{"type":"grass","position":[0.5203529057461291,0,0.38840260882492356],"scale":0.8344355533395977},{"type":"grass","position":[25.85390372616859,0,20.43773543639258],"scale":0.9723245473838072},{"type":"grass","position":[55.40568133687721,0,-25.20695676267458],"scale":1.2382355162628171},{"type":"grass","position":[-11.81527225328515,0,3.644366464111925],"scale":1.0547626641618877},{"type":"grass","position":[-1.8402607807257703,0,0.8385649611738513],"scale":1.297252005784732},{"type":"grass","position":[8.02759253140476,0,-3.3140658957794784],"scale":1.1667943605942979},{"type":"grass","position":[-7.8828591259374985,0,-96.02260524719489],"scale":1.09948556886026},{"type":"grass","position":[-93.8728652152619,0,32.14444012455027],"scale":0.8148342002595091},{"type":"grass","position":[-110.6311146254265,0,-90.78769204665507],"scale":1.0936939175286189},{"type":"grass","position":[-50.23849713543384,0,132.43323142532043],"scale":0.7880696827115307},{"type":"grass","position":[83.76312288649977,0,47.59051929444255],"scale":0.8133488845995638},{"type":"grass","position":[135.9052167362978,0,10.535801896142406],"scale":0.7875999667957335},{"type":"grass","position":[9.081205747489468,0,-21.015999342651963],"scale":0.8946843830601817},{"type":"grass","position":[-122.7366049193326,0,13.661023145227698],"scale":1.2104787202366212},{"type":"grass","position":[-5.063812003801405,0,114.59721437621477],"scale":0.9112987247655049},{"type":"grass","position":[-142.23397139707834,0,10.352400340437436],"scale":1.148903987081618},{"type":"grass","position":[107.52558284655713,0,-8.899485749182332],"scale":1.2092602176744327},{"type":"grass","position":[-45.081700711490875,0,110.70818114180746],"scale":0.9026313818425805},{"type":"grass","position":[41.27307875958696,0,13.418878620219045],"scale":0.7130512282805896},{"type":"grass","position":[117.86835206112607,0,84.50214513735966],"scale":1.0284786111215034},{"type":"grass","position":[-37.90214717477938,0,30.13411275676683],"scale":0.9079897210074269},{"type":"grass","position":[-71.73936360442524,0,-56.17530689580969],"scale":0.9925938892963833},{"type":"grass","position":[-57.83031007048966,0,8.718394048389344],"scale":1.067623435452634},{"type":"grass","position":[-15.880830589457913,0,-83.37239063991504],"scale":1.2827249641025469},{"type":"grass","position":[-76.40930267733599,0,-47.920853861370595],"scale":0.8162965723375948},{"type":"grass","position":[-65.4712661247593,0,-50.355238686540986],"scale":0.954843126949187},{"type":"grass","position":[-83.66216814322422,0,-25.071676693147904],"scale":1.1628025915528852},{"type":"grass","position":[1.788967912467652,0,-2.841403194450765],"scale":0.7646807273752201},{"type":"grass","position":[15.353699348111782,0,3.7175261280804803],"scale":1.0699408386572984},{"type":"grass","position":[-57.18246163149962,0,-125.50360814623416],"scale":1.1154199837961498},{"type":"grass","position":[-56.04504481789258,0,-104.87333729501518],"scale":1.155987081017504},{"type":"grass","position":[13.53449475779047,0,37.92055256762537],"scale":1.1551970020283537},{"type":"grass","position":[18.230665449799055,0,-12.782728702635486],"scale":1.2654169089795642},{"type":"grass","position":[-40.14341506316663,0,31.644524239489353],"scale":0.8693154216927593},{"type":"grass","position":[33.445604039279424,0,51.26218659239685],"scale":1.0859393949579472},{"type":"grass","position":[0.8616445830655316,0,1.1020739166944191],"scale":0.9413280240882425},{"type":"grass","position":[2.7775698737158687,0,-58.86050800999703],"scale":0.9723777895225532},{"type":"grass","position":[-6.251838286528276,0,5.461560480699522],"scale":0.9968424625200731},{"type":"grass","position":[-38.27300074126379,0,-66.46548337448812],"scale":0.721359057495271},{"type":"grass","position":[79.96950238233057,0,85.33861592339908],"scale":0.9388370129318381},{"type":"grass","position":[6.693302647298839,0,-2.1472616509855604],"scale":1.126450240895759},{"type":"grass","position":[6.765984448684301,0,-59.96033226027662],"scale":0.7497830875116899},{"type":"grass","position":[-133.95237617998677,0,-23.16131957055671],"scale":0.9846207857083846},{"type":"grass","position":[-21.2871160329136,0,-125.18943140371854],"scale":0.8333240839150429},{"type":"grass","position":[-69.63119147015426,0,104.17097845774711],"scale":1.2446914519221295},{"type":"grass","position":[4.288390749285088,0,-70.32756583896152],"scale":0.7925646273289663},{"type":"grass","position":[-51.56369346862107,0,69.92556488817245],"scale":1.0226090721395695},{"type":"grass","position":[-110.80592092925767,0,78.36114306179037],"scale":1.2886548932774942},{"type":"grass","position":[-8.022492631484354,0,-14.05182664361155],"scale":1.053106477752945},{"type":"grass","position":[-11.691396399575005,0,-139.8496760470369],"scale":1.0499048330454939},{"type":"grass","position":[-32.42216947386779,0,26.035117024545933],"scale":0.8291060863698108},{"type":"grass","position":[-41.363038300020335,0,-79.8133011085671],"scale":1.060730264048222},{"type":"grass","position":[-75.6206650818336,0,61.364654765657114],"scale":1.2433487196675705},{"type":"grass","position":[-26.586968570679108,0,32.6035503665551],"scale":0.7339515198930558},{"type":"grass","position":[-28.051409751144664,0,-58.90321315695843],"scale":0.9658440066802902},{"type":"grass","position":[134.67511444592026,0,30.97974172784888],"scale":0.7374630341343823},{"type":"grass","position":[-136.21265385586588,0,3.1654592349380946],"scale":1.1597118454931257},{"type":"grass","position":[-138.69726628104377,0,-39.38771445976873],"scale":0.956092677809337},{"type":"grass","position":[-7.198416246683235,0,-21.151125073027522],"scale":1.1692826439361603},{"type":"grass","position":[87.63788966949606,0,-93.4520825404099],"scale":0.8612752661548893},{"type":"grass","position":[-21.111186227804676,0,93.47878443213855],"scale":1.1980746615751656},{"type":"grass","position":[44.79694442485528,0,59.23849119036464],"scale":0.7119856805425743},{"type":"grass","position":[59.178372935580384,0,-107.68862427770034],"scale":1.2035388405385599},{"type":"grass","position":[-29.249277564631253,0,42.056683274774244],"scale":1.268207081940342},{"type":"grass","position":[-0.42512747795255773,0,-0.591105029395798],"scale":0.9420141688145963},{"type":"grass","position":[-62.18846329219887,0,-27.317277082943267],"scale":0.7669981245258047},{"type":"grass","position":[34.458822020672145,0,-59.22457336928772],"scale":0.877198164347179},{"type":"grass","position":[-29.524743484545215,0,-14.35798638989075],"scale":1.0639049000836476},{"type":"grass","position":[83.43830880918414,0,8.596037897661843],"scale":0.7638824871244876},{"type":"grass","position":[9.920519742442641,0,148.6647292603153],"scale":0.7284098620536614},{"type":"grass","position":[5.021804123924353,0,-13.28151509930096],"scale":1.1886452256006959},{"type":"grass","position":[55.588344002385035,0,-11.682029743201522],"scale":0.8977662126989925},{"type":"grass","position":[109.22306634085588,0,-63.48632224565416],"scale":0.7122970464163272},{"type":"grass","position":[21.08672031118623,0,99.2718369733624],"scale":1.0156393665923724},{"type":"grass","position":[-18.265824479150837,0,-12.677515316424353],"scale":0.7479444943081148},{"type":"grass","position":[-75.48572368157566,0,-50.64522505545194],"scale":1.1489590459095036},{"type":"grass","position":[-14.41364162049793,0,114.90720804164603],"scale":0.8666304210840309},{"type":"grass","position":[-58.66229862311642,0,-2.8353791677084823],"scale":1.281466901970666},{"type":"grass","position":[34.816829686110985,0,-25.755054943851068],"scale":1.1489414375043272},{"type":"grass","position":[92.2116762306731,0,13.240962860849518],"scale":1.124709788891288},{"type":"grass","position":[-84.65340677606055,0,46.41675181284883],"scale":0.9691524947431523},{"type":"grass","position":[103.00810228219308,0,-39.89575269372713],"scale":0.8070089253732904},{"type":"grass","position":[-48.04482269387033,0,-80.47995482970441],"scale":1.2676021296553979},{"type":"grass","position":[15.852912212178083,0,80.9101783927362],"scale":0.8835791612142135},{"type":"grass","position":[117.06862110896056,0,88.32489187601801],"scale":1.2629464533086345},{"type":"grass","position":[-72.03175985871397,0,-18.02481340341031],"scale":1.0514294026348332},{"type":"grass","position":[-6.684654217340148,0,20.539159784923815],"scale":1.2221432350225792},{"type":"grass","position":[61.89069419454507,0,10.861392552085757],"scale":1.288394577033761},{"type":"grass","position":[19.192541211092106,0,17.892091535168383],"scale":0.9218447131851368},{"type":"grass","position":[-41.97740311553453,0,-49.61224170482325],"scale":0.8907405412552554},{"type":"grass","position":[31.29012237643316,0,60.77395237678874],"scale":1.014393892300885},{"type":"grass","position":[74.86499445793118,0,62.067262814123445],"scale":1.2900856549690696},{"type":"grass","position":[-18.292441117589046,0,-19.237442921251525],"scale":1.1274855504679153},{"type":"grass","position":[-82.60648616047942,0,64.82069368352198],"scale":1.0284321604995394},{"type":"grass","position":[-83.00336416505817,0,-54.05644517148292],"scale":0.8187226968348225},{"type":"grass","position":[18.22497324092379,0,57.427829012339345],"scale":1.2283163773219554},{"type":"grass","position":[16.91482187750713,0,-10.06380830933839],"scale":0.7539139420601393},{"type":"grass","position":[-15.722499946642415,0,47.4725825024522],"scale":0.7706397907223194},{"type":"grass","position":[7.158362180835462,0,-9.446035249526805],"scale":0.8148444987827653},{"type":"grass","position":[-24.094721288058228,0,3.539114030781778],"scale":1.2558604787338636},{"type":"grass","position":[61.06621114685452,0,-5.122477096256399],"scale":0.8777444054891353},{"type":"grass","position":[1.0746479106830578,0,-21.533674281459543],"scale":0.7401538424754323},{"type":"grass","position":[121.00862256653471,0,-67.77953737838877],"scale":1.0812705225423673},{"type":"grass","position":[-0.3384719637316736,0,-20.61465326536465],"scale":0.9659801670593098},{"type":"grass","position":[-28.006711709317617,0,-21.17814348858852],"scale":0.9764627723582645},{"type":"grass","position":[5.472410717541728,0,-8.82346497585996],"scale":0.9508148604480229},{"type":"grass","position":[-36.171465621171826,0,-4.1865155956198326],"scale":0.9064627457389445},{"type":"grass","position":[85.09825848192368,0,-17.538328967976636],"scale":0.8692572377505228},{"type":"grass","position":[-48.55251917684539,0,1.7714458176758443],"scale":0.9428576959142448},{"type":"grass","position":[-7.402427608290567,0,37.44019351241781],"scale":0.8621396406805728},{"type":"grass","position":[-34.24951773929265,0,85.53707000825013],"scale":0.8594815818633466},{"type":"grass","position":[-33.36766150430807,0,-88.7427890663606],"scale":1.0047009647988805},{"type":"grass","position":[-0.9444609526102855,0,1.7973464469613916],"scale":0.8583387673764029},{"type":"grass","position":[-89.50325834767803,0,19.98466360244836],"scale":1.2603877289737437},{"type":"grass","position":[-32.38257124526802,0,130.73526368741292],"scale":1.272602680239019},{"type":"grass","position":[-90.52769152348039,0,21.614169326979894],"scale":1.2971512818355895},{"type":"grass","position":[46.859600443262416,0,58.92893332410013],"scale":0.8102638271940125},{"type":"grass","position":[94.11407554304627,0,36.50422488378933],"scale":1.2537447152024845},{"type":"grass","position":[-9.902866762371879,0,-52.20729387093034],"scale":0.9356184007610379},{"type":"grass","position":[33.135154866795794,0,-56.75313941830468],"scale":0.8125169082267583},{"type":"grass","position":[-29.440180970271292,0,-42.53787598103186],"scale":1.2107632231582015},{"type":"grass","position":[-66.230911078944,0,-1.2510843444663435],"scale":0.8480758549045708},{"type":"grass","position":[-2.793702982813962,0,134.4409188016091],"scale":0.7655032264700906},{"type":"grass","position":[0.4598865864555295,0,2.1691316826304425],"scale":1.0673828042237918},{"type":"grass","position":[-47.79093985063159,0,-108.71774285129274],"scale":1.0354027630795941},{"type":"grass","position":[51.97990257623591,0,122.76047432855658],"scale":1.0680196433315179},{"type":"grass","position":[-36.919290855614406,0,1.6246383311583936],"scale":0.7457585546628878},{"type":"grass","position":[-75.92866061039967,0,8.5660099086562],"scale":0.9493797443558456},{"type":"grass","position":[68.20554358654887,0,30.51610539596162],"scale":1.0846038228420098},{"type":"grass","position":[54.63055878401002,0,100.34612539756982],"scale":0.9318816769416045},{"type":"grass","position":[6.5331552764761955,0,-0.23981520987418561],"scale":0.7890905464260325},{"type":"grass","position":[62.60764345611234,0,23.689366595015436],"scale":1.006158990331301},{"type":"grass","position":[-10.302931558006696,0,64.78106475804404],"scale":0.8571782269371706},{"type":"grass","position":[54.12534030917137,0,-138.79923175673034],"scale":0.9661911723727532},{"type":"grass","position":[-61.30416381553412,0,-81.37136646493036],"scale":0.7777293352504864},{"type":"grass","position":[-120.4156489509308,0,71.19051958998557],"scale":1.1254296444799472},{"type":"grass","position":[0.3926733757299216,0,3.4274835906577725],"scale":1.2022331978870358},{"type":"grass","position":[-44.23564527949983,0,38.9959875120617],"scale":1.135895877597717},{"type":"grass","position":[33.576528386456154,0,13.411219037880194],"scale":1.0226676113671278},{"type":"grass","position":[111.88798786727183,0,-10.959056365927424],"scale":1.20330151018015},{"type":"grass","position":[2.248953566509486,0,31.98949170157453],"scale":1.1593482946770695},{"type":"grass","position":[148.92944706440838,0,15.854911611061612],"scale":1.1316604087455342},{"type":"grass","position":[54.33645177413451,0,-64.19923659021379],"scale":0.925911896261375},{"type":"grass","position":[10.49326903229477,0,-59.79793286914531],"scale":1.1222703716269804},{"type":"grass","position":[-47.52067184289811,0,-60.09327109730929],"scale":1.0112837752643173},{"type":"grass","position":[-11.791481859548679,0,-17.743507099576746],"scale":1.0931798039716618},{"type":"grass","position":[14.899824223199616,0,25.164661226449844],"scale":0.9394561655173189},{"type":"grass","position":[0.7354923467710963,0,1.9203772723235806],"scale":0.8224999923709563},{"type":"grass","position":[24.171012823452777,0,11.453409238864115],"scale":1.2567814585842414},{"type":"grass","position":[-97.78358858497214,0,51.27881107842127],"scale":0.7389074548242262},{"type":"grass","position":[-21.254099219192167,0,-13.917558277362392],"scale":1.1562593649934036},{"type":"grass","position":[-46.31189480310255,0,-1.2476170085859861],"scale":1.1859697437921013},{"type":"grass","position":[-22.817261079749322,0,-47.40025115321626],"scale":1.0992899586798832},{"type":"grass","position":[29.704152367638002,0,-120.39232417565523],"scale":0.8265263774907643},{"type":"grass","position":[115.23963206637278,0,-37.187005336363605],"scale":0.8466663505588927},{"type":"grass","position":[-18.64000157007229,0,29.385883157090223],"scale":0.8546887075851105},{"type":"grass","position":[38.11541303950987,0,89.7202615222463],"scale":1.1939808613112333},{"type":"grass","position":[-37.765836765361996,0,1.999722866359534],"scale":1.2249936147544869},{"type":"grass","position":[20.85425401445283,0,-65.55277365355143],"scale":0.7252254994568081},{"type":"grass","position":[87.43223543848244,0,60.745992658688166],"scale":1.2225040788471326},{"type":"grass","position":[111.30444501488101,0,-10.910026942541256],"scale":0.834466411185154},{"type":"grass","position":[18.859567620016794,0,-8.245677348553956],"scale":0.7376584223673047},{"type":"grass","position":[-14.97380751657055,0,38.11870014491613],"scale":0.9406091682235108},{"type":"grass","position":[-76.80885097236155,0,-119.2144151935299],"scale":1.138969210056777},{"type":"grass","position":[86.33350948042639,0,31.004883131444387],"scale":0.830166399714081},{"type":"grass","position":[-3.8310171748600257,0,55.733401722127375],"scale":0.7334291996017839},{"type":"grass","position":[136.51957298742093,0,-9.311897334359855],"scale":1.018869525837158},{"type":"grass","position":[-120.9275684198425,0,62.08985644553526],"scale":1.1382203637082422},{"type":"grass","position":[-77.08522731691595,0,40.21906529497571],"scale":0.7013805906464521},{"type":"grass","position":[26.983806424011178,0,-20.81537383939352],"scale":1.1730442379796007},{"type":"grass","position":[-35.26169186689458,0,-67.41223370091078],"scale":0.82488941009591},{"type":"grass","position":[-86.94123329320529,0,62.441508367199255],"scale":0.9773425372382958},{"type":"grass","position":[8.084177291506895,0,-6.8935121070672185],"scale":0.7510543461117021},{"type":"grass","position":[6.260245897392326,0,-65.8068280642452],"scale":1.2779720086915463},{"type":"grass","position":[-44.898591707571896,0,-51.66421008463892],"scale":1.0241074154994045},{"type":"grass","position":[-83.28057568236999,0,42.35104711992507],"scale":0.8152407627726861},{"type":"grass","position":[68.43284804557901,0,-46.285266575258355],"scale":1.1648418832861407},{"type":"grass","position":[33.565427500741315,0,-131.45405831714027],"scale":1.239696012467172},{"type":"grass","position":[1.9089931495350154,0,7.3168917026703255],"scale":0.8739859224510924},{"type":"grass","position":[-66.87571901830727,0,-29.952534848762205],"scale":1.2239886351607208},{"type":"grass","position":[-125.72042600296326,0,76.13545003525066],"scale":0.7451931671276872},{"type":"grass","position":[38.41893644478999,0,-33.76954593671161],"scale":1.0171091034224606},{"type":"grass","position":[26.34936470468538,0,-98.43090661558459],"scale":1.0682270326006655},{"type":"grass","position":[-115.58737963553581,0,3.5933164112271974],"scale":0.9454652080149912},{"type":"grass","position":[-57.13902888275774,0,-110.8042885960015],"scale":1.0609000484411233},{"type":"grass","position":[-1.4184447137577227,0,68.08437465025673],"scale":0.9648994450351849},{"type":"grass","position":[-27.983325310660394,0,0.8605070407502483],"scale":1.2528389209999031},{"type":"grass","position":[5.571265951051654,0,9.35971069971843],"scale":0.9675562530544204},{"type":"grass","position":[-95.1366534774482,0,-89.28830092046434],"scale":0.8489998946182647},{"type":"grass","position":[-52.25015456164494,0,56.89799425628376],"scale":1.2091281967920626},{"type":"grass","position":[63.506725646493365,0,-102.9567309832388],"scale":0.9798380637915322},{"type":"grass","position":[-50.848199152925346,0,103.07353150373372],"scale":1.1718389713552742},{"type":"grass","position":[35.407102412680324,0,-106.49342187593864],"scale":0.9364206992112671},{"type":"grass","position":[109.51083143948742,0,-6.808249503726643],"scale":0.8800586033361225},{"type":"grass","position":[-17.49323469989518,0,75.327280820045],"scale":1.0237705615697383},{"type":"grass","position":[-49.93539261335588,0,48.3395875322935],"scale":0.8074807745270454},{"type":"grass","position":[22.824312768698597,0,-139.93183205854396],"scale":0.9717273106962603},{"type":"grass","position":[54.676229357605365,0,93.37913357459256],"scale":0.8205606852012637},{"type":"grass","position":[-38.10449327520156,0,36.300906879489006],"scale":1.0563395249751266},{"type":"grass","position":[-33.07031859390367,0,118.82993795429189],"scale":0.8934234017141569},{"type":"grass","position":[87.57363623852561,0,34.098452838177344],"scale":0.8588983805373467},{"type":"grass","position":[-8.18362956781252,0,26.924776030483592],"scale":1.0000832423239971},{"type":"grass","position":[92.4038133350479,0,111.99605670019845],"scale":1.2779102106436717},{"type":"grass","position":[29.186816155967783,0,62.28891727504923],"scale":0.8056831297245356},{"type":"grass","position":[-36.134986838494704,0,133.18930337503824],"scale":1.13183388594611},{"type":"grass","position":[1.04172966008171,0,-77.80068224318444],"scale":0.7990309411932344},{"type":"grass","position":[1.8955553872240434,0,-7.1058227708017805],"scale":1.0823399454843425},{"type":"grass","position":[-70.4738937491019,0,10.564183383573994],"scale":0.8249148514693908},{"type":"grass","position":[58.374146542021926,0,76.89679247851304],"scale":0.7845293882524387},{"type":"grass","position":[-119.04800669494038,0,49.35486917454294],"scale":0.7753433028956097},{"type":"grass","position":[49.39409906304431,0,67.40970350983925],"scale":0.7905018198206691},{"type":"grass","position":[-1.2896207937113502,0,4.125026630467853],"scale":1.1962760392762215},{"type":"grass","position":[-92.15263797811386,0,-36.117089336297695],"scale":1.2026374446252146},{"type":"grass","position":[-48.27912274504681,0,115.50619375940983],"scale":0.7231583197784869},{"type":"grass","position":[-77.43966662355953,0,46.58227537933286],"scale":0.8021498836857566},{"type":"grass","position":[68.44490036755104,0,33.60566826924531],"scale":1.1294819937376437},{"type":"grass","position":[15.945320808897486,0,10.47032539203331],"scale":0.9526791673843037},{"type":"grass","position":[10.620268818697339,0,6.81629718121216],"scale":0.7600269867776288},{"type":"grass","position":[-27.23354656209147,0,112.22480432480286],"scale":1.1894538060189788},{"type":"grass","position":[-81.62652197128395,0,35.40769445759137],"scale":1.2651073539162216},{"type":"grass","position":[23.422869507464046,0,-6.029178471084719],"scale":1.0632836621681523},{"type":"grass","position":[-0.003974166610292439,0,0.00037589583091545857],"scale":0.9150364239761442},{"type":"grass","position":[27.94620721964353,0,40.53390167696827],"scale":1.0416682707508933},{"type":"grass","position":[-141.18535361941673,0,-38.27161629375428],"scale":1.1356479226733318},{"type":"grass","position":[106.05002737061753,0,38.61597287638563],"scale":0.9371003084475955},{"type":"grass","position":[7.85800153314533,0,-21.818040863615582],"scale":1.0612573144538102},{"type":"grass","position":[5.248450841281217,0,16.44502507949929],"scale":0.9791158630312315},{"type":"grass","position":[-112.55860423817315,0,53.969781256262706],"scale":1.0319853812865294},{"type":"grass","position":[106.45944610914415,0,-3.758291810791275],"scale":0.9060708223163787},{"type":"grass","position":[45.35074620620554,0,-34.427145586590676],"scale":0.79735729894791},{"type":"grass","position":[-51.352096348654754,0,-65.16266376362232],"scale":1.288366791202353},{"type":"grass","position":[-77.25361443469029,0,12.553664875291226],"scale":1.1319590616365},{"type":"grass","position":[-72.00901607615609,0,-108.5202528309267],"scale":1.0315681724603687},{"type":"grass","position":[-80.92762123991275,0,66.31926652530169],"scale":0.7592402986884961},{"type":"grass","position":[-54.94275124843274,0,55.6517387928703],"scale":0.7199092660302844},{"type":"grass","position":[-21.181992775638275,0,20.96133187379889],"scale":0.8090760231804648},{"type":"grass","position":[47.82513620133359,0,-17.26716194562707],"scale":0.8156585647500482},{"type":"grass","position":[51.67884870465661,0,-60.59868158015683],"scale":1.1400325748688855},{"type":"grass","position":[-44.47845898675043,0,-2.8698809867278006],"scale":0.9689573379467117},{"type":"grass","position":[27.14450016344144,0,20.211946151609105],"scale":0.7359304134906255},{"type":"grass","position":[-141.19849842940764,0,0.4690657865273368],"scale":1.0709509024630333},{"type":"grass","position":[-3.653710350542833,0,7.951225791477319],"scale":0.8784340088757794},{"type":"grass","position":[119.97429488501136,0,3.0693172203584336],"scale":0.8490936411323416},{"type":"grass","position":[-19.936282984491427,0,-40.23582887799084],"scale":1.0453921252043226},{"type":"grass","position":[57.353551309068415,0,24.580042454961003],"scale":1.0969500722967036},{"type":"grass","position":[103.56942520798812,0,-67.21213279837977],"scale":0.8113684841082526},{"type":"grass","position":[-42.362308278396476,0,24.780495682778135],"scale":1.0637532518722408},{"type":"grass","position":[-13.880497242078421,0,63.086990297780105],"scale":0.961871306228085},{"type":"grass","position":[-34.73741023241831,0,-36.596299400574644],"scale":1.034333064835716},{"type":"grass","position":[28.632634456725416,0,-138.35092150803234],"scale":1.0361562304917609},{"type":"grass","position":[41.47450925571619,0,-60.868586290337255],"scale":1.0405804165424983},{"type":"grass","position":[28.8761779006969,0,4.755872118611254],"scale":0.8024769196869803},{"type":"grass","position":[-45.50955509199043,0,-23.680583816544225],"scale":1.181449022525702},{"type":"grass","position":[3.4833581130133418,0,128.5204111432674],"scale":0.7492053990791937},{"type":"grass","position":[-12.960297656786922,0,7.85645290802352],"scale":1.2461855956503989},{"type":"grass","position":[12.499517740184997,0,-10.564110826834376],"scale":1.1444592310566164},{"type":"grass","position":[12.93411118095195,0,-16.410125923857382],"scale":0.7527797668374736},{"type":"grass","position":[28.606804731960306,0,35.69250395750095],"scale":1.213486465332261},{"type":"grass","position":[93.31017944365193,0,-70.24745509332173],"scale":1.046797513762967},{"type":"grass","position":[-1.8695343029952973,0,79.55223642741088],"scale":1.1256804771656794},{"type":"grass","position":[-38.75225830797506,0,-17.261584387443893],"scale":1.231024066324093},{"type":"grass","position":[62.18809520380949,0,5.13944259311481],"scale":0.81141061189688},{"type":"grass","position":[47.0422003699972,0,-1.220489958298453],"scale":1.0695891997716507},{"type":"grass","position":[-14.505546023209885,0,4.541507519027084],"scale":0.9865921501154149},{"type":"grass","position":[-22.418987300306288,0,113.91171715445729],"scale":1.2400896884358752},{"type":"grass","position":[13.19030830123815,0,-16.61935092946531],"scale":0.9827725147853449},{"type":"grass","position":[-26.90863852715308,0,49.053413421846805],"scale":0.8568755180114096},{"type":"grass","position":[-143.94956498447002,0,0.21069667210226312],"scale":0.9140862623118602},{"type":"grass","position":[-39.624827265590945,0,140.4943829107537],"scale":1.0703245210994496},{"type":"grass","position":[11.069185566112182,0,-17.80185156558458],"scale":1.0447501265393715},{"type":"grass","position":[47.2739887998126,0,68.32615115629963],"scale":0.7204690731201652},{"type":"grass","position":[30.07988345042894,0,-30.74586414172152],"scale":0.9958953082528069},{"type":"grass","position":[-52.67451944014011,0,-45.46045555665085],"scale":1.1256023377316253},{"type":"grass","position":[145.15489786135328,0,-4.908875894784155],"scale":0.7979665583750001},{"type":"grass","position":[57.718073531473216,0,3.7206325340015147],"scale":1.1345050870584472},{"type":"grass","position":[-22.977554380625026,0,2.18623217896553],"scale":1.281244762579099},{"type":"grass","position":[-1.5863092666036622,0,-6.964635583299546],"scale":0.7303695324252623},{"type":"grass","position":[-87.91424923771775,0,31.456696032266418],"scale":0.8670443384821186},{"type":"grass","position":[-12.040029389764598,0,-34.4477478462656],"scale":0.9277264290837509},{"type":"grass","position":[0.28903899838550545,0,0.13403365255803928],"scale":1.212877298966967},{"type":"grass","position":[44.380260901247865,0,15.767125369628973],"scale":0.9794776471263008},{"type":"grass","position":[-88.29485316940118,0,12.757061327677292],"scale":1.2339126858616893},{"type":"grass","position":[-9.045851642306628,0,91.02386148264767],"scale":1.1460619303604402},{"type":"grass","position":[104.41186060390808,0,33.96107787359231],"scale":0.9931161097282168},{"type":"grass","position":[-12.366268926464409,0,-21.79824442488188],"scale":0.7073910780026557},{"type":"grass","position":[-31.99296336797077,0,16.59381577283514],"scale":1.1420161566017384},{"type":"grass","position":[46.095902851994644,0,103.29379556840571],"scale":0.7304098505012926},{"type":"grass","position":[-20.917325276264798,0,2.088362284237216],"scale":1.2971296309171003},{"type":"grass","position":[-58.22435521432834,0,-39.674245662330335],"scale":1.0738483374190975},{"type":"grass","position":[-140.63950435354536,0,48.61368490992222],"scale":1.0954401595471646},{"type":"grass","position":[-25.916629385624077,0,24.005421958942378],"scale":0.8580394822397619},{"type":"grass","position":[-17.99733670328578,0,19.509370416434766],"scale":1.0609132439087465},{"type":"grass","position":[110.5691560892234,0,-77.0764831327529],"scale":1.258513425084474},{"type":"grass","position":[46.77643333704643,0,-75.63611914760027],"scale":1.1021354275118123},{"type":"grass","position":[-8.11309384567668,0,-18.426344461826766],"scale":1.0239286749096015},{"type":"grass","position":[4.060130484677053,0,46.60854002003068],"scale":1.2703962750652775},{"type":"grass","position":[-63.32538819239594,0,-31.258584116107272],"scale":0.9613145082678174},{"type":"grass","position":[17.66166537348703,0,-41.336227534760944],"scale":1.0967079518485545},{"type":"grass","position":[97.5094639356732,0,-18.76217897967178],"scale":1.153775879726904},{"type":"grass","position":[-28.442610049702214,0,-19.201333899871006],"scale":1.164005895807784},{"type":"grass","position":[103.1425574555459,0,72.06492510804357],"scale":0.7040595573080556},{"type":"grass","position":[-27.535728880025186,0,-34.27656602282497],"scale":0.9291472004172444},{"type":"grass","position":[-91.90937527171549,0,67.76065736514617],"scale":0.8554031312108434},{"type":"grass","position":[33.46237534271627,0,-31.306668578146688],"scale":1.21812245887858},{"type":"grass","position":[9.141228183717667,0,-4.492514501074457],"scale":1.048389086483478},{"type":"grass","position":[-52.47796954560709,0,-19.68650200578416],"scale":0.9887784294662522},{"type":"grass","position":[-29.881770668530702,0,-89.03545592748293],"scale":0.8402013707674072},{"type":"grass","position":[-0.21692118275237893,0,-0.04925471119238776],"scale":0.9631279473673279},{"type":"grass","position":[-17.552482711350176,0,117.32155565877889],"scale":1.2234529805915595},{"type":"grass","position":[-6.799950664209201,0,39.84093071379454],"scale":1.1356775930855783},{"type":"grass","position":[23.410236034567276,0,29.453713129033957],"scale":0.797471258739922},{"type":"grass","position":[-40.236638810051595,0,-18.317442126204416],"scale":1.167915086672815},{"type":"grass","position":[-1.402715035425916,0,69.34951403580224],"scale":0.7755323048253011},{"type":"grass","position":[-0.01766512005272864,0,0.12588730198473863],"scale":1.0653081897230228},{"type":"grass","position":[-7.753521837667287,0,9.086537484332089],"scale":1.0848363167092157},{"type":"grass","position":[-52.02106457631991,0,-40.606390358951586],"scale":0.9030103942043138},{"type":"grass","position":[-11.610807748669744,0,1.033777564690687],"scale":0.8004299894058349},{"type":"grass","position":[-60.16840805316001,0,-105.68922612657788],"scale":1.2678438082045111},{"type":"grass","position":[-99.27084174605795,0,26.410510692616853],"scale":0.7303402825910009},{"type":"grass","position":[-121.50904946131547,0,-33.93917121218624],"scale":1.1111344908370533},{"type":"grass","position":[-54.42607823471696,0,-53.309193636327585],"scale":0.9240913677138034},{"type":"grass","position":[-97.66371779306586,0,90.31526583142522],"scale":0.9523550188219914},{"type":"grass","position":[8.717242997670125,0,2.596455483117563],"scale":0.7314799760419686},{"type":"grass","position":[126.1970763707593,0,21.25721862561648],"scale":1.1126996665360425},{"type":"grass","position":[63.59099016075191,0,49.102288983539054],"scale":0.8886961102485147},{"type":"grass","position":[-78.30786588193011,0,-125.34963592728387],"scale":1.1142140891793404},{"type":"grass","position":[-80.79519407959252,0,-108.42583188271188],"scale":1.008296783115049},{"type":"grass","position":[-64.62483644248853,0,-32.078088741793636],"scale":0.95880698469892},{"type":"grass","position":[-65.56268104840329,0,91.96027796230905],"scale":0.9588105461416679},{"type":"grass","position":[58.54886312693533,0,-98.7213827500498],"scale":0.9983238716378284},{"type":"grass","position":[-32.192810317302836,0,110.39115465727653],"scale":0.9948523684705983},{"type":"grass","position":[-85.79233121808798,0,90.0034848953007],"scale":0.7125092543214625},{"type":"grass","position":[62.77083829407724,0,-4.114519576137876],"scale":0.7883147777735584},{"type":"grass","position":[-5.684506728915529,0,32.18552642141149],"scale":1.147011128418949},{"type":"grass","position":[12.632826112739933,0,22.587439100468647],"scale":0.9285693381488563},{"type":"grass","position":[121.36126895182616,0,-18.113034552699947],"scale":0.9160023028659311},{"type":"grass","position":[42.21851139180833,0,17.2946500052783],"scale":1.1132004909522175},{"type":"grass","position":[-136.3895161708975,0,-32.32384737328831],"scale":1.1628102697378613},{"type":"grass","position":[4.740080925603335,0,-12.754844787401721],"scale":0.8564532124516846},{"type":"grass","position":[-54.403353054188116,0,87.10461690550588],"scale":0.7029949204070679},{"type":"grass","position":[4.479805972883503,0,93.23556746746182],"scale":1.0030119742953505},{"type":"grass","position":[-18.993442199557858,0,28.950365187811347],"scale":0.9802001546370835},{"type":"grass","position":[44.187110780916285,0,-24.645440235815325],"scale":0.7744211774407881},{"type":"grass","position":[-111.10895934564013,0,26.871836889899622],"scale":1.0665281354627196},{"type":"grass","position":[37.71370912542471,0,-3.826357618981638],"scale":1.1060948795014385},{"type":"grass","position":[-40.12439920376124,0,41.7963639552829],"scale":1.0128328578797172},{"type":"grass","position":[-54.06287500350307,0,-42.88752619994321],"scale":0.8192896457687971},{"type":"grass","position":[28.082108371340233,0,-3.408105545950272],"scale":0.7835628623527493},{"type":"grass","position":[-11.47344724852992,0,-19.896495256250798],"scale":0.7620111135832239},{"type":"grass","position":[2.706689390633042,0,28.17201289185195],"scale":0.9537214590288559},{"type":"grass","position":[3.732149763611451,0,-32.810994469423385],"scale":0.8096791995645317},{"type":"grass","position":[34.91834111119037,0,-63.592731150934235],"scale":1.2434469855526173},{"type":"grass","position":[23.4299813289859,0,-22.021218575688955],"scale":1.2406420209931728},{"type":"grass","position":[87.16473044983802,0,-102.18728382506154],"scale":1.1489298881195893},{"type":"grass","position":[-81.94595012227468,0,34.659977953731726],"scale":0.92142815203962},{"type":"grass","position":[-4.66797491707622,0,-8.346760208547035],"scale":0.9322210788917176},{"type":"grass","position":[-22.574216861003276,0,-119.67206231848573],"scale":0.8647455108228677},{"type":"grass","position":[-34.11681081844184,0,-76.76230344302498],"scale":0.9125853084280079},{"type":"grass","position":[58.21438101819651,0,-65.65503121891192],"scale":0.8332203193100586},{"type":"grass","position":[-48.100374144454776,0,-53.27288750969651],"scale":0.8738460124017222},{"type":"grass","position":[4.882340002608481,0,-6.9706419009284115],"scale":0.8141252950616609},{"type":"grass","position":[-33.71598684739894,0,46.92829864035218],"scale":1.1372607853448935},{"type":"grass","position":[12.382092109102539,0,88.21156939482192],"scale":0.9693805727693792},{"type":"grass","position":[1.3502073042700438,0,-2.239719717724072],"scale":0.9488633203488891},{"type":"grass","position":[-31.134915982292277,0,-61.45072829078923],"scale":0.8851492855648238},{"type":"grass","position":[-74.01991034090565,0,-31.536016336526025],"scale":0.861725160249603},{"type":"grass","position":[10.063130868066006,0,0.003937211710288755],"scale":1.0847828245903295},{"type":"grass","position":[3.5808081426738014,0,-1.8723860870177043],"scale":1.0852873336633744},{"type":"grass","position":[-26.14215785623991,0,30.678182254450746],"scale":0.9798884409740543},{"type":"grass","position":[9.0382612484736,0,-102.57241870493833],"scale":0.8695539348799409},{"type":"grass","position":[7.6498397645996645,0,-31.677498864548898],"scale":0.8944302142522865},{"type":"grass","position":[-71.89843568654193,0,-121.03274631830877],"scale":0.9324182214801972},{"type":"grass","position":[23.026350003650585,0,50.790627045676594],"scale":1.1265406394865252},{"type":"grass","position":[-34.63536395667089,0,20.806486460432556],"scale":0.9780595064751377},{"type":"grass","position":[-62.19757205421783,0,91.19723556250196],"scale":1.0707488984224482},{"type":"grass","position":[113.66773974140473,0,37.62241858110347],"scale":0.7240871335039526},{"type":"grass","position":[1.0325705676847337,0,-1.9324274904097107],"scale":0.8750180365175027},{"type":"grass","position":[33.058860633260785,0,-60.06217128880244],"scale":1.0448929001477285},{"type":"grass","position":[-34.3736668012419,0,-19.348803794202716],"scale":1.012395594878637},{"type":"grass","position":[-98.80637363779084,0,-106.85584820276328],"scale":1.1296021097677333},{"type":"grass","position":[-7.93784769137117,0,62.15580506566835],"scale":0.8871476155018463},{"type":"grass","position":[37.03830231501048,0,24.596419219314306],"scale":0.7300270891107729},{"type":"grass","position":[55.19632690895752,0,43.7430490122226],"scale":1.1580623040816147},{"type":"grass","position":[18.018164257413684,0,16.023332896993875],"scale":0.7054320163102528},{"type":"grass","position":[-60.88426156563824,0,-60.7214547739457],"scale":1.0312025121126898},{"type":"grass","position":[4.862876395105168,0,81.58264681012918],"scale":0.749404254998907},{"type":"grass","position":[7.548585939282296,0,125.12636842029055],"scale":1.1503103694707124},{"type":"grass","position":[108.50905747507441,0,94.36292251937168],"scale":0.8317802421904371},{"type":"grass","position":[-1.819845743714497,0,-7.646788777510515],"scale":1.0628318488351334},{"type":"grass","position":[58.94280809732476,0,59.64897928982907],"scale":1.0881139497631775},{"type":"grass","position":[-11.775597259106322,0,22.22961337899936],"scale":0.7594206390901204},{"type":"grass","position":[59.02121688850415,0,125.44382927340988],"scale":1.2402676073595722},{"type":"grass","position":[-5.4806495363599925,0,4.2648440884019205],"scale":0.8760813040243038},{"type":"grass","position":[-28.164894186810706,0,25.04041904856549],"scale":0.8495083212803817},{"type":"grass","position":[3.441358591757946,0,-0.030299415487117055],"scale":1.0348756399508403},{"type":"grass","position":[-80.90810903538463,0,58.920997174448864],"scale":1.0356837957074783},{"type":"grass","position":[-74.45303377659693,0,11.99624063254811],"scale":1.0259246851303274},{"type":"grass","position":[-94.22014550649604,0,-4.137487284243129],"scale":1.284554669478497},{"type":"grass","position":[-89.01768003272635,0,95.72407958795134],"scale":0.7048252622658155},{"type":"grass","position":[77.95704673001764,0,-71.13659002158965],"scale":0.8398326663178125},{"type":"grass","position":[93.68283695988735,0,116.0275499247705],"scale":0.9319492596488913},{"type":"grass","position":[-3.3223692639948217,0,-42.022257242782054],"scale":0.9214624138508137},{"type":"grass","position":[-90.84832131460566,0,37.520524643243135],"scale":1.1711547270194707},{"type":"grass","position":[65.48017955899496,0,-62.99273396822155],"scale":1.120252441018339},{"type":"grass","position":[-10.345961507624788,0,8.804357967492075],"scale":1.0936770323744567},{"type":"grass","position":[21.8012888535596,0,2.2145481238229285],"scale":1.1444243596423422},{"type":"grass","position":[112.64670464697127,0,-6.886791910618539],"scale":1.0250032844094423},{"type":"grass","position":[59.153870135552104,0,115.19597424824735],"scale":1.002930876688687},{"type":"grass","position":[-0.6386950462943122,0,1.796198154170951],"scale":1.2174165126115666},{"type":"grass","position":[-24.3916521509815,0,-143.81605129181455],"scale":1.0777951468041094},{"type":"grass","position":[88.1266154021718,0,-32.316143643330676],"scale":1.296786985728055},{"type":"grass","position":[8.470425076984972,0,-92.40716907579686],"scale":1.2859299985592119},{"type":"grass","position":[28.568919830969552,0,-19.88683698003555],"scale":1.191132562410491},{"type":"grass","position":[-6.77366144256417,0,-134.82243336547157],"scale":0.905095734335558},{"type":"grass","position":[-0.35826015048893756,0,-8.495204259708872],"scale":1.0061937461631303},{"type":"grass","position":[-79.8993158173071,0,60.34104548392955],"scale":0.9814367233649148},{"type":"grass","position":[58.9929619890578,0,-116.84650717276635],"scale":0.7598971542373225},{"type":"grass","position":[-2.6702212069076454,0,-6.111280928370383],"scale":0.7195302152310756},{"type":"grass","position":[16.769162517190864,0,0.24114664912960454],"scale":1.2954137217182464},{"type":"grass","position":[-16.862938001314358,0,-5.9997083974085],"scale":1.2395961254947632},{"type":"grass","position":[23.371884082395265,0,-3.718320094226128],"scale":1.244668049421024},{"type":"grass","position":[-0.021009378485247168,0,-32.354488989120846],"scale":1.1770276849458856},{"type":"grass","position":[-70.76380617512191,0,128.37556170770515],"scale":1.2667271423568727},{"type":"grass","position":[-86.54876394165746,0,113.78026280300368],"scale":0.9742229365914348},{"type":"grass","position":[-35.73447738483675,0,-23.251771879687873],"scale":0.9373168914424599},{"type":"grass","position":[-2.23449696371005,0,-63.997267660572106],"scale":1.0191058927402352},{"type":"grass","position":[-34.341645530668245,0,67.65965603976365],"scale":1.111278744461417},{"type":"grass","position":[-95.17841323585412,0,91.02307748276573],"scale":1.126163897218034},{"type":"grass","position":[51.519929011406035,0,-2.9567589193821204],"scale":0.7885917325289168},{"type":"grass","position":[-21.12494672277622,0,35.561736154705365],"scale":1.2389339082534763},{"type":"grass","position":[91.74406866381162,0,50.38503084824401],"scale":0.8346716757751589},{"type":"grass","position":[-39.35601906434334,0,-3.1668853862295476],"scale":0.8409537157301965},{"type":"grass","position":[-2.8311848684098138,0,9.23684523082907],"scale":1.1713370976368926},{"type":"grass","position":[45.295816518739514,0,90.25444140564792],"scale":1.2049115632740808},{"type":"grass","position":[-74.17432646270233,0,25.440688895272174],"scale":1.0053476354962103},{"type":"grass","position":[-72.46090943327357,0,126.81847561221582],"scale":0.749585621126255},{"type":"grass","position":[-91.75992232776959,0,34.3920090952286],"scale":0.954765945015476},{"type":"grass","position":[26.148595388180627,0,-57.41412207364265],"scale":0.7288004068570018},{"type":"grass","position":[25.46896243903341,0,-108.16375197781129],"scale":0.9716669073929174},{"type":"grass","position":[72.91578446206799,0,13.527826200709034],"scale":0.7036134927869274},{"type":"grass","position":[-90.7836793492837,0,-40.77534587299],"scale":0.8436967983522465},{"type":"grass","position":[10.161529586670992,0,-28.116745440227184],"scale":0.8902699244824712},{"type":"grass","position":[-79.90246052062655,0,0.29488430134554816],"scale":1.2741853749627028},{"type":"grass","position":[-78.98352421885274,0,-27.768002724689953],"scale":1.0461050989320264},{"type":"grass","position":[1.9984677550044372,0,-3.876257198211653],"scale":1.0111049682837767},{"type":"grass","position":[-79.60485579002146,0,-16.56524457238431],"scale":1.1522548998861006},{"type":"grass","position":[61.8116833476774,0,-97.68838285359789],"scale":0.7155118938859715},{"type":"grass","position":[36.78289107094423,0,-32.189150192681986],"scale":1.0392652936977496},{"type":"grass","position":[106.46208951298452,0,-48.91518131328188],"scale":1.2429647356351063},{"type":"grass","position":[-4.796505504092666,0,23.361325376451457],"scale":1.237587159271839},{"type":"grass","position":[27.683842667661906,0,47.91348811304278],"scale":0.921936391225869},{"type":"grass","position":[77.6812532981988,0,62.51909910333703],"scale":1.0334631746129337},{"type":"grass","position":[26.301326370167075,0,-18.156312538886933],"scale":0.7344189107229266},{"type":"grass","position":[39.81342875760503,0,-34.50674681010314],"scale":1.1237909101437427},{"type":"grass","position":[36.93612368724726,0,-37.31256816798756],"scale":0.9198352562063205},{"type":"grass","position":[121.86053873816365,0,-54.17041785488907],"scale":1.2608106416524507},{"type":"grass","position":[-29.75863501198685,0,72.52895453974578],"scale":0.9308668892405502},{"type":"grass","position":[25.467320988064063,0,-9.72559085133176],"scale":1.0363874437802598},{"type":"grass","position":[-0.37675637664855677,0,-0.9388403957056863],"scale":1.2388059871314088},{"type":"grass","position":[50.034821782682926,0,127.41519023165563],"scale":0.8656207608947873},{"type":"grass","position":[-12.8091137557088,0,-37.30022932137699],"scale":0.8708682997166725},{"type":"grass","position":[-5.410079462131746,0,39.395531442704346],"scale":0.7678538137670331},{"type":"grass","position":[-100.96241130183215,0,42.25532620354275],"scale":1.0525554124714644},{"type":"grass","position":[-48.87221838240452,0,7.745879821340726],"scale":0.923032768605585},{"type":"grass","position":[-15.388766888714777,0,-17.887992098721213],"scale":1.1809129268999403},{"type":"grass","position":[5.383026231037274,0,13.879791590650497],"scale":0.7001406309937107},{"type":"grass","position":[59.83677392713732,0,-129.8592626599758],"scale":1.1332248452601328},{"type":"grass","position":[57.12254616261032,0,-26.442293573677322],"scale":1.006452884290082},{"type":"grass","position":[66.3128360692068,0,-58.1507742350808],"scale":1.0044051205144753},{"type":"grass","position":[68.59966615039468,0,54.051634024196275],"scale":1.1146071080669497},{"type":"grass","position":[81.28564803085054,0,-32.61973635965107],"scale":1.2669119523154355},{"type":"grass","position":[-5.888944558141364,0,-24.498290205352962],"scale":1.144034981337106},{"type":"grass","position":[-141.43578202798207,0,39.18414003654103],"scale":1.113389358069539},{"type":"grass","position":[-21.69805190324523,0,1.8817402625095287],"scale":1.1889528778400098},{"type":"grass","position":[-90.75590765732694,0,68.49122826770959],"scale":1.276372460686361},{"type":"grass","position":[-80.67668380381149,0,-84.96427984588922],"scale":1.0093020171310565},{"type":"grass","position":[52.676853283837374,0,-47.34323257753047],"scale":0.815072090573225},{"type":"grass","position":[-32.9097642111507,0,-24.238434422825495],"scale":1.0146240482553779},{"type":"grass","position":[28.400306324551423,0,144.31144497865589],"scale":1.296109851710086},{"type":"grass","position":[26.36162921380044,0,29.64097030230515],"scale":1.2637415683902153},{"type":"grass","position":[-31.725905233938605,0,-120.27606846891406],"scale":0.9680746885707002},{"type":"grass","position":[-30.444800954283217,0,42.280752043375095],"scale":0.7011666061591348},{"type":"grass","position":[-67.33840242638263,0,13.754595000339668],"scale":1.0637729752821061},{"type":"grass","position":[-36.046918771702195,0,104.0936628404179],"scale":1.0189675207566917},{"type":"grass","position":[-78.54607387639969,0,72.88386053235467],"scale":1.139140621788863},{"type":"grass","position":[-63.79512592821966,0,-19.770704735189053],"scale":0.8604224355267576},{"type":"grass","position":[23.109172802061543,0,98.74133062737366],"scale":1.2604953492794695},{"type":"grass","position":[134.71052039572228,0,-0.5215026920161664],"scale":0.8892460415486343},{"type":"grass","position":[-0.9734833786339798,0,-0.8450298690005182],"scale":1.1823606801786886},{"type":"grass","position":[-10.721324142045168,0,127.22891636948566],"scale":1.02317129287027},{"type":"grass","position":[-6.200262289281484,0,-4.311809901421721],"scale":1.1731411749502016},{"type":"grass","position":[-86.72415307727816,0,54.34456430452203],"scale":0.7901456283606938},{"type":"grass","position":[71.39241546251459,0,-123.33957602564071],"scale":1.2476718844706975},{"type":"grass","position":[56.81793669669422,0,133.57106515980672],"scale":1.2521087372055446},{"type":"grass","position":[11.886512695282217,0,62.54748526667905],"scale":1.1754792055660617},{"type":"grass","position":[85.31145721137649,0,-5.8197727834981565],"scale":0.8166719995501939},{"type":"grass","position":[79.65606794465855,0,8.124795955874584],"scale":0.7697667382723036},{"type":"grass","position":[118.76056075956393,0,-88.9577196470883],"scale":1.0264040675024166},{"type":"grass","position":[44.2332684309514,0,61.322307146592806],"scale":1.1783500151041095},{"type":"grass","position":[5.046394798921464,0,3.497766638788714],"scale":1.1987939874842137},{"type":"grass","position":[23.06943972456526,0,-9.575437492094501],"scale":1.023430257474173},{"type":"grass","position":[29.166346179009583,0,-11.57788021067557],"scale":1.2191677806073677},{"type":"grass","position":[12.055035188115994,0,-144.60365014392673],"scale":0.7391784656055207},{"type":"grass","position":[-46.0095513327909,0,-87.84505351255271],"scale":0.9913373628020561},{"type":"grass","position":[-87.30569346061925,0,-91.10566414084396],"scale":1.2907228806386535},{"type":"grass","position":[-49.100183611058114,0,-34.87199449499915],"scale":1.141455784835149},{"type":"grass","position":[-42.8915578127288,0,20.215169554859532],"scale":1.0436628433994306},{"type":"grass","position":[105.12753124788131,0,-100.85124284215985],"scale":1.1349251405103793},{"type":"grass","position":[15.871260340392503,0,-47.38956841839827],"scale":0.962584899888348},{"type":"grass","position":[48.28899085848588,0,52.01832564488417],"scale":1.1578541745006468},{"type":"grass","position":[81.16665156572847,0,-27.984472754232172],"scale":0.8898137205225384},{"type":"grass","position":[110.08514936835142,0,-72.43243810127164],"scale":0.9153418764224368},{"type":"grass","position":[53.39825672321954,0,5.2069020232142735],"scale":1.0939999164104046},{"type":"grass","position":[-10.616909156127521,0,-16.898515265271918],"scale":0.7061646558956179},{"type":"grass","position":[-21.647006450229537,0,-30.369211621426036],"scale":1.0013324928203198},{"type":"grass","position":[55.58298871883259,0,25.872752773307006],"scale":1.0834859486970003},{"type":"grass","position":[3.4011483075315687,0,-1.795439446217705],"scale":1.1445159320365277},{"type":"grass","position":[-93.14035832191581,0,31.916720310479686],"scale":0.8504741379956484},{"type":"grass","position":[86.01859641571673,0,-13.13942622315998],"scale":1.1064169155922576},{"type":"grass","position":[71.39223377655742,0,-130.96269424363493],"scale":1.0333378171178547},{"type":"grass","position":[12.851757842195283,0,-28.204003843448312],"scale":1.161457210023041},{"type":"grass","position":[-16.14912401262322,0,13.86594413441061],"scale":0.7821908462014977},{"type":"grass","position":[-47.32071305178135,0,11.226641363107266],"scale":0.7913148141312977},{"type":"grass","position":[6.012909182340824,0,-0.6411804062886772],"scale":1.0040583417256204},{"type":"grass","position":[-6.476254786300656,0,5.499923956989355],"scale":1.1509060086941798},{"type":"grass","position":[26.596138789762936,0,6.814134100235667],"scale":0.8567388317845415},{"type":"grass","position":[-40.34437711245875,0,63.75963570335224],"scale":0.8658705332697207},{"type":"grass","position":[-46.5338845414383,0,-23.364731095725652],"scale":0.8149122751494337},{"type":"grass","position":[-60.37464426700691,0,126.61022288750489],"scale":1.2776343253424214},{"type":"grass","position":[32.71958238375289,0,-11.330409629719252],"scale":1.2050534356882507},{"type":"grass","position":[-94.33352094263496,0,0.0020915432593353613],"scale":1.0079964324927446},{"type":"grass","position":[-0.8249384902416205,0,-0.14736830385283167],"scale":0.9721909508924591},{"type":"grass","position":[-37.24310983340154,0,-26.865302996314146],"scale":1.0913693218697817},{"type":"grass","position":[30.340577616887956,0,-20.37269074987678],"scale":1.1499760988005812},{"type":"grass","position":[3.7814189017814224,0,-9.24681177147535],"scale":1.0410935398512007},{"type":"grass","position":[74.97962390193557,0,-54.712059367545244],"scale":1.2525116752991898},{"type":"grass","position":[-29.240057892798767,0,-14.749006555020431],"scale":0.7303898117391768},{"type":"grass","position":[-71.46261933941511,0,-34.01602329388763],"scale":0.9807973367619024},{"type":"grass","position":[26.71225753868962,0,1.6293975580021984],"scale":0.9294160131520737},{"type":"grass","position":[55.403675765270286,0,-54.17670802630599],"scale":1.039710724497793},{"type":"grass","position":[-88.89499109653713,0,100.00792648830237],"scale":1.2863783798648736},{"type":"grass","position":[2.0243328318854106,0,-21.793561143962304],"scale":0.7835122613602261},{"type":"grass","position":[77.60346142395055,0,13.595724918925548],"scale":0.8869379504705691},{"type":"grass","position":[-8.70519475407529,0,71.29523795386305],"scale":1.02153639285982},{"type":"grass","position":[-19.80564401779882,0,107.33861894877323],"scale":0.7118607861705268},{"type":"grass","position":[70.76241458284228,0,-78.84232269090334],"scale":1.0078649237750177},{"type":"grass","position":[-25.296270744734255,0,82.36998966055185],"scale":1.2792677826610372},{"type":"grass","position":[6.097466574661636,0,-2.3017401028281004],"scale":0.8727971274396619},{"type":"grass","position":[-18.929720112928898,0,35.828319701631344],"scale":0.7201964657536076},{"type":"grass","position":[-19.685213868833017,0,113.692056812456],"scale":0.8546005074449696},{"type":"grass","position":[-7.063182396377491,0,-7.341884125154978],"scale":0.8099220680457421},{"type":"grass","position":[-69.77468740863141,0,20.28765250676729],"scale":0.917208982383573},{"type":"grass","position":[-92.15320189985755,0,-30.49477048214608],"scale":0.8207072700815796},{"type":"grass","position":[32.07132766095634,0,46.900763317152446],"scale":0.7003990908086403},{"type":"grass","position":[-3.38583898122048,0,-67.28402619677193],"scale":1.0624309984628317},{"type":"grass","position":[-117.00049398738784,0,70.27992794648402],"scale":0.9374192756413651},{"type":"grass","position":[-13.855931435408195,0,-22.222065494817414],"scale":1.1041546999732852},{"type":"grass","position":[-126.66798245964276,0,-24.574981642749663],"scale":1.1041782123684452},{"type":"grass","position":[7.588784968385687,0,-7.707038348408333],"scale":0.929504598564918},{"type":"grass","position":[76.26840591383956,0,-31.967614495955534],"scale":1.0326656219773012},{"type":"grass","position":[134.5201365511726,0,-20.578272673152387],"scale":0.9731404380249854},{"type":"grass","position":[-13.82542958609317,0,-11.748943449176975],"scale":1.0074977396151887},{"type":"grass","position":[57.35144208921766,0,-42.19604916798478],"scale":1.02941887705699},{"type":"grass","position":[16.769911273565206,0,99.50086535151028],"scale":1.2175403481993883},{"type":"grass","position":[128.96241610284477,0,-68.26252014227978],"scale":0.9966037732090383},{"type":"grass","position":[-102.3130334291735,0,11.330875459788016],"scale":0.8686590774798184},{"type":"grass","position":[47.52903961007078,0,-85.84782616763039],"scale":1.0871815943243872},{"type":"grass","position":[20.078587755062347,0,49.34265038271255],"scale":1.100368765789409},{"type":"grass","position":[-87.17552578388802,0,53.24056290740648],"scale":1.2893333294099487},{"type":"grass","position":[-42.16053861293782,0,8.913817327013133],"scale":0.9209807952148499},{"type":"grass","position":[0.7067012940293462,0,3.287411579125922],"scale":0.8310951980180952},{"type":"grass","position":[20.896005733500548,0,27.472843262864448],"scale":0.7949937285452668},{"type":"grass","position":[99.19269758418902,0,-48.587311698745715],"scale":1.2426241868848318},{"type":"grass","position":[9.532267068063328,0,-4.443773976681296],"scale":1.0393413551619584},{"type":"grass","position":[-117.33012895685528,0,-68.59765009176887],"scale":1.0588941412793182},{"type":"grass","position":[-19.226594983619215,0,-144.36786857242876],"scale":1.2491948060415032},{"type":"grass","position":[17.803222003329644,0,4.119131915258349],"scale":0.9305626150934969},{"type":"grass","position":[-81.48094959209676,0,11.317083982418698],"scale":1.210858616019491},{"type":"grass","position":[-13.092690208839997,0,-63.72208092423358],"scale":0.8735682948420438},{"type":"grass","position":[-3.276741803078274,0,-21.29239840610362],"scale":1.290609626924406},{"type":"grass","position":[-31.224539361139733,0,-13.13657933857649],"scale":0.7437103009450473},{"type":"grass","position":[-61.39946527882575,0,87.33290136296685],"scale":0.9424617229042165},{"type":"grass","position":[54.09489763737665,0,-38.20831140552339],"scale":0.7748011368783672},{"type":"grass","position":[-42.596107848295645,0,82.33153624213216],"scale":1.0058020328910149},{"type":"grass","position":[56.564232820310956,0,73.54148626295503],"scale":0.9751007726954435},{"type":"grass","position":[-10.142489048532543,0,-54.99101609950411],"scale":1.1173461854153148},{"type":"grass","position":[-10.85858654997087,0,112.99043720398608],"scale":1.2722249917741941},{"type":"grass","position":[0.5645204809947911,0,-0.6036501093559733],"scale":1.2298478237268429},{"type":"grass","position":[-2.3493083624264073,0,0.04295600697653107],"scale":1.2374696207325384},{"type":"grass","position":[-5.20022817034088,0,73.48913902536547],"scale":0.7903559928955182},{"type":"grass","position":[-12.514602400581843,0,-19.729442352904798],"scale":0.9530547714764721},{"type":"grass","position":[-148.42312575382866,0,12.323516016015201],"scale":0.7176421195798998},{"type":"grass","position":[-129.46037936770745,0,57.76177981428924],"scale":1.005426032252152},{"type":"grass","position":[-35.262426335564356,0,22.56422195611274],"scale":1.193014378650018},{"type":"grass","position":[-64.83852439141849,0,43.09430317721278],"scale":1.0058266584475237},{"type":"grass","position":[-31.035369979046244,0,-64.74156542582472],"scale":1.2921519458772597},{"type":"grass","position":[29.93079658360208,0,17.3810208994518],"scale":1.2521298793175246},{"type":"grass","position":[-39.060074434006275,0,-12.14414949229512],"scale":1.1175833604009264},{"type":"grass","position":[5.71278515210655,0,93.52679366979191],"scale":0.7009386894522711},{"type":"grass","position":[29.019767015364142,0,2.317806856183224],"scale":0.7253653002852553},{"type":"grass","position":[139.64426518066594,0,-13.573067383096717],"scale":1.227316760480094},{"type":"grass","position":[-24.899410441372257,0,39.04492171779965],"scale":0.7332702141736651},{"type":"grass","position":[0.1903127433836066,0,54.82521158597055],"scale":1.272579945646232},{"type":"grass","position":[52.076083656875,0,134.49105990689273],"scale":1.0975861986067488},{"type":"grass","position":[45.38160069213777,0,32.899251390823125],"scale":0.85357196861422},{"type":"grass","position":[13.810279970967313,0,-13.006872315528234],"scale":1.1596707631710959},{"type":"grass","position":[-111.63072525156763,0,49.85505185279438],"scale":0.9248718370430231},{"type":"grass","position":[-82.93547751721657,0,-56.6143945082458],"scale":0.9415974553585325},{"type":"grass","position":[50.47854951977472,0,-80.48162251764194],"scale":1.1513511607341447},{"type":"grass","position":[107.18686466999432,0,-4.015132151243916],"scale":0.8252760036655113},{"type":"grass","position":[55.22011747152467,0,-57.1680643031262],"scale":1.0041687368610808},{"type":"grass","position":[-122.8035651090765,0,-74.02750730667933],"scale":1.0498022640281683},{"type":"grass","position":[96.47449889544535,0,-6.055835528625486],"scale":1.175876646019816},{"type":"grass","position":[135.37641331021052,0,-15.936735359531289],"scale":1.0800524915810215},{"type":"grass","position":[50.92329200238008,0,-33.7115701287356],"scale":0.7365690838432635},{"type":"grass","position":[-119.43176091821724,0,78.57656109725085],"scale":0.7134836865820058},{"type":"grass","position":[-2.786891769665625,0,9.58514068115998],"scale":0.9644457565582467},{"type":"grass","position":[3.1143945419416865,0,-28.07260060244413],"scale":1.0960059773239654},{"type":"grass","position":[64.06655323199583,0,-37.64352829156434],"scale":1.2357106084047114},{"type":"grass","position":[-27.940027379939675,0,-64.02240053904806],"scale":1.1717764553735956},{"type":"grass","position":[-10.750152098817804,0,-3.2831227182981966],"scale":0.8202304556374468},{"type":"grass","position":[65.4576405529545,0,52.19102114206312],"scale":0.8887842633514832},{"type":"grass","position":[82.90588550377954,0,-72.64327364831667],"scale":1.14216561363874},{"type":"grass","position":[-29.573415464393396,0,-21.144161705370337],"scale":1.2940998759363243},{"type":"grass","position":[-94.95529876174226,0,-24.639940889213836],"scale":1.0368778072266998},{"type":"grass","position":[-19.909135041223948,0,-40.73965670109105],"scale":1.173430214484237},{"type":"grass","position":[33.99234783330034,0,-35.51167056303002],"scale":0.7656289684285761},{"type":"grass","position":[44.69139945221284,0,-49.282358293587535],"scale":1.2385803325229237},{"type":"grass","position":[5.570521942330638,0,48.08839729779631],"scale":1.184782750914842},{"type":"grass","position":[19.549123139428236,0,36.98805244334048],"scale":1.2169638503948046},{"type":"grass","position":[93.47159655870105,0,-26.48297652930852],"scale":0.7245807775563011},{"type":"grass","position":[-95.71870431304359,0,-56.197859862068185],"scale":0.7104565672154749},{"type":"grass","position":[-89.59754707035007,0,65.09781773081703],"scale":0.9839187890838794},{"type":"grass","position":[82.68860572275554,0,-110.5392651469863],"scale":1.1418739558351678},{"type":"grass","position":[-91.77631361200147,0,-96.23777000555303],"scale":0.7199787925901623},{"type":"grass","position":[11.835290390330858,0,137.1753570335962],"scale":1.251183950755978},{"type":"grass","position":[111.52398387067447,0,-9.47807295472638],"scale":1.015863914466153},{"type":"grass","position":[-13.732117618068676,0,90.03787438807882],"scale":0.9134568215949347},{"type":"grass","position":[89.54098821719195,0,56.01384190966044],"scale":1.2154939793704287},{"type":"grass","position":[-43.7698121759624,0,6.921040378786402],"scale":0.7496972295923089},{"type":"grass","position":[23.097738474942446,0,-87.32398997881103],"scale":1.2432684809107308},{"type":"grass","position":[-0.40399691618781947,0,-0.5054098028897039],"scale":0.8568723358182382},{"type":"grass","position":[-23.778303004357483,0,-12.599109509090269],"scale":0.7390772247894768},{"type":"grass","position":[17.911845797838463,0,49.73431714582133],"scale":0.8449573318747557},{"type":"grass","position":[13.783715875194828,0,110.26852720024458],"scale":1.0780059268329887},{"type":"grass","position":[20.805954774748482,0,22.143887632713742],"scale":1.0415031282067937},{"type":"grass","position":[123.13894184276779,0,17.17418600636792],"scale":1.0411248018360293},{"type":"grass","position":[34.634534518272886,0,-11.542266134466432],"scale":0.9138246031114289},{"type":"grass","position":[5.3010352554125415,0,-19.867947765261746],"scale":1.2429487279235407},{"type":"grass","position":[-64.98191137075821,0,-90.08305697963948],"scale":0.704342256262914},{"type":"grass","position":[9.086713655996688,0,18.090437127996612],"scale":1.2364289870687841},{"type":"grass","position":[-110.93371250436053,0,29.472898212451568],"scale":0.8511378336895974},{"type":"grass","position":[36.047338472348,0,41.74866174560363],"scale":1.0733596570198203},{"type":"grass","position":[-42.66047759186064,0,96.47131864415323],"scale":1.132234896091554},{"type":"grass","position":[-112.93023294638097,0,15.674440387475128],"scale":0.7009388001491476},{"type":"grass","position":[78.57860986006082,0,53.444501890528095],"scale":0.8449503958331892},{"type":"grass","position":[3.42262053254897,0,-2.3291852633137258],"scale":0.7209631745846004},{"type":"grass","position":[121.13318854220059,0,13.23980333303765],"scale":1.200421036411995},{"type":"grass","position":[-59.5857583993499,0,-53.60787194430611],"scale":1.197134548453385},{"type":"grass","position":[59.40295540630998,0,33.32803252777089],"scale":1.0217588391069605},{"type":"grass","position":[96.62114934841219,0,63.20555005181873],"scale":0.9566922008027141},{"type":"grass","position":[-92.66847253587645,0,-90.11739636843417],"scale":0.8859281557052282},{"type":"grass","position":[62.91909841790303,0,-2.2398346573498067],"scale":1.1243422573987736},{"type":"grass","position":[29.33222870526339,0,62.706239141777786],"scale":1.1885478422762177},{"type":"grass","position":[-68.78148960821056,0,-77.85428299143034],"scale":1.0831862578991027},{"type":"grass","position":[75.44397354585469,0,5.9312514509388965],"scale":1.2721437833430063},{"type":"grass","position":[-6.389439013521342,0,16.3988044851667],"scale":0.9290803784043962},{"type":"grass","position":[-56.247214249992005,0,54.72141657774547],"scale":1.0791122035272984},{"type":"grass","position":[-7.175399185755512,0,-5.126251969992807],"scale":1.1138443288344524},{"type":"grass","position":[-105.70791514498846,0,26.548617533134728],"scale":1.294852700567531},{"type":"grass","position":[-115.36895236673266,0,31.068215576915403],"scale":0.8089278414998149},{"type":"grass","position":[6.827486061149816,0,8.676214298729077],"scale":0.9951032509409456},{"type":"grass","position":[-14.90361042038975,0,-54.86682749152135],"scale":0.7947867453352084},{"type":"grass","position":[55.21883628902268,0,41.63598908982968],"scale":1.0830632182690136},{"type":"grass","position":[44.03936015515153,0,-42.37124232072133],"scale":0.7570770972682623},{"type":"grass","position":[63.3840492491612,0,-22.743196909168955],"scale":1.2434601997487522},{"type":"grass","position":[72.76053667040298,0,83.51230544992033],"scale":1.086279151513288},{"type":"grass","position":[25.810869914927018,0,-8.283304642317246],"scale":1.248224950789711},{"type":"grass","position":[79.12438069029658,0,-64.7736105335447],"scale":1.0812785645976806},{"type":"grass","position":[23.917366002307276,0,-29.839813667058852],"scale":1.1813072821188326},{"type":"grass","position":[-75.59279178275408,0,4.0486188202660465],"scale":0.7948292917864084},{"type":"grass","position":[17.25892061004398,0,-1.642121922709176],"scale":1.0365472541836227},{"type":"grass","position":[16.00051119151573,0,44.73007943449695],"scale":0.7832886672146132},{"type":"grass","position":[-12.320629230520789,0,-18.41613553585099],"scale":1.0405216905332915},{"type":"grass","position":[-7.1933117856313755,0,3.2411033860499407],"scale":1.0186032771315012},{"type":"grass","position":[6.277745234371647,0,11.076137314989039],"scale":1.295174814792078},{"type":"grass","position":[49.48052119143777,0,-127.89188890833404],"scale":0.9498400542832718},{"type":"grass","position":[-32.9879889488782,0,23.308350905714295],"scale":0.994858300346042},{"type":"grass","position":[-49.321552947863054,0,-78.51366256773169],"scale":0.8733505636737351},{"type":"grass","position":[-73.25580316779546,0,14.556934177037826],"scale":1.023922161666185},{"type":"grass","position":[67.1722755064863,0,81.33307602017017],"scale":0.8064468334397924},{"type":"grass","position":[-62.9208047302725,0,-104.72746187404309],"scale":0.7371817611309359},{"type":"grass","position":[2.8495793323734535,0,-105.53517207052062],"scale":0.8871833902439064},{"type":"grass","position":[24.573783955263874,0,144.10356386168115],"scale":1.2363671380680645},{"type":"grass","position":[-27.79378752148452,0,-88.59287270782305],"scale":1.2791565300827261},{"type":"grass","position":[1.3756272641555474,0,48.214404261593955],"scale":0.7287108415862572},{"type":"grass","position":[147.5623945397556,0,-17.951701653054894],"scale":1.2266210655206597},{"type":"grass","position":[-27.566712764771864,0,105.79007211621087],"scale":1.186497533657331},{"type":"grass","position":[56.78795955614579,0,45.12280911151399],"scale":1.162113861236112},{"type":"grass","position":[-130.71485163346358,0,21.609750522329172],"scale":1.1574165448538225},{"type":"grass","position":[-20.420239457323802,0,-95.81426211031501],"scale":0.7328230007495433},{"type":"grass","position":[-30.85962438126337,0,38.1102926363158],"scale":0.9909445282056423},{"type":"grass","position":[28.040114573082512,0,51.021984710317355],"scale":1.2146283049520514},{"type":"grass","position":[89.34435037783985,0,89.96696985530153],"scale":0.9218489196884001},{"type":"grass","position":[119.39437380297156,0,-73.85056979105282],"scale":1.2755859871160355},{"type":"grass","position":[6.70277431133952,0,-1.0261103031195205],"scale":1.2425097896989743},{"type":"grass","position":[-0.008648156865009988,0,35.63528600613183],"scale":1.1780364570485813},{"type":"grass","position":[-77.79311077871053,0,14.206755747687838],"scale":1.1397750935469577},{"type":"grass","position":[-143.00819301180334,0,4.524130225025579],"scale":1.0481000863428371},{"type":"grass","position":[-30.69454734157696,0,-118.90238470431545],"scale":0.8811520633148802},{"type":"grass","position":[-90.96462889531607,0,-50.86893000746647],"scale":0.9818395912586515},{"type":"grass","position":[-16.840444135379574,0,-119.0714804203955],"scale":1.228846761435744},{"type":"grass","position":[-2.5226293786026583,0,-84.52676207380483],"scale":0.8434548801388215},{"type":"grass","position":[0.34091849382144335,0,-3.1891167312019966],"scale":1.2694059726702018},{"type":"grass","position":[-9.593749996225746,0,77.12162435285138],"scale":0.8359762728790254},{"type":"grass","position":[7.961033968189419,0,-22.94809086436209],"scale":1.103184737296781},{"type":"grass","position":[-14.162083366865932,0,-112.99667056213701],"scale":1.0060446823876412},{"type":"grass","position":[79.81629490128002,0,57.958454839172255],"scale":0.8161160391928565},{"type":"grass","position":[81.92602003990726,0,-63.16882750819948],"scale":1.2097868885501697},{"type":"grass","position":[-6.055853157054494,0,1.321810635005604],"scale":1.2418661663883925},{"type":"grass","position":[2.2009626658071553,0,-7.242375942272993],"scale":1.1976161151921745},{"type":"grass","position":[24.294862538309246,0,-1.5839514030368487],"scale":0.7247336887240069},{"type":"grass","position":[-3.1381348710018346,0,14.603322813684388],"scale":0.819637228431606},{"type":"grass","position":[-35.289003535012235,0,41.54287700084837],"scale":0.7427165182712726},{"type":"grass","position":[-108.63483773977194,0,-5.523955201265084],"scale":0.8599190060147736},{"type":"grass","position":[12.847867779563847,0,9.60338389850826],"scale":0.9190395639669326},{"type":"grass","position":[96.2489984826661,0,39.926603118066176],"scale":1.0684196181125951},{"type":"grass","position":[119.82745013431116,0,73.206140477283],"scale":1.2261446815644668},{"type":"grass","position":[50.66862456669976,0,112.09090248222758],"scale":1.1187404391603348},{"type":"grass","position":[-40.8589789760707,0,-25.856208240306064],"scale":0.9984291197572555},{"type":"grass","position":[61.86097455686222,0,66.42893299171303],"scale":1.0494133477328957},{"type":"grass","position":[-26.954470411030915,0,-30.1386041967443],"scale":0.9140119699519331},{"type":"grass","position":[28.349228272430228,0,26.85017658243395],"scale":1.1101140770115854},{"type":"grass","position":[2.389668551310406,0,-37.108161246725686],"scale":0.8163596538704185},{"type":"grass","position":[-86.3909936622113,0,34.9563265371679],"scale":1.256967385902084},{"type":"grass","position":[27.163998065928208,0,30.457260724011523],"scale":1.07986416726014},{"type":"grass","position":[-56.639229396303115,0,12.249748678947254],"scale":1.1281149025276231},{"type":"grass","position":[14.118837753852336,0,27.858687154008322],"scale":1.2902584400822112},{"type":"grass","position":[-50.305330650385926,0,91.05127484501058],"scale":0.961099085025765},{"type":"grass","position":[56.39766299457894,0,-18.7538935989486],"scale":1.1712914223415587},{"type":"grass","position":[35.59912655718183,0,-94.34996487278597],"scale":1.050140195086312},{"type":"grass","position":[-1.5174437779849175,0,-2.3691433324454545],"scale":1.0784239807256029},{"type":"grass","position":[10.648369671047048,0,-0.706736573713033],"scale":0.8572632017128023},{"type":"grass","position":[-55.15778793123925,0,2.9524697303193994],"scale":1.0462584739283767},{"type":"grass","position":[95.90770431906618,0,-35.486122857101165],"scale":1.1790769318936567},{"type":"grass","position":[29.29715494374421,0,29.789533612375717],"scale":1.2801775021615747},{"type":"grass","position":[-3.626916140018804,0,-16.706014261666848],"scale":1.1913145279470836},{"type":"grass","position":[0.9216942076729232,0,23.33745196781481],"scale":1.2650296013731248},{"type":"grass","position":[-147.31587469787107,0,1.223194801518434],"scale":1.1538390150097726},{"type":"grass","position":[26.737722679706664,0,-52.00225878760451],"scale":0.7646301065827643},{"type":"grass","position":[2.097722276510505,0,-54.00044600452784],"scale":1.2613965750086704},{"type":"grass","position":[8.147379799976635,0,60.512027370398215],"scale":0.730752208229965},{"type":"grass","position":[76.52493911560741,0,-108.10817710455966],"scale":0.7949733354803521},{"type":"grass","position":[0.09091346982032611,0,0.3458025595251097],"scale":1.2417697691240221},{"type":"grass","position":[-72.65647700154987,0,-92.51375765822534],"scale":1.2028256029558544},{"type":"grass","position":[71.41307435641176,0,-49.59948837809845],"scale":1.113115605887283},{"type":"grass","position":[-61.62733954203283,0,77.3060716155001],"scale":0.8491297870306465},{"type":"grass","position":[-9.119766382136278,0,-11.721914584352055],"scale":1.1476724965677554},{"type":"grass","position":[-63.499306053017264,0,-13.521847062835453],"scale":1.2731020333315812},{"type":"grass","position":[124.0012026010991,0,61.993387080476644],"scale":1.141054919208027},{"type":"grass","position":[-3.7860230356957447,0,-28.66980309452079],"scale":0.8099519916936869},{"type":"grass","position":[-66.12267203056788,0,71.34482515581543],"scale":0.8446571970732741},{"type":"grass","position":[-86.1666075350275,0,39.17045590542745],"scale":0.9172414453441183},{"type":"grass","position":[25.743058806296744,0,20.235890813421605],"scale":1.1381491671066564},{"type":"grass","position":[44.751210278860135,0,87.6729245729077],"scale":0.9147690776400765},{"type":"grass","position":[51.50362128071602,0,-10.360022984250376],"scale":1.1817594405358647},{"type":"grass","position":[2.7665136669639168,0,-6.428771987156334],"scale":0.9979763070853486},{"type":"grass","position":[-43.71977450641861,0,107.64840866550506],"scale":0.7164592045542971},{"type":"grass","position":[-110.30476071712742,0,84.61371713600025],"scale":1.182433036488058},{"type":"grass","position":[-32.45647096686186,0,16.219692885084626],"scale":0.9876324584313374},{"type":"grass","position":[-38.08919496622584,0,-102.97689761973994],"scale":1.0668587192973735},{"type":"grass","position":[15.902434557889881,0,-72.23858059836762],"scale":1.1145280462049834},{"type":"grass","position":[-31.22240605945682,0,-21.173536912838724],"scale":0.702489288560695},{"type":"grass","position":[-81.20205798095301,0,40.483435769721744],"scale":0.7335700971819687},{"type":"grass","position":[-43.937016591555825,0,-12.71374345935024],"scale":0.8672176102102922},{"type":"grass","position":[-130.4141717810219,0,53.72224765278745],"scale":1.2435097729633218},{"type":"grass","position":[13.439025010834616,0,-53.02289647137559],"scale":0.8976336544628544},{"type":"grass","position":[-28.63523445884216,0,-21.66736490148797],"scale":0.9472094403260104},{"type":"grass","position":[-16.995456887553335,0,-3.5547247751624282],"scale":0.7717891956151192},{"type":"grass","position":[45.84300073841738,0,-27.171328244093157],"scale":0.7167689058803237},{"type":"grass","position":[-87.79526923661409,0,29.343611211567428],"scale":0.9152681601682385},{"type":"grass","position":[-2.762446142799395,0,0.9559526710692783],"scale":1.2173596225374153},{"type":"grass","position":[-9.210325410156594,0,-93.76959284282945],"scale":0.8181922294472631},{"type":"grass","position":[59.05121869789182,0,-22.49033763673177],"scale":1.2311816307585328},{"type":"grass","position":[13.163847013262309,0,-16.0078211490206],"scale":0.9204742061124674},{"type":"grass","position":[91.34357999915639,0,-17.17621921935461],"scale":1.0804618859709163},{"type":"grass","position":[43.345809731966,0,-91.48723719098342],"scale":0.9569302157739141},{"type":"grass","position":[26.97784702124106,0,40.44163591994581],"scale":0.8988875523206273},{"type":"grass","position":[115.26133610066061,0,44.316034531219294],"scale":1.2753778580659678},{"type":"grass","position":[60.43770188460437,0,-8.213771200279506],"scale":1.0883864942147288},{"type":"grass","position":[1.4393872008706534,0,82.18597399568365],"scale":1.1071772324578368},{"type":"grass","position":[-44.96018852755751,0,18.638951747724605],"scale":0.7829213709568862},{"type":"grass","position":[-119.20016084584502,0,-41.98819628577233],"scale":1.2656059120764955},{"type":"grass","position":[-59.37756448394218,0,119.6575951157755],"scale":1.17463448736234},{"type":"grass","position":[-80.54604457921265,0,-21.914288879146234],"scale":0.78843683161187},{"type":"grass","position":[-35.1205651020132,0,60.491171948808685],"scale":0.9742567000190832},{"type":"grass","position":[59.51396412530602,0,27.62273049975279],"scale":0.9034253801676699},{"type":"grass","position":[90.09010959693533,0,-38.765067669347275],"scale":1.1075856516797138},{"type":"grass","position":[87.11415562016431,0,-97.71831116172648],"scale":1.2020849536961715},{"type":"grass","position":[94.97624770700811,0,-17.512910287689838],"scale":1.1958061907836204},{"type":"grass","position":[54.095559216085576,0,-48.41020884573899],"scale":0.7468887305831526},{"type":"grass","position":[-126.63928306668974,0,34.81058598452179],"scale":1.1424985791389461},{"type":"grass","position":[-49.31898767620478,0,110.48500266304686],"scale":0.9745400432520667},{"type":"grass","position":[-37.48315009235992,0,17.598547893845343],"scale":1.0617506609360035},{"type":"grass","position":[-46.49491108703591,0,-114.44519565813317],"scale":0.9425548522447429},{"type":"grass","position":[-38.276702164794074,0,-49.51137384308822],"scale":1.0501265819134262},{"type":"grass","position":[8.557526070886613,0,6.006269507759047],"scale":1.135288152768793},{"type":"grass","position":[46.52101163737756,0,-41.518029576318824],"scale":0.9494845606596933},{"type":"grass","position":[-36.7127105979772,0,130.84977770232157],"scale":0.9659438991669114},{"type":"grass","position":[6.225546008591228,0,-2.5478418819567685],"scale":0.7811817999927024},{"type":"grass","position":[-38.628649026843654,0,-86.62632421777471],"scale":0.9884464112044016},{"type":"grass","position":[-37.07084937242812,0,-42.898336299644306],"scale":0.9107449958243162},{"type":"grass","position":[-38.810107755057885,0,107.79567610681107],"scale":1.1582586037315796},{"type":"grass","position":[-18.127216831526248,0,-33.19527447126521],"scale":0.8990070742936872},{"type":"grass","position":[-140.4864292007446,0,-50.69926288856958],"scale":1.227982286043722},{"type":"grass","position":[47.90663698366666,0,100.82138832388567],"scale":0.955431356090704},{"type":"grass","position":[-13.563184038907385,0,2.91548359193216],"scale":1.2367268583829523},{"type":"grass","position":[-14.626587374526135,0,15.438859098777758],"scale":0.9110732830191147},{"type":"grass","position":[-86.09007713607147,0,-72.63521448614988],"scale":0.7167263526835339},{"type":"grass","position":[45.80471278560245,0,20.38153130541424],"scale":0.7839545934069737},{"type":"grass","position":[27.857201139275887,0,94.00173536719939],"scale":0.776813445243706},{"type":"grass","position":[-5.647675533818737,0,-14.319053041225498],"scale":1.2877673996995593},{"type":"grass","position":[44.75477805669935,0,38.75634947146678],"scale":1.1556181413492932},{"type":"grass","position":[50.47377617829529,0,57.5349928940084],"scale":0.912486739478683},{"type":"grass","position":[-52.593812486827915,0,24.282710344171957],"scale":0.7334503692039182},{"type":"grass","position":[-97.40055414303322,0,-79.50641770148196],"scale":0.8885010539032394},{"type":"grass","position":[54.48895194139641,0,-51.3049938833286],"scale":0.8180791798172458},{"type":"grass","position":[-7.930414026922364,0,-90.17695438889218],"scale":1.2204704611674393},{"type":"grass","position":[-92.47105533709271,0,-81.10011628858354],"scale":1.1257787881305221},{"type":"grass","position":[7.298461903012332,0,4.489994705879598],"scale":1.0849677699157607},{"type":"grass","position":[32.21232323225342,0,-29.363355988715657],"scale":1.0868390228645837},{"type":"grass","position":[21.95077299659834,0,8.505137080285882],"scale":1.2095211683304603},{"type":"grass","position":[-80.60471549343016,0,-70.88043957688991],"scale":0.7831880871058898},{"type":"grass","position":[-119.89618105840053,0,-1.14618648056309],"scale":1.0521137580824793},{"type":"grass","position":[7.615179969040948,0,-124.37438612579429],"scale":1.040794188789684},{"type":"grass","position":[4.785475927348074,0,-49.219747049569925],"scale":1.2155361892073226},{"type":"grass","position":[9.322060157565028,0,128.4989342189353],"scale":1.0187866133191334},{"type":"grass","position":[-20.099494203158933,0,8.549061930380548],"scale":1.200592269073006},{"type":"grass","position":[-43.831731787855226,0,-11.738189814998421],"scale":1.1918528141356828},{"type":"grass","position":[-72.5587261555203,0,50.501753316682375],"scale":0.8100447773402497},{"type":"grass","position":[67.87864963566928,0,107.90612887429033],"scale":0.9382659961475484},{"type":"grass","position":[-131.37236990036845,0,45.63382503247646],"scale":0.8389315301017948},{"type":"grass","position":[62.434179825279855,0,0.2893629969947376],"scale":0.9971276445052175},{"type":"grass","position":[73.42242005805248,0,-26.07497953451002],"scale":0.7399589694941572},{"type":"grass","position":[-39.86253394471249,0,112.84194952720355],"scale":1.1951557503575123},{"type":"grass","position":[44.72033754372919,0,-88.39647079362287],"scale":0.9151559245275648},{"type":"grass","position":[-13.703274987867971,0,-116.48131522323106],"scale":1.0370079823088112},{"type":"grass","position":[66.40944101337449,0,-125.77782056635789],"scale":0.8232295617538126},{"type":"grass","position":[43.58018817560999,0,86.4309934219027],"scale":0.9442746476876633},{"type":"grass","position":[-1.7515072465338206,0,-2.378717412555966],"scale":0.783018276491918},{"type":"grass","position":[-1.6757204258617688,0,-124.1775101023492],"scale":1.1094824341148337},{"type":"grass","position":[-81.20246700728838,0,-33.40587540515358],"scale":1.2796853770291636},{"type":"grass","position":[39.33863696272224,0,136.55510547156192],"scale":0.9801524316281671},{"type":"grass","position":[-51.939695291897245,0,118.13290361641468],"scale":0.7881345936081046},{"type":"grass","position":[79.48393399584296,0,-22.81448431790029],"scale":1.1312038929083645},{"type":"grass","position":[123.67256292206328,0,16.361572475565854],"scale":1.0473304732403126},{"type":"grass","position":[1.0630872585703857,0,2.065259642666893],"scale":0.7878872264256267},{"type":"grass","position":[-32.95842849631787,0,2.0482279272696227],"scale":0.8769035553264168},{"type":"grass","position":[-3.5523952235517813,0,108.96144420056525],"scale":1.2118985453687665},{"type":"grass","position":[-98.9597061310824,0,-79.47574257572828],"scale":0.9339238216558983},{"type":"grass","position":[85.39619408166979,0,-108.4497099105753],"scale":0.9201249235783213},{"type":"grass","position":[3.5295406739458177,0,-10.097125820243695],"scale":1.0650669956269476},{"type":"grass","position":[-75.62542165152793,0,-109.95458493185515],"scale":0.7307872431109443},{"type":"grass","position":[-125.66064035553381,0,-21.029483809298096],"scale":0.9438605541768689},{"type":"grass","position":[-21.25556353482812,0,-45.52250966472478],"scale":1.080025832681314},{"type":"grass","position":[12.922064039920098,0,25.04660669594429],"scale":1.162272854368826},{"type":"grass","position":[-86.41237005248385,0,16.564521786246402],"scale":0.8827663415988196},{"type":"grass","position":[-16.026023793663175,0,84.35069664312365],"scale":0.9630420425871936},{"type":"grass","position":[-55.95516755258788,0,10.78591647992824],"scale":1.0185272106033645},{"type":"grass","position":[24.944251677195165,0,-77.61617096838488],"scale":0.9302544048656212},{"type":"grass","position":[15.303756368808545,0,5.641433625352341],"scale":1.0531829997859457},{"type":"grass","position":[-56.38885676458641,0,-29.163121768345764],"scale":1.1455419348869538},{"type":"grass","position":[56.65769591705932,0,-80.39972034189259],"scale":0.9705089808737707},{"type":"grass","position":[-87.87064300561003,0,-94.19193715542193],"scale":0.8778530033926696},{"type":"grass","position":[77.06338757747015,0,32.6573891473776],"scale":0.9636416414391329},{"type":"grass","position":[147.094247806239,0,7.941042539722934],"scale":0.9710887445830756},{"type":"grass","position":[-32.486845873453376,0,24.899133036065432],"scale":1.0245214945339955},{"type":"grass","position":[-127.26889278011035,0,59.12092905205947],"scale":1.0762871135972563},{"type":"grass","position":[-31.120477440613772,0,32.29964108486938],"scale":1.1291293020710365},{"type":"grass","position":[92.27624826719959,0,92.93111965324536],"scale":0.9921673682311156},{"type":"grass","position":[29.601172415994753,0,85.28418520578983],"scale":0.7572856564527648},{"type":"grass","position":[2.7885660107318033,0,82.28298069845752],"scale":1.0602654106026717},{"type":"grass","position":[-12.477695796958328,0,13.372361229664138],"scale":0.7212703845911429},{"type":"grass","position":[55.206045880367476,0,9.30449464891544],"scale":0.953396189314395},{"type":"grass","position":[114.50273384555005,0,-67.40221782911426],"scale":1.0243714542173001},{"type":"grass","position":[2.1293176464763666,0,-0.49429092504183364],"scale":0.8154588843092782},{"type":"grass","position":[6.02251220699001,0,-3.2086899834135836],"scale":1.1672176966864933},{"type":"grass","position":[-0.3407716831002707,0,9.709503829714091],"scale":1.2641737160142976},{"type":"grass","position":[-51.24377736236864,0,-49.36377772089373],"scale":1.011476016693791},{"type":"grass","position":[6.827675754468614,0,22.348829164565757],"scale":0.9455120761780568},{"type":"grass","position":[-8.790954320096896,0,-144.9428808512849],"scale":0.7782913086618107},{"type":"grass","position":[119.63524538160017,0,-8.85853887530273],"scale":0.9373957070739015},{"type":"grass","position":[-51.603824245369296,0,-99.3577656939001],"scale":1.114873670274827},{"type":"grass","position":[30.235956687895175,0,46.3643241453898],"scale":0.8123405395415547},{"type":"grass","position":[34.4447104572764,0,-39.779336280204724],"scale":1.2833827552307602},{"type":"grass","position":[4.083159802703095,0,-61.293176010908375],"scale":1.011052563503391},{"type":"grass","position":[60.44995633130648,0,-9.257370440540264],"scale":0.9967333812711089},{"type":"grass","position":[34.88676551676097,0,23.4068945346642],"scale":1.1073711832250046},{"type":"grass","position":[1.2416115884168377,0,-27.834454976633943],"scale":0.7985143568656236},{"type":"grass","position":[-106.35252415760388,0,4.833464172259803],"scale":1.2212314815305574},{"type":"grass","position":[-7.479451731287438,0,8.009543690276596],"scale":0.7716939119470168},{"type":"grass","position":[-55.890886864364646,0,-37.736564225939],"scale":0.8324142029606535},{"type":"grass","position":[98.97581285311264,0,100.99989448364815],"scale":1.1591806289523063},{"type":"grass","position":[38.63901143064509,0,54.22530697147165],"scale":1.1202723390799632},{"type":"grass","position":[-62.45649053580273,0,-74.14025586014462],"scale":0.7578292390642692},{"type":"grass","position":[66.13563350698263,0,-111.409124238309],"scale":1.0789289909588675},{"type":"grass","position":[-91.18912523171619,0,65.73590082543599],"scale":1.1661221112742293},{"type":"grass","position":[-22.555110082113067,0,-127.54530704104931],"scale":0.7946221433248384},{"type":"grass","position":[0.3873975043832299,0,-96.59297188433526],"scale":1.0835181318262885},{"type":"grass","position":[36.467411372891675,0,0.42333693470900263],"scale":1.1281017941533222},{"type":"grass","position":[-18.875889311944967,0,7.644872579519472],"scale":1.2478049231898907},{"type":"grass","position":[98.79184437354482,0,-47.894220194339724],"scale":0.9291242811805163},{"type":"grass","position":[-0.15298972040322967,0,-0.43699216467228297],"scale":0.7241124460051762},{"type":"grass","position":[14.848517607785727,0,-11.948533402295714],"scale":1.122985264306603},{"type":"grass","position":[-18.045062395456213,0,-21.021236302084944],"scale":0.9016768129245467},{"type":"grass","position":[4.099036876982177,0,99.82851026161262],"scale":1.0013686366384593},{"type":"grass","position":[72.7998555597347,0,39.67122429292485],"scale":1.1995092644603704},{"type":"grass","position":[-54.22467058701013,0,-107.44176445451514],"scale":0.9945371260424063},{"type":"grass","position":[5.266885636066713,0,80.37623728278842],"scale":1.2409102423012333},{"type":"grass","position":[-52.28935075686053,0,114.50690931825878],"scale":1.206145996685025},{"type":"grass","position":[-30.8344699902896,0,71.21900148841833],"scale":1.101978585401041},{"type":"grass","position":[-3.4306061196019835,0,-108.67440151611319],"scale":0.9631988903862585},{"type":"grass","position":[7.094738517846433,0,-1.4195048679612698],"scale":0.8323456131936153},{"type":"grass","position":[-14.171875519821134,0,13.296264819916649],"scale":1.220633913662156},{"type":"grass","position":[33.3809119659094,0,-74.9214712209485],"scale":0.8317054554729042},{"type":"grass","position":[-29.179854342581372,0,-38.81300180764476],"scale":1.0796045037842879},{"type":"grass","position":[34.48966882998194,0,87.27775204443219],"scale":1.2303169009007084},{"type":"grass","position":[-79.96807685080296,0,64.12871805906242],"scale":1.1706178952231396},{"type":"grass","position":[-54.876946259156476,0,48.79580913798708],"scale":0.8273831360931692},{"type":"grass","position":[26.178378564754613,0,8.648511215918331],"scale":1.0933831539131234},{"type":"grass","position":[99.10127883854047,0,2.6305934276646585],"scale":0.7703383498356837},{"type":"grass","position":[-14.13663945374999,0,-24.375386488848104],"scale":0.9235907957196522},{"type":"grass","position":[-56.461558705692376,0,9.117177040832129],"scale":1.0050296576464288},{"type":"grass","position":[37.507994098576255,0,-35.20239264712972],"scale":1.066291318629545},{"type":"grass","position":[4.188556100498315,0,-15.355051976968944],"scale":0.9820294980667853},{"type":"grass","position":[-10.151685326732611,0,-68.60277327810026],"scale":0.8724993275608887},{"type":"grass","position":[13.838599732560615,0,1.0311678636818855],"scale":1.218173718388711},{"type":"grass","position":[42.88991198320063,0,30.16124169106708],"scale":0.7565415547779428},{"type":"grass","position":[-10.614747803918824,0,22.963730889215395],"scale":1.039544157417279},{"type":"grass","position":[4.021172047911144,0,-9.424255406154678],"scale":1.2228977384402526},{"type":"grass","position":[-8.90364507439322,0,11.26475798292448],"scale":0.7568201504093319},{"type":"grass","position":[46.09261362523647,0,1.4260885101024903],"scale":0.9091766825261935},{"type":"grass","position":[70.56156828449171,0,-120.71871687538581],"scale":0.9677255444704657},{"type":"grass","position":[-37.989568668021064,0,27.748873017333114],"scale":1.0023201609899215},{"type":"grass","position":[-0.6616633222519286,0,125.5177040150694],"scale":0.8887722359572615},{"type":"grass","position":[-22.041681683992266,0,-55.16845650702109],"scale":1.2136535047633945},{"type":"grass","position":[-11.49574325090502,0,-3.5434673105568737],"scale":0.7756471642253386},{"type":"grass","position":[86.22349219228329,0,-110.21169878381723],"scale":0.7340947414697114},{"type":"grass","position":[66.67453578481137,0,-74.09452372374629],"scale":0.8058663087966244},{"type":"grass","position":[106.95605084827082,0,-1.6779626007087605],"scale":0.8874098453952335},{"type":"grass","position":[-8.393243898327981,0,31.165725989360617],"scale":0.8860153376683102},{"type":"grass","position":[-24.034268343597887,0,141.9860456734035],"scale":0.8431163074765469},{"type":"grass","position":[-83.26057862294124,0,23.74721946146269],"scale":1.0182991482412291},{"type":"grass","position":[4.7629773901493175,0,-2.6459650714465712],"scale":1.2009694130130824},{"type":"grass","position":[-134.1370965477067,0,-1.9969497718336535],"scale":1.1392086915035116},{"type":"grass","position":[-35.95387840258508,0,25.985038099408143],"scale":0.8907221152829627},{"type":"grass","position":[1.8877424884150416,0,-5.766669492709133],"scale":0.869810217221531},{"type":"grass","position":[5.188148874610121,0,-12.396243188040202],"scale":1.1527712154120628},{"type":"grass","position":[53.73549129760282,0,51.73906044413237],"scale":1.1663828090988804},{"type":"grass","position":[-42.467942679060265,0,6.5916102401578405],"scale":0.8075193458462305},{"type":"grass","position":[36.42552051995237,0,22.09102893375297],"scale":0.7838963197164208},{"type":"grass","position":[-6.080186786384216,0,-3.969641603755028],"scale":1.0070990280162668},{"type":"grass","position":[-92.88377013025462,0,-21.53815201611375],"scale":0.7928115773298067},{"type":"grass","position":[-13.390211686648385,0,-1.0125611866058695],"scale":1.2823521937434026},{"type":"grass","position":[-122.12620517440722,0,36.51321940679082],"scale":0.8575374170513488},{"type":"grass","position":[-82.75028677010022,0,90.30935872130873],"scale":1.024096013167911},{"type":"grass","position":[105.03189377590651,0,36.32875696891849],"scale":1.1916141946713517},{"type":"grass","position":[-76.68514555616859,0,15.286437486845967],"scale":0.7777905517820821},{"type":"grass","position":[103.1552598876975,0,-103.72151056994015],"scale":1.1281059733497742},{"type":"grass","position":[-109.56405577250129,0,-96.40403035035949],"scale":0.8702213543564983},{"type":"grass","position":[-24.52389270277205,0,-16.88705696313039],"scale":0.9354899046830691},{"type":"grass","position":[92.89346880751654,0,-4.213432323207785],"scale":1.0737453329646423},{"type":"grass","position":[69.51113152357277,0,-0.34627439049706504],"scale":1.19499540463204},{"type":"grass","position":[55.9318373900179,0,-35.54479546519448],"scale":1.1016817340997578},{"type":"grass","position":[-16.97782981974045,0,-86.84259619605851],"scale":1.1675720468419528},{"type":"grass","position":[56.28365147310051,0,-137.85687602634516],"scale":0.9842904960137102},{"type":"grass","position":[104.25598322666914,0,82.14507071212944],"scale":0.8362432258973804},{"type":"grass","position":[15.049241484092168,0,1.0859744061413903],"scale":1.2156982529120421},{"type":"grass","position":[51.678035150167865,0,12.707401486065612],"scale":1.033330539747511},{"type":"grass","position":[-0.27073922286312246,0,106.441163641186],"scale":1.0607682748226956},{"type":"grass","position":[3.371105310809606,0,12.426074169457214],"scale":1.234714808360405},{"type":"grass","position":[70.94909863861383,0,0.052054757177190464],"scale":1.2513028803042823},{"type":"grass","position":[90.62868473266566,0,-26.575476177299464],"scale":1.215396792875734},{"type":"grass","position":[-57.632312176236745,0,-20.98645625616827],"scale":1.0306481472526414},{"type":"grass","position":[-79.29925313724092,0,50.46394315127108],"scale":1.0807806445015442},{"type":"grass","position":[29.742999451468624,0,-27.46974722127679],"scale":1.033251419527064},{"type":"grass","position":[-119.85832465337843,0,80.60382567912607],"scale":1.028544329755892},{"type":"grass","position":[-109.82098605316735,0,-1.148566689785373],"scale":1.1067193562161775},{"type":"grass","position":[3.8662055478233714,0,-8.853063256282473],"scale":0.71914935622405},{"type":"grass","position":[-71.27370249936868,0,-112.46757898249139],"scale":1.2742208159847224},{"type":"grass","position":[-141.15552225412026,0,13.214217544246466],"scale":0.8459462212324199},{"type":"grass","position":[-8.784202079093356,0,88.21463673655656],"scale":0.8098952999431166},{"type":"grass","position":[-136.3620521780227,0,-43.200116307087185],"scale":1.2865406855010266},{"type":"grass","position":[-19.95010300445935,0,-25.029079299451976],"scale":0.9172907731835815},{"type":"grass","position":[-1.7053995207096238,0,-11.508981546428453],"scale":1.2984003321669704},{"type":"grass","position":[32.203138703891845,0,-0.2654910436166888],"scale":1.2625887591835814},{"type":"grass","position":[-62.36122789201051,0,-31.105490434354294],"scale":1.0682716708836553},{"type":"grass","position":[79.11480857534721,0,-3.0489969078555252],"scale":1.0245479234348034},{"type":"grass","position":[-16.746937464144228,0,86.92640836759197],"scale":0.9523355049754447},{"type":"grass","position":[47.757340378649204,0,-132.4395626287801],"scale":0.7671702265450019},{"type":"grass","position":[-34.48138124473756,0,-37.61822055578705],"scale":0.820008855293665},{"type":"grass","position":[-0.0014768318376853608,0,-22.09369457512488],"scale":1.1905323795571607},{"type":"grass","position":[-22.28774804943185,0,7.270325825196173],"scale":1.167792180049953},{"type":"grass","position":[-24.911503735239823,0,4.930687346150095],"scale":0.8742635917763101},{"type":"grass","position":[73.83501629104587,0,11.536691098405075],"scale":1.0335981363143445},{"type":"grass","position":[-56.731193764386425,0,40.94470376186995],"scale":0.8450226612024923},{"type":"grass","position":[-11.24482153992858,0,53.27739309371003],"scale":1.2339886220761938},{"type":"grass","position":[3.911370630155537,0,-140.76108734173627],"scale":0.8906594036608053},{"type":"grass","position":[-30.87093413102415,0,98.72592346282757],"scale":1.2372077304948403},{"type":"grass","position":[23.22387298013185,0,-47.7401550391978],"scale":0.9234699279564234},{"type":"grass","position":[58.705757663161606,0,-31.812213138192202],"scale":0.8908024351811068},{"type":"grass","position":[-107.36868644079176,0,-35.58581041206578],"scale":1.273034030048771},{"type":"grass","position":[-16.39919034011356,0,71.40936560044057],"scale":0.8168680149688139},{"type":"grass","position":[12.938343016269172,0,20.759458713478622],"scale":1.1873613088271184},{"type":"grass","position":[63.65986434253756,0,116.0341297786023],"scale":1.2912319046384888},{"type":"grass","position":[0.41058888038772523,0,-0.04710197146368344],"scale":0.9121368181962142},{"type":"grass","position":[30.329626130770077,0,59.250412569946164],"scale":1.186691132731242},{"type":"grass","position":[13.187689885420378,0,-105.78579110795738],"scale":0.7186213318784981},{"type":"grass","position":[19.185787090694905,0,8.592109386212092],"scale":1.0031850400270748},{"type":"grass","position":[-29.460768610101482,0,-55.27658515350261],"scale":0.9762612172960993},{"type":"grass","position":[-43.88285235327991,0,-20.34988423458584],"scale":0.9969101727373602},{"type":"grass","position":[7.052253803088018,0,-113.49550157759457],"scale":1.056903660001703},{"type":"grass","position":[-14.173464430911073,0,48.77672936922413],"scale":1.144997605643336},{"type":"grass","position":[-23.582480251772306,0,-13.645987426936674],"scale":0.9058485041520821},{"type":"grass","position":[-146.60791719935543,0,-22.394118227311143],"scale":1.1151426178861013},{"type":"grass","position":[76.57976831505617,0,-38.82436126812678],"scale":1.0003835143344288},{"type":"grass","position":[50.12992849063207,0,-89.18077314895139],"scale":0.9089610514757647},{"type":"grass","position":[28.420635555246303,0,12.298081523064184],"scale":1.0823226633511436},{"type":"grass","position":[-11.131426925295246,0,-46.057374886830004],"scale":0.8392910297046704},{"type":"grass","position":[60.805476871779405,0,-10.669914544103008],"scale":0.7937652276037894},{"type":"grass","position":[76.49686789410987,0,23.895901138419077],"scale":1.0604017782112138},{"type":"grass","position":[-80.36291438507307,0,-76.85538635813806],"scale":0.7304322748344078},{"type":"grass","position":[3.350466576440241,0,-84.46964074504344],"scale":1.0071222389701615},{"type":"grass","position":[116.36536061066197,0,-82.82807372004636],"scale":1.292753625383225},{"type":"grass","position":[-47.14569462594779,0,-28.856356218930333],"scale":0.970016186734324},{"type":"grass","position":[-37.95977834850706,0,-24.08874473467965],"scale":1.2434511066554357},{"type":"grass","position":[92.08897887503103,0,100.49044907786484],"scale":1.2803346467527197},{"type":"grass","position":[-93.62297101327874,0,-71.72669851035415],"scale":0.915331102763011},{"type":"grass","position":[-9.413982053119792,0,23.490732987793425],"scale":1.2815500153861046},{"type":"grass","position":[36.20038941870198,0,-63.96555678989532],"scale":1.1739725448094234},{"type":"grass","position":[29.997018111607666,0,32.36985866573391],"scale":0.7612018153975982},{"type":"grass","position":[-8.60824253743658,0,-2.4387507277392095],"scale":0.9294629606282787},{"type":"grass","position":[-97.51725378768721,0,-66.15597483585434],"scale":1.2659459383468767},{"type":"grass","position":[84.00550935376367,0,-115.11271350844076],"scale":0.8326885388100485},{"type":"grass","position":[13.581770932452637,0,9.840595682291024],"scale":0.8974838999953011},{"type":"grass","position":[8.895361460134133,0,-112.73394816071523],"scale":0.8498828432562999},{"type":"grass","position":[105.01554886072508,0,8.890760107618165],"scale":0.8978474857067973},{"type":"grass","position":[39.74898483882562,0,25.249372962004447],"scale":1.2922623573758023},{"type":"grass","position":[-33.520975448985304,0,-76.68891911078846],"scale":1.0038779783295273},{"type":"grass","position":[5.453876317586266,0,-3.907888762611546],"scale":1.1096223464541692},{"type":"grass","position":[102.40831054578976,0,24.320725473010864],"scale":0.9655402126366518},{"type":"grass","position":[-8.951317730129873,0,-121.74678675279553],"scale":1.2518960228751772},{"type":"grass","position":[43.73878177171338,0,44.33275309328355],"scale":1.0056437582269884},{"type":"grass","position":[16.09760425466127,0,68.19070081961615],"scale":0.9307734850632204},{"type":"grass","position":[72.4150809253541,0,119.06627266400234],"scale":1.2661827138164718},{"type":"grass","position":[119.20708074303481,0,42.67902789873911],"scale":0.8715489742669378},{"type":"grass","position":[35.63999820263054,0,-21.546146507986776],"scale":1.278278147256343},{"type":"grass","position":[-106.93821519150754,0,-27.064081333580166],"scale":1.0924943588621794},{"type":"grass","position":[19.906374911852872,0,77.88717422654179],"scale":0.791409924609705},{"type":"grass","position":[-4.0195670502587415,0,-149.3676336657027],"scale":1.269052947979671},{"type":"grass","position":[-3.2843351778944103,0,25.49623924570742],"scale":0.9393438578602338},{"type":"grass","position":[118.52655693540862,0,73.29934198259772],"scale":0.8354871689114063},{"type":"grass","position":[34.26906071221056,0,-21.86808596205028],"scale":0.728001762186927},{"type":"grass","position":[29.297295492544297,0,31.79557806219767],"scale":0.8246850460317198},{"type":"grass","position":[11.24795828437448,0,-17.178522433376283],"scale":0.8098761425345852},{"type":"grass","position":[-65.81479450474582,0,-46.92782309500839],"scale":0.9170016411481527},{"type":"grass","position":[-12.974107501179573,0,25.18897620518209],"scale":0.717644879148623},{"type":"grass","position":[74.2566456874823,0,29.883981763630672],"scale":1.0953525117558938},{"type":"grass","position":[94.18422888855856,0,-85.22035784978353],"scale":0.8639300328476971},{"type":"grass","position":[40.38711372428442,0,-83.99626331731811],"scale":1.057421582457127},{"type":"grass","position":[-74.18042621281892,0,11.094826101651119],"scale":0.9089466578527963},{"type":"grass","position":[-34.26599130421704,0,7.614860559268909],"scale":0.7373808659535905},{"type":"grass","position":[11.53848983249545,0,1.7529495681621539],"scale":0.798983801733393},{"type":"grass","position":[33.522027778839025,0,48.32663890305943],"scale":1.2284079664502348},{"type":"grass","position":[0.07764935647425057,0,7.128466247056356],"scale":0.9099642071246908},{"type":"grass","position":[42.3977377674615,0,-9.741336493675364],"scale":0.717441504886904},{"type":"grass","position":[-26.884481427676235,0,143.71308939316836],"scale":0.7504698548424675},{"type":"grass","position":[64.881331523161,0,3.5083520059418514],"scale":0.8709530325217805},{"type":"grass","position":[-4.067077549890784,0,2.3455276848338755],"scale":1.1203598182703327},{"type":"grass","position":[-2.108258865491586,0,65.09587087489832],"scale":0.7424351493601736},{"type":"grass","position":[-3.3338777122453256,0,-50.91923824489952],"scale":0.8111022326207005},{"type":"grass","position":[115.021569422446,0,2.2333621672894686],"scale":1.0504596401926334},{"type":"grass","position":[-72.82661832304883,0,34.603052779191955],"scale":0.794826310436857},{"type":"grass","position":[17.101161550113147,0,1.6571622553736438],"scale":1.0642512345164146},{"type":"grass","position":[5.19429854189306,0,-9.912793924512638],"scale":1.0413244981694483},{"type":"grass","position":[78.79910019003111,0,-68.86069991501559],"scale":0.8209065506054294},{"type":"grass","position":[78.04256014437428,0,89.8038404054463],"scale":1.222825790827283},{"type":"grass","position":[-136.6684547793245,0,-46.52084383649979],"scale":0.7707267787822033},{"type":"grass","position":[91.84799371686779,0,-112.39166958035861],"scale":1.2201908523448153},{"type":"grass","position":[54.75964200743654,0,-14.787258719877519],"scale":0.9116301980212489},{"type":"grass","position":[115.96309182954337,0,-48.04795213045817],"scale":1.131438775178647},{"type":"grass","position":[127.37208980268203,0,48.69188456701223],"scale":0.7552943218048493},{"type":"grass","position":[-37.36570925169987,0,47.66341949318333],"scale":1.105312252863892},{"type":"grass","position":[-59.41284669562678,0,-70.4108172805093],"scale":0.8453745575623927},{"type":"grass","position":[49.78688185147987,0,67.21410600398643],"scale":0.9337502172859964},{"type":"grass","position":[-9.026430973579684,0,3.05159271292247],"scale":1.199129590931958},{"type":"grass","position":[-53.55051285005291,0,-99.5737281404222],"scale":0.9991362665405836},{"type":"grass","position":[-70.01990635988159,0,51.566164934802956],"scale":0.8788653088006906},{"type":"grass","position":[-51.5732838517017,0,25.019229617298397],"scale":1.2085250084732024},{"type":"grass","position":[82.27986136598753,0,-32.80440475804184],"scale":1.1185344890456017},{"type":"grass","position":[-43.140512244554465,0,-8.860326543407522],"scale":0.9087809688821766},{"type":"grass","position":[26.921759869629643,0,-1.8546681087597068],"scale":0.8066888382933017},{"type":"grass","position":[-7.606002296023024,0,-84.70671953453501],"scale":0.81464007280781},{"type":"grass","position":[33.62652496243359,0,64.27902589415412],"scale":1.1695326190880753},{"type":"grass","position":[47.809901817302126,0,27.336197413174112],"scale":0.9072522596182301},{"type":"grass","position":[-128.7865155304062,0,-14.777245532845015],"scale":0.7355991490116485},{"type":"grass","position":[82.97532180709061,0,92.86983522157281],"scale":0.990947544125975},{"type":"grass","position":[-33.189744764891906,0,-25.843038028501432],"scale":1.0919373065777207},{"type":"grass","position":[83.91047245323782,0,-22.5494939055695],"scale":1.1514790718900851},{"type":"grass","position":[29.36440073297468,0,14.195165536759639],"scale":0.7612975445735515},{"type":"grass","position":[-37.69959850412924,0,28.562899091359142],"scale":1.0751851554384153},{"type":"grass","position":[1.7030730279497626,0,-1.0333889703193886],"scale":0.9203565166113326},{"type":"grass","position":[53.62908685303213,0,-34.286641702694084],"scale":1.207771721185079},{"type":"grass","position":[71.00642435864967,0,45.21772754870109],"scale":0.9012773465106164},{"type":"grass","position":[-66.52082664027762,0,50.012272404377406],"scale":0.9297963890308754},{"type":"grass","position":[-13.375600103766931,0,4.823446797074551],"scale":0.8015667249775404},{"type":"grass","position":[25.689361355000678,0,57.52669914641888],"scale":1.2108306022212065},{"type":"grass","position":[36.972279061469955,0,107.62697283657094],"scale":0.8246495391016978},{"type":"grass","position":[0.7950377925693126,0,6.67564567499213],"scale":1.1582826356559568},{"type":"grass","position":[-24.937614591313697,0,-142.91300329045572],"scale":0.7195134478358955},{"type":"grass","position":[7.118392752022647,0,-141.20109529243172],"scale":0.9024769558962917},{"type":"grass","position":[-73.58497405574258,0,51.73557748051474],"scale":1.1044578736497255},{"type":"grass","position":[94.81071951344626,0,-22.114308107163577],"scale":0.8377433974574404},{"type":"grass","position":[-11.409283756234084,0,0.9129212353663223],"scale":0.893718973561884},{"type":"grass","position":[10.232913841294694,0,-91.04850298014166],"scale":0.9157670757717552},{"type":"grass","position":[16.63879089872973,0,2.8982051436767087],"scale":0.8028095294124703},{"type":"grass","position":[-117.72064055213987,0,15.678306434177957],"scale":0.9847963821832189},{"type":"grass","position":[5.788762715024582,0,-6.1169461120361985],"scale":1.0090967174471404},{"type":"grass","position":[-24.735884591993674,0,54.62385976150053],"scale":0.948827170972234},{"type":"grass","position":[-61.69768353807235,0,55.1615524299688],"scale":0.7916558149222102},{"type":"grass","position":[85.16017595639758,0,-48.25293421458384],"scale":1.0408225980108725},{"type":"grass","position":[-18.24546070184506,0,24.254274313732836],"scale":1.2435016550109022},{"type":"grass","position":[-2.5087550558868035,0,0.06601067292185431],"scale":0.7420971235733048},{"type":"grass","position":[35.618388525252584,0,79.74290247132122],"scale":1.207247997884963},{"type":"grass","position":[-95.94275105274835,0,-114.46879208887405],"scale":1.1524591956265218},{"type":"grass","position":[-146.74438218799767,0,-18.767438526523232],"scale":1.2054517543712424},{"type":"grass","position":[-25.40945727938845,0,28.683388274242184],"scale":1.133685458959354},{"type":"grass","position":[-103.61707634159683,0,-73.50348197872393],"scale":0.8586213960443603},{"type":"grass","position":[15.337991008494756,0,-106.66356227663715],"scale":0.7741648913416713},{"type":"grass","position":[41.2887673325494,0,-76.41625464458103],"scale":1.2609407797801386},{"type":"grass","position":[51.87476635903841,0,-43.6858802539777],"scale":0.9552375253429548},{"type":"grass","position":[1.0817703458342514,0,66.1291434254109],"scale":1.2264835876884668},{"type":"grass","position":[-61.343463254236454,0,-59.937386235638016],"scale":0.7013447464825914},{"type":"grass","position":[20.38507750417578,0,138.2019153027098],"scale":1.1499068634938774},{"type":"grass","position":[19.788038394980234,0,-20.367904248825628],"scale":0.9902757094402299},{"type":"grass","position":[-10.41180387455428,0,30.973117763324645],"scale":1.2308827240578406},{"type":"grass","position":[-62.172007113322074,0,-23.993953394321167],"scale":1.000282795804687},{"type":"grass","position":[67.73807174937068,0,-48.79527287425637],"scale":0.8398999307328496},{"type":"grass","position":[122.21015246259829,0,-53.48372879988962],"scale":0.714145058800153},{"type":"grass","position":[-67.55785366034885,0,-22.53610282215907],"scale":1.094387054390329},{"type":"grass","position":[-102.0714836340381,0,-73.58312725168463],"scale":0.8084641990567125},{"type":"grass","position":[-11.923307512674088,0,-12.448843827422838],"scale":1.0167102428742294},{"type":"grass","position":[26.780852088039236,0,-25.888862856090693],"scale":0.7374903111567577},{"type":"grass","position":[-83.78789792644187,0,-64.42495604105659],"scale":1.0010362319437336},{"type":"grass","position":[-59.55329549145232,0,52.43943976094777],"scale":1.1441722588196725},{"type":"grass","position":[6.810219796042914,0,-114.24769488198234],"scale":0.877759052057797},{"type":"grass","position":[-112.81861486694916,0,-30.710139830946517],"scale":1.0043161165730912},{"type":"grass","position":[-44.545846318544726,0,-15.586949121080476],"scale":1.2567476067204078},{"type":"grass","position":[-96.92269674548655,0,7.654295283490127],"scale":1.0635150826922084},{"type":"grass","position":[-74.59682468984329,0,52.892239786445536],"scale":0.7949947675694022},{"type":"grass","position":[3.923632984137352,0,5.628518933808761],"scale":0.8100347731755728},{"type":"grass","position":[25.080400942930144,0,-90.4561237225217],"scale":1.0598146797878687},{"type":"grass","position":[18.258948794345574,0,130.91050686246538],"scale":0.9014291506130042},{"type":"grass","position":[18.52425721216761,0,48.99268769736478],"scale":0.8731568364852609},{"type":"grass","position":[12.126945354603363,0,-104.35988249064127],"scale":0.7393057047310293},{"type":"grass","position":[7.106385849593417,0,25.46838899392139],"scale":0.8910910310520676},{"type":"grass","position":[42.61236219601713,0,-59.00688024515838],"scale":0.914672608108017},{"type":"grass","position":[42.39494802393775,0,-134.07895751474786],"scale":0.7524664835438466},{"type":"grass","position":[117.7262927984291,0,-34.6175426344416],"scale":0.9252518624743525},{"type":"grass","position":[-16.29498080664696,0,15.882002319453738],"scale":0.839122603733353},{"type":"grass","position":[-70.23161753833514,0,-10.521667567037008],"scale":1.0887145758246457},{"type":"grass","position":[-16.803210922711386,0,-88.50197382351733],"scale":1.0513327696323085},{"type":"grass","position":[-30.515901239294966,0,-81.32687807434559],"scale":1.102166818086327},{"type":"grass","position":[84.44055406503176,0,-87.7380464036571],"scale":1.1231591290816216},{"type":"grass","position":[-16.58784303646919,0,-54.90829246547961],"scale":1.1099780729848148},{"type":"grass","position":[8.397575899817552,0,35.09871179249858],"scale":0.8858448503777592},{"type":"grass","position":[-46.798217535713775,0,122.49881692626654],"scale":0.7260236756795496},{"type":"grass","position":[88.47823385154709,0,-93.68226756007456],"scale":0.9932273084978979},{"type":"grass","position":[70.63276273482954,0,47.5995419547698],"scale":1.1935548363591733},{"type":"grass","position":[49.32924628085559,0,-122.82314264002586],"scale":0.8843899131619435},{"type":"grass","position":[-64.36870624982285,0,67.16113060604013],"scale":1.1849848515364965},{"type":"grass","position":[0.3563964959668734,0,122.88744922566195],"scale":1.2516684689429134},{"type":"grass","position":[90.8488924947915,0,-33.043876552812655],"scale":0.7153369601309125},{"type":"grass","position":[-4.308562044811939,0,27.332502112265814],"scale":1.2542262259940868},{"type":"grass","position":[-30.96130204309298,0,-81.45661972753845],"scale":1.0807823958724438},{"type":"grass","position":[54.70566933517269,0,-134.78452016799272],"scale":0.9644711448596882},{"type":"grass","position":[-4.3703628049723,0,-111.05457470224978],"scale":1.1808199338424141},{"type":"grass","position":[-84.17796262720307,0,-112.69623414255756],"scale":1.0598408017077157},{"type":"grass","position":[-18.409762018690913,0,41.6537139751729],"scale":0.8212775786794781},{"type":"grass","position":[-75.9860552450664,0,115.64474092891277],"scale":0.8779960496761041},{"type":"grass","position":[72.34449135109722,0,95.2244338764526],"scale":0.791194391974393},{"type":"grass","position":[21.53067908368996,0,-40.53811730492639],"scale":1.089429530482189},{"type":"grass","position":[22.552851150540913,0,145.2174163629877],"scale":0.9473067257437782},{"type":"grass","position":[17.449046601706538,0,-26.082842929658998],"scale":1.2803742075759792},{"type":"grass","position":[84.71881936422078,0,53.594539741892106],"scale":0.7626348747919565},{"type":"grass","position":[123.09503903908977,0,56.917244616647814],"scale":0.766386270238064},{"type":"grass","position":[-16.178979333469453,0,99.90863014589365],"scale":1.053520545019818},{"type":"grass","position":[78.710807985543,0,-53.54468086941323],"scale":0.7525981049355751},{"type":"grass","position":[-111.8852747137404,0,-63.70202870014084],"scale":1.0837924386615292},{"type":"grass","position":[-22.383668002201976,0,8.12739301521785],"scale":0.7268981240805367},{"type":"grass","position":[-5.777239233606818,0,-31.797352565778887],"scale":0.8413042646747004},{"type":"grass","position":[25.66710914805336,0,1.001088007857797],"scale":0.9599626959340395},{"type":"grass","position":[85.01685901985391,0,19.66731598881522],"scale":0.9294145240310403},{"type":"grass","position":[-18.244816761401832,0,-137.99287161553468],"scale":1.002249255710281},{"type":"grass","position":[-32.204406290420614,0,-90.38089968637975],"scale":1.1344969874342608},{"type":"grass","position":[-29.72053480339656,0,85.91459597645444],"scale":1.0754105849950673},{"type":"grass","position":[-19.92158737242199,0,-3.7367094761120363],"scale":1.0093207238843083},{"type":"grass","position":[-99.47161777158307,0,32.5886175521428],"scale":0.9984086315257588},{"type":"grass","position":[44.32658384442833,0,-142.12423688794345],"scale":1.0106070819705741},{"type":"grass","position":[-7.5474740409346905,0,-23.75733728529656],"scale":0.8590968405948973},{"type":"grass","position":[27.632245493174793,0,5.065707163692902],"scale":1.2936093117339125},{"type":"grass","position":[24.362302532029958,0,98.46989059224167],"scale":0.8651479710182124},{"type":"grass","position":[45.70766014868149,0,26.949956971521992],"scale":1.1679409320984775},{"type":"grass","position":[-79.30300307072717,0,54.2035983695269],"scale":0.7628256448954711},{"type":"grass","position":[-11.317968104316142,0,11.028825648406132],"scale":0.7434872321651399},{"type":"grass","position":[-28.45617984168664,0,-144.73017746888843],"scale":0.8741204212884257},{"type":"grass","position":[-143.5050821449036,0,4.127303441935101],"scale":1.2538781860565336},{"type":"grass","position":[7.2991594952389365,0,-84.3566222952057],"scale":0.8382623208763431},{"type":"grass","position":[-36.272709268853795,0,2.5719287538871725],"scale":1.1746451623957044},{"type":"grass","position":[5.161033771082242,0,90.10878696948515],"scale":1.1581447204886912},{"type":"grass","position":[127.75922323160225,0,39.52949888819645],"scale":0.8732891762576662},{"type":"grass","position":[104.54723217913487,0,-50.147027517496205],"scale":0.8913205123427174},{"type":"grass","position":[-107.68186374836118,0,-101.23178635598698],"scale":1.2544491139511142},{"type":"grass","position":[4.778850636254985,0,119.054917948652],"scale":1.0642483232036797},{"type":"grass","position":[-120.96078806286614,0,67.84026607105083],"scale":1.035434775681093},{"type":"grass","position":[135.3109019656919,0,64.6287534610399],"scale":0.9772209268033514},{"type":"grass","position":[-15.304575295138113,0,98.94582875108173],"scale":0.7261609186592501},{"type":"grass","position":[9.93704450121127,0,6.179254941248711],"scale":1.1994746302308184},{"type":"grass","position":[-73.81990696378992,0,-99.6196419148675],"scale":1.0694112214240368},{"type":"grass","position":[-7.699746600529911,0,-135.8680608735258],"scale":1.222710213611803},{"type":"grass","position":[-77.2979979460973,0,-127.67318386390721],"scale":0.8275092026647225},{"type":"grass","position":[-47.5538407806259,0,-46.93355519200062],"scale":0.9881919534586681},{"type":"grass","position":[-1.7761144130897608,0,86.7991681141484],"scale":0.8691377268680252},{"type":"grass","position":[0.4074108853471487,0,0.13844408126136626],"scale":1.2473923614528455},{"type":"grass","position":[44.89375790335854,0,135.36629040764885],"scale":1.2247698171548778},{"type":"grass","position":[20.377917300613436,0,-17.620621483928986],"scale":0.883932701268798},{"type":"grass","position":[61.23381502976853,0,-57.55293666492288],"scale":1.0336032118966005},{"type":"grass","position":[111.65347810507915,0,4.577646405597791],"scale":0.982914458915245},{"type":"grass","position":[73.71376763347644,0,-123.4080273592796],"scale":1.2042095233759678},{"type":"grass","position":[12.727932522571173,0,-89.34001836908818],"scale":0.8941622423536056},{"type":"grass","position":[41.66645169849329,0,-26.105591493424093],"scale":1.058124827480858},{"type":"grass","position":[-33.12905044642073,0,-84.48855072452407],"scale":1.1022270328697155},{"type":"grass","position":[-96.70199590536433,0,50.301951763715344],"scale":0.7743552242504791},{"type":"grass","position":[-106.99381575798827,0,-9.56783483187999],"scale":1.2896177376849907},{"type":"grass","position":[-3.9063499674018254,0,-56.34365049417703],"scale":1.019789791396407},{"type":"grass","position":[51.97668356982265,0,-62.78092057887245],"scale":0.8062928937947911},{"type":"grass","position":[-2.4645522682373553,0,-15.993672215635302],"scale":0.90883134164193},{"type":"grass","position":[61.517075628149286,0,47.16858499237733],"scale":1.0743087684511192},{"type":"grass","position":[-1.9822867803203184,0,-21.68496773429103],"scale":0.7135117283598463},{"type":"grass","position":[52.93635585562694,0,-3.6504995147022212],"scale":0.8196736211036599},{"type":"grass","position":[23.90692524635887,0,4.711366034047614],"scale":0.8267032984486116},{"type":"grass","position":[-6.169088337738785,0,67.18640531978193],"scale":0.9548674959145442},{"type":"grass","position":[9.538177975730523,0,126.16509009748127],"scale":0.8059218250797138},{"type":"grass","position":[10.15990609580003,0,0.5816348835716559],"scale":0.9956314077856645},{"type":"grass","position":[84.64238558754143,0,-81.90352416381096],"scale":0.7031950705516855},{"type":"grass","position":[58.14141877004118,0,-46.16974470790438],"scale":1.169313831187545},{"type":"grass","position":[-62.903234474671656,0,-55.06865393878994],"scale":1.157133690417988},{"type":"grass","position":[14.468867155229574,0,-36.75059426959389],"scale":1.0155479135436176},{"type":"grass","position":[-26.36549359698065,0,128.69142821126223],"scale":1.2323281900615641},{"type":"grass","position":[20.39940263708651,0,136.49458350200376],"scale":0.8172950549709703},{"type":"grass","position":[67.76917372177603,0,100.15060968227283],"scale":1.032665218091325},{"type":"grass","position":[-122.3166818706454,0,-84.87527402191856],"scale":1.1106746307031174},{"type":"grass","position":[-46.74722138763449,0,64.26528545115687],"scale":1.0488496038541077},{"type":"grass","position":[-121.83920513137119,0,-14.845621476951171],"scale":1.182494533641579},{"type":"grass","position":[78.50747026146385,0,18.06819368310096],"scale":0.8954810089291165},{"type":"grass","position":[-63.056309405494964,0,-37.32648307330151],"scale":0.833368668985873},{"type":"grass","position":[-114.94164250467804,0,-96.05877551156638],"scale":1.1811871883047906},{"type":"grass","position":[0.11283606950143468,0,1.4251257871607785],"scale":1.0324945659305873},{"type":"grass","position":[-143.53281177683664,0,3.732614357877625],"scale":0.9986725906731522},{"type":"grass","position":[100.05444257643033,0,62.40555194688554],"scale":1.1641687373267062},{"type":"grass","position":[-83.588282537554,0,35.981712694266925],"scale":0.7895978479740267},{"type":"grass","position":[28.927907869173332,0,18.814543584447087],"scale":0.8742353007497691},{"type":"grass","position":[13.617656436299443,0,-51.59617850022439],"scale":1.1992412946335922},{"type":"grass","position":[-69.53544565483665,0,19.27040270783283],"scale":0.7615910858573807},{"type":"grass","position":[-123.99070665984854,0,76.8810417479112],"scale":1.2080028938005054},{"type":"grass","position":[36.028188276309834,0,9.071067807734584],"scale":0.8062089290383079},{"type":"grass","position":[44.84671660224612,0,-67.85439811848244],"scale":0.8767780653051951},{"type":"grass","position":[1.719364658413858,0,-8.271127065800124],"scale":0.8954119045288533},{"type":"grass","position":[-66.08912539871233,0,85.34845953588645],"scale":0.8847657686195368},{"type":"grass","position":[-34.4514689470027,0,22.59658862387124],"scale":0.9152064138604487},{"type":"grass","position":[-34.501459864280406,0,-27.679432955433775],"scale":1.204391373411943},{"type":"grass","position":[-0.4686064431968773,0,25.1328991489947],"scale":1.2514516273480183},{"type":"grass","position":[40.887225290372776,0,-67.0164598586594],"scale":1.0259545576109488},{"type":"grass","position":[29.25671207794386,0,61.775915486786346],"scale":0.765893322116716},{"type":"grass","position":[-72.20312087882016,0,59.677254674756306],"scale":0.7988675620719767},{"type":"grass","position":[-22.366619059628324,0,-11.538859005216585],"scale":1.2461852469029402},{"type":"grass","position":[4.049542279424871,0,-1.293892023854139],"scale":1.1117253384073795},{"type":"grass","position":[31.704961527770806,0,-126.47546068736284],"scale":0.9981950675865712},{"type":"grass","position":[-17.198942402368107,0,3.714462562131697],"scale":0.8776740480387029},{"type":"grass","position":[-12.47081801310866,0,29.928837836261053],"scale":0.9915508483678058},{"type":"grass","position":[-81.82390539000608,0,-81.16510178409007],"scale":0.9916527390059819},{"type":"grass","position":[-85.6648582815219,0,-56.26586667050921],"scale":0.8140826244890598},{"type":"grass","position":[-10.323990564061313,0,-11.472199167879559],"scale":1.1880626030391788},{"type":"grass","position":[-24.363173017220547,0,-17.516997733766804],"scale":1.0208368953425841},{"type":"grass","position":[-2.263621636189786,0,21.173224096481125],"scale":1.2298732883299097},{"type":"grass","position":[-84.03734766686892,0,-67.9439876530119],"scale":0.8819016459957528},{"type":"grass","position":[148.32658942862395,0,15.572457545131309],"scale":1.1396051209089437},{"type":"grass","position":[-10.353004808420854,0,-33.95090382082223],"scale":1.1152844297553743},{"type":"grass","position":[106.58535402282752,0,70.30111940164089],"scale":0.8076907281949925},{"type":"grass","position":[5.358954197250572,0,2.921608845161109],"scale":1.2481665217020899},{"type":"grass","position":[15.49919234869423,0,30.195140828994337],"scale":0.7427328955872134},{"type":"grass","position":[13.500541712814599,0,-16.945009867894857],"scale":0.8811391379055548},{"type":"grass","position":[-46.59391003764411,0,81.86915557212346],"scale":0.8165063848673355},{"type":"grass","position":[1.2901922845640401,0,53.91392685819283],"scale":0.8456803061249754},{"type":"grass","position":[22.22209380417853,0,-26.526798451155145],"scale":0.9622405091299893},{"type":"grass","position":[72.33174530588796,0,-78.25365092195244],"scale":0.9816521123316464},{"type":"grass","position":[95.78840198818462,0,-5.87719612717587],"scale":0.9006774935107903},{"type":"grass","position":[-35.96873496967537,0,83.55747815692763],"scale":1.1915229222196766},{"type":"grass","position":[-43.53663731953018,0,-52.15545198965645],"scale":1.0842916367058868},{"type":"grass","position":[-77.12903089686746,0,2.1363751300663765],"scale":0.7536396058473076},{"type":"grass","position":[-38.02096585504808,0,-114.38900353316664],"scale":0.9612148214795351},{"type":"grass","position":[-119.77452744693281,0,-22.63311873268734],"scale":0.9291255054844517},{"type":"grass","position":[146.01039168632596,0,-21.920735188823453],"scale":1.1266875467240647},{"type":"grass","position":[-72.02786032573479,0,7.56405357196612],"scale":1.1408355372897896},{"type":"grass","position":[-58.86845227566114,0,64.86174781249998],"scale":1.2474208827981665},{"type":"grass","position":[23.50548274318352,0,81.73654641880037],"scale":1.0020271205255131},{"type":"grass","position":[141.7193472839004,0,-1.0754850336293387],"scale":1.099519909429656},{"type":"grass","position":[19.383693802440572,0,54.36999549455615],"scale":1.1787365317183514},{"type":"grass","position":[-83.9637277851276,0,39.01582858604649],"scale":1.0741785181040866},{"type":"grass","position":[38.76728654636167,0,28.652195324659502],"scale":0.8939643542725132},{"type":"grass","position":[-124.38841326847758,0,13.341281525975141],"scale":1.1634082202469103},{"type":"grass","position":[4.80912364046845,0,0.01989161913444188],"scale":0.9743269990722031},{"type":"grass","position":[-37.8810212549656,0,32.87012498460877],"scale":1.2631806896476758},{"type":"grass","position":[-63.12654736378066,0,24.98697912282546],"scale":1.2480428925694498},{"type":"grass","position":[-1.2967788977689036,0,-2.066194316984059],"scale":0.9104280787603759},{"type":"grass","position":[83.41506911192144,0,23.144227214201297],"scale":1.1360771547679511},{"type":"grass","position":[2.9749028117101464,0,-21.69999148545673],"scale":0.725376578176629},{"type":"grass","position":[83.76918706800016,0,-44.958218438890356],"scale":0.9203300832900704},{"type":"grass","position":[-3.4132842168685373,0,1.7179531180753187],"scale":1.1303745253860595},{"type":"grass","position":[-8.531937536252878,0,-20.249483845921414],"scale":1.1249554909422352},{"type":"grass","position":[22.49054431820287,0,38.823561450738644],"scale":0.7814125682356687},{"type":"grass","position":[-28.532298248761588,0,34.1560175132252],"scale":1.1294196296532406},{"type":"grass","position":[65.7456238948262,0,-111.28760095262875],"scale":0.7227035837390353},{"type":"grass","position":[-16.260525629631886,0,5.530194000749808],"scale":1.2436940154010125},{"type":"grass","position":[-48.56042936081876,0,40.932333342561286],"scale":1.053048833515652},{"type":"grass","position":[-89.00561992966226,0,-120.52954086847764],"scale":0.7368447696370453},{"type":"grass","position":[27.47427979109133,0,-35.225622871809406],"scale":1.2778875271355497},{"type":"grass","position":[-122.4172790361809,0,-53.48561324008749],"scale":0.7322908237750251},{"type":"grass","position":[-104.81206516622218,0,106.62930651528626],"scale":0.9599601473230894},{"type":"grass","position":[14.199809908857997,0,0.8292874233825157],"scale":1.1331012626158694},{"type":"grass","position":[-22.8664254438985,0,131.77117764590457],"scale":1.201261394727791},{"type":"grass","position":[-8.947812522107695,0,-14.562108495518984],"scale":1.0816458919623317},{"type":"grass","position":[-101.04042472044682,0,-103.19544126175994],"scale":1.2732546072076283},{"type":"grass","position":[-102.9088677031076,0,24.765397374503067],"scale":1.1077131707592969},{"type":"grass","position":[-82.01727445492182,0,30.40303548655673],"scale":0.7730203303297837},{"type":"grass","position":[-3.54555963933547,0,2.986988388876776],"scale":0.9426651274257842},{"type":"grass","position":[41.9489451939163,0,-51.67122798968954],"scale":1.0593029456888496},{"type":"grass","position":[-38.48357550364389,0,-15.569292488119345],"scale":1.0102725230319418},{"type":"grass","position":[-29.02254948324336,0,14.934516179196578],"scale":0.9731696279150626},{"type":"grass","position":[58.887889975243255,0,126.21267883876612],"scale":0.9764870081812624},{"type":"grass","position":[-72.12889355907161,0,24.51651963294954],"scale":1.1007256973439858},{"type":"grass","position":[-26.67609143775336,0,-117.67153775181801],"scale":1.0381341146905396},{"type":"grass","position":[0.08187983345557277,0,148.64600932236024],"scale":1.2893686918402327},{"type":"grass","position":[-2.903446353016912,0,-7.6856596617735695],"scale":1.1115967808451814},{"type":"grass","position":[-66.99288938860722,0,-112.90723021030996],"scale":1.0896166517191788},{"type":"grass","position":[73.3141459084694,0,79.17429559518523],"scale":1.1027416972860042},{"type":"grass","position":[26.60858352870382,0,75.00742877299672],"scale":0.915235688406999},{"type":"grass","position":[3.203592418416031,0,4.061810800578973],"scale":1.248524776021747},{"type":"grass","position":[-34.47603807170862,0,-22.724503537389673],"scale":1.2546194025715354},{"type":"grass","position":[35.637021340691255,0,9.5863842282279],"scale":1.1969587271935158},{"type":"grass","position":[139.66691409273812,0,-34.69404938879251],"scale":0.7041030625057112},{"type":"grass","position":[-54.911797049288815,0,85.65560281640433],"scale":0.8675397037443315},{"type":"grass","position":[113.58553948624416,0,-47.53877979627987],"scale":0.8973625597093255},{"type":"grass","position":[-2.664274725989727,0,87.56321372581696],"scale":0.8383357153104761},{"type":"grass","position":[-74.52632609489841,0,60.86387950421072],"scale":1.0282484054051988},{"type":"grass","position":[36.12164530587201,0,-2.9505281715612397],"scale":0.9168451833509736},{"type":"grass","position":[79.97847015690512,0,49.107188150304204],"scale":1.2133583046191276},{"type":"grass","position":[15.417149021645034,0,51.35028752043139],"scale":0.9667530723326502},{"type":"grass","position":[45.94363179499905,0,-35.17697386861724],"scale":0.7293793471627706},{"type":"grass","position":[54.75585156899558,0,70.74952680544202],"scale":0.8337687953495465},{"type":"grass","position":[1.5243831898348756,0,-4.538968820720233],"scale":0.8596110066251543},{"type":"grass","position":[-32.49380246454034,0,65.21623408434913],"scale":0.9982299776199809},{"type":"grass","position":[-53.88492675462512,0,-59.18483816612964],"scale":0.7378717566723489},{"type":"grass","position":[-58.01707334031674,0,119.19245660509857],"scale":0.9612856301099746},{"type":"grass","position":[-86.91529795799637,0,-98.47187885300622],"scale":1.2487489336904747},{"type":"grass","position":[-113.55461844096362,0,-56.92863015590214],"scale":1.0195890048055705},{"type":"grass","position":[-98.57427713483338,0,27.952235922541057],"scale":0.889314418086623},{"type":"grass","position":[12.65850089776046,0,-4.4343301002827475],"scale":1.2677590437249306},{"type":"grass","position":[76.97579970255659,0,42.62051781549266],"scale":1.0185938308304605},{"type":"grass","position":[-0.766997748416335,0,1.4715993679702721],"scale":1.182125686100273},{"type":"grass","position":[46.50329820171249,0,-5.246441318096196],"scale":0.7524017505525711},{"type":"grass","position":[-39.889328464647974,0,-12.395251256636675],"scale":1.076786763673235},{"type":"grass","position":[4.113383201996271,0,-48.53260974591462],"scale":1.2822693713021638},{"type":"grass","position":[0.20905013511813614,0,16.069156722177496],"scale":1.1986480242793558},{"type":"grass","position":[-82.15515182231145,0,-82.6085120703149],"scale":0.8748170566548342},{"type":"grass","position":[-31.275586521924126,0,44.210869090759985],"scale":0.9324386681199953},{"type":"grass","position":[-53.289994410299585,0,-43.38380462943435],"scale":1.2558698929583114},{"type":"grass","position":[-67.29821325046704,0,29.240973286591306],"scale":1.0102320339008646},{"type":"grass","position":[-52.805781328903485,0,-66.58091387429332],"scale":0.9377971425715116},{"type":"grass","position":[-6.298712023096624,0,-29.326632005024234],"scale":1.234430095145982},{"type":"grass","position":[-18.28123856423177,0,-4.568218265500097],"scale":1.084371340822853},{"type":"grass","position":[22.374040394983552,0,23.033214357632655],"scale":1.0397592173615355},{"type":"grass","position":[-60.28121194998982,0,56.41664287985232],"scale":1.0490468647129467},{"type":"grass","position":[-50.58743694386475,0,-78.48278737479038],"scale":1.284461021369323},{"type":"grass","position":[-71.02915045975571,0,-27.28663792487379],"scale":1.1249475282226788},{"type":"grass","position":[-13.824775227223435,0,53.465650972346886],"scale":0.8365316444380655},{"type":"grass","position":[102.50703316100248,0,9.555113000023253],"scale":1.2135126798525309},{"type":"grass","position":[-24.08865184962314,0,90.19800046047075],"scale":0.7589390527401196},{"type":"grass","position":[-34.80805340476652,0,-33.4162440100238],"scale":0.9210913128816455},{"type":"grass","position":[65.22895076237978,0,6.551784643605984],"scale":0.9588598005127049},{"type":"grass","position":[70.34079170650574,0,12.648730011357085],"scale":0.9427250043359664},{"type":"grass","position":[-21.25263728501412,0,-26.774927842400622],"scale":1.0018860296613772},{"type":"grass","position":[72.30236530251322,0,76.7128635351982],"scale":1.1737681202523165},{"type":"grass","position":[133.8131267099368,0,-40.3247925617952],"scale":0.9528610955933314},{"type":"grass","position":[-19.674467865891252,0,-24.816681874726157],"scale":1.2105152992766737},{"type":"grass","position":[-40.336353028202026,0,125.33399736462329],"scale":1.2899235264159246},{"type":"grass","position":[3.781337486757665,0,75.59748729711762],"scale":1.1299675809037946},{"type":"grass","position":[23.713397330504055,0,-68.84348433947814],"scale":0.9734163391884312},{"type":"grass","position":[-1.966572049166075,0,-22.989771836279314],"scale":1.0753244804662758},{"type":"grass","position":[82.35145892025616,0,-22.74098153831061],"scale":1.217103901239176},{"type":"grass","position":[-8.318867113889038,0,145.96829321765657],"scale":0.8707765075506644},{"type":"grass","position":[-48.341842247949636,0,-140.11594497879113],"scale":0.8073250829211376},{"type":"grass","position":[-12.921112139216092,0,-73.4276900115082],"scale":1.2527344147542265},{"type":"grass","position":[65.78904205767552,0,-89.58970648747481],"scale":1.1834102466947607},{"type":"grass","position":[9.9048328632043,0,13.48305646233704],"scale":0.817185654783567},{"type":"grass","position":[-73.85280287785505,0,38.93558124718571],"scale":0.7141671223164475},{"type":"grass","position":[31.80546666193526,0,-125.23895274318235],"scale":0.9122698775047452},{"type":"grass","position":[71.07513670810518,0,-43.02596439242727],"scale":0.7660843312661075},{"type":"grass","position":[47.45966145937672,0,-12.805009288985847],"scale":1.220089212987527},{"type":"grass","position":[19.836747027134678,0,51.195833489920275],"scale":1.2188278269689097},{"type":"grass","position":[38.06166984179898,0,105.42248285603641],"scale":0.8347124485709001},{"type":"grass","position":[31.817239883715047,0,35.52213062291286],"scale":1.1922176467575296},{"type":"grass","position":[112.46683248489985,0,-6.179349897568211],"scale":1.2175917860030363},{"type":"grass","position":[71.90957210137461,0,-82.0704467520935],"scale":1.0731592888561785},{"type":"grass","position":[49.35961147291143,0,-99.23394448673297],"scale":1.1812400340470788},{"type":"grass","position":[-91.24381260054157,0,-85.08294840358603],"scale":0.9342644044697272},{"type":"grass","position":[-81.63167896682342,0,-72.18505659958812],"scale":1.0470373145456815},{"type":"grass","position":[-6.294678743749874,0,-147.27955215984997],"scale":0.9923684157165468},{"type":"grass","position":[144.8061930672784,0,-6.903891865610948],"scale":0.7352383142619542},{"type":"grass","position":[-54.94062020061415,0,52.6906015031705],"scale":1.0810561216509007},{"type":"grass","position":[103.27648118545747,0,47.675475871581675],"scale":0.775670777016059},{"type":"grass","position":[-47.86131764924678,0,-67.77091480772953],"scale":1.083499009244517},{"type":"grass","position":[3.630855462024745,0,35.68071813694371],"scale":1.0248124377890104},{"type":"grass","position":[-48.23703925169193,0,-29.1011194255506],"scale":1.2889967558426405},{"type":"grass","position":[-91.6351926946533,0,90.80760364440427],"scale":0.9341946314099997},{"type":"grass","position":[2.4160181472050715,0,8.653549493942355],"scale":1.026584142809116},{"type":"grass","position":[-57.258217937930574,0,-85.74249161414627],"scale":1.2837954937585887},{"type":"grass","position":[-1.9417578956801724,0,6.621125824070948],"scale":0.8011285648500776},{"type":"grass","position":[-58.30838647333431,0,-29.08413481841658],"scale":1.2470117471509816},{"type":"grass","position":[-145.82710140164573,0,8.833667889706891],"scale":1.116773272571378},{"type":"grass","position":[-78.34980783084606,0,-5.768289509471201],"scale":1.299248066992021},{"type":"grass","position":[-35.22251994466374,0,-86.87941790066722],"scale":0.8888479255234544},{"type":"grass","position":[-12.624853371535842,0,-108.93991118570128],"scale":1.1041744342420328},{"type":"grass","position":[34.930104604695394,0,87.45939753761645],"scale":1.2110528399747704},{"type":"grass","position":[-28.47269751948894,0,-19.749810411076886],"scale":0.9763886833761836},{"type":"grass","position":[-22.85148463308132,0,34.368761539820646],"scale":0.9894250846142274},{"type":"grass","position":[-39.253563155621016,0,-50.404347037717706],"scale":1.2968233245602625},{"type":"grass","position":[-116.56251375163048,0,-43.21934851503136],"scale":1.2572729837760723},{"type":"grass","position":[-2.2656280716496404,0,116.87440035518539],"scale":1.046035297498382},{"type":"grass","position":[1.8184415973057833,0,-15.73208407308836],"scale":0.9086629768991247},{"type":"grass","position":[-53.50003424358548,0,-80.319419866958],"scale":1.1647187840974156},{"type":"grass","position":[-75.34481266380924,0,-94.97108368913976],"scale":0.8875241082071802},{"type":"grass","position":[-78.03411595777213,0,-0.16900256064641986],"scale":1.1382763314267865},{"type":"grass","position":[-90.0505335231835,0,-108.69771660538945],"scale":0.7326714971244205},{"type":"grass","position":[-18.86678359841564,0,28.941864657494428],"scale":0.8888943073582094},{"type":"grass","position":[-44.890446870941794,0,-40.80848201533567],"scale":1.1219724348364228},{"type":"grass","position":[35.763054016579574,0,18.809819255087476],"scale":1.145796333412727},{"type":"grass","position":[10.322736855687664,0,-13.49865073988207],"scale":0.7580530552874634},{"type":"grass","position":[35.09343413284886,0,48.77699490895403],"scale":0.913472158054047},{"type":"grass","position":[-65.9583129005049,0,-3.2720585557716646],"scale":0.7262449821856226},{"type":"grass","position":[-16.9911277312312,0,-32.1341257379289],"scale":0.9923310525876063},{"type":"grass","position":[-10.28646316481673,0,74.65590920450911],"scale":0.807255423292126},{"type":"grass","position":[-6.373803281239288,0,18.610171272557416],"scale":1.1326663902327259},{"type":"grass","position":[6.927329176870241,0,34.80160901536172],"scale":0.9283032701658751},{"type":"grass","position":[-23.11916245858469,0,24.650482836247594],"scale":1.2757962697820333},{"type":"grass","position":[0.6348908810097363,0,-17.257428457246665],"scale":1.2690183902720933},{"type":"grass","position":[19.067202105081858,0,-11.984397602294598],"scale":0.7888982767521892},{"type":"grass","position":[22.877794226996947,0,-11.217350268064745],"scale":0.9205204684425702},{"type":"grass","position":[56.01641119562043,0,26.2612076506126],"scale":1.2767709577334991},{"type":"grass","position":[-7.229146622313181,0,7.062915033365499],"scale":1.1161449087504662},{"type":"grass","position":[3.991077380212415,0,6.995586237987706],"scale":0.8894530082608589},{"type":"grass","position":[-30.188489375748624,0,34.242533916637775],"scale":1.119381090879323},{"type":"grass","position":[64.89466194058886,0,59.06256304678491],"scale":1.0479694799868318},{"type":"grass","position":[-7.800753977579939,0,-65.39630120623536],"scale":1.1790146685849205},{"type":"grass","position":[10.93617682915882,0,-13.355602370367077],"scale":0.8234851478805086},{"type":"grass","position":[76.87263952298532,0,109.53279365217232],"scale":0.7924085791336134},{"type":"grass","position":[-32.04696168356745,0,19.472298649686174],"scale":1.227153530866063},{"type":"grass","position":[-27.250643212246604,0,3.793695298717459],"scale":1.124893261991425},{"type":"grass","position":[33.09291113771307,0,-93.68455722799256],"scale":0.7990328821158199},{"type":"grass","position":[-53.92570464390631,0,-17.389241354082014],"scale":1.0520496533216024},{"type":"grass","position":[61.15866016878453,0,-99.04147837212803],"scale":1.0862231904085697},{"type":"grass","position":[0.10534829730814915,0,-0.7406977414278207],"scale":0.7421671864010981},{"type":"grass","position":[-12.712146045203003,0,-29.431779387333545],"scale":0.9563663336647641},{"type":"grass","position":[0.13042770771252854,0,1.444637618130164],"scale":1.091077389892077},{"type":"grass","position":[-27.270062144137167,0,9.078776124623058],"scale":0.8682247528052713},{"type":"grass","position":[2.4153652644447274,0,1.8955299410676179],"scale":1.0741702572204055},{"type":"grass","position":[-18.29841235760859,0,-84.17935314790165],"scale":1.2320801722235626},{"type":"grass","position":[29.60079422564501,0,-112.84436059077004],"scale":1.2762618516323152},{"type":"grass","position":[29.011107818755814,0,88.73765605845982],"scale":1.0494504766979833},{"type":"grass","position":[111.65607226118841,0,29.561583460557877],"scale":0.9119893443043284},{"type":"grass","position":[91.8336721817143,0,-55.35237828397207],"scale":0.8308641397731361},{"type":"grass","position":[-74.50228671602788,0,-23.46649184593321],"scale":1.2586789630893414},{"type":"grass","position":[15.35036029952907,0,12.784901975751428],"scale":1.1390415050517153},{"type":"grass","position":[48.2002327197928,0,16.737462377454346],"scale":0.8084015985582688},{"type":"grass","position":[-40.130621717587125,0,50.21644163708909],"scale":1.0307823945006482},{"type":"grass","position":[-24.425009663249906,0,44.63917017674392],"scale":0.921559839176888},{"type":"grass","position":[5.902395564167275,0,-64.69381456713514],"scale":1.1557322128256715},{"type":"grass","position":[103.18947528290927,0,-55.378582349670516],"scale":1.1426898538639025},{"type":"grass","position":[-32.31579060196492,0,-66.81712437470465],"scale":1.000035183815651},{"type":"grass","position":[133.0542434594918,0,-11.842931182412881],"scale":0.731117214052686},{"type":"grass","position":[11.21441662019129,0,31.88761548939438],"scale":0.8332909546660039},{"type":"grass","position":[83.07624947911496,0,-25.505300802069254],"scale":1.0461733956275945},{"type":"grass","position":[42.301062197503775,0,-116.72668665221947],"scale":1.2611680426085916},{"type":"grass","position":[-73.62652962905295,0,-72.42986468394986],"scale":1.1557817821290572},{"type":"grass","position":[-58.922356444278805,0,-28.516636568915292],"scale":0.9068073576458333},{"type":"grass","position":[-73.22852992138354,0,44.992703333799334],"scale":1.2410692776512624},{"type":"grass","position":[-11.504370341742705,0,-36.751275045448814],"scale":0.7689053263751557},{"type":"grass","position":[-59.837151421204695,0,65.24867630109514],"scale":0.7817088951685782},{"type":"grass","position":[118.2733188402237,0,-80.62550025827696],"scale":0.7430079456036945},{"type":"grass","position":[32.34181348227796,0,124.05570716763553],"scale":1.1878695754926916},{"type":"grass","position":[-148.9337672267087,0,-0.5493359433688967],"scale":1.205030689774254},{"type":"grass","position":[-12.199783341919922,0,67.73668583604436],"scale":0.7613105331124762},{"type":"grass","position":[-39.51215970375504,0,15.850480090363423],"scale":1.2365340114698415},{"type":"grass","position":[-14.396772993466152,0,-4.50549386549889],"scale":1.0777240546489215},{"type":"grass","position":[16.290190976462505,0,-21.668257542341387],"scale":0.7332252810160901},{"type":"grass","position":[81.928067483405,0,49.61520508861536],"scale":0.8260479609954484},{"type":"grass","position":[-103.68042377073922,0,39.869682072977156],"scale":1.1194151243278427},{"type":"grass","position":[87.76146397416768,0,-22.836252543410303],"scale":1.2185546294757044},{"type":"grass","position":[-0.835144478228195,0,-100.88275394828051],"scale":1.2144151575601851},{"type":"grass","position":[0.920697292962401,0,-53.824804331981014],"scale":1.2191615687155701},{"type":"grass","position":[87.63882845381076,0,116.12266844182545],"scale":1.1599322677479926},{"type":"grass","position":[-60.56158080499396,0,6.604291235555543],"scale":0.8044660466190641},{"type":"grass","position":[-2.399953522113618,0,48.88699549340936],"scale":1.2689200808736576},{"type":"grass","position":[-66.16304094458556,0,13.5007932258028],"scale":1.1823519058371967},{"type":"grass","position":[1.4373191411440376,0,78.1936933095447],"scale":0.7312548101635882},{"type":"grass","position":[-62.466978267092514,0,-114.77742611388884],"scale":1.2400778373996852},{"type":"grass","position":[123.94469415284378,0,-12.175389151163259],"scale":1.0710890824468982},{"type":"grass","position":[34.284281366490546,0,-31.745196317164606],"scale":1.0001158426156047},{"type":"grass","position":[-114.38338962094656,0,38.46466207886541],"scale":0.9182317939762592},{"type":"grass","position":[-63.067859171074055,0,97.50692975942427],"scale":1.2413521115159434},{"type":"grass","position":[2.481651408933348,0,25.63417520566617],"scale":1.0873219184270686},{"type":"grass","position":[-29.83628515223113,0,90.79709514225341],"scale":1.0383908096203167},{"type":"grass","position":[-53.354056763164664,0,-113.72353883995153],"scale":0.9045038940877644},{"type":"grass","position":[-4.47130213852506,0,-4.895281411782883],"scale":1.0595478522665704},{"type":"grass","position":[86.86714149511168,0,-51.919273642221526],"scale":1.2505779886910335},{"type":"grass","position":[75.03157151250193,0,-27.829003871477752],"scale":1.2472507255490448},{"type":"grass","position":[-76.94279968339357,0,-109.81301882958371],"scale":1.023059117550823},{"type":"grass","position":[-5.698316763290738,0,-0.08759302608396144],"scale":0.9526781075330142},{"type":"grass","position":[110.41512516321369,0,-86.38575322899797],"scale":0.9753740856546219},{"type":"grass","position":[6.838338052439023,0,19.85057039415733],"scale":0.7664004051665412},{"type":"grass","position":[53.972555859004245,0,-107.54146654543325],"scale":1.049032673412602},{"type":"grass","position":[75.84864118440134,0,-117.93343736136707],"scale":1.031844967511475},{"type":"grass","position":[-13.77994217237672,0,11.263334444489555],"scale":1.1964216926599913},{"type":"grass","position":[136.69273051091182,0,-38.37249628057358],"scale":0.7695192000094173},{"type":"grass","position":[120.5145076084034,0,73.77423422342058],"scale":1.118008165667967},{"type":"grass","position":[-131.67677979282973,0,53.48883811098744],"scale":1.105599092010899},{"type":"grass","position":[7.625316525737636,0,3.023670075577595],"scale":1.1881954934169856},{"type":"grass","position":[79.45344196484065,0,-25.481366029672348],"scale":0.719558825509329},{"type":"grass","position":[64.45147311139874,0,22.472938665659232],"scale":1.069998209628014},{"type":"grass","position":[28.660837588349455,0,-12.022432148211681],"scale":0.8322610654475711},{"type":"grass","position":[1.4575011131909787,0,-10.58135659098792],"scale":0.8878924466688749},{"type":"grass","position":[103.7161162539918,0,-64.21938702446151],"scale":0.7477671862655833},{"type":"grass","position":[21.484442987325398,0,-141.67343733351905],"scale":0.9702938128921639},{"type":"grass","position":[51.9083196103943,0,-15.199935275065291],"scale":0.9652231377206015},{"type":"grass","position":[-5.747807544833315,0,0.12024445846880678],"scale":0.8030857153927828},{"type":"grass","position":[78.5354737276434,0,12.861180735609489],"scale":1.0700726587931844},{"type":"grass","position":[19.484470134472097,0,11.172852925751469],"scale":0.9311022684495662},{"type":"grass","position":[-14.269038266986136,0,9.874654801742137],"scale":0.7295831861986507},{"type":"grass","position":[9.170881348469246,0,9.075697604176902],"scale":1.0383587560357428},{"type":"grass","position":[1.30683444131439,0,15.850575761249207],"scale":0.8997172782753142},{"type":"grass","position":[-11.481089954150066,0,13.62963380001206],"scale":1.2549727278944545},{"type":"grass","position":[-0.4569385867921809,0,0.3045189770106057],"scale":0.9467260515249677},{"type":"grass","position":[26.362199625071806,0,-81.12171778036611],"scale":0.9679823814982523},{"type":"grass","position":[32.47656755324425,0,-58.97820769431392],"scale":1.2038362424291915},{"type":"grass","position":[6.7818269534545355,0,-7.354815017139881],"scale":0.7010241954183087},{"type":"grass","position":[-111.3569965164411,0,-27.370137526539782],"scale":1.2433450340346544},{"type":"grass","position":[18.93804236981958,0,-11.470461880568928],"scale":0.7930540698107166},{"type":"grass","position":[-28.077759933293976,0,-51.88112913912836],"scale":0.7608306713576352},{"type":"grass","position":[-51.536077372846336,0,78.58324037724839],"scale":0.8827284618752258},{"type":"grass","position":[23.48453673662801,0,132.3195465630487],"scale":1.0030983468250674},{"type":"grass","position":[-16.632587743199426,0,76.42301753256272],"scale":1.1317809288021743},{"type":"grass","position":[-32.43042075535382,0,-45.1278349829471],"scale":0.8969448958353841},{"type":"grass","position":[105.18899908657114,0,-27.422266643164583],"scale":0.7318059673927293},{"type":"grass","position":[-4.954972929169624,0,-20.10296637588902],"scale":0.9130168441443919},{"type":"grass","position":[20.30397266511035,0,17.161584564163476],"scale":1.1331991504609347},{"type":"grass","position":[79.15234800992772,0,39.417374911885],"scale":1.2720017110773543},{"type":"grass","position":[-71.54109780769535,0,-3.2739476709982327],"scale":0.9565525534449706},{"type":"grass","position":[67.62207773477373,0,-16.115883595672656],"scale":0.7550257125853419},{"type":"grass","position":[59.11578017865117,0,18.129190480775435],"scale":1.2166070467286845},{"type":"grass","position":[-0.39679105382305424,0,-2.932861257268016],"scale":0.8343920966360603},{"type":"grass","position":[5.290357225125866,0,16.434149011406536],"scale":1.1136018583689942},{"type":"grass","position":[11.026972893351042,0,3.0638323273023307],"scale":1.1058480363044239},{"type":"grass","position":[-59.75898598086426,0,28.541110861691994],"scale":0.9664054888933151},{"type":"grass","position":[96.5864989323541,0,-84.96777779272664],"scale":1.2338175637088793},{"type":"grass","position":[-45.53803017276687,0,2.05115443636148],"scale":0.9937865198094171},{"type":"grass","position":[91.73777656463042,0,-19.5268153665625],"scale":0.9248696258194461},{"type":"grass","position":[-0.6983483699005368,0,30.004634829803255],"scale":1.0753716982174784},{"type":"grass","position":[-12.385301068376304,0,-80.1297553222501],"scale":1.0588453272612892},{"type":"grass","position":[19.168513361824097,0,-122.52509447446585],"scale":1.1668423999437325},{"type":"grass","position":[-23.52256468062644,0,-38.596277304631315],"scale":1.169167576899831},{"type":"grass","position":[113.50276625653693,0,58.71164693674353],"scale":1.2947281508768271},{"type":"grass","position":[-22.831415665395966,0,-45.83171115755013],"scale":0.8604793178294765},{"type":"grass","position":[5.262880499107359,0,-130.64027068611347],"scale":0.8907574628252046},{"type":"grass","position":[18.59443556513549,0,-7.648201312280767],"scale":0.7805289522145901},{"type":"grass","position":[37.41439209051695,0,-24.693251347033716],"scale":1.0842017759657383},{"type":"grass","position":[63.72188192034691,0,3.3200611673174425],"scale":0.9063845740429899},{"type":"grass","position":[104.59202615734817,0,69.97447816719531],"scale":1.1038360291553748},{"type":"grass","position":[-77.77361978481107,0,-27.728603266797563],"scale":1.1019738164532338},{"type":"grass","position":[-52.004770854860155,0,21.680662118532595],"scale":1.018828855822401},{"type":"grass","position":[-69.49802911304612,0,83.77276063751806],"scale":1.2829662135308304},{"type":"grass","position":[-3.6533630307165073,0,2.0664206630376922],"scale":0.852519569758242},{"type":"grass","position":[14.165605536216669,0,-63.034924224358534],"scale":1.0558344314385524},{"type":"grass","position":[-38.79203239547953,0,-13.312735984042881],"scale":1.0600789267384096},{"type":"grass","position":[-56.12463508440544,0,-34.926832909631145],"scale":1.1041879943357498},{"type":"grass","position":[-124.86614041502062,0,-57.50885015086305],"scale":1.2672627318014387},{"type":"grass","position":[146.58750189689036,0,-11.069696026402585],"scale":1.186247906988566},{"type":"grass","position":[-12.541895592909906,0,41.957109817730384],"scale":0.9830289240575325},{"type":"grass","position":[-47.84192546919307,0,-132.44910835594231],"scale":0.7802058684193587},{"type":"grass","position":[-40.938062427355966,0,-113.89821398590648],"scale":1.2158653751890218},{"type":"grass","position":[76.49190477787315,0,26.32219167188611],"scale":0.9690570093862751},{"type":"grass","position":[-117.10489611773754,0,0.229345798403337],"scale":0.9511049288692296},{"type":"grass","position":[41.659970945294326,0,-28.083276169057832],"scale":0.9818017115376244},{"type":"grass","position":[40.66142046756411,0,-111.90424861483403],"scale":0.9373623179758123},{"type":"grass","position":[-76.35163741904888,0,-102.75337584587189],"scale":0.8592201204533307},{"type":"grass","position":[10.950011356260092,0,-143.89333495450808],"scale":0.7385664700079527},{"type":"grass","position":[64.35902778772311,0,-101.34850113021048],"scale":0.8393448331298394},{"type":"grass","position":[53.661198105979835,0,70.33585436145579],"scale":0.8988821766002689},{"type":"grass","position":[-77.76289854982052,0,52.676387044331335],"scale":0.9779320486278793},{"type":"grass","position":[-7.036204572476808,0,5.222228355757286],"scale":0.8280888676897231},{"type":"grass","position":[-105.07672587239502,0,-36.67568392513753],"scale":1.1892522262099263},{"type":"grass","position":[35.43867065662219,0,-19.190600058166233],"scale":0.9226455272992004},{"type":"grass","position":[25.10412720011864,0,19.120842975451076],"scale":1.2713053988164278},{"type":"grass","position":[-6.204421820794543,0,123.10126123892175],"scale":0.724312070129171},{"type":"grass","position":[92.47940769239054,0,29.9683854391095],"scale":1.136251004024796},{"type":"grass","position":[2.5007828785252757,0,-16.328419186019566],"scale":0.9052444162471596},{"type":"grass","position":[75.63866822648505,0,121.647754514765],"scale":0.7172862924424437},{"type":"grass","position":[16.54113837018155,0,7.9939838862437265],"scale":0.9849434135476087},{"type":"grass","position":[-88.34493079571966,0,108.27285853354456],"scale":0.9301856911857977},{"type":"grass","position":[20.510014055221493,0,50.79211063320649],"scale":0.829420860102047},{"type":"grass","position":[70.88472531321786,0,-83.02658856882609],"scale":1.2666471309376122},{"type":"grass","position":[20.32981385388582,0,-16.089982848204276],"scale":0.8702807082185108},{"type":"grass","position":[101.45580622469534,0,103.40407958308786],"scale":0.9133277727456732},{"type":"grass","position":[38.89940785490423,0,15.089445303844663],"scale":0.9419750598870141},{"type":"grass","position":[32.641217902928105,0,114.15704429890789],"scale":0.9467835354289645},{"type":"grass","position":[-70.00997119462754,0,25.30152621791395],"scale":0.9004492053045579},{"type":"grass","position":[-20.956839109664912,0,25.412104425228968],"scale":0.9042532225973926},{"type":"grass","position":[143.060193734337,0,-14.258741216994272],"scale":0.7233531306479062},{"type":"grass","position":[32.89293826500134,0,55.929147887010494],"scale":1.1300386770673398},{"type":"grass","position":[-46.59208014357408,0,13.42697905502325],"scale":1.2834300936077727},{"type":"grass","position":[-123.97154396117115,0,-83.92223924000322],"scale":1.295433311939834},{"type":"grass","position":[61.140747219869496,0,-68.01091332400028],"scale":1.173914245616415},{"type":"grass","position":[66.33307582718088,0,4.7844524763999745],"scale":0.8013172117184406},{"type":"grass","position":[6.30448667561496,0,-60.040295063411676],"scale":1.1422446883237747},{"type":"grass","position":[69.1225235269577,0,-26.06424127144606],"scale":1.1800185614128647},{"type":"grass","position":[37.589348590934875,0,-7.7250711784727395],"scale":0.8673659133110305},{"type":"grass","position":[32.004193542529315,0,-29.438034007637306],"scale":1.1507181963275166},{"type":"grass","position":[-78.00150846889717,0,50.151528126231646],"scale":0.738985633881622},{"type":"grass","position":[-94.74949041556773,0,-56.377883268548416],"scale":0.752956619483847},{"type":"grass","position":[-13.144183739611849,0,-41.790172276669786],"scale":1.2712638692507663},{"type":"grass","position":[36.33937404980678,0,54.38740537750381],"scale":0.984480029143825},{"type":"grass","position":[-31.78054926963821,0,-27.63157627349754],"scale":0.8095152996616258},{"type":"grass","position":[32.30252348813282,0,-139.27685839916504],"scale":0.849847223572878},{"type":"grass","position":[64.46046104728723,0,-36.48015956688232],"scale":0.9836511124094377},{"type":"grass","position":[-50.634058634695144,0,83.06391501854488],"scale":1.1517063184422434},{"type":"grass","position":[-51.434589502770564,0,-33.310442432855496],"scale":0.7589400110966964},{"type":"grass","position":[-30.59057502393327,0,7.145046035646843],"scale":1.036299537421915},{"type":"grass","position":[41.69954160513347,0,-75.51694030377702],"scale":1.2800776325128518},{"type":"grass","position":[3.1696707870616234,0,-82.8725879826342],"scale":0.8608291594947381},{"type":"grass","position":[-89.65087087428103,0,-51.447133673095884],"scale":0.7408381786549381},{"type":"grass","position":[-4.50438631334001,0,-19.715441395697418],"scale":1.1505448577960624},{"type":"grass","position":[-15.379297929663531,0,14.750509202486498],"scale":0.8774309635247356},{"type":"grass","position":[-35.431582601234815,0,-75.25374665258637],"scale":0.7430375077141953},{"type":"grass","position":[0.9223101566014031,0,59.11508425764875],"scale":1.0473722436839772},{"type":"grass","position":[7.103582856637497,0,-99.8177738898059],"scale":1.0276112238493627},{"type":"grass","position":[-43.37509394500224,0,72.76721789944033],"scale":0.7939149445374916},{"type":"grass","position":[38.55447950698781,0,22.786871465485348],"scale":1.0570506889273272},{"type":"grass","position":[-2.0193091205797247,0,-47.75519676028789],"scale":1.2842858656516298},{"type":"grass","position":[-67.99406492157446,0,10.22954074959804],"scale":0.7938710316911347},{"type":"grass","position":[28.4375063881264,0,-22.752403900772226],"scale":0.7054371517066965},{"type":"grass","position":[-64.53084606984956,0,3.7254713739963967],"scale":0.9466790625379179},{"type":"grass","position":[-23.392792848830382,0,129.6524966539101],"scale":1.2704511042524467},{"type":"grass","position":[123.69317862063187,0,-47.959382620172335],"scale":1.2352527496599977},{"type":"grass","position":[41.26531891088694,0,-108.69475125214782],"scale":1.2966340935669547},{"type":"grass","position":[28.206442234929508,0,-27.355545501700828],"scale":1.1567658507202763},{"type":"grass","position":[-18.640187895248573,0,61.984398160235976],"scale":1.1776804927210898},{"type":"grass","position":[-132.19688114164927,0,37.877833569176204],"scale":0.888034052723904},{"type":"grass","position":[-75.58123448486376,0,53.70929595814095],"scale":1.2297945093077032},{"type":"grass","position":[-39.04464743326113,0,-65.33957317487535],"scale":1.2544087384886302},{"type":"grass","position":[-118.84379080177595,0,20.829886617044238],"scale":0.9707277704571339},{"type":"grass","position":[-8.455245222766896,0,9.727982623710735],"scale":0.8870289989583138},{"type":"grass","position":[66.9246688007056,0,64.45574504914107],"scale":1.0428211517484542},{"type":"grass","position":[0.6546231322232885,0,-105.42082742127215],"scale":0.774025370104928},{"type":"grass","position":[23.141892430242105,0,36.46130324207002],"scale":1.118316911232169},{"type":"grass","position":[7.500190807779323,0,3.7545580724666823],"scale":1.0815550017197957},{"type":"grass","position":[61.98096387562852,0,80.48944347223765],"scale":1.0984315351413976},{"type":"grass","position":[3.201292639009372,0,-0.07088048471343901],"scale":1.0902254275929215},{"type":"grass","position":[87.25639757714727,0,71.9589196287131],"scale":0.8837765426505425},{"type":"grass","position":[6.900058006750433,0,-16.446891282180264],"scale":0.7560300232102265},{"type":"grass","position":[76.96709504332205,0,106.55769946034074],"scale":1.1622739238451103},{"type":"grass","position":[52.52195326670505,0,-106.36731010959149],"scale":1.2524491107671096},{"type":"grass","position":[-117.11419656859908,0,26.01851228053483],"scale":0.7927526346228267},{"type":"grass","position":[-3.246358928603141,0,-5.9162050101297],"scale":1.1317225090492675},{"type":"grass","position":[32.231182743869915,0,85.3814467758336],"scale":1.1828781781061735},{"type":"grass","position":[-133.67532743466552,0,42.234864217524574],"scale":1.21110183615682},{"type":"grass","position":[-51.28228144809696,0,12.604995646435304],"scale":1.0061249987776755},{"type":"grass","position":[-28.10720402257156,0,-43.075554659548345],"scale":0.7980017350515386},{"type":"grass","position":[-121.39202947250033,0,-12.516793555608345],"scale":0.9656483704670082},{"type":"grass","position":[39.037199286604725,0,-53.29767407459855],"scale":0.7360589062948537},{"type":"grass","position":[-69.3412169408797,0,-32.03169658699564],"scale":1.1953158642210924},{"type":"grass","position":[21.421813263915887,0,-28.21999865488517],"scale":1.2247376332347328},{"type":"grass","position":[-80.53031762944978,0,126.51472086858611],"scale":1.1385325137794224},{"type":"grass","position":[-47.60157822247681,0,-21.73775735372446],"scale":0.8569764181579047},{"type":"grass","position":[-45.78877559156961,0,13.634246543931154],"scale":0.9449989344549505},{"type":"grass","position":[-34.019705281683045,0,125.12579933970304],"scale":0.7115833733407138},{"type":"grass","position":[39.50561287073347,0,81.81570652766703],"scale":1.0368558862436108},{"type":"grass","position":[19.237648262502024,0,-26.465162295131435],"scale":0.9907874780345785},{"type":"grass","position":[40.054913665969835,0,62.83514888331365],"scale":1.1116625279202033},{"type":"grass","position":[-87.99536885033892,0,-87.77540235249609],"scale":1.1035454483931937},{"type":"grass","position":[-10.391674158080322,0,49.41763536639325],"scale":0.7087320476489337},{"type":"grass","position":[51.47088090946645,0,-45.583309995613],"scale":0.8891164547087127},{"type":"grass","position":[7.1443356727414775,0,1.39765503353658],"scale":1.055125140762192},{"type":"grass","position":[-18.15520240457741,0,-66.03125806280259],"scale":0.9683745714203633},{"type":"grass","position":[94.91393137672517,0,17.218303982514733],"scale":0.7751602530453905},{"type":"grass","position":[9.631127418855836,0,139.75317355928829],"scale":1.1641465653379446},{"type":"grass","position":[-57.9917042456565,0,56.90027210467145],"scale":0.7858630646865626},{"type":"grass","position":[-6.63311582802154,0,-10.300419590340184],"scale":1.222985539383086},{"type":"grass","position":[44.021866312151666,0,-97.73184422526617],"scale":0.7733629798380424},{"type":"grass","position":[14.19034123425091,0,-11.331855602425119],"scale":0.8724353699813224},{"type":"grass","position":[-81.34882797601217,0,-60.800782701833086],"scale":0.7170445009697258},{"type":"grass","position":[19.216190884081907,0,-0.859560126818038],"scale":0.9585770137827734},{"type":"grass","position":[116.04004476301938,0,4.965677659160453],"scale":1.25988505637158},{"type":"grass","position":[1.8577052659285889,0,-135.11877599725673],"scale":0.7565335654286373},{"type":"grass","position":[-54.50984843136861,0,-42.21579978455034],"scale":1.2538563787453767},{"type":"grass","position":[-8.5485643074103,0,19.237515343186335],"scale":0.8736487255478141},{"type":"grass","position":[47.05862758394351,0,84.23683613954513],"scale":1.1550213112397532},{"type":"grass","position":[2.383068648974272,0,-25.84658108420793],"scale":1.0306599040791682},{"type":"grass","position":[41.15914892227489,0,73.65763537421658],"scale":1.190977291574256},{"type":"grass","position":[9.24058670759044,0,-3.6253229423396025],"scale":0.7076741237455553},{"type":"grass","position":[-49.02837036802355,0,94.24870219703334],"scale":1.141012749025522},{"type":"grass","position":[109.79989046372813,0,-61.18055967548877],"scale":1.0127240140595557},{"type":"grass","position":[-15.543247529951378,0,2.7975131905518857],"scale":1.2619395829499718},{"type":"grass","position":[-24.020887655423685,0,-42.644452114212115],"scale":1.030283959186801},{"type":"grass","position":[-6.962035154160261,0,-15.10807487811431],"scale":1.2224840577126197},{"type":"grass","position":[-78.5294041356567,0,-38.48329705297473],"scale":0.9084531948055514},{"type":"grass","position":[-72.70305700974195,0,10.860199163120267],"scale":1.035334821390877},{"type":"grass","position":[-10.169030256875796,0,-15.167568175550159],"scale":1.2615987205573553},{"type":"grass","position":[44.06145982991894,0,-72.67843475368191],"scale":1.255468377224061},{"type":"grass","position":[-75.14161465338019,0,46.07604382485425],"scale":0.9750596028943754},{"type":"grass","position":[5.244441194571026,0,-85.69363219365621],"scale":0.9340872198038539},{"type":"grass","position":[46.93915357812697,0,40.70476419560062],"scale":0.7402972030283326},{"type":"grass","position":[9.065822270800004,0,38.04734327224157],"scale":0.8658829794260217},{"type":"grass","position":[16.679199264936166,0,108.79063625147404],"scale":1.0591232318163173},{"type":"grass","position":[-1.9377243900165948,0,-0.0013092543311352606],"scale":0.8832861535195549},{"type":"grass","position":[-35.608570102149976,0,-28.370399697056424],"scale":0.8834247147672728},{"type":"grass","position":[123.61063518260976,0,8.410348110354741],"scale":1.2540166053718185},{"type":"grass","position":[-6.567585494982088,0,-59.0753454231756],"scale":0.9921397569021491},{"type":"grass","position":[40.25079082847503,0,-69.39973222991647],"scale":0.7996588307198867},{"type":"grass","position":[97.38161569672391,0,-42.340450169539835],"scale":1.0999821007716055},{"type":"grass","position":[-61.60479272209487,0,105.60323524419029],"scale":0.9488664819023981},{"type":"grass","position":[-114.41955953282041,0,-59.34429029655566],"scale":0.9899553592704984},{"type":"grass","position":[-18.74495693802513,0,-12.391481364551874],"scale":0.8551557005230284},{"type":"grass","position":[-84.55579811293642,0,58.02071729433486],"scale":1.2682949582304546},{"type":"grass","position":[78.68604319640659,0,41.65616575794203],"scale":1.090000219229834},{"type":"grass","position":[-98.66950720539705,0,60.329144303863906],"scale":0.7240832109972088},{"type":"grass","position":[-57.193611951471404,0,-124.92684281529809],"scale":1.09005388320666},{"type":"grass","position":[-2.05054902386417,0,-58.08672118734426],"scale":0.7723504301534633},{"type":"grass","position":[78.16639901479643,0,40.220989669878215],"scale":1.1153635270781308},{"type":"grass","position":[76.34666055961397,0,-32.38173370306848],"scale":1.0171377237794879},{"type":"grass","position":[-31.280388328743463,0,-35.262785787714954],"scale":0.7394910336926739},{"type":"grass","position":[-55.15257562065207,0,-28.672503685869625],"scale":1.0179661082076303},{"type":"grass","position":[0.7859373499872728,0,21.12027384058715],"scale":0.9770213912931247},{"type":"grass","position":[25.509819823916835,0,86.77903841671923],"scale":0.7429360575124265},{"type":"grass","position":[25.446500490709475,0,-93.58108822815605],"scale":1.0755952733250156},{"type":"grass","position":[15.047180713235191,0,120.84503806710103],"scale":0.9353186719467821},{"type":"grass","position":[70.8540863953091,0,75.87290691034309],"scale":1.2416335534348866},{"type":"grass","position":[39.08933083736304,0,-21.88209646720032],"scale":1.1851615801934656},{"type":"grass","position":[-69.04885299294128,0,3.0659775925423056],"scale":1.1251855939959416},{"type":"grass","position":[128.69613289994427,0,-72.80536145529385],"scale":1.059367639435608},{"type":"grass","position":[82.38592307239746,0,-6.985622517083026],"scale":1.2520227275316744},{"type":"grass","position":[-96.60074848626188,0,29.35920271436708],"scale":0.7132321129735406},{"type":"grass","position":[1.0682689451097833,0,23.905411827954108],"scale":0.8331632206654653},{"type":"grass","position":[107.17696236329449,0,75.6985125174121],"scale":0.7399606885217291},{"type":"grass","position":[-0.8136629620758656,0,0.48594425934946384],"scale":1.2179941609754619},{"type":"grass","position":[7.751264854786195,0,92.8084522942433],"scale":1.270018995040979},{"type":"grass","position":[53.94983778771765,0,-24.3737975914273],"scale":0.7010408008439927},{"type":"grass","position":[48.02971050977042,0,-15.216330341587646],"scale":0.8997149673380115},{"type":"grass","position":[-58.83181051526941,0,16.1086751248707],"scale":0.8806325836155806},{"type":"grass","position":[58.10808408411642,0,-58.83282668766686],"scale":0.7990894466701496},{"type":"grass","position":[-31.33975987455217,0,-37.110791553125324],"scale":1.1016985584472412},{"type":"grass","position":[88.10907348715945,0,109.86790947918959],"scale":1.2003985219042543},{"type":"grass","position":[-137.3925689383962,0,-58.146549692248804],"scale":0.9611011645619568},{"type":"grass","position":[5.63380801178166,0,-1.4797451175992966],"scale":1.1722941301071843},{"type":"grass","position":[-20.74415322352426,0,14.890818884925977],"scale":0.9699231077594577},{"type":"grass","position":[-0.3974360964296764,0,0.6240225755132072],"scale":0.815573137898271},{"type":"grass","position":[65.4405777065554,0,-17.075873910547852],"scale":0.8060134828657446},{"type":"grass","position":[9.18071905815321,0,-12.005964915512934],"scale":0.8081141831048523},{"type":"grass","position":[15.725220993240567,0,-5.996431451388505],"scale":0.8556111454825036},{"type":"grass","position":[-41.56943222280673,0,-3.7109496799386337],"scale":0.954410206529489},{"type":"grass","position":[31.094397800310478,0,-41.740914802133354],"scale":1.23386278513996},{"type":"grass","position":[-2.409904091519797,0,1.160278349208722],"scale":1.0930867621303029},{"type":"grass","position":[-8.700183476376347,0,-81.9483755435166],"scale":1.0057992901949866},{"type":"grass","position":[-67.0076425673603,0,70.41768713081646],"scale":1.1694835804049604},{"type":"grass","position":[15.225323665627183,0,-106.00031551354036],"scale":1.1311861532470686},{"type":"grass","position":[17.638902070180546,0,-44.71829988475759],"scale":1.0654467517966113},{"type":"grass","position":[-101.87101017682477,0,95.46816366996579],"scale":1.0765943613481297},{"type":"grass","position":[69.5910162221618,0,-60.80377352641729],"scale":0.838715017534609},{"type":"grass","position":[-122.81143997806416,0,-6.229512171378202],"scale":0.9651070688328494},{"type":"grass","position":[11.64626850734128,0,14.006209578426216],"scale":1.018222174899527},{"type":"grass","position":[-140.97116120655667,0,-42.151728436484625],"scale":1.2973897022707452},{"type":"grass","position":[50.14833215488168,0,104.81548718331634],"scale":1.1189558732006173},{"type":"grass","position":[34.87303836085293,0,66.0512204473446],"scale":0.8320570558960844},{"type":"grass","position":[1.3607585916123184,0,2.1446584938064635],"scale":0.86431223532516},{"type":"grass","position":[-29.09016502362949,0,-63.40424182149813],"scale":0.7890792161607723},{"type":"grass","position":[91.0686445182689,0,-43.49631811528232],"scale":1.1100652283769978},{"type":"grass","position":[17.176365125460634,0,15.227821243015102],"scale":1.093144848596153},{"type":"grass","position":[-0.4069786334171775,0,-0.02780790070135066],"scale":0.8081329669488915},{"type":"grass","position":[-6.580364830054109,0,8.00962157860822],"scale":1.2929336028227523},{"type":"grass","position":[6.7452817078716345,0,9.07198978084179],"scale":1.1298711916735336},{"type":"grass","position":[-42.50807532540872,0,13.789802086653543],"scale":0.9145599484050875},{"type":"grass","position":[18.497164902962684,0,143.20555121800822],"scale":0.8948388722329297},{"type":"grass","position":[90.38661414085433,0,-80.30771817287435],"scale":0.8570889276906387},{"type":"grass","position":[-7.839455860241051,0,-2.723279166448779],"scale":1.0020298337482738},{"type":"grass","position":[-56.39993515089125,0,-17.36517186608823],"scale":1.0706784575325752},{"type":"grass","position":[25.091604655910764,0,48.46121330604249],"scale":1.1325425845766857},{"type":"grass","position":[105.97837535007011,0,-34.169847557844385],"scale":0.7237965024699873},{"type":"grass","position":[-6.282473338296569,0,119.28192570323553],"scale":0.8933680912084185},{"type":"grass","position":[-24.098428517409445,0,38.034027264537166],"scale":0.9729586999982318},{"type":"grass","position":[-18.24184583814216,0,90.93312037797003],"scale":0.8589563739287117},{"type":"grass","position":[6.003310719046306,0,10.82067496228003],"scale":1.065276808012681},{"type":"grass","position":[30.273250898926193,0,-46.7613305583494],"scale":0.810154861960219},{"type":"grass","position":[65.0734850218665,0,-44.35938100918231],"scale":0.9808974886351444},{"type":"grass","position":[-57.776629133209774,0,-59.1013069543339],"scale":1.0565289361650656},{"type":"grass","position":[-54.77546443461765,0,-85.1235586750897],"scale":0.9803256311268111},{"type":"grass","position":[71.14419996679841,0,-111.02386846437231],"scale":0.940199070770418},{"type":"grass","position":[-16.21732597353987,0,-5.117037153449362],"scale":1.1865427616987647},{"type":"grass","position":[51.37380243339804,0,38.46433985327654],"scale":1.0642163782135612},{"type":"grass","position":[-27.840871822751016,0,55.316439114196704],"scale":0.8840909077750299},{"type":"grass","position":[51.35075618284242,0,4.617769051579994],"scale":1.1879038588760427},{"type":"grass","position":[23.160642049735603,0,127.08909252253828],"scale":0.8387048869326431},{"type":"grass","position":[-17.064837623747593,0,30.44580309270339],"scale":1.0382376088939835},{"type":"grass","position":[1.198575725814814,0,-34.01489025590651],"scale":1.112788409982267},{"type":"grass","position":[86.36660157891608,0,100.95312975192317],"scale":0.9948075690257008},{"type":"grass","position":[-14.519939761071528,0,99.76357618715141],"scale":0.7029864227914857},{"type":"grass","position":[6.028335928733958,0,-0.6535365855975973],"scale":0.9617871390824853},{"type":"grass","position":[-90.33560980777797,0,75.09524797353748],"scale":1.016758875481067},{"type":"grass","position":[-8.475538024289252,0,-3.062146821488324],"scale":1.1537896591354264},{"type":"grass","position":[-93.59150804158162,0,-70.40883659893022],"scale":0.7435715257634453},{"type":"grass","position":[-30.947510203756305,0,90.54355889537919],"scale":0.7495102337433456},{"type":"grass","position":[-48.54245173601844,0,-26.31639765198794],"scale":1.1099439106683329},{"type":"grass","position":[-91.07222366375264,0,84.16710113545197],"scale":0.7882000417411346},{"type":"grass","position":[-91.82411505269648,0,-45.56341381935469],"scale":1.2348747221987653},{"type":"grass","position":[-14.022366410419057,0,-38.16399361125054],"scale":1.2481825042503487},{"type":"grass","position":[94.05827526803847,0,-86.63459386284458],"scale":1.0429621975056755},{"type":"grass","position":[-70.65975708919609,0,16.795002164755005],"scale":0.7221983962212161},{"type":"grass","position":[58.034789497687655,0,-89.4645340203976],"scale":0.7038209300502147},{"type":"grass","position":[-11.847303401683906,0,-8.872809392679839],"scale":1.2929216985957144},{"type":"grass","position":[-54.640859151424515,0,1.6994368666803321],"scale":0.9453359002626344},{"type":"grass","position":[11.653450712290356,0,-0.9982458573298677],"scale":0.7995547639361569},{"type":"grass","position":[122.38420824419325,0,64.84477052713045],"scale":1.1504350949212137},{"type":"grass","position":[35.394931914592576,0,119.10362711289204],"scale":1.090824598942139},{"type":"grass","position":[48.53619947599116,0,-26.303113294720145],"scale":1.0835589632858154},{"type":"grass","position":[25.70846380564226,0,65.54683038873972],"scale":1.2513180208658938},{"type":"grass","position":[-14.586960874456757,0,68.90524181113592],"scale":1.113333586233861},{"type":"grass","position":[14.90844709024849,0,-143.5748313918324],"scale":1.0857600117102049},{"type":"grass","position":[18.711089663898804,0,-82.15018458947519],"scale":0.8747349216270467},{"type":"grass","position":[7.901414666863748,0,35.82349475733974],"scale":1.0574404622400495},{"type":"grass","position":[4.514410932485721,0,-24.9857461611066],"scale":1.2895803620482713},{"type":"grass","position":[6.701761212062467,0,0.2604887528533361],"scale":1.135821349001639},{"type":"grass","position":[67.75188972715647,0,-29.536916979721475],"scale":0.90057982183026},{"type":"grass","position":[124.45346778925946,0,-41.278136724747995],"scale":1.0420269303707363},{"type":"grass","position":[36.48220011076591,0,-50.752963698576686],"scale":1.1835721822903627},{"type":"grass","position":[9.99592071093126,0,-67.07059395503266],"scale":1.0277121652792442},{"type":"grass","position":[42.23324759522411,0,-113.13053082238186],"scale":0.8437002973646691},{"type":"grass","position":[-35.42484676274921,0,14.144604308834316],"scale":1.0879626598806504},{"type":"grass","position":[5.05356378129044,0,-22.283451731152066],"scale":0.8536369035103399},{"type":"grass","position":[-64.1510129070739,0,-15.751959415801055],"scale":1.2642919964354713},{"type":"grass","position":[-15.668350031030702,0,0.9701783366295335],"scale":0.857818013807111},{"type":"grass","position":[16.405825559033204,0,36.800451129846444],"scale":0.9889746568655684},{"type":"grass","position":[-0.5045338384480276,0,-9.727931962743734],"scale":0.9274710242021023},{"type":"grass","position":[3.604756467925082,0,11.680600805821824],"scale":1.1275626945494934},{"type":"grass","position":[85.87945374846427,0,-61.606355309921476],"scale":0.9616642994575726},{"type":"grass","position":[-39.16926261079487,0,11.792399077405161],"scale":1.1233002096201568},{"type":"grass","position":[98.8475338463596,0,107.39715355572292],"scale":1.1625502472424953},{"type":"grass","position":[-0.7728045132778932,0,-1.5101871442179944],"scale":0.720024598268681},{"type":"grass","position":[-18.516090649121686,0,79.04997412517632],"scale":0.868719301454087},{"type":"grass","position":[-37.61278510199167,0,17.22399043372635],"scale":0.8846437111001378},{"type":"grass","position":[-22.157529742444694,0,36.583845364216536],"scale":1.247398321669839},{"type":"grass","position":[61.54014683000239,0,-134.35219211253855],"scale":1.1577612531157695},{"type":"grass","position":[134.34384350544346,0,24.803803484679964],"scale":0.9581626315404657},{"type":"grass","position":[-47.99216780140546,0,-123.15308688122475],"scale":1.1363180547211438},{"type":"grass","position":[25.00624084130385,0,-16.640132165372044],"scale":0.8747245892294828},{"type":"grass","position":[9.16756991749629,0,-31.521945317225818],"scale":0.9517520212084092},{"type":"grass","position":[-31.304701935249707,0,-79.70957952168084],"scale":1.1928815784223694},{"type":"grass","position":[-44.08500513327364,0,-136.19255143351046],"scale":0.9093503258473058},{"type":"grass","position":[96.66132524396245,0,-8.02394040715591],"scale":1.244241306114279},{"type":"grass","position":[-129.2425903621467,0,-56.99400755841483],"scale":1.1274311160045465},{"type":"grass","position":[52.07297485096703,0,-94.52419448788399],"scale":1.0684105936563368},{"type":"grass","position":[72.83086251531905,0,12.117566153679622],"scale":1.2289781768549877},{"type":"grass","position":[51.922356418553235,0,55.129669699766495],"scale":0.804035277246051},{"type":"grass","position":[-11.018131263689433,0,87.11945720031946],"scale":0.7096655968703277},{"type":"grass","position":[-2.161402986950756,0,42.408563449807275],"scale":1.0743185268808575},{"type":"grass","position":[59.73062340914829,0,-17.064472817932735],"scale":0.9142216154896643},{"type":"grass","position":[140.08123359636465,0,6.833105683927033],"scale":1.0744864627799806},{"type":"grass","position":[127.75534752803293,0,-5.372586069149358],"scale":0.986516476553644},{"type":"grass","position":[5.919120328161377,0,-8.290422871262907],"scale":0.8713002418524016},{"type":"grass","position":[15.068193548770925,0,-82.16377880068352],"scale":1.0593670306146818},{"type":"grass","position":[4.704985030073022,0,-19.7134619491203],"scale":0.8073033995849611},{"type":"grass","position":[99.20870168017892,0,30.879965948358812],"scale":0.7039741626171784},{"type":"grass","position":[-7.763499197561444,0,-11.378550799177187],"scale":1.0284161674367287},{"type":"grass","position":[44.72944368418862,0,-103.22675755752095],"scale":0.8983020592037614},{"type":"grass","position":[-48.43874522969494,0,-79.91213625063214],"scale":0.9568551353631789},{"type":"grass","position":[-18.433752588225033,0,8.467529798104987],"scale":0.7983468624632151},{"type":"grass","position":[-3.340028341488979,0,-96.36955622655383],"scale":1.0069571877145478},{"type":"grass","position":[-27.237648547127858,0,-96.07904236586016],"scale":0.787757484404811},{"type":"grass","position":[71.88341061988957,0,69.66005400562338],"scale":1.0066569369975613},{"type":"grass","position":[-18.004853415504165,0,106.27870156033993],"scale":0.855286878752551},{"type":"grass","position":[-59.534465660912694,0,133.79114004583897],"scale":0.801901348768214},{"type":"grass","position":[-50.341950002657626,0,-6.852716725818871],"scale":0.7425579651549302},{"type":"grass","position":[-61.81516075757984,0,40.24899429768175],"scale":1.1401901009030815},{"type":"grass","position":[70.72606051356729,0,-24.971053993328297],"scale":0.7407562200615958},{"type":"grass","position":[28.242964104081178,0,26.37390021044347],"scale":1.0836701563345514},{"type":"grass","position":[21.673750510081458,0,-29.010505787263448],"scale":1.1792957901762127},{"type":"grass","position":[17.956950078117295,0,-36.21942037562747],"scale":0.7972946438842075},{"type":"grass","position":[8.965438416693356,0,116.77200111877144],"scale":1.1236378352781775},{"type":"grass","position":[-66.61567062946615,0,-50.79255280039209],"scale":1.0275877559472555},{"type":"grass","position":[95.22480251489179,0,-24.329854022893603],"scale":0.9577627921801845},{"type":"grass","position":[82.62381688445247,0,-3.4134696610536173],"scale":1.209208972473446},{"type":"grass","position":[-7.821566824816974,0,5.654055764936398],"scale":0.951588422877423},{"type":"grass","position":[14.598541555223488,0,-68.36901475392132],"scale":0.9471754215967676},{"type":"grass","position":[-69.06797742837927,0,81.01773114086703],"scale":0.7140362729324742},{"type":"grass","position":[-26.384487045458567,0,17.850557766355998],"scale":1.188372118846253},{"type":"grass","position":[-74.8262868764344,0,124.7026526906876],"scale":1.2830309078785387},{"type":"grass","position":[34.88926426084372,0,-48.47914326829756],"scale":0.9164047341098482},{"type":"grass","position":[110.82219788459174,0,-46.23975322137957],"scale":1.0346264936968819},{"type":"grass","position":[-16.172461753227452,0,19.496078489111987],"scale":1.0711857612742512},{"type":"grass","position":[-34.29159258685557,0,79.2739278172165],"scale":1.0031416444713344},{"type":"grass","position":[-43.304379857264955,0,-4.752644170877539],"scale":0.7889336213669732},{"type":"grass","position":[-113.91122465554986,0,24.788379272839446],"scale":0.8728102187678909},{"type":"grass","position":[2.795263063942763,0,-41.176034566548736],"scale":0.7415583874247953},{"type":"grass","position":[-70.67606755096011,0,110.66705692009718],"scale":0.7484009162617795},{"type":"grass","position":[-103.54287071220504,0,-20.096073962101844],"scale":0.9629375565473857},{"type":"grass","position":[-40.356681294397504,0,-121.75118753539707],"scale":1.1342730318226344},{"type":"grass","position":[-147.90898136540972,0,7.5086319364696745],"scale":0.9400972700497975},{"type":"grass","position":[101.78082737658318,0,-26.639749179236006],"scale":1.2824743587420042},{"type":"grass","position":[37.32722883792908,0,4.208575698874107],"scale":0.9492220175431347},{"type":"grass","position":[-140.00231351475705,0,32.84679193859335],"scale":1.1849178563188552},{"type":"grass","position":[45.305619035048124,0,-11.769325619574968],"scale":1.216213505976588},{"type":"grass","position":[14.550006013116585,0,-144.46281744300293],"scale":0.8007006318233988},{"type":"grass","position":[-46.18033536863823,0,-4.609755662908014],"scale":0.9517709433484332},{"type":"grass","position":[77.04788053475282,0,38.05905002548253],"scale":1.1633736317673242},{"type":"grass","position":[-88.72079435556337,0,-75.66112456615554],"scale":0.8717778112756895},{"type":"grass","position":[-50.795690771491635,0,42.85658810372942],"scale":1.257630215768578},{"type":"grass","position":[-8.496396293342041,0,56.68740656498896],"scale":1.2399824062185467},{"type":"grass","position":[-107.22554867831917,0,36.73022943813415],"scale":0.9806308074495759},{"type":"grass","position":[-1.8639412198868817,0,-3.117658167084664],"scale":0.9959941691129471},{"type":"grass","position":[-54.4946821762692,0,-78.2281879919587],"scale":1.0195892145417513},{"type":"grass","position":[43.100641700442,0,-28.94306765842992],"scale":0.7500864853334678},{"type":"grass","position":[-23.939617879559584,0,-134.4372869562551],"scale":0.8460717468869177},{"type":"grass","position":[-111.7037911028788,0,-63.34818920743742],"scale":1.1447750318903789},{"type":"grass","position":[-12.891116071006596,0,-1.790987585770908],"scale":0.7428951921830486},{"type":"grass","position":[88.4207778897569,0,-18.01604110406944],"scale":0.7563717577100642},{"type":"grass","position":[43.43755565816263,0,-89.90780670376229],"scale":0.8395733129624817},{"type":"grass","position":[133.68613885818704,0,15.848926970399038],"scale":0.844530765957351},{"type":"grass","position":[-0.3510919001707332,0,3.4809057789474176],"scale":0.7514910911432083},{"type":"grass","position":[-7.282665263157427,0,5.144533875284409],"scale":0.9618340725635455},{"type":"grass","position":[-9.255958440116308,0,53.8392927912602],"scale":0.9617756596794126},{"type":"grass","position":[110.28335481323366,0,-1.0805479951851957],"scale":1.0961294192122448},{"type":"grass","position":[23.490982339200833,0,13.751763451442711],"scale":0.9799004565576488},{"type":"grass","position":[6.35022005766276,0,-0.9788547125232702],"scale":0.7178763323709967},{"type":"grass","position":[-0.4638663784309838,0,19.02874294594193],"scale":0.7817317639846038},{"type":"grass","position":[-1.236403177899661,0,-14.254727172604174],"scale":1.1864046442656182},{"type":"grass","position":[-6.868971523439589,0,-5.715475404126642],"scale":1.0406872627202715},{"type":"grass","position":[-42.97058710660232,0,11.1432346060702],"scale":1.2789737850234215},{"type":"grass","position":[-58.003734609616075,0,75.27796681588016],"scale":1.2083914356396903},{"type":"grass","position":[48.171511577908305,0,66.55276555913262],"scale":1.2063430787019471},{"type":"grass","position":[-111.67588578671992,0,80.8373938808278],"scale":1.2861695622905849},{"type":"grass","position":[-48.86890023459287,0,-39.81415116829419],"scale":0.8257930959241202},{"type":"grass","position":[83.40040860293979,0,76.00730916938232],"scale":0.8384404090609755},{"type":"grass","position":[-109.67232695953157,0,-9.977024500533693],"scale":0.939479159655972},{"type":"grass","position":[70.85754761953342,0,-16.3574787057085],"scale":0.7441433687473306},{"type":"grass","position":[-73.61208335716218,0,-20.877852063306747],"scale":0.7532656221710512},{"type":"grass","position":[31.43222211222101,0,-56.54304223307588],"scale":0.7661235868562941},{"type":"grass","position":[112.13848727586593,0,-64.44615550850376],"scale":1.0934845922113827},{"type":"grass","position":[-121.30538437317541,0,-4.042567732138331],"scale":0.9353710056504518},{"type":"grass","position":[38.64225165414593,0,-1.2957855040496606],"scale":0.8753381014701082},{"type":"grass","position":[9.475776870023443,0,-3.6320696623336004],"scale":1.0602791399469482},{"type":"grass","position":[-76.4259045350865,0,59.527583530064184],"scale":1.1053048222249948},{"type":"grass","position":[129.30749222010894,0,-19.27669791409992],"scale":0.7441999410059297},{"type":"grass","position":[28.804823316174154,0,-48.349370330222264],"scale":0.9177867837642124},{"type":"grass","position":[-16.470068939708902,0,-97.43346078566826],"scale":0.9913549330002528},{"type":"grass","position":[43.15270032655923,0,-42.35722501370725],"scale":0.7818781928120024},{"type":"grass","position":[-40.625553761667945,0,70.84915227825557],"scale":0.8453682629581003},{"type":"grass","position":[-112.27841513972135,0,-64.74057953366857],"scale":0.8902964992625144},{"type":"grass","position":[-122.67033371758293,0,-80.1735536838808],"scale":0.8561424044814783},{"type":"grass","position":[38.51954941521348,0,-128.48465749622412],"scale":0.8806573281994166},{"type":"grass","position":[13.586587674577832,0,9.995432793713505],"scale":0.8801933398957993},{"type":"grass","position":[33.851772867058315,0,-120.29094014595948],"scale":0.8803508727813432},{"type":"grass","position":[128.50445046658461,0,23.938624197737056],"scale":0.7121083665467042},{"type":"grass","position":[25.452523657846854,0,-70.58561867278151],"scale":1.1472237587847527},{"type":"grass","position":[-129.9633876403626,0,26.589492384524558],"scale":1.258095496449037},{"type":"grass","position":[-17.320898825657846,0,3.685293087166663],"scale":1.0327003824195229},{"type":"grass","position":[83.0266714373688,0,-108.19440376612887],"scale":1.0131575753689068},{"type":"grass","position":[86.54024284781444,0,-93.80413526174297],"scale":1.2741420198676134},{"type":"grass","position":[31.419672075314566,0,-34.875014457757096],"scale":0.9133852767255946},{"type":"grass","position":[-49.29460460313278,0,-33.19995389062773],"scale":0.7027868868716011},{"type":"grass","position":[0.016035483056091513,0,-7.4601922706466235],"scale":1.2996130437578162},{"type":"grass","position":[-137.54772390260203,0,38.5854963343394],"scale":0.8790492546340696},{"type":"grass","position":[-11.66783996977345,0,107.53025302405088],"scale":0.8320219350104913},{"type":"grass","position":[-73.42285161688582,0,-22.90045965556703],"scale":1.2255428486911846},{"type":"grass","position":[-110.77845956446677,0,-54.86255041807176],"scale":1.2320946018476568},{"type":"grass","position":[96.08491122710181,0,-54.62701255176287],"scale":0.7094800785390114},{"type":"grass","position":[-34.365212459384544,0,0.5738979535110202],"scale":1.033289904373957},{"type":"grass","position":[60.42702621098398,0,46.018977748222056],"scale":0.7005372886912904},{"type":"grass","position":[-19.78067565423524,0,146.25151255800262],"scale":1.100653225380825},{"type":"grass","position":[-18.68606719967356,0,-19.28344596610226],"scale":1.2549497357163917},{"type":"grass","position":[-3.069952825241366,0,20.7475904808739],"scale":1.2908491768034043},{"type":"grass","position":[-21.523485230319125,0,-102.48351407787125],"scale":1.103109728126228},{"type":"grass","position":[22.617718201542623,0,-77.77510875409602],"scale":1.0850692983561996},{"type":"grass","position":[68.7294463859652,0,0.23400710950148865],"scale":1.1922338646610056},{"type":"grass","position":[-14.051181243457332,0,107.43982266357962],"scale":0.8110287811327594},{"type":"grass","position":[11.290728341784298,0,77.00609922742521],"scale":0.9253668813298664},{"type":"grass","position":[140.37576439394553,0,-31.55955268306266],"scale":0.9518647305208323},{"type":"grass","position":[12.621850080444558,0,11.343324499573916],"scale":1.281275385292676},{"type":"grass","position":[-9.360877327472377,0,8.157018751788703],"scale":1.2060894016613137},{"type":"grass","position":[5.10679171133509,0,-7.2985800725641905],"scale":1.2606130377153781},{"type":"grass","position":[15.617851531277195,0,2.7655371756936593],"scale":0.814035454391159},{"type":"grass","position":[55.04909299224895,0,-72.55210238290145],"scale":0.7434785245423413},{"type":"grass","position":[143.50469103958625,0,-27.972338128335974],"scale":1.2919088736135764},{"type":"grass","position":[38.87551438876658,0,-133.76988369242747],"scale":1.162323069490943},{"type":"grass","position":[57.131586773533016,0,-51.36013675538255],"scale":0.8528816000411117},{"type":"grass","position":[1.2758021581197416,0,127.36966178860627],"scale":1.0330442478067985},{"type":"grass","position":[-118.55505788410383,0,84.83704837932004],"scale":0.8920585513165412},{"type":"grass","position":[-71.04671145035387,0,31.413426691656937],"scale":1.1751107759277206},{"type":"grass","position":[-14.335814618657409,0,-6.120529554137224],"scale":1.1830957428173028},{"type":"grass","position":[-38.618194950395726,0,-60.6623110589045],"scale":1.1735152050844626},{"type":"grass","position":[59.59428121822298,0,-21.184569361955575],"scale":0.7028988377166786},{"type":"grass","position":[19.736315076861626,0,-53.57280411920129],"scale":1.1351659768066833},{"type":"grass","position":[78.51350337727028,0,64.08488015193116],"scale":1.1575224287743753},{"type":"grass","position":[-4.735641822935065,0,-42.50426601191744],"scale":0.7899686924420134},{"type":"grass","position":[59.75229175449355,0,-104.05122039745132],"scale":1.1577025378033818},{"type":"grass","position":[-19.476580824360127,0,-85.01166715864548],"scale":1.1137725431045202},{"type":"grass","position":[5.774109149105527,0,11.60221152572129],"scale":0.979240532401668},{"type":"grass","position":[115.31610662867273,0,73.62865199521752],"scale":0.8950385772967173},{"type":"grass","position":[-20.821596083619816,0,62.85363141477251],"scale":1.1489510699986991},{"type":"grass","position":[-19.53146689104424,0,31.546341250306043],"scale":0.9095796062574959},{"type":"grass","position":[-15.273899808355981,0,-1.9294043370140612],"scale":0.7761565510354886},{"type":"grass","position":[14.75784443327525,0,-79.86688444929715],"scale":0.8148074059172025},{"type":"grass","position":[-4.292401105673723,0,-14.865533222279335],"scale":1.0342047581221832},{"type":"grass","position":[-112.10738779452178,0,16.337946628439003],"scale":1.0748343612879085},{"type":"grass","position":[4.299374264325765,0,-4.463365378375398],"scale":0.7269656409565727},{"type":"grass","position":[-23.93331215065501,0,101.48644105817232],"scale":0.9474593924367066},{"type":"grass","position":[11.80507268748806,0,-8.06977236701984],"scale":1.0931036518378638},{"type":"grass","position":[48.427467372247584,0,-30.892015478998832],"scale":1.2373731552631435},{"type":"grass","position":[-20.694254499390663,0,-4.197377826391169],"scale":0.9805899972795797},{"type":"grass","position":[53.882221689139364,0,4.1886907500467965],"scale":0.8408230648980799},{"type":"grass","position":[100.02801630639317,0,-4.479924917102234],"scale":1.127305593272201},{"type":"grass","position":[59.488749864530966,0,-73.22123744880727],"scale":1.1540975636933584},{"type":"grass","position":[24.39756832683782,0,-124.94008432418555],"scale":0.8603393395357646},{"type":"grass","position":[16.84145022304571,0,39.666176558481986],"scale":1.1640797063223762},{"type":"grass","position":[-61.02653376217197,0,-69.82395241844199],"scale":0.7170484844683703},{"type":"grass","position":[46.56554560409443,0,60.79657927135335],"scale":0.7155380986650882},{"type":"grass","position":[146.6601619484394,0,30.403123826830655],"scale":1.1552998566250419},{"type":"grass","position":[24.453853995281563,0,-5.790346072281672],"scale":1.1652625914164825},{"type":"grass","position":[-91.65161390149817,0,-38.97393929999366],"scale":0.786972501573048},{"type":"grass","position":[-90.78675017942732,0,19.15384468800347],"scale":1.0672452201087603},{"type":"grass","position":[13.951111715518758,0,9.405765230446445],"scale":0.8306796907957373},{"type":"grass","position":[-70.02970190283884,0,-89.75080729137734],"scale":0.8145896050454938},{"type":"grass","position":[18.749851246613094,0,142.87298924589876],"scale":0.8311322093219778},{"type":"grass","position":[106.08718328380762,0,56.780032326782674],"scale":0.9835645986885877},{"type":"grass","position":[53.69958948133692,0,83.27949306972272],"scale":1.2362581684709628},{"type":"grass","position":[4.823318292977849,0,39.54917376806199],"scale":1.0029576416420263},{"type":"grass","position":[-8.794702665208742,0,39.77100189939801],"scale":1.0807632051484861},{"type":"grass","position":[63.72955124419236,0,134.6514978551339],"scale":0.8732535463696562},{"type":"grass","position":[14.09723772979178,0,21.109303487643665],"scale":0.7596950380093958},{"type":"grass","position":[-84.69391442854027,0,7.195540906349817],"scale":0.7707843716226092},{"type":"grass","position":[-32.71124536950327,0,-17.278881832115896],"scale":1.0216237594939963},{"type":"grass","position":[-85.83214384639501,0,82.85378109221594],"scale":0.8658324070953266},{"type":"grass","position":[61.52916195232356,0,-118.08359032285018],"scale":0.8850584842236466},{"type":"grass","position":[-110.6949344036769,0,22.375228584261627],"scale":1.27498368037132},{"type":"grass","position":[-35.605179635318294,0,67.06379702481341],"scale":0.9227478488543801},{"type":"grass","position":[-34.96878384681471,0,-45.209044156225445],"scale":0.8050742619302903},{"type":"grass","position":[54.106561727759455,0,74.4970051982703],"scale":1.1283013789368412},{"type":"grass","position":[-39.38744412328705,0,-126.87283312208729],"scale":0.7304051933991812},{"type":"grass","position":[38.367303308225075,0,31.3804782112814],"scale":0.9424606777511657},{"type":"grass","position":[24.974167912511735,0,28.827577580336758],"scale":1.2352972428703333},{"type":"grass","position":[29.995878379836594,0,-19.347021531241523],"scale":0.9737472361077433},{"type":"grass","position":[-118.34685999447079,0,54.56472675047309],"scale":0.8223247591386381},{"type":"grass","position":[-65.93181685903225,0,-89.27373513921827],"scale":1.2277564079561796},{"type":"grass","position":[50.941782104137886,0,-52.81179894320129],"scale":1.0204106205898267},{"type":"grass","position":[-49.441008914617726,0,-63.73023653535843],"scale":1.0822191817527533},{"type":"grass","position":[-75.11807834793258,0,-29.822796307335732],"scale":0.8251896372276046},{"type":"grass","position":[0.7441133144090243,0,8.28729736308489],"scale":0.8287859791275807},{"type":"grass","position":[59.89472423639534,0,-24.392851893713093],"scale":0.9271729648530926},{"type":"grass","position":[1.371960957436313,0,-11.122086397313685],"scale":1.2940669175905226},{"type":"grass","position":[13.706174895824711,0,77.57154793242843],"scale":0.7780454033371914},{"type":"grass","position":[41.84685172172019,0,50.43852428457031],"scale":1.0780731867125013},{"type":"grass","position":[-53.983451031639966,0,1.5016767358025482],"scale":0.9704828645148059},{"type":"grass","position":[-27.183133157134268,0,-142.29126963845928],"scale":1.213668651362669},{"type":"grass","position":[-54.99575654216372,0,72.55217035300724],"scale":0.8952146994939183},{"type":"grass","position":[34.55630040738376,0,1.4288334892652894],"scale":0.8738098215591059},{"type":"grass","position":[-41.97614971402152,0,-109.92353015545743],"scale":0.9236701237970768},{"type":"grass","position":[12.200610127382186,0,-5.030014008323234],"scale":0.89798373812659},{"type":"grass","position":[-33.83997745917257,0,12.206616906990828],"scale":0.9473035856683244},{"type":"grass","position":[7.70349525181538,0,30.76513818027427],"scale":1.2938808442650112},{"type":"grass","position":[-58.251621887987376,0,-0.9841381088054022],"scale":1.2832820947559107},{"type":"grass","position":[-50.686916616444336,0,11.167708609724592],"scale":0.7022779775670133},{"type":"grass","position":[24.965796195029174,0,-9.8296350713594],"scale":1.2878326390790675},{"type":"grass","position":[-11.19002485758024,0,22.770181879049264],"scale":0.9109572880399108},{"type":"grass","position":[121.67601380468966,0,-40.74672668128108],"scale":0.9327560436326592},{"type":"grass","position":[-28.173099185726546,0,72.11380929758096],"scale":0.8368174442502748},{"type":"grass","position":[-4.042142940215002,0,-0.9627490879032509],"scale":0.9164339868564979},{"type":"grass","position":[-0.5814311862298679,0,-0.6703180853743372],"scale":0.7877922366702338},{"type":"grass","position":[-72.92341260334992,0,-112.24314974795766],"scale":0.753002480026342},{"type":"grass","position":[109.95199243793769,0,93.07419114971202],"scale":0.756084801043168},{"type":"grass","position":[2.2370238280347903,0,-26.15318277457981],"scale":1.2212267036646436},{"type":"grass","position":[-61.810298320167355,0,-87.9793543060548],"scale":1.033081115851556},{"type":"grass","position":[-24.320638749877634,0,21.16172848170957],"scale":1.0291111567137663},{"type":"grass","position":[53.15511005091358,0,-48.775586569413065],"scale":1.2118415012540327},{"type":"grass","position":[-48.754914259994266,0,39.04312069647993],"scale":1.0429091285652163},{"type":"grass","position":[-8.580383306514124,0,6.783444539882013],"scale":1.197790554249805},{"type":"grass","position":[-0.5652223841276662,0,-46.67245608389803],"scale":0.8579417181636946},{"type":"grass","position":[-44.26006627613552,0,-99.47776937188848],"scale":0.8273350802735843},{"type":"grass","position":[130.52050725519587,0,41.870533023102865],"scale":1.1742934394665394},{"type":"grass","position":[-70.52210791362258,0,28.86145379428987],"scale":1.0015336414899876},{"type":"grass","position":[56.82276089408957,0,130.8990900068013],"scale":1.0480794163321412},{"type":"grass","position":[-5.052009801588151,0,-11.840219764737643],"scale":0.7419750710641637},{"type":"grass","position":[-44.76035154656795,0,-32.5088922504676],"scale":0.9675992133605926},{"type":"grass","position":[26.03190985109101,0,19.449646762901722],"scale":0.743673125117679},{"type":"grass","position":[52.715021815415184,0,-75.87284719915358],"scale":1.2790661735916737},{"type":"grass","position":[-29.788026924907587,0,-13.04061841313928],"scale":1.2030402113195755},{"type":"grass","position":[8.073086818093902,0,8.058340513175974],"scale":0.7518619399871864},{"type":"grass","position":[-71.38467981549509,0,112.77118938247777],"scale":0.7872889139895001},{"type":"grass","position":[-37.833290907201565,0,32.79784579426174],"scale":0.9295066627036871},{"type":"grass","position":[-3.454802248709701,0,-21.89797999325453],"scale":1.175142087404189},{"type":"grass","position":[-69.73686331345777,0,-103.54629194962935],"scale":1.1071114477264241},{"type":"grass","position":[-0.023578631203800528,0,0.6587469312918749],"scale":0.8439444553448721},{"type":"grass","position":[-74.58111445735352,0,-123.24354876548891],"scale":1.1314090908456922},{"type":"grass","position":[18.572048490177522,0,-33.51547453409668],"scale":1.2712715772184175},{"type":"grass","position":[-28.66397196950579,0,30.194631867391177],"scale":0.7876524532585548},{"type":"grass","position":[20.92718918693796,0,-123.57139602436956],"scale":1.1603657795816285},{"type":"grass","position":[-17.39356899849261,0,145.21054440263134],"scale":1.010067595545857},{"type":"grass","position":[14.756132878955524,0,-1.018580312903705],"scale":1.0283956579239795},{"type":"grass","position":[26.021235242139237,0,28.13949331191455],"scale":0.7180694762179178},{"type":"grass","position":[4.802789370263348,0,-27.448650557683376],"scale":1.226248849431413},{"type":"grass","position":[-75.56903614947318,0,28.828943717910754],"scale":0.9606328138782217},{"type":"grass","position":[-41.93486176056616,0,102.56931675368041],"scale":0.9348954963308521},{"type":"grass","position":[-12.375292079819104,0,57.422289498444464],"scale":0.960379512675416},{"type":"grass","position":[7.969467578122188,0,-6.748827413049064],"scale":1.2157910026045302},{"type":"grass","position":[-120.54303273282292,0,75.81047787175422],"scale":1.2801291009830496},{"type":"grass","position":[-63.61578706515428,0,-96.99198266894732],"scale":0.7844922050638792},{"type":"grass","position":[-67.3455974704427,0,-54.86355203056728],"scale":1.0955732156766989},{"type":"grass","position":[-62.289896599039686,0,-4.985597759613763],"scale":1.2035383782551266},{"type":"grass","position":[-70.31816135141618,0,55.17853749114174],"scale":0.9481257468531544},{"type":"grass","position":[-95.39997626413984,0,-78.68128413289519],"scale":1.1042673004842316},{"type":"grass","position":[16.221745633292585,0,75.24786027573734],"scale":1.1208206353578287},{"type":"grass","position":[91.17569818881071,0,-98.3641193017262],"scale":1.2002291789353352},{"type":"grass","position":[15.83377016631946,0,26.76576511453041],"scale":1.1658713368022695},{"type":"grass","position":[3.4639941803057024,0,-29.96592615881066],"scale":0.9636046644903442},{"type":"grass","position":[2.1553397508118746,0,-19.59745977059656],"scale":0.7951022734856974},{"type":"grass","position":[-11.790369625928992,0,37.22221175793305],"scale":1.183588779414554},{"type":"grass","position":[-12.443430356943196,0,5.990189306516484],"scale":1.0471882081536776},{"type":"grass","position":[7.563597978503731,0,-35.01631127643545],"scale":0.8139771187398243},{"type":"grass","position":[-104.66814089434308,0,-59.51208183295623],"scale":0.74900771911162},{"type":"grass","position":[-146.96574589987588,0,-16.844127109803235],"scale":1.0951749306253509},{"type":"grass","position":[-6.908036526567588,0,93.46838250993427],"scale":1.0327109252083984},{"type":"grass","position":[99.85155229640488,0,-34.664434016822796],"scale":0.9641332070532178},{"type":"grass","position":[-33.47461873810897,0,-21.29695708192754],"scale":1.2887452387323686},{"type":"grass","position":[-112.83665857399856,0,73.49110599567003],"scale":0.9262084040346523},{"type":"grass","position":[-64.64577946933288,0,13.405051721803067],"scale":0.9170312729421525},{"type":"grass","position":[-50.63969976072037,0,105.40120876887033],"scale":1.249771047864227},{"type":"grass","position":[-91.67559345387376,0,85.09297232138584],"scale":1.221955453984569},{"type":"grass","position":[-37.2137671417359,0,141.880693846238],"scale":0.9980014590668775},{"type":"grass","position":[-4.68681000198175,0,-2.087935832266624],"scale":0.9201302257918244},{"type":"grass","position":[-97.44252569180976,0,60.292470374176716],"scale":1.0295702227474752},{"type":"grass","position":[-28.695656685541707,0,-44.00460806462055],"scale":1.2225498400526669},{"type":"grass","position":[-108.37270984881913,0,-60.18063643761874],"scale":1.1379883734888714},{"type":"grass","position":[103.81514178522968,0,48.39216155263407],"scale":1.000517344843924},{"type":"grass","position":[-0.2080366142818262,0,105.32707645583078],"scale":0.7051931797396427},{"type":"grass","position":[9.960818358290158,0,-6.435378367975616],"scale":0.7067734323701927},{"type":"grass","position":[105.27371040466092,0,-20.713697326578277],"scale":0.7285716723247336},{"type":"grass","position":[12.569613956665176,0,-37.719499766225155],"scale":0.9902738458510343},{"type":"grass","position":[23.62310468014589,0,11.432025179578947],"scale":0.9210822932606322},{"type":"grass","position":[5.5874130162351445,0,15.302110372017598],"scale":0.9914462943906857},{"type":"grass","position":[-46.041146028893415,0,30.171556095355474],"scale":1.1064747292226504},{"type":"grass","position":[54.55636635931792,0,26.950775793469113],"scale":0.8392430902614938},{"type":"grass","position":[-56.415365321589626,0,-0.07845998774584038],"scale":0.7322396317889416},{"type":"grass","position":[-26.98830884359311,0,-48.97143837522209],"scale":1.1193849727404497},{"type":"grass","position":[-133.73231848215437,0,-57.24092486268551],"scale":1.0105180326265482},{"type":"grass","position":[-127.71091835896628,0,-51.148170698939424],"scale":1.2471301368448617},{"type":"grass","position":[22.125512326463607,0,-15.361299274594346],"scale":0.7963728115274149},{"type":"grass","position":[-90.98160356496625,0,-2.9424091757053867],"scale":0.9016304832374897},{"type":"grass","position":[58.30915729390048,0,-134.48437281947258],"scale":0.9415074816089692},{"type":"grass","position":[24.363059646545235,0,-10.645467526634269],"scale":0.8059331714075078},{"type":"grass","position":[11.13629381663949,0,-17.90663445329407],"scale":1.2217028635548928},{"type":"grass","position":[30.159547673470463,0,-62.028970001737534],"scale":1.0579141192437418},{"type":"grass","position":[-46.797141446822124,0,-111.9688055922113],"scale":1.2970861439880117},{"type":"grass","position":[-72.54189638167723,0,27.960599814570674],"scale":1.0795439332020982},{"type":"grass","position":[-122.96469574990374,0,-36.5967360964863],"scale":1.028870495307108},{"type":"grass","position":[26.832267882102528,0,-64.51033210986004],"scale":1.159082573187456},{"type":"grass","position":[38.738685739691256,0,-38.163285541725045],"scale":0.8949252438051859},{"type":"grass","position":[-22.5950721558935,0,-28.804727282483483],"scale":1.0091903700353735},{"type":"grass","position":[-83.03448730467412,0,19.424727049930073],"scale":1.067580153294526},{"type":"grass","position":[7.814735678948298,0,1.13794337014759],"scale":1.0432191481365234},{"type":"grass","position":[7.682703976521369,0,-66.06127718691586],"scale":1.0044096264595612},{"type":"grass","position":[-50.10969044047162,0,92.5219278574832],"scale":1.2581651838532508},{"type":"grass","position":[-16.17731846905429,0,45.56871004525921],"scale":1.1120824231249982},{"type":"grass","position":[-86.53820796877471,0,-78.1185829484272],"scale":0.9999056350228386},{"type":"grass","position":[64.69839165546628,0,36.12219727595533],"scale":0.7569169992581846},{"type":"grass","position":[36.0728134048022,0,28.180557133492627],"scale":1.0876031913429767},{"type":"grass","position":[71.48006322877903,0,36.840069812816104],"scale":0.8918595288967931},{"type":"grass","position":[-9.479411184628695,0,-49.17273181420467],"scale":1.1790974658897044},{"type":"grass","position":[13.988622138112623,0,98.9456528831264],"scale":0.9435277847140335},{"type":"grass","position":[12.150947803002696,0,-0.5676786347489138],"scale":0.9482342462629952},{"type":"grass","position":[-134.46097390311422,0,17.48373077383406],"scale":0.9779427637965079},{"type":"grass","position":[30.40451187356897,0,-89.15550605005272],"scale":1.154063468372802},{"type":"grass","position":[-8.743692388182403,0,-60.86026216516073],"scale":0.7069668785599144},{"type":"grass","position":[-62.267647479382084,0,-60.955562001996554],"scale":1.0001247954962276},{"type":"grass","position":[67.74280009193332,0,34.98862155442184],"scale":0.9027786753239158},{"type":"grass","position":[-15.030280062120296,0,-26.22062867699337],"scale":0.9360741462622529},{"type":"grass","position":[3.3001428161235604,0,24.071808184671124],"scale":0.7743824195369933},{"type":"grass","position":[-96.98062259175971,0,-0.5183835396238184],"scale":1.0732050506046917},{"type":"grass","position":[107.38634940582217,0,-27.600710326374067],"scale":1.2093964845745022},{"type":"grass","position":[-29.067612402236772,0,-14.05087701797366],"scale":1.2458787784288297},{"type":"grass","position":[-4.938215137451794,0,45.59694695316852],"scale":0.9305774306320315},{"type":"grass","position":[91.70026706442768,0,87.98682000895644],"scale":1.2628991757952703},{"type":"grass","position":[-0.28082538804922874,0,4.3716341309190865],"scale":1.2972912132373824},{"type":"grass","position":[-6.438035340541023,0,-2.7200754751426945],"scale":0.969899350656217},{"type":"grass","position":[9.957487461130683,0,-60.60995234104484],"scale":1.2360685938834424},{"type":"grass","position":[27.539672282813726,0,-53.49842019478731],"scale":0.7703439091191343},{"type":"grass","position":[-32.98735340462844,0,-77.13198665964046],"scale":1.1209909884394609},{"type":"grass","position":[44.14524369666124,0,120.73366384062909],"scale":1.1982551524222753},{"type":"grass","position":[-15.082748058325175,0,26.585376337836813],"scale":0.8381882378455279},{"type":"grass","position":[114.41817490936779,0,66.64483354890451],"scale":0.78700741416644},{"type":"grass","position":[-28.84881248098816,0,-15.872657424002849],"scale":1.2501958325722127},{"type":"grass","position":[-27.483950684498254,0,15.724075799632086],"scale":1.2398475390057855},{"type":"grass","position":[28.47597773547495,0,56.62790620546764],"scale":1.1410773716033944},{"type":"grass","position":[42.49949440461023,0,61.30910236936684],"scale":0.982055985988257},{"type":"grass","position":[145.12472894860258,0,27.899488304491882],"scale":0.721891801792352},{"type":"grass","position":[-117.13524841900927,0,38.65312650506894],"scale":0.8675648979921925},{"type":"grass","position":[68.41786757751925,0,41.82930038467802],"scale":0.8280023617331198},{"type":"grass","position":[-5.3966671664231045,0,30.28513851671437],"scale":1.197199370852732},{"type":"grass","position":[0.5549024564528113,0,-43.0636565321362],"scale":1.0295178221717438},{"type":"grass","position":[-46.359737156844695,0,72.18168089410845],"scale":1.0427098631263796},{"type":"grass","position":[41.41135017190275,0,-35.83670606535196],"scale":0.8920128214282339},{"type":"grass","position":[59.3671008046537,0,-75.89330771122216],"scale":0.9880809045223052},{"type":"grass","position":[63.234696595944904,0,-40.05415237195822],"scale":1.1575462259719496},{"type":"grass","position":[-12.149101384946139,0,-9.602697570260512],"scale":0.9311918053655811},{"type":"grass","position":[-35.61318704241926,0,-15.563847419087862],"scale":0.815771270646244},{"type":"grass","position":[-53.96258574063263,0,5.592378299129908],"scale":1.1097553170554348},{"type":"grass","position":[-37.6704801515817,0,-20.892534776591216],"scale":0.7995815460273257},{"type":"grass","position":[-53.04734019791438,0,-138.8950624682311],"scale":0.7821573507790567},{"type":"grass","position":[28.501015452742163,0,-24.96614095201262],"scale":0.8509081553326965},{"type":"grass","position":[135.23598954873705,0,54.80894683497399],"scale":1.025848295931584},{"type":"grass","position":[13.645269869296943,0,-71.70408054089584],"scale":1.1900765285395125},{"type":"grass","position":[-2.137327568652377,0,-50.765842347738314],"scale":0.9957254418249525},{"type":"grass","position":[-93.08392249452085,0,-58.06696225622575],"scale":1.2252422137773293},{"type":"grass","position":[-47.79406424779815,0,-67.7185608531867],"scale":0.9069777241000068},{"type":"grass","position":[-90.04537781802381,0,-64.4328978117119],"scale":1.2478845081847862},{"type":"grass","position":[85.84341615296871,0,-86.44679613688517],"scale":0.9785118904713156},{"type":"grass","position":[-99.33609588094605,0,42.60329350194985],"scale":1.274238587161579},{"type":"grass","position":[-22.78907193339136,0,-71.26480524967015],"scale":1.292937419432745},{"type":"grass","position":[35.99145131180913,0,70.4601181492665],"scale":1.1827765886913981},{"type":"grass","position":[-90.04391096722124,0,119.85296738928146],"scale":1.131729498936095},{"type":"grass","position":[0.15220182674375524,0,0.16842311171606084],"scale":1.0500096380061867},{"type":"grass","position":[-38.578329019066345,0,-37.61152855217627],"scale":1.0150520112846},{"type":"grass","position":[-111.22816113594493,0,91.68061963088637],"scale":0.7313210966519561},{"type":"grass","position":[59.73093388302829,0,-136.45132344107213],"scale":1.1214786193063238},{"type":"grass","position":[99.92702801348844,0,96.93139204512238],"scale":0.9851840128339993},{"type":"grass","position":[-25.606617157688017,0,-43.42136483830828],"scale":1.174526515271419},{"type":"grass","position":[-123.19528923551258,0,26.69173366169519],"scale":0.7452407134820064},{"type":"grass","position":[-86.31047051266155,0,18.523114904286675],"scale":0.7626895813792798},{"type":"grass","position":[-23.119063522321024,0,25.3068672298179],"scale":1.061015435712614},{"type":"grass","position":[0.06591559162748924,0,129.8163490597867],"scale":1.2258093688213159},{"type":"grass","position":[-42.10321723413588,0,-102.7586810699276],"scale":1.13006615264559},{"type":"grass","position":[53.988644951995546,0,-90.84942322358947],"scale":1.0084110874215888},{"type":"grass","position":[-90.36250636197747,0,-31.32701369242384],"scale":1.2462492617656358},{"type":"grass","position":[8.917032289863679,0,55.24967162898015],"scale":1.2458096977547202},{"type":"grass","position":[-10.026024859587721,0,24.321300361071582],"scale":0.79157471086384},{"type":"grass","position":[6.923669801133859,0,-21.209498960300575],"scale":0.8369159047240927},{"type":"grass","position":[9.667060801763451,0,-53.28371455678906],"scale":1.2093581562783284},{"type":"grass","position":[6.481793595700254,0,5.418396008641806],"scale":1.1792859417715955},{"type":"grass","position":[58.46098272936664,0,-75.28527536484823],"scale":0.7003964456667248},{"type":"grass","position":[-28.387212585580976,0,-7.336727240047997],"scale":1.1930087658611448},{"type":"grass","position":[-50.88121125129478,0,-61.809064667287686],"scale":0.7353645166627748},{"type":"grass","position":[-95.99039085133306,0,69.70938350991118],"scale":1.139694511991989},{"type":"grass","position":[14.605413143679206,0,-133.51497759916586],"scale":1.1116343133665583},{"type":"grass","position":[-118.82556998042566,0,-70.08188494550149],"scale":0.963082823641025},{"type":"grass","position":[-43.50376846110051,0,141.40704250130185],"scale":0.7654511877181457},{"type":"grass","position":[92.23938863284502,0,-76.8081050661861],"scale":0.8014176672666462},{"type":"grass","position":[-22.03908645175895,0,13.59609191019687],"scale":0.7799820318124869},{"type":"grass","position":[-11.265191696805081,0,-18.941548906573573],"scale":0.7684031037324396},{"type":"grass","position":[17.009573798899158,0,-23.070599428595134],"scale":0.7452922932797861},{"type":"grass","position":[4.311043051064518,0,49.019760818260046],"scale":1.1061265081700382},{"type":"grass","position":[-76.32986007144993,0,-49.40334802389993],"scale":1.2259994611815186},{"type":"grass","position":[120.53592396557109,0,-52.537078446702445],"scale":1.2424696930171308},{"type":"grass","position":[2.4280673944661535,0,25.608798223312377],"scale":0.8102583237549782},{"type":"grass","position":[35.16739460932471,0,56.45320385078163],"scale":1.154423294224352},{"type":"grass","position":[35.978949832368265,0,14.926117824702661],"scale":1.2168891794663987},{"type":"grass","position":[39.839477890524975,0,43.38601404229134],"scale":0.949911731320593},{"type":"grass","position":[-9.517037312378218,0,-4.323524127966103],"scale":1.287572674914996},{"type":"grass","position":[14.024894931225312,0,-94.46732022182383],"scale":1.0222883555330688},{"type":"grass","position":[17.001607204266705,0,15.805490593375158],"scale":0.8232118049019054},{"type":"grass","position":[51.128093393225434,0,77.20843641655051],"scale":0.9254680225185449},{"type":"grass","position":[28.314418218102595,0,65.1298379062934],"scale":1.0599823813619893},{"type":"grass","position":[37.26082632984623,0,-90.34959243770194],"scale":0.8033519582204538},{"type":"grass","position":[10.04640119394608,0,35.53820836182482],"scale":1.0395285487664825},{"type":"grass","position":[-125.04870071528029,0,-24.760368925352708],"scale":1.0143899140341035},{"type":"grass","position":[43.150376728460735,0,-87.74968698402354],"scale":1.1328813678192655},{"type":"grass","position":[-14.65477555912179,0,-20.89155981568045],"scale":1.1195493053170724},{"type":"grass","position":[-27.961823440715605,0,-9.670608616577567],"scale":1.269440044182643},{"type":"grass","position":[-3.7055917406181447,0,110.23989903416235],"scale":0.7948541500162919},{"type":"grass","position":[24.723940561892256,0,-4.621601576905358],"scale":0.7738225000081146},{"type":"grass","position":[-4.95477856004737,0,-20.19021985258965],"scale":1.103019166531996},{"type":"grass","position":[17.172209220888753,0,22.044783292236417],"scale":0.9558375805794062},{"type":"grass","position":[-2.378280722291071,0,-1.6146231527468513],"scale":1.191284694555943},{"type":"grass","position":[44.38853496680003,0,40.74455386631703],"scale":1.1129946191501334},{"type":"grass","position":[8.869908349642845,0,-16.106670190897333],"scale":1.0195906364108152},{"type":"grass","position":[-88.83549101068611,0,6.147389481629931],"scale":0.799580335314157},{"type":"grass","position":[-96.62081326390677,0,-76.73357024196751],"scale":0.8654799145189513},{"type":"grass","position":[9.014020967418505,0,-45.95929276672106],"scale":0.7571037875627088},{"type":"grass","position":[1.6239609523301513,0,-1.2405941229438002],"scale":1.13534247160375},{"type":"grass","position":[-23.223459238167138,0,28.25683075095296],"scale":0.978817154935833},{"type":"grass","position":[-49.03964464059199,0,139.79107514916564],"scale":0.7506220795358186},{"type":"grass","position":[-34.28892911316021,0,9.6924116163734],"scale":1.053412055870155},{"type":"grass","position":[51.24616646137458,0,105.92793228374019],"scale":0.9985505862063759},{"type":"grass","position":[42.67690986720052,0,-69.16897716471703],"scale":1.044795884431013},{"type":"grass","position":[12.958748129577092,0,-5.284519174946746],"scale":1.198153266541292},{"type":"grass","position":[3.1092811969302288,0,1.304456986789259],"scale":1.1911705843756382},{"type":"grass","position":[-2.233836632354109,0,7.436919449447979],"scale":0.9938879056110759},{"type":"grass","position":[50.31766856946557,0,123.14346628565598],"scale":1.0865761530771496},{"type":"grass","position":[49.79124141973128,0,-63.090627448528565],"scale":0.9960797004735351},{"type":"grass","position":[33.038987382618345,0,40.5647352876761],"scale":1.0061782050706998},{"type":"grass","position":[-3.8140507976303955,0,-12.28257718713888],"scale":0.8588468868692462},{"type":"grass","position":[60.23969507124807,0,-120.29407549526509],"scale":1.0762617086729158},{"type":"grass","position":[13.455801802188438,0,-19.438552286925272],"scale":0.8146900512279218},{"type":"grass","position":[2.8798698765439936,0,-20.826944749940864],"scale":0.7001093872350835},{"type":"grass","position":[-35.06531732229094,0,3.610002714592618],"scale":0.7084405970409796},{"type":"grass","position":[44.327523850128074,0,-20.604394704689344],"scale":1.1156002301220047},{"type":"grass","position":[0.8943455742300752,0,1.9336611939622335],"scale":0.830712255871096},{"type":"grass","position":[-19.65047144044617,0,57.55124346022532],"scale":1.0063922365500537},{"type":"grass","position":[-68.98693298569171,0,-118.09563795565597],"scale":1.0780912592327376},{"type":"grass","position":[91.60057077914503,0,3.560846340448913],"scale":1.0922510323242842},{"type":"grass","position":[3.1693621249884365,0,-8.079931905914473],"scale":1.0491170690825573},{"type":"grass","position":[6.189208807922646,0,-4.038554045834877],"scale":0.8177815959182996},{"type":"grass","position":[35.89836951492229,0,-55.33148915109631],"scale":0.7027209825599835},{"type":"grass","position":[-3.2300248969221896,0,19.17596094097894],"scale":0.7378350875155156},{"type":"grass","position":[1.5327593075431454,0,3.063534866045135],"scale":1.1563242574877934},{"type":"grass","position":[-67.13070771996729,0,-4.616709870209541],"scale":0.7165520458846085},{"type":"grass","position":[-63.7577775250723,0,-28.57772783567846],"scale":0.942747507195499},{"type":"grass","position":[25.046770226755868,0,-95.66643648446626],"scale":1.1072019775335245},{"type":"grass","position":[88.75394452129748,0,110.8560745274796],"scale":1.2660911142112385},{"type":"grass","position":[31.09656098690642,0,88.14512181822371],"scale":0.7577686120474982},{"type":"grass","position":[-61.29031856929003,0,-81.55696855783408],"scale":1.1020115317012626},{"type":"grass","position":[-14.985063183809704,0,2.612879831676454],"scale":0.8562485150470858},{"type":"grass","position":[-2.2081116058117836,0,-142.3678625107722],"scale":1.0848666736783343},{"type":"grass","position":[0.8393117551434283,0,59.10059663742872],"scale":1.2174594738730706},{"type":"grass","position":[-55.550757693073365,0,22.38752365132022],"scale":0.7510242132883459},{"type":"grass","position":[97.73836172081663,0,47.110898828611376],"scale":1.0377063736833712},{"type":"grass","position":[23.67805228282518,0,-6.0765160508020015],"scale":1.2012356912694235},{"type":"grass","position":[-22.98160567146579,0,-9.341446826096123],"scale":1.1519801571263921},{"type":"grass","position":[67.98149551294497,0,-67.14872282537254],"scale":0.9221764369970322},{"type":"grass","position":[106.5614002449882,0,-71.8528257131282],"scale":1.250996742628827},{"type":"grass","position":[-26.050999447839786,0,14.069843959328377],"scale":0.8658012938548365},{"type":"grass","position":[53.106158987735576,0,61.073765161695015],"scale":0.7201676888644885},{"type":"grass","position":[-32.5487070558591,0,15.86513920270907],"scale":1.1806398993157736},{"type":"grass","position":[96.05964785053045,0,21.983816885597243],"scale":1.266169338957328},{"type":"grass","position":[36.08097217320396,0,24.52989469945909],"scale":0.8592310227632656},{"type":"grass","position":[-4.677873160883359,0,-116.85516303710851],"scale":1.132615921125779},{"type":"grass","position":[9.854608530738656,0,36.858577989724324],"scale":0.7950716401265213},{"type":"grass","position":[38.35305086333062,0,54.835044868656496],"scale":1.047412481802733},{"type":"grass","position":[-40.478733525278024,0,132.00324541544956],"scale":1.0685699127014974},{"type":"grass","position":[-81.09623063622134,0,-103.3292806514948],"scale":1.291647393668355},{"type":"grass","position":[-37.43013060804045,0,-37.72552558809644],"scale":1.0203144959189527},{"type":"grass","position":[117.21278033466426,0,-19.734575107134514],"scale":0.8837017972742105},{"type":"grass","position":[34.398688802661155,0,-117.64339918272661],"scale":1.053920881683533},{"type":"grass","position":[-3.6365805892008822,0,6.899513074102465],"scale":0.9343124522859279},{"type":"grass","position":[-10.360614848096153,0,-21.208418933058894],"scale":1.1595828716854872},{"type":"grass","position":[-46.04971413876992,0,22.937493347211543],"scale":0.9391196402174694},{"type":"grass","position":[72.9324504828895,0,80.29337547893378],"scale":1.0214013955264876},{"type":"grass","position":[-26.132298304144776,0,28.585381508238353],"scale":0.7369396318805933},{"type":"grass","position":[64.64246618492719,0,-41.81221260039235],"scale":1.2828420740548163},{"type":"grass","position":[49.43312320851979,0,-4.656640769372229],"scale":0.9435187066098687},{"type":"grass","position":[37.53795046379662,0,38.17391504092505],"scale":1.2301605364422463},{"type":"grass","position":[-68.9767667977892,0,-104.51844352632483],"scale":0.8186434799013389},{"type":"grass","position":[-40.07711503019073,0,128.62568194934124],"scale":1.278372339613608},{"type":"grass","position":[4.828011683921868,0,-36.308882945500294],"scale":1.2045313919874254},{"type":"grass","position":[-19.7928189157114,0,49.65820621813925],"scale":1.2467708508483277},{"type":"grass","position":[10.750052681507656,0,13.895591690265304],"scale":1.01187423538449},{"type":"grass","position":[132.48492538587084,0,-29.42790491029541],"scale":0.7138916401042695},{"type":"grass","position":[52.36812065882015,0,-81.7508842704054],"scale":1.2442279077899496},{"type":"grass","position":[-21.146669297609662,0,21.94547061293201],"scale":1.0649772252253964},{"type":"grass","position":[126.99657048624945,0,75.87637996249231],"scale":1.1925721490241277},{"type":"grass","position":[-14.57429343735927,0,86.72161267422142],"scale":0.8016824329147765},{"type":"grass","position":[-27.23020284673156,0,2.716639292913204],"scale":0.9077432701854549},{"type":"grass","position":[-3.7246018979694484,0,-34.78412229921232],"scale":1.0530736359829616},{"type":"grass","position":[5.841822256952947,0,122.76742068086021],"scale":0.9888083246073355},{"type":"grass","position":[121.62041195158571,0,37.097531815512475],"scale":1.1275130793705699},{"type":"grass","position":[-40.56120103512828,0,-77.32323252113382],"scale":0.9672511434516465},{"type":"grass","position":[10.991667318523486,0,141.11857390505506],"scale":1.0100340098874083},{"type":"grass","position":[3.2226105880027136,0,34.281063651385175],"scale":0.7911305143027992},{"type":"grass","position":[-35.644801061687296,0,77.95137776443896],"scale":0.9353546640414138},{"type":"grass","position":[17.911177827340826,0,-136.39674898960232],"scale":1.2667948966916998},{"type":"grass","position":[-64.01437675352005,0,-16.71553775462611],"scale":1.0488717031656623},{"type":"grass","position":[80.60446866398951,0,-1.2818100471752039],"scale":0.8503700123029394},{"type":"grass","position":[-89.87612939890973,0,88.91602976490194],"scale":0.8749518270734722},{"type":"grass","position":[-16.12460158256311,0,-73.98873802610234],"scale":0.7838842069200765},{"type":"grass","position":[-96.88472209052864,0,-78.48023464950882],"scale":1.2331658095786482},{"type":"grass","position":[29.103258685597094,0,5.810793154762278],"scale":1.1624217984447263},{"type":"grass","position":[-6.135293436480533,0,-5.28938365940991],"scale":0.8951132780076043},{"type":"grass","position":[47.15916941465925,0,34.53389549696945],"scale":1.0418871183046778},{"type":"grass","position":[49.185180765799245,0,38.85340304025644],"scale":1.296004057042067},{"type":"grass","position":[-5.180335647905354,0,-10.461410731776379],"scale":1.200176212614029},{"type":"grass","position":[-10.806498631276105,0,119.24209766137955],"scale":0.7589556605530468},{"type":"grass","position":[-61.03301026370856,0,-47.91788537705987],"scale":0.9786968346413344},{"type":"grass","position":[-136.89452158737214,0,41.902464412439514],"scale":1.1117402033529833},{"type":"grass","position":[6.2271723394532374,0,-1.5066925923636012],"scale":1.2208076151816898},{"type":"grass","position":[141.82522887228077,0,-4.604623398049937],"scale":0.8988172250836705},{"type":"grass","position":[-21.249863592691227,0,53.817884380648444],"scale":0.9933476338442523},{"type":"grass","position":[37.7088689716236,0,-63.57871608209828],"scale":1.2812828665600353},{"type":"grass","position":[-67.50446602653498,0,32.413884590631824],"scale":1.065285629262637},{"type":"grass","position":[95.19564331912797,0,14.004114686221154],"scale":1.099650311142702},{"type":"grass","position":[0.954098823999878,0,15.97312740205839],"scale":1.029502453857064},{"type":"grass","position":[-0.8528864288813415,0,4.058122996940471],"scale":1.298052256425561},{"type":"grass","position":[-11.455686300315472,0,32.76995394288825],"scale":1.2966603492583249},{"type":"grass","position":[137.0959727805367,0,-14.581946941631196],"scale":1.1357601763204546},{"type":"grass","position":[91.36537249035071,0,-38.36444805629956],"scale":0.9199805835523921},{"type":"grass","position":[12.92118899229289,0,-110.06070002699832],"scale":0.7350075774858155},{"type":"grass","position":[4.575133965117276,0,8.110532649423122],"scale":1.0635963987180383},{"type":"grass","position":[108.96901851929312,0,14.08829953767537],"scale":0.9115474323826117},{"type":"grass","position":[-70.39700614199167,0,-75.60753201645983],"scale":0.9896186865117333},{"type":"grass","position":[-92.29516684336768,0,59.18397966193114],"scale":0.7146049096666994},{"type":"grass","position":[37.9245218761053,0,-42.13698455856874],"scale":0.9897016847565704},{"type":"grass","position":[-21.460178318305047,0,-4.341764113638694],"scale":1.2134613145051296},{"type":"grass","position":[-28.772767912217233,0,-44.23736246437485],"scale":0.9574265820510673},{"type":"grass","position":[-4.529779718346433,0,10.183704744357899],"scale":1.1978628820536967},{"type":"grass","position":[-34.760795692984445,0,93.39522753830983],"scale":0.8911422765669971},{"type":"grass","position":[-85.69131231584362,0,-68.563772172096],"scale":0.8968783975360309},{"type":"grass","position":[-31.01418148903676,0,-33.48108522742858],"scale":1.2422357029074695},{"type":"grass","position":[47.325967578823295,0,124.03687191133497],"scale":0.8309511556888267},{"type":"grass","position":[81.20633518344448,0,113.94321047546418],"scale":1.023562062478242},{"type":"grass","position":[-6.2945846600333715,0,-17.431195312304528],"scale":0.9077349245212414},{"type":"grass","position":[84.1571199821741,0,-81.92133583868628],"scale":1.0685600930821648},{"type":"grass","position":[-80.70523975621279,0,109.99096281545012],"scale":1.142707788792297},{"type":"grass","position":[-27.59936144815774,0,99.06302036753743],"scale":1.2229019271415087},{"type":"grass","position":[2.135532547788902,0,4.682568853627898],"scale":0.9231687667102628},{"type":"grass","position":[107.33823151012545,0,61.444244975390475],"scale":0.8090259673585096},{"type":"grass","position":[-63.047123460946096,0,1.8601211783314981],"scale":0.933549093679386},{"type":"grass","position":[95.17400912537327,0,-80.90063027485576],"scale":1.2675782064442433},{"type":"grass","position":[9.771369257132086,0,-8.603801832011444],"scale":1.1301053656762838},{"type":"grass","position":[-58.40355898573479,0,-35.33665750111874],"scale":0.8372994664119897},{"type":"grass","position":[-28.220476103117996,0,112.77538329213232],"scale":0.8752849465363345},{"type":"grass","position":[22.92947360139325,0,-88.80011092984763],"scale":1.0224734387193708},{"type":"grass","position":[-61.66334568276731,0,87.74356291231054],"scale":1.1399208877161835},{"type":"grass","position":[-23.53725346284168,0,27.726327941116335],"scale":1.0930253717720346},{"type":"grass","position":[15.647746786262145,0,-7.099984148561607],"scale":0.9223836509386001},{"type":"grass","position":[-67.06967637868274,0,86.34920450643797],"scale":0.7424471532919842},{"type":"grass","position":[-12.51376087111426,0,-13.661376931963714],"scale":1.0717947187438395},{"type":"grass","position":[58.316726179679534,0,-78.08725349226866],"scale":1.2059896544100122},{"type":"grass","position":[119.43685992097464,0,11.006590985333151],"scale":1.0228758112582306},{"type":"grass","position":[5.234916848830142,0,-26.252089629860873],"scale":1.1421747166344518},{"type":"grass","position":[-35.32152383888711,0,-77.85261722836913],"scale":0.705970860174178},{"type":"grass","position":[-8.973813698580589,0,68.78460108705788],"scale":0.7653581373884957},{"type":"grass","position":[-73.7656006872468,0,90.11559613797581],"scale":1.144016379745504},{"type":"grass","position":[-123.23302648062285,0,25.483733129860212],"scale":0.7621042908038007},{"type":"grass","position":[-79.94410184786105,0,31.4873577787158],"scale":0.7825838321237915},{"type":"grass","position":[-32.841334842253495,0,133.2236160457179],"scale":0.8640828483003029},{"type":"grass","position":[-18.881301650205998,0,13.378292995034254],"scale":0.8835639612510473},{"type":"grass","position":[-51.10854177619286,0,-3.8974484709570527],"scale":0.7190711305187122},{"type":"grass","position":[-4.299885368620266,0,-31.655513916803873],"scale":0.9365885239401044},{"type":"grass","position":[108.27920007838232,0,-8.67375805360426],"scale":0.8082218129887218},{"type":"grass","position":[7.503512764953696,0,-129.12806333221457],"scale":0.8525411486304995},{"type":"grass","position":[-82.32382639939559,0,-92.67245971034245],"scale":1.2361518176682178},{"type":"grass","position":[-9.359180986387809,0,67.78400553899131],"scale":0.8264328046360506},{"type":"grass","position":[3.3783287131642896,0,-36.97691701848849],"scale":0.7960115803213721},{"type":"grass","position":[116.2922790242473,0,74.71278148070974],"scale":1.197614140246626},{"type":"grass","position":[-9.789776105573988,0,122.11705885418178],"scale":1.2429311420167695},{"type":"grass","position":[-35.71600099643074,0,55.18529657403895],"scale":0.7632603973033454},{"type":"grass","position":[48.32168222555477,0,10.402119565531205],"scale":1.2240679024278958},{"type":"grass","position":[-61.74228809877678,0,-52.92391539422593],"scale":1.0327986065042083},{"type":"grass","position":[75.05727132237232,0,-94.8731036981616],"scale":0.7074535782206265},{"type":"grass","position":[-56.05413350982459,0,11.055632976278543],"scale":1.2413329277525396},{"type":"grass","position":[30.697553335104587,0,-66.35204962711917],"scale":0.8807412671942695},{"type":"grass","position":[-108.88342078479312,0,-33.04985215309755],"scale":0.9566976980874462},{"type":"grass","position":[8.950609469713466,0,-41.99110574902429],"scale":1.1627506365255387},{"type":"grass","position":[-75.41123967130687,0,35.441653548494386],"scale":1.1531015209869797},{"type":"grass","position":[-109.1244200120848,0,-55.159506045430454],"scale":0.9903138701113016},{"type":"grass","position":[130.09049896264068,0,-12.730021243695761],"scale":0.7232602040503765},{"type":"grass","position":[6.617053861963287,0,4.403535396833594],"scale":1.0584704623866914},{"type":"grass","position":[71.06616185453353,0,-32.84393110360233],"scale":0.895221943600988},{"type":"grass","position":[68.09975398541208,0,19.07290821205243],"scale":0.8167277639210605},{"type":"grass","position":[-80.21100800560015,0,68.2175065858264],"scale":1.1500814091607747},{"type":"grass","position":[-103.30555013302462,0,-24.98034320869814],"scale":0.8536045604666614},{"type":"grass","position":[-12.041845886361676,0,-19.62623606534387],"scale":1.1367938087898972},{"type":"grass","position":[-6.998062508813618,0,-97.60523782130653],"scale":1.1317488214033582},{"type":"grass","position":[63.72636434335037,0,-132.61495843832913],"scale":1.0464868824423708},{"type":"grass","position":[-28.998206920401028,0,-80.42962707735659],"scale":0.7894871644811197},{"type":"grass","position":[85.68513590940985,0,7.609820354844911],"scale":0.8909384633308087},{"type":"grass","position":[-17.2223593461408,0,-22.39736703877814],"scale":0.8693392942265264},{"type":"grass","position":[83.87264255268887,0,-33.177646652318785],"scale":0.8986887643235896},{"type":"grass","position":[1.2911724468352255,0,-22.61348419786636],"scale":1.1869071116084968},{"type":"grass","position":[0.5964375648318109,0,0.9548921233925173],"scale":1.2821869552681275},{"type":"grass","position":[-34.157613763937,0,-67.73939209726235],"scale":0.8313070636002277},{"type":"grass","position":[-0.15432367779325304,0,-0.5161529688885063],"scale":1.2325442687939647},{"type":"grass","position":[84.35577257600174,0,25.263149320461164],"scale":1.043365623718532},{"type":"grass","position":[-120.56008226289259,0,-4.840386801563765],"scale":0.8747473219192865},{"type":"grass","position":[5.537442947704899,0,38.975746230898324],"scale":0.9869758413798602},{"type":"grass","position":[-55.311726513725475,0,122.82779130402777],"scale":1.0570172864004288},{"type":"grass","position":[36.62762745714076,0,-127.91559613563545],"scale":1.1652195143933968},{"type":"grass","position":[110.37353746619776,0,-48.963160482881904],"scale":1.147166659082767},{"type":"grass","position":[-78.19782897259107,0,102.03503638600228],"scale":1.185513963782772},{"type":"grass","position":[0.5035339138061574,0,-1.5945274992891738],"scale":1.2913774174125687},{"type":"grass","position":[70.02645752978587,0,93.15510474591444],"scale":1.265459085184618},{"type":"grass","position":[-9.917290424591599,0,-107.38772202066667],"scale":0.7987779231113461},{"type":"grass","position":[-48.39674958219789,0,-2.8244801117168064],"scale":0.9024810505057228},{"type":"grass","position":[50.78330429609923,0,-91.00535480140123],"scale":0.8760280550031205},{"type":"grass","position":[-129.0664095553368,0,43.037055940495684],"scale":1.2098100106074423},{"type":"grass","position":[-80.14788366752846,0,104.06679223278516],"scale":0.7088948654453338},{"type":"grass","position":[-87.0026733812787,0,-49.20018099474959],"scale":1.1793555330084171},{"type":"grass","position":[-96.64527593112636,0,80.35336200466102],"scale":0.8389745259534482},{"type":"grass","position":[118.78633335215625,0,52.8255851797009],"scale":0.880818404167035},{"type":"grass","position":[8.109267552232101,0,49.1055738983901],"scale":1.0755077014989496},{"type":"grass","position":[9.893208965957216,0,-1.2553523292678572],"scale":0.7136340158478375},{"type":"grass","position":[79.33957796720051,0,-82.64816357305918],"scale":1.0495874220879418},{"type":"grass","position":[81.33349640991348,0,-24.235187896436813],"scale":0.8201139989217257},{"type":"grass","position":[-26.524306243368958,0,18.23170288557422],"scale":0.736375189503127},{"type":"grass","position":[18.22279222026441,0,36.23927819403158],"scale":1.1652711995717617},{"type":"grass","position":[15.780691861590336,0,7.431570683259795],"scale":0.9044145318240832},{"type":"grass","position":[-27.24001943323163,0,-104.5236664696501],"scale":0.7947642339223271},{"type":"grass","position":[137.2140697580064,0,-58.01673166169023],"scale":0.9791489455323807},{"type":"grass","position":[-29.559035897335935,0,36.61057985311032],"scale":0.9319601007382738},{"type":"grass","position":[57.76772821575594,0,12.494772694521613],"scale":0.8827383280438038},{"type":"grass","position":[46.395172498313315,0,83.21574425072481],"scale":1.1116400554845467},{"type":"grass","position":[58.6444566277541,0,108.01817079650476],"scale":1.1011927862417759},{"type":"grass","position":[-3.3873243220536784,0,-5.033463325620654],"scale":0.9004932350834454},{"type":"grass","position":[50.35572709174182,0,-57.02956097267322],"scale":0.8474161404932727},{"type":"grass","position":[-34.71407820712455,0,-17.830618589781604],"scale":1.1566811354391837},{"type":"grass","position":[-43.811462345631774,0,-23.65903141594753],"scale":0.8528498936292339},{"type":"grass","position":[26.604593773222458,0,-16.04213564069389],"scale":0.9609448356615234},{"type":"grass","position":[-34.83709722989944,0,103.45388390125123],"scale":0.8644854392415438},{"type":"grass","position":[-0.29467448093299065,0,-79.54778038892377],"scale":0.7559762724084789},{"type":"grass","position":[66.40251816096486,0,127.8517153331235],"scale":1.2727979802197522},{"type":"grass","position":[-135.52620099523344,0,10.989636812296796],"scale":0.9658257273020325},{"type":"grass","position":[36.81253271158167,0,42.70692246534691],"scale":1.0739543827831222},{"type":"grass","position":[71.73240864806425,0,98.02264173904985],"scale":1.2921647008317854},{"type":"grass","position":[-36.33116036136975,0,33.59547255927587],"scale":1.1921786024184464},{"type":"grass","position":[-13.216801329135672,0,-44.89261053874058],"scale":0.7818026590089688},{"type":"grass","position":[9.631377145927159,0,105.98699536115292],"scale":0.8662349120409935},{"type":"grass","position":[28.417045944707077,0,-70.91521447990954],"scale":0.7929967464289273},{"type":"grass","position":[19.47375749416336,0,71.72176600654987],"scale":0.7890179010633682},{"type":"grass","position":[46.10578813581108,0,-12.877048786178447],"scale":0.7068022220850418},{"type":"grass","position":[-88.2347507385863,0,14.66021681944339],"scale":0.9255800233069892},{"type":"grass","position":[-0.03793984977268089,0,-0.00877338770210786],"scale":1.0768909215669338},{"type":"grass","position":[74.59548585304296,0,-3.5649722111252955],"scale":0.9658893009048429},{"type":"grass","position":[30.431328608755695,0,62.676859764513075],"scale":1.1770872125848466},{"type":"grass","position":[-60.59015961829057,0,-68.49445791982613],"scale":0.9909460098602323},{"type":"grass","position":[58.853438668315746,0,71.05918822854632],"scale":0.7954905100235938},{"type":"grass","position":[26.88897019849233,0,147.41504747718676],"scale":1.2581010953965208},{"type":"grass","position":[-4.564742476085816,0,29.973976209824443],"scale":1.2978097025105584},{"type":"grass","position":[-0.9489062260870964,0,-7.475312982768636],"scale":1.2649059661316724},{"type":"grass","position":[88.55028748743494,0,-55.2277958640338],"scale":1.0388808802115006},{"type":"grass","position":[-63.2196146657891,0,97.48780993311075],"scale":0.7911169850155407},{"type":"grass","position":[82.85051586896208,0,-30.714678843872356],"scale":0.7374189982339194},{"type":"grass","position":[-96.01256438425133,0,-54.26081505394388],"scale":1.0694388855206927},{"type":"grass","position":[-74.53178677658259,0,13.58904254400501],"scale":1.1823173722742002},{"type":"grass","position":[16.064882244307924,0,53.80121578982736],"scale":0.9440859485966628},{"type":"grass","position":[-33.73646726531914,0,136.18475901105967],"scale":1.1647968624737808},{"type":"grass","position":[16.177338094816594,0,3.818964754154076],"scale":0.8891129888544748},{"type":"grass","position":[-15.125401527936162,0,16.24891824790047],"scale":1.2786028597315975},{"type":"grass","position":[12.686448861310517,0,-79.61551788404854],"scale":0.9089627470110404},{"type":"grass","position":[-4.706987011622678,0,36.780606054842195],"scale":1.243877657110187},{"type":"grass","position":[33.040392052581566,0,2.086990643788519],"scale":0.7128649476717035},{"type":"grass","position":[-49.23846995319008,0,-11.502484783112356],"scale":0.9405339584008244},{"type":"grass","position":[16.93955734542479,0,2.278230999007192],"scale":1.1954660599407878},{"type":"grass","position":[-43.398673902559814,0,-46.82334944368982],"scale":0.8225235066605865},{"type":"grass","position":[41.07208048277062,0,-56.38032602920863],"scale":1.2763919523823697},{"type":"grass","position":[63.33965894683665,0,78.3241714897116],"scale":1.0945094873656422},{"type":"grass","position":[89.0040514509455,0,13.3236464660445],"scale":0.7754627350790039},{"type":"grass","position":[-8.11610061493762,0,-9.02760787413848],"scale":0.9574591129516845},{"type":"grass","position":[-41.2009312218143,0,14.478475668972452],"scale":0.7975685324754312},{"type":"grass","position":[57.75599161730172,0,-47.73740856749953],"scale":1.2720922196394742},{"type":"grass","position":[-65.41911818303555,0,16.68217227907543],"scale":1.162300259161257},{"type":"grass","position":[-2.6850310262046904,0,-30.749929040456927],"scale":1.1640006003855337},{"type":"grass","position":[72.4165366254966,0,-5.799073477513144],"scale":0.7557945808942426},{"type":"grass","position":[74.6512311985251,0,-109.40673719039872],"scale":1.2462110505832102},{"type":"grass","position":[-55.44907979856402,0,4.90249334429109],"scale":1.1722508366523132},{"type":"grass","position":[39.41991708799735,0,57.8071267831997],"scale":1.0468092002517335},{"type":"grass","position":[59.15134716541447,0,55.55787065948665],"scale":0.9323236611812806},{"type":"grass","position":[21.587752465504426,0,12.789002448371495],"scale":0.7361492188313867},{"type":"grass","position":[-50.96422661670211,0,88.12239300164336],"scale":0.8357291007139691},{"type":"grass","position":[-35.52399319334899,0,-56.63339676148932],"scale":1.241541853758216},{"type":"grass","position":[-131.65383653763843,0,-33.43772903167236],"scale":1.063909587997494},{"type":"grass","position":[6.440018500750394,0,-5.832747414067027],"scale":0.9528158608071006},{"type":"grass","position":[98.38496973847198,0,89.3700259043108],"scale":0.8197571686131192},{"type":"grass","position":[-14.348126564541444,0,-106.3180112965442],"scale":1.2029991783821712},{"type":"grass","position":[-52.37376171951702,0,42.16862923937993],"scale":1.1903233406288842},{"type":"grass","position":[-5.3139665266352125,0,-29.908818134559684],"scale":0.944934823799463},{"type":"grass","position":[-31.566461662688774,0,-5.22601722398646],"scale":1.069049509205272},{"type":"grass","position":[7.083493867361407,0,-47.764696327925094],"scale":1.239811975820132},{"type":"grass","position":[98.53499362075799,0,52.52574931213004],"scale":0.9718021465501672},{"type":"grass","position":[-5.082302794832832,0,-9.714205058141378],"scale":1.0941801509518874},{"type":"grass","position":[7.8527428928374645,0,1.7054515093952944],"scale":0.867367437308221},{"type":"grass","position":[106.20737066605668,0,15.441493056078063],"scale":0.7285322399364255},{"type":"grass","position":[73.9796632803243,0,25.348667316307303],"scale":0.7291898364270489},{"type":"grass","position":[4.09922761311588,0,6.558109177427388],"scale":1.186827899468599},{"type":"grass","position":[-41.213977384604505,0,-83.20260254792528],"scale":0.8821454466310726},{"type":"grass","position":[-148.57183386668808,0,-16.24483529148487],"scale":0.9031039609747982},{"type":"grass","position":[-112.13279566332878,0,-54.4900423219542],"scale":1.1260626709809891},{"type":"grass","position":[-49.43527459804401,0,38.53220767595025],"scale":0.9233965029005073},{"type":"grass","position":[-5.789304622698318,0,20.751689254494213],"scale":0.8576019380816516},{"type":"grass","position":[-53.87213204787044,0,-124.82953116112414],"scale":0.9379062745553985},{"type":"grass","position":[-29.08628543870859,0,6.044817464247439],"scale":1.1910429401711187},{"type":"grass","position":[31.58760373221016,0,-2.422996283100785],"scale":1.2641124652251552},{"type":"grass","position":[-57.292756567674175,0,56.36861889956108],"scale":0.9442284525624023},{"type":"grass","position":[-40.33394072495099,0,-69.95217287579693],"scale":1.1242309222986895},{"type":"grass","position":[71.20079182599444,0,59.21762181723293],"scale":0.9315608251582372},{"type":"grass","position":[-114.1823511250569,0,0.9569716741766101],"scale":1.090950594610284},{"type":"grass","position":[-53.34217901004017,0,89.82731957818244],"scale":1.2609468848652279},{"type":"grass","position":[3.0359087242397513,0,3.522156053097446],"scale":0.93061755346947},{"type":"grass","position":[5.413928774126355,0,28.36154734459217],"scale":1.2697077082400932},{"type":"grass","position":[36.362143663789645,0,100.6343918117287],"scale":1.011124295129831},{"type":"grass","position":[28.18078438331853,0,-23.61752033018171],"scale":1.102338166673103},{"type":"grass","position":[-2.0205163745307546,0,-15.930880165612443],"scale":1.155408744321698},{"type":"grass","position":[144.61472305588555,0,-0.846627020433316],"scale":1.135799997796969},{"type":"grass","position":[86.46770008710591,0,7.808980337127191],"scale":0.9338727817837883},{"type":"grass","position":[-19.114880274177203,0,83.43001059863919],"scale":0.9751952163296328},{"type":"grass","position":[-3.606537107518061,0,-23.25257196574008],"scale":0.872010138938967},{"type":"grass","position":[-15.52423286860705,0,0.0532520037655522],"scale":0.928568918243894},{"type":"grass","position":[-42.55347008036532,0,-44.99210402677101],"scale":1.2292663455056814},{"type":"grass","position":[20.257969653173756,0,-59.234032013714796],"scale":0.806414242595502},{"type":"grass","position":[123.22838233087359,0,-67.85713463429975],"scale":0.7837447220885729},{"type":"grass","position":[81.92436202769018,0,-117.45295987741574],"scale":1.0031774501694026},{"type":"grass","position":[9.381458145003728,0,4.051927159969126],"scale":0.8207477269725123},{"type":"grass","position":[6.8452439139964865,0,-5.283715694247334],"scale":1.263863345931179},{"type":"grass","position":[18.683507819182825,0,11.609797367008023],"scale":1.2660834865772106},{"type":"grass","position":[58.111947651477294,0,-125.22979429189428],"scale":0.9669834446614768},{"type":"grass","position":[-10.984430985616601,0,-13.951074243848538],"scale":0.8011944683368675},{"type":"grass","position":[2.5797127394225496,0,85.75982721698747],"scale":1.231385901801378},{"type":"grass","position":[42.2079613835137,0,32.95063753568697],"scale":1.1143850893692073},{"type":"grass","position":[125.87821072462896,0,-60.86548580206362],"scale":1.2276109104951713},{"type":"grass","position":[25.233205473477604,0,56.00801216940076],"scale":0.8901525838552544},{"type":"grass","position":[-60.12935137156412,0,-12.047764501275644],"scale":0.9040388610812677},{"type":"grass","position":[97.58675020126171,0,-76.89315301500709],"scale":0.7149879335697834},{"type":"grass","position":[-1.7069071592305294,0,1.3718420081497333],"scale":1.0668021085693598},{"type":"grass","position":[-89.18539701212008,0,47.61463612611112],"scale":1.066571216248304},{"type":"grass","position":[32.030000370359666,0,2.546608258739999],"scale":0.9903698751278882},{"type":"grass","position":[62.525506373817755,0,-66.828818635036],"scale":0.7392709578381225},{"type":"grass","position":[64.23899836303465,0,-47.22994069027299],"scale":0.9233539706305318},{"type":"grass","position":[19.497868271827663,0,-22.584505941155932],"scale":1.1707806060281363},{"type":"grass","position":[27.768403229845738,0,-69.41733124182085],"scale":1.121165399077431},{"type":"grass","position":[17.74375211395474,0,-40.59359023203294],"scale":1.0382708467328707},{"type":"grass","position":[-44.81945966802017,0,142.2635726226668],"scale":1.2225770977909591},{"type":"grass","position":[7.605643665000366,0,-8.564011574938021],"scale":0.7956061496189949},{"type":"grass","position":[-28.72898607575601,0,-102.84019926484207],"scale":1.2846616875411194},{"type":"grass","position":[-57.12626620213961,0,128.0485608482598],"scale":0.7745648874811218},{"type":"grass","position":[69.47651968852472,0,84.70272878490564],"scale":0.9563091526715144},{"type":"grass","position":[17.235338695451762,0,-2.4791331669160024],"scale":1.1917406386052203},{"type":"grass","position":[-113.29855328444569,0,39.12438249406837],"scale":0.8065851615557923},{"type":"grass","position":[35.27647641728853,0,30.506668633162256],"scale":0.8434360039412554},{"type":"grass","position":[3.0285543877903165,0,15.88700062668553],"scale":1.006023726790099},{"type":"grass","position":[-18.551069710862873,0,-1.624548642453785],"scale":1.0208928703702778},{"type":"grass","position":[10.680121829538178,0,-115.5229038631119],"scale":1.0323484649233525},{"type":"grass","position":[19.580246239179957,0,-7.493601945551393],"scale":0.9644094940161854},{"type":"grass","position":[93.56743410244354,0,-47.83884119263076],"scale":0.7156365001519406},{"type":"grass","position":[-2.7409614623040044,0,-19.048652729745655],"scale":0.9335495064891621},{"type":"grass","position":[-95.907102499663,0,-60.841273336603905],"scale":1.2337324163942989},{"type":"grass","position":[15.93324829634655,0,76.96434721139855],"scale":0.7171906410429045},{"type":"grass","position":[109.93344180355356,0,-46.63465148551539],"scale":1.0321589484463218},{"type":"grass","position":[-47.107127744664766,0,17.236644953940154],"scale":0.9637956661853894},{"type":"grass","position":[39.32295745229944,0,36.138859290624815],"scale":0.8982383759599497},{"type":"grass","position":[5.6776675294748635,0,-4.450682791834938],"scale":1.2010231588879556},{"type":"grass","position":[-33.94176712486358,0,-82.9484279406344],"scale":0.8354692877665368},{"type":"grass","position":[-12.338853565125653,0,-25.918554159822595],"scale":1.292426931782563},{"type":"grass","position":[116.34905620148149,0,-72.5399889161752],"scale":1.2963081767842743},{"type":"grass","position":[-7.940469564408657,0,-107.8474378806433],"scale":0.7454859794150395},{"type":"grass","position":[-58.642178692299375,0,82.54194750775437],"scale":1.0336078948308847},{"type":"grass","position":[-3.3073995923102553,0,-21.999619108745723],"scale":1.0987306438692186},{"type":"grass","position":[2.3199563544672297,0,86.36131197144896],"scale":1.2145129960403032},{"type":"grass","position":[32.09484207490068,0,-17.60670543171015],"scale":0.8260838165613122},{"type":"grass","position":[-9.87916787709947,0,-4.858291417999775],"scale":1.0296358523638038},{"type":"grass","position":[-78.3013966013689,0,-66.24976786314521],"scale":1.2959572299055542},{"type":"grass","position":[-4.640512999161775,0,-7.389290857585841],"scale":1.0399488853195158},{"type":"grass","position":[54.51505471888637,0,93.10361284176238],"scale":1.2899500177039718},{"type":"grass","position":[9.797260860739119,0,47.36696717606646],"scale":0.9801186152468668},{"type":"grass","position":[-23.288904297978185,0,-9.281974552417315],"scale":1.0980926589042044},{"type":"grass","position":[2.940336120998425,0,-25.25274072080938],"scale":1.0975756700770425},{"type":"grass","position":[74.47704866727403,0,38.32984873740301],"scale":0.9134976875156097},{"type":"grass","position":[14.897100707349962,0,-92.65490911056773],"scale":1.2176984231370565},{"type":"grass","position":[-19.623965020433506,0,13.217282533963003],"scale":0.7906552682614567},{"type":"grass","position":[-0.2343296131738309,0,0.732824736795437],"scale":0.8341303649351566},{"type":"grass","position":[-25.41656515397821,0,-126.34758898285092],"scale":1.1066779301151624},{"type":"grass","position":[-113.17860283398862,0,-4.770767766079477],"scale":0.8601299135898863},{"type":"grass","position":[-62.88960296057457,0,93.66064299655302],"scale":1.0942438942769557},{"type":"grass","position":[110.97339344564125,0,83.34300846136723],"scale":1.15029741634786},{"type":"grass","position":[24.01679911697344,0,-7.933990297176231],"scale":1.1025898083878174},{"type":"grass","position":[-35.91009342805451,0,101.81685198089014],"scale":1.0240894087338828},{"type":"grass","position":[1.3072008072492043,0,-75.57150823041884],"scale":0.7619922086249759},{"type":"grass","position":[-1.5026599463820582,0,-100.35413345418158],"scale":1.1121167534403773},{"type":"grass","position":[84.76860408218802,0,9.716215628122008],"scale":1.281525567018257},{"type":"grass","position":[-73.8254517431295,0,80.0359377316298],"scale":0.8771757170912009},{"type":"grass","position":[-3.1104383039819408,0,18.40158913009521],"scale":1.0254600957569875},{"type":"grass","position":[7.4072150178437575,0,47.54327402871907],"scale":1.0598193975438444},{"type":"grass","position":[42.37796312394666,0,-40.82450543214397],"scale":1.1080467223520065},{"type":"grass","position":[100.48828209858272,0,-29.298502703738126],"scale":1.1631700633121687},{"type":"grass","position":[-41.11699319980952,0,-16.671741629104574],"scale":1.1476858245048465},{"type":"grass","position":[-4.722741972158184,0,-13.873459616328413],"scale":1.232586494792649},{"type":"grass","position":[144.52078251605909,0,24.83151513551944],"scale":0.9456346479288452},{"type":"grass","position":[29.771513564708563,0,-7.421009667021365],"scale":0.8459026013437062},{"type":"grass","position":[-26.624065778141343,0,2.403831759368382],"scale":1.0926257421480827},{"type":"grass","position":[-46.58168587460497,0,14.3026603708851],"scale":0.8230421846715374},{"type":"grass","position":[-59.48042427947578,0,77.41671070714223],"scale":1.1388513163783502},{"type":"grass","position":[-2.5151406803583143,0,-4.6543575535308515],"scale":0.7860159941540107},{"type":"grass","position":[23.972055957567154,0,-37.19202240012063],"scale":0.9307948073381274},{"type":"grass","position":[-15.338249288062322,0,-6.054922892818753],"scale":0.8509235052037739},{"type":"grass","position":[27.634405667643932,0,35.607297254057706],"scale":1.1448258812196952},{"type":"grass","position":[-102.84602555993025,0,-1.2709022184512357],"scale":1.078757910499956},{"type":"grass","position":[-16.656610047544785,0,25.11118446094592],"scale":0.7881923173466878},{"type":"grass","position":[123.12180276101012,0,63.64710997488425],"scale":1.1303856871424247},{"type":"grass","position":[61.62869429300768,0,-27.813302307927348],"scale":1.2400543135903705},{"type":"grass","position":[30.532808297854316,0,-33.41394390831989],"scale":1.007976895884405},{"type":"grass","position":[3.617951363802914,0,-31.887283710497996],"scale":0.7661773134231843},{"type":"grass","position":[-5.051442571979663,0,106.33474562272988],"scale":0.8900164717201589},{"type":"grass","position":[128.97054951761237,0,40.37956567527148],"scale":0.8763208769791002},{"type":"grass","position":[-34.83312664801639,0,19.00212557565277],"scale":1.0389845639592656},{"type":"grass","position":[97.1600424827777,0,24.42994328453655],"scale":1.241984061152075},{"type":"grass","position":[33.120050262244256,0,-58.14447461305313],"scale":0.9411248860335567},{"type":"grass","position":[-115.07922352896416,0,18.74354400411067],"scale":0.7679532578302319},{"type":"grass","position":[62.87694612989288,0,-2.2569325081705585],"scale":0.7703018485567472},{"type":"grass","position":[-23.707399150993503,0,-91.5847345324663],"scale":0.9696905603090886},{"type":"grass","position":[24.291162849750375,0,1.1843331695736061],"scale":0.9652334056989178},{"type":"grass","position":[-87.55028418701546,0,117.03508880365126],"scale":1.273737451406534},{"type":"grass","position":[-4.2344347832104186,0,-4.911487861632785],"scale":1.085255732265963},{"type":"grass","position":[-17.70839463320368,0,21.496157596837563],"scale":1.2414560877822773},{"type":"grass","position":[-142.06688528820692,0,35.31420539345581],"scale":1.1198417453729093},{"type":"grass","position":[79.9846667770541,0,99.4713905677638],"scale":1.174207698990088},{"type":"grass","position":[19.41888997973413,0,46.01825406042097],"scale":1.134783187996395},{"type":"grass","position":[0.7417381195712726,0,21.15857458594487],"scale":0.9005558671392164},{"type":"grass","position":[13.401778798377373,0,-31.941380679543883],"scale":1.0040554519026468},{"type":"grass","position":[21.155118616222808,0,-14.954037893941498],"scale":0.728958707007831},{"type":"grass","position":[108.80778386805204,0,46.70394825488651],"scale":0.8836688430937357},{"type":"grass","position":[-44.41449905121117,0,-100.76419181357078],"scale":0.8579042203919689},{"type":"grass","position":[107.18185071908682,0,-71.06011587336391],"scale":0.9825077177930728},{"type":"grass","position":[56.27506994762582,0,-102.74958941932137],"scale":0.8746694179333266},{"type":"grass","position":[61.497918692202326,0,102.93881580428784],"scale":1.122141967277951},{"type":"grass","position":[-31.606548911109474,0,-27.641212278897612],"scale":1.1866270884751553},{"type":"grass","position":[67.9116014939739,0,-100.69701842489863],"scale":1.2333533599076527},{"type":"grass","position":[4.550977243053364,0,-20.588635328863596],"scale":1.2970423245397544},{"type":"grass","position":[15.643132368979861,0,-22.16056798876434],"scale":1.2550698246323282},{"type":"grass","position":[-68.53637854864664,0,107.56423964163824],"scale":1.1706953155093207},{"type":"grass","position":[-6.655807977361789,0,-0.292730442737243],"scale":1.1567510094307156},{"type":"grass","position":[85.9405023188703,0,-74.93908359740982],"scale":1.1760163662786645},{"type":"grass","position":[-143.6942550481503,0,-2.3136960032766156],"scale":0.9894014862690286},{"type":"grass","position":[99.88234776428003,0,-84.18841493857802],"scale":0.7018331140102559},{"type":"grass","position":[-148.76005363039314,0,-7.223884342459188],"scale":0.8347413480876544},{"type":"grass","position":[16.33440357068166,0,-18.060869359879465],"scale":0.9362786428347789},{"type":"grass","position":[33.9123736275187,0,-95.24445562672912],"scale":0.8937582854178914},{"type":"grass","position":[8.630934064315866,0,-41.719835017241614],"scale":1.2432114538406664},{"type":"grass","position":[73.54367755209005,0,13.234098669720108],"scale":1.2999596337054764},{"type":"grass","position":[35.035370658926965,0,62.30818613538035],"scale":0.8797564520931828},{"type":"grass","position":[-88.01184073217814,0,-41.373293754682344],"scale":0.8388166782992668},{"type":"grass","position":[-53.422271430262775,0,61.11594704786315],"scale":1.0658968527789094},{"type":"grass","position":[-44.91702483532065,0,-61.81803289339253],"scale":1.0471782827683955},{"type":"grass","position":[-2.401245841624212,0,65.4041370974825],"scale":1.243241041299075},{"type":"grass","position":[36.23695849840192,0,22.6901350358796],"scale":1.2306755686541795},{"type":"grass","position":[145.5711108845979,0,-33.386966168647696],"scale":1.2430373929179557},{"type":"grass","position":[55.753195448279,0,83.11505555715087],"scale":0.8120607738068261},{"type":"grass","position":[23.110655325974914,0,135.94562950351482],"scale":1.217377890990924},{"type":"grass","position":[-12.068028326498144,0,83.61731733249832],"scale":1.2331102477653322},{"type":"grass","position":[-12.6465812586456,0,80.57067405357644],"scale":1.1946737130380662},{"type":"grass","position":[-48.971379684819965,0,6.08280779503498],"scale":0.872088467092253},{"type":"grass","position":[-4.342226533445662,0,-14.770555108534033],"scale":0.8713768578521486},{"type":"grass","position":[46.36019377907304,0,62.240447957171064],"scale":0.7032513938908418},{"type":"grass","position":[-97.46859725949172,0,-54.35325670452165],"scale":0.8062423076480885},{"type":"grass","position":[35.33895354588103,0,2.8216262081368986],"scale":1.0608263127005344},{"type":"grass","position":[58.817024951658944,0,-92.0916196938575],"scale":1.0611666588391615},{"type":"grass","position":[117.85620596026173,0,38.3799605460192],"scale":0.8016824693843112},{"type":"grass","position":[-127.983471899814,0,47.615012112654306],"scale":1.2315277216159284},{"type":"grass","position":[-36.88007093248078,0,91.29686466761129],"scale":0.8788704344353084},{"type":"grass","position":[-76.42346215915282,0,-18.48856417636327],"scale":1.0358662890435837},{"type":"grass","position":[18.020925288363284,0,28.915937925819865],"scale":1.178370463881084},{"type":"grass","position":[-5.426860278628467,0,9.498082115993029],"scale":0.9882084366681219},{"type":"grass","position":[35.729552038840175,0,41.16053981175486],"scale":1.166372094850964},{"type":"grass","position":[61.3311364569171,0,24.962250504530214],"scale":1.1922104561631726},{"type":"grass","position":[-126.60686674657622,0,-74.94071935561921],"scale":1.1300002391358919},{"type":"grass","position":[97.25325646768553,0,-54.18734421301565],"scale":0.7386284892265601},{"type":"grass","position":[50.65764657225973,0,117.88353103575706],"scale":0.8371293890695115},{"type":"grass","position":[-103.81873517078263,0,-29.200004192275145],"scale":0.8102694244746639},{"type":"grass","position":[-0.2332772130426538,0,-108.24784763389717],"scale":0.7079898655780936},{"type":"grass","position":[-23.777406910933323,0,112.61181044989662],"scale":0.8988457767543205},{"type":"grass","position":[26.741969517634278,0,-3.0800581821201325],"scale":0.9574459792970036},{"type":"grass","position":[-4.49456194526869,0,-12.828531504028216],"scale":1.1447664254921726},{"type":"grass","position":[18.606425726014585,0,113.020078048984],"scale":1.222475108189839},{"type":"grass","position":[-49.65239132754358,0,-66.04627000832066],"scale":1.0471840558073708},{"type":"grass","position":[122.26437716111586,0,-71.58379787451359],"scale":0.9387645106025283},{"type":"grass","position":[118.12161541168821,0,-49.314688791858416],"scale":0.9434180984728064},{"type":"grass","position":[-7.40019719359491,0,-16.932316151752662],"scale":0.9441142714028354},{"type":"grass","position":[-17.7999723785942,0,11.480108580519127],"scale":1.0457230663930044},{"type":"grass","position":[47.4201069595568,0,15.527681144536112],"scale":0.8834554027432232},{"type":"grass","position":[68.00610663380417,0,-19.368141433717778],"scale":1.2694804558666326},{"type":"grass","position":[11.145670486220032,0,-89.89976365224442],"scale":1.0301120784555358},{"type":"grass","position":[16.138856467125294,0,-97.73897182431938],"scale":1.1256659676427052}]');function wA(r,t){Iv();const e=LM();r.add(e);const s=UM();r.add(s);const i=zM();i.position.set(-50,60,-30),r.add(i);const n=new on(400,400,128,128),o=n.attributes.position;for(let p=0;p<o.count;p++){const h=o.getX(p),g=-o.getY(p),f=dn(h,g);o.setZ(p,f)}n.computeVertexNormals();const a=new F5({color:Ne.colors.ground,roughness:.4,metalness:0,clearcoat:.3,clearcoatRoughness:.6,flatShading:!1}),c=new O(n,a);c.rotation.x=-Math.PI/2,c.receiveShadow=!0,r.add(c);const l=new W(Ne.colors.fog||16762323);r.fog=new Wu(l,.012),r.background=l,Gv(r,1e4),r.add(cM(150,100));const u=rM(80,80);return u.position.set(0,2.5,0),r.add(u),zv(r),r.add(P9),TA(t),{sky:e,moon:i,ground:c}}function L9(r,t=!1,e=1,s=null){wi.length>1e3||(Cc.add(r),wi.push(r),t&&D9.push({position:r.position.clone(),radius:e}),r.userData.type==="mushroom"&&Mc.push(r),r.userData.type==="cloud"&&Kn.push(r),r.userData.isTrampoline&&Ac.push(r),s&&(r.userData.type==="tree"?s.registerTree(r):r.userData.type==="shrub"?s.registerShrub(r):r.userData.type==="mushroom"&&s.registerMushroom(r)))}function _A(r,t,e){if(r*r+t*t<225)return!1;for(const i of D9){const n=r-i.position.x,o=t-i.position.z,a=n*n+o*o,c=i.radius+e+1.5;if(a<c*c)return!1}return!0}function TA(r){console.log(`[World] Loading map with ${F3.length} entities...`),F3.forEach(t=>{const[e,s,i]=t.position;let o=dn(e,i);t.type==="cloud"&&(o=s);try{let a=null,c=!1,l=.5;if(t.type==="mushroom"){const u=t.variant==="giant",p=t.scale||1,h=u||Math.random()<.1;a=Wn({size:u?"giant":"regular",scale:p,hasFace:h,isBouncy:u||h}),c=!0,l=u?2:.5}else if(t.type==="flower")a=t.variant==="glowing"?f9():rl();else if(t.type==="cloud")a=w9({size:t.size||1.5});else if(t.type==="grass"){Wv(e,o,i);return}else t.type==="subwoofer_lotus"?a=qv({scale:t.scale||1}):t.type==="accordion_palm"?(a=Kv({color:16766720}),c=!0):t.type==="fiber_optic_willow"?(a=Jv(),c=!0):t.type==="floating_orb"?(a=aM({size:.5}),o+=1.5):t.type==="swingable_vine"?(a=tM({length:8}),o+=8,Nc&&Nc.push(new Qv(a,8))):t.type==="prism_rose_bush"?(a=Hv(),c=!0):t.type==="starflower"?a=$v():t.type==="vibrato_violet"?a=Yv():t.type==="tremolo_tulip"?a=m9():t.type==="kick_drum_geyser"?a=_9():t.type==="arpeggio_fern"?a=R9({scale:t.scale||1}):t.type==="portamento_pine"?(a=GM({height:4}),c=!0):t.type==="cymbal_dandelion"?a=F9():t.type==="snare_trap"?a=E9():t.type==="bubble_willow"?(a=y9(),c=!0):t.type==="helix_plant"?a=x9():t.type==="balloon_bush"?a=b9():t.type==="wisteria_cluster"&&(a=Zv(),o+=4);a&&(a.position.set(e,o,i),a.rotation.y=Math.random()*Math.PI*2,t.scale&&t.type!=="mushroom"&&t.type!=="flower"&&a.scale.setScalar(t.scale),L9(a,c,l,r))}catch(a){console.warn(`[World] Failed to spawn ${t.type} at ${e},${i}`,a)}}),SA(r)}function SA(r){console.log("[World] Populating procedural extras (flowers, face mushrooms, trees, clouds)..."),window.setLoadingStatus&&window.setLoadingStatus("Growing Procedural Flora...");const t=40,e=150;for(let s=0;s<t;s++){let i=null,n=!1,o=.5,a=0,c=0,l=0,u=0,p=!1;for(;u<10;){if(a=(Math.random()-.5)*e,c=(Math.random()-.5)*e,_A(a,c,1.5)){p=!0;break}u++}if(!p)continue;const h=dn(a,c);try{const d=Math.random();if(d<.3)i=Math.random()<.5?rl():f9(),i.position.set(a,h,c);else if(d<.5)i=Wn({size:"regular",scale:.8+Math.random()*.5,hasFace:!0,isBouncy:!0}),i.position.set(a,h,c),n=!0;else if(d<.65){const g=Math.random();g<.33?i=y9():g<.66?i=b9():i=x9(),i.position.set(a,h,c),n=!0,o=1.5}else if(d<.85){const g=Math.random();g<.2?i=R9({scale:1+Math.random()*.5}):g<.4?(i=_9({maxHeight:5+Math.random()*3}),o=1):g<.6?(i=E9({scale:.8+Math.random()*.4}),n=!0,o=.8):g<.8?i=m9({size:1+Math.random()*.5}):i=F9({scale:.8+Math.random()*.4}),i.position.set(a,h,c)}else l=Math.random()<.5?35+Math.random()*20:12+Math.random()*10,i=w9({size:1+Math.random()}),i.position.set(a,l,c);i&&(i.rotation.y=Math.random()*Math.PI*2,L9(i,n,o,r))}catch(d){console.warn(`[World] Failed to spawn procedural extra at ${a},${c}`,d)}}console.log("[World] Finished populating procedural extras.")}const mi=new v,vA=.5,et={velocity:new v,speed:15,sprintSpeed:25,sneakSpeed:5,gravity:20,energy:0,maxEnergy:10},Ns={direction:new v(1,0,0),strength:0,targetStrength:0,bpm:120},Cn={multiplier:1,targetMultiplier:1,baseGravity:20};let Du=!1;function MA(r){if(!Du){NM(r.position.x,r.position.y,r.position.z);for(const t of Mc){const e=t.userData.stemRadius||.5,s=t.userData.capRadius||2,i=t.userData.capHeight||3,n=t.userData.isTrampoline?1:0;y1(0,t.position.x,t.position.y,t.position.z,0,i,e,s,n)}for(const t of Kn){const e=(t.scale.x||1)*2,s=t.userData.tier||1,i=(t.scale.y||1)*.8;y1(1,t.position.x,t.position.y,t.position.z,e,i,0,s,0)}for(const t of Ac){const e=t.userData.bounceRadius||.5,s=t.userData.bounceHeight||.5,i=t.userData.bounceForce||12;y1(2,t.position.x,t.position.y,t.position.z,e,s,i,0,0)}Du=!0,console.log("[Physics] C++ Physics Initialized with obstacles.")}}function AA(r,t){for(let e=0;e<Ac.length;e++){const s=Ac[e],i=r.x-s.position.x,n=r.z-s.position.z,o=s.position.y+s.userData.bounceHeight,a=r.y-o,c=Math.sqrt(i*i+n*n),l=s.userData.bounceRadius||.5;if(c<l&&a>-.5&&a<1.5&&et.velocity.y<0){const u=t?.kickTrigger||.3,p=s.userData.bounceForce||12;return s.scale.y=.7,setTimeout(()=>{s.scale.y=1},100),p+u*5}}return 0}function NA(r,t,e,s,i){if(i){const n=i.bpm||120;Ns.bpm=n,Ns.targetStrength=Math.min(1,(n-60)/120);const o=i.beatPhase||0,a=Math.sin(o*Math.PI*2)*.3;Ns.targetStrength+=a,Ns.strength+=(Ns.targetStrength-Ns.strength)*r*2,Ns.strength=Math.max(0,Math.min(1,Ns.strength)),Ns.direction.x=Math.sin(Date.now()*1e-4),Ns.direction.z=Math.cos(Date.now()*1e-4),Ns.direction.normalize()}if(i){const n=i.grooveAmount||0;Cn.targetMultiplier=1-n*.4,Cn.multiplier+=(Cn.targetMultiplier-Cn.multiplier)*r*5,et.gravity=Cn.baseGravity*Cn.multiplier}if(Nc.forEach(n=>{n!==Wr&&n.update(t,r,null)}),e.isLocked)if(Wr)Wr.update(t,r,s),s.jump&&(bA(Wr.detach(et)),R3(null),s.jump=!1);else{if(Date.now()-I9>500){const x=t.position;for(const b of Nc){const w=x.x-b.anchorPoint.x,_=x.z-b.anchorPoint.z,T=Math.sqrt(w*w+_*_),M=b.anchorPoint.y-b.length;if(T<2&&x.y<b.anchorPoint.y&&x.y>M&&T<1){b.attach(t,et.velocity),R3(b);break}}}Du||MA(t);let n=0,o=0,a=et.speed;s.sprint&&(a=et.sprintSpeed),s.sneak&&(a=et.sneakSpeed),s.forward&&(o+=1),s.backward&&(o-=1),s.left&&(n-=1),s.right&&(n+=1);const c=Math.sqrt(n*n+o*o);c>0&&(n/=c,o/=c),CM(t.position.x,t.position.y,t.position.z,et.velocity.x,et.velocity.y,et.velocity.z);const l=AM(r,n,o,a,s.jump?1:0,s.sprint?1:0,s.sneak?1:0,Cn.multiplier);if(l>=0){const x=RM();t.position.x=x.x,t.position.y=x.y,t.position.z=x.z,et.velocity.x=x.vx,et.velocity.y=x.vy,et.velocity.z=x.vz,s.jump&&l==1,et.velocity.y>0&&(s.jump=!1),e.moveRight(0);return}mi.set(0,0,0),s.forward&&(mi.z+=a),s.backward&&(mi.z-=a),s.left&&(mi.x-=a),s.right&&(mi.x+=a),mi.lengthSq()>0&&mi.normalize().multiplyScalar(a);const u=Math.min(1,15*r);et.velocity.x+=(mi.x-et.velocity.x)*u,et.velocity.z+=(mi.z-et.velocity.z)*u,et.velocity.y-=et.gravity*r,(isNaN(et.velocity.x)||isNaN(et.velocity.z)||isNaN(et.velocity.y))&&et.velocity.set(0,0,0),e.moveRight(et.velocity.x*r),e.moveForward(et.velocity.z*r);const p=t.position;for(let x=0;x<Mc.length;x++){const b=Mc[x],w=b.userData.stemRadius||.5,_=b.userData.capRadius||2,T=b.userData.capHeight||3,M=b.position,A=p.x-M.x,C=p.z-M.z,P=Math.sqrt(A*A+C*C);if(p.y<M.y+T-.5){const D=w+vA;if(P<D){const V=Math.atan2(C,A),$=Math.cos(V)*D,Y=Math.sin(V)*D;t.position.x=M.x+$,t.position.z=M.z+Y}}else if(et.velocity.y<0&&P<_){const D=M.y+T;if(p.y>=D-.5&&p.y<=D+2)if(b.userData.isTrampoline){const V=i?.kickTrigger||0;et.velocity.y=15+V*10,b.scale.y=.7,setTimeout(()=>{b.scale.y=1},100),s.jump=!1}else t.position.y=D+1.8,et.velocity.y=0,s.jump&&(et.velocity.y=10)}}const h=dn(t.position.x,t.position.z),d=t.position;let g=-1/0;if(d.y>15)for(let x=0;x<Kn.length;x++){const b=Kn[x],w=d.x-b.position.x,_=d.z-b.position.z,T=Math.sqrt(w*w+_*_),M=(b.scale.x||1)*2;if(T<M){if(b.userData.tier===1){const A=b.position.y+(b.scale.y||1)*.8;d.y>=A-.5&&d.y-A<3&&(g=Math.max(g,A))}else if(b.userData.tier===2){const A=b.position.y-2,C=b.position.y+2;d.y>A&&d.y<C&&(et.velocity.y+=30*r,et.velocity.y>8&&(et.velocity.y=8))}}}const f=AA(d,i);f>0&&(et.velocity.y=Math.max(et.velocity.y,f),s.jump=!1);const y=Math.max(isNaN(h)?0:h,g);if(t.position.y<y+1.8&&et.velocity.y<=0){if(t.position.y=y+1.8,et.velocity.y=0,s.jump){const x=1+et.energy/et.maxEnergy*.5;et.velocity.y=10*x,g>h&&(et.velocity.y=15*x)}}else t.position.y+=et.velocity.y*r}}const K0=[],CA=60,RA=.5,FA=new Et(RA,8,8),EA=Ga(16777215);function U9(r,t,e){const s=new O(FA,EA.clone()),n=performance.now()/1e3*.5%1;s.material.color.setHSL(n,1,.5),s.material.emissive.setHSL(n,1,.8),s.material.emissiveIntensity=2,s.position.copy(t),s.userData.velocity=e.clone().normalize().multiplyScalar(CA),s.userData.life=3,r.add(s),K0.push(s)}function BA(r,t,e,s){const n=B9(s).sunIntensity>.5;for(let o=K0.length-1;o>=0;o--){const a=K0[o];a.position.addScaledVector(a.userData.velocity,r),a.userData.life-=r;let c=!1;for(let l=Kn.length-1;l>=0;l--){const u=Kn[l],p=3*(u.scale.x||1);if(a.position.distanceToSquared(u.position)<p*p){c=!0,n?PA(u,t):IA(u,t),e&&e.notifyCloudShot&&e.notifyCloudShot(n);break}}(c||a.userData.life<=0)&&(t.remove(a),K0.splice(o,1))}DA(r,t)}const J0=[];function z9(r,t,e,s){const n=new It,o=new Float32Array(45),a=new Float32Array(45),c=[];for(let p=0;p<15;p++)o[p*3]=t.x+(Math.random()-.5)*2,o[p*3+1]=t.y+(Math.random()-.5)*2,o[p*3+2]=t.z+(Math.random()-.5)*2,a[p*3]=0,a[p*3+1]=1,a[p*3+2]=0,s==="mist"?c.push(new v((Math.random()-.5)*2,Math.random()*2,(Math.random()-.5)*2)):c.push(new v((Math.random()-.5)*1,-10-Math.random()*5,(Math.random()-.5)*1));n.setAttribute("position",new lt(o,3)),n.setAttribute("normal",new lt(a,3));const l=new ln({color:e,size:s==="mist"?1.5:.5,transparent:!0,opacity:.8,blending:pe}),u=new un(n,l);u.userData={velocities:c,life:1.5,type:s},r.add(u),J0.push(u)}function DA(r,t){for(let e=J0.length-1;e>=0;e--){const s=J0[e];s.userData.life-=r;const i=s.geometry.attributes.position.array,n=s.userData.velocities;for(let o=0;o<n.length;o++)i[o*3]+=n[o].x*r,i[o*3+1]+=n[o].y*r,i[o*3+2]+=n[o].z*r;s.geometry.attributes.position.needsUpdate=!0,s.material.opacity=s.userData.life,s.userData.life<=0&&(t.remove(s),s.geometry.dispose(),s.material.dispose(),J0.splice(e,1))}}function PA(r,t){r.userData.isFalling||(r.userData.isFalling=!0,r.userData.velocity=new v(0,5,0),z9(t,r.position,16777215,"mist"),r.traverse(e=>{e.isMesh&&e.material&&(e.material.transparent=!0,e.material.opacity=.5)}))}function IA(r,t){r.userData.isFalling||(r.userData.isFalling=!0,r.userData.velocity=new v(0,-20,0),z9(t,r.position,255,"rain"),r.traverse(e=>{e.isMesh&&e.material&&(e.material.color.setHex(136),e.material.emissive.setHex(255))}))}const LA=new W(1710638),UA=new W(3029593),zA=new W(4871528),E3=new W(10532296),VA=new W(12636384);new v(0,1,0);const kA=new W,OA=new W,GA=new W,D0=new v,v1=new W,as={biasState:"clear",biasIntensity:0,type:"clear"},{scene:fe,camera:Pt,renderer:Q0,ambientLight:B3,sunLight:Lo,sunGlow:P0,sunCorona:I0,lightShaftGroup:Uo,sunGlowMat:L0,coronaMat:U0}=lA(),y2=new tA,V9=new eA(y2),Pu=new ZM(fe,{}),xi=new aA(fe);window.setLoadingStatus&&window.setLoadingStatus("Loading World Map...");const{moon:zo,fireflies:M1}=wA(fe,xi);YM(fe);const WA=OM();fe.add(WA);Lv(fe);let Wo=!1,k9=0;function $A(){k9+=Es/2;const r=!Wo;O9.updateDayNightButtonState(r)}const O9=xA(Pt,y2,$A),HA=O9.controls;window.addEventListener("keydown",r=>{try{if(!r.key)return;const t=r.key.toLowerCase();if(t==="p")Ws.toggle();else if(t==="f"){let e=null,s=1/0;const i=Pt.position;for(let n=0,o=wi.length;n<o;n++){const a=wi[n];if(!a||a.userData?.type!=="flower")continue;const c=a.position.distanceToSquared(i);c<s&&(s=c,e=a)}e?(Pu.reactObject(e,"C4",1),console.log("Demo: triggered C4 on nearest flower",e)):console.log("Demo: no flowers found nearby")}else if(t==="g"){const e=new v;Pt.getWorldDirection(e);const s=Pt.position.clone().add(e.multiplyScalar(3)),i=rl({shape:"layered"});i.position.copy(s),i.rotation.y=Math.random()*Math.PI*2,Cc.add(i),wi.push(i),console.log("Demo: spawned a flower at",i.position)}else if(t==="h"){const e=new v;Pt.getWorldDirection(e);const s=Pt.position.clone().add(e.multiplyScalar(3)),i=Wn({size:"regular"});i.position.copy(s),i.rotation.y=Math.random()*Math.PI*2,Cc.add(i),wi.push(i),console.log("Demo: spawned a mushroom at",i.position)}else if(t==="t"){let e=null,s=1/0;const i=Pt.position;for(let n=0,o=wi.length;n<o;n++){const a=wi[n];if(!a||a.userData?.type!=="mushroom")continue;const c=a.position.distanceToSquared(i);c<s&&(s=c,e=a)}e?(Pu.reactObject(e,"C4",1),console.log("Demo: triggered C4 on nearest mushroom",e)):console.log("Demo: no mushrooms found nearby")}}catch(t){console.warn("Demo trigger error",t)}});window.addEventListener("mousedown",r=>{if(document.pointerLockElement){const t=new v;Pt.getWorldDirection(t);const e=Pt.position.clone().add(t.clone().multiplyScalar(1));e.y-=.2,U9(fe,e,t)}});const qA=new uf;let D3=0,Be=null,A1=0,$s=0,Xi=0;const P3=75;V9.onBeat(r=>{const t=r?.kickTrigger||0;t>.2&&($s=Math.max($s,.4+t*.5),Xi=Math.max(Xi,1+t*3)),typeof ra<"u"&&(ra.value+=.5*(t+.1))});function YA(r,t){const e=Ps,s=Zn,i=Ri,n=180;if(as.biasState="clear",as.biasIntensity=0,as.type="clear",r<e+60){const o=r/(e+60);as.biasState="rain",as.biasIntensity=.3*(1-o),as.type="mist"}else if(r>e+120&&r<e+s-60)Math.random()<3e-4&&(as.biasState="storm",as.biasIntensity=.7+Math.random()*.3,as.type="thunderstorm");else if(r>e+s&&r<e+s+i+n/2){const o=(r-e-s)/(i+n/2);as.biasState="rain",as.biasIntensity=.3+o*.2,as.type="drizzle"}return as}function XA(){Ws.startFrame();const r=qA.getDelta(),t=Math.min(r,.1);Be=Ws.measure("Audio",()=>y2.update()),Ws.measure("BeatSync",()=>V9.update());const e=Be?.bpm||120,s=120/Math.max(10,e);D3+=t*s;const i=D3,n=i+k9,o=n%Es,a=YA(o);Ws.measure("Weather",()=>{xi.update(i,Be,a),xi.updateBerrySeasonalSize(o,Es)});const c=Be?.bpm||120,l=Pe.clamp((c-60)/120,0,1.5),p=(1+xi.windSpeed*4)*(1+l*.5);_u.value=Pe.lerp(_u.value,p,.05),Tu.value.copy(xi.windDirection);const h=Be?.beatPhase||0;if(h<A1&&A1>.8){const Lt=Be?.kickTrigger||0;Lt>.3&&($s=.5+Lt*.5,Xi=2+Lt*3)}A1=h,$s>0&&($s*=.9,$s<.01&&($s=0)),Xi>0&&(Pt.fov=P3-Xi,Pt.updateProjectionMatrix(),Xi*=.85,Xi<.1&&(Xi=0,Pt.fov=P3,Pt.updateProjectionMatrix()));const d=iA(n),g=Ps+Zn+Ri;Wo=o>g-30||o<Ps;const f=xi.getIntensity(),y=xi.getState(),x=kA.copy(d.skyTop),b=OA.copy(d.skyBot),w=GA.copy(d.fog);y===mt.STORM?(x.lerp(LA,f*.6),b.lerp(UA,f*.5),w.lerp(zA,f*.4)):y===mt.RAIN&&(x.lerp(E3,f*.3),b.lerp(E3,f*.25),w.lerp(VA,f*.2)),M9.value.copy(x),A9.value.copy(b),Cu.value.copy(d.horizon),N9.value=d.atmosphereIntensity,fe.fog.color.copy(w);const _=Wo?5:20,T=Wo?40:100;fe.fog.near+=(_-fe.fog.near)*t*.5,fe.fog.far+=(T-fe.fog.far)*t*.5;let M=d.sunInt,A=d.ambInt;if(y===mt.STORM?(M*=1-f*.7,A*=1-f*.5):y===mt.RAIN&&(M*=1-f*.3,A*=1-f*.2),Lo.color.copy(d.sun),Lo.intensity=M,B3.color.copy(d.amb),B3.intensity=A+$s*.5,o<540){const Lt=o/540,$e=Lt*Math.PI,Ui=100;Lo.position.set(Math.cos($e)*-Ui,Math.sin($e)*Ui,20),Lo.visible=!0,P0.visible=!0,I0.visible=!0,zo.visible=!1,D0.copy(Lo.position).normalize(),P0.position.copy(D0).multiplyScalar(400),P0.lookAt(Pt.position),I0.position.copy(D0).multiplyScalar(390),I0.lookAt(Pt.position),Uo.position.copy(D0).multiplyScalar(380),Uo.lookAt(Pt.position);let li=.25,yr=.15,lo=0,uo=!1;if(Lt<.15){const Ts=1-Lt/.15;li=.25+Ts*.35,yr=.15+Ts*.25,lo=Ts*.12,uo=!1,L0.color.setHex(16757606),U0.color.setHex(16766627)}else if(Lt>.85){const Ts=(Lt-.85)/.15;li=.25+Ts*.45,yr=.15+Ts*.35,lo=Ts*.18,uo=!1,L0.color.setHex(16750950),U0.color.setHex(16764057)}else L0.color.setHex(16770457),U0.color.setHex(16774358);L0.opacity=li,U0.opacity=yr,Uo.visible=uo,uo&&(Uo.rotation.z+=t*.1,Uo.children.forEach(Ts=>{Ts.material.opacity=lo}))}else{Lo.visible=!1,P0.visible=!1,I0.visible=!1,Uo.visible=!1,zo.visible=!0;const $e=(o-540)/(Es-540)*Math.PI,Ui=90;zo.position.set(Math.cos($e)*-Ui,Math.sin($e)*Ui,-30),zo.lookAt(0,0,0),VM(zo,t,Be)}const C=o/Es;let P=0;const D=.5,V=.6,$=.9,Y=.98;C>=V&&C<=$?P=1:C>D&&C<V?P=(C-D)/(V-D):C>$&&C<Y&&(P=1-(C-$)/(Y-$)),Ru.value=Pe.lerp(Ru.value,P*.95,t*2);const tt=P*.8;let ot=0;Be&&Be.channelData&&Be.channelData.length>4?ot=Be.channelData[4].trigger||0:Be&&(ot=(Be.energy||0)*2);const Nt=tt*(.3+ot*.7);Eu.value=Pe.lerp(Eu.value,Nt,t*2);const de=i*.05%1;v1.setHSL(de,1,.5),$s>.2&&v1.setHSL(.8+$s*.1,1,.6),Z0.value.copy(v1);let ut="clear";y===mt.STORM?ut="storm":y===mt.RAIN&&(ut="rain"),PM(Be,Wo,ut,f);const gt=Ps+Zn+Ri+Tc,Bt=gt+Sc,Ot=o>=gt&&o<Bt;Ws.measure("MusicReact",()=>{Pu.update(i,Be,xi,wi,Pt,Wo,Ot,zo)}),M1&&(M1.visible=Ot,Ot&&lM(M1,i)),Ws.measure("Physics",()=>{NA(t,Pt,HA,Se,Be)}),Ws.measure("Gameplay",()=>{kv(t);const Lt=Ov(Pt.position,1.5);Lt>0&&(et.energy=Math.min(et.maxEnergy,et.energy+Lt*.5)),et.energy=Math.max(0,et.energy-t*.1),BA(t,fe,xi,i),iM(t,Kn,dn)}),Ws.measure("Render",()=>Q0.render(fe,Pt)),Ws.endFrame()}xM().then(async r=>{console.log(`WASM module ${r?"active":"using JS fallbacks"}`);const t=new K;t.position.set(0,-9999,0),fe.add(t);const e=rl({shape:"layered"}),s=Wn({size:"regular"});t.add(e),t.add(s);const i=new v(0,-9999,0),n=new v(0,1,0);U9(fe,i,n),window.setLoadingStatus&&window.setLoadingStatus("Compiling Shaders... (This may take a moment)");try{await Q0.compileAsync(fe,Pt),await uA(Q0,fe,Pt),console.log(" Scene shaders pre-compiled (Nuclear Warmup complete).")}catch(c){console.warn("Shader compile error:",c)}fe.remove(t);const o=dn(Pt.position.x,Pt.position.z);Pt.position.y=o+1.8,console.log(`[Startup] Camera positioned at ground height: y=${Pt.position.y.toFixed(2)}`),window.setLoadingStatus&&window.setLoadingStatus("Entering Candy World..."),setTimeout(()=>{window.hideLoadingScreen&&window.hideLoadingScreen()},500);const a=document.getElementById("startButton");a&&(a.disabled=!1,a.innerText="Start Exploration "),Q0.setAnimationLoop(XA);try{window.__sceneReady=!0}catch{}});
