(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const wl="171",ug=0,pg=1,hg=2,dg=0,gg=1,T0=3,go=0,ls=1,Kt=2,fo=0,Tn=1,Jt=2,Gc=3,Oc=4,X5=5,mn=100,Z5=101,j5=102,fg=103,mg=104,K5=200,J5=201,Q5=202,t4=203,Wc=204,$c=205,e4=206,s4=207,i4=208,n4=209,o4=210,r4=0,a4=1,c4=2,Hc=3,l4=4,u4=5,p4=6,h4=7,bl=0,yg=1,xg=2,Sr=0,wg=1,bg=2,vg=3,d4=4,_g=6,Sg=7,Lp=300,mo=301,Fr=302,s0=303,i0=304,Cu=306,Nn=1e3,bn=1001,Rr=1002,Fe=1003,Fu=1004,Tr=1005,Je=1006,Ru=1007,Gi=1008,Tg=1008,Mn=1009,va=1010,_a=1011,dr=1012,Ze=1013,Pe=1014,ns=1015,Qs=1016,Mg=1017,Ag=1018,n0=1020,g4=35902,Ng=1021,Up=1022,Cn=1023,Cg=1024,Fg=1025,ro=1026,Er=1027,vl=1028,zp=1029,ka=1030,kp=1031,Rg=1032,Vp=1033,s1=33776,Mc=33777,Ac=33778,Nc=33779,Th=35840,Mh=35841,Ah=35842,Nh=35843,Ch=36196,Eu=37492,Du=37496,Bu=37808,Pu=37809,Iu=37810,Lu=37811,Uu=37812,zu=37813,ku=37814,Vu=37815,Gu=37816,Ou=37817,Wu=37818,$u=37819,Hu=37820,qu=37821,i1=36492,Eg=36283,Fh=36284,Rh=36285,Eh=36286,Fn=0,Dg=1,yo="",et="srgb",Oi="srgb-linear",Dh="linear",Sa="srgb",Bg=0,Kn=7680,Pg=7681,Ig=7682,Lg=7683,Ug=34055,zg=34056,kg=5386,Vg=512,Gg=513,Og=514,Wg=515,$g=516,Hg=517,qg=518,Yu=519,f4=512,Gp=513,m4=514,y4=515,x4=516,w4=517,b4=518,v4=519,qc=35044,vn=35048,js=2e3,Xi=2001;class Pn{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const s=this._listeners;s[t]===void 0&&(s[t]=[]),s[t].indexOf(e)===-1&&s[t].push(e)}hasEventListener(t,e){if(this._listeners===void 0)return!1;const s=this._listeners;return s[t]!==void 0&&s[t].indexOf(e)!==-1}removeEventListener(t,e){if(this._listeners===void 0)return;const i=this._listeners[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){if(this._listeners===void 0)return;const s=this._listeners[t.type];if(s!==void 0){t.target=this;const i=s.slice(0);for(let n=0,r=i.length;n<r;n++)i[n].call(this,t);t.target=null}}}const ze=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let Bh=1234567;const Ta=Math.PI/180,Va=180/Math.PI;function di(){const o=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,s=Math.random()*4294967295|0;return(ze[o&255]+ze[o>>8&255]+ze[o>>16&255]+ze[o>>24&255]+"-"+ze[t&255]+ze[t>>8&255]+"-"+ze[t>>16&15|64]+ze[t>>24&255]+"-"+ze[e&63|128]+ze[e>>8&255]+"-"+ze[e>>16&255]+ze[e>>24&255]+ze[s&255]+ze[s>>8&255]+ze[s>>16&255]+ze[s>>24&255]).toLowerCase()}function dt(o,t,e){return Math.max(t,Math.min(e,o))}function Op(o,t){return(o%t+t)%t}function Yg(o,t,e,s,i){return s+(o-t)*(i-s)/(e-t)}function Xg(o,t,e){return o!==t?(e-o)/(t-o):0}function Ma(o,t,e){return(1-e)*o+e*t}function Zg(o,t,e,s){return Ma(o,t,1-Math.exp(-e*s))}function jg(o,t=1){return t-Math.abs(Op(o,t*2)-t)}function Kg(o,t,e){return o<=t?0:o>=e?1:(o=(o-t)/(e-t),o*o*(3-2*o))}function Jg(o,t,e){return o<=t?0:o>=e?1:(o=(o-t)/(e-t),o*o*o*(o*(o*6-15)+10))}function Qg(o,t){return o+Math.floor(Math.random()*(t-o+1))}function tf(o,t){return o+Math.random()*(t-o)}function ef(o){return o*(.5-Math.random())}function sf(o){o!==void 0&&(Bh=o);let t=Bh+=1831565813;return t=Math.imul(t^t>>>15,t|1),t^=t+Math.imul(t^t>>>7,t|61),((t^t>>>14)>>>0)/4294967296}function nf(o){return o*Ta}function of(o){return o*Va}function rf(o){return(o&o-1)===0&&o!==0}function af(o){return Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function cf(o){return Math.pow(2,Math.floor(Math.log(o)/Math.LN2))}function lf(o,t,e,s,i){const n=Math.cos,r=Math.sin,a=n(e/2),c=r(e/2),l=n((t+s)/2),u=r((t+s)/2),p=n((t-s)/2),h=r((t-s)/2),d=n((s-t)/2),g=r((s-t)/2);switch(i){case"XYX":o.set(a*u,c*p,c*h,a*l);break;case"YZY":o.set(c*h,a*u,c*p,a*l);break;case"ZXZ":o.set(c*p,c*h,a*u,a*l);break;case"XZX":o.set(a*u,c*g,c*d,a*l);break;case"YXY":o.set(c*d,a*u,c*g,a*l);break;case"ZYZ":o.set(c*g,c*d,a*u,a*l);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function je(o,t){switch(t.constructor){case Float32Array:return o;case Uint32Array:return o/4294967295;case Uint16Array:return o/65535;case Uint8Array:return o/255;case Int32Array:return Math.max(o/2147483647,-1);case Int16Array:return Math.max(o/32767,-1);case Int8Array:return Math.max(o/127,-1);default:throw new Error("Invalid component type.")}}function ht(o,t){switch(t.constructor){case Float32Array:return o;case Uint32Array:return Math.round(o*4294967295);case Uint16Array:return Math.round(o*65535);case Uint8Array:return Math.round(o*255);case Int32Array:return Math.round(o*2147483647);case Int16Array:return Math.round(o*32767);case Int8Array:return Math.round(o*127);default:throw new Error("Invalid component type.")}}const Gt={DEG2RAD:Ta,RAD2DEG:Va,generateUUID:di,clamp:dt,euclideanModulo:Op,mapLinear:Yg,inverseLerp:Xg,lerp:Ma,damp:Zg,pingpong:jg,smoothstep:Kg,smootherstep:Jg,randInt:Qg,randFloat:tf,randFloatSpread:ef,seededRandom:sf,degToRad:nf,radToDeg:of,isPowerOfTwo:rf,ceilPowerOfTwo:af,floorPowerOfTwo:cf,setQuaternionFromProperEuler:lf,normalize:ht,denormalize:je};class Y{constructor(t=0,e=0){Y.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,s=this.y,i=t.elements;return this.x=i[0]*e+i[3]*s+i[6],this.y=i[1]*e+i[4]*s+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(dt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(dt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y;return e*e+s*s}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const s=Math.cos(e),i=Math.sin(e),n=this.x-t.x,r=this.y-t.y;return this.x=n*s-r*i+t.x,this.y=n*i+r*s+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class gs{constructor(t,e,s,i,n,r,a,c,l){gs.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,a,c,l)}set(t,e,s,i,n,r,a,c,l){const u=this.elements;return u[0]=t,u[1]=i,u[2]=a,u[3]=e,u[4]=n,u[5]=c,u[6]=s,u[7]=r,u[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],this}extractBasis(t,e,s){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),s.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],a=s[3],c=s[6],l=s[1],u=s[4],p=s[7],h=s[2],d=s[5],g=s[8],f=i[0],m=i[3],x=i[6],w=i[1],b=i[4],v=i[7],T=i[2],M=i[5],F=i[8];return n[0]=r*f+a*w+c*T,n[3]=r*m+a*b+c*M,n[6]=r*x+a*v+c*F,n[1]=l*f+u*w+p*T,n[4]=l*m+u*b+p*M,n[7]=l*x+u*v+p*F,n[2]=h*f+d*w+g*T,n[5]=h*m+d*b+g*M,n[8]=h*x+d*v+g*F,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],a=t[5],c=t[6],l=t[7],u=t[8];return e*r*u-e*a*l-s*n*u+s*a*c+i*n*l-i*r*c}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],a=t[5],c=t[6],l=t[7],u=t[8],p=u*r-a*l,h=a*c-u*n,d=l*n-r*c,g=e*p+s*h+i*d;if(g===0)return this.set(0,0,0,0,0,0,0,0,0);const f=1/g;return t[0]=p*f,t[1]=(i*l-u*s)*f,t[2]=(a*s-i*r)*f,t[3]=h*f,t[4]=(u*e-i*c)*f,t[5]=(i*n-a*e)*f,t[6]=d*f,t[7]=(s*c-l*e)*f,t[8]=(r*e-s*n)*f,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,s,i,n,r,a){const c=Math.cos(n),l=Math.sin(n);return this.set(s*c,s*l,-s*(c*r+l*a)+r+t,-i*l,i*c,-i*(-l*r+c*a)+a+e,0,0,1),this}scale(t,e){return this.premultiply(n1.makeScale(t,e)),this}rotate(t){return this.premultiply(n1.makeRotation(-t)),this}translate(t,e){return this.premultiply(n1.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,s,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<9;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<9;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const n1=new gs;function uf(o){for(let t=o.length-1;t>=0;--t)if(o[t]>=65535)return!0;return!1}function Xu(o){return document.createElementNS("http://www.w3.org/1999/xhtml",o)}function pf(){const o=Xu("canvas");return o.style.display="block",o}const Ph={};function hf(o){o in Ph||(Ph[o]=!0,console.warn(o))}const Ih=new gs().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Lh=new gs().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function df(){const o={enabled:!0,workingColorSpace:Oi,spaces:{},convert:function(i,n,r){return this.enabled===!1||n===r||!n||!r||(this.spaces[n].transfer===Sa&&(i.r=Wi(i.r),i.g=Wi(i.g),i.b=Wi(i.b)),this.spaces[n].primaries!==this.spaces[r].primaries&&(i.applyMatrix3(this.spaces[n].toXYZ),i.applyMatrix3(this.spaces[r].fromXYZ)),this.spaces[r].transfer===Sa&&(i.r=Mr(i.r),i.g=Mr(i.g),i.b=Mr(i.b))),i},fromWorkingColorSpace:function(i,n){return this.convert(i,this.workingColorSpace,n)},toWorkingColorSpace:function(i,n){return this.convert(i,n,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===yo?Dh:this.spaces[i].transfer},getLuminanceCoefficients:function(i,n=this.workingColorSpace){return i.fromArray(this.spaces[n].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,n,r){return i.copy(this.spaces[n].toXYZ).multiply(this.spaces[r].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},t=[.64,.33,.3,.6,.15,.06],e=[.2126,.7152,.0722],s=[.3127,.329];return o.define({[Oi]:{primaries:t,whitePoint:s,transfer:Dh,toXYZ:Ih,fromXYZ:Lh,luminanceCoefficients:e,workingColorSpaceConfig:{unpackColorSpace:et},outputColorSpaceConfig:{drawingBufferColorSpace:et}},[et]:{primaries:t,whitePoint:s,transfer:Sa,toXYZ:Ih,fromXYZ:Lh,luminanceCoefficients:e,outputColorSpaceConfig:{drawingBufferColorSpace:et}}}),o}const he=df();function Wi(o){return o<.04045?o*.0773993808:Math.pow(o*.9478672986+.0521327014,2.4)}function Mr(o){return o<.0031308?o*12.92:1.055*Math.pow(o,.41666)-.055}let Po;class gf{static getDataURL(t){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let e;if(t instanceof HTMLCanvasElement)e=t;else{Po===void 0&&(Po=Xu("canvas")),Po.width=t.width,Po.height=t.height;const s=Po.getContext("2d");t instanceof ImageData?s.putImageData(t,0,0):s.drawImage(t,0,0,t.width,t.height),e=Po}return e.width>2048||e.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",t),e.toDataURL("image/jpeg",.6)):e.toDataURL("image/png")}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=Xu("canvas");e.width=t.width,e.height=t.height;const s=e.getContext("2d");s.drawImage(t,0,0,t.width,t.height);const i=s.getImageData(0,0,t.width,t.height),n=i.data;for(let r=0;r<n.length;r++)n[r]=Wi(n[r]/255)*255;return s.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let s=0;s<e.length;s++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[s]=Math.floor(Wi(e[s]/255)*255):e[s]=Wi(e[s]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let ff=0;class _4{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:ff++}),this.uuid=di(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const s={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let r=0,a=i.length;r<a;r++)i[r].isDataTexture?n.push(o1(i[r].image)):n.push(o1(i[r]))}else n=o1(i);s.url=n}return e||(t.images[this.uuid]=s),s}}function o1(o){return typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&o instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&o instanceof ImageBitmap?gf.getDataURL(o):o.data?{data:Array.from(o.data),width:o.width,height:o.height,type:o.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let mf=0;class Ke extends Pn{constructor(t=Ke.DEFAULT_IMAGE,e=Ke.DEFAULT_MAPPING,s=bn,i=bn,n=Je,r=Gi,a=Cn,c=Mn,l=Ke.DEFAULT_ANISOTROPY,u=yo){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:mf++}),this.uuid=di(),this.name="",this.source=new _4(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=s,this.wrapT=i,this.magFilter=n,this.minFilter=r,this.anisotropy=l,this.format=a,this.internalFormat=null,this.type=c,this.offset=new Y(0,0),this.repeat=new Y(1,1),this.center=new Y(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gs,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=u,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const s={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(s.userData=this.userData),e||(t.textures[this.uuid]=s),s}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==Lp)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case Nn:t.x=t.x-Math.floor(t.x);break;case bn:t.x=t.x<0?0:1;break;case Rr:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case Nn:t.y=t.y-Math.floor(t.y);break;case bn:t.y=t.y<0?0:1;break;case Rr:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}Ke.DEFAULT_IMAGE=null;Ke.DEFAULT_MAPPING=Lp;Ke.DEFAULT_ANISOTROPY=1;class vt{constructor(t=0,e=0,s=0,i=1){vt.prototype.isVector4=!0,this.x=t,this.y=e,this.z=s,this.w=i}get width(){return this.z}set width(t){this.z=t}get height(){return this.w}set height(t){this.w=t}set(t,e,s,i){return this.x=t,this.y=e,this.z=s,this.w=i,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this.w=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setW(t){return this.w=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;case 3:this.w=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w!==void 0?t.w:1,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this.w+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this.w=t.w+e.w,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this.w+=t.w*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this.w-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this.w=t.w-e.w,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=this.w,r=t.elements;return this.x=r[0]*e+r[4]*s+r[8]*i+r[12]*n,this.y=r[1]*e+r[5]*s+r[9]*i+r[13]*n,this.z=r[2]*e+r[6]*s+r[10]*i+r[14]*n,this.w=r[3]*e+r[7]*s+r[11]*i+r[15]*n,this}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this}divideScalar(t){return this.multiplyScalar(1/t)}setAxisAngleFromQuaternion(t){this.w=2*Math.acos(t.w);const e=Math.sqrt(1-t.w*t.w);return e<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=t.x/e,this.y=t.y/e,this.z=t.z/e),this}setAxisAngleFromRotationMatrix(t){let e,s,i,n;const c=t.elements,l=c[0],u=c[4],p=c[8],h=c[1],d=c[5],g=c[9],f=c[2],m=c[6],x=c[10];if(Math.abs(u-h)<.01&&Math.abs(p-f)<.01&&Math.abs(g-m)<.01){if(Math.abs(u+h)<.1&&Math.abs(p+f)<.1&&Math.abs(g+m)<.1&&Math.abs(l+d+x-3)<.1)return this.set(1,0,0,0),this;e=Math.PI;const b=(l+1)/2,v=(d+1)/2,T=(x+1)/2,M=(u+h)/4,F=(p+f)/4,N=(g+m)/4;return b>v&&b>T?b<.01?(s=0,i=.707106781,n=.707106781):(s=Math.sqrt(b),i=M/s,n=F/s):v>T?v<.01?(s=.707106781,i=0,n=.707106781):(i=Math.sqrt(v),s=M/i,n=N/i):T<.01?(s=.707106781,i=.707106781,n=0):(n=Math.sqrt(T),s=F/n,i=N/n),this.set(s,i,n,e),this}let w=Math.sqrt((m-g)*(m-g)+(p-f)*(p-f)+(h-u)*(h-u));return Math.abs(w)<.001&&(w=1),this.x=(m-g)/w,this.y=(p-f)/w,this.z=(h-u)/w,this.w=Math.acos((l+d+x-1)/2),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this.w=e[15],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this.w=Math.min(this.w,t.w),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this.w=Math.max(this.w,t.w),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this.z=dt(this.z,t.z,e.z),this.w=dt(this.w,t.w,e.w),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this.z=dt(this.z,t,e),this.w=dt(this.w,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(dt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this.w+=(t.w-this.w)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this.w=t.w+(e.w-t.w)*s,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z&&t.w===this.w}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this.w=t[e+3],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t[e+3]=this.w,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this.w=t.getW(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class In extends Pn{constructor(t=1,e=1,s={}){super(),this.isRenderTarget=!0,this.width=t,this.height=e,this.depth=1,this.scissor=new vt(0,0,t,e),this.scissorTest=!1,this.viewport=new vt(0,0,t,e);const i={width:t,height:e,depth:1};s=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Je,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},s);const n=new Ke(i,s.mapping,s.wrapS,s.wrapT,s.magFilter,s.minFilter,s.format,s.type,s.anisotropy,s.colorSpace);n.flipY=!1,n.generateMipmaps=s.generateMipmaps,n.internalFormat=s.internalFormat,this.textures=[];const r=s.count;for(let a=0;a<r;a++)this.textures[a]=n.clone(),this.textures[a].isRenderTargetTexture=!0;this.depthBuffer=s.depthBuffer,this.stencilBuffer=s.stencilBuffer,this.resolveDepthBuffer=s.resolveDepthBuffer,this.resolveStencilBuffer=s.resolveStencilBuffer,this.depthTexture=s.depthTexture,this.samples=s.samples}get texture(){return this.textures[0]}set texture(t){this.textures[0]=t}setSize(t,e,s=1){if(this.width!==t||this.height!==e||this.depth!==s){this.width=t,this.height=e,this.depth=s;for(let i=0,n=this.textures.length;i<n;i++)this.textures[i].image.width=t,this.textures[i].image.height=e,this.textures[i].image.depth=s;this.dispose()}this.viewport.set(0,0,t,e),this.scissor.set(0,0,t,e)}clone(){return new this.constructor().copy(this)}copy(t){this.width=t.width,this.height=t.height,this.depth=t.depth,this.scissor.copy(t.scissor),this.scissorTest=t.scissorTest,this.viewport.copy(t.viewport),this.textures.length=0;for(let s=0,i=t.textures.length;s<i;s++)this.textures[s]=t.textures[s].clone(),this.textures[s].isRenderTargetTexture=!0;const e=Object.assign({},t.texture.image);return this.texture.source=new _4(e),this.depthBuffer=t.depthBuffer,this.stencilBuffer=t.stencilBuffer,this.resolveDepthBuffer=t.resolveDepthBuffer,this.resolveStencilBuffer=t.resolveStencilBuffer,t.depthTexture!==null&&(this.depthTexture=t.depthTexture.clone()),this.samples=t.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class yf extends In{constructor(t=1,e=1,s={}){super(t,e,s),this.isWebGLRenderTarget=!0}}class xf extends Ke{constructor(t=null,e=1,s=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:t,width:e,height:s,depth:i},this.magFilter=Fe,this.minFilter=Fe,this.wrapR=bn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(t){this.layerUpdates.add(t)}clearLayerUpdates(){this.layerUpdates.clear()}}class Gr{constructor(t=0,e=0,s=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=s,this._w=i}static slerpFlat(t,e,s,i,n,r,a){let c=s[i+0],l=s[i+1],u=s[i+2],p=s[i+3];const h=n[r+0],d=n[r+1],g=n[r+2],f=n[r+3];if(a===0){t[e+0]=c,t[e+1]=l,t[e+2]=u,t[e+3]=p;return}if(a===1){t[e+0]=h,t[e+1]=d,t[e+2]=g,t[e+3]=f;return}if(p!==f||c!==h||l!==d||u!==g){let m=1-a;const x=c*h+l*d+u*g+p*f,w=x>=0?1:-1,b=1-x*x;if(b>Number.EPSILON){const T=Math.sqrt(b),M=Math.atan2(T,x*w);m=Math.sin(m*M)/T,a=Math.sin(a*M)/T}const v=a*w;if(c=c*m+h*v,l=l*m+d*v,u=u*m+g*v,p=p*m+f*v,m===1-a){const T=1/Math.sqrt(c*c+l*l+u*u+p*p);c*=T,l*=T,u*=T,p*=T}}t[e]=c,t[e+1]=l,t[e+2]=u,t[e+3]=p}static multiplyQuaternionsFlat(t,e,s,i,n,r){const a=s[i],c=s[i+1],l=s[i+2],u=s[i+3],p=n[r],h=n[r+1],d=n[r+2],g=n[r+3];return t[e]=a*g+u*p+c*d-l*h,t[e+1]=c*g+u*h+l*p-a*d,t[e+2]=l*g+u*d+a*h-c*p,t[e+3]=u*g-a*p-c*h-l*d,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,s,i){return this._x=t,this._y=e,this._z=s,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const s=t._x,i=t._y,n=t._z,r=t._order,a=Math.cos,c=Math.sin,l=a(s/2),u=a(i/2),p=a(n/2),h=c(s/2),d=c(i/2),g=c(n/2);switch(r){case"XYZ":this._x=h*u*p+l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p-h*d*g;break;case"YXZ":this._x=h*u*p+l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p+h*d*g;break;case"ZXY":this._x=h*u*p-l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p-h*d*g;break;case"ZYX":this._x=h*u*p-l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p+h*d*g;break;case"YZX":this._x=h*u*p+l*d*g,this._y=l*d*p+h*u*g,this._z=l*u*g-h*d*p,this._w=l*u*p-h*d*g;break;case"XZY":this._x=h*u*p-l*d*g,this._y=l*d*p-h*u*g,this._z=l*u*g+h*d*p,this._w=l*u*p+h*d*g;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const s=e/2,i=Math.sin(s);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(s),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,s=e[0],i=e[4],n=e[8],r=e[1],a=e[5],c=e[9],l=e[2],u=e[6],p=e[10],h=s+a+p;if(h>0){const d=.5/Math.sqrt(h+1);this._w=.25/d,this._x=(u-c)*d,this._y=(n-l)*d,this._z=(r-i)*d}else if(s>a&&s>p){const d=2*Math.sqrt(1+s-a-p);this._w=(u-c)/d,this._x=.25*d,this._y=(i+r)/d,this._z=(n+l)/d}else if(a>p){const d=2*Math.sqrt(1+a-s-p);this._w=(n-l)/d,this._x=(i+r)/d,this._y=.25*d,this._z=(c+u)/d}else{const d=2*Math.sqrt(1+p-s-a);this._w=(r-i)/d,this._x=(n+l)/d,this._y=(c+u)/d,this._z=.25*d}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let s=t.dot(e)+1;return s<Number.EPSILON?(s=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=s):(this._x=0,this._y=-t.z,this._z=t.y,this._w=s)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=s),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(dt(this.dot(t),-1,1)))}rotateTowards(t,e){const s=this.angleTo(t);if(s===0)return this;const i=Math.min(1,e/s);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const s=t._x,i=t._y,n=t._z,r=t._w,a=e._x,c=e._y,l=e._z,u=e._w;return this._x=s*u+r*a+i*l-n*c,this._y=i*u+r*c+n*a-s*l,this._z=n*u+r*l+s*c-i*a,this._w=r*u-s*a-i*c-n*l,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const s=this._x,i=this._y,n=this._z,r=this._w;let a=r*t._w+s*t._x+i*t._y+n*t._z;if(a<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,a=-a):this.copy(t),a>=1)return this._w=r,this._x=s,this._y=i,this._z=n,this;const c=1-a*a;if(c<=Number.EPSILON){const d=1-e;return this._w=d*r+e*this._w,this._x=d*s+e*this._x,this._y=d*i+e*this._y,this._z=d*n+e*this._z,this.normalize(),this}const l=Math.sqrt(c),u=Math.atan2(l,a),p=Math.sin((1-e)*u)/l,h=Math.sin(e*u)/l;return this._w=r*p+this._w*h,this._x=s*p+this._x*h,this._y=i*p+this._y*h,this._z=n*p+this._z*h,this._onChangeCallback(),this}slerpQuaternions(t,e,s){return this.copy(t).slerp(e,s)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),s=Math.random(),i=Math.sqrt(1-s),n=Math.sqrt(s);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class S{constructor(t=0,e=0,s=0){S.prototype.isVector3=!0,this.x=t,this.y=e,this.z=s}set(t,e,s){return s===void 0&&(s=this.z),this.x=t,this.y=e,this.z=s,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(Uh.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(Uh.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*s+n[6]*i,this.y=n[1]*e+n[4]*s+n[7]*i,this.z=n[2]*e+n[5]*s+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,s=this.y,i=this.z,n=t.elements,r=1/(n[3]*e+n[7]*s+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*s+n[8]*i+n[12])*r,this.y=(n[1]*e+n[5]*s+n[9]*i+n[13])*r,this.z=(n[2]*e+n[6]*s+n[10]*i+n[14])*r,this}applyQuaternion(t){const e=this.x,s=this.y,i=this.z,n=t.x,r=t.y,a=t.z,c=t.w,l=2*(r*i-a*s),u=2*(a*e-n*i),p=2*(n*s-r*e);return this.x=e+c*l+r*p-a*u,this.y=s+c*u+a*l-n*p,this.z=i+c*p+n*u-r*l,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,s=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*s+n[8]*i,this.y=n[1]*e+n[5]*s+n[9]*i,this.z=n[2]*e+n[6]*s+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=dt(this.x,t.x,e.x),this.y=dt(this.y,t.y,e.y),this.z=dt(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=dt(this.x,t,e),this.y=dt(this.y,t,e),this.z=dt(this.z,t,e),this}clampLength(t,e){const s=this.length();return this.divideScalar(s||1).multiplyScalar(dt(s,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,s){return this.x=t.x+(e.x-t.x)*s,this.y=t.y+(e.y-t.y)*s,this.z=t.z+(e.z-t.z)*s,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const s=t.x,i=t.y,n=t.z,r=e.x,a=e.y,c=e.z;return this.x=i*c-n*a,this.y=n*r-s*c,this.z=s*a-i*r,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const s=t.dot(this)/e;return this.copy(t).multiplyScalar(s)}projectOnPlane(t){return r1.copy(this).projectOnVector(t),this.sub(r1)}reflect(t){return this.sub(r1.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const s=this.dot(t)/e;return Math.acos(dt(s,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,s=this.y-t.y,i=this.z-t.z;return e*e+s*s+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,s){const i=Math.sin(e)*t;return this.x=i*Math.sin(s),this.y=Math.cos(e)*t,this.z=i*Math.cos(s),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,s){return this.x=t*Math.sin(e),this.y=s,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),s=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=s,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,s=Math.sqrt(1-e*e);return this.x=s*Math.cos(t),this.y=e,this.z=s*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const r1=new S,Uh=new Gr;class So{constructor(t=new S(1/0,1/0,1/0),e=new S(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e+=3)this.expandByPoint(Os.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,s=t.count;e<s;e++)this.expandByPoint(Os.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,s=t.length;e<s;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const s=Os.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(s),this.max.copy(t).add(s),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const s=t.geometry;if(s!==void 0){const n=s.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let r=0,a=n.count;r<a;r++)t.isMesh===!0?t.getVertexPosition(r,Os):Os.fromBufferAttribute(n,r),Os.applyMatrix4(t.matrixWorld),this.expandByPoint(Os);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),M0.copy(t.boundingBox)):(s.boundingBox===null&&s.computeBoundingBox(),M0.copy(s.boundingBox)),M0.applyMatrix4(t.matrixWorld),this.union(M0)}const i=t.children;for(let n=0,r=i.length;n<r;n++)this.expandByObject(i[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Os),Os.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,s;return t.normal.x>0?(e=t.normal.x*this.min.x,s=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,s=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,s+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,s+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,s+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,s+=t.normal.z*this.min.z),e<=-t.constant&&s>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Zr),A0.subVectors(this.max,Zr),Io.subVectors(t.a,Zr),Lo.subVectors(t.b,Zr),Uo.subVectors(t.c,Zr),sn.subVectors(Lo,Io),nn.subVectors(Uo,Lo),Wn.subVectors(Io,Uo);let e=[0,-sn.z,sn.y,0,-nn.z,nn.y,0,-Wn.z,Wn.y,sn.z,0,-sn.x,nn.z,0,-nn.x,Wn.z,0,-Wn.x,-sn.y,sn.x,0,-nn.y,nn.x,0,-Wn.y,Wn.x,0];return!a1(e,Io,Lo,Uo,A0)||(e=[1,0,0,0,1,0,0,0,1],!a1(e,Io,Lo,Uo,A0))?!1:(N0.crossVectors(sn,nn),e=[N0.x,N0.y,N0.z],a1(e,Io,Lo,Uo,A0))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Os).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Os).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(Ni[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),Ni[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),Ni[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),Ni[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),Ni[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),Ni[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),Ni[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),Ni[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(Ni),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const Ni=[new S,new S,new S,new S,new S,new S,new S,new S],Os=new S,M0=new So,Io=new S,Lo=new S,Uo=new S,sn=new S,nn=new S,Wn=new S,Zr=new S,A0=new S,N0=new S,$n=new S;function a1(o,t,e,s,i){for(let n=0,r=o.length-3;n<=r;n+=3){$n.fromArray(o,n);const a=i.x*Math.abs($n.x)+i.y*Math.abs($n.y)+i.z*Math.abs($n.z),c=t.dot($n),l=e.dot($n),u=s.dot($n);if(Math.max(-Math.max(c,l,u),Math.min(c,l,u))>a)return!1}return!0}const wf=new So,jr=new S,c1=new S;class Ln{constructor(t=new S,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const s=this.center;e!==void 0?s.copy(e):wf.setFromPoints(t).getCenter(s);let i=0;for(let n=0,r=t.length;n<r;n++)i=Math.max(i,s.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const s=this.center.distanceToSquared(t);return e.copy(t),s>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;jr.subVectors(t,this.center);const e=jr.lengthSq();if(e>this.radius*this.radius){const s=Math.sqrt(e),i=(s-this.radius)*.5;this.center.addScaledVector(jr,i/s),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(c1.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(jr.copy(t.center).add(c1)),this.expandByPoint(jr.copy(t.center).sub(c1))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ci=new S,l1=new S,C0=new S,on=new S,u1=new S,F0=new S,p1=new S;class Wp{constructor(t=new S,e=new S(0,0,-1)){this.origin=t,this.direction=e}set(t,e){return this.origin.copy(t),this.direction.copy(e),this}copy(t){return this.origin.copy(t.origin),this.direction.copy(t.direction),this}at(t,e){return e.copy(this.origin).addScaledVector(this.direction,t)}lookAt(t){return this.direction.copy(t).sub(this.origin).normalize(),this}recast(t){return this.origin.copy(this.at(t,Ci)),this}closestPointToPoint(t,e){e.subVectors(t,this.origin);const s=e.dot(this.direction);return s<0?e.copy(this.origin):e.copy(this.origin).addScaledVector(this.direction,s)}distanceToPoint(t){return Math.sqrt(this.distanceSqToPoint(t))}distanceSqToPoint(t){const e=Ci.subVectors(t,this.origin).dot(this.direction);return e<0?this.origin.distanceToSquared(t):(Ci.copy(this.origin).addScaledVector(this.direction,e),Ci.distanceToSquared(t))}distanceSqToSegment(t,e,s,i){l1.copy(t).add(e).multiplyScalar(.5),C0.copy(e).sub(t).normalize(),on.copy(this.origin).sub(l1);const n=t.distanceTo(e)*.5,r=-this.direction.dot(C0),a=on.dot(this.direction),c=-on.dot(C0),l=on.lengthSq(),u=Math.abs(1-r*r);let p,h,d,g;if(u>0)if(p=r*c-a,h=r*a-c,g=n*u,p>=0)if(h>=-g)if(h<=g){const f=1/u;p*=f,h*=f,d=p*(p+r*h+2*a)+h*(r*p+h+2*c)+l}else h=n,p=Math.max(0,-(r*h+a)),d=-p*p+h*(h+2*c)+l;else h=-n,p=Math.max(0,-(r*h+a)),d=-p*p+h*(h+2*c)+l;else h<=-g?(p=Math.max(0,-(-r*n+a)),h=p>0?-n:Math.min(Math.max(-n,-c),n),d=-p*p+h*(h+2*c)+l):h<=g?(p=0,h=Math.min(Math.max(-n,-c),n),d=h*(h+2*c)+l):(p=Math.max(0,-(r*n+a)),h=p>0?n:Math.min(Math.max(-n,-c),n),d=-p*p+h*(h+2*c)+l);else h=r>0?-n:n,p=Math.max(0,-(r*h+a)),d=-p*p+h*(h+2*c)+l;return s&&s.copy(this.origin).addScaledVector(this.direction,p),i&&i.copy(l1).addScaledVector(C0,h),d}intersectSphere(t,e){Ci.subVectors(t.center,this.origin);const s=Ci.dot(this.direction),i=Ci.dot(Ci)-s*s,n=t.radius*t.radius;if(i>n)return null;const r=Math.sqrt(n-i),a=s-r,c=s+r;return c<0?null:a<0?this.at(c,e):this.at(a,e)}intersectsSphere(t){return this.distanceSqToPoint(t.center)<=t.radius*t.radius}distanceToPlane(t){const e=t.normal.dot(this.direction);if(e===0)return t.distanceToPoint(this.origin)===0?0:null;const s=-(this.origin.dot(t.normal)+t.constant)/e;return s>=0?s:null}intersectPlane(t,e){const s=this.distanceToPlane(t);return s===null?null:this.at(s,e)}intersectsPlane(t){const e=t.distanceToPoint(this.origin);return e===0||t.normal.dot(this.direction)*e<0}intersectBox(t,e){let s,i,n,r,a,c;const l=1/this.direction.x,u=1/this.direction.y,p=1/this.direction.z,h=this.origin;return l>=0?(s=(t.min.x-h.x)*l,i=(t.max.x-h.x)*l):(s=(t.max.x-h.x)*l,i=(t.min.x-h.x)*l),u>=0?(n=(t.min.y-h.y)*u,r=(t.max.y-h.y)*u):(n=(t.max.y-h.y)*u,r=(t.min.y-h.y)*u),s>r||n>i||((n>s||isNaN(s))&&(s=n),(r<i||isNaN(i))&&(i=r),p>=0?(a=(t.min.z-h.z)*p,c=(t.max.z-h.z)*p):(a=(t.max.z-h.z)*p,c=(t.min.z-h.z)*p),s>c||a>i)||((a>s||s!==s)&&(s=a),(c<i||i!==i)&&(i=c),i<0)?null:this.at(s>=0?s:i,e)}intersectsBox(t){return this.intersectBox(t,Ci)!==null}intersectTriangle(t,e,s,i,n){u1.subVectors(e,t),F0.subVectors(s,t),p1.crossVectors(u1,F0);let r=this.direction.dot(p1),a;if(r>0){if(i)return null;a=1}else if(r<0)a=-1,r=-r;else return null;on.subVectors(this.origin,t);const c=a*this.direction.dot(F0.crossVectors(on,F0));if(c<0)return null;const l=a*this.direction.dot(u1.cross(on));if(l<0||c+l>r)return null;const u=-a*on.dot(p1);return u<0?null:this.at(u/r,n)}applyMatrix4(t){return this.origin.applyMatrix4(t),this.direction.transformDirection(t),this}equals(t){return t.origin.equals(this.origin)&&t.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class gt{constructor(t,e,s,i,n,r,a,c,l,u,p,h,d,g,f,m){gt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,s,i,n,r,a,c,l,u,p,h,d,g,f,m)}set(t,e,s,i,n,r,a,c,l,u,p,h,d,g,f,m){const x=this.elements;return x[0]=t,x[4]=e,x[8]=s,x[12]=i,x[1]=n,x[5]=r,x[9]=a,x[13]=c,x[2]=l,x[6]=u,x[10]=p,x[14]=h,x[3]=d,x[7]=g,x[11]=f,x[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new gt().fromArray(this.elements)}copy(t){const e=this.elements,s=t.elements;return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],this}copyPosition(t){const e=this.elements,s=t.elements;return e[12]=s[12],e[13]=s[13],e[14]=s[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,s){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),s.setFromMatrixColumn(this,2),this}makeBasis(t,e,s){return this.set(t.x,e.x,s.x,0,t.y,e.y,s.y,0,t.z,e.z,s.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,s=t.elements,i=1/zo.setFromMatrixColumn(t,0).length(),n=1/zo.setFromMatrixColumn(t,1).length(),r=1/zo.setFromMatrixColumn(t,2).length();return e[0]=s[0]*i,e[1]=s[1]*i,e[2]=s[2]*i,e[3]=0,e[4]=s[4]*n,e[5]=s[5]*n,e[6]=s[6]*n,e[7]=0,e[8]=s[8]*r,e[9]=s[9]*r,e[10]=s[10]*r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,s=t.x,i=t.y,n=t.z,r=Math.cos(s),a=Math.sin(s),c=Math.cos(i),l=Math.sin(i),u=Math.cos(n),p=Math.sin(n);if(t.order==="XYZ"){const h=r*u,d=r*p,g=a*u,f=a*p;e[0]=c*u,e[4]=-c*p,e[8]=l,e[1]=d+g*l,e[5]=h-f*l,e[9]=-a*c,e[2]=f-h*l,e[6]=g+d*l,e[10]=r*c}else if(t.order==="YXZ"){const h=c*u,d=c*p,g=l*u,f=l*p;e[0]=h+f*a,e[4]=g*a-d,e[8]=r*l,e[1]=r*p,e[5]=r*u,e[9]=-a,e[2]=d*a-g,e[6]=f+h*a,e[10]=r*c}else if(t.order==="ZXY"){const h=c*u,d=c*p,g=l*u,f=l*p;e[0]=h-f*a,e[4]=-r*p,e[8]=g+d*a,e[1]=d+g*a,e[5]=r*u,e[9]=f-h*a,e[2]=-r*l,e[6]=a,e[10]=r*c}else if(t.order==="ZYX"){const h=r*u,d=r*p,g=a*u,f=a*p;e[0]=c*u,e[4]=g*l-d,e[8]=h*l+f,e[1]=c*p,e[5]=f*l+h,e[9]=d*l-g,e[2]=-l,e[6]=a*c,e[10]=r*c}else if(t.order==="YZX"){const h=r*c,d=r*l,g=a*c,f=a*l;e[0]=c*u,e[4]=f-h*p,e[8]=g*p+d,e[1]=p,e[5]=r*u,e[9]=-a*u,e[2]=-l*u,e[6]=d*p+g,e[10]=h-f*p}else if(t.order==="XZY"){const h=r*c,d=r*l,g=a*c,f=a*l;e[0]=c*u,e[4]=-p,e[8]=l*u,e[1]=h*p+f,e[5]=r*u,e[9]=d*p-g,e[2]=g*p-d,e[6]=a*u,e[10]=f*p+h}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(bf,t,vf)}lookAt(t,e,s){const i=this.elements;return ys.subVectors(t,e),ys.lengthSq()===0&&(ys.z=1),ys.normalize(),rn.crossVectors(s,ys),rn.lengthSq()===0&&(Math.abs(s.z)===1?ys.x+=1e-4:ys.z+=1e-4,ys.normalize(),rn.crossVectors(s,ys)),rn.normalize(),R0.crossVectors(ys,rn),i[0]=rn.x,i[4]=R0.x,i[8]=ys.x,i[1]=rn.y,i[5]=R0.y,i[9]=ys.y,i[2]=rn.z,i[6]=R0.z,i[10]=ys.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const s=t.elements,i=e.elements,n=this.elements,r=s[0],a=s[4],c=s[8],l=s[12],u=s[1],p=s[5],h=s[9],d=s[13],g=s[2],f=s[6],m=s[10],x=s[14],w=s[3],b=s[7],v=s[11],T=s[15],M=i[0],F=i[4],N=i[8],A=i[12],E=i[1],U=i[5],$=i[9],Z=i[13],j=i[2],ut=i[6],nt=i[10],Ue=i[14],_e=i[3],It=i[7],se=i[11],_t=i[15];return n[0]=r*M+a*E+c*j+l*_e,n[4]=r*F+a*U+c*ut+l*It,n[8]=r*N+a*$+c*nt+l*se,n[12]=r*A+a*Z+c*Ue+l*_t,n[1]=u*M+p*E+h*j+d*_e,n[5]=u*F+p*U+h*ut+d*It,n[9]=u*N+p*$+h*nt+d*se,n[13]=u*A+p*Z+h*Ue+d*_t,n[2]=g*M+f*E+m*j+x*_e,n[6]=g*F+f*U+m*ut+x*It,n[10]=g*N+f*$+m*nt+x*se,n[14]=g*A+f*Z+m*Ue+x*_t,n[3]=w*M+b*E+v*j+T*_e,n[7]=w*F+b*U+v*ut+T*It,n[11]=w*N+b*$+v*nt+T*se,n[15]=w*A+b*Z+v*Ue+T*_t,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],s=t[4],i=t[8],n=t[12],r=t[1],a=t[5],c=t[9],l=t[13],u=t[2],p=t[6],h=t[10],d=t[14],g=t[3],f=t[7],m=t[11],x=t[15];return g*(+n*c*p-i*l*p-n*a*h+s*l*h+i*a*d-s*c*d)+f*(+e*c*d-e*l*h+n*r*h-i*r*d+i*l*u-n*c*u)+m*(+e*l*p-e*a*d-n*r*p+s*r*d+n*a*u-s*l*u)+x*(-i*a*u-e*c*p+e*a*h+i*r*p-s*r*h+s*c*u)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,s){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=s),this}invert(){const t=this.elements,e=t[0],s=t[1],i=t[2],n=t[3],r=t[4],a=t[5],c=t[6],l=t[7],u=t[8],p=t[9],h=t[10],d=t[11],g=t[12],f=t[13],m=t[14],x=t[15],w=p*m*l-f*h*l+f*c*d-a*m*d-p*c*x+a*h*x,b=g*h*l-u*m*l-g*c*d+r*m*d+u*c*x-r*h*x,v=u*f*l-g*p*l+g*a*d-r*f*d-u*a*x+r*p*x,T=g*p*c-u*f*c-g*a*h+r*f*h+u*a*m-r*p*m,M=e*w+s*b+i*v+n*T;if(M===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/M;return t[0]=w*F,t[1]=(f*h*n-p*m*n-f*i*d+s*m*d+p*i*x-s*h*x)*F,t[2]=(a*m*n-f*c*n+f*i*l-s*m*l-a*i*x+s*c*x)*F,t[3]=(p*c*n-a*h*n-p*i*l+s*h*l+a*i*d-s*c*d)*F,t[4]=b*F,t[5]=(u*m*n-g*h*n+g*i*d-e*m*d-u*i*x+e*h*x)*F,t[6]=(g*c*n-r*m*n-g*i*l+e*m*l+r*i*x-e*c*x)*F,t[7]=(r*h*n-u*c*n+u*i*l-e*h*l-r*i*d+e*c*d)*F,t[8]=v*F,t[9]=(g*p*n-u*f*n-g*s*d+e*f*d+u*s*x-e*p*x)*F,t[10]=(r*f*n-g*a*n+g*s*l-e*f*l-r*s*x+e*a*x)*F,t[11]=(u*a*n-r*p*n-u*s*l+e*p*l+r*s*d-e*a*d)*F,t[12]=T*F,t[13]=(u*f*i-g*p*i+g*s*h-e*f*h-u*s*m+e*p*m)*F,t[14]=(g*a*i-r*f*i-g*s*c+e*f*c+r*s*m-e*a*m)*F,t[15]=(r*p*i-u*a*i+u*s*c-e*p*c-r*s*h+e*a*h)*F,this}scale(t){const e=this.elements,s=t.x,i=t.y,n=t.z;return e[0]*=s,e[4]*=i,e[8]*=n,e[1]*=s,e[5]*=i,e[9]*=n,e[2]*=s,e[6]*=i,e[10]*=n,e[3]*=s,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],s=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,s,i))}makeTranslation(t,e,s){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,s,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),s=Math.sin(t);return this.set(1,0,0,0,0,e,-s,0,0,s,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,0,s,0,0,1,0,0,-s,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),s=Math.sin(t);return this.set(e,-s,0,0,s,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const s=Math.cos(e),i=Math.sin(e),n=1-s,r=t.x,a=t.y,c=t.z,l=n*r,u=n*a;return this.set(l*r+s,l*a-i*c,l*c+i*a,0,l*a+i*c,u*a+s,u*c-i*r,0,l*c-i*a,u*c+i*r,n*c*c+s,0,0,0,0,1),this}makeScale(t,e,s){return this.set(t,0,0,0,0,e,0,0,0,0,s,0,0,0,0,1),this}makeShear(t,e,s,i,n,r){return this.set(1,s,n,0,t,1,r,0,e,i,1,0,0,0,0,1),this}compose(t,e,s){const i=this.elements,n=e._x,r=e._y,a=e._z,c=e._w,l=n+n,u=r+r,p=a+a,h=n*l,d=n*u,g=n*p,f=r*u,m=r*p,x=a*p,w=c*l,b=c*u,v=c*p,T=s.x,M=s.y,F=s.z;return i[0]=(1-(f+x))*T,i[1]=(d+v)*T,i[2]=(g-b)*T,i[3]=0,i[4]=(d-v)*M,i[5]=(1-(h+x))*M,i[6]=(m+w)*M,i[7]=0,i[8]=(g+b)*F,i[9]=(m-w)*F,i[10]=(1-(h+f))*F,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,s){const i=this.elements;let n=zo.set(i[0],i[1],i[2]).length();const r=zo.set(i[4],i[5],i[6]).length(),a=zo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],Ws.copy(this);const l=1/n,u=1/r,p=1/a;return Ws.elements[0]*=l,Ws.elements[1]*=l,Ws.elements[2]*=l,Ws.elements[4]*=u,Ws.elements[5]*=u,Ws.elements[6]*=u,Ws.elements[8]*=p,Ws.elements[9]*=p,Ws.elements[10]*=p,e.setFromRotationMatrix(Ws),s.x=n,s.y=r,s.z=a,this}makePerspective(t,e,s,i,n,r,a=js){const c=this.elements,l=2*n/(e-t),u=2*n/(s-i),p=(e+t)/(e-t),h=(s+i)/(s-i);let d,g;if(a===js)d=-(r+n)/(r-n),g=-2*r*n/(r-n);else if(a===Xi)d=-r/(r-n),g=-r*n/(r-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+a);return c[0]=l,c[4]=0,c[8]=p,c[12]=0,c[1]=0,c[5]=u,c[9]=h,c[13]=0,c[2]=0,c[6]=0,c[10]=d,c[14]=g,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(t,e,s,i,n,r,a=js){const c=this.elements,l=1/(e-t),u=1/(s-i),p=1/(r-n),h=(e+t)*l,d=(s+i)*u;let g,f;if(a===js)g=(r+n)*p,f=-2*p;else if(a===Xi)g=n*p,f=-1*p;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+a);return c[0]=2*l,c[4]=0,c[8]=0,c[12]=-h,c[1]=0,c[5]=2*u,c[9]=0,c[13]=-d,c[2]=0,c[6]=0,c[10]=f,c[14]=-g,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(t){const e=this.elements,s=t.elements;for(let i=0;i<16;i++)if(e[i]!==s[i])return!1;return!0}fromArray(t,e=0){for(let s=0;s<16;s++)this.elements[s]=t[s+e];return this}toArray(t=[],e=0){const s=this.elements;return t[e]=s[0],t[e+1]=s[1],t[e+2]=s[2],t[e+3]=s[3],t[e+4]=s[4],t[e+5]=s[5],t[e+6]=s[6],t[e+7]=s[7],t[e+8]=s[8],t[e+9]=s[9],t[e+10]=s[10],t[e+11]=s[11],t[e+12]=s[12],t[e+13]=s[13],t[e+14]=s[14],t[e+15]=s[15],t}}const zo=new S,Ws=new gt,bf=new S(0,0,0),vf=new S(1,1,1),rn=new S,R0=new S,ys=new S,zh=new gt,kh=new Gr;class As{constructor(t=0,e=0,s=0,i=As.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=s,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,s,i=this._order){return this._x=t,this._y=e,this._z=s,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,s=!0){const i=t.elements,n=i[0],r=i[4],a=i[8],c=i[1],l=i[5],u=i[9],p=i[2],h=i[6],d=i[10];switch(e){case"XYZ":this._y=Math.asin(dt(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-u,d),this._z=Math.atan2(-r,n)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-dt(u,-1,1)),Math.abs(u)<.9999999?(this._y=Math.atan2(a,d),this._z=Math.atan2(c,l)):(this._y=Math.atan2(-p,n),this._z=0);break;case"ZXY":this._x=Math.asin(dt(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-p,d),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(c,n));break;case"ZYX":this._y=Math.asin(-dt(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(h,d),this._z=Math.atan2(c,n)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(dt(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-u,l),this._y=Math.atan2(-p,n)):(this._x=0,this._y=Math.atan2(a,d));break;case"XZY":this._z=Math.asin(-dt(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(a,n)):(this._x=Math.atan2(-u,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,s===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,s){return zh.makeRotationFromQuaternion(t),this.setFromRotationMatrix(zh,e,s)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return kh.setFromEuler(this),this.setFromQuaternion(kh,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}As.DEFAULT_ORDER="XYZ";class S4{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let _f=0;const Vh=new S,ko=new Gr,Fi=new gt,E0=new S,Kr=new S,Sf=new S,Tf=new Gr,Gh=new S(1,0,0),Oh=new S(0,1,0),Wh=new S(0,0,1),$h={type:"added"},Mf={type:"removed"},Vo={type:"childadded",child:null},h1={type:"childremoved",child:null};class Xt extends Pn{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:_f++}),this.uuid=di(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Xt.DEFAULT_UP.clone();const t=new S,e=new As,s=new Gr,i=new S(1,1,1);function n(){s.setFromEuler(e,!1)}function r(){e.setFromQuaternion(s,void 0,!1)}e._onChange(n),s._onChange(r),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:s},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new gt},normalMatrix:{value:new gs}}),this.matrix=new gt,this.matrixWorld=new gt,this.matrixAutoUpdate=Xt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Xt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new S4,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return ko.setFromAxisAngle(t,e),this.quaternion.multiply(ko),this}rotateOnWorldAxis(t,e){return ko.setFromAxisAngle(t,e),this.quaternion.premultiply(ko),this}rotateX(t){return this.rotateOnAxis(Gh,t)}rotateY(t){return this.rotateOnAxis(Oh,t)}rotateZ(t){return this.rotateOnAxis(Wh,t)}translateOnAxis(t,e){return Vh.copy(t).applyQuaternion(this.quaternion),this.position.add(Vh.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(Gh,t)}translateY(t){return this.translateOnAxis(Oh,t)}translateZ(t){return this.translateOnAxis(Wh,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Fi.copy(this.matrixWorld).invert())}lookAt(t,e,s){t.isVector3?E0.copy(t):E0.set(t,e,s);const i=this.parent;this.updateWorldMatrix(!0,!1),Kr.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Fi.lookAt(Kr,E0,this.up):Fi.lookAt(E0,Kr,this.up),this.quaternion.setFromRotationMatrix(Fi),i&&(Fi.extractRotation(i.matrixWorld),ko.setFromRotationMatrix(Fi),this.quaternion.premultiply(ko.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent($h),Vo.child=t,this.dispatchEvent(Vo),Vo.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let s=0;s<arguments.length;s++)this.remove(arguments[s]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(Mf),h1.child=t,this.dispatchEvent(h1),h1.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Fi.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Fi.multiply(t.parent.matrixWorld)),t.applyMatrix4(Fi),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent($h),Vo.child=t,this.dispatchEvent(Vo),Vo.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let s=0,i=this.children.length;s<i;s++){const r=this.children[s].getObjectByProperty(t,e);if(r!==void 0)return r}}getObjectsByProperty(t,e,s=[]){this[t]===e&&s.push(this);const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].getObjectsByProperty(t,e,s);return s}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kr,t,Sf),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kr,Tf,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let s=0,i=e.length;s<i;s++)e[s].updateMatrixWorld(t)}updateWorldMatrix(t,e){const s=this.parent;if(t===!0&&s!==null&&s.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let n=0,r=i.length;n<r;n++)i[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",s={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},s.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(a=>({boxInitialized:a.boxInitialized,boxMin:a.box.min.toArray(),boxMax:a.box.max.toArray(),sphereInitialized:a.sphereInitialized,sphereRadius:a.sphere.radius,sphereCenter:a.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function n(a,c){return a[c.uuid]===void 0&&(a[c.uuid]=c.toJSON(t)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const a=this.geometry.parameters;if(a!==void 0&&a.shapes!==void 0){const c=a.shapes;if(Array.isArray(c))for(let l=0,u=c.length;l<u;l++){const p=c[l];n(t.shapes,p)}else n(t.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const a=[];for(let c=0,l=this.material.length;c<l;c++)a.push(n(t.materials,this.material[c]));i.material=a}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let a=0;a<this.children.length;a++)i.children.push(this.children[a].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let a=0;a<this.animations.length;a++){const c=this.animations[a];i.animations.push(n(t.animations,c))}}if(e){const a=r(t.geometries),c=r(t.materials),l=r(t.textures),u=r(t.images),p=r(t.shapes),h=r(t.skeletons),d=r(t.animations),g=r(t.nodes);a.length>0&&(s.geometries=a),c.length>0&&(s.materials=c),l.length>0&&(s.textures=l),u.length>0&&(s.images=u),p.length>0&&(s.shapes=p),h.length>0&&(s.skeletons=h),d.length>0&&(s.animations=d),g.length>0&&(s.nodes=g)}return s.object=i,s;function r(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let s=0;s<t.children.length;s++){const i=t.children[s];this.add(i.clone())}return this}}Xt.DEFAULT_UP=new S(0,1,0);Xt.DEFAULT_MATRIX_AUTO_UPDATE=!0;Xt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const $s=new S,Ri=new S,d1=new S,Ei=new S,Go=new S,Oo=new S,Hh=new S,g1=new S,f1=new S,m1=new S,y1=new vt,x1=new vt,w1=new vt;class Xs{constructor(t=new S,e=new S,s=new S){this.a=t,this.b=e,this.c=s}static getNormal(t,e,s,i){i.subVectors(s,e),$s.subVectors(t,e),i.cross($s);const n=i.lengthSq();return n>0?i.multiplyScalar(1/Math.sqrt(n)):i.set(0,0,0)}static getBarycoord(t,e,s,i,n){$s.subVectors(i,e),Ri.subVectors(s,e),d1.subVectors(t,e);const r=$s.dot($s),a=$s.dot(Ri),c=$s.dot(d1),l=Ri.dot(Ri),u=Ri.dot(d1),p=r*l-a*a;if(p===0)return n.set(0,0,0),null;const h=1/p,d=(l*c-a*u)*h,g=(r*u-a*c)*h;return n.set(1-d-g,g,d)}static containsPoint(t,e,s,i){return this.getBarycoord(t,e,s,i,Ei)===null?!1:Ei.x>=0&&Ei.y>=0&&Ei.x+Ei.y<=1}static getInterpolation(t,e,s,i,n,r,a,c){return this.getBarycoord(t,e,s,i,Ei)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(n,Ei.x),c.addScaledVector(r,Ei.y),c.addScaledVector(a,Ei.z),c)}static getInterpolatedAttribute(t,e,s,i,n,r){return y1.setScalar(0),x1.setScalar(0),w1.setScalar(0),y1.fromBufferAttribute(t,e),x1.fromBufferAttribute(t,s),w1.fromBufferAttribute(t,i),r.setScalar(0),r.addScaledVector(y1,n.x),r.addScaledVector(x1,n.y),r.addScaledVector(w1,n.z),r}static isFrontFacing(t,e,s,i){return $s.subVectors(s,e),Ri.subVectors(t,e),$s.cross(Ri).dot(i)<0}set(t,e,s){return this.a.copy(t),this.b.copy(e),this.c.copy(s),this}setFromPointsAndIndices(t,e,s,i){return this.a.copy(t[e]),this.b.copy(t[s]),this.c.copy(t[i]),this}setFromAttributeAndIndices(t,e,s,i){return this.a.fromBufferAttribute(t,e),this.b.fromBufferAttribute(t,s),this.c.fromBufferAttribute(t,i),this}clone(){return new this.constructor().copy(this)}copy(t){return this.a.copy(t.a),this.b.copy(t.b),this.c.copy(t.c),this}getArea(){return $s.subVectors(this.c,this.b),Ri.subVectors(this.a,this.b),$s.cross(Ri).length()*.5}getMidpoint(t){return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(t){return Xs.getNormal(this.a,this.b,this.c,t)}getPlane(t){return t.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(t,e){return Xs.getBarycoord(t,this.a,this.b,this.c,e)}getInterpolation(t,e,s,i,n){return Xs.getInterpolation(t,this.a,this.b,this.c,e,s,i,n)}containsPoint(t){return Xs.containsPoint(t,this.a,this.b,this.c)}isFrontFacing(t){return Xs.isFrontFacing(this.a,this.b,this.c,t)}intersectsBox(t){return t.intersectsTriangle(this)}closestPointToPoint(t,e){const s=this.a,i=this.b,n=this.c;let r,a;Go.subVectors(i,s),Oo.subVectors(n,s),g1.subVectors(t,s);const c=Go.dot(g1),l=Oo.dot(g1);if(c<=0&&l<=0)return e.copy(s);f1.subVectors(t,i);const u=Go.dot(f1),p=Oo.dot(f1);if(u>=0&&p<=u)return e.copy(i);const h=c*p-u*l;if(h<=0&&c>=0&&u<=0)return r=c/(c-u),e.copy(s).addScaledVector(Go,r);m1.subVectors(t,n);const d=Go.dot(m1),g=Oo.dot(m1);if(g>=0&&d<=g)return e.copy(n);const f=d*l-c*g;if(f<=0&&l>=0&&g<=0)return a=l/(l-g),e.copy(s).addScaledVector(Oo,a);const m=u*g-d*p;if(m<=0&&p-u>=0&&d-g>=0)return Hh.subVectors(n,i),a=(p-u)/(p-u+(d-g)),e.copy(i).addScaledVector(Hh,a);const x=1/(m+f+h);return r=f*x,a=h*x,e.copy(s).addScaledVector(Go,r).addScaledVector(Oo,a)}equals(t){return t.a.equals(this.a)&&t.b.equals(this.b)&&t.c.equals(this.c)}}const T4={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},an={h:0,s:0,l:0},D0={h:0,s:0,l:0};function b1(o,t,e){return e<0&&(e+=1),e>1&&(e-=1),e<1/6?o+(t-o)*6*e:e<1/2?t:e<2/3?o+(t-o)*6*(2/3-e):o}class W{constructor(t,e,s){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(t,e,s)}set(t,e,s){if(e===void 0&&s===void 0){const i=t;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(t,e,s);return this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,e=et){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(t&255)/255,he.toWorkingColorSpace(this,e),this}setRGB(t,e,s,i=he.workingColorSpace){return this.r=t,this.g=e,this.b=s,he.toWorkingColorSpace(this,i),this}setHSL(t,e,s,i=he.workingColorSpace){if(t=Op(t,1),e=dt(e,0,1),s=dt(s,0,1),e===0)this.r=this.g=this.b=s;else{const n=s<=.5?s*(1+e):s+e-s*e,r=2*s-n;this.r=b1(r,n,t+1/3),this.g=b1(r,n,t),this.b=b1(r,n,t-1/3)}return he.toWorkingColorSpace(this,i),this}setStyle(t,e=et){function s(n){n!==void 0&&parseFloat(n)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(t)){let n;const r=i[1],a=i[2];switch(r){case"rgb":case"rgba":if(n=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(255,parseInt(n[1],10))/255,Math.min(255,parseInt(n[2],10))/255,Math.min(255,parseInt(n[3],10))/255,e);if(n=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setRGB(Math.min(100,parseInt(n[1],10))/100,Math.min(100,parseInt(n[2],10))/100,Math.min(100,parseInt(n[3],10))/100,e);break;case"hsl":case"hsla":if(n=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return s(n[4]),this.setHSL(parseFloat(n[1])/360,parseFloat(n[2])/100,parseFloat(n[3])/100,e);break;default:console.warn("THREE.Color: Unknown color model "+t)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(t)){const n=i[1],r=n.length;if(r===3)return this.setRGB(parseInt(n.charAt(0),16)/15,parseInt(n.charAt(1),16)/15,parseInt(n.charAt(2),16)/15,e);if(r===6)return this.setHex(parseInt(n,16),e);console.warn("THREE.Color: Invalid hex color "+t)}else if(t&&t.length>0)return this.setColorName(t,e);return this}setColorName(t,e=et){const s=T4[t.toLowerCase()];return s!==void 0?this.setHex(s,e):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Wi(t.r),this.g=Wi(t.g),this.b=Wi(t.b),this}copyLinearToSRGB(t){return this.r=Mr(t.r),this.g=Mr(t.g),this.b=Mr(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=et){return he.fromWorkingColorSpace(ke.copy(this),t),Math.round(dt(ke.r*255,0,255))*65536+Math.round(dt(ke.g*255,0,255))*256+Math.round(dt(ke.b*255,0,255))}getHexString(t=et){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,e=he.workingColorSpace){he.fromWorkingColorSpace(ke.copy(this),e);const s=ke.r,i=ke.g,n=ke.b,r=Math.max(s,i,n),a=Math.min(s,i,n);let c,l;const u=(a+r)/2;if(a===r)c=0,l=0;else{const p=r-a;switch(l=u<=.5?p/(r+a):p/(2-r-a),r){case s:c=(i-n)/p+(i<n?6:0);break;case i:c=(n-s)/p+2;break;case n:c=(s-i)/p+4;break}c/=6}return t.h=c,t.s=l,t.l=u,t}getRGB(t,e=he.workingColorSpace){return he.fromWorkingColorSpace(ke.copy(this),e),t.r=ke.r,t.g=ke.g,t.b=ke.b,t}getStyle(t=et){he.fromWorkingColorSpace(ke.copy(this),t);const e=ke.r,s=ke.g,i=ke.b;return t!==et?`color(${t} ${e.toFixed(3)} ${s.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(e*255)},${Math.round(s*255)},${Math.round(i*255)})`}offsetHSL(t,e,s){return this.getHSL(an),this.setHSL(an.h+t,an.s+e,an.l+s)}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,e){return this.r=t.r+e.r,this.g=t.g+e.g,this.b=t.b+e.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,e){return this.r+=(t.r-this.r)*e,this.g+=(t.g-this.g)*e,this.b+=(t.b-this.b)*e,this}lerpColors(t,e,s){return this.r=t.r+(e.r-t.r)*s,this.g=t.g+(e.g-t.g)*s,this.b=t.b+(e.b-t.b)*s,this}lerpHSL(t,e){this.getHSL(an),t.getHSL(D0);const s=Ma(an.h,D0.h,e),i=Ma(an.s,D0.s,e),n=Ma(an.l,D0.l,e);return this.setHSL(s,i,n),this}setFromVector3(t){return this.r=t.x,this.g=t.y,this.b=t.z,this}applyMatrix3(t){const e=this.r,s=this.g,i=this.b,n=t.elements;return this.r=n[0]*e+n[3]*s+n[6]*i,this.g=n[1]*e+n[4]*s+n[7]*i,this.b=n[2]*e+n[5]*s+n[8]*i,this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,e=0){return this.r=t[e],this.g=t[e+1],this.b=t[e+2],this}toArray(t=[],e=0){return t[e]=this.r,t[e+1]=this.g,t[e+2]=this.b,t}fromBufferAttribute(t,e){return this.r=t.getX(e),this.g=t.getY(e),this.b=t.getZ(e),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const ke=new W;W.NAMES=T4;let Af=0;class us extends Pn{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Af++}),this.uuid=di(),this.name="",this.type="Material",this.blending=Tn,this.side=go,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Wc,this.blendDst=$c,this.blendEquation=mn,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new W(0,0,0),this.blendAlpha=0,this.depthFunc=Hc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Yu,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Kn,this.stencilZFail=Kn,this.stencilZPass=Kn,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(t){this._alphaTest>0!=t>0&&this.version++,this._alphaTest=t}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(t){if(t!==void 0)for(const e in t){const s=t[e];if(s===void 0){console.warn(`THREE.Material: parameter '${e}' has value of undefined.`);continue}const i=this[e];if(i===void 0){console.warn(`THREE.Material: '${e}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(s):i&&i.isVector3&&s&&s.isVector3?i.copy(s):this[e]=s}}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{}});const s={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.color&&this.color.isColor&&(s.color=this.color.getHex()),this.roughness!==void 0&&(s.roughness=this.roughness),this.metalness!==void 0&&(s.metalness=this.metalness),this.sheen!==void 0&&(s.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(s.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(s.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(s.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(s.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(s.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(s.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(s.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(s.shininess=this.shininess),this.clearcoat!==void 0&&(s.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(s.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(s.clearcoatMap=this.clearcoatMap.toJSON(t).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(s.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(t).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(s.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(t).uuid,s.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(s.dispersion=this.dispersion),this.iridescence!==void 0&&(s.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(s.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(s.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(s.iridescenceMap=this.iridescenceMap.toJSON(t).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(s.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(t).uuid),this.anisotropy!==void 0&&(s.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(s.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(s.anisotropyMap=this.anisotropyMap.toJSON(t).uuid),this.map&&this.map.isTexture&&(s.map=this.map.toJSON(t).uuid),this.matcap&&this.matcap.isTexture&&(s.matcap=this.matcap.toJSON(t).uuid),this.alphaMap&&this.alphaMap.isTexture&&(s.alphaMap=this.alphaMap.toJSON(t).uuid),this.lightMap&&this.lightMap.isTexture&&(s.lightMap=this.lightMap.toJSON(t).uuid,s.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(s.aoMap=this.aoMap.toJSON(t).uuid,s.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(s.bumpMap=this.bumpMap.toJSON(t).uuid,s.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(s.normalMap=this.normalMap.toJSON(t).uuid,s.normalMapType=this.normalMapType,s.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(s.displacementMap=this.displacementMap.toJSON(t).uuid,s.displacementScale=this.displacementScale,s.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(s.roughnessMap=this.roughnessMap.toJSON(t).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(s.metalnessMap=this.metalnessMap.toJSON(t).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(s.emissiveMap=this.emissiveMap.toJSON(t).uuid),this.specularMap&&this.specularMap.isTexture&&(s.specularMap=this.specularMap.toJSON(t).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(s.specularIntensityMap=this.specularIntensityMap.toJSON(t).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(s.specularColorMap=this.specularColorMap.toJSON(t).uuid),this.envMap&&this.envMap.isTexture&&(s.envMap=this.envMap.toJSON(t).uuid,this.combine!==void 0&&(s.combine=this.combine)),this.envMapRotation!==void 0&&(s.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(s.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(s.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(s.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(s.gradientMap=this.gradientMap.toJSON(t).uuid),this.transmission!==void 0&&(s.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(s.transmissionMap=this.transmissionMap.toJSON(t).uuid),this.thickness!==void 0&&(s.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(s.thicknessMap=this.thicknessMap.toJSON(t).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(s.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(s.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(s.size=this.size),this.shadowSide!==null&&(s.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(s.sizeAttenuation=this.sizeAttenuation),this.blending!==Tn&&(s.blending=this.blending),this.side!==go&&(s.side=this.side),this.vertexColors===!0&&(s.vertexColors=!0),this.opacity<1&&(s.opacity=this.opacity),this.transparent===!0&&(s.transparent=!0),this.blendSrc!==Wc&&(s.blendSrc=this.blendSrc),this.blendDst!==$c&&(s.blendDst=this.blendDst),this.blendEquation!==mn&&(s.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(s.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(s.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(s.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(s.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(s.blendAlpha=this.blendAlpha),this.depthFunc!==Hc&&(s.depthFunc=this.depthFunc),this.depthTest===!1&&(s.depthTest=this.depthTest),this.depthWrite===!1&&(s.depthWrite=this.depthWrite),this.colorWrite===!1&&(s.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(s.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Yu&&(s.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(s.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(s.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Kn&&(s.stencilFail=this.stencilFail),this.stencilZFail!==Kn&&(s.stencilZFail=this.stencilZFail),this.stencilZPass!==Kn&&(s.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(s.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(s.rotation=this.rotation),this.polygonOffset===!0&&(s.polygonOffset=!0),this.polygonOffsetFactor!==0&&(s.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(s.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(s.linewidth=this.linewidth),this.dashSize!==void 0&&(s.dashSize=this.dashSize),this.gapSize!==void 0&&(s.gapSize=this.gapSize),this.scale!==void 0&&(s.scale=this.scale),this.dithering===!0&&(s.dithering=!0),this.alphaTest>0&&(s.alphaTest=this.alphaTest),this.alphaHash===!0&&(s.alphaHash=!0),this.alphaToCoverage===!0&&(s.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(s.premultipliedAlpha=!0),this.forceSinglePass===!0&&(s.forceSinglePass=!0),this.wireframe===!0&&(s.wireframe=!0),this.wireframeLinewidth>1&&(s.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(s.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(s.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(s.flatShading=!0),this.visible===!1&&(s.visible=!1),this.toneMapped===!1&&(s.toneMapped=!1),this.fog===!1&&(s.fog=!1),Object.keys(this.userData).length>0&&(s.userData=this.userData);function i(n){const r=[];for(const a in n){const c=n[a];delete c.metadata,r.push(c)}return r}if(e){const n=i(t.textures),r=i(t.images);n.length>0&&(s.textures=n),r.length>0&&(s.images=r)}return s}clone(){return new this.constructor().copy(this)}copy(t){this.name=t.name,this.blending=t.blending,this.side=t.side,this.vertexColors=t.vertexColors,this.opacity=t.opacity,this.transparent=t.transparent,this.blendSrc=t.blendSrc,this.blendDst=t.blendDst,this.blendEquation=t.blendEquation,this.blendSrcAlpha=t.blendSrcAlpha,this.blendDstAlpha=t.blendDstAlpha,this.blendEquationAlpha=t.blendEquationAlpha,this.blendColor.copy(t.blendColor),this.blendAlpha=t.blendAlpha,this.depthFunc=t.depthFunc,this.depthTest=t.depthTest,this.depthWrite=t.depthWrite,this.stencilWriteMask=t.stencilWriteMask,this.stencilFunc=t.stencilFunc,this.stencilRef=t.stencilRef,this.stencilFuncMask=t.stencilFuncMask,this.stencilFail=t.stencilFail,this.stencilZFail=t.stencilZFail,this.stencilZPass=t.stencilZPass,this.stencilWrite=t.stencilWrite;const e=t.clippingPlanes;let s=null;if(e!==null){const i=e.length;s=new Array(i);for(let n=0;n!==i;++n)s[n]=e[n].clone()}return this.clippingPlanes=s,this.clipIntersection=t.clipIntersection,this.clipShadows=t.clipShadows,this.shadowSide=t.shadowSide,this.colorWrite=t.colorWrite,this.precision=t.precision,this.polygonOffset=t.polygonOffset,this.polygonOffsetFactor=t.polygonOffsetFactor,this.polygonOffsetUnits=t.polygonOffsetUnits,this.dithering=t.dithering,this.alphaTest=t.alphaTest,this.alphaHash=t.alphaHash,this.alphaToCoverage=t.alphaToCoverage,this.premultipliedAlpha=t.premultipliedAlpha,this.forceSinglePass=t.forceSinglePass,this.visible=t.visible,this.toneMapped=t.toneMapped,this.userData=JSON.parse(JSON.stringify(t.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class gi extends us{constructor(t){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new As,this.combine=bl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}const Li=Nf();function Nf(){const o=new ArrayBuffer(4),t=new Float32Array(o),e=new Uint32Array(o),s=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const l=c-127;l<-27?(s[c]=0,s[c|256]=32768,i[c]=24,i[c|256]=24):l<-14?(s[c]=1024>>-l-14,s[c|256]=1024>>-l-14|32768,i[c]=-l-1,i[c|256]=-l-1):l<=15?(s[c]=l+15<<10,s[c|256]=l+15<<10|32768,i[c]=13,i[c|256]=13):l<128?(s[c]=31744,s[c|256]=64512,i[c]=24,i[c|256]=24):(s[c]=31744,s[c|256]=64512,i[c]=13,i[c|256]=13)}const n=new Uint32Array(2048),r=new Uint32Array(64),a=new Uint32Array(64);for(let c=1;c<1024;++c){let l=c<<13,u=0;for(;(l&8388608)===0;)l<<=1,u-=8388608;l&=-8388609,u+=947912704,n[c]=l|u}for(let c=1024;c<2048;++c)n[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)r[c]=c<<23;r[31]=1199570944,r[32]=2147483648;for(let c=33;c<63;++c)r[c]=2147483648+(c-32<<23);r[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(a[c]=1024);return{floatView:t,uint32View:e,baseTable:s,shiftTable:i,mantissaTable:n,exponentTable:r,offsetTable:a}}function xs(o){Math.abs(o)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),o=dt(o,-65504,65504),Li.floatView[0]=o;const t=Li.uint32View[0],e=t>>23&511;return Li.baseTable[e]+((t&8388607)>>Li.shiftTable[e])}function B0(o){const t=o>>10;return Li.uint32View[0]=Li.mantissaTable[Li.offsetTable[t]+(o&1023)]+Li.exponentTable[t],Li.floatView[0]}const me=new S,P0=new Y;class it{constructor(t,e,s=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=s,this.usage=qc,this.updateRanges=[],this.gpuType=ns,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,s){t*=this.itemSize,s*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[s+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,s=this.count;e<s;e++)P0.fromBufferAttribute(this,e),P0.applyMatrix3(t),this.setXY(e,P0.x,P0.y);else if(this.itemSize===3)for(let e=0,s=this.count;e<s;e++)me.fromBufferAttribute(this,e),me.applyMatrix3(t),this.setXYZ(e,me.x,me.y,me.z);return this}applyMatrix4(t){for(let e=0,s=this.count;e<s;e++)me.fromBufferAttribute(this,e),me.applyMatrix4(t),this.setXYZ(e,me.x,me.y,me.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)me.fromBufferAttribute(this,e),me.applyNormalMatrix(t),this.setXYZ(e,me.x,me.y,me.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)me.fromBufferAttribute(this,e),me.transformDirection(t),this.setXYZ(e,me.x,me.y,me.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let s=this.array[t*this.itemSize+e];return this.normalized&&(s=je(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=ht(s,this.array)),this.array[t*this.itemSize+e]=s,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=je(e,this.array)),e}setX(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=je(e,this.array)),e}setY(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=je(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=je(e,this.array)),e}setW(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array)),this.array[t+0]=e,this.array[t+1]=s,this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array),n=ht(n,this.array)),this.array[t+0]=e,this.array[t+1]=s,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==qc&&(t.usage=this.usage),t}}class M4 extends it{constructor(t,e,s){super(new Uint16Array(t),e,s)}}class A4 extends it{constructor(t,e,s){super(new Uint32Array(t),e,s)}}class N4 extends it{constructor(t,e,s){super(new Uint16Array(t),e,s),this.isFloat16BufferAttribute=!0}getX(t){let e=B0(this.array[t*this.itemSize]);return this.normalized&&(e=je(e,this.array)),e}setX(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize]=xs(e),this}getY(t){let e=B0(this.array[t*this.itemSize+1]);return this.normalized&&(e=je(e,this.array)),e}setY(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+1]=xs(e),this}getZ(t){let e=B0(this.array[t*this.itemSize+2]);return this.normalized&&(e=je(e,this.array)),e}setZ(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+2]=xs(e),this}getW(t){let e=B0(this.array[t*this.itemSize+3]);return this.normalized&&(e=je(e,this.array)),e}setW(t,e){return this.normalized&&(e=ht(e,this.array)),this.array[t*this.itemSize+3]=xs(e),this}setXY(t,e,s){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array)),this.array[t+0]=xs(e),this.array[t+1]=xs(s),this}setXYZ(t,e,s,i){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array)),this.array[t+0]=xs(e),this.array[t+1]=xs(s),this.array[t+2]=xs(i),this}setXYZW(t,e,s,i,n){return t*=this.itemSize,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array),n=ht(n,this.array)),this.array[t+0]=xs(e),this.array[t+1]=xs(s),this.array[t+2]=xs(i),this.array[t+3]=xs(n),this}}class mt extends it{constructor(t,e,s){super(new Float32Array(t),e,s)}}let Cf=0;const Ns=new gt,v1=new Xt,Wo=new S,ws=new So,Jr=new So,Ne=new S;class zt extends Pn{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Cf++}),this.uuid=di(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(uf(t)?A4:M4)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,s=0){this.groups.push({start:t,count:e,materialIndex:s})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const s=this.attributes.normal;if(s!==void 0){const n=new gs().getNormalMatrix(t);s.applyNormalMatrix(n),s.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return Ns.makeRotationFromQuaternion(t),this.applyMatrix4(Ns),this}rotateX(t){return Ns.makeRotationX(t),this.applyMatrix4(Ns),this}rotateY(t){return Ns.makeRotationY(t),this.applyMatrix4(Ns),this}rotateZ(t){return Ns.makeRotationZ(t),this.applyMatrix4(Ns),this}translate(t,e,s){return Ns.makeTranslation(t,e,s),this.applyMatrix4(Ns),this}scale(t,e,s){return Ns.makeScale(t,e,s),this.applyMatrix4(Ns),this}lookAt(t){return v1.lookAt(t),v1.updateMatrix(),this.applyMatrix4(v1.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Wo).negate(),this.translate(Wo.x,Wo.y,Wo.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const s=[];for(let i=0,n=t.length;i<n;i++){const r=t[i];s.push(r.x,r.y,r.z||0)}this.setAttribute("position",new mt(s,3))}else{const s=Math.min(t.length,e.count);for(let i=0;i<s;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new So);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new S(-1/0,-1/0,-1/0),new S(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let s=0,i=e.length;s<i;s++){const n=e[s];ws.setFromBufferAttribute(n),this.morphTargetsRelative?(Ne.addVectors(this.boundingBox.min,ws.min),this.boundingBox.expandByPoint(Ne),Ne.addVectors(this.boundingBox.max,ws.max),this.boundingBox.expandByPoint(Ne)):(this.boundingBox.expandByPoint(ws.min),this.boundingBox.expandByPoint(ws.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ln);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new S,1/0);return}if(t){const s=this.boundingSphere.center;if(ws.setFromBufferAttribute(t),e)for(let n=0,r=e.length;n<r;n++){const a=e[n];Jr.setFromBufferAttribute(a),this.morphTargetsRelative?(Ne.addVectors(ws.min,Jr.min),ws.expandByPoint(Ne),Ne.addVectors(ws.max,Jr.max),ws.expandByPoint(Ne)):(ws.expandByPoint(Jr.min),ws.expandByPoint(Jr.max))}ws.getCenter(s);let i=0;for(let n=0,r=t.count;n<r;n++)Ne.fromBufferAttribute(t,n),i=Math.max(i,s.distanceToSquared(Ne));if(e)for(let n=0,r=e.length;n<r;n++){const a=e[n],c=this.morphTargetsRelative;for(let l=0,u=a.count;l<u;l++)Ne.fromBufferAttribute(a,l),c&&(Wo.fromBufferAttribute(t,l),Ne.add(Wo)),i=Math.max(i,s.distanceToSquared(Ne))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const s=e.position,i=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new it(new Float32Array(4*s.count),4));const r=this.getAttribute("tangent"),a=[],c=[];for(let N=0;N<s.count;N++)a[N]=new S,c[N]=new S;const l=new S,u=new S,p=new S,h=new Y,d=new Y,g=new Y,f=new S,m=new S;function x(N,A,E){l.fromBufferAttribute(s,N),u.fromBufferAttribute(s,A),p.fromBufferAttribute(s,E),h.fromBufferAttribute(n,N),d.fromBufferAttribute(n,A),g.fromBufferAttribute(n,E),u.sub(l),p.sub(l),d.sub(h),g.sub(h);const U=1/(d.x*g.y-g.x*d.y);isFinite(U)&&(f.copy(u).multiplyScalar(g.y).addScaledVector(p,-d.y).multiplyScalar(U),m.copy(p).multiplyScalar(d.x).addScaledVector(u,-g.x).multiplyScalar(U),a[N].add(f),a[A].add(f),a[E].add(f),c[N].add(m),c[A].add(m),c[E].add(m))}let w=this.groups;w.length===0&&(w=[{start:0,count:t.count}]);for(let N=0,A=w.length;N<A;++N){const E=w[N],U=E.start,$=E.count;for(let Z=U,j=U+$;Z<j;Z+=3)x(t.getX(Z+0),t.getX(Z+1),t.getX(Z+2))}const b=new S,v=new S,T=new S,M=new S;function F(N){T.fromBufferAttribute(i,N),M.copy(T);const A=a[N];b.copy(A),b.sub(T.multiplyScalar(T.dot(A))).normalize(),v.crossVectors(M,A);const U=v.dot(c[N])<0?-1:1;r.setXYZW(N,b.x,b.y,b.z,U)}for(let N=0,A=w.length;N<A;++N){const E=w[N],U=E.start,$=E.count;for(let Z=U,j=U+$;Z<j;Z+=3)F(t.getX(Z+0)),F(t.getX(Z+1)),F(t.getX(Z+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let s=this.getAttribute("normal");if(s===void 0)s=new it(new Float32Array(e.count*3),3),this.setAttribute("normal",s);else for(let h=0,d=s.count;h<d;h++)s.setXYZ(h,0,0,0);const i=new S,n=new S,r=new S,a=new S,c=new S,l=new S,u=new S,p=new S;if(t)for(let h=0,d=t.count;h<d;h+=3){const g=t.getX(h+0),f=t.getX(h+1),m=t.getX(h+2);i.fromBufferAttribute(e,g),n.fromBufferAttribute(e,f),r.fromBufferAttribute(e,m),u.subVectors(r,n),p.subVectors(i,n),u.cross(p),a.fromBufferAttribute(s,g),c.fromBufferAttribute(s,f),l.fromBufferAttribute(s,m),a.add(u),c.add(u),l.add(u),s.setXYZ(g,a.x,a.y,a.z),s.setXYZ(f,c.x,c.y,c.z),s.setXYZ(m,l.x,l.y,l.z)}else for(let h=0,d=e.count;h<d;h+=3)i.fromBufferAttribute(e,h+0),n.fromBufferAttribute(e,h+1),r.fromBufferAttribute(e,h+2),u.subVectors(r,n),p.subVectors(i,n),u.cross(p),s.setXYZ(h+0,u.x,u.y,u.z),s.setXYZ(h+1,u.x,u.y,u.z),s.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),s.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,s=t.count;e<s;e++)Ne.fromBufferAttribute(t,e),Ne.normalize(),t.setXYZ(e,Ne.x,Ne.y,Ne.z)}toNonIndexed(){function t(a,c){const l=a.array,u=a.itemSize,p=a.normalized,h=new l.constructor(c.length*u);let d=0,g=0;for(let f=0,m=c.length;f<m;f++){a.isInterleavedBufferAttribute?d=c[f]*a.data.stride+a.offset:d=c[f]*u;for(let x=0;x<u;x++)h[g++]=l[d++]}return new it(h,u,p)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new zt,s=this.index.array,i=this.attributes;for(const a in i){const c=i[a],l=t(c,s);e.setAttribute(a,l)}const n=this.morphAttributes;for(const a in n){const c=[],l=n[a];for(let u=0,p=l.length;u<p;u++){const h=l[u],d=t(h,s);c.push(d)}e.morphAttributes[a]=c}e.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let a=0,c=r.length;a<c;a++){const l=r[a];e.addGroup(l.start,l.count,l.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const l in c)c[l]!==void 0&&(t[l]=c[l]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const s=this.attributes;for(const c in s){const l=s[c];t.data.attributes[c]=l.toJSON(t.data)}const i={};let n=!1;for(const c in this.morphAttributes){const l=this.morphAttributes[c],u=[];for(let p=0,h=l.length;p<h;p++){const d=l[p];u.push(d.toJSON(t.data))}u.length>0&&(i[c]=u,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(t.data.groups=JSON.parse(JSON.stringify(r)));const a=this.boundingSphere;return a!==null&&(t.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const s=t.index;s!==null&&this.setIndex(s.clone(e));const i=t.attributes;for(const l in i){const u=i[l];this.setAttribute(l,u.clone(e))}const n=t.morphAttributes;for(const l in n){const u=[],p=n[l];for(let h=0,d=p.length;h<d;h++)u.push(p[h].clone(e));this.morphAttributes[l]=u}this.morphTargetsRelative=t.morphTargetsRelative;const r=t.groups;for(let l=0,u=r.length;l<u;l++){const p=r[l];this.addGroup(p.start,p.count,p.materialIndex)}const a=t.boundingBox;a!==null&&(this.boundingBox=a.clone());const c=t.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const qh=new gt,Hn=new Wp,I0=new Ln,Yh=new S,L0=new S,U0=new S,z0=new S,_1=new S,k0=new S,Xh=new S,V0=new S;class V extends Xt{constructor(t=new zt,e=new gi){super(),this.isMesh=!0,this.type="Mesh",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),t.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=t.morphTargetInfluences.slice()),t.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},t.morphTargetDictionary)),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}getVertexPosition(t,e){const s=this.geometry,i=s.attributes.position,n=s.morphAttributes.position,r=s.morphTargetsRelative;e.fromBufferAttribute(i,t);const a=this.morphTargetInfluences;if(n&&a){k0.set(0,0,0);for(let c=0,l=n.length;c<l;c++){const u=a[c],p=n[c];u!==0&&(_1.fromBufferAttribute(p,t),r?k0.addScaledVector(_1,u):k0.addScaledVector(_1.sub(e),u))}e.add(k0)}return e}raycast(t,e){const s=this.geometry,i=this.material,n=this.matrixWorld;i!==void 0&&(s.boundingSphere===null&&s.computeBoundingSphere(),I0.copy(s.boundingSphere),I0.applyMatrix4(n),Hn.copy(t.ray).recast(t.near),!(I0.containsPoint(Hn.origin)===!1&&(Hn.intersectSphere(I0,Yh)===null||Hn.origin.distanceToSquared(Yh)>(t.far-t.near)**2))&&(qh.copy(n).invert(),Hn.copy(t.ray).applyMatrix4(qh),!(s.boundingBox!==null&&Hn.intersectsBox(s.boundingBox)===!1)&&this._computeIntersections(t,e,Hn)))}_computeIntersections(t,e,s){let i;const n=this.geometry,r=this.material,a=n.index,c=n.attributes.position,l=n.attributes.uv,u=n.attributes.uv1,p=n.attributes.normal,h=n.groups,d=n.drawRange;if(a!==null)if(Array.isArray(r))for(let g=0,f=h.length;g<f;g++){const m=h[g],x=r[m.materialIndex],w=Math.max(m.start,d.start),b=Math.min(a.count,Math.min(m.start+m.count,d.start+d.count));for(let v=w,T=b;v<T;v+=3){const M=a.getX(v),F=a.getX(v+1),N=a.getX(v+2);i=G0(this,x,t,s,l,u,p,M,F,N),i&&(i.faceIndex=Math.floor(v/3),i.face.materialIndex=m.materialIndex,e.push(i))}}else{const g=Math.max(0,d.start),f=Math.min(a.count,d.start+d.count);for(let m=g,x=f;m<x;m+=3){const w=a.getX(m),b=a.getX(m+1),v=a.getX(m+2);i=G0(this,r,t,s,l,u,p,w,b,v),i&&(i.faceIndex=Math.floor(m/3),e.push(i))}}else if(c!==void 0)if(Array.isArray(r))for(let g=0,f=h.length;g<f;g++){const m=h[g],x=r[m.materialIndex],w=Math.max(m.start,d.start),b=Math.min(c.count,Math.min(m.start+m.count,d.start+d.count));for(let v=w,T=b;v<T;v+=3){const M=v,F=v+1,N=v+2;i=G0(this,x,t,s,l,u,p,M,F,N),i&&(i.faceIndex=Math.floor(v/3),i.face.materialIndex=m.materialIndex,e.push(i))}}else{const g=Math.max(0,d.start),f=Math.min(c.count,d.start+d.count);for(let m=g,x=f;m<x;m+=3){const w=m,b=m+1,v=m+2;i=G0(this,r,t,s,l,u,p,w,b,v),i&&(i.faceIndex=Math.floor(m/3),e.push(i))}}}}function Ff(o,t,e,s,i,n,r,a){let c;if(t.side===ls?c=s.intersectTriangle(r,n,i,!0,a):c=s.intersectTriangle(i,n,r,t.side===go,a),c===null)return null;V0.copy(a),V0.applyMatrix4(o.matrixWorld);const l=e.ray.origin.distanceTo(V0);return l<e.near||l>e.far?null:{distance:l,point:V0.clone(),object:o}}function G0(o,t,e,s,i,n,r,a,c,l){o.getVertexPosition(a,L0),o.getVertexPosition(c,U0),o.getVertexPosition(l,z0);const u=Ff(o,t,e,s,L0,U0,z0,Xh);if(u){const p=new S;Xs.getBarycoord(Xh,L0,U0,z0,p),i&&(u.uv=Xs.getInterpolatedAttribute(i,a,c,l,p,new Y)),n&&(u.uv1=Xs.getInterpolatedAttribute(n,a,c,l,p,new Y)),r&&(u.normal=Xs.getInterpolatedAttribute(r,a,c,l,p,new S),u.normal.dot(s.direction)>0&&u.normal.multiplyScalar(-1));const h={a,b:c,c:l,normal:new S,materialIndex:0};Xs.getNormal(L0,U0,z0,h.normal),u.face=h,u.barycoord=p}return u}class Un extends zt{constructor(t=1,e=1,s=1,i=1,n=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:t,height:e,depth:s,widthSegments:i,heightSegments:n,depthSegments:r};const a=this;i=Math.floor(i),n=Math.floor(n),r=Math.floor(r);const c=[],l=[],u=[],p=[];let h=0,d=0;g("z","y","x",-1,-1,s,e,t,r,n,0),g("z","y","x",1,-1,s,e,-t,r,n,1),g("x","z","y",1,1,t,s,e,i,r,2),g("x","z","y",1,-1,t,s,-e,i,r,3),g("x","y","z",1,-1,t,e,s,i,n,4),g("x","y","z",-1,-1,t,e,-s,i,n,5),this.setIndex(c),this.setAttribute("position",new mt(l,3)),this.setAttribute("normal",new mt(u,3)),this.setAttribute("uv",new mt(p,2));function g(f,m,x,w,b,v,T,M,F,N,A){const E=v/F,U=T/N,$=v/2,Z=T/2,j=M/2,ut=F+1,nt=N+1;let Ue=0,_e=0;const It=new S;for(let se=0;se<nt;se++){const _t=se*U-Z;for(let kt=0;kt<ut;kt++){const Bt=kt*E-$;It[f]=Bt*w,It[m]=_t*b,It[x]=j,l.push(It.x,It.y,It.z),It[f]=0,It[m]=0,It[x]=M>0?1:-1,u.push(It.x,It.y,It.z),p.push(kt/F),p.push(1-se/N),Ue+=1}}for(let se=0;se<N;se++)for(let _t=0;_t<F;_t++){const kt=h+_t+ut*se,Bt=h+_t+ut*(se+1),Ae=h+(_t+1)+ut*(se+1),Se=h+(_t+1)+ut*se;c.push(kt,Bt,Se),c.push(Bt,Ae,Se),_e+=6}a.addGroup(d,_e,A),d+=_e,h+=Ue}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Un(t.width,t.height,t.depth,t.widthSegments,t.heightSegments,t.depthSegments)}}function C4(o){const t={};for(const e in o){t[e]={};for(const s in o[e]){const i=o[e][s];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),t[e][s]=null):t[e][s]=i.clone():Array.isArray(i)?t[e][s]=i.slice():t[e][s]=i}}return t}function Rf(o){const t=[];for(let e=0;e<o.length;e++)t.push(o[e].clone());return t}var Ef=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Df=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Bf extends us{constructor(t){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ef,this.fragmentShader=Df,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,t!==void 0&&this.setValues(t)}copy(t){return super.copy(t),this.fragmentShader=t.fragmentShader,this.vertexShader=t.vertexShader,this.uniforms=C4(t.uniforms),this.uniformsGroups=Rf(t.uniformsGroups),this.defines=Object.assign({},t.defines),this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.fog=t.fog,this.lights=t.lights,this.clipping=t.clipping,this.extensions=Object.assign({},t.extensions),this.glslVersion=t.glslVersion,this}toJSON(t){const e=super.toJSON(t);e.glslVersion=this.glslVersion,e.uniforms={};for(const i in this.uniforms){const r=this.uniforms[i].value;r&&r.isTexture?e.uniforms[i]={type:"t",value:r.toJSON(t).uuid}:r&&r.isColor?e.uniforms[i]={type:"c",value:r.getHex()}:r&&r.isVector2?e.uniforms[i]={type:"v2",value:r.toArray()}:r&&r.isVector3?e.uniforms[i]={type:"v3",value:r.toArray()}:r&&r.isVector4?e.uniforms[i]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?e.uniforms[i]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?e.uniforms[i]={type:"m4",value:r.toArray()}:e.uniforms[i]={value:r}}Object.keys(this.defines).length>0&&(e.defines=this.defines),e.vertexShader=this.vertexShader,e.fragmentShader=this.fragmentShader,e.lights=this.lights,e.clipping=this.clipping;const s={};for(const i in this.extensions)this.extensions[i]===!0&&(s[i]=!0);return Object.keys(s).length>0&&(e.extensions=s),e}}class F4 extends Xt{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new gt,this.projectionMatrix=new gt,this.projectionMatrixInverse=new gt,this.coordinateSystem=js}copy(t,e){return super.copy(t,e),this.matrixWorldInverse.copy(t.matrixWorldInverse),this.projectionMatrix.copy(t.projectionMatrix),this.projectionMatrixInverse.copy(t.projectionMatrixInverse),this.coordinateSystem=t.coordinateSystem,this}getWorldDirection(t){return super.getWorldDirection(t).negate()}updateMatrixWorld(t){super.updateMatrixWorld(t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(t,e){super.updateWorldMatrix(t,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const cn=new S,Zh=new Y,jh=new Y;class li extends F4{constructor(t=50,e=1,s=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=t,this.zoom=1,this.near=s,this.far=i,this.focus=10,this.aspect=e,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.fov=t.fov,this.zoom=t.zoom,this.near=t.near,this.far=t.far,this.focus=t.focus,this.aspect=t.aspect,this.view=t.view===null?null:Object.assign({},t.view),this.filmGauge=t.filmGauge,this.filmOffset=t.filmOffset,this}setFocalLength(t){const e=.5*this.getFilmHeight()/t;this.fov=Va*2*Math.atan(e),this.updateProjectionMatrix()}getFocalLength(){const t=Math.tan(Ta*.5*this.fov);return .5*this.getFilmHeight()/t}getEffectiveFOV(){return Va*2*Math.atan(Math.tan(Ta*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(t,e,s){cn.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),e.set(cn.x,cn.y).multiplyScalar(-t/cn.z),cn.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),s.set(cn.x,cn.y).multiplyScalar(-t/cn.z)}getViewSize(t,e){return this.getViewBounds(t,Zh,jh),e.subVectors(jh,Zh)}setViewOffset(t,e,s,i,n,r){this.aspect=t/e,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=this.near;let e=t*Math.tan(Ta*.5*this.fov)/this.zoom,s=2*e,i=this.aspect*s,n=-.5*i;const r=this.view;if(this.view!==null&&this.view.enabled){const c=r.fullWidth,l=r.fullHeight;n+=r.offsetX*i/c,e-=r.offsetY*s/l,i*=r.width/c,s*=r.height/l}const a=this.filmOffset;a!==0&&(n+=t*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(n,n+i,e,e-s,t,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.fov=this.fov,e.object.zoom=this.zoom,e.object.near=this.near,e.object.far=this.far,e.object.focus=this.focus,e.object.aspect=this.aspect,this.view!==null&&(e.object.view=Object.assign({},this.view)),e.object.filmGauge=this.filmGauge,e.object.filmOffset=this.filmOffset,e}}const $o=-90,Ho=1;class R4 extends Xt{constructor(t,e,s){super(),this.type="CubeCamera",this.renderTarget=s,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new li($o,Ho,t,e);i.layers=this.layers,this.add(i);const n=new li($o,Ho,t,e);n.layers=this.layers,this.add(n);const r=new li($o,Ho,t,e);r.layers=this.layers,this.add(r);const a=new li($o,Ho,t,e);a.layers=this.layers,this.add(a);const c=new li($o,Ho,t,e);c.layers=this.layers,this.add(c);const l=new li($o,Ho,t,e);l.layers=this.layers,this.add(l)}updateCoordinateSystem(){const t=this.coordinateSystem,e=this.children.concat(),[s,i,n,r,a,c]=e;for(const l of e)this.remove(l);if(t===js)s.up.set(0,1,0),s.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),n.up.set(0,0,-1),n.lookAt(0,1,0),r.up.set(0,0,1),r.lookAt(0,-1,0),a.up.set(0,1,0),a.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(t===Xi)s.up.set(0,-1,0),s.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),n.up.set(0,0,1),n.lookAt(0,1,0),r.up.set(0,0,-1),r.lookAt(0,-1,0),a.up.set(0,-1,0),a.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+t);for(const l of e)this.add(l),l.updateMatrixWorld()}update(t,e){this.parent===null&&this.updateMatrixWorld();const{renderTarget:s,activeMipmapLevel:i}=this;this.coordinateSystem!==t.coordinateSystem&&(this.coordinateSystem=t.coordinateSystem,this.updateCoordinateSystem());const[n,r,a,c,l,u]=this.children,p=t.getRenderTarget(),h=t.getActiveCubeFace(),d=t.getActiveMipmapLevel(),g=t.xr.enabled;t.xr.enabled=!1;const f=s.texture.generateMipmaps;s.texture.generateMipmaps=!1,t.setRenderTarget(s,0,i),t.render(e,n),t.setRenderTarget(s,1,i),t.render(e,r),t.setRenderTarget(s,2,i),t.render(e,a),t.setRenderTarget(s,3,i),t.render(e,c),t.setRenderTarget(s,4,i),t.render(e,l),s.texture.generateMipmaps=f,t.setRenderTarget(s,5,i),t.render(e,u),t.setRenderTarget(p,h,d),t.xr.enabled=g,s.texture.needsPMREMUpdate=!0}}class $p extends Ke{constructor(t,e,s,i,n,r,a,c,l,u){t=t!==void 0?t:[],e=e!==void 0?e:mo,super(t,e,s,i,n,r,a,c,l,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(t){this.image=t}}class Pf extends yf{constructor(t=1,e={}){super(t,t,e),this.isWebGLCubeRenderTarget=!0;const s={width:t,height:t,depth:1},i=[s,s,s,s,s,s];this.texture=new $p(i,e.mapping,e.wrapS,e.wrapT,e.magFilter,e.minFilter,e.format,e.type,e.anisotropy,e.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=e.generateMipmaps!==void 0?e.generateMipmaps:!1,this.texture.minFilter=e.minFilter!==void 0?e.minFilter:Je}fromEquirectangularTexture(t,e){this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const s={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Un(5,5,5),n=new Bf({name:"CubemapFromEquirect",uniforms:C4(s.uniforms),vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,side:ls,blending:fo});n.uniforms.tEquirect.value=e;const r=new V(i,n),a=e.minFilter;return e.minFilter===Gi&&(e.minFilter=Je),new R4(1,10,this).update(t,r),e.minFilter=a,r.geometry.dispose(),r.material.dispose(),this}clear(t,e,s,i){const n=t.getRenderTarget();for(let r=0;r<6;r++)t.setRenderTarget(this,r),t.clear(e,s,i);t.setRenderTarget(n)}}class Hp{constructor(t,e=25e-5){this.isFogExp2=!0,this.name="",this.color=new W(t),this.density=e}clone(){return new Hp(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class qp{constructor(t,e=1,s=1e3){this.isFog=!0,this.name="",this.color=new W(t),this.near=e,this.far=s}clone(){return new qp(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}class Yp extends Xt{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new As,this.environmentIntensity=1,this.environmentRotation=new As,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(t,e){return super.copy(t,e),t.background!==null&&(this.background=t.background.clone()),t.environment!==null&&(this.environment=t.environment.clone()),t.fog!==null&&(this.fog=t.fog.clone()),this.backgroundBlurriness=t.backgroundBlurriness,this.backgroundIntensity=t.backgroundIntensity,this.backgroundRotation.copy(t.backgroundRotation),this.environmentIntensity=t.environmentIntensity,this.environmentRotation.copy(t.environmentRotation),t.overrideMaterial!==null&&(this.overrideMaterial=t.overrideMaterial.clone()),this.matrixAutoUpdate=t.matrixAutoUpdate,this}toJSON(t){const e=super.toJSON(t);return this.fog!==null&&(e.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(e.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(e.object.backgroundIntensity=this.backgroundIntensity),e.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(e.object.environmentIntensity=this.environmentIntensity),e.object.environmentRotation=this.environmentRotation.toArray(),e}}class E4{constructor(t,e){this.isInterleavedBuffer=!0,this.array=t,this.stride=e,this.count=t!==void 0?t.length/e:0,this.usage=qc,this.updateRanges=[],this.version=0,this.uuid=di()}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.array=new t.array.constructor(t.array),this.count=t.count,this.stride=t.stride,this.usage=t.usage,this}copyAt(t,e,s){t*=this.stride,s*=e.stride;for(let i=0,n=this.stride;i<n;i++)this.array[t+i]=e.array[s+i];return this}set(t,e=0){return this.array.set(t,e),this}clone(t){t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=di()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const e=new this.array.constructor(t.arrayBuffers[this.array.buffer._uuid]),s=new this.constructor(e,this.stride);return s.setUsage(this.usage),s}onUpload(t){return this.onUploadCallback=t,this}toJSON(t){return t.arrayBuffers===void 0&&(t.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=di()),t.arrayBuffers[this.array.buffer._uuid]===void 0&&(t.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const Ye=new S;class Xp{constructor(t,e,s,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=e,this.offset=s,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(t){this.data.needsUpdate=t}applyMatrix4(t){for(let e=0,s=this.data.count;e<s;e++)Ye.fromBufferAttribute(this,e),Ye.applyMatrix4(t),this.setXYZ(e,Ye.x,Ye.y,Ye.z);return this}applyNormalMatrix(t){for(let e=0,s=this.count;e<s;e++)Ye.fromBufferAttribute(this,e),Ye.applyNormalMatrix(t),this.setXYZ(e,Ye.x,Ye.y,Ye.z);return this}transformDirection(t){for(let e=0,s=this.count;e<s;e++)Ye.fromBufferAttribute(this,e),Ye.transformDirection(t),this.setXYZ(e,Ye.x,Ye.y,Ye.z);return this}getComponent(t,e){let s=this.array[t*this.data.stride+this.offset+e];return this.normalized&&(s=je(s,this.array)),s}setComponent(t,e,s){return this.normalized&&(s=ht(s,this.array)),this.data.array[t*this.data.stride+this.offset+e]=s,this}setX(t,e){return this.normalized&&(e=ht(e,this.array)),this.data.array[t*this.data.stride+this.offset]=e,this}setY(t,e){return this.normalized&&(e=ht(e,this.array)),this.data.array[t*this.data.stride+this.offset+1]=e,this}setZ(t,e){return this.normalized&&(e=ht(e,this.array)),this.data.array[t*this.data.stride+this.offset+2]=e,this}setW(t,e){return this.normalized&&(e=ht(e,this.array)),this.data.array[t*this.data.stride+this.offset+3]=e,this}getX(t){let e=this.data.array[t*this.data.stride+this.offset];return this.normalized&&(e=je(e,this.array)),e}getY(t){let e=this.data.array[t*this.data.stride+this.offset+1];return this.normalized&&(e=je(e,this.array)),e}getZ(t){let e=this.data.array[t*this.data.stride+this.offset+2];return this.normalized&&(e=je(e,this.array)),e}getW(t){let e=this.data.array[t*this.data.stride+this.offset+3];return this.normalized&&(e=je(e,this.array)),e}setXY(t,e,s){return t=t*this.data.stride+this.offset,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this}setXYZ(t,e,s,i){return t=t*this.data.stride+this.offset,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this}setXYZW(t,e,s,i,n){return t=t*this.data.stride+this.offset,this.normalized&&(e=ht(e,this.array),s=ht(s,this.array),i=ht(i,this.array),n=ht(n,this.array)),this.data.array[t+0]=e,this.data.array[t+1]=s,this.data.array[t+2]=i,this.data.array[t+3]=n,this}clone(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return new it(new this.array.constructor(e),this.itemSize,this.normalized)}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new Xp(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(t){if(t===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const e=[];for(let s=0;s<this.count;s++){const i=s*this.data.stride+this.offset;for(let n=0;n<this.itemSize;n++)e.push(this.data.array[i+n])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}else return t.interleavedBuffers===void 0&&(t.interleavedBuffers={}),t.interleavedBuffers[this.data.uuid]===void 0&&(t.interleavedBuffers[this.data.uuid]=this.data.toJSON(t)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class If extends us{constructor(t){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new W(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.rotation=t.rotation,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}class Zp extends Ke{constructor(t=null,e=1,s=1,i,n,r,a,c,l=Fe,u=Fe,p,h){super(null,r,a,c,l,u,i,n,p,h),this.isDataTexture=!0,this.image={data:t,width:e,height:s},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Ga extends it{constructor(t,e,s,i=1){super(t,e,s),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}toJSON(){const t=super.toJSON();return t.meshPerAttribute=this.meshPerAttribute,t.isInstancedBufferAttribute=!0,t}}const qo=new gt,Kh=new gt,O0=[],Jh=new So,Lf=new gt,Qr=new V,ta=new Ln;class D4 extends V{constructor(t,e,s){super(t,e),this.isInstancedMesh=!0,this.instanceMatrix=new Ga(new Float32Array(s*16),16),this.instanceColor=null,this.morphTexture=null,this.count=s,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<s;i++)this.setMatrixAt(i,Lf)}computeBoundingBox(){const t=this.geometry,e=this.count;this.boundingBox===null&&(this.boundingBox=new So),t.boundingBox===null&&t.computeBoundingBox(),this.boundingBox.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,qo),Jh.copy(t.boundingBox).applyMatrix4(qo),this.boundingBox.union(Jh)}computeBoundingSphere(){const t=this.geometry,e=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ln),t.boundingSphere===null&&t.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let s=0;s<e;s++)this.getMatrixAt(s,qo),ta.copy(t.boundingSphere).applyMatrix4(qo),this.boundingSphere.union(ta)}copy(t,e){return super.copy(t,e),this.instanceMatrix.copy(t.instanceMatrix),t.morphTexture!==null&&(this.morphTexture=t.morphTexture.clone()),t.instanceColor!==null&&(this.instanceColor=t.instanceColor.clone()),this.count=t.count,t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone()),t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),this}getColorAt(t,e){e.fromArray(this.instanceColor.array,t*3)}getMatrixAt(t,e){e.fromArray(this.instanceMatrix.array,t*16)}getMorphAt(t,e){const s=e.morphTargetInfluences,i=this.morphTexture.source.data.data,n=s.length+1,r=t*n+1;for(let a=0;a<s.length;a++)s[a]=i[r+a]}raycast(t,e){const s=this.matrixWorld,i=this.count;if(Qr.geometry=this.geometry,Qr.material=this.material,Qr.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),ta.copy(this.boundingSphere),ta.applyMatrix4(s),t.ray.intersectsSphere(ta)!==!1))for(let n=0;n<i;n++){this.getMatrixAt(n,qo),Kh.multiplyMatrices(s,qo),Qr.matrixWorld=Kh,Qr.raycast(t,O0);for(let r=0,a=O0.length;r<a;r++){const c=O0[r];c.instanceId=n,c.object=this,e.push(c)}O0.length=0}}setColorAt(t,e){this.instanceColor===null&&(this.instanceColor=new Ga(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),e.toArray(this.instanceColor.array,t*3)}setMatrixAt(t,e){e.toArray(this.instanceMatrix.array,t*16)}setMorphAt(t,e){const s=e.morphTargetInfluences,i=s.length+1;this.morphTexture===null&&(this.morphTexture=new Zp(new Float32Array(i*this.count),i,this.count,vl,ns));const n=this.morphTexture.source.data.data;let r=0;for(let l=0;l<s.length;l++)r+=s[l];const a=this.geometry.morphTargetsRelative?1:1-r,c=i*t;n[c]=a,n.set(s,c+1)}updateMorphTargets(){}dispose(){return this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null),this}}const S1=new S,Uf=new S,zf=new gs;class hn{constructor(t=new S(1,0,0),e=0){this.isPlane=!0,this.normal=t,this.constant=e}set(t,e){return this.normal.copy(t),this.constant=e,this}setComponents(t,e,s,i){return this.normal.set(t,e,s),this.constant=i,this}setFromNormalAndCoplanarPoint(t,e){return this.normal.copy(t),this.constant=-e.dot(this.normal),this}setFromCoplanarPoints(t,e,s){const i=S1.subVectors(s,e).cross(Uf.subVectors(t,e)).normalize();return this.setFromNormalAndCoplanarPoint(i,t),this}copy(t){return this.normal.copy(t.normal),this.constant=t.constant,this}normalize(){const t=1/this.normal.length();return this.normal.multiplyScalar(t),this.constant*=t,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(t){return this.normal.dot(t)+this.constant}distanceToSphere(t){return this.distanceToPoint(t.center)-t.radius}projectPoint(t,e){return e.copy(t).addScaledVector(this.normal,-this.distanceToPoint(t))}intersectLine(t,e){const s=t.delta(S1),i=this.normal.dot(s);if(i===0)return this.distanceToPoint(t.start)===0?e.copy(t.start):null;const n=-(t.start.dot(this.normal)+this.constant)/i;return n<0||n>1?null:e.copy(t.start).addScaledVector(s,n)}intersectsLine(t){const e=this.distanceToPoint(t.start),s=this.distanceToPoint(t.end);return e<0&&s>0||s<0&&e>0}intersectsBox(t){return t.intersectsPlane(this)}intersectsSphere(t){return t.intersectsPlane(this)}coplanarPoint(t){return t.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(t,e){const s=e||zf.getNormalMatrix(t),i=this.coplanarPoint(S1).applyMatrix4(t),n=this.normal.applyMatrix3(s).normalize();return this.constant=-i.dot(n),this}translate(t){return this.constant-=t.dot(this.normal),this}equals(t){return t.normal.equals(this.normal)&&t.constant===this.constant}clone(){return new this.constructor().copy(this)}}const qn=new Ln,W0=new S;class jp{constructor(t=new hn,e=new hn,s=new hn,i=new hn,n=new hn,r=new hn){this.planes=[t,e,s,i,n,r]}set(t,e,s,i,n,r){const a=this.planes;return a[0].copy(t),a[1].copy(e),a[2].copy(s),a[3].copy(i),a[4].copy(n),a[5].copy(r),this}copy(t){const e=this.planes;for(let s=0;s<6;s++)e[s].copy(t.planes[s]);return this}setFromProjectionMatrix(t,e=js){const s=this.planes,i=t.elements,n=i[0],r=i[1],a=i[2],c=i[3],l=i[4],u=i[5],p=i[6],h=i[7],d=i[8],g=i[9],f=i[10],m=i[11],x=i[12],w=i[13],b=i[14],v=i[15];if(s[0].setComponents(c-n,h-l,m-d,v-x).normalize(),s[1].setComponents(c+n,h+l,m+d,v+x).normalize(),s[2].setComponents(c+r,h+u,m+g,v+w).normalize(),s[3].setComponents(c-r,h-u,m-g,v-w).normalize(),s[4].setComponents(c-a,h-p,m-f,v-b).normalize(),e===js)s[5].setComponents(c+a,h+p,m+f,v+b).normalize();else if(e===Xi)s[5].setComponents(a,p,f,b).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+e);return this}intersectsObject(t){if(t.boundingSphere!==void 0)t.boundingSphere===null&&t.computeBoundingSphere(),qn.copy(t.boundingSphere).applyMatrix4(t.matrixWorld);else{const e=t.geometry;e.boundingSphere===null&&e.computeBoundingSphere(),qn.copy(e.boundingSphere).applyMatrix4(t.matrixWorld)}return this.intersectsSphere(qn)}intersectsSprite(t){return qn.center.set(0,0,0),qn.radius=.7071067811865476,qn.applyMatrix4(t.matrixWorld),this.intersectsSphere(qn)}intersectsSphere(t){const e=this.planes,s=t.center,i=-t.radius;for(let n=0;n<6;n++)if(e[n].distanceToPoint(s)<i)return!1;return!0}intersectsBox(t){const e=this.planes;for(let s=0;s<6;s++){const i=e[s];if(W0.x=i.normal.x>0?t.max.x:t.min.x,W0.y=i.normal.y>0?t.max.y:t.min.y,W0.z=i.normal.z>0?t.max.z:t.min.z,i.distanceToPoint(W0)<0)return!1}return!0}containsPoint(t){const e=this.planes;for(let s=0;s<6;s++)if(e[s].distanceToPoint(t)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}class B4 extends us{constructor(t){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new W(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.linewidth=t.linewidth,this.linecap=t.linecap,this.linejoin=t.linejoin,this.fog=t.fog,this}}class xo extends us{constructor(t){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new W(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.alphaMap=t.alphaMap,this.size=t.size,this.sizeAttenuation=t.sizeAttenuation,this.fog=t.fog,this}}const Qh=new gt,Zu=new Wp,$0=new Ln,H0=new S;class Zi extends Xt{constructor(t=new zt,e=new xo){super(),this.isPoints=!0,this.type="Points",this.geometry=t,this.material=e,this.updateMorphTargets()}copy(t,e){return super.copy(t,e),this.material=Array.isArray(t.material)?t.material.slice():t.material,this.geometry=t.geometry,this}raycast(t,e){const s=this.geometry,i=this.matrixWorld,n=t.params.Points.threshold,r=s.drawRange;if(s.boundingSphere===null&&s.computeBoundingSphere(),$0.copy(s.boundingSphere),$0.applyMatrix4(i),$0.radius+=n,t.ray.intersectsSphere($0)===!1)return;Qh.copy(i).invert(),Zu.copy(t.ray).applyMatrix4(Qh);const a=n/((this.scale.x+this.scale.y+this.scale.z)/3),c=a*a,l=s.index,p=s.attributes.position;if(l!==null){const h=Math.max(0,r.start),d=Math.min(l.count,r.start+r.count);for(let g=h,f=d;g<f;g++){const m=l.getX(g);H0.fromBufferAttribute(p,m),t3(H0,m,c,i,t,e,this)}}else{const h=Math.max(0,r.start),d=Math.min(p.count,r.start+r.count);for(let g=h,f=d;g<f;g++)H0.fromBufferAttribute(p,g),t3(H0,g,c,i,t,e,this)}}updateMorphTargets(){const e=this.geometry.morphAttributes,s=Object.keys(e);if(s.length>0){const i=e[s[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let n=0,r=i.length;n<r;n++){const a=i[n].name||String(n);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=n}}}}}function t3(o,t,e,s,i,n,r){const a=Zu.distanceSqToPoint(o);if(a<e){const c=new S;Zu.closestPointToPoint(o,c),c.applyMatrix4(s);const l=i.ray.origin.distanceTo(c);if(l<i.near||l>i.far)return;n.push({distance:l,distanceToRay:Math.sqrt(a),point:c,index:t,face:null,faceIndex:null,barycoord:null,object:r})}}class K extends Xt{constructor(){super(),this.isGroup=!0,this.type="Group"}}class P4 extends Ke{constructor(t,e){super({width:t,height:e}),this.isFramebufferTexture=!0,this.magFilter=Fe,this.minFilter=Fe,this.generateMipmaps=!1,this.needsUpdate=!0}}class To extends Ke{constructor(t,e,s,i,n,r,a,c,l,u=ro){if(u!==ro&&u!==Er)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");s===void 0&&u===ro&&(s=Pe),s===void 0&&u===Er&&(s=n0),super(null,i,n,r,a,c,u,s,l),this.isDepthTexture=!0,this.image={width:t,height:e},this.magFilter=a!==void 0?a:Fe,this.minFilter=c!==void 0?c:Fe,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(t){return super.copy(t),this.compareFunction=t.compareFunction,this}toJSON(t){const e=super.toJSON(t);return this.compareFunction!==null&&(e.compareFunction=this.compareFunction),e}}class ii{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(t,e){const s=this.getUtoTmapping(t);return this.getPoint(s,e)}getPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return e}getSpacedPoints(t=5){const e=[];for(let s=0;s<=t;s++)e.push(this.getPointAt(s/t));return e}getLength(){const t=this.getLengths();return t[t.length-1]}getLengths(t=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===t+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const e=[];let s,i=this.getPoint(0),n=0;e.push(0);for(let r=1;r<=t;r++)s=this.getPoint(r/t),n+=s.distanceTo(i),e.push(n),i=s;return this.cacheArcLengths=e,e}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(t,e){const s=this.getLengths();let i=0;const n=s.length;let r;e?r=e:r=t*s[n-1];let a=0,c=n-1,l;for(;a<=c;)if(i=Math.floor(a+(c-a)/2),l=s[i]-r,l<0)a=i+1;else if(l>0)c=i-1;else{c=i;break}if(i=c,s[i]===r)return i/(n-1);const u=s[i],h=s[i+1]-u,d=(r-u)/h;return(i+d)/(n-1)}getTangent(t,e){let i=t-1e-4,n=t+1e-4;i<0&&(i=0),n>1&&(n=1);const r=this.getPoint(i),a=this.getPoint(n),c=e||(r.isVector2?new Y:new S);return c.copy(a).sub(r).normalize(),c}getTangentAt(t,e){const s=this.getUtoTmapping(t);return this.getTangent(s,e)}computeFrenetFrames(t,e){const s=new S,i=[],n=[],r=[],a=new S,c=new gt;for(let d=0;d<=t;d++){const g=d/t;i[d]=this.getTangentAt(g,new S)}n[0]=new S,r[0]=new S;let l=Number.MAX_VALUE;const u=Math.abs(i[0].x),p=Math.abs(i[0].y),h=Math.abs(i[0].z);u<=l&&(l=u,s.set(1,0,0)),p<=l&&(l=p,s.set(0,1,0)),h<=l&&s.set(0,0,1),a.crossVectors(i[0],s).normalize(),n[0].crossVectors(i[0],a),r[0].crossVectors(i[0],n[0]);for(let d=1;d<=t;d++){if(n[d]=n[d-1].clone(),r[d]=r[d-1].clone(),a.crossVectors(i[d-1],i[d]),a.length()>Number.EPSILON){a.normalize();const g=Math.acos(dt(i[d-1].dot(i[d]),-1,1));n[d].applyMatrix4(c.makeRotationAxis(a,g))}r[d].crossVectors(i[d],n[d])}if(e===!0){let d=Math.acos(dt(n[0].dot(n[t]),-1,1));d/=t,i[0].dot(a.crossVectors(n[0],n[t]))>0&&(d=-d);for(let g=1;g<=t;g++)n[g].applyMatrix4(c.makeRotationAxis(i[g],d*g)),r[g].crossVectors(i[g],n[g])}return{tangents:i,normals:n,binormals:r}}clone(){return new this.constructor().copy(this)}copy(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}toJSON(){const t={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return t.arcLengthDivisions=this.arcLengthDivisions,t.type=this.type,t}fromJSON(t){return this.arcLengthDivisions=t.arcLengthDivisions,this}}class Kp extends ii{constructor(t=0,e=0,s=1,i=1,n=0,r=Math.PI*2,a=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=t,this.aY=e,this.xRadius=s,this.yRadius=i,this.aStartAngle=n,this.aEndAngle=r,this.aClockwise=a,this.aRotation=c}getPoint(t,e=new Y){const s=e,i=Math.PI*2;let n=this.aEndAngle-this.aStartAngle;const r=Math.abs(n)<Number.EPSILON;for(;n<0;)n+=i;for(;n>i;)n-=i;n<Number.EPSILON&&(r?n=0:n=i),this.aClockwise===!0&&!r&&(n===i?n=-i:n=n-i);const a=this.aStartAngle+t*n;let c=this.aX+this.xRadius*Math.cos(a),l=this.aY+this.yRadius*Math.sin(a);if(this.aRotation!==0){const u=Math.cos(this.aRotation),p=Math.sin(this.aRotation),h=c-this.aX,d=l-this.aY;c=h*u-d*p+this.aX,l=h*p+d*u+this.aY}return s.set(c,l)}copy(t){return super.copy(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}toJSON(){const t=super.toJSON();return t.aX=this.aX,t.aY=this.aY,t.xRadius=this.xRadius,t.yRadius=this.yRadius,t.aStartAngle=this.aStartAngle,t.aEndAngle=this.aEndAngle,t.aClockwise=this.aClockwise,t.aRotation=this.aRotation,t}fromJSON(t){return super.fromJSON(t),this.aX=t.aX,this.aY=t.aY,this.xRadius=t.xRadius,this.yRadius=t.yRadius,this.aStartAngle=t.aStartAngle,this.aEndAngle=t.aEndAngle,this.aClockwise=t.aClockwise,this.aRotation=t.aRotation,this}}class kf extends Kp{constructor(t,e,s,i,n,r){super(t,e,s,s,i,n,r),this.isArcCurve=!0,this.type="ArcCurve"}}function Jp(){let o=0,t=0,e=0,s=0;function i(n,r,a,c){o=n,t=a,e=-3*n+3*r-2*a-c,s=2*n-2*r+a+c}return{initCatmullRom:function(n,r,a,c,l){i(r,a,l*(a-n),l*(c-r))},initNonuniformCatmullRom:function(n,r,a,c,l,u,p){let h=(r-n)/l-(a-n)/(l+u)+(a-r)/u,d=(a-r)/u-(c-r)/(u+p)+(c-a)/p;h*=u,d*=u,i(r,a,h,d)},calc:function(n){const r=n*n,a=r*n;return o+t*n+e*r+s*a}}}const q0=new S,T1=new Jp,M1=new Jp,A1=new Jp;class I4 extends ii{constructor(t=[],e=!1,s="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=t,this.closed=e,this.curveType=s,this.tension=i}getPoint(t,e=new S){const s=e,i=this.points,n=i.length,r=(n-(this.closed?0:1))*t;let a=Math.floor(r),c=r-a;this.closed?a+=a>0?0:(Math.floor(Math.abs(a)/n)+1)*n:c===0&&a===n-1&&(a=n-2,c=1);let l,u;this.closed||a>0?l=i[(a-1)%n]:(q0.subVectors(i[0],i[1]).add(i[0]),l=q0);const p=i[a%n],h=i[(a+1)%n];if(this.closed||a+2<n?u=i[(a+2)%n]:(q0.subVectors(i[n-1],i[n-2]).add(i[n-1]),u=q0),this.curveType==="centripetal"||this.curveType==="chordal"){const d=this.curveType==="chordal"?.5:.25;let g=Math.pow(l.distanceToSquared(p),d),f=Math.pow(p.distanceToSquared(h),d),m=Math.pow(h.distanceToSquared(u),d);f<1e-4&&(f=1),g<1e-4&&(g=f),m<1e-4&&(m=f),T1.initNonuniformCatmullRom(l.x,p.x,h.x,u.x,g,f,m),M1.initNonuniformCatmullRom(l.y,p.y,h.y,u.y,g,f,m),A1.initNonuniformCatmullRom(l.z,p.z,h.z,u.z,g,f,m)}else this.curveType==="catmullrom"&&(T1.initCatmullRom(l.x,p.x,h.x,u.x,this.tension),M1.initCatmullRom(l.y,p.y,h.y,u.y,this.tension),A1.initCatmullRom(l.z,p.z,h.z,u.z,this.tension));return s.set(T1.calc(c),M1.calc(c),A1.calc(c)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t.closed=this.closed,t.curveType=this.curveType,t.tension=this.tension,t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new S().fromArray(i))}return this.closed=t.closed,this.curveType=t.curveType,this.tension=t.tension,this}}function e3(o,t,e,s,i){const n=(s-t)*.5,r=(i-e)*.5,a=o*o,c=o*a;return(2*e-2*s+n+r)*c+(-3*e+3*s-2*n-r)*a+n*o+e}function Vf(o,t){const e=1-o;return e*e*t}function Gf(o,t){return 2*(1-o)*o*t}function Of(o,t){return o*o*t}function Aa(o,t,e,s){return Vf(o,t)+Gf(o,e)+Of(o,s)}function Wf(o,t){const e=1-o;return e*e*e*t}function $f(o,t){const e=1-o;return 3*e*e*o*t}function Hf(o,t){return 3*(1-o)*o*o*t}function qf(o,t){return o*o*o*t}function Na(o,t,e,s,i){return Wf(o,t)+$f(o,e)+Hf(o,s)+qf(o,i)}class L4 extends ii{constructor(t=new Y,e=new Y,s=new Y,i=new Y){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new Y){const s=e,i=this.v0,n=this.v1,r=this.v2,a=this.v3;return s.set(Na(t,i.x,n.x,r.x,a.x),Na(t,i.y,n.y,r.y,a.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class Yf extends ii{constructor(t=new S,e=new S,s=new S,i=new S){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=t,this.v1=e,this.v2=s,this.v3=i}getPoint(t,e=new S){const s=e,i=this.v0,n=this.v1,r=this.v2,a=this.v3;return s.set(Na(t,i.x,n.x,r.x,a.x),Na(t,i.y,n.y,r.y,a.y),Na(t,i.z,n.z,r.z,a.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this.v3.copy(t.v3),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t.v3=this.v3.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this.v3.fromArray(t.v3),this}}class U4 extends ii{constructor(t=new Y,e=new Y){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=t,this.v2=e}getPoint(t,e=new Y){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new Y){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class Xf extends ii{constructor(t=new S,e=new S){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=t,this.v2=e}getPoint(t,e=new S){const s=e;return t===1?s.copy(this.v2):(s.copy(this.v2).sub(this.v1),s.multiplyScalar(t).add(this.v1)),s}getPointAt(t,e){return this.getPoint(t,e)}getTangent(t,e=new S){return e.subVectors(this.v2,this.v1).normalize()}getTangentAt(t,e){return this.getTangent(t,e)}copy(t){return super.copy(t),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class z4 extends ii{constructor(t=new Y,e=new Y,s=new Y){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new Y){const s=e,i=this.v0,n=this.v1,r=this.v2;return s.set(Aa(t,i.x,n.x,r.x),Aa(t,i.y,n.y,r.y)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class k4 extends ii{constructor(t=new S,e=new S,s=new S){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=t,this.v1=e,this.v2=s}getPoint(t,e=new S){const s=e,i=this.v0,n=this.v1,r=this.v2;return s.set(Aa(t,i.x,n.x,r.x),Aa(t,i.y,n.y,r.y),Aa(t,i.z,n.z,r.z)),s}copy(t){return super.copy(t),this.v0.copy(t.v0),this.v1.copy(t.v1),this.v2.copy(t.v2),this}toJSON(){const t=super.toJSON();return t.v0=this.v0.toArray(),t.v1=this.v1.toArray(),t.v2=this.v2.toArray(),t}fromJSON(t){return super.fromJSON(t),this.v0.fromArray(t.v0),this.v1.fromArray(t.v1),this.v2.fromArray(t.v2),this}}class V4 extends ii{constructor(t=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=t}getPoint(t,e=new Y){const s=e,i=this.points,n=(i.length-1)*t,r=Math.floor(n),a=n-r,c=i[r===0?r:r-1],l=i[r],u=i[r>i.length-2?i.length-1:r+1],p=i[r>i.length-3?i.length-1:r+2];return s.set(e3(a,c.x,l.x,u.x,p.x),e3(a,c.y,l.y,u.y,p.y)),s}copy(t){super.copy(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.points=[];for(let e=0,s=this.points.length;e<s;e++){const i=this.points[e];t.points.push(i.toArray())}return t}fromJSON(t){super.fromJSON(t),this.points=[];for(let e=0,s=t.points.length;e<s;e++){const i=t.points[e];this.points.push(new Y().fromArray(i))}return this}}var ju=Object.freeze({__proto__:null,ArcCurve:kf,CatmullRomCurve3:I4,CubicBezierCurve:L4,CubicBezierCurve3:Yf,EllipseCurve:Kp,LineCurve:U4,LineCurve3:Xf,QuadraticBezierCurve:z4,QuadraticBezierCurve3:k4,SplineCurve:V4});class Zf extends ii{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(t){this.curves.push(t)}closePath(){const t=this.curves[0].getPoint(0),e=this.curves[this.curves.length-1].getPoint(1);if(!t.equals(e)){const s=t.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new ju[s](e,t))}return this}getPoint(t,e){const s=t*this.getLength(),i=this.getCurveLengths();let n=0;for(;n<i.length;){if(i[n]>=s){const r=i[n]-s,a=this.curves[n],c=a.getLength(),l=c===0?0:1-r/c;return a.getPointAt(l,e)}n++}return null}getLength(){const t=this.getCurveLengths();return t[t.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const t=[];let e=0;for(let s=0,i=this.curves.length;s<i;s++)e+=this.curves[s].getLength(),t.push(e);return this.cacheLengths=t,t}getSpacedPoints(t=40){const e=[];for(let s=0;s<=t;s++)e.push(this.getPoint(s/t));return this.autoClose&&e.push(e[0]),e}getPoints(t=12){const e=[];let s;for(let i=0,n=this.curves;i<n.length;i++){const r=n[i],a=r.isEllipseCurve?t*2:r.isLineCurve||r.isLineCurve3?1:r.isSplineCurve?t*r.points.length:t,c=r.getPoints(a);for(let l=0;l<c.length;l++){const u=c[l];s&&s.equals(u)||(e.push(u),s=u)}}return this.autoClose&&e.length>1&&!e[e.length-1].equals(e[0])&&e.push(e[0]),e}copy(t){super.copy(t),this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(i.clone())}return this.autoClose=t.autoClose,this}toJSON(){const t=super.toJSON();t.autoClose=this.autoClose,t.curves=[];for(let e=0,s=this.curves.length;e<s;e++){const i=this.curves[e];t.curves.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.autoClose=t.autoClose,this.curves=[];for(let e=0,s=t.curves.length;e<s;e++){const i=t.curves[e];this.curves.push(new ju[i.type]().fromJSON(i))}return this}}class Ku extends Zf{constructor(t){super(),this.type="Path",this.currentPoint=new Y,t&&this.setFromPoints(t)}setFromPoints(t){this.moveTo(t[0].x,t[0].y);for(let e=1,s=t.length;e<s;e++)this.lineTo(t[e].x,t[e].y);return this}moveTo(t,e){return this.currentPoint.set(t,e),this}lineTo(t,e){const s=new U4(this.currentPoint.clone(),new Y(t,e));return this.curves.push(s),this.currentPoint.set(t,e),this}quadraticCurveTo(t,e,s,i){const n=new z4(this.currentPoint.clone(),new Y(t,e),new Y(s,i));return this.curves.push(n),this.currentPoint.set(s,i),this}bezierCurveTo(t,e,s,i,n,r){const a=new L4(this.currentPoint.clone(),new Y(t,e),new Y(s,i),new Y(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}splineThru(t){const e=[this.currentPoint.clone()].concat(t),s=new V4(e);return this.curves.push(s),this.currentPoint.copy(t[t.length-1]),this}arc(t,e,s,i,n,r){const a=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(t+a,e+c,s,i,n,r),this}absarc(t,e,s,i,n,r){return this.absellipse(t,e,s,s,i,n,r),this}ellipse(t,e,s,i,n,r,a,c){const l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(t+l,e+u,s,i,n,r,a,c),this}absellipse(t,e,s,i,n,r,a,c){const l=new Kp(t,e,s,i,n,r,a,c);if(this.curves.length>0){const p=l.getPoint(0);p.equals(this.currentPoint)||this.lineTo(p.x,p.y)}this.curves.push(l);const u=l.getPoint(1);return this.currentPoint.copy(u),this}copy(t){return super.copy(t),this.currentPoint.copy(t.currentPoint),this}toJSON(){const t=super.toJSON();return t.currentPoint=this.currentPoint.toArray(),t}fromJSON(t){return super.fromJSON(t),this.currentPoint.fromArray(t.currentPoint),this}}class Qp extends zt{constructor(t=[new Y(0,-.5),new Y(.5,0),new Y(0,.5)],e=12,s=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:t,segments:e,phiStart:s,phiLength:i},e=Math.floor(e),i=dt(i,0,Math.PI*2);const n=[],r=[],a=[],c=[],l=[],u=1/e,p=new S,h=new Y,d=new S,g=new S,f=new S;let m=0,x=0;for(let w=0;w<=t.length-1;w++)switch(w){case 0:m=t[w+1].x-t[w].x,x=t[w+1].y-t[w].y,d.x=x*1,d.y=-m,d.z=x*0,f.copy(d),d.normalize(),c.push(d.x,d.y,d.z);break;case t.length-1:c.push(f.x,f.y,f.z);break;default:m=t[w+1].x-t[w].x,x=t[w+1].y-t[w].y,d.x=x*1,d.y=-m,d.z=x*0,g.copy(d),d.x+=f.x,d.y+=f.y,d.z+=f.z,d.normalize(),c.push(d.x,d.y,d.z),f.copy(g)}for(let w=0;w<=e;w++){const b=s+w*u*i,v=Math.sin(b),T=Math.cos(b);for(let M=0;M<=t.length-1;M++){p.x=t[M].x*v,p.y=t[M].y,p.z=t[M].x*T,r.push(p.x,p.y,p.z),h.x=w/e,h.y=M/(t.length-1),a.push(h.x,h.y);const F=c[3*M+0]*v,N=c[3*M+1],A=c[3*M+0]*T;l.push(F,N,A)}}for(let w=0;w<e;w++)for(let b=0;b<t.length-1;b++){const v=b+w*t.length,T=v,M=v+t.length,F=v+t.length+1,N=v+1;n.push(T,M,N),n.push(F,N,M)}this.setIndex(n),this.setAttribute("position",new mt(r,3)),this.setAttribute("uv",new mt(a,2)),this.setAttribute("normal",new mt(l,3))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qp(t.points,t.segments,t.phiStart,t.phiLength)}}class o0 extends Qp{constructor(t=1,e=1,s=4,i=8){const n=new Ku;n.absarc(0,-e/2,t,Math.PI*1.5,0),n.absarc(0,e/2,t,0,Math.PI*.5),super(n.getPoints(s),i),this.type="CapsuleGeometry",this.parameters={radius:t,length:e,capSegments:s,radialSegments:i}}static fromJSON(t){return new o0(t.radius,t.length,t.capSegments,t.radialSegments)}}class _l extends zt{constructor(t=1,e=32,s=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:t,segments:e,thetaStart:s,thetaLength:i},e=Math.max(3,e);const n=[],r=[],a=[],c=[],l=new S,u=new Y;r.push(0,0,0),a.push(0,0,1),c.push(.5,.5);for(let p=0,h=3;p<=e;p++,h+=3){const d=s+p/e*i;l.x=t*Math.cos(d),l.y=t*Math.sin(d),r.push(l.x,l.y,l.z),a.push(0,0,1),u.x=(r[h]/t+1)/2,u.y=(r[h+1]/t+1)/2,c.push(u.x,u.y)}for(let p=1;p<=e;p++)n.push(p,p+1,0);this.setIndex(n),this.setAttribute("position",new mt(r,3)),this.setAttribute("normal",new mt(a,3)),this.setAttribute("uv",new mt(c,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new _l(t.radius,t.segments,t.thetaStart,t.thetaLength)}}class Re extends zt{constructor(t=1,e=1,s=1,i=32,n=1,r=!1,a=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:t,radiusBottom:e,height:s,radialSegments:i,heightSegments:n,openEnded:r,thetaStart:a,thetaLength:c};const l=this;i=Math.floor(i),n=Math.floor(n);const u=[],p=[],h=[],d=[];let g=0;const f=[],m=s/2;let x=0;w(),r===!1&&(t>0&&b(!0),e>0&&b(!1)),this.setIndex(u),this.setAttribute("position",new mt(p,3)),this.setAttribute("normal",new mt(h,3)),this.setAttribute("uv",new mt(d,2));function w(){const v=new S,T=new S;let M=0;const F=(e-t)/s;for(let N=0;N<=n;N++){const A=[],E=N/n,U=E*(e-t)+t;for(let $=0;$<=i;$++){const Z=$/i,j=Z*c+a,ut=Math.sin(j),nt=Math.cos(j);T.x=U*ut,T.y=-E*s+m,T.z=U*nt,p.push(T.x,T.y,T.z),v.set(ut,F,nt).normalize(),h.push(v.x,v.y,v.z),d.push(Z,1-E),A.push(g++)}f.push(A)}for(let N=0;N<i;N++)for(let A=0;A<n;A++){const E=f[A][N],U=f[A+1][N],$=f[A+1][N+1],Z=f[A][N+1];(t>0||A!==0)&&(u.push(E,U,Z),M+=3),(e>0||A!==n-1)&&(u.push(U,$,Z),M+=3)}l.addGroup(x,M,0),x+=M}function b(v){const T=g,M=new Y,F=new S;let N=0;const A=v===!0?t:e,E=v===!0?1:-1;for(let $=1;$<=i;$++)p.push(0,m*E,0),h.push(0,E,0),d.push(.5,.5),g++;const U=g;for(let $=0;$<=i;$++){const j=$/i*c+a,ut=Math.cos(j),nt=Math.sin(j);F.x=A*nt,F.y=m*E,F.z=A*ut,p.push(F.x,F.y,F.z),h.push(0,E,0),M.x=ut*.5+.5,M.y=nt*.5*E+.5,d.push(M.x,M.y),g++}for(let $=0;$<i;$++){const Z=T+$,j=U+$;v===!0?u.push(j,j+1,Z):u.push(j+1,j,Z),N+=3}l.addGroup(x,N,v===!0?1:2),x+=N}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Re(t.radiusTop,t.radiusBottom,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class Rn extends Re{constructor(t=1,e=1,s=32,i=1,n=!1,r=0,a=Math.PI*2){super(0,t,e,s,i,n,r,a),this.type="ConeGeometry",this.parameters={radius:t,height:e,radialSegments:s,heightSegments:i,openEnded:n,thetaStart:r,thetaLength:a}}static fromJSON(t){return new Rn(t.radius,t.height,t.radialSegments,t.heightSegments,t.openEnded,t.thetaStart,t.thetaLength)}}class t2 extends zt{constructor(t=[],e=[],s=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:t,indices:e,radius:s,detail:i};const n=[],r=[];a(i),l(s),u(),this.setAttribute("position",new mt(n,3)),this.setAttribute("normal",new mt(n.slice(),3)),this.setAttribute("uv",new mt(r,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function a(w){const b=new S,v=new S,T=new S;for(let M=0;M<e.length;M+=3)d(e[M+0],b),d(e[M+1],v),d(e[M+2],T),c(b,v,T,w)}function c(w,b,v,T){const M=T+1,F=[];for(let N=0;N<=M;N++){F[N]=[];const A=w.clone().lerp(v,N/M),E=b.clone().lerp(v,N/M),U=M-N;for(let $=0;$<=U;$++)$===0&&N===M?F[N][$]=A:F[N][$]=A.clone().lerp(E,$/U)}for(let N=0;N<M;N++)for(let A=0;A<2*(M-N)-1;A++){const E=Math.floor(A/2);A%2===0?(h(F[N][E+1]),h(F[N+1][E]),h(F[N][E])):(h(F[N][E+1]),h(F[N+1][E+1]),h(F[N+1][E]))}}function l(w){const b=new S;for(let v=0;v<n.length;v+=3)b.x=n[v+0],b.y=n[v+1],b.z=n[v+2],b.normalize().multiplyScalar(w),n[v+0]=b.x,n[v+1]=b.y,n[v+2]=b.z}function u(){const w=new S;for(let b=0;b<n.length;b+=3){w.x=n[b+0],w.y=n[b+1],w.z=n[b+2];const v=m(w)/2/Math.PI+.5,T=x(w)/Math.PI+.5;r.push(v,1-T)}g(),p()}function p(){for(let w=0;w<r.length;w+=6){const b=r[w+0],v=r[w+2],T=r[w+4],M=Math.max(b,v,T),F=Math.min(b,v,T);M>.9&&F<.1&&(b<.2&&(r[w+0]+=1),v<.2&&(r[w+2]+=1),T<.2&&(r[w+4]+=1))}}function h(w){n.push(w.x,w.y,w.z)}function d(w,b){const v=w*3;b.x=t[v+0],b.y=t[v+1],b.z=t[v+2]}function g(){const w=new S,b=new S,v=new S,T=new S,M=new Y,F=new Y,N=new Y;for(let A=0,E=0;A<n.length;A+=9,E+=6){w.set(n[A+0],n[A+1],n[A+2]),b.set(n[A+3],n[A+4],n[A+5]),v.set(n[A+6],n[A+7],n[A+8]),M.set(r[E+0],r[E+1]),F.set(r[E+2],r[E+3]),N.set(r[E+4],r[E+5]),T.copy(w).add(b).add(v).divideScalar(3);const U=m(T);f(M,E+0,w,U),f(F,E+2,b,U),f(N,E+4,v,U)}}function f(w,b,v,T){T<0&&w.x===1&&(r[b]=w.x-1),v.x===0&&v.z===0&&(r[b]=T/2/Math.PI+.5)}function m(w){return Math.atan2(w.z,-w.x)}function x(w){return Math.atan2(-w.y,Math.sqrt(w.x*w.x+w.z*w.z))}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new t2(t.vertices,t.indices,t.radius,t.details)}}class G4 extends Ku{constructor(t){super(t),this.uuid=di(),this.type="Shape",this.holes=[]}getPointsHoles(t){const e=[];for(let s=0,i=this.holes.length;s<i;s++)e[s]=this.holes[s].getPoints(t);return e}extractPoints(t){return{shape:this.getPoints(t),holes:this.getPointsHoles(t)}}copy(t){super.copy(t),this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(i.clone())}return this}toJSON(){const t=super.toJSON();t.uuid=this.uuid,t.holes=[];for(let e=0,s=this.holes.length;e<s;e++){const i=this.holes[e];t.holes.push(i.toJSON())}return t}fromJSON(t){super.fromJSON(t),this.uuid=t.uuid,this.holes=[];for(let e=0,s=t.holes.length;e<s;e++){const i=t.holes[e];this.holes.push(new Ku().fromJSON(i))}return this}}const jf={triangulate:function(o,t,e=2){const s=t&&t.length,i=s?t[0]*e:o.length;let n=O4(o,0,i,e,!0);const r=[];if(!n||n.next===n.prev)return r;let a,c,l,u,p,h,d;if(s&&(n=em(o,t,n,e)),o.length>80*e){a=l=o[0],c=u=o[1];for(let g=e;g<i;g+=e)p=o[g],h=o[g+1],p<a&&(a=p),h<c&&(c=h),p>l&&(l=p),h>u&&(u=h);d=Math.max(l-a,u-c),d=d!==0?32767/d:0}return Oa(n,r,e,a,c,d,0),r}};function O4(o,t,e,s,i){let n,r;if(i===hm(o,t,e,s)>0)for(n=t;n<e;n+=s)r=s3(n,o[n],o[n+1],r);else for(n=e-s;n>=t;n-=s)r=s3(n,o[n],o[n+1],r);return r&&Sl(r,r.next)&&($a(r),r=r.next),r}function wo(o,t){if(!o)return o;t||(t=o);let e=o,s;do if(s=!1,!e.steiner&&(Sl(e,e.next)||oe(e.prev,e,e.next)===0)){if($a(e),e=t=e.prev,e===e.next)break;s=!0}else e=e.next;while(s||e!==t);return t}function Oa(o,t,e,s,i,n,r){if(!o)return;!r&&n&&rm(o,s,i,n);let a=o,c,l;for(;o.prev!==o.next;){if(c=o.prev,l=o.next,n?Jf(o,s,i,n):Kf(o)){t.push(c.i/e|0),t.push(o.i/e|0),t.push(l.i/e|0),$a(o),o=l.next,a=l.next;continue}if(o=l,o===a){r?r===1?(o=Qf(wo(o),t,e),Oa(o,t,e,s,i,n,2)):r===2&&tm(o,t,e,s,i,n):Oa(wo(o),t,e,s,i,n,1);break}}}function Kf(o){const t=o.prev,e=o,s=o.next;if(oe(t,e,s)>=0)return!1;const i=t.x,n=e.x,r=s.x,a=t.y,c=e.y,l=s.y,u=i<n?i<r?i:r:n<r?n:r,p=a<c?a<l?a:l:c<l?c:l,h=i>n?i>r?i:r:n>r?n:r,d=a>c?a>l?a:l:c>l?c:l;let g=s.next;for(;g!==t;){if(g.x>=u&&g.x<=h&&g.y>=p&&g.y<=d&&gr(i,a,n,c,r,l,g.x,g.y)&&oe(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function Jf(o,t,e,s){const i=o.prev,n=o,r=o.next;if(oe(i,n,r)>=0)return!1;const a=i.x,c=n.x,l=r.x,u=i.y,p=n.y,h=r.y,d=a<c?a<l?a:l:c<l?c:l,g=u<p?u<h?u:h:p<h?p:h,f=a>c?a>l?a:l:c>l?c:l,m=u>p?u>h?u:h:p>h?p:h,x=Ju(d,g,t,e,s),w=Ju(f,m,t,e,s);let b=o.prevZ,v=o.nextZ;for(;b&&b.z>=x&&v&&v.z<=w;){if(b.x>=d&&b.x<=f&&b.y>=g&&b.y<=m&&b!==i&&b!==r&&gr(a,u,c,p,l,h,b.x,b.y)&&oe(b.prev,b,b.next)>=0||(b=b.prevZ,v.x>=d&&v.x<=f&&v.y>=g&&v.y<=m&&v!==i&&v!==r&&gr(a,u,c,p,l,h,v.x,v.y)&&oe(v.prev,v,v.next)>=0))return!1;v=v.nextZ}for(;b&&b.z>=x;){if(b.x>=d&&b.x<=f&&b.y>=g&&b.y<=m&&b!==i&&b!==r&&gr(a,u,c,p,l,h,b.x,b.y)&&oe(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;v&&v.z<=w;){if(v.x>=d&&v.x<=f&&v.y>=g&&v.y<=m&&v!==i&&v!==r&&gr(a,u,c,p,l,h,v.x,v.y)&&oe(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Qf(o,t,e){let s=o;do{const i=s.prev,n=s.next.next;!Sl(i,n)&&W4(i,s,s.next,n)&&Wa(i,n)&&Wa(n,i)&&(t.push(i.i/e|0),t.push(s.i/e|0),t.push(n.i/e|0),$a(s),$a(s.next),s=o=n),s=s.next}while(s!==o);return wo(s)}function tm(o,t,e,s,i,n){let r=o;do{let a=r.next.next;for(;a!==r.prev;){if(r.i!==a.i&&lm(r,a)){let c=$4(r,a);r=wo(r,r.next),c=wo(c,c.next),Oa(r,t,e,s,i,n,0),Oa(c,t,e,s,i,n,0);return}a=a.next}r=r.next}while(r!==o)}function em(o,t,e,s){const i=[];let n,r,a,c,l;for(n=0,r=t.length;n<r;n++)a=t[n]*s,c=n<r-1?t[n+1]*s:o.length,l=O4(o,a,c,s,!1),l===l.next&&(l.steiner=!0),i.push(cm(l));for(i.sort(sm),n=0;n<i.length;n++)e=im(i[n],e);return e}function sm(o,t){return o.x-t.x}function im(o,t){const e=nm(o,t);if(!e)return t;const s=$4(e,o);return wo(s,s.next),wo(e,e.next)}function nm(o,t){let e=t,s=-1/0,i;const n=o.x,r=o.y;do{if(r<=e.y&&r>=e.next.y&&e.next.y!==e.y){const h=e.x+(r-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(h<=n&&h>s&&(s=h,i=e.x<e.next.x?e:e.next,h===n))return i}e=e.next}while(e!==t);if(!i)return null;const a=i,c=i.x,l=i.y;let u=1/0,p;e=i;do n>=e.x&&e.x>=c&&n!==e.x&&gr(r<l?n:s,r,c,l,r<l?s:n,r,e.x,e.y)&&(p=Math.abs(r-e.y)/(n-e.x),Wa(e,o)&&(p<u||p===u&&(e.x>i.x||e.x===i.x&&om(i,e)))&&(i=e,u=p)),e=e.next;while(e!==a);return i}function om(o,t){return oe(o.prev,o,t.prev)<0&&oe(t.next,o,o.next)<0}function rm(o,t,e,s){let i=o;do i.z===0&&(i.z=Ju(i.x,i.y,t,e,s)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==o);i.prevZ.nextZ=null,i.prevZ=null,am(i)}function am(o){let t,e,s,i,n,r,a,c,l=1;do{for(e=o,o=null,n=null,r=0;e;){for(r++,s=e,a=0,t=0;t<l&&(a++,s=s.nextZ,!!s);t++);for(c=l;a>0||c>0&&s;)a!==0&&(c===0||!s||e.z<=s.z)?(i=e,e=e.nextZ,a--):(i=s,s=s.nextZ,c--),n?n.nextZ=i:o=i,i.prevZ=n,n=i;e=s}n.nextZ=null,l*=2}while(r>1);return o}function Ju(o,t,e,s,i){return o=(o-e)*i|0,t=(t-s)*i|0,o=(o|o<<8)&16711935,o=(o|o<<4)&252645135,o=(o|o<<2)&858993459,o=(o|o<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,o|t<<1}function cm(o){let t=o,e=o;do(t.x<e.x||t.x===e.x&&t.y<e.y)&&(e=t),t=t.next;while(t!==o);return e}function gr(o,t,e,s,i,n,r,a){return(i-r)*(t-a)>=(o-r)*(n-a)&&(o-r)*(s-a)>=(e-r)*(t-a)&&(e-r)*(n-a)>=(i-r)*(s-a)}function lm(o,t){return o.next.i!==t.i&&o.prev.i!==t.i&&!um(o,t)&&(Wa(o,t)&&Wa(t,o)&&pm(o,t)&&(oe(o.prev,o,t.prev)||oe(o,t.prev,t))||Sl(o,t)&&oe(o.prev,o,o.next)>0&&oe(t.prev,t,t.next)>0)}function oe(o,t,e){return(t.y-o.y)*(e.x-t.x)-(t.x-o.x)*(e.y-t.y)}function Sl(o,t){return o.x===t.x&&o.y===t.y}function W4(o,t,e,s){const i=X0(oe(o,t,e)),n=X0(oe(o,t,s)),r=X0(oe(e,s,o)),a=X0(oe(e,s,t));return!!(i!==n&&r!==a||i===0&&Y0(o,e,t)||n===0&&Y0(o,s,t)||r===0&&Y0(e,o,s)||a===0&&Y0(e,t,s))}function Y0(o,t,e){return t.x<=Math.max(o.x,e.x)&&t.x>=Math.min(o.x,e.x)&&t.y<=Math.max(o.y,e.y)&&t.y>=Math.min(o.y,e.y)}function X0(o){return o>0?1:o<0?-1:0}function um(o,t){let e=o;do{if(e.i!==o.i&&e.next.i!==o.i&&e.i!==t.i&&e.next.i!==t.i&&W4(e,e.next,o,t))return!0;e=e.next}while(e!==o);return!1}function Wa(o,t){return oe(o.prev,o,o.next)<0?oe(o,t,o.next)>=0&&oe(o,o.prev,t)>=0:oe(o,t,o.prev)<0||oe(o,o.next,t)<0}function pm(o,t){let e=o,s=!1;const i=(o.x+t.x)/2,n=(o.y+t.y)/2;do e.y>n!=e.next.y>n&&e.next.y!==e.y&&i<(e.next.x-e.x)*(n-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next;while(e!==o);return s}function $4(o,t){const e=new Qu(o.i,o.x,o.y),s=new Qu(t.i,t.x,t.y),i=o.next,n=t.prev;return o.next=t,t.prev=o,e.next=i,i.prev=e,s.next=e,e.prev=s,n.next=s,s.prev=n,s}function s3(o,t,e,s){const i=new Qu(o,t,e);return s?(i.next=s.next,i.prev=s,s.next.prev=i,s.next=i):(i.prev=i,i.next=i),i}function $a(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Qu(o,t,e){this.i=o,this.x=t,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function hm(o,t,e,s){let i=0;for(let n=t,r=e-s;n<e;n+=s)i+=(o[r]-o[n])*(o[n+1]+o[r+1]),r=n;return i}class Ca{static area(t){const e=t.length;let s=0;for(let i=e-1,n=0;n<e;i=n++)s+=t[i].x*t[n].y-t[n].x*t[i].y;return s*.5}static isClockWise(t){return Ca.area(t)<0}static triangulateShape(t,e){const s=[],i=[],n=[];i3(t),n3(s,t);let r=t.length;e.forEach(i3);for(let c=0;c<e.length;c++)i.push(r),r+=e[c].length,n3(s,e[c]);const a=jf.triangulate(s,i);for(let c=0;c<a.length;c+=3)n.push(a.slice(c,c+3));return n}}function i3(o){const t=o.length;t>2&&o[t-1].equals(o[0])&&o.pop()}function n3(o,t){for(let e=0;e<t.length;e++)o.push(t[e].x),o.push(t[e].y)}class Dr extends t2{constructor(t=1,e=0){const s=(1+Math.sqrt(5))/2,i=[-1,s,0,1,s,0,-1,-s,0,1,-s,0,0,-1,s,0,1,s,0,-1,-s,0,1,-s,s,0,-1,s,0,1,-s,0,-1,-s,0,1],n=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,n,t,e),this.type="IcosahedronGeometry",this.parameters={radius:t,detail:e}}static fromJSON(t){return new Dr(t.radius,t.detail)}}class $i extends zt{constructor(t=1,e=1,s=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:t,height:e,widthSegments:s,heightSegments:i};const n=t/2,r=e/2,a=Math.floor(s),c=Math.floor(i),l=a+1,u=c+1,p=t/a,h=e/c,d=[],g=[],f=[],m=[];for(let x=0;x<u;x++){const w=x*h-r;for(let b=0;b<l;b++){const v=b*p-n;g.push(v,-w,0),f.push(0,0,1),m.push(b/a),m.push(1-x/c)}}for(let x=0;x<c;x++)for(let w=0;w<a;w++){const b=w+l*x,v=w+l*(x+1),T=w+1+l*(x+1),M=w+1+l*x;d.push(b,v,M),d.push(v,T,M)}this.setIndex(d),this.setAttribute("position",new mt(g,3)),this.setAttribute("normal",new mt(f,3)),this.setAttribute("uv",new mt(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new $i(t.width,t.height,t.widthSegments,t.heightSegments)}}class r0 extends zt{constructor(t=.5,e=1,s=32,i=1,n=0,r=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:t,outerRadius:e,thetaSegments:s,phiSegments:i,thetaStart:n,thetaLength:r},s=Math.max(3,s),i=Math.max(1,i);const a=[],c=[],l=[],u=[];let p=t;const h=(e-t)/i,d=new S,g=new Y;for(let f=0;f<=i;f++){for(let m=0;m<=s;m++){const x=n+m/s*r;d.x=p*Math.cos(x),d.y=p*Math.sin(x),c.push(d.x,d.y,d.z),l.push(0,0,1),g.x=(d.x/e+1)/2,g.y=(d.y/e+1)/2,u.push(g.x,g.y)}p+=h}for(let f=0;f<i;f++){const m=f*(s+1);for(let x=0;x<s;x++){const w=x+m,b=w,v=w+s+1,T=w+s+2,M=w+1;a.push(b,v,M),a.push(v,T,M)}}this.setIndex(a),this.setAttribute("position",new mt(c,3)),this.setAttribute("normal",new mt(l,3)),this.setAttribute("uv",new mt(u,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new r0(t.innerRadius,t.outerRadius,t.thetaSegments,t.phiSegments,t.thetaStart,t.thetaLength)}}class e2 extends zt{constructor(t=new G4([new Y(0,.5),new Y(-.5,-.5),new Y(.5,-.5)]),e=12){super(),this.type="ShapeGeometry",this.parameters={shapes:t,curveSegments:e};const s=[],i=[],n=[],r=[];let a=0,c=0;if(Array.isArray(t)===!1)l(t);else for(let u=0;u<t.length;u++)l(t[u]),this.addGroup(a,c,u),a+=c,c=0;this.setIndex(s),this.setAttribute("position",new mt(i,3)),this.setAttribute("normal",new mt(n,3)),this.setAttribute("uv",new mt(r,2));function l(u){const p=i.length/3,h=u.extractPoints(e);let d=h.shape;const g=h.holes;Ca.isClockWise(d)===!1&&(d=d.reverse());for(let m=0,x=g.length;m<x;m++){const w=g[m];Ca.isClockWise(w)===!0&&(g[m]=w.reverse())}const f=Ca.triangulateShape(d,g);for(let m=0,x=g.length;m<x;m++){const w=g[m];d=d.concat(w)}for(let m=0,x=d.length;m<x;m++){const w=d[m];i.push(w.x,w.y,0),n.push(0,0,1),r.push(w.x,w.y)}for(let m=0,x=f.length;m<x;m++){const w=f[m],b=w[0]+p,v=w[1]+p,T=w[2]+p;s.push(b,v,T),c+=3}}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON(),e=this.parameters.shapes;return dm(e,t)}static fromJSON(t,e){const s=[];for(let i=0,n=t.shapes.length;i<n;i++){const r=e[t.shapes[i]];s.push(r)}return new e2(s,t.curveSegments)}}function dm(o,t){if(t.shapes=[],Array.isArray(o))for(let e=0,s=o.length;e<s;e++){const i=o[e];t.shapes.push(i.uuid)}else t.shapes.push(o.uuid);return t}class ne extends zt{constructor(t=1,e=32,s=16,i=0,n=Math.PI*2,r=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:t,widthSegments:e,heightSegments:s,phiStart:i,phiLength:n,thetaStart:r,thetaLength:a},e=Math.max(3,Math.floor(e)),s=Math.max(2,Math.floor(s));const c=Math.min(r+a,Math.PI);let l=0;const u=[],p=new S,h=new S,d=[],g=[],f=[],m=[];for(let x=0;x<=s;x++){const w=[],b=x/s;let v=0;x===0&&r===0?v=.5/e:x===s&&c===Math.PI&&(v=-.5/e);for(let T=0;T<=e;T++){const M=T/e;p.x=-t*Math.cos(i+M*n)*Math.sin(r+b*a),p.y=t*Math.cos(r+b*a),p.z=t*Math.sin(i+M*n)*Math.sin(r+b*a),g.push(p.x,p.y,p.z),h.copy(p).normalize(),f.push(h.x,h.y,h.z),m.push(M+v,1-b),w.push(l++)}u.push(w)}for(let x=0;x<s;x++)for(let w=0;w<e;w++){const b=u[x][w+1],v=u[x][w],T=u[x+1][w],M=u[x+1][w+1];(x!==0||r>0)&&d.push(b,v,M),(x!==s-1||c<Math.PI)&&d.push(v,T,M)}this.setIndex(d),this.setAttribute("position",new mt(g,3)),this.setAttribute("normal",new mt(f,3)),this.setAttribute("uv",new mt(m,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new ne(t.radius,t.widthSegments,t.heightSegments,t.phiStart,t.phiLength,t.thetaStart,t.thetaLength)}}class Qi extends zt{constructor(t=1,e=.4,s=12,i=48,n=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:t,tube:e,radialSegments:s,tubularSegments:i,arc:n},s=Math.floor(s),i=Math.floor(i);const r=[],a=[],c=[],l=[],u=new S,p=new S,h=new S;for(let d=0;d<=s;d++)for(let g=0;g<=i;g++){const f=g/i*n,m=d/s*Math.PI*2;p.x=(t+e*Math.cos(m))*Math.cos(f),p.y=(t+e*Math.cos(m))*Math.sin(f),p.z=e*Math.sin(m),a.push(p.x,p.y,p.z),u.x=t*Math.cos(f),u.y=t*Math.sin(f),h.subVectors(p,u).normalize(),c.push(h.x,h.y,h.z),l.push(g/i),l.push(d/s)}for(let d=1;d<=s;d++)for(let g=1;g<=i;g++){const f=(i+1)*d+g-1,m=(i+1)*(d-1)+g-1,x=(i+1)*(d-1)+g,w=(i+1)*d+g;r.push(f,m,w),r.push(m,x,w)}this.setIndex(r),this.setAttribute("position",new mt(a,3)),this.setAttribute("normal",new mt(c,3)),this.setAttribute("uv",new mt(l,2))}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new Qi(t.radius,t.tube,t.radialSegments,t.tubularSegments,t.arc)}}class s2 extends zt{constructor(t=1,e=.4,s=64,i=8,n=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:t,tube:e,tubularSegments:s,radialSegments:i,p:n,q:r},s=Math.floor(s),i=Math.floor(i);const a=[],c=[],l=[],u=[],p=new S,h=new S,d=new S,g=new S,f=new S,m=new S,x=new S;for(let b=0;b<=s;++b){const v=b/s*n*Math.PI*2;w(v,n,r,t,d),w(v+.01,n,r,t,g),m.subVectors(g,d),x.addVectors(g,d),f.crossVectors(m,x),x.crossVectors(f,m),f.normalize(),x.normalize();for(let T=0;T<=i;++T){const M=T/i*Math.PI*2,F=-e*Math.cos(M),N=e*Math.sin(M);p.x=d.x+(F*x.x+N*f.x),p.y=d.y+(F*x.y+N*f.y),p.z=d.z+(F*x.z+N*f.z),c.push(p.x,p.y,p.z),h.subVectors(p,d).normalize(),l.push(h.x,h.y,h.z),u.push(b/s),u.push(T/i)}}for(let b=1;b<=s;b++)for(let v=1;v<=i;v++){const T=(i+1)*(b-1)+(v-1),M=(i+1)*b+(v-1),F=(i+1)*b+v,N=(i+1)*(b-1)+v;a.push(T,M,N),a.push(M,F,N)}this.setIndex(a),this.setAttribute("position",new mt(c,3)),this.setAttribute("normal",new mt(l,3)),this.setAttribute("uv",new mt(u,2));function w(b,v,T,M,F){const N=Math.cos(b),A=Math.sin(b),E=T/v*b,U=Math.cos(E);F.x=M*(2+U)*.5*N,F.y=M*(2+U)*A*.5,F.z=M*Math.sin(E)*.5}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}static fromJSON(t){return new s2(t.radius,t.tube,t.tubularSegments,t.radialSegments,t.p,t.q)}}class Tl extends zt{constructor(t=new k4(new S(-1,-1,0),new S(-1,1,0),new S(1,1,0)),e=64,s=1,i=8,n=!1){super(),this.type="TubeGeometry",this.parameters={path:t,tubularSegments:e,radius:s,radialSegments:i,closed:n};const r=t.computeFrenetFrames(e,n);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const a=new S,c=new S,l=new Y;let u=new S;const p=[],h=[],d=[],g=[];f(),this.setIndex(g),this.setAttribute("position",new mt(p,3)),this.setAttribute("normal",new mt(h,3)),this.setAttribute("uv",new mt(d,2));function f(){for(let b=0;b<e;b++)m(b);m(n===!1?e:0),w(),x()}function m(b){u=t.getPointAt(b/e,u);const v=r.normals[b],T=r.binormals[b];for(let M=0;M<=i;M++){const F=M/i*Math.PI*2,N=Math.sin(F),A=-Math.cos(F);c.x=A*v.x+N*T.x,c.y=A*v.y+N*T.y,c.z=A*v.z+N*T.z,c.normalize(),h.push(c.x,c.y,c.z),a.x=u.x+s*c.x,a.y=u.y+s*c.y,a.z=u.z+s*c.z,p.push(a.x,a.y,a.z)}}function x(){for(let b=1;b<=e;b++)for(let v=1;v<=i;v++){const T=(i+1)*(b-1)+(v-1),M=(i+1)*b+(v-1),F=(i+1)*b+v,N=(i+1)*(b-1)+v;g.push(T,M,N),g.push(M,F,N)}}function w(){for(let b=0;b<=e;b++)for(let v=0;v<=i;v++)l.x=b/e,l.y=v/i,d.push(l.x,l.y)}}copy(t){return super.copy(t),this.parameters=Object.assign({},t.parameters),this}toJSON(){const t=super.toJSON();return t.path=this.parameters.path.toJSON(),t}static fromJSON(t){return new Tl(new ju[t.path.type]().fromJSON(t.path),t.tubularSegments,t.radius,t.radialSegments,t.closed)}}class gm extends us{constructor(t){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new W(0),this.transparent=!0,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.fog=t.fog,this}}class xi extends us{constructor(t){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new W(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new As,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={STANDARD:""},this.color.copy(t.color),this.roughness=t.roughness,this.metalness=t.metalness,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.roughnessMap=t.roughnessMap,this.metalnessMap=t.metalnessMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.envMapIntensity=t.envMapIntensity,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class H4 extends xi{constructor(t){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Y(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return dt(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new W(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new W(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new W(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(t)}get anisotropy(){return this._anisotropy}set anisotropy(t){this._anisotropy>0!=t>0&&this.version++,this._anisotropy=t}get clearcoat(){return this._clearcoat}set clearcoat(t){this._clearcoat>0!=t>0&&this.version++,this._clearcoat=t}get iridescence(){return this._iridescence}set iridescence(t){this._iridescence>0!=t>0&&this.version++,this._iridescence=t}get dispersion(){return this._dispersion}set dispersion(t){this._dispersion>0!=t>0&&this.version++,this._dispersion=t}get sheen(){return this._sheen}set sheen(t){this._sheen>0!=t>0&&this.version++,this._sheen=t}get transmission(){return this._transmission}set transmission(t){this._transmission>0!=t>0&&this.version++,this._transmission=t}copy(t){return super.copy(t),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=t.anisotropy,this.anisotropyRotation=t.anisotropyRotation,this.anisotropyMap=t.anisotropyMap,this.clearcoat=t.clearcoat,this.clearcoatMap=t.clearcoatMap,this.clearcoatRoughness=t.clearcoatRoughness,this.clearcoatRoughnessMap=t.clearcoatRoughnessMap,this.clearcoatNormalMap=t.clearcoatNormalMap,this.clearcoatNormalScale.copy(t.clearcoatNormalScale),this.dispersion=t.dispersion,this.ior=t.ior,this.iridescence=t.iridescence,this.iridescenceMap=t.iridescenceMap,this.iridescenceIOR=t.iridescenceIOR,this.iridescenceThicknessRange=[...t.iridescenceThicknessRange],this.iridescenceThicknessMap=t.iridescenceThicknessMap,this.sheen=t.sheen,this.sheenColor.copy(t.sheenColor),this.sheenColorMap=t.sheenColorMap,this.sheenRoughness=t.sheenRoughness,this.sheenRoughnessMap=t.sheenRoughnessMap,this.transmission=t.transmission,this.transmissionMap=t.transmissionMap,this.thickness=t.thickness,this.thicknessMap=t.thicknessMap,this.attenuationDistance=t.attenuationDistance,this.attenuationColor.copy(t.attenuationColor),this.specularIntensity=t.specularIntensity,this.specularIntensityMap=t.specularIntensityMap,this.specularColor.copy(t.specularColor),this.specularColorMap=t.specularColorMap,this}}class fm extends us{constructor(t){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new W(16777215),this.specular=new W(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new As,this.combine=bl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.specular.copy(t.specular),this.shininess=t.shininess,this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class mm extends us{constructor(t){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new W(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.gradientMap=t.gradientMap,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.fog=t.fog,this}}class ym extends us{constructor(t){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(t)}copy(t){return super.copy(t),this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.flatShading=t.flatShading,this}}class xm extends us{constructor(t){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new As,this.combine=bl,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.color.copy(t.color),this.map=t.map,this.lightMap=t.lightMap,this.lightMapIntensity=t.lightMapIntensity,this.aoMap=t.aoMap,this.aoMapIntensity=t.aoMapIntensity,this.emissive.copy(t.emissive),this.emissiveMap=t.emissiveMap,this.emissiveIntensity=t.emissiveIntensity,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.specularMap=t.specularMap,this.alphaMap=t.alphaMap,this.envMap=t.envMap,this.envMapRotation.copy(t.envMapRotation),this.combine=t.combine,this.reflectivity=t.reflectivity,this.refractionRatio=t.refractionRatio,this.wireframe=t.wireframe,this.wireframeLinewidth=t.wireframeLinewidth,this.wireframeLinecap=t.wireframeLinecap,this.wireframeLinejoin=t.wireframeLinejoin,this.flatShading=t.flatShading,this.fog=t.fog,this}}class wm extends us{constructor(t){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new W(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fn,this.normalScale=new Y(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(t)}copy(t){return super.copy(t),this.defines={MATCAP:""},this.color.copy(t.color),this.matcap=t.matcap,this.map=t.map,this.bumpMap=t.bumpMap,this.bumpScale=t.bumpScale,this.normalMap=t.normalMap,this.normalMapType=t.normalMapType,this.normalScale.copy(t.normalScale),this.displacementMap=t.displacementMap,this.displacementScale=t.displacementScale,this.displacementBias=t.displacementBias,this.alphaMap=t.alphaMap,this.flatShading=t.flatShading,this.fog=t.fog,this}}class bm extends B4{constructor(t){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(t)}copy(t){return super.copy(t),this.scale=t.scale,this.dashSize=t.dashSize,this.gapSize=t.gapSize,this}}class Mo extends Xt{constructor(t,e=1){super(),this.isLight=!0,this.type="Light",this.color=new W(t),this.intensity=e}dispose(){}copy(t,e){return super.copy(t,e),this.color.copy(t.color),this.intensity=t.intensity,this}toJSON(t){const e=super.toJSON(t);return e.object.color=this.color.getHex(),e.object.intensity=this.intensity,this.groundColor!==void 0&&(e.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(e.object.distance=this.distance),this.angle!==void 0&&(e.object.angle=this.angle),this.decay!==void 0&&(e.object.decay=this.decay),this.penumbra!==void 0&&(e.object.penumbra=this.penumbra),this.shadow!==void 0&&(e.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(e.object.target=this.target.uuid),e}}class q4 extends Mo{constructor(t,e,s){super(t,s),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Xt.DEFAULT_UP),this.updateMatrix(),this.groundColor=new W(e)}copy(t,e){return super.copy(t,e),this.groundColor.copy(t.groundColor),this}}const N1=new gt,o3=new S,r3=new S;class i2{constructor(t){this.camera=t,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Y(512,512),this.map=null,this.mapPass=null,this.matrix=new gt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new jp,this._frameExtents=new Y(1,1),this._viewportCount=1,this._viewports=[new vt(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(t){const e=this.camera,s=this.matrix;o3.setFromMatrixPosition(t.matrixWorld),e.position.copy(o3),r3.setFromMatrixPosition(t.target.matrixWorld),e.lookAt(r3),e.updateMatrixWorld(),N1.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),this._frustum.setFromProjectionMatrix(N1),s.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),s.multiply(N1)}getViewport(t){return this._viewports[t]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(t){return this.camera=t.camera.clone(),this.intensity=t.intensity,this.bias=t.bias,this.radius=t.radius,this.mapSize.copy(t.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const t={};return this.intensity!==1&&(t.intensity=this.intensity),this.bias!==0&&(t.bias=this.bias),this.normalBias!==0&&(t.normalBias=this.normalBias),this.radius!==1&&(t.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(t.mapSize=this.mapSize.toArray()),t.camera=this.camera.toJSON(!1).object,delete t.camera.matrix,t}}class vm extends i2{constructor(){super(new li(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(t){const e=this.camera,s=Va*2*t.angle*this.focus,i=this.mapSize.width/this.mapSize.height,n=t.distance||e.far;(s!==e.fov||i!==e.aspect||n!==e.far)&&(e.fov=s,e.aspect=i,e.far=n,e.updateProjectionMatrix()),super.updateMatrices(t)}copy(t){return super.copy(t),this.focus=t.focus,this}}class Y4 extends Mo{constructor(t,e,s=0,i=Math.PI/3,n=0,r=2){super(t,e),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Xt.DEFAULT_UP),this.updateMatrix(),this.target=new Xt,this.distance=s,this.angle=i,this.penumbra=n,this.decay=r,this.map=null,this.shadow=new vm}get power(){return this.intensity*Math.PI}set power(t){this.intensity=t/Math.PI}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.angle=t.angle,this.penumbra=t.penumbra,this.decay=t.decay,this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}const a3=new gt,ea=new S,C1=new S;class _m extends i2{constructor(){super(new li(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Y(4,2),this._viewportCount=6,this._viewports=[new vt(2,1,1,1),new vt(0,1,1,1),new vt(3,1,1,1),new vt(1,1,1,1),new vt(3,0,1,1),new vt(1,0,1,1)],this._cubeDirections=[new S(1,0,0),new S(-1,0,0),new S(0,0,1),new S(0,0,-1),new S(0,1,0),new S(0,-1,0)],this._cubeUps=[new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,1,0),new S(0,0,1),new S(0,0,-1)]}updateMatrices(t,e=0){const s=this.camera,i=this.matrix,n=t.distance||s.far;n!==s.far&&(s.far=n,s.updateProjectionMatrix()),ea.setFromMatrixPosition(t.matrixWorld),s.position.copy(ea),C1.copy(s.position),C1.add(this._cubeDirections[e]),s.up.copy(this._cubeUps[e]),s.lookAt(C1),s.updateMatrixWorld(),i.makeTranslation(-ea.x,-ea.y,-ea.z),a3.multiplyMatrices(s.projectionMatrix,s.matrixWorldInverse),this._frustum.setFromProjectionMatrix(a3)}}class zn extends Mo{constructor(t,e,s=0,i=2){super(t,e),this.isPointLight=!0,this.type="PointLight",this.distance=s,this.decay=i,this.shadow=new _m}get power(){return this.intensity*4*Math.PI}set power(t){this.intensity=t/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(t,e){return super.copy(t,e),this.distance=t.distance,this.decay=t.decay,this.shadow=t.shadow.clone(),this}}class n2 extends F4{constructor(t=-1,e=1,s=1,i=-1,n=.1,r=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=t,this.right=e,this.top=s,this.bottom=i,this.near=n,this.far=r,this.updateProjectionMatrix()}copy(t,e){return super.copy(t,e),this.left=t.left,this.right=t.right,this.top=t.top,this.bottom=t.bottom,this.near=t.near,this.far=t.far,this.zoom=t.zoom,this.view=t.view===null?null:Object.assign({},t.view),this}setViewOffset(t,e,s,i,n,r){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=e,this.view.offsetX=s,this.view.offsetY=i,this.view.width=n,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const t=(this.right-this.left)/(2*this.zoom),e=(this.top-this.bottom)/(2*this.zoom),s=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let n=s-t,r=s+t,a=i+e,c=i-e;if(this.view!==null&&this.view.enabled){const l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;n+=l*this.view.offsetX,r=n+l*this.view.width,a-=u*this.view.offsetY,c=a-u*this.view.height}this.projectionMatrix.makeOrthographic(n,r,a,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(t){const e=super.toJSON(t);return e.object.zoom=this.zoom,e.object.left=this.left,e.object.right=this.right,e.object.top=this.top,e.object.bottom=this.bottom,e.object.near=this.near,e.object.far=this.far,this.view!==null&&(e.object.view=Object.assign({},this.view)),e}}class Sm extends i2{constructor(){super(new n2(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class X4 extends Mo{constructor(t,e){super(t,e),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Xt.DEFAULT_UP),this.updateMatrix(),this.target=new Xt,this.shadow=new Sm}dispose(){this.shadow.dispose()}copy(t){return super.copy(t),this.target=t.target.clone(),this.shadow=t.shadow.clone(),this}}class Tm extends Mo{constructor(t,e){super(t,e),this.isAmbientLight=!0,this.type="AmbientLight"}}class Mm extends Mo{constructor(t,e,s=10,i=10){super(t,e),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=s,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(t){this.intensity=t/(this.width*this.height*Math.PI)}copy(t){return super.copy(t),this.width=t.width,this.height=t.height,this}toJSON(t){const e=super.toJSON(t);return e.object.width=this.width,e.object.height=this.height,e}}class Am{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let t=0;t<9;t++)this.coefficients.push(new S)}set(t){for(let e=0;e<9;e++)this.coefficients[e].copy(t[e]);return this}zero(){for(let t=0;t<9;t++)this.coefficients[t].set(0,0,0);return this}getAt(t,e){const s=t.x,i=t.y,n=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.282095),e.addScaledVector(r[1],.488603*i),e.addScaledVector(r[2],.488603*n),e.addScaledVector(r[3],.488603*s),e.addScaledVector(r[4],1.092548*(s*i)),e.addScaledVector(r[5],1.092548*(i*n)),e.addScaledVector(r[6],.315392*(3*n*n-1)),e.addScaledVector(r[7],1.092548*(s*n)),e.addScaledVector(r[8],.546274*(s*s-i*i)),e}getIrradianceAt(t,e){const s=t.x,i=t.y,n=t.z,r=this.coefficients;return e.copy(r[0]).multiplyScalar(.886227),e.addScaledVector(r[1],2*.511664*i),e.addScaledVector(r[2],2*.511664*n),e.addScaledVector(r[3],2*.511664*s),e.addScaledVector(r[4],2*.429043*s*i),e.addScaledVector(r[5],2*.429043*i*n),e.addScaledVector(r[6],.743125*n*n-.247708),e.addScaledVector(r[7],2*.429043*s*n),e.addScaledVector(r[8],.429043*(s*s-i*i)),e}add(t){for(let e=0;e<9;e++)this.coefficients[e].add(t.coefficients[e]);return this}addScaledSH(t,e){for(let s=0;s<9;s++)this.coefficients[s].addScaledVector(t.coefficients[s],e);return this}scale(t){for(let e=0;e<9;e++)this.coefficients[e].multiplyScalar(t);return this}lerp(t,e){for(let s=0;s<9;s++)this.coefficients[s].lerp(t.coefficients[s],e);return this}equals(t){for(let e=0;e<9;e++)if(!this.coefficients[e].equals(t.coefficients[e]))return!1;return!0}copy(t){return this.set(t.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(t,e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].fromArray(t,e+i*3);return this}toArray(t=[],e=0){const s=this.coefficients;for(let i=0;i<9;i++)s[i].toArray(t,e+i*3);return t}static getBasisAt(t,e){const s=t.x,i=t.y,n=t.z;e[0]=.282095,e[1]=.488603*i,e[2]=.488603*n,e[3]=.488603*s,e[4]=1.092548*s*i,e[5]=1.092548*i*n,e[6]=.315392*(3*n*n-1),e[7]=1.092548*s*n,e[8]=.546274*(s*s-i*i)}}class Nm extends Mo{constructor(t=new Am,e=1){super(void 0,e),this.isLightProbe=!0,this.sh=t}copy(t){return super.copy(t),this.sh.copy(t.sh),this}fromJSON(t){return this.intensity=t.intensity,this.sh.fromArray(t.sh),this}toJSON(t){const e=super.toJSON(t);return e.object.sh=this.sh.toArray(),e}}class Cm{constructor(t=!0){this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=c3(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=c3();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}function c3(){return performance.now()}class Fm extends E4{constructor(t,e,s=1){super(t,e),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=s}copy(t){return super.copy(t),this.meshPerAttribute=t.meshPerAttribute,this}clone(t){const e=super.clone(t);return e.meshPerAttribute=this.meshPerAttribute,e}toJSON(t){const e=super.toJSON(t);return e.isInstancedInterleavedBuffer=!0,e.meshPerAttribute=this.meshPerAttribute,e}}const l3=new gt;class Rm{constructor(t,e,s=0,i=1/0){this.ray=new Wp(t,e),this.near=s,this.far=i,this.camera=null,this.layers=new S4,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(t,e){this.ray.set(t,e)}setFromCamera(t,e){e.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(t.x,t.y,.5).unproject(e).sub(this.ray.origin).normalize(),this.camera=e):e.isOrthographicCamera?(this.ray.origin.set(t.x,t.y,(e.near+e.far)/(e.near-e.far)).unproject(e),this.ray.direction.set(0,0,-1).transformDirection(e.matrixWorld),this.camera=e):console.error("THREE.Raycaster: Unsupported camera type: "+e.type)}setFromXRController(t){return l3.identity().extractRotation(t.matrixWorld),this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(l3),this}intersectObject(t,e=!0,s=[]){return tp(t,this,s,e),s.sort(u3),s}intersectObjects(t,e=!0,s=[]){for(let i=0,n=t.length;i<n;i++)tp(t[i],this,s,e);return s.sort(u3),s}}function u3(o,t){return o.distance-t.distance}function tp(o,t,e,s){let i=!0;if(o.layers.test(t.layers)&&o.raycast(t,e)===!1&&(i=!1),i===!0&&s===!0){const n=o.children;for(let r=0,a=n.length;r<a;r++)tp(n[r],t,e,!0)}}class Em extends Pn{constructor(t,e=null){super(),this.object=t,this.domElement=e,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(){}disconnect(){}dispose(){}update(){}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wl}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wl);const Dm=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class Bm{constructor(t){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(t),this.hasAnimation=t.object.isSkinnedMesh===!0,this.refreshUniforms=Dm,this.renderId=0}firstInitialization(t){return this.renderObjects.has(t)===!1?(this.getRenderObjectData(t),!0):!1}getRenderObjectData(t){let e=this.renderObjects.get(t);if(e===void 0){const{geometry:s,material:i,object:n}=t;if(e={material:this.getMaterialData(i),geometry:{attributes:this.getAttributesData(s.attributes),indexVersion:s.index?s.index.version:null,drawRange:{start:s.drawRange.start,count:s.drawRange.count}},worldMatrix:n.matrixWorld.clone()},n.center&&(e.center=n.center.clone()),n.morphTargetInfluences&&(e.morphTargetInfluences=n.morphTargetInfluences.slice()),t.bundle!==null&&(e.version=t.bundle.version),e.material.transmission>0){const{width:r,height:a}=t.context;e.bufferWidth=r,e.bufferHeight=a}this.renderObjects.set(t,e)}return e}getAttributesData(t){const e={};for(const s in t){const i=t[s];e[s]={version:i.version}}return e}containsNode(t){const e=t.material;for(const s in e)if(e[s]&&e[s].isNode)return!0;return t.renderer.nodes.modelViewMatrix!==null||t.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(t){const e={};for(const s of this.refreshUniforms){const i=t[s];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?e[s]={id:i.id,version:i.version}:e[s]=i.clone():e[s]=i)}return e}equals(t){const{object:e,material:s,geometry:i}=t,n=this.getRenderObjectData(t);if(n.worldMatrix.equals(e.matrixWorld)!==!0)return n.worldMatrix.copy(e.matrixWorld),!1;const r=n.material;for(const f in r){const m=r[f],x=s[f];if(m.equals!==void 0){if(m.equals(x)===!1)return m.copy(x),!1}else if(x.isTexture===!0){if(m.id!==x.id||m.version!==x.version)return m.id=x.id,m.version=x.version,!1}else if(m!==x)return r[f]=x,!1}if(r.transmission>0){const{width:f,height:m}=t.context;if(n.bufferWidth!==f||n.bufferHeight!==m)return n.bufferWidth=f,n.bufferHeight=m,!1}const a=n.geometry,c=i.attributes,l=a.attributes,u=Object.keys(l),p=Object.keys(c);if(u.length!==p.length)return n.geometry.attributes=this.getAttributesData(c),!1;for(const f of u){const m=l[f],x=c[f];if(x===void 0)return delete l[f],!1;if(m.version!==x.version)return m.version=x.version,!1}const h=i.index,d=a.indexVersion,g=h?h.version:null;if(d!==g)return a.indexVersion=g,!1;if(a.drawRange.start!==i.drawRange.start||a.drawRange.count!==i.drawRange.count)return a.drawRange.start=i.drawRange.start,a.drawRange.count=i.drawRange.count,!1;if(n.morphTargetInfluences){let f=!1;for(let m=0;m<n.morphTargetInfluences.length;m++)n.morphTargetInfluences[m]!==e.morphTargetInfluences[m]&&(f=!0);if(f)return!0}return n.center&&n.center.equals(e.center)===!1?(n.center.copy(e.center),!0):(t.bundle!==null&&(n.version=t.bundle.version),!0)}needsRefresh(t,e){if(this.hasNode||this.hasAnimation||this.firstInitialization(t))return!0;const{renderId:s}=e;if(this.renderId!==s)return this.renderId=s,!0;const i=t.object.static===!0,n=t.bundle!==null&&t.bundle.static===!0&&this.getRenderObjectData(t).version===t.bundle.version;return i||n?!1:this.equals(t)!==!0}}function Ha(o,t=0){let e=3735928559^t,s=1103547991^t;if(o instanceof Array)for(let i=0,n;i<o.length;i++)n=o[i],e=Math.imul(e^n,2654435761),s=Math.imul(s^n,1597334677);else for(let i=0,n;i<o.length;i++)n=o.charCodeAt(i),e=Math.imul(e^n,2654435761),s=Math.imul(s^n,1597334677);return e=Math.imul(e^e>>>16,2246822507),e^=Math.imul(s^s>>>13,3266489909),s=Math.imul(s^s>>>16,2246822507),s^=Math.imul(e^e>>>13,3266489909),4294967296*(2097151&s)+(e>>>0)}const Z4=o=>Ha(o),o2=o=>Ha(o),j4=(...o)=>Ha(o);function K4(o,t=!1){const e=[];o.isNode===!0&&(e.push(o.id),o=o.getSelf());for(const{property:s,childNode:i}of Yc(o))e.push(e,Ha(s.slice(0,-4)),i.getCacheKey(t));return Ha(e)}function*Yc(o,t=!1){for(const e in o){if(e.startsWith("_")===!0)continue;const s=o[e];if(Array.isArray(s)===!0)for(let i=0;i<s.length;i++){const n=s[i];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:i,childNode:n})}else if(s&&s.isNode===!0)yield{property:e,childNode:s};else if(typeof s=="object")for(const i in s){const n=s[i];n&&(n.isNode===!0||t&&typeof n.toJSON=="function")&&(yield{property:e,index:i,childNode:n})}}}const Pm=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]);function J4(o){return Pm.get(o)}function Q4(o){if(/float|int|uint/.test(o))return 1;if(/vec2/.test(o))return 2;if(/vec3/.test(o))return 3;if(/vec4/.test(o))return 4;if(/mat3/.test(o))return 9;if(/mat4/.test(o))return 16;console.error("THREE.TSL: Unsupported type:",o)}function _n(o){if(o==null)return null;const t=typeof o;return o.isNode===!0?"node":t==="number"?"float":t==="boolean"?"bool":t==="string"?"string":t==="function"?"shader":o.isVector2===!0?"vec2":o.isVector3===!0?"vec3":o.isVector4===!0?"vec4":o.isMatrix3===!0?"mat3":o.isMatrix4===!0?"mat4":o.isColor===!0?"color":o instanceof ArrayBuffer?"ArrayBuffer":null}function t8(o,...t){const e=o?o.slice(-4):void 0;return t.length===1&&(e==="vec2"?t=[t[0],t[0]]:e==="vec3"?t=[t[0],t[0],t[0]]:e==="vec4"&&(t=[t[0],t[0],t[0],t[0]])),o==="color"?new W(...t):e==="vec2"?new Y(...t):e==="vec3"?new S(...t):e==="vec4"?new vt(...t):e==="mat3"?new gs(...t):e==="mat4"?new gt(...t):o==="bool"?t[0]||!1:o==="float"||o==="int"||o==="uint"?t[0]||0:o==="string"?t[0]||"":o==="ArrayBuffer"?s8(t[0]):null}function e8(o){let t="";const e=new Uint8Array(o);for(let s=0;s<e.length;s++)t+=String.fromCharCode(e[s]);return btoa(t)}function s8(o){return Uint8Array.from(atob(o),t=>t.charCodeAt(0)).buffer}const ep={VERTEX:"vertex",FRAGMENT:"fragment"},rt={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},Im={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},Oe={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},i8=["fragment","vertex"],sp=["setup","analyze","generate"],ip=[...i8,"compute"],Ao=["x","y","z","w"];let Lm=0;class tt extends Pn{static get type(){return"Node"}constructor(t=null){super(),this.nodeType=t,this.updateType=rt.NONE,this.updateBeforeType=rt.NONE,this.updateAfterType=rt.NONE,this.uuid=Gt.generateUUID(),this.version=0,this._cacheKey=null,this._cacheKeyVersion=0,this.global=!1,this.isNode=!0,Object.defineProperty(this,"id",{value:Lm++})}set needsUpdate(t){t===!0&&this.version++}get type(){return this.constructor.type}onUpdate(t,e){return this.updateType=e,this.update=t.bind(this.getSelf()),this}onFrameUpdate(t){return this.onUpdate(t,rt.FRAME)}onRenderUpdate(t){return this.onUpdate(t,rt.RENDER)}onObjectUpdate(t){return this.onUpdate(t,rt.OBJECT)}onReference(t){return this.updateReference=t.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:t}of Yc(this))yield t}dispose(){this.dispatchEvent({type:"dispose"})}traverse(t){t(this);for(const e of this.getChildren())e.traverse(t)}getCacheKey(t=!1){return t=t||this.version!==this._cacheKeyVersion,(t===!0||this._cacheKey===null)&&(this._cacheKey=K4(this,t),this._cacheKeyVersion=this.version),this._cacheKey}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(t){const e=this.getNodeType(t);return t.getElementType(e)}getNodeType(t){const e=t.getNodeProperties(this);return e.outputNode?e.outputNode.getNodeType(t):this.nodeType}getShared(t){const e=this.getHash(t);return t.getNodeFromHash(e)||this}setup(t){const e=t.getNodeProperties(this);let s=0;for(const i of this.getChildren())e["node"+s++]=i;return null}analyze(t){if(t.increaseUsage(this)===1){const s=t.getNodeProperties(this);for(const i of Object.values(s))i&&i.isNode===!0&&i.build(t)}}generate(t,e){const{outputNode:s}=t.getNodeProperties(this);if(s&&s.isNode===!0)return s.build(t,e)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(t,e=null){const s=this.getShared(t);if(this!==s)return s.build(t,e);t.addNode(this),t.addChain(this);let i=null;const n=t.getBuildStage();if(n==="setup"){this.updateReference(t);const r=t.getNodeProperties(this);if(r.initialized!==!0){const a=t.stack.nodes.length;r.initialized=!0,r.outputNode=this.setup(t),r.outputNode!==null&&t.stack.nodes.length;for(const c of Object.values(r))c&&c.isNode===!0&&c.build(t)}}else if(n==="analyze")this.analyze(t);else if(n==="generate")if(this.generate.length===1){const a=this.getNodeType(t),c=t.getDataFromNode(this);i=c.snippet,i===void 0?(i=this.generate(t)||"",c.snippet=i):c.flowCodes!==void 0&&t.context.nodeBlock!==void 0&&t.addFlowCodeHierarchy(this,t.context.nodeBlock),i=t.format(i,a,e)}else i=this.generate(t,e)||"";return t.removeChain(this),t.addSequentialNode(this),i}getSerializeChildren(){return Yc(this)}serialize(t){const e=this.getSerializeChildren(),s={};for(const{property:i,index:n,childNode:r}of e)n!==void 0?(s[i]===void 0&&(s[i]=Number.isInteger(n)?[]:{}),s[i][n]=r.toJSON(t.meta).uuid):s[i]=r.toJSON(t.meta).uuid;Object.keys(s).length>0&&(t.inputNodes=s)}deserialize(t){if(t.inputNodes!==void 0){const e=t.meta.nodes;for(const s in t.inputNodes)if(Array.isArray(t.inputNodes[s])){const i=[];for(const n of t.inputNodes[s])i.push(e[n]);this[s]=i}else if(typeof t.inputNodes[s]=="object"){const i={};for(const n in t.inputNodes[s]){const r=t.inputNodes[s][n];i[n]=e[r]}this[s]=i}else{const i=t.inputNodes[s];this[s]=e[i]}}}toJSON(t){const{uuid:e,type:s}=this,i=t===void 0||typeof t=="string";i&&(t={textures:{},images:{},nodes:{}});let n=t.nodes[e];n===void 0&&(n={uuid:e,type:s,meta:t,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},i!==!0&&(t.nodes[n.uuid]=n),this.serialize(n),delete n.meta);function r(a){const c=[];for(const l in a){const u=a[l];delete u.metadata,c.push(u)}return c}if(i){const a=r(t.textures),c=r(t.images),l=r(t.nodes);a.length>0&&(n.textures=a),c.length>0&&(n.images=c),l.length>0&&(n.nodes=l)}return n}}class No extends tt{static get type(){return"ArrayElementNode"}constructor(t,e){super(),this.node=t,this.indexNode=e,this.isArrayElementNode=!0}getNodeType(t){return this.node.getElementType(t)}generate(t){const e=this.node.build(t),s=this.indexNode.build(t,"uint");return`${e}[ ${s} ]`}}class n8 extends tt{static get type(){return"ConvertNode"}constructor(t,e){super(),this.node=t,this.convertTo=e}getNodeType(t){const e=this.node.getNodeType(t);let s=null;for(const i of this.convertTo.split("|"))(s===null||t.getTypeLength(e)===t.getTypeLength(i))&&(s=i);return s}serialize(t){super.serialize(t),t.convertTo=this.convertTo}deserialize(t){super.deserialize(t),this.convertTo=t.convertTo}generate(t,e){const s=this.node,i=this.getNodeType(t),n=s.build(t,i);return t.format(n,i,e)}}class pe extends tt{static get type(){return"TempNode"}constructor(t){super(t),this.isTempNode=!0}hasDependencies(t){return t.getDataFromNode(this).usageCount>1}build(t,e){if(t.getBuildStage()==="generate"){const i=t.getVectorType(this.getNodeType(t,e)),n=t.getDataFromNode(this);if(n.propertyName!==void 0)return t.format(n.propertyName,i,e);if(i!=="void"&&e!=="void"&&this.hasDependencies(t)){const r=super.build(t,i),a=t.getVarFromNode(this,null,i),c=t.getPropertyName(a);return t.addLineFlowCode(`${c} = ${r}`,this),n.snippet=r,n.propertyName=c,t.format(n.propertyName,i,e)}}return super.build(t,e)}}class Um extends pe{static get type(){return"JoinNode"}constructor(t=[],e=null){super(e),this.nodes=t}getNodeType(t){return this.nodeType!==null?t.getVectorType(this.nodeType):t.getTypeFromLength(this.nodes.reduce((e,s)=>e+t.getTypeLength(s.getNodeType(t)),0))}generate(t,e){const s=this.getNodeType(t),i=this.nodes,n=t.getComponentType(s),r=[];for(const c of i){let l=c.build(t);const u=t.getComponentType(c.getNodeType(t));u!==n&&(l=t.format(l,u,n)),r.push(l)}const a=`${t.getType(s)}( ${r.join(", ")} )`;return t.format(a,s,e)}}const zm=Ao.join("");class np extends tt{static get type(){return"SplitNode"}constructor(t,e="x"){super(),this.node=t,this.components=e,this.isSplitNode=!0}getVectorLength(){let t=this.components.length;for(const e of this.components)t=Math.max(Ao.indexOf(e)+1,t);return t}getComponentType(t){return t.getComponentType(this.node.getNodeType(t))}getNodeType(t){return t.getTypeFromLength(this.components.length,this.getComponentType(t))}generate(t,e){const s=this.node,i=t.getTypeLength(s.getNodeType(t));let n=null;if(i>1){let r=null;this.getVectorLength()>=i&&(r=t.getTypeFromLength(this.getVectorLength(),this.getComponentType(t)));const c=s.build(t,r);this.components.length===i&&this.components===zm.slice(0,this.components.length)?n=t.format(c,r,e):n=t.format(`${c}.${this.components}`,this.getNodeType(t),e)}else n=s.build(t,e);return n}serialize(t){super.serialize(t),t.components=this.components}deserialize(t){super.deserialize(t),this.components=t.components}}class km extends pe{static get type(){return"SetNode"}constructor(t,e,s){super(),this.sourceNode=t,this.components=e,this.targetNode=s}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{sourceNode:e,components:s,targetNode:i}=this,n=this.getNodeType(t),r=t.getTypeFromLength(s.length,i.getNodeType(t)),a=i.build(t,r),c=e.build(t,n),l=t.getTypeLength(n),u=[];for(let p=0;p<l;p++){const h=Ao[p];h===s[0]?(u.push(a),p+=s.length-1):u.push(c+"."+h)}return`${t.getType(n)}( ${u.join(", ")} )`}}class Vm extends pe{static get type(){return"FlipNode"}constructor(t,e){super(),this.sourceNode=t,this.components=e}getNodeType(t){return this.sourceNode.getNodeType(t)}generate(t){const{components:e,sourceNode:s}=this,i=this.getNodeType(t),n=s.build(t),r=t.getVarFromNode(this),a=t.getPropertyName(r);t.addLineFlowCode(a+" = "+n,this);const c=t.getTypeLength(i),l=[];let u=0;for(let p=0;p<c;p++){const h=Ao[p];h===e[u]?(l.push("1.0 - "+(a+"."+h)),u++):l.push(a+"."+h)}return`${t.getType(i)}( ${l.join(", ")} )`}}class r2 extends tt{static get type(){return"InputNode"}constructor(t,e=null){super(e),this.isInputNode=!0,this.value=t,this.precision=null}getNodeType(){return this.nodeType===null?_n(this.value):this.nodeType}getInputType(t){return this.getNodeType(t)}setPrecision(t){return this.precision=t,this}serialize(t){super.serialize(t),t.value=this.value,this.value&&this.value.toArray&&(t.value=this.value.toArray()),t.valueType=_n(this.value),t.nodeType=this.nodeType,t.valueType==="ArrayBuffer"&&(t.value=e8(t.value)),t.precision=this.precision}deserialize(t){super.deserialize(t),this.nodeType=t.nodeType,this.value=Array.isArray(t.value)?t8(t.valueType,...t.value):t.value,this.precision=t.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(t.value))}generate(){console.warn("Abstract function.")}}class ni extends r2{static get type(){return"ConstNode"}constructor(t,e=null){super(t,e),this.isConstNode=!0}generateConst(t){return t.generateConst(this.getNodeType(t),this.value)}generate(t,e){const s=this.getNodeType(t);return t.format(this.generateConst(t),s,e)}}let Br=null;const fr=new Map;function z(o,t){if(fr.has(o)){console.warn(`Redefinition of method chaining ${o}`);return}if(typeof t!="function")throw new Error(`Node element ${o} is not a function`);fr.set(o,t)}const o8=o=>o.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),p3=o=>o8(o).split("").sort().join(""),r8={setup(o,t){const e=t.shift();return o(a0(e),...t)},get(o,t,e){if(typeof t=="string"&&o[t]===void 0){if(o.isStackNode!==!0&&t==="assign")return(...s)=>(Br.assign(e,...s),e);if(fr.has(t)){const s=fr.get(t);return o.isStackNode?(...i)=>e.add(s(...i)):(...i)=>s(e,...i)}else{if(t==="self")return o;if(t.endsWith("Assign")&&fr.has(t.slice(0,t.length-6))){const s=fr.get(t.slice(0,t.length-6));return o.isStackNode?(...i)=>e.assign(i[0],s(...i)):(...i)=>e.assign(s(e,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0)return t=o8(t),k(new np(e,t));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=p3(t.slice(3).toLowerCase()),s=>k(new km(o,t,s));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(t)===!0)return t=p3(t.slice(4).toLowerCase()),()=>k(new Vm(k(o),t));if(t==="width"||t==="height"||t==="depth")return t==="width"?t="x":t==="height"?t="y":t==="depth"&&(t="z"),k(new np(o,t));if(/^\d+$/.test(t)===!0)return k(new No(e,new ni(Number(t),"uint")))}}}return Reflect.get(o,t,e)},set(o,t,e,s){return typeof t=="string"&&o[t]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(t)===!0||t==="width"||t==="height"||t==="depth"||/^\d+$/.test(t)===!0)?(s[t].assign(e),!0):Reflect.set(o,t,e,s)}},F1=new WeakMap,h3=new WeakMap,Gm=function(o,t=null){const e=_n(o);if(e==="node"){let s=F1.get(o);return s===void 0&&(s=new Proxy(o,r8),F1.set(o,s),F1.set(s,s)),s}else{if(t===null&&(e==="float"||e==="boolean")||e&&e!=="shader"&&e!=="string")return k(op(o,t));if(e==="shader")return P(o)}return o},Om=function(o,t=null){for(const e in o)o[e]=k(o[e],t);return o},Wm=function(o,t=null){const e=o.length;for(let s=0;s<e;s++)o[s]=k(o[s],t);return o},$m=function(o,t=null,e=null,s=null){const i=n=>k(s!==null?Object.assign(n,s):n);return t===null?(...n)=>i(new o(...ao(n))):e!==null?(e=k(e),(...n)=>i(new o(t,...ao(n),e))):(...n)=>i(new o(t,...ao(n)))},Hm=function(o,...t){return k(new o(...ao(t)))};class qm extends tt{constructor(t,e){super(),this.shaderNode=t,this.inputNodes=e}getNodeType(t){return this.shaderNode.nodeType||this.getOutputNode(t).getNodeType(t)}call(t){const{shaderNode:e,inputNodes:s}=this,i=t.getNodeProperties(e);if(i.onceOutput)return i.onceOutput;let n=null;if(e.layout){let r=h3.get(t.constructor);r===void 0&&(r=new WeakMap,h3.set(t.constructor,r));let a=r.get(e);a===void 0&&(a=k(t.buildFunctionNode(e)),r.set(e,a)),t.currentFunctionNode!==null&&t.currentFunctionNode.includes.push(a),n=k(a.call(s))}else{const r=e.jsFunc,a=s!==null?r(s,t):r(t);n=k(a)}return e.once&&(i.onceOutput=n),n}getOutputNode(t){const e=t.getNodeProperties(this);return e.outputNode===null&&(e.outputNode=this.setupOutput(t)),e.outputNode}setup(t){return this.getOutputNode(t)}setupOutput(t){return t.addStack(),t.stack.outputNode=this.call(t),t.removeStack()}generate(t,e){return this.getOutputNode(t).build(t,e)}}class Ym extends tt{constructor(t,e){super(e),this.jsFunc=t,this.layout=null,this.global=!0,this.once=!1}setLayout(t){return this.layout=t,this}call(t=null){return a0(t),k(new qm(this,t))}setup(){return this.call()}}const Xm=[!1,!0],Zm=[0,1,2,3],jm=[-1,-2],a8=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],a2=new Map;for(const o of Xm)a2.set(o,new ni(o));const c2=new Map;for(const o of Zm)c2.set(o,new ni(o,"uint"));const l2=new Map([...c2].map(o=>new ni(o.value,"int")));for(const o of jm)l2.set(o,new ni(o,"int"));const Ml=new Map([...l2].map(o=>new ni(o.value)));for(const o of a8)Ml.set(o,new ni(o));for(const o of a8)Ml.set(-o,new ni(-o));const Al={bool:a2,uint:c2,ints:l2,float:Ml},d3=new Map([...a2,...Ml]),op=(o,t)=>d3.has(o)?d3.get(o):o.isNode===!0?o:new ni(o,t),Km=o=>{try{return o.getNodeType()}catch{return}},ve=function(o,t=null){return(...e)=>{if((e.length===0||!["bool","float","int","uint"].includes(o)&&e.every(i=>typeof i!="object"))&&(e=[t8(o,...e)]),e.length===1&&t!==null&&t.has(e[0]))return k(t.get(e[0]));if(e.length===1){const i=op(e[0],o);return Km(i)===o?k(i):k(new n8(i,o))}const s=e.map(i=>op(i));return k(new Um(s,o))}},qa=o=>typeof o=="object"&&o!==null?o.value:o,c8=o=>o!=null?o.nodeType||o.convertTo||(typeof o=="string"?o:null):null;function Fa(o,t){return new Proxy(new Ym(o,t),r8)}const k=(o,t=null)=>Gm(o,t),a0=(o,t=null)=>new Om(o,t),ao=(o,t=null)=>new Wm(o,t),L=(...o)=>new $m(...o),H=(...o)=>new Hm(...o),P=(o,t)=>{const e=new Fa(o,t),s=(...i)=>{let n;return a0(i),i[0]&&i[0].isNode?n=[...i]:n=i[0],e.call(n)};return s.shaderNode=e,s.setLayout=i=>(e.setLayout(i),s),s.once=()=>(e.once=!0,s),s},Jm=(...o)=>(console.warn("TSL.ShaderNode: tslFn() has been renamed to Fn()."),P(...o));z("toGlobal",o=>(o.global=!0,o));const Ya=o=>{Br=o},u2=()=>Br,pt=(...o)=>Br.If(...o);function l8(o){return Br&&Br.add(o),o}z("append",l8);const u8=new ve("color"),_=new ve("float",Al.float),C=new ve("int",Al.ints),q=new ve("uint",Al.uint),ji=new ve("bool",Al.bool),G=new ve("vec2"),Me=new ve("ivec2"),p8=new ve("uvec2"),h8=new ve("bvec2"),D=new ve("vec3"),d8=new ve("ivec3"),Or=new ve("uvec3"),p2=new ve("bvec3"),J=new ve("vec4"),g8=new ve("ivec4"),f8=new ve("uvec4"),m8=new ve("bvec4"),Nl=new ve("mat2"),qe=new ve("mat3"),co=new ve("mat4"),Qm=(o="")=>k(new ni(o,"string")),ty=o=>k(new ni(o,"ArrayBuffer"));z("toColor",u8);z("toFloat",_);z("toInt",C);z("toUint",q);z("toBool",ji);z("toVec2",G);z("toIVec2",Me);z("toUVec2",p8);z("toBVec2",h8);z("toVec3",D);z("toIVec3",d8);z("toUVec3",Or);z("toBVec3",p2);z("toVec4",J);z("toIVec4",g8);z("toUVec4",f8);z("toBVec4",m8);z("toMat2",Nl);z("toMat3",qe);z("toMat4",co);const y8=L(No),x8=(o,t)=>k(new n8(k(o),t)),ey=(o,t)=>k(new np(k(o),t));z("element",y8);z("convert",x8);class w8 extends tt{static get type(){return"UniformGroupNode"}constructor(t,e=!1,s=1){super("string"),this.name=t,this.version=0,this.shared=e,this.order=s,this.isUniformGroup=!0}set needsUpdate(t){t===!0&&this.version++}serialize(t){super.serialize(t),t.name=this.name,t.version=this.version,t.shared=this.shared}deserialize(t){super.deserialize(t),this.name=t.name,this.version=t.version,this.shared=t.shared}}const b8=o=>new w8(o),h2=(o,t=0)=>new w8(o,!0,t),v8=h2("frame"),st=h2("render"),d2=b8("object");class c0 extends r2{static get type(){return"UniformNode"}constructor(t,e=null){super(t,e),this.isUniformNode=!0,this.name="",this.groupNode=d2}label(t){return this.name=t,this}setGroup(t){return this.groupNode=t,this}getGroup(){return this.groupNode}getUniformHash(t){return this.getHash(t)}onUpdate(t,e){const s=this.getSelf();return t=t.bind(s),super.onUpdate(i=>{const n=t(i,s);n!==void 0&&(this.value=n)},e)}generate(t,e){const s=this.getNodeType(t),i=this.getUniformHash(t);let n=t.getNodeFromHash(i);n===void 0&&(t.setHashNode(this,i),n=this);const r=n.getInputType(t),a=t.getUniformFromNode(n,r,t.shaderStage,this.name||t.context.label),c=t.getPropertyName(a);return t.context.label!==void 0&&delete t.context.label,t.format(c,s,e)}}const Q=(o,t)=>{const e=c8(t||o),s=o&&o.isNode===!0?o.node&&o.node.value||o.value:o;return k(new c0(s,e))};class Ft extends tt{static get type(){return"PropertyNode"}constructor(t,e=null,s=!1){super(t),this.name=e,this.varying=s,this.isPropertyNode=!0}getHash(t){return this.name||super.getHash(t)}isGlobal(){return!0}generate(t){let e;return this.varying===!0?(e=t.getVaryingFromNode(this,this.name),e.needsInterpolation=!0):e=t.getVarFromNode(this,this.name),t.getPropertyName(e)}}const _8=(o,t)=>k(new Ft(o,t)),Xa=(o,t)=>k(new Ft(o,t,!0)),Tt=H(Ft,"vec4","DiffuseColor"),rp=H(Ft,"vec3","EmissiveColor"),pi=H(Ft,"float","Roughness"),Za=H(Ft,"float","Metalness"),Xc=H(Ft,"float","Clearcoat"),ja=H(Ft,"float","ClearcoatRoughness"),no=H(Ft,"vec3","Sheen"),Cl=H(Ft,"float","SheenRoughness"),Fl=H(Ft,"float","Iridescence"),g2=H(Ft,"float","IridescenceIOR"),f2=H(Ft,"float","IridescenceThickness"),Zc=H(Ft,"float","AlphaT"),dn=H(Ft,"float","Anisotropy"),Ra=H(Ft,"vec3","AnisotropyT"),lo=H(Ft,"vec3","AnisotropyB"),ss=H(Ft,"color","SpecularColor"),Ka=H(Ft,"float","SpecularF90"),jc=H(Ft,"float","Shininess"),S8=H(Ft,"vec4","Output"),Cc=H(Ft,"float","dashSize"),ap=H(Ft,"float","gapSize"),sy=H(Ft,"float","pointWidth"),Ea=H(Ft,"float","IOR"),Kc=H(Ft,"float","Transmission"),m2=H(Ft,"float","Thickness"),y2=H(Ft,"float","AttenuationDistance"),x2=H(Ft,"color","AttenuationColor"),w2=H(Ft,"float","Dispersion");class iy extends pe{static get type(){return"AssignNode"}constructor(t,e){super(),this.targetNode=t,this.sourceNode=e}hasDependencies(){return!1}getNodeType(t,e){return e!=="void"?this.targetNode.getNodeType(t):"void"}needsSplitAssign(t){const{targetNode:e}=this;if(t.isAvailable("swizzleAssign")===!1&&e.isSplitNode&&e.components.length>1){const s=t.getTypeLength(e.node.getNodeType(t));return Ao.join("").slice(0,s)!==e.components}return!1}generate(t,e){const{targetNode:s,sourceNode:i}=this,n=this.needsSplitAssign(t),r=s.getNodeType(t),a=s.context({assign:!0}).build(t),c=i.build(t,r),l=i.getNodeType(t),u=t.getDataFromNode(this);let p;if(u.initialized===!0)e!=="void"&&(p=a);else if(n){const h=t.getVarFromNode(this,null,r),d=t.getPropertyName(h);t.addLineFlowCode(`${d} = ${c}`,this);const g=s.node.context({assign:!0}).build(t);for(let f=0;f<s.components.length;f++){const m=s.components[f];t.addLineFlowCode(`${g}.${m} = ${d}[ ${f} ]`,this)}e!=="void"&&(p=a)}else p=`${a} = ${c}`,(e==="void"||l==="void")&&(t.addLineFlowCode(p,this),e!=="void"&&(p=a));return u.initialized=!0,t.format(p,r,e)}}const T8=L(iy);z("assign",T8);class ny extends pe{static get type(){return"FunctionCallNode"}constructor(t=null,e={}){super(),this.functionNode=t,this.parameters=e}setParameters(t){return this.parameters=t,this}getParameters(){return this.parameters}getNodeType(t){return this.functionNode.getNodeType(t)}generate(t){const e=[],s=this.functionNode,i=s.getInputs(t),n=this.parameters,r=(c,l)=>{const u=l.type,p=u==="pointer";let h;return p?h="&"+c.build(t):h=c.build(t,u),h};if(Array.isArray(n))for(let c=0;c<n.length;c++)e.push(r(n[c],i[c]));else for(const c of i){const l=n[c.name];if(l!==void 0)e.push(r(l,c));else throw new Error(`FunctionCallNode: Input '${c.name}' not found in FunctionNode.`)}return`${s.build(t,"property")}( ${e.join(", ")} )`}}const M8=(o,...t)=>(t=t.length>1||t[0]&&t[0].isNode===!0?ao(t):a0(t[0]),k(new ny(k(o),t)));z("call",M8);class Qt extends pe{static get type(){return"OperatorNode"}constructor(t,e,s,...i){if(super(),i.length>0){let n=new Qt(t,e,s);for(let r=0;r<i.length-1;r++)n=new Qt(t,n,i[r]);e=n,s=i[i.length-1]}this.op=t,this.aNode=e,this.bNode=s}getNodeType(t,e){const s=this.op,i=this.aNode,n=this.bNode,r=i.getNodeType(t),a=typeof n<"u"?n.getNodeType(t):null;if(r==="void"||a==="void")return"void";if(s==="%")return r;if(s==="~"||s==="&"||s==="|"||s==="^"||s===">>"||s==="<<")return t.getIntegerType(r);if(s==="!"||s==="=="||s==="&&"||s==="||"||s==="^^")return"bool";if(s==="<"||s===">"||s==="<="||s===">="){const c=e?t.getTypeLength(e):Math.max(t.getTypeLength(r),t.getTypeLength(a));return c>1?`bvec${c}`:"bool"}else return r==="float"&&t.isMatrix(a)?a:t.isMatrix(r)&&t.isVector(a)?t.getVectorFromMatrix(r):t.isVector(r)&&t.isMatrix(a)?t.getVectorFromMatrix(a):t.getTypeLength(a)>t.getTypeLength(r)?a:r}generate(t,e){const s=this.op,i=this.aNode,n=this.bNode,r=this.getNodeType(t,e);let a=null,c=null;r!=="void"?(a=i.getNodeType(t),c=typeof n<"u"?n.getNodeType(t):null,s==="<"||s===">"||s==="<="||s===">="||s==="=="?t.isVector(a)?c=a:a!==c&&(a=c="float"):s===">>"||s==="<<"?(a=r,c=t.changeComponentType(c,"uint")):t.isMatrix(a)&&t.isVector(c)?c=t.getVectorFromMatrix(a):t.isVector(a)&&t.isMatrix(c)?a=t.getVectorFromMatrix(c):a=c=r):a=c=r;const l=i.build(t,a),u=typeof n<"u"?n.build(t,c):null,p=t.getTypeLength(e),h=t.getFunctionOperator(s);if(e!=="void")return s==="<"&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThan",e)}( ${l}, ${u} )`,r,e):t.format(`( ${l} < ${u} )`,r,e):s==="<="&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("lessThanEqual",e)}( ${l}, ${u} )`,r,e):t.format(`( ${l} <= ${u} )`,r,e):s===">"&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThan",e)}( ${l}, ${u} )`,r,e):t.format(`( ${l} > ${u} )`,r,e):s===">="&&p>1?t.useComparisonMethod?t.format(`${t.getMethod("greaterThanEqual",e)}( ${l}, ${u} )`,r,e):t.format(`( ${l} >= ${u} )`,r,e):s==="!"||s==="~"?t.format(`(${s}${l})`,a,e):h?t.format(`${h}( ${l}, ${u} )`,r,e):t.format(`( ${l} ${s} ${u} )`,r,e);if(a!=="void")return h?t.format(`${h}( ${l}, ${u} )`,r,e):t.format(`${l} ${s} ${u}`,r,e)}serialize(t){super.serialize(t),t.op=this.op}deserialize(t){super.deserialize(t),this.op=t.op}}const fe=L(Qt,"+"),wt=L(Qt,"-"),ct=L(Qt,"*"),si=L(Qt,"/"),b2=L(Qt,"%"),A8=L(Qt,"=="),N8=L(Qt,"!="),C8=L(Qt,"<"),v2=L(Qt,">"),F8=L(Qt,"<="),R8=L(Qt,">="),E8=L(Qt,"&&"),D8=L(Qt,"||"),B8=L(Qt,"!"),P8=L(Qt,"^^"),I8=L(Qt,"&"),L8=L(Qt,"~"),U8=L(Qt,"|"),z8=L(Qt,"^"),k8=L(Qt,"<<"),V8=L(Qt,">>");z("add",fe);z("sub",wt);z("mul",ct);z("div",si);z("modInt",b2);z("equal",A8);z("notEqual",N8);z("lessThan",C8);z("greaterThan",v2);z("lessThanEqual",F8);z("greaterThanEqual",R8);z("and",E8);z("or",D8);z("not",B8);z("xor",P8);z("bitAnd",I8);z("bitNot",L8);z("bitOr",U8);z("bitXor",z8);z("shiftLeft",k8);z("shiftRight",V8);const G8=(...o)=>(console.warn("TSL.OperatorNode: .remainder() has been renamed to .modInt()."),b2(...o));z("remainder",G8);class B extends pe{static get type(){return"MathNode"}constructor(t,e,s=null,i=null){super(),this.method=t,this.aNode=e,this.bNode=s,this.cNode=i}getInputType(t){const e=this.aNode.getNodeType(t),s=this.bNode?this.bNode.getNodeType(t):null,i=this.cNode?this.cNode.getNodeType(t):null,n=t.isMatrix(e)?0:t.getTypeLength(e),r=t.isMatrix(s)?0:t.getTypeLength(s),a=t.isMatrix(i)?0:t.getTypeLength(i);return n>r&&n>a?e:r>a?s:a>n?i:e}getNodeType(t){const e=this.method;return e===B.LENGTH||e===B.DISTANCE||e===B.DOT?"float":e===B.CROSS?"vec3":e===B.ALL?"bool":e===B.EQUALS?t.changeComponentType(this.aNode.getNodeType(t),"bool"):e===B.MOD?this.aNode.getNodeType(t):this.getInputType(t)}generate(t,e){const s=this.method,i=this.getNodeType(t),n=this.getInputType(t),r=this.aNode,a=this.bNode,c=this.cNode,l=t.renderer.isWebGLRenderer===!0;if(s===B.TRANSFORM_DIRECTION){let u=r,p=a;t.isMatrix(u.getNodeType(t))?p=J(D(p),0):u=J(D(u),0);const h=ct(u,p).xyz;return Ki(h).build(t,e)}else{if(s===B.NEGATE)return t.format("( - "+r.build(t,n)+" )",i,e);if(s===B.ONE_MINUS)return wt(1,r).build(t,e);if(s===B.RECIPROCAL)return si(1,r).build(t,e);if(s===B.DIFFERENCE)return Ot(wt(r,a)).build(t,e);{const u=[];return s===B.CROSS||s===B.MOD?u.push(r.build(t,i),a.build(t,i)):l&&s===B.STEP?u.push(r.build(t,t.getTypeLength(r.getNodeType(t))===1?"float":n),a.build(t,n)):l&&(s===B.MIN||s===B.MAX)||s===B.MOD?u.push(r.build(t,n),a.build(t,t.getTypeLength(a.getNodeType(t))===1?"float":n)):s===B.REFRACT?u.push(r.build(t,n),a.build(t,n),c.build(t,"float")):s===B.MIX?u.push(r.build(t,n),a.build(t,n),c.build(t,t.getTypeLength(c.getNodeType(t))===1?"float":n)):(u.push(r.build(t,n)),a!==null&&u.push(a.build(t,n)),c!==null&&u.push(c.build(t,n))),t.format(`${t.getMethod(s,i)}( ${u.join(", ")} )`,i,e)}}}serialize(t){super.serialize(t),t.method=this.method}deserialize(t){super.deserialize(t),this.method=t.method}}B.ALL="all";B.ANY="any";B.EQUALS="equals";B.RADIANS="radians";B.DEGREES="degrees";B.EXP="exp";B.EXP2="exp2";B.LOG="log";B.LOG2="log2";B.SQRT="sqrt";B.INVERSE_SQRT="inversesqrt";B.FLOOR="floor";B.CEIL="ceil";B.NORMALIZE="normalize";B.FRACT="fract";B.SIN="sin";B.COS="cos";B.TAN="tan";B.ASIN="asin";B.ACOS="acos";B.ATAN="atan";B.ABS="abs";B.SIGN="sign";B.LENGTH="length";B.NEGATE="negate";B.ONE_MINUS="oneMinus";B.DFDX="dFdx";B.DFDY="dFdy";B.ROUND="round";B.RECIPROCAL="reciprocal";B.TRUNC="trunc";B.FWIDTH="fwidth";B.BITCAST="bitcast";B.TRANSPOSE="transpose";B.ATAN2="atan2";B.MIN="min";B.MAX="max";B.MOD="mod";B.STEP="step";B.REFLECT="reflect";B.DISTANCE="distance";B.DIFFERENCE="difference";B.DOT="dot";B.CROSS="cross";B.POW="pow";B.TRANSFORM_DIRECTION="transformDirection";B.MIX="mix";B.CLAMP="clamp";B.REFRACT="refract";B.SMOOTHSTEP="smoothstep";B.FACEFORWARD="faceforward";const O8=_(1e-6),oy=_(1e6),Jc=_(Math.PI),ry=_(Math.PI*2),_2=L(B,B.ALL),W8=L(B,B.ANY),$8=L(B,B.EQUALS),H8=L(B,B.RADIANS),q8=L(B,B.DEGREES),S2=L(B,B.EXP),Pr=L(B,B.EXP2),Rl=L(B,B.LOG),fi=L(B,B.LOG2),Ai=L(B,B.SQRT),Y8=L(B,B.INVERSE_SQRT),mi=L(B,B.FLOOR),El=L(B,B.CEIL),Ki=L(B,B.NORMALIZE),tn=L(B,B.FRACT),Ss=L(B,B.SIN),Ii=L(B,B.COS),X8=L(B,B.TAN),Z8=L(B,B.ASIN),j8=L(B,B.ACOS),K8=L(B,B.ATAN),Ot=L(B,B.ABS),Ja=L(B,B.SIGN),Hi=L(B,B.LENGTH),J8=L(B,B.NEGATE),Q8=L(B,B.ONE_MINUS),T2=L(B,B.DFDX),M2=L(B,B.DFDY),t6=L(B,B.ROUND),e6=L(B,B.RECIPROCAL),A2=L(B,B.TRUNC),s6=L(B,B.FWIDTH),ay=L(B,B.BITCAST),i6=L(B,B.TRANSPOSE),n6=L(B,B.ATAN2),ps=L(B,B.MIN),le=L(B,B.MAX),N2=L(B,B.MOD),Dl=L(B,B.STEP),o6=L(B,B.REFLECT),r6=L(B,B.DISTANCE),a6=L(B,B.DIFFERENCE),kn=L(B,B.DOT),Bl=L(B,B.CROSS),Ks=L(B,B.POW),C2=L(B,B.POW,2),c6=L(B,B.POW,3),l6=L(B,B.POW,4),u6=L(B,B.TRANSFORM_DIRECTION),p6=o=>ct(Ja(o),Ks(Ot(o),1/3)),h6=o=>kn(o,o),Mt=L(B,B.MIX),wi=(o,t=0,e=1)=>k(new B(B.CLAMP,k(o),k(t),k(e))),d6=o=>wi(o),F2=L(B,B.REFRACT),Ji=L(B,B.SMOOTHSTEP),g6=L(B,B.FACEFORWARD),f6=P(([o])=>{const s=43758.5453,i=kn(o.xy,G(12.9898,78.233)),n=N2(i,Jc);return tn(Ss(n).mul(s))}),m6=(o,t,e)=>Mt(t,e,o),y6=(o,t,e)=>Ji(t,e,o);z("all",_2);z("any",W8);z("equals",$8);z("radians",H8);z("degrees",q8);z("exp",S2);z("exp2",Pr);z("log",Rl);z("log2",fi);z("sqrt",Ai);z("inverseSqrt",Y8);z("floor",mi);z("ceil",El);z("normalize",Ki);z("fract",tn);z("sin",Ss);z("cos",Ii);z("tan",X8);z("asin",Z8);z("acos",j8);z("atan",K8);z("abs",Ot);z("sign",Ja);z("length",Hi);z("lengthSq",h6);z("negate",J8);z("oneMinus",Q8);z("dFdx",T2);z("dFdy",M2);z("round",t6);z("reciprocal",e6);z("trunc",A2);z("fwidth",s6);z("atan2",n6);z("min",ps);z("max",le);z("mod",N2);z("step",Dl);z("reflect",o6);z("distance",r6);z("dot",kn);z("cross",Bl);z("pow",Ks);z("pow2",C2);z("pow3",c6);z("pow4",l6);z("transformDirection",u6);z("mix",m6);z("clamp",wi);z("refract",F2);z("smoothstep",y6);z("faceForward",g6);z("difference",a6);z("saturate",d6);z("cbrt",p6);z("transpose",i6);z("rand",f6);class cy extends tt{static get type(){return"ConditionalNode"}constructor(t,e,s=null){super(),this.condNode=t,this.ifNode=e,this.elseNode=s}getNodeType(t){const e=this.ifNode.getNodeType(t);if(this.elseNode!==null){const s=this.elseNode.getNodeType(t);if(t.getTypeLength(s)>t.getTypeLength(e))return s}return e}setup(t){const e=this.condNode.cache(),s=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,n=t.context.nodeBlock;t.getDataFromNode(s).parentNodeBlock=n,i!==null&&(t.getDataFromNode(i).parentNodeBlock=n);const r=t.getNodeProperties(this);r.condNode=e,r.ifNode=s.context({nodeBlock:s}),r.elseNode=i?i.context({nodeBlock:i}):null}generate(t,e){const s=this.getNodeType(t),i=t.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:n,ifNode:r,elseNode:a}=t.getNodeProperties(this),c=e!=="void",l=c?_8(s).build(t):"";i.nodeProperty=l;const u=n.build(t,"bool");t.addFlowCode(`
${t.tab}if ( ${u} ) {

`).addFlowTab();let p=r.build(t,s);if(p&&(c?p=l+" = "+p+";":p="return "+p+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+p+`

`+t.tab+"}"),a!==null){t.addFlowCode(` else {

`).addFlowTab();let h=a.build(t,s);h&&(c?h=l+" = "+h+";":h="return "+h+";"),t.removeFlowTab().addFlowCode(t.tab+"	"+h+`

`+t.tab+`}

`)}else t.addFlowCode(`

`);return t.format(l,s,e)}}const Ie=L(cy);z("select",Ie);const x6=(...o)=>(console.warn("TSL.ConditionalNode: cond() has been renamed to select()."),Ie(...o));z("cond",x6);class w6 extends tt{static get type(){return"ContextNode"}constructor(t,e={}){super(),this.isContextNode=!0,this.node=t,this.value=e}getScope(){return this.node.getScope()}getNodeType(t){return this.node.getNodeType(t)}analyze(t){this.node.build(t)}setup(t){const e=t.getContext();t.setContext({...t.context,...this.value});const s=this.node.build(t);return t.setContext(e),s}generate(t,e){const s=t.getContext();t.setContext({...t.context,...this.value});const i=this.node.build(t,e);return t.setContext(s),i}}const Pl=L(w6),b6=(o,t)=>Pl(o,{label:t});z("context",Pl);z("label",b6);class v6 extends tt{static get type(){return"VarNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.global=!0,this.isVarNode=!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}generate(t){const{node:e,name:s}=this,i=t.getVarFromNode(this,s,t.getVectorType(this.getNodeType(t))),n=t.getPropertyName(i),r=e.build(t,i.type);return t.addLineFlowCode(`${n} = ${r}`,this),n}}const _6=L(v6);z("toVar",(...o)=>_6(...o).append());const S6=o=>(console.warn('TSL: "temp" is deprecated. Use ".toVar()" instead.'),_6(o));z("temp",S6);class ly extends tt{static get type(){return"VaryingNode"}constructor(t,e=null){super(),this.node=t,this.name=e,this.isVaryingNode=!0}isGlobal(){return!0}getHash(t){return this.name||super.getHash(t)}getNodeType(t){return this.node.getNodeType(t)}setupVarying(t){const e=t.getNodeProperties(this);let s=e.varying;if(s===void 0){const i=this.name,n=this.getNodeType(t);e.varying=s=t.getVaryingFromNode(this,i,n),e.node=this.node}return s.needsInterpolation||(s.needsInterpolation=t.shaderStage==="fragment"),s}setup(t){this.setupVarying(t)}analyze(t){return this.setupVarying(t),this.node.analyze(t)}generate(t){const e=t.getNodeProperties(this),s=this.setupVarying(t);if(e.propertyName===void 0){const i=this.getNodeType(t),n=t.getPropertyName(s,ep.VERTEX);t.flowNodeFromShaderStage(ep.VERTEX,this.node,i,n),e.propertyName=n}return t.getPropertyName(s)}}const fs=L(ly);z("varying",fs);const T6=P(([o])=>{const t=o.mul(.9478672986).add(.0521327014).pow(2.4),e=o.mul(.0773993808),s=o.lessThanEqual(.04045);return Mt(t,e,s)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),M6=P(([o])=>{const t=o.pow(.41666).mul(1.055).sub(.055),e=o.mul(12.92),s=o.lessThanEqual(.0031308);return Mt(t,e,s)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),l0="WorkingColorSpace",R2="OutputColorSpace";class u0 extends pe{static get type(){return"ColorSpaceNode"}constructor(t,e,s){super("vec4"),this.colorNode=t,this.source=e,this.target=s}resolveColorSpace(t,e){return e===l0?he.workingColorSpace:e===R2?t.context.outputColorSpace||t.renderer.outputColorSpace:e}setup(t){const{colorNode:e}=this,s=this.resolveColorSpace(t,this.source),i=this.resolveColorSpace(t,this.target);let n=e;return he.enabled===!1||s===i||!s||!i||(he.getTransfer(s)===Sa&&(n=J(T6(n.rgb),n.a)),he.getPrimaries(s)!==he.getPrimaries(i)&&(n=J(qe(he._getMatrix(new gs,s,i)).mul(n.rgb),n.a)),he.getTransfer(i)===Sa&&(n=J(M6(n.rgb),n.a))),n}}const A6=o=>k(new u0(k(o),l0,R2)),N6=o=>k(new u0(k(o),R2,l0)),C6=(o,t)=>k(new u0(k(o),l0,t)),E2=(o,t)=>k(new u0(k(o),t,l0)),uy=(o,t,e)=>k(new u0(k(o),t,e));z("toOutputColorSpace",A6);z("toWorkingColorSpace",N6);z("workingToColorSpace",C6);z("colorSpaceToWorking",E2);let py=class extends No{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),s=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(e,s,i)}};class F6 extends tt{static get type(){return"ReferenceBaseNode"}constructor(t,e,s=null,i=null){super(),this.property=t,this.uniformType=e,this.object=s,this.count=i,this.properties=t.split("."),this.reference=s,this.node=null,this.group=null,this.updateType=rt.OBJECT}setGroup(t){return this.group=t,this}element(t){return k(new py(this,k(t)))}setNodeType(t){const e=Q(null,t).getSelf();this.group!==null&&e.setGroup(this.group),this.node=e}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let s=t[e[0]];for(let i=1;i<e.length;i++)s=s[e[i]];return s}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const hy=(o,t,e)=>k(new F6(o,t,e));class dy extends F6{static get type(){return"RendererReferenceNode"}constructor(t,e,s=null){super(t,e,s),this.renderer=s,this.setGroup(st)}updateReference(t){return this.reference=this.renderer!==null?this.renderer:t.renderer,this.reference}}const R6=(o,t,e)=>k(new dy(o,t,e));class gy extends pe{static get type(){return"ToneMappingNode"}constructor(t,e=D6,s=null){super("vec3"),this.toneMapping=t,this.exposureNode=e,this.colorNode=s}getCacheKey(){return j4(super.getCacheKey(),this.toneMapping)}setup(t){const e=this.colorNode||t.context.color,s=this.toneMapping;if(s===Sr)return e;let i=null;const n=t.renderer.library.getToneMappingFunction(s);return n!==null?i=J(n(e.rgb,this.exposureNode),e.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",s),i=e),i}}const E6=(o,t,e)=>k(new gy(o,k(t),k(e))),D6=R6("toneMappingExposure","float");z("toneMapping",(o,t,e)=>E6(t,e,o));class fy extends r2{static get type(){return"BufferAttributeNode"}constructor(t,e=null,s=0,i=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferStride=s,this.bufferOffset=i,this.usage=qc,this.instanced=!1,this.attribute=null,this.global=!0,t&&t.isBufferAttribute===!0&&(this.attribute=t,this.usage=t.usage,this.instanced=t.isInstancedBufferAttribute)}getHash(t){if(this.bufferStride===0&&this.bufferOffset===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getNodeType(t){return this.bufferType===null&&(this.bufferType=t.getTypeFromAttribute(this.attribute)),this.bufferType}setup(t){if(this.attribute!==null)return;const e=this.getNodeType(t),s=this.value,i=t.getTypeLength(e),n=this.bufferStride||i,r=this.bufferOffset,a=s.isInterleavedBuffer===!0?s:new E4(s,n),c=new Xp(a,i,r);a.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(t){const e=this.getNodeType(t),s=t.getBufferAttributeFromNode(this,e),i=t.getPropertyName(s);let n=null;return t.shaderStage==="vertex"||t.shaderStage==="compute"?(this.name=i,n=i):n=fs(this).build(t,e),n}getInputType(){return"bufferAttribute"}setUsage(t){return this.usage=t,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=t),this}setInstanced(t){return this.instanced=t,this}}const p0=(o,t,e,s)=>k(new fy(o,t,e,s)),B6=(o,t,e,s)=>p0(o,t,e,s).setUsage(vn),Qc=(o,t,e,s)=>p0(o,t,e,s).setInstanced(!0),cp=(o,t,e,s)=>B6(o,t,e,s).setInstanced(!0);z("toAttribute",o=>p0(o.value));class my extends tt{static get type(){return"ComputeNode"}constructor(t,e,s=[64]){super("void"),this.isComputeNode=!0,this.computeNode=t,this.count=e,this.workgroupSize=s,this.dispatchCount=0,this.version=1,this.updateBeforeType=rt.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(t){t===!0&&this.version++}updateDispatchCount(){const{count:t,workgroupSize:e}=this;let s=e[0];for(let i=1;i<e.length;i++)s*=e[i];this.dispatchCount=Math.ceil(t/s)}onInit(t){return this.onInitFunction=t,this}updateBefore({renderer:t}){t.compute(this)}generate(t){const{shaderStage:e}=t;if(e==="compute"){const s=this.computeNode.build(t,"void");s!==""&&t.addLineFlowCode(s,this)}}}const P6=(o,t,e)=>k(new my(k(o),t,e));z("compute",P6);class yy extends tt{static get type(){return"CacheNode"}constructor(t,e=!0){super(),this.node=t,this.parent=e,this.isCacheNode=!0}getNodeType(t){return this.node.getNodeType(t)}build(t,...e){const s=t.getCache(),i=t.getCacheFromNode(this,this.parent);t.setCache(i);const n=this.node.build(t,...e);return t.setCache(s),n}}const Da=(o,...t)=>k(new yy(k(o),...t));z("cache",Da);class xy extends tt{static get type(){return"BypassNode"}constructor(t,e){super(),this.isBypassNode=!0,this.outputNode=t,this.callNode=e}getNodeType(t){return this.outputNode.getNodeType(t)}generate(t){const e=this.callNode.build(t,"void");return e!==""&&t.addLineFlowCode(e,this),this.outputNode.build(t)}}const I6=L(xy);z("bypass",I6);class L6 extends tt{static get type(){return"RemapNode"}constructor(t,e,s,i=_(0),n=_(1)){super(),this.node=t,this.inLowNode=e,this.inHighNode=s,this.outLowNode=i,this.outHighNode=n,this.doClamp=!0}setup(){const{node:t,inLowNode:e,inHighNode:s,outLowNode:i,outHighNode:n,doClamp:r}=this;let a=t.sub(e).div(s.sub(e));return r===!0&&(a=a.clamp()),a.mul(n.sub(i)).add(i)}}const U6=L(L6,null,null,{doClamp:!1}),z6=L(L6);z("remap",U6);z("remapClamp",z6);class k6 extends tt{static get type(){return"ExpressionNode"}constructor(t="",e="void"){super(e),this.snippet=t}generate(t,e){const s=this.getNodeType(t),i=this.snippet;if(s==="void")t.addLineFlowCode(i,this);else return t.format(`( ${i} )`,s,e)}}const En=L(k6),V6=o=>(o?Ie(o,En("discard")):En("discard")).append(),wy=()=>En("return").append();z("discard",V6);class by extends pe{static get type(){return"RenderOutputNode"}constructor(t,e,s){super("vec4"),this.colorNode=t,this.toneMapping=e,this.outputColorSpace=s,this.isRenderOutput=!0}setup({context:t}){let e=this.colorNode||t.color;const s=(this.toneMapping!==null?this.toneMapping:t.toneMapping)||Sr,i=(this.outputColorSpace!==null?this.outputColorSpace:t.outputColorSpace)||yo;return s!==Sr&&(e=e.toneMapping(s)),i!==yo&&i!==he.workingColorSpace&&(e=e.workingToColorSpace(i)),e}}const G6=(o,t=null,e=null)=>k(new by(k(o),t,e));z("renderOutput",G6);function vy(o){console.warn("THREE.TSLBase: AddNodeElement has been removed in favor of tree-shaking. Trying add",o)}class O6 extends tt{static get type(){return"AttributeNode"}constructor(t,e=null){super(e),this.global=!0,this._attributeName=t}getHash(t){return this.getAttributeName(t)}getNodeType(t){let e=this.nodeType;if(e===null){const s=this.getAttributeName(t);if(t.hasGeometryAttribute(s)){const i=t.geometry.getAttribute(s);e=t.getTypeFromAttribute(i)}else e="float"}return e}setAttributeName(t){return this._attributeName=t,this}getAttributeName(){return this._attributeName}generate(t){const e=this.getAttributeName(t),s=this.getNodeType(t);if(t.hasGeometryAttribute(e)===!0){const n=t.geometry.getAttribute(e),r=t.getTypeFromAttribute(n),a=t.getAttribute(e,r);return t.shaderStage==="vertex"?t.format(a.name,r,s):fs(this).build(t,s)}else return console.warn(`AttributeNode: Vertex attribute "${e}" not found on geometry.`),t.generateConst(s)}serialize(t){super.serialize(t),t.global=this.global,t._attributeName=this._attributeName}deserialize(t){super.deserialize(t),this.global=t.global,this._attributeName=t._attributeName}}const bi=(o,t)=>k(new O6(o,t)),ee=o=>bi("uv"+(o>0?o:""),"vec2");class _y extends tt{static get type(){return"TextureSizeNode"}constructor(t,e=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=t,this.levelNode=e}generate(t,e){const s=this.textureNode.build(t,"property"),i=this.levelNode===null?"0":this.levelNode.build(t,"int");return t.format(`${t.getMethod("textureDimensions")}( ${s}, ${i} )`,this.getNodeType(t),e)}}const uo=L(_y);class Sy extends c0{static get type(){return"MaxMipLevelNode"}constructor(t){super(0),this._textureNode=t,this.updateType=rt.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const t=this.texture,e=t.images,s=e&&e.length>0?e[0]&&e[0].image||e[0]:t.image;if(s&&s.width!==void 0){const{width:i,height:n}=s;this.value=Math.log2(Math.max(i,n))}}}const W6=L(Sy);class vi extends c0{static get type(){return"TextureNode"}constructor(t,e=null,s=null,i=null){super(t),this.isTextureNode=!0,this.uvNode=e,this.levelNode=s,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=rt.NONE,this.referenceNode=null,this._value=t,this._matrixUniform=null,this.setUpdateMatrix(e===null)}set value(t){this.referenceNode?this.referenceNode.value=t:this._value=t}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===Pe?"uvec4":this.value.type===Ze?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return ee(this.value.channel)}updateReference(){return this.value}getTransformedUV(t){return this._matrixUniform===null&&(this._matrixUniform=Q(this.value.matrix)),this._matrixUniform.mul(D(t,1)).xy}setUpdateMatrix(t){return this.updateMatrix=t,this.updateType=t?rt.FRAME:rt.NONE,this}setupUV(t,e){const s=this.value;return t.isFlipY()&&(s.image instanceof ImageBitmap&&s.flipY===!0||s.isRenderTargetTexture===!0||s.isFramebufferTexture===!0||s.isDepthTexture===!0)&&(this.sampler?e=e.flipY():e=e.setY(C(uo(this,this.levelNode).y).sub(e.y).sub(1))),e}setup(t){const e=t.getNodeProperties(this);e.referenceNode=this.referenceNode;let s=this.uvNode;(s===null||t.context.forceUVContext===!0)&&t.context.getUV&&(s=t.context.getUV(this)),s||(s=this.getDefaultUV()),this.updateMatrix===!0&&(s=this.getTransformedUV(s)),s=this.setupUV(t,s);let i=this.levelNode;i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),e.uvNode=s,e.levelNode=i,e.biasNode=this.biasNode,e.compareNode=this.compareNode,e.gradNode=this.gradNode,e.depthNode=this.depthNode}generateUV(t,e){return e.build(t,this.sampler===!0?"vec2":"ivec2")}generateSnippet(t,e,s,i,n,r,a,c){const l=this.value;let u;return i?u=t.generateTextureLevel(l,e,s,i,r):n?u=t.generateTextureBias(l,e,s,n,r):c?u=t.generateTextureGrad(l,e,s,c,r):a?u=t.generateTextureCompare(l,e,s,a,r):this.sampler===!1?u=t.generateTextureLoad(l,e,s,r):u=t.generateTexture(l,e,s,r),u}generate(t,e){const s=t.getNodeProperties(this),i=this.value;if(!i||i.isTexture!==!0)throw new Error("TextureNode: Need a three.js texture.");const n=super.generate(t,"property");if(e==="sampler")return n+"_sampler";if(t.isReference(e))return n;{const r=t.getDataFromNode(this);let a=r.propertyName;if(a===void 0){const{uvNode:u,levelNode:p,biasNode:h,compareNode:d,depthNode:g,gradNode:f}=s,m=this.generateUV(t,u),x=p?p.build(t,"float"):null,w=h?h.build(t,"float"):null,b=g?g.build(t,"int"):null,v=d?d.build(t,"float"):null,T=f?[f[0].build(t,"vec2"),f[1].build(t,"vec2")]:null,M=t.getVarFromNode(this);a=t.getPropertyName(M);const F=this.generateSnippet(t,n,m,x,w,b,v,T);t.addLineFlowCode(`${a} = ${F}`,this),r.snippet=F,r.propertyName=a}let c=a;const l=this.getNodeType(t);return t.needsToWorkingColorSpace(i)&&(c=E2(En(c,l),i.colorSpace).setup(t).build(t,l)),t.format(c,l,e)}}setSampler(t){return this.sampler=t,this}getSampler(){return this.sampler}uv(t){const e=this.clone();return e.uvNode=k(t),e.referenceNode=this.getSelf(),k(e)}blur(t){const e=this.clone();return e.biasNode=k(t).mul(W6(e)),e.referenceNode=this.getSelf(),k(e)}level(t){const e=this.clone();return e.levelNode=k(t),e.referenceNode=this.getSelf(),k(e)}size(t){return uo(this,t)}bias(t){const e=this.clone();return e.biasNode=k(t),e.referenceNode=this.getSelf(),k(e)}compare(t){const e=this.clone();return e.compareNode=k(t),e.referenceNode=this.getSelf(),k(e)}grad(t,e){const s=this.clone();return s.gradNode=[k(t),k(e)],s.referenceNode=this.getSelf(),k(s)}depth(t){const e=this.clone();return e.depthNode=k(t),e.referenceNode=this.getSelf(),k(e)}serialize(t){super.serialize(t),t.value=this.value.toJSON(t.meta).uuid,t.sampler=this.sampler,t.updateMatrix=this.updateMatrix,t.updateType=this.updateType}deserialize(t){super.deserialize(t),this.value=t.meta.textures[t.value],this.sampler=t.sampler,this.updateMatrix=t.updateMatrix,this.updateType=t.updateType}update(){const t=this.value,e=this._matrixUniform;e!==null&&(e.value=t.matrix),t.matrixAutoUpdate===!0&&t.updateMatrix()}clone(){const t=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return t.sampler=this.sampler,t}}const yt=L(vi),ae=(...o)=>yt(...o).setSampler(!1),Ty=o=>(o.isNode===!0?o:yt(o)).convert("sampler"),yn=Q("float").label("cameraNear").setGroup(st).onRenderUpdate(({camera:o})=>o.near),xn=Q("float").label("cameraFar").setGroup(st).onRenderUpdate(({camera:o})=>o.far),Dn=Q("mat4").label("cameraProjectionMatrix").setGroup(st).onRenderUpdate(({camera:o})=>o.projectionMatrix),My=Q("mat4").label("cameraProjectionMatrixInverse").setGroup(st).onRenderUpdate(({camera:o})=>o.projectionMatrixInverse),ms=Q("mat4").label("cameraViewMatrix").setGroup(st).onRenderUpdate(({camera:o})=>o.matrixWorldInverse),Ay=Q("mat4").label("cameraWorldMatrix").setGroup(st).onRenderUpdate(({camera:o})=>o.matrixWorld),Ny=Q("mat3").label("cameraNormalMatrix").setGroup(st).onRenderUpdate(({camera:o})=>o.normalMatrix),$6=Q(new S).label("cameraPosition").setGroup(st).onRenderUpdate(({camera:o},t)=>t.value.setFromMatrixPosition(o.matrixWorld));class St extends tt{static get type(){return"Object3DNode"}constructor(t,e=null){super(),this.scope=t,this.object3d=e,this.updateType=rt.OBJECT,this._uniformNode=new c0(null)}getNodeType(){const t=this.scope;if(t===St.WORLD_MATRIX)return"mat4";if(t===St.POSITION||t===St.VIEW_POSITION||t===St.DIRECTION||t===St.SCALE)return"vec3"}update(t){const e=this.object3d,s=this._uniformNode,i=this.scope;if(i===St.WORLD_MATRIX)s.value=e.matrixWorld;else if(i===St.POSITION)s.value=s.value||new S,s.value.setFromMatrixPosition(e.matrixWorld);else if(i===St.SCALE)s.value=s.value||new S,s.value.setFromMatrixScale(e.matrixWorld);else if(i===St.DIRECTION)s.value=s.value||new S,e.getWorldDirection(s.value);else if(i===St.VIEW_POSITION){const n=t.camera;s.value=s.value||new S,s.value.setFromMatrixPosition(e.matrixWorld),s.value.applyMatrix4(n.matrixWorldInverse)}}generate(t){const e=this.scope;return e===St.WORLD_MATRIX?this._uniformNode.nodeType="mat4":(e===St.POSITION||e===St.VIEW_POSITION||e===St.DIRECTION||e===St.SCALE)&&(this._uniformNode.nodeType="vec3"),this._uniformNode.build(t)}serialize(t){super.serialize(t),t.scope=this.scope}deserialize(t){super.deserialize(t),this.scope=t.scope}}St.WORLD_MATRIX="worldMatrix";St.POSITION="position";St.SCALE="scale";St.VIEW_POSITION="viewPosition";St.DIRECTION="direction";const Cy=L(St,St.DIRECTION),Fy=L(St,St.WORLD_MATRIX),H6=L(St,St.POSITION),Ry=L(St,St.SCALE),Ey=L(St,St.VIEW_POSITION);class _i extends St{static get type(){return"ModelNode"}constructor(t){super(t)}update(t){this.object3d=t.object,super.update(t)}}const Dy=H(_i,_i.DIRECTION),Is=H(_i,_i.WORLD_MATRIX),By=H(_i,_i.POSITION),Py=H(_i,_i.SCALE),Iy=H(_i,_i.VIEW_POSITION),q6=Q(new gs).onObjectUpdate(({object:o},t)=>t.value.getNormalMatrix(o.matrixWorld)),Ly=Q(new gt).onObjectUpdate(({object:o},t)=>t.value.copy(o.matrixWorld).invert()),Co=ms.mul(Is).toVar("modelViewMatrix"),Uy=P(o=>(o.context.isHighPrecisionModelViewMatrix=!0,Q("mat4").onObjectUpdate(({object:t,camera:e})=>t.modelViewMatrix.multiplyMatrices(e.matrixWorldInverse,t.matrixWorld)))).once()().toVar("highPrecisionModelViewMatrix"),zy=P(o=>{const t=o.context.isHighPrecisionModelViewMatrix;return Q("mat3").onObjectUpdate(({object:e,camera:s})=>(t!==!0&&e.modelViewMatrix.multiplyMatrices(s.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix)))}).once()().toVar("highPrecisionModelNormalMatrix"),D2=bi("position","vec3"),re=D2.varying("positionLocal"),tl=D2.varying("positionPrevious"),qi=Is.mul(re).xyz.varying("v_positionWorld"),B2=re.transformDirection(Is).varying("v_positionWorldDirection").normalize().toVar("positionWorldDirection"),be=Co.mul(re).xyz.varying("v_positionView"),qt=be.negate().varying("v_positionViewDirection").normalize().toVar("positionViewDirection");class ky extends tt{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(t){const{renderer:e,material:s}=t;return e.coordinateSystem===js&&s.side===ls?"false":t.getFrontFacing()}}const Y6=H(ky),h0=_(Y6).mul(2).sub(1),Il=bi("normal","vec3"),hs=P(o=>o.geometry.hasAttribute("normal")===!1?(console.warn('TSL.NormalNode: Vertex attribute "normal" not found on geometry.'),D(0,1,0)):Il,"vec3").once()().toVar("normalLocal"),X6=be.dFdx().cross(be.dFdy()).normalize().toVar("normalFlat"),ks=P(o=>{let t;return o.material.flatShading===!0?t=X6:t=fs(P2(hs),"v_normalView").normalize(),t},"vec3").once()().toVar("normalView"),Ll=fs(ks.transformDirection(ms),"v_normalWorld").normalize().toVar("normalWorld"),ce=P(o=>o.context.setupNormal(),"vec3").once()().mul(h0).toVar("transformedNormalView"),Ul=ce.transformDirection(ms).toVar("transformedNormalWorld"),mr=P(o=>o.context.setupClearcoatNormal(),"vec3").once()().mul(h0).toVar("transformedClearcoatNormalView"),Z6=P(([o,t=Is])=>{const e=qe(t),s=o.div(D(e[0].dot(e[0]),e[1].dot(e[1]),e[2].dot(e[2])));return e.mul(s).xyz}),P2=P(([o],t)=>{const e=t.renderer.nodes.modelNormalViewMatrix;if(e!==null)return e.transformDirection(o);const s=q6.mul(o);return ms.transformDirection(s)}),j6=Q(0).onReference(({material:o})=>o).onRenderUpdate(({material:o})=>o.refractionRatio),K6=qt.negate().reflect(ce),J6=qt.negate().refract(ce,j6),Q6=K6.transformDirection(ms).toVar("reflectVector"),t7=J6.transformDirection(ms).toVar("reflectVector");class Vy extends vi{static get type(){return"CubeTextureNode"}constructor(t,e=null,s=null,i=null){super(t,e,s,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const t=this.value;return t.mapping===mo?Q6:t.mapping===Fr?t7:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',t.mapping),D(0,0,0))}setUpdateMatrix(){}setupUV(t,e){const s=this.value;return t.renderer.coordinateSystem===Xi||!s.isRenderTargetTexture?D(e.x.negate(),e.yz):e}generateUV(t,e){return e.build(t,"vec3")}}const Ir=L(Vy);class I2 extends c0{static get type(){return"BufferNode"}constructor(t,e,s=0){super(t,e),this.isBufferNode=!0,this.bufferType=e,this.bufferCount=s}getElementType(t){return this.getNodeType(t)}getInputType(){return"buffer"}}const d0=(o,t,e)=>k(new I2(o,t,e));class Gy extends No{static get type(){return"UniformArrayElementNode"}constructor(t,e){super(t,e),this.isArrayBufferElementNode=!0}generate(t){const e=super.generate(t),s=this.getNodeType();return t.format(e,"vec4",s)}}class e7 extends I2{static get type(){return"UniformArrayNode"}constructor(t,e=null){super(null,"vec4"),this.array=t,this.elementType=e,this._elementType=null,this._elementLength=0,this.updateType=rt.RENDER,this.isArrayBufferNode=!0}getElementType(){return this.elementType||this._elementType}getElementLength(){return this._elementLength}update(){const{array:t,value:e}=this,s=this.getElementLength(),i=this.getElementType();if(s===1)for(let n=0;n<t.length;n++){const r=n*4;e[r]=t[n]}else if(i==="color")for(let n=0;n<t.length;n++){const r=n*4,a=t[n];e[r]=a.r,e[r+1]=a.g,e[r+2]=a.b||0}else for(let n=0;n<t.length;n++){const r=n*4,a=t[n];e[r]=a.x,e[r+1]=a.y,e[r+2]=a.z||0,e[r+3]=a.w||0}}setup(t){const e=this.array.length;this._elementType=this.elementType===null?_n(this.array[0]):this.elementType,this._elementLength=t.getTypeLength(this._elementType);let s=Float32Array;return this._elementType.charAt(0)==="i"?s=Int32Array:this._elementType.charAt(0)==="u"&&(s=Uint32Array),this.value=new s(e*4),this.bufferCount=e,this.bufferType=t.changeComponentType("vec4",t.getComponentType(this._elementType)),super.setup(t)}element(t){return k(new Gy(this,k(t)))}}const Ui=(o,t)=>k(new e7(o,t)),Oy=(o,t)=>(console.warn("TSL.UniformArrayNode: uniforms() has been renamed to uniformArray()."),k(new e7(o,t)));class Wy extends No{static get type(){return"ReferenceElementNode"}constructor(t,e){super(t,e),this.referenceNode=t,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(t){const e=super.generate(t),s=this.referenceNode.getNodeType(),i=this.getNodeType();return t.format(e,s,i)}}class zl extends tt{static get type(){return"ReferenceNode"}constructor(t,e,s=null,i=null){super(),this.property=t,this.uniformType=e,this.object=s,this.count=i,this.properties=t.split("."),this.reference=s,this.node=null,this.group=null,this.name=null,this.updateType=rt.OBJECT}element(t){return k(new Wy(this,k(t)))}setGroup(t){return this.group=t,this}label(t){return this.name=t,this}setNodeType(t){let e=null;this.count!==null?e=d0(null,t,this.count):Array.isArray(this.getValueFromReference())?e=Ui(null,t):t==="texture"?e=yt(null):t==="cubeTexture"?e=Ir(null):e=Q(null,t),this.group!==null&&e.setGroup(this.group),this.name!==null&&e.label(this.name),this.node=e.getSelf()}getNodeType(t){return this.node===null&&(this.updateReference(t),this.updateValue()),this.node.getNodeType(t)}getValueFromReference(t=this.reference){const{properties:e}=this;let s=t[e[0]];for(let i=1;i<e.length;i++)s=s[e[i]];return s}updateReference(t){return this.reference=this.object!==null?this.object:t.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const t=this.getValueFromReference();Array.isArray(t)?this.node.array=t:this.node.value=t}}const Et=(o,t,e)=>k(new zl(o,t,e)),lp=(o,t,e,s)=>k(new zl(o,t,s,e));class $y extends zl{static get type(){return"MaterialReferenceNode"}constructor(t,e,s=null){super(t,e,s),this.material=s,this.isMaterialReferenceNode=!0}updateReference(t){return this.reference=this.material!==null?this.material:t.material,this.reference}}const zi=(o,t,e)=>k(new $y(o,t,e)),kl=P(o=>(o.geometry.hasAttribute("tangent")===!1&&o.geometry.computeTangents(),bi("tangent","vec4")))(),g0=kl.xyz.toVar("tangentLocal"),f0=Co.mul(J(g0,0)).xyz.varying("v_tangentView").normalize().toVar("tangentView"),s7=f0.transformDirection(ms).varying("v_tangentWorld").normalize().toVar("tangentWorld"),L2=f0.toVar("transformedTangentView"),Hy=L2.transformDirection(ms).normalize().toVar("transformedTangentWorld"),m0=o=>o.mul(kl.w).xyz,qy=fs(m0(Il.cross(kl)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),Yy=fs(m0(hs.cross(g0)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),i7=fs(m0(ks.cross(f0)),"v_bitangentView").normalize().toVar("bitangentView"),Xy=fs(m0(Ll.cross(s7)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),n7=m0(ce.cross(L2)).normalize().toVar("transformedBitangentView"),Zy=n7.transformDirection(ms).normalize().toVar("transformedBitangentWorld"),oo=qe(f0,i7,ks),o7=qt.mul(oo),jy=(o,t)=>o.sub(o7.mul(t)),r7=(()=>{let o=lo.cross(qt);return o=o.cross(lo).normalize(),o=Mt(o,ce,dn.mul(pi.oneMinus()).oneMinus().pow2().pow2()).normalize(),o})(),Ky=P(o=>{const{eye_pos:t,surf_norm:e,mapN:s,uv:i}=o,n=t.dFdx(),r=t.dFdy(),a=i.dFdx(),c=i.dFdy(),l=e,u=r.cross(l),p=l.cross(n),h=u.mul(a.x).add(p.mul(c.x)),d=u.mul(a.y).add(p.mul(c.y)),g=h.dot(h).max(d.dot(d)),f=h0.mul(g.inverseSqrt());return fe(h.mul(s.x,f),d.mul(s.y,f),l.mul(s.z)).normalize()});class Jy extends pe{static get type(){return"NormalMapNode"}constructor(t,e=null){super("vec3"),this.node=t,this.scaleNode=e,this.normalMapType=Fn}setup(t){const{normalMapType:e,scaleNode:s}=this;let i=this.node.mul(2).sub(1);s!==null&&(i=D(i.xy.mul(s),i.z));let n=null;return e===Dg?n=P2(i):e===Fn&&(t.hasGeometryAttribute("tangent")===!0?n=oo.mul(i).normalize():n=Ky({eye_pos:be,surf_norm:ks,mapN:i,uv:ee()})),n}}const up=L(Jy),Qy=P(({textureNode:o,bumpScale:t})=>{const e=i=>o.cache().context({getUV:n=>i(n.uvNode||ee()),forceUVContext:!0}),s=_(e(i=>i));return G(_(e(i=>i.add(i.dFdx()))).sub(s),_(e(i=>i.add(i.dFdy()))).sub(s)).mul(t)}),tx=P(o=>{const{surf_pos:t,surf_norm:e,dHdxy:s}=o,i=t.dFdx().normalize(),n=t.dFdy().normalize(),r=e,a=n.cross(r),c=r.cross(i),l=i.dot(a).mul(h0),u=l.sign().mul(s.x.mul(a).add(s.y.mul(c)));return l.abs().mul(e).sub(u).normalize()});class ex extends pe{static get type(){return"BumpMapNode"}constructor(t,e=null){super("vec3"),this.textureNode=t,this.scaleNode=e}setup(){const t=this.scaleNode!==null?this.scaleNode:1,e=Qy({textureNode:this.textureNode,bumpScale:t});return tx({surf_pos:be,surf_norm:ks,dHdxy:e})}}const a7=L(ex),g3=new Map;class I extends tt{static get type(){return"MaterialNode"}constructor(t){super(),this.scope=t}getCache(t,e){let s=g3.get(t);return s===void 0&&(s=zi(t,e),g3.set(t,s)),s}getFloat(t){return this.getCache(t,"float")}getColor(t){return this.getCache(t,"color")}getTexture(t){return this.getCache(t==="map"?"map":t+"Map","texture")}setup(t){const e=t.context.material,s=this.scope;let i=null;if(s===I.COLOR){const n=e.color!==void 0?this.getColor(s):D();e.map&&e.map.isTexture===!0?i=n.mul(this.getTexture("map")):i=n}else if(s===I.OPACITY){const n=this.getFloat(s);e.alphaMap&&e.alphaMap.isTexture===!0?i=n.mul(this.getTexture("alpha")):i=n}else if(s===I.SPECULAR_STRENGTH)e.specularMap&&e.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=_(1);else if(s===I.SPECULAR_INTENSITY){const n=this.getFloat(s);e.specularMap?i=n.mul(this.getTexture(s).a):i=n}else if(s===I.SPECULAR_COLOR){const n=this.getColor(s);e.specularColorMap&&e.specularColorMap.isTexture===!0?i=n.mul(this.getTexture(s).rgb):i=n}else if(s===I.ROUGHNESS){const n=this.getFloat(s);e.roughnessMap&&e.roughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).g):i=n}else if(s===I.METALNESS){const n=this.getFloat(s);e.metalnessMap&&e.metalnessMap.isTexture===!0?i=n.mul(this.getTexture(s).b):i=n}else if(s===I.EMISSIVE){const n=this.getFloat("emissiveIntensity"),r=this.getColor(s).mul(n);e.emissiveMap&&e.emissiveMap.isTexture===!0?i=r.mul(this.getTexture(s)):i=r}else if(s===I.NORMAL)e.normalMap?(i=up(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=e.normalMapType):e.bumpMap?i=a7(this.getTexture("bump").r,this.getFloat("bumpScale")):i=ks;else if(s===I.CLEARCOAT){const n=this.getFloat(s);e.clearcoatMap&&e.clearcoatMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.CLEARCOAT_ROUGHNESS){const n=this.getFloat(s);e.clearcoatRoughnessMap&&e.clearcoatRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.CLEARCOAT_NORMAL)e.clearcoatNormalMap?i=up(this.getTexture(s),this.getCache(s+"Scale","vec2")):i=ks;else if(s===I.SHEEN){const n=this.getColor("sheenColor").mul(this.getFloat("sheen"));e.sheenColorMap&&e.sheenColorMap.isTexture===!0?i=n.mul(this.getTexture("sheenColor").rgb):i=n}else if(s===I.SHEEN_ROUGHNESS){const n=this.getFloat(s);e.sheenRoughnessMap&&e.sheenRoughnessMap.isTexture===!0?i=n.mul(this.getTexture(s).a):i=n,i=i.clamp(.07,1)}else if(s===I.ANISOTROPY)if(e.anisotropyMap&&e.anisotropyMap.isTexture===!0){const n=this.getTexture(s);i=Nl(ar.x,ar.y,ar.y.negate(),ar.x).mul(n.rg.mul(2).sub(G(1)).normalize().mul(n.b))}else i=ar;else if(s===I.IRIDESCENCE_THICKNESS){const n=Et("1","float",e.iridescenceThicknessRange);if(e.iridescenceThicknessMap){const r=Et("0","float",e.iridescenceThicknessRange);i=n.sub(r).mul(this.getTexture(s).g).add(r)}else i=n}else if(s===I.TRANSMISSION){const n=this.getFloat(s);e.transmissionMap?i=n.mul(this.getTexture(s).r):i=n}else if(s===I.THICKNESS){const n=this.getFloat(s);e.thicknessMap?i=n.mul(this.getTexture(s).g):i=n}else if(s===I.IOR)i=this.getFloat(s);else if(s===I.LIGHT_MAP)i=this.getTexture(s).rgb.mul(this.getFloat("lightMapIntensity"));else if(s===I.AO_MAP)i=this.getTexture(s).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const n=this.getNodeType(t);i=this.getCache(s,n)}return i}}I.ALPHA_TEST="alphaTest";I.COLOR="color";I.OPACITY="opacity";I.SHININESS="shininess";I.SPECULAR="specular";I.SPECULAR_STRENGTH="specularStrength";I.SPECULAR_INTENSITY="specularIntensity";I.SPECULAR_COLOR="specularColor";I.REFLECTIVITY="reflectivity";I.ROUGHNESS="roughness";I.METALNESS="metalness";I.NORMAL="normal";I.CLEARCOAT="clearcoat";I.CLEARCOAT_ROUGHNESS="clearcoatRoughness";I.CLEARCOAT_NORMAL="clearcoatNormal";I.EMISSIVE="emissive";I.ROTATION="rotation";I.SHEEN="sheen";I.SHEEN_ROUGHNESS="sheenRoughness";I.ANISOTROPY="anisotropy";I.IRIDESCENCE="iridescence";I.IRIDESCENCE_IOR="iridescenceIOR";I.IRIDESCENCE_THICKNESS="iridescenceThickness";I.IOR="ior";I.TRANSMISSION="transmission";I.THICKNESS="thickness";I.ATTENUATION_DISTANCE="attenuationDistance";I.ATTENUATION_COLOR="attenuationColor";I.LINE_SCALE="scale";I.LINE_DASH_SIZE="dashSize";I.LINE_GAP_SIZE="gapSize";I.LINE_WIDTH="linewidth";I.LINE_DASH_OFFSET="dashOffset";I.POINT_WIDTH="pointWidth";I.DISPERSION="dispersion";I.LIGHT_MAP="light";I.AO_MAP="ao";const c7=H(I,I.ALPHA_TEST),l7=H(I,I.COLOR),u7=H(I,I.SHININESS),p7=H(I,I.EMISSIVE),U2=H(I,I.OPACITY),h7=H(I,I.SPECULAR),pp=H(I,I.SPECULAR_INTENSITY),d7=H(I,I.SPECULAR_COLOR),Ba=H(I,I.SPECULAR_STRENGTH),Fc=H(I,I.REFLECTIVITY),g7=H(I,I.ROUGHNESS),f7=H(I,I.METALNESS),m7=H(I,I.NORMAL).context({getUV:null}),y7=H(I,I.CLEARCOAT),x7=H(I,I.CLEARCOAT_ROUGHNESS),w7=H(I,I.CLEARCOAT_NORMAL).context({getUV:null}),b7=H(I,I.ROTATION),v7=H(I,I.SHEEN),_7=H(I,I.SHEEN_ROUGHNESS),S7=H(I,I.ANISOTROPY),T7=H(I,I.IRIDESCENCE),M7=H(I,I.IRIDESCENCE_IOR),A7=H(I,I.IRIDESCENCE_THICKNESS),N7=H(I,I.TRANSMISSION),C7=H(I,I.THICKNESS),F7=H(I,I.IOR),R7=H(I,I.ATTENUATION_DISTANCE),E7=H(I,I.ATTENUATION_COLOR),D7=H(I,I.LINE_SCALE),B7=H(I,I.LINE_DASH_SIZE),P7=H(I,I.LINE_GAP_SIZE),sx=H(I,I.LINE_WIDTH),I7=H(I,I.LINE_DASH_OFFSET),ix=H(I,I.POINT_WIDTH),L7=H(I,I.DISPERSION),z2=H(I,I.LIGHT_MAP),U7=H(I,I.AO_MAP),ar=Q(new Y).onReference(function(o){return o.material}).onRenderUpdate(function({material:o}){this.value.set(o.anisotropy*Math.cos(o.anisotropyRotation),o.anisotropy*Math.sin(o.anisotropyRotation))});class nx extends pe{static get type(){return"ModelViewProjectionNode"}constructor(t=null){super("vec4"),this.positionNode=t}setup(t){if(t.shaderStage==="fragment")return fs(t.context.mvp);const e=this.positionNode||re,s=t.renderer.nodes.modelViewMatrix||Co;return Dn.mul(s).mul(e)}}const k2=L(nx);class Yt extends tt{static get type(){return"IndexNode"}constructor(t){super("uint"),this.scope=t,this.isInstanceIndexNode=!0}generate(t){const e=this.getNodeType(t),s=this.scope;let i;if(s===Yt.VERTEX)i=t.getVertexIndex();else if(s===Yt.INSTANCE)i=t.getInstanceIndex();else if(s===Yt.DRAW)i=t.getDrawIndex();else if(s===Yt.INVOCATION_LOCAL)i=t.getInvocationLocalIndex();else if(s===Yt.INVOCATION_SUBGROUP)i=t.getInvocationSubgroupIndex();else if(s===Yt.SUBGROUP)i=t.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+s);let n;return t.shaderStage==="vertex"||t.shaderStage==="compute"?n=i:n=fs(this).build(t,e),n}}Yt.VERTEX="vertex";Yt.INSTANCE="instance";Yt.SUBGROUP="subgroup";Yt.INVOCATION_LOCAL="invocationLocal";Yt.INVOCATION_SUBGROUP="invocationSubgroup";Yt.DRAW="draw";const z7=H(Yt,Yt.VERTEX),y0=H(Yt,Yt.INSTANCE),ox=H(Yt,Yt.SUBGROUP),rx=H(Yt,Yt.INVOCATION_SUBGROUP),ax=H(Yt,Yt.INVOCATION_LOCAL),k7=H(Yt,Yt.DRAW);class V7 extends tt{static get type(){return"InstanceNode"}constructor(t,e,s){super("void"),this.count=t,this.instanceMatrix=e,this.instanceColor=s,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=rt.FRAME,this.buffer=null,this.bufferColor=null}setup(t){const{count:e,instanceMatrix:s,instanceColor:i}=this;let{instanceMatrixNode:n,instanceColorNode:r}=this;if(n===null){if(e<=1e3)n=d0(s.array,"mat4",Math.max(e,1)).element(y0);else{const c=new Fm(s.array,16,1);this.buffer=c;const l=s.usage===vn?cp:Qc,u=[l(c,"vec4",16,0),l(c,"vec4",16,4),l(c,"vec4",16,8),l(c,"vec4",16,12)];n=co(...u)}this.instanceMatrixNode=n}if(i&&r===null){const c=new Ga(i.array,3),l=i.usage===vn?cp:Qc;this.bufferColor=c,r=D(l(c,"vec3",3,0)),this.instanceColorNode=r}const a=n.mul(re).xyz;if(re.assign(a),t.hasGeometryAttribute("normal")){const c=Z6(hs,n);hs.assign(c)}this.instanceColorNode!==null&&Xa("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==vn&&this.buffer!=null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==vn&&this.bufferColor!=null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}const cx=L(V7);class lx extends V7{static get type(){return"InstancedMeshNode"}constructor(t){const{count:e,instanceMatrix:s,instanceColor:i}=t;super(e,s,i),this.instanceMesh=t}}const G7=L(lx);class ux extends tt{static get type(){return"BatchNode"}constructor(t){super("void"),this.batchMesh=t,this.batchingIdNode=null}setup(t){this.batchingIdNode===null&&(t.getDrawIndex()===null?this.batchingIdNode=y0:this.batchingIdNode=k7);const s=P(([g])=>{const f=uo(ae(this.batchMesh._indirectTexture),0),m=C(g).modInt(C(f)),x=C(g).div(C(f));return ae(this.batchMesh._indirectTexture,Me(m,x)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(C(this.batchingIdNode)),i=this.batchMesh._matricesTexture,n=uo(ae(i),0),r=_(s).mul(4).toInt().toVar(),a=r.modInt(n),c=r.div(C(n)),l=co(ae(i,Me(a,c)),ae(i,Me(a.add(1),c)),ae(i,Me(a.add(2),c)),ae(i,Me(a.add(3),c))),u=this.batchMesh._colorsTexture;if(u!==null){const f=P(([m])=>{const x=uo(ae(u),0).x,w=m,b=w.modInt(x),v=w.div(x);return ae(u,Me(b,v)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(s);Xa("vec3","vBatchColor").assign(f)}const p=qe(l);re.assign(l.mul(re));const h=hs.div(D(p[0].dot(p[0]),p[1].dot(p[1]),p[2].dot(p[2]))),d=p.mul(h).xyz;hs.assign(d),t.hasGeometryAttribute("tangent")&&g0.mulAssign(p)}}const O7=L(ux),f3=new WeakMap;class W7 extends tt{static get type(){return"SkinningNode"}constructor(t,e=!1){super("void"),this.skinnedMesh=t,this.useReference=e,this.updateType=rt.OBJECT,this.skinIndexNode=bi("skinIndex","uvec4"),this.skinWeightNode=bi("skinWeight","vec4");let s,i,n;e?(s=Et("bindMatrix","mat4"),i=Et("bindMatrixInverse","mat4"),n=lp("skeleton.boneMatrices","mat4",t.skeleton.bones.length)):(s=Q(t.bindMatrix,"mat4"),i=Q(t.bindMatrixInverse,"mat4"),n=d0(t.skeleton.boneMatrices,"mat4",t.skeleton.bones.length)),this.bindMatrixNode=s,this.bindMatrixInverseNode=i,this.boneMatricesNode=n,this.previousBoneMatricesNode=null}getSkinnedPosition(t=this.boneMatricesNode,e=re){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:n,bindMatrixInverseNode:r}=this,a=t.element(s.x),c=t.element(s.y),l=t.element(s.z),u=t.element(s.w),p=n.mul(e),h=fe(a.mul(i.x).mul(p),c.mul(i.y).mul(p),l.mul(i.z).mul(p),u.mul(i.w).mul(p));return r.mul(h).xyz}getSkinnedNormal(t=this.boneMatricesNode,e=hs){const{skinIndexNode:s,skinWeightNode:i,bindMatrixNode:n,bindMatrixInverseNode:r}=this,a=t.element(s.x),c=t.element(s.y),l=t.element(s.z),u=t.element(s.w);let p=fe(i.x.mul(a),i.y.mul(c),i.z.mul(l),i.w.mul(u));return p=r.mul(p).mul(n),p.transformDirection(e).xyz}getPreviousSkinnedPosition(t){const e=t.object;return this.previousBoneMatricesNode===null&&(e.skeleton.previousBoneMatrices=new Float32Array(e.skeleton.boneMatrices),this.previousBoneMatricesNode=lp("skeleton.previousBoneMatrices","mat4",e.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,tl)}needsPreviousBoneMatrices(t){const e=t.renderer.getMRT();return e&&e.has("velocity")}setup(t){this.needsPreviousBoneMatrices(t)&&tl.assign(this.getPreviousSkinnedPosition(t));const e=this.getSkinnedPosition();if(re.assign(e),t.hasGeometryAttribute("normal")){const s=this.getSkinnedNormal();hs.assign(s),t.hasGeometryAttribute("tangent")&&g0.assign(s)}}generate(t,e){if(e!=="void")return re.build(t,e)}update(t){const s=(this.useReference?t.object:this.skinnedMesh).skeleton;f3.get(s)!==t.frameId&&(f3.set(s,t.frameId),this.previousBoneMatricesNode!==null&&s.previousBoneMatrices.set(s.boneMatrices),s.update())}}const px=o=>k(new W7(o)),$7=o=>k(new W7(o,!0));class hx extends tt{static get type(){return"LoopNode"}constructor(t=[]){super(),this.params=t}getVarName(t){return String.fromCharCode(105+t)}getProperties(t){const e=t.getNodeProperties(this);if(e.stackNode!==void 0)return e;const s={};for(let n=0,r=this.params.length-1;n<r;n++){const a=this.params[n],c=a.isNode!==!0&&a.name||this.getVarName(n),l=a.isNode!==!0&&a.type||"int";s[c]=En(c,l)}const i=t.addStack();return e.returnsNode=this.params[this.params.length-1](s,i,t),e.stackNode=i,t.removeStack(),e}getNodeType(t){const{returnsNode:e}=this.getProperties(t);return e?e.getNodeType(t):"void"}setup(t){this.getProperties(t)}generate(t){const e=this.getProperties(t),s=this.params,i=e.stackNode;for(let a=0,c=s.length-1;a<c;a++){const l=s[a];let u=null,p=null,h=null,d=null,g=null,f=null;l.isNode?(d="int",h=this.getVarName(a),u="0",p=l.build(t,d),g="<"):(d=l.type||"int",h=l.name||this.getVarName(a),u=l.start,p=l.end,g=l.condition,f=l.update,typeof u=="number"?u=t.generateConst(d,u):u&&u.isNode&&(u=u.build(t,d)),typeof p=="number"?p=t.generateConst(d,p):p&&p.isNode&&(p=p.build(t,d)),u!==void 0&&p===void 0?(u=u+" - 1",p="0",g=">="):p!==void 0&&u===void 0&&(u="0",g="<"),g===void 0&&(Number(u)>Number(p)?g=">=":g="<"));const m={start:u,end:p},x=m.start,w=m.end;let b="",v="",T="";f||(d==="int"||d==="uint"?g.includes("<")?f="++":f="--":g.includes("<")?f="+= 1.":f="-= 1."),b+=t.getVar(d,h)+" = "+x,v+=h+" "+g+" "+w,T+=h+" "+f;const M=`for ( ${b}; ${v}; ${T} )`;t.addFlowCode((a===0?`
`:"")+t.tab+M+` {

`).addFlowTab()}const n=i.build(t,"void"),r=e.returnsNode?e.returnsNode.build(t):"";t.removeFlowTab().addFlowCode(`
`+t.tab+n);for(let a=0,c=this.params.length-1;a<c;a++)t.addFlowCode((a===0?"":t.tab)+`}

`).removeFlowTab();return t.addFlowTab(),r}}const Nt=(...o)=>k(new hx(ao(o,"int"))).append(),dx=()=>En("continue").append(),H7=()=>En("break").append(),gx=(...o)=>(console.warn("TSL.LoopNode: loop() has been renamed to Loop()."),Nt(...o)),R1=new WeakMap,bs=new vt,m3=P(({bufferMap:o,influence:t,stride:e,width:s,depth:i,offset:n})=>{const r=C(z7).mul(e).add(n),a=r.div(s),c=r.sub(a.mul(s));return ae(o,Me(c,a)).depth(i).mul(t)});function fx(o){const t=o.morphAttributes.position!==void 0,e=o.morphAttributes.normal!==void 0,s=o.morphAttributes.color!==void 0,i=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,n=i!==void 0?i.length:0;let r=R1.get(o);if(r===void 0||r.count!==n){let x=function(){f.dispose(),R1.delete(o),o.removeEventListener("dispose",x)};r!==void 0&&r.texture.dispose();const a=o.morphAttributes.position||[],c=o.morphAttributes.normal||[],l=o.morphAttributes.color||[];let u=0;t===!0&&(u=1),e===!0&&(u=2),s===!0&&(u=3);let p=o.attributes.position.count*u,h=1;const d=4096;p>d&&(h=Math.ceil(p/d),p=d);const g=new Float32Array(p*h*4*n),f=new xf(g,p,h,n);f.type=ns,f.needsUpdate=!0;const m=u*4;for(let w=0;w<n;w++){const b=a[w],v=c[w],T=l[w],M=p*h*4*w;for(let F=0;F<b.count;F++){const N=F*m;t===!0&&(bs.fromBufferAttribute(b,F),g[M+N+0]=bs.x,g[M+N+1]=bs.y,g[M+N+2]=bs.z,g[M+N+3]=0),e===!0&&(bs.fromBufferAttribute(v,F),g[M+N+4]=bs.x,g[M+N+5]=bs.y,g[M+N+6]=bs.z,g[M+N+7]=0),s===!0&&(bs.fromBufferAttribute(T,F),g[M+N+8]=bs.x,g[M+N+9]=bs.y,g[M+N+10]=bs.z,g[M+N+11]=T.itemSize===4?bs.w:1)}}r={count:n,texture:f,stride:u,size:new Y(p,h)},R1.set(o,r),o.addEventListener("dispose",x)}return r}class mx extends tt{static get type(){return"MorphNode"}constructor(t){super("void"),this.mesh=t,this.morphBaseInfluence=Q(1),this.updateType=rt.OBJECT}setup(t){const{geometry:e}=t,s=e.morphAttributes.position!==void 0,i=e.hasAttribute("normal")&&e.morphAttributes.normal!==void 0,n=e.morphAttributes.position||e.morphAttributes.normal||e.morphAttributes.color,r=n!==void 0?n.length:0,{texture:a,stride:c,size:l}=fx(e);s===!0&&re.mulAssign(this.morphBaseInfluence),i===!0&&hs.mulAssign(this.morphBaseInfluence);const u=C(l.width);Nt(r,({i:p})=>{const h=_(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?h.assign(ae(this.mesh.morphTexture,Me(C(p).add(1),C(y0))).r):h.assign(Et("morphTargetInfluences","float").element(p).toVar()),s===!0&&re.addAssign(m3({bufferMap:a,influence:h,stride:c,width:u,depth:p,offset:C(0)})),i===!0&&hs.addAssign(m3({bufferMap:a,influence:h,stride:c,width:u,depth:p,offset:C(1)}))})}update(){const t=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?t.value=1:t.value=1-this.mesh.morphTargetInfluences.reduce((e,s)=>e+s,0)}}const q7=L(mx);class Wr extends tt{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}generate(){console.warn("Abstract function.")}}class yx extends Wr{static get type(){return"AONode"}constructor(t=null){super(),this.aoNode=t}setup(t){t.context.ambientOcclusion.mulAssign(this.aoNode)}}class xx extends w6{static get type(){return"LightingContextNode"}constructor(t,e=null,s=null,i=null){super(t),this.lightingModel=e,this.backdropNode=s,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:t,backdropAlphaNode:e}=this,s=D().toVar("directDiffuse"),i=D().toVar("directSpecular"),n=D().toVar("indirectDiffuse"),r=D().toVar("indirectSpecular"),a={directDiffuse:s,directSpecular:i,indirectDiffuse:n,indirectSpecular:r};return{radiance:D().toVar("radiance"),irradiance:D().toVar("irradiance"),iblIrradiance:D().toVar("iblIrradiance"),ambientOcclusion:_(1).toVar("ambientOcclusion"),reflectedLight:a,backdrop:t,backdropAlpha:e}}setup(t){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||t.context.lightingModel,super.setup(t)}}const Y7=L(xx);class wx extends Wr{static get type(){return"IrradianceNode"}constructor(t){super(),this.node=t}setup(t){t.context.irradiance.addAssign(this.node)}}let sa,ia;class we extends tt{static get type(){return"ScreenNode"}constructor(t){super(),this.scope=t,this.isViewportNode=!0}getNodeType(){return this.scope===we.VIEWPORT?"vec4":"vec2"}getUpdateType(){let t=rt.NONE;return(this.scope===we.SIZE||this.scope===we.VIEWPORT)&&(t=rt.RENDER),this.updateType=t,t}update({renderer:t}){const e=t.getRenderTarget();this.scope===we.VIEWPORT?e!==null?ia.copy(e.viewport):(t.getViewport(ia),ia.multiplyScalar(t.getPixelRatio())):e!==null?(sa.width=e.width,sa.height=e.height):t.getDrawingBufferSize(sa)}setup(){const t=this.scope;let e=null;return t===we.SIZE?e=Q(sa||(sa=new Y)):t===we.VIEWPORT?e=Q(ia||(ia=new vt)):e=G(x0.div(Qa)),e}generate(t){if(this.scope===we.COORDINATE){let e=t.getFragCoord();if(t.isFlipY()){const s=t.getNodeProperties(Qa).outputNode.build(t);e=`${t.getType("vec2")}( ${e}.x, ${s}.y - ${e}.y )`}return e}return super.generate(t)}}we.COORDINATE="coordinate";we.VIEWPORT="viewport";we.SIZE="size";we.UV="uv";const Si=H(we,we.UV),Qa=H(we,we.SIZE),x0=H(we,we.COORDINATE),V2=H(we,we.VIEWPORT),X7=V2.zw,Z7=x0.sub(V2.xy),bx=Z7.div(X7),vx=P(()=>(console.warn('TSL.ViewportNode: "viewportResolution" is deprecated. Use "screenSize" instead.'),Qa),"vec2").once()(),_x=P(()=>(console.warn('TSL.ViewportNode: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),Si),"vec2").once()(),Sx=P(()=>(console.warn('TSL.ViewportNode: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),Si.flipY()),"vec2").once()(),na=new Y;class Vl extends vi{static get type(){return"ViewportTextureNode"}constructor(t=Si,e=null,s=null){s===null&&(s=new P4,s.minFilter=Gi),super(s,t,e),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=rt.FRAME}updateBefore(t){const e=t.renderer;e.getDrawingBufferSize(na);const s=this.value;(s.image.width!==na.width||s.image.height!==na.height)&&(s.image.width=na.width,s.image.height=na.height,s.needsUpdate=!0);const i=s.generateMipmaps;s.generateMipmaps=this.generateMipmaps,e.copyFramebufferToTexture(s),s.generateMipmaps=i}clone(){const t=new this.constructor(this.uvNode,this.levelNode,this.value);return t.generateMipmaps=this.generateMipmaps,t}}const Tx=L(Vl),G2=L(Vl,null,null,{generateMipmaps:!0});let E1=null;class Mx extends Vl{static get type(){return"ViewportDepthTextureNode"}constructor(t=Si,e=null){E1===null&&(E1=new To),super(t,e,E1)}}const O2=L(Mx);class os extends tt{static get type(){return"ViewportDepthNode"}constructor(t,e=null){super("float"),this.scope=t,this.valueNode=e,this.isViewportDepthNode=!0}generate(t){const{scope:e}=this;return e===os.DEPTH_BASE?t.getFragDepth():super.generate(t)}setup({camera:t}){const{scope:e}=this,s=this.valueNode;let i=null;if(e===os.DEPTH_BASE)s!==null&&(i=K7().assign(s));else if(e===os.DEPTH)t.isPerspectiveCamera?i=j7(be.z,yn,xn):i=Ar(be.z,yn,xn);else if(e===os.LINEAR_DEPTH)if(s!==null)if(t.isPerspectiveCamera){const n=W2(s,yn,xn);i=Ar(n,yn,xn)}else i=s;else i=Ar(be.z,yn,xn);return i}}os.DEPTH_BASE="depthBase";os.DEPTH="depth";os.LINEAR_DEPTH="linearDepth";const Ar=(o,t,e)=>o.add(t).div(t.sub(e)),Ax=(o,t,e)=>t.sub(e).mul(o).sub(t),j7=(o,t,e)=>t.add(o).mul(e).div(e.sub(t).mul(o)),W2=(o,t,e)=>t.mul(e).div(e.sub(t).mul(o).sub(e)),$2=(o,t,e)=>{t=t.max(1e-6).toVar();const s=fi(o.negate().div(t)),i=fi(e.div(t));return s.div(i)},Nx=(o,t,e)=>{const s=o.mul(Rl(e.div(t)));return _(Math.E).pow(s).mul(t).negate()},K7=L(os,os.DEPTH_BASE),H2=H(os,os.DEPTH),el=L(os,os.LINEAR_DEPTH),Cx=el(O2());H2.assign=o=>K7(o);class Fx extends tt{constructor(t){super("float"),this.name=t,this.isBuiltinNode=!0}generate(){return this.name}}const Rx=L(Fx);class Us extends tt{static get type(){return"ClippingNode"}constructor(t=Us.DEFAULT){super(),this.scope=t}setup(t){super.setup(t);const e=t.clippingContext,{intersectionPlanes:s,unionPlanes:i}=e;return this.hardwareClipping=t.material.hardwareClipping,this.scope===Us.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(s,i):this.scope===Us.HARDWARE?this.setupHardwareClipping(i,t):this.setupDefault(s,i)}setupAlphaToCoverage(t,e){return P(()=>{const s=_().toVar("distanceToPlane"),i=_().toVar("distanceToGradient"),n=_(1).toVar("clipOpacity"),r=e.length;if(!this.hardwareClipping&&r>0){const c=Ui(e);Nt(r,({i:l})=>{const u=c.element(l);s.assign(be.dot(u.xyz).negate().add(u.w)),i.assign(s.fwidth().div(2)),n.mulAssign(Ji(i.negate(),i,s))})}const a=t.length;if(a>0){const c=Ui(t),l=_(1).toVar("intersectionClipOpacity");Nt(a,({i:u})=>{const p=c.element(u);s.assign(be.dot(p.xyz).negate().add(p.w)),i.assign(s.fwidth().div(2)),l.mulAssign(Ji(i.negate(),i,s).oneMinus())}),n.mulAssign(l.oneMinus())}Tt.a.mulAssign(n),Tt.a.equal(0).discard()})()}setupDefault(t,e){return P(()=>{const s=e.length;if(!this.hardwareClipping&&s>0){const n=Ui(e);Nt(s,({i:r})=>{const a=n.element(r);be.dot(a.xyz).greaterThan(a.w).discard()})}const i=t.length;if(i>0){const n=Ui(t),r=ji(!0).toVar("clipped");Nt(i,({i:a})=>{const c=n.element(a);r.assign(be.dot(c.xyz).greaterThan(c.w).and(r))}),r.discard()}})()}setupHardwareClipping(t,e){const s=t.length;return e.enableHardwareClipping(s),P(()=>{const i=Ui(t),n=Rx(e.getClipDistance());Nt(s,({i:r})=>{const a=i.element(r),c=be.dot(a.xyz).sub(a.w).negate();n.element(r).assign(c)})})()}}Us.ALPHA_TO_COVERAGE="alphaToCoverage";Us.DEFAULT="default";Us.HARDWARE="hardware";const Ex=()=>k(new Us),Dx=()=>k(new Us(Us.ALPHA_TO_COVERAGE)),Bx=()=>k(new Us(Us.HARDWARE)),Px=.05,y3=P(([o])=>tn(ct(1e4,Ss(ct(17,o.x).add(ct(.1,o.y)))).mul(fe(.1,Ot(Ss(ct(13,o.y).add(o.x))))))),x3=P(([o])=>y3(G(y3(o.xy),o.z))),Ix=P(([o])=>{const t=le(Hi(T2(o.xyz)),Hi(M2(o.xyz))),e=_(1).div(_(Px).mul(t)).toVar("pixScale"),s=G(Pr(mi(fi(e))),Pr(El(fi(e)))),i=G(x3(mi(s.x.mul(o.xyz))),x3(mi(s.y.mul(o.xyz)))),n=tn(fi(e)),r=fe(ct(n.oneMinus(),i.x),ct(n,i.y)),a=ps(n,n.oneMinus()),c=D(r.mul(r).div(ct(2,a).mul(wt(1,a))),r.sub(ct(.5,a)).div(wt(1,a)),wt(1,wt(1,r).mul(wt(1,r)).div(ct(2,a).mul(wt(1,a))))),l=r.lessThan(a.oneMinus()).select(r.lessThan(a).select(c.x,c.y),c.z);return wi(l,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class ue extends us{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(t){}constructor(){super(),this.isNodeMaterial=!0,this.forceSinglePass=!1,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+K4(this)}build(t){this.setup(t)}setupObserver(t){return new Bm(t)}setup(t){t.context.setupNormal=()=>this.setupNormal(t);const e=t.renderer,s=e.getRenderTarget();t.addStack(),t.stack.outputNode=this.vertexNode||this.setupPosition(t),this.geometryNode!==null&&(t.stack.outputNode=t.stack.outputNode.bypass(this.geometryNode)),t.addFlow("vertex",t.removeStack()),t.addStack();let i;const n=this.setupClipping(t);if(this.depthWrite===!0&&(s!==null?s.depthBuffer===!0&&this.setupDepth(t):e.depth===!0&&this.setupDepth(t)),this.fragmentNode===null){this.setupDiffuseColor(t),this.setupVariants(t);const r=this.setupLighting(t);n!==null&&t.stack.add(n);const a=J(r,Tt.a).max(0);if(i=this.setupOutput(t,a),S8.assign(i),this.outputNode!==null&&(i=this.outputNode),s!==null){const c=e.getMRT(),l=this.mrtNode;c!==null?(i=c,l!==null&&(i=c.merge(l))):l!==null&&(i=l)}}else{let r=this.fragmentNode;r.isOutputStructNode!==!0&&(r=J(r)),i=this.setupOutput(t,r)}t.stack.outputNode=i,t.addFlow("fragment",t.removeStack()),t.monitor=this.setupObserver(t)}setupClipping(t){if(t.clippingContext===null)return null;const{unionPlanes:e,intersectionPlanes:s}=t.clippingContext;let i=null;if(e.length>0||s.length>0){const n=t.renderer.samples;this.alphaToCoverage&&n>1?i=Dx():t.stack.add(Ex())}return i}setupHardwareClipping(t){if(this.hardwareClipping=!1,t.clippingContext===null)return;const e=t.clippingContext.unionPlanes.length;e>0&&e<=8&&t.isAvailable("clipDistance")&&(t.stack.add(Bx()),this.hardwareClipping=!0)}setupDepth(t){const{renderer:e,camera:s}=t;let i=this.depthNode;if(i===null){const n=e.getMRT();n&&n.has("depth")?i=n.get("depth"):e.logarithmicDepthBuffer===!0&&(s.isPerspectiveCamera?i=$2(be.z,yn,xn):i=Ar(be.z,yn,xn))}i!==null&&H2.assign(i).append()}setupPosition(t){const{object:e}=t,s=e.geometry;if(t.addStack(),(s.morphAttributes.position||s.morphAttributes.normal||s.morphAttributes.color)&&q7(e).append(),e.isSkinnedMesh===!0&&$7(e).append(),this.displacementMap){const n=zi("displacementMap","texture"),r=zi("displacementScale","float"),a=zi("displacementBias","float");re.addAssign(hs.normalize().mul(n.x.mul(r).add(a)))}e.isBatchedMesh&&O7(e).append(),e.isInstancedMesh&&e.instanceMatrix&&e.instanceMatrix.isInstancedBufferAttribute===!0&&G7(e).append(),this.positionNode!==null&&re.assign(this.positionNode),this.setupHardwareClipping(t);const i=k2();return t.context.vertex=t.removeStack(),t.context.mvp=i,i}setupDiffuseColor({object:t,geometry:e}){let s=this.colorNode?J(this.colorNode):l7;this.vertexColors===!0&&e.hasAttribute("color")&&(s=J(s.xyz.mul(bi("color","vec3")),s.a)),t.instanceColor&&(s=Xa("vec3","vInstanceColor").mul(s)),t.isBatchedMesh&&t._colorsTexture&&(s=Xa("vec3","vBatchColor").mul(s)),Tt.assign(s);const i=this.opacityNode?_(this.opacityNode):U2;if(Tt.a.assign(Tt.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const n=this.alphaTestNode!==null?_(this.alphaTestNode):c7;Tt.a.lessThanEqual(n).discard()}this.alphaHash===!0&&Tt.a.lessThan(Ix(re)).discard(),this.transparent===!1&&this.blending===Tn&&this.alphaToCoverage===!1&&Tt.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?D(0):Tt.rgb}setupNormal(){return this.normalNode?D(this.normalNode):m7}setupEnvironment(){let t=null;return this.envNode?t=this.envNode:this.envMap&&(t=this.envMap.isCubeTexture?zi("envMap","cubeTexture"):zi("envMap","texture")),t}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new wx(z2)),e}setupLights(t){const e=[],s=this.setupEnvironment(t);s&&s.isLightingNode&&e.push(s);const i=this.setupLightMap(t);if(i&&i.isLightingNode&&e.push(i),this.aoNode!==null||t.material.aoMap){const r=this.aoNode!==null?this.aoNode:U7;e.push(new yx(r))}let n=this.lightsNode||t.lightsNode;return e.length>0&&(n=t.renderer.lighting.createNode([...n.getLights(),...e])),n}setupLightingModel(){}setupLighting(t){const{material:e}=t,{backdropNode:s,backdropAlphaNode:i,emissiveNode:n}=this,a=this.lights===!0||this.lightsNode!==null?this.setupLights(t):null;let c=this.setupOutgoingLight(t);if(a&&a.getScope().hasLights){const l=this.setupLightingModel(t);c=Y7(a,l,s,i)}else s!==null&&(c=D(i!==null?Mt(c,s,i):s));return(n&&n.isNode===!0||e.emissive&&e.emissive.isColor===!0)&&(rp.assign(D(n||p7)),c=c.add(rp)),c}setupOutput(t,e){if(this.fog===!0){const s=t.fogNode;s&&(e=J(s.mix(e.rgb,s.colorNode),e.a))}return e}setDefaultValues(t){for(const s in t){const i=t[s];this[s]===void 0&&(this[s]=i,i&&i.clone&&(this[s]=i.clone()))}const e=Object.getOwnPropertyDescriptors(t.constructor.prototype);for(const s in e)Object.getOwnPropertyDescriptor(this.constructor.prototype,s)===void 0&&e[s].get!==void 0&&Object.defineProperty(this.constructor.prototype,s,e[s])}toJSON(t){const e=t===void 0||typeof t=="string";e&&(t={textures:{},images:{},nodes:{}});const s=us.prototype.toJSON.call(this,t),i=Yc(this);s.inputNodes={};for(const{property:r,childNode:a}of i)s.inputNodes[r]=a.toJSON(t).uuid;function n(r){const a=[];for(const c in r){const l=r[c];delete l.metadata,a.push(l)}return a}if(e){const r=n(t.textures),a=n(t.images),c=n(t.nodes);r.length>0&&(s.textures=r),a.length>0&&(s.images=a),c.length>0&&(s.nodes=c)}return s}copy(t){return this.lightsNode=t.lightsNode,this.envNode=t.envNode,this.colorNode=t.colorNode,this.normalNode=t.normalNode,this.opacityNode=t.opacityNode,this.backdropNode=t.backdropNode,this.backdropAlphaNode=t.backdropAlphaNode,this.alphaTestNode=t.alphaTestNode,this.positionNode=t.positionNode,this.geometryNode=t.geometryNode,this.depthNode=t.depthNode,this.shadowPositionNode=t.shadowPositionNode,this.receivedShadowNode=t.receivedShadowNode,this.castShadowNode=t.castShadowNode,this.outputNode=t.outputNode,this.mrtNode=t.mrtNode,this.fragmentNode=t.fragmentNode,this.vertexNode=t.vertexNode,super.copy(t)}}const Lx=new B4;class Ux extends ue{static get type(){return"LineBasicNodeMaterial"}constructor(t){super(),this.isLineBasicNodeMaterial=!0,this.lights=!1,this.setDefaultValues(Lx),this.setValues(t)}}const zx=new bm;class kx extends ue{static get type(){return"LineDashedNodeMaterial"}constructor(t){super(),this.isLineDashedNodeMaterial=!0,this.lights=!1,this.setDefaultValues(zx),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(t)}setupVariants(){const t=this.offsetNode?_(this.offsetNodeNode):I7,e=this.dashScaleNode?_(this.dashScaleNode):D7,s=this.dashSizeNode?_(this.dashSizeNode):B7,i=this.dashSizeNode?_(this.dashGapNode):P7;Cc.assign(s),ap.assign(i);const n=fs(bi("lineDistance").mul(e));(t?n.add(t):n).mod(Cc.add(ap)).greaterThan(Cc).discard()}}let D1=null;class Vx extends Vl{static get type(){return"ViewportSharedTextureNode"}constructor(t=Si,e=null){D1===null&&(D1=new P4),super(t,e,D1)}updateReference(){return this}}const Gx=L(Vx),J7=o=>k(o).mul(.5).add(.5),Ox=o=>k(o).mul(2).sub(1),Wx=new ym;class $x extends ue{static get type(){return"MeshNormalNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(Wx),this.setValues(t)}setupDiffuseColor(){const t=this.opacityNode?_(this.opacityNode):U2;Tt.assign(J(J7(ce),t))}}class Hx extends pe{static get type(){return"EquirectUVNode"}constructor(t=B2){super("vec2"),this.dirNode=t}setup(){const t=this.dirNode,e=t.z.atan2(t.x).mul(1/(Math.PI*2)).add(.5),s=t.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return G(e,s)}}const q2=L(Hx);class Q7 extends Pf{constructor(t=1,e={}){super(t,e),this.isCubeRenderTarget=!0}fromEquirectangularTexture(t,e){const s=e.minFilter,i=e.generateMipmaps;e.generateMipmaps=!0,this.texture.type=e.type,this.texture.colorSpace=e.colorSpace,this.texture.generateMipmaps=e.generateMipmaps,this.texture.minFilter=e.minFilter,this.texture.magFilter=e.magFilter;const n=new Un(5,5,5),r=q2(B2),a=new ue;a.colorNode=yt(e,r,0),a.side=ls,a.blending=fo;const c=new V(n,a),l=new Yp;l.add(c),e.minFilter===Gi&&(e.minFilter=Je);const u=new R4(1,10,this),p=t.getMRT();return t.setMRT(null),u.update(t,l),t.setMRT(p),e.minFilter=s,e.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const Pa=new WeakMap;class qx extends pe{static get type(){return"CubeMapNode"}constructor(t){super("vec3"),this.envNode=t,this._cubeTexture=null,this._cubeTextureNode=Ir();const e=new $p;e.isRenderTargetTexture=!0,this._defaultTexture=e,this.updateBeforeType=rt.RENDER}updateBefore(t){const{renderer:e,material:s}=t,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const n=i.isTextureNode?i.value:s[i.property];if(n&&n.isTexture){const r=n.mapping;if(r===s0||r===i0){if(Pa.has(n)){const a=Pa.get(n);w3(a,n.mapping),this._cubeTexture=a}else{const a=n.image;if(Yx(a)){const c=new Q7(a.height);c.fromEquirectangularTexture(e,n),w3(c.texture,n.mapping),this._cubeTexture=c.texture,Pa.set(n,c.texture),n.addEventListener("dispose",t9)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(t){return this.updateBefore(t),this._cubeTextureNode}}function Yx(o){return o==null?!1:o.height>0}function t9(o){const t=o.target;t.removeEventListener("dispose",t9);const e=Pa.get(t);e!==void 0&&(Pa.delete(t),e.dispose())}function w3(o,t){t===s0?o.mapping=mo:t===i0&&(o.mapping=Fr)}const e9=L(qx);class Y2 extends Wr{static get type(){return"BasicEnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){t.context.environment=e9(this.envNode)}}class Xx extends Wr{static get type(){return"BasicLightMapNode"}constructor(t=null){super(),this.lightMapNode=t}setup(t){const e=_(1/Math.PI);t.context.irradianceLightMap=this.lightMapNode.mul(e)}}class Gl{start(){}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class s9 extends Gl{constructor(){super()}indirect(t,e,s){const i=t.ambientOcclusion,n=t.reflectedLight,r=s.context.irradianceLightMap;n.indirectDiffuse.assign(J(0)),r?n.indirectDiffuse.addAssign(r):n.indirectDiffuse.addAssign(J(1,1,1,0)),n.indirectDiffuse.mulAssign(i),n.indirectDiffuse.mulAssign(Tt.rgb)}finish(t,e,s){const i=s.material,n=t.outgoingLight,r=s.context.environment;if(r)switch(i.combine){case bl:n.rgb.assign(Mt(n.rgb,n.rgb.mul(r.rgb),Ba.mul(Fc)));break;case yg:n.rgb.assign(Mt(n.rgb,r.rgb,Ba.mul(Fc)));break;case xg:n.rgb.addAssign(r.rgb.mul(Ba.mul(Fc)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",i.combine);break}}}const Zx=new gi;class Ol extends ue{static get type(){return"MeshBasicNodeMaterial"}constructor(t){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Zx),this.setValues(t)}setupNormal(){return ks}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Y2(e):null}setupLightMap(t){let e=null;return t.material.lightMap&&(e=new Xx(z2)),e}setupOutgoingLight(){return Tt.rgb}setupLightingModel(){return new s9}}const Lr=P(({f0:o,f90:t,dotVH:e})=>{const s=e.mul(-5.55473).sub(6.98316).mul(e).exp2();return o.mul(s.oneMinus()).add(t.mul(s))}),bo=P(o=>o.diffuseColor.mul(1/Math.PI)),jx=()=>_(.25),Kx=P(({dotNH:o})=>jc.mul(_(.5)).add(1).mul(_(1/Math.PI)).mul(o.pow(jc))),Jx=P(({lightDirection:o})=>{const t=o.add(qt).normalize(),e=ce.dot(t).clamp(),s=qt.dot(t).clamp(),i=Lr({f0:ss,f90:1,dotVH:s}),n=jx(),r=Kx({dotNH:e});return i.mul(n).mul(r)});class i9 extends s9{constructor(t=!0){super(),this.specular=t}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const n=ce.dot(t).clamp().mul(e);s.directDiffuse.addAssign(n.mul(bo({diffuseColor:Tt.rgb}))),this.specular===!0&&s.directSpecular.addAssign(n.mul(Jx({lightDirection:t})).mul(Ba))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:s}){s.indirectDiffuse.addAssign(e.mul(bo({diffuseColor:Tt}))),s.indirectDiffuse.mulAssign(t)}}const Qx=new xm;class tw extends ue{static get type(){return"MeshLambertNodeMaterial"}constructor(t){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Qx),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Y2(e):null}setupLightingModel(){return new i9(!1)}}const ew=new fm;class sw extends ue{static get type(){return"MeshPhongNodeMaterial"}constructor(t){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(ew),this.setValues(t)}setupEnvironment(t){const e=super.setupEnvironment(t);return e?new Y2(e):null}setupLightingModel(){return new i9}setupVariants(){const t=(this.shininessNode?_(this.shininessNode):u7).max(1e-4);jc.assign(t);const e=this.specularNode||h7;ss.assign(e)}copy(t){return this.shininessNode=t.shininessNode,this.specularNode=t.specularNode,super.copy(t)}}const n9=P(o=>{if(o.geometry.hasAttribute("normal")===!1)return _(0);const t=ks.dFdx().abs().max(ks.dFdy().abs());return t.x.max(t.y).max(t.z)}),X2=P(o=>{const{roughness:t}=o,e=n9();let s=t.max(.0525);return s=s.add(e),s=s.min(1),s}),o9=P(({alpha:o,dotNL:t,dotNV:e})=>{const s=o.pow2(),i=t.mul(s.add(s.oneMinus().mul(e.pow2())).sqrt()),n=e.mul(s.add(s.oneMinus().mul(t.pow2())).sqrt());return si(.5,i.add(n).max(O8))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),iw=P(({alphaT:o,alphaB:t,dotTV:e,dotBV:s,dotTL:i,dotBL:n,dotNV:r,dotNL:a})=>{const c=a.mul(D(o.mul(e),t.mul(s),r).length()),l=r.mul(D(o.mul(i),t.mul(n),a).length());return si(.5,c.add(l)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),r9=P(({alpha:o,dotNH:t})=>{const e=o.pow2(),s=t.pow2().mul(e.oneMinus()).oneMinus();return e.div(s.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),nw=_(1/Math.PI),ow=P(({alphaT:o,alphaB:t,dotNH:e,dotTH:s,dotBH:i})=>{const n=o.mul(t),r=D(t.mul(s),o.mul(i),n.mul(e)),a=r.dot(r),c=n.div(a);return nw.mul(n.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),hp=P(o=>{const{lightDirection:t,f0:e,f90:s,roughness:i,f:n,USE_IRIDESCENCE:r,USE_ANISOTROPY:a}=o,c=o.normalView||ce,l=i.pow2(),u=t.add(qt).normalize(),p=c.dot(t).clamp(),h=c.dot(qt).clamp(),d=c.dot(u).clamp(),g=qt.dot(u).clamp();let f=Lr({f0:e,f90:s,dotVH:g}),m,x;if(qa(r)&&(f=Fl.mix(f,n)),qa(a)){const w=Ra.dot(t),b=Ra.dot(qt),v=Ra.dot(u),T=lo.dot(t),M=lo.dot(qt),F=lo.dot(u);m=iw({alphaT:Zc,alphaB:l,dotTV:b,dotBV:M,dotTL:w,dotBL:T,dotNV:h,dotNL:p}),x=ow({alphaT:Zc,alphaB:l,dotNH:d,dotTH:v,dotBH:F})}else m=o9({alpha:l,dotNL:p,dotNV:h}),x=r9({alpha:l,dotNH:d});return f.mul(m).mul(x)}),Z2=P(({roughness:o,dotNV:t})=>{const e=J(-1,-.0275,-.572,.022),s=J(1,.0425,1.04,-.04),i=o.mul(e).add(s),n=i.x.mul(i.x).min(t.mul(-9.28).exp2()).mul(i.x).add(i.y);return G(-1.04,1.04).mul(n).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),a9=P(o=>{const{dotNV:t,specularColor:e,specularF90:s,roughness:i}=o,n=Z2({dotNV:t,roughness:i});return e.mul(n.x).add(s.mul(n.y))}),c9=P(({f:o,f90:t,dotVH:e})=>{const s=e.oneMinus().saturate(),i=s.mul(s),n=s.mul(i,i).clamp(0,.9999);return o.sub(D(t).mul(n)).div(n.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),rw=P(({roughness:o,dotNH:t})=>{const e=o.pow2(),s=_(1).div(e),n=t.pow2().oneMinus().max(.0078125);return _(2).add(s).mul(n.pow(s.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),aw=P(({dotNV:o,dotNL:t})=>_(1).div(_(4).mul(t.add(o).sub(t.mul(o))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),cw=P(({lightDirection:o})=>{const t=o.add(qt).normalize(),e=ce.dot(o).clamp(),s=ce.dot(qt).clamp(),i=ce.dot(t).clamp(),n=rw({roughness:Cl,dotNH:i}),r=aw({dotNV:s,dotNL:e});return no.mul(n).mul(r)}),lw=P(({N:o,V:t,roughness:e})=>{const n=.0078125,r=o.dot(t).saturate(),a=G(e,r.oneMinus().sqrt());return a.assign(a.mul(.984375).add(n)),a}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),uw=P(({f:o})=>{const t=o.length();return le(t.mul(t).add(o.z).div(t.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),Z0=P(({v1:o,v2:t})=>{const e=o.dot(t),s=e.abs().toVar(),i=s.mul(.0145206).add(.4965155).mul(s).add(.8543985).toVar(),n=s.add(4.1616724).mul(s).add(3.417594).toVar(),r=i.div(n),a=e.greaterThan(0).select(r,le(e.mul(e).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(r));return o.cross(t).mul(a)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),b3=P(({N:o,V:t,P:e,mInv:s,p0:i,p1:n,p2:r,p3:a})=>{const c=n.sub(i).toVar(),l=a.sub(i).toVar(),u=c.cross(l),p=D().toVar();return pt(u.dot(e.sub(i)).greaterThanEqual(0),()=>{const h=t.sub(o.mul(t.dot(o))).normalize(),d=o.cross(h).negate(),g=s.mul(qe(h,d,o).transpose()).toVar(),f=g.mul(i.sub(e)).normalize().toVar(),m=g.mul(n.sub(e)).normalize().toVar(),x=g.mul(r.sub(e)).normalize().toVar(),w=g.mul(a.sub(e)).normalize().toVar(),b=D(0).toVar();b.addAssign(Z0({v1:f,v2:m})),b.addAssign(Z0({v1:m,v2:x})),b.addAssign(Z0({v1:x,v2:w})),b.addAssign(Z0({v1:w,v2:f})),p.assign(D(uw({f:b})))}),p}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),Wl=1/6,l9=o=>ct(Wl,ct(o,ct(o,o.negate().add(3)).sub(3)).add(1)),dp=o=>ct(Wl,ct(o,ct(o,ct(3,o).sub(6))).add(4)),u9=o=>ct(Wl,ct(o,ct(o,ct(-3,o).add(3)).add(3)).add(1)),gp=o=>ct(Wl,Ks(o,3)),v3=o=>l9(o).add(dp(o)),_3=o=>u9(o).add(gp(o)),S3=o=>fe(-1,dp(o).div(l9(o).add(dp(o)))),T3=o=>fe(1,gp(o).div(u9(o).add(gp(o)))),M3=(o,t,e)=>{const s=o.uvNode,i=ct(s,t.zw).add(.5),n=mi(i),r=tn(i),a=v3(r.x),c=_3(r.x),l=S3(r.x),u=T3(r.x),p=S3(r.y),h=T3(r.y),d=G(n.x.add(l),n.y.add(p)).sub(.5).mul(t.xy),g=G(n.x.add(u),n.y.add(p)).sub(.5).mul(t.xy),f=G(n.x.add(l),n.y.add(h)).sub(.5).mul(t.xy),m=G(n.x.add(u),n.y.add(h)).sub(.5).mul(t.xy),x=v3(r.y).mul(fe(a.mul(o.uv(d).level(e)),c.mul(o.uv(g).level(e)))),w=_3(r.y).mul(fe(a.mul(o.uv(f).level(e)),c.mul(o.uv(m).level(e))));return x.add(w)},p9=P(([o,t=_(3)])=>{const e=G(o.size(C(t))),s=G(o.size(C(t.add(1)))),i=si(1,e),n=si(1,s),r=M3(o,J(i,e),mi(t)),a=M3(o,J(n,s),El(t));return tn(t).mix(r,a)}),A3=P(([o,t,e,s,i])=>{const n=D(F2(t.negate(),Ki(o),si(1,s))),r=D(Hi(i[0].xyz),Hi(i[1].xyz),Hi(i[2].xyz));return Ki(n).mul(e.mul(r))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),pw=P(([o,t])=>o.mul(wi(t.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),hw=G2(),dw=G2(),N3=P(([o,t,e],{material:s})=>{const n=(s.side==ls?hw:dw).uv(o),r=fi(Qa.x).mul(pw(t,e));return p9(n,r)}),C3=P(([o,t,e])=>(pt(e.notEqual(0),()=>{const s=Rl(t).negate().div(e);return S2(s.negate().mul(o))}),D(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),gw=P(([o,t,e,s,i,n,r,a,c,l,u,p,h,d,g])=>{let f,m;if(g){f=J().toVar(),m=D().toVar();const T=u.sub(1).mul(g.mul(.025)),M=D(u.sub(T),u,u.add(T));Nt({start:0,end:3},({i:F})=>{const N=M.element(F),A=A3(o,t,p,N,a),E=r.add(A),U=l.mul(c.mul(J(E,1))),$=G(U.xy.div(U.w)).toVar();$.addAssign(1),$.divAssign(2),$.assign(G($.x,$.y.oneMinus()));const Z=N3($,e,N);f.element(F).assign(Z.element(F)),f.a.addAssign(Z.a),m.element(F).assign(s.element(F).mul(C3(Hi(A),h,d).element(F)))}),f.a.divAssign(3)}else{const T=A3(o,t,p,u,a),M=r.add(T),F=l.mul(c.mul(J(M,1))),N=G(F.xy.div(F.w)).toVar();N.addAssign(1),N.divAssign(2),N.assign(G(N.x,N.y.oneMinus())),f=N3(N,e,u),m=s.mul(C3(Hi(T),h,d))}const x=m.rgb.mul(f.rgb),w=o.dot(t).clamp(),b=D(a9({dotNV:w,specularColor:i,specularF90:n,roughness:e})),v=m.r.add(m.g,m.b).div(3);return J(b.oneMinus().mul(x),f.a.oneMinus().mul(v).oneMinus())}),fw=qe(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),mw=o=>{const t=o.sqrt();return D(1).add(t).div(D(1).sub(t))},F3=(o,t)=>o.sub(t).div(o.add(t)).pow2(),yw=(o,t)=>{const e=o.mul(2*Math.PI*1e-9),s=D(54856e-17,44201e-17,52481e-17),i=D(1681e3,1795300,2208400),n=D(43278e5,93046e5,66121e5),r=_(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(e.mul(2239900).add(t.x).cos()).mul(e.pow2().mul(-45282e5).exp());let a=s.mul(n.mul(2*Math.PI).sqrt()).mul(i.mul(e).add(t).cos()).mul(e.pow2().negate().mul(n).exp());return a=D(a.x.add(r),a.y,a.z).div(10685e-11),fw.mul(a)},xw=P(({outsideIOR:o,eta2:t,cosTheta1:e,thinFilmThickness:s,baseF0:i})=>{const n=Mt(o,t,Ji(0,.03,s)),a=o.div(n).pow2().mul(e.pow2().oneMinus()).oneMinus();pt(a.lessThan(0),()=>D(1));const c=a.sqrt(),l=F3(n,o),u=Lr({f0:l,f90:1,dotVH:e}),p=u.oneMinus(),h=n.lessThan(o).select(Math.PI,0),d=_(Math.PI).sub(h),g=mw(i.clamp(0,.9999)),f=F3(g,n.toVec3()),m=Lr({f0:f,f90:1,dotVH:c}),x=D(g.x.lessThan(n).select(Math.PI,0),g.y.lessThan(n).select(Math.PI,0),g.z.lessThan(n).select(Math.PI,0)),w=n.mul(s,c,2),b=D(d).add(x),v=u.mul(m).clamp(1e-5,.9999),T=v.sqrt(),M=p.pow2().mul(m).div(D(1).sub(v)),N=u.add(M).toVar(),A=M.sub(p).toVar();return Nt({start:1,end:2,condition:"<=",name:"m"},({m:E})=>{A.mulAssign(T);const U=yw(_(E).mul(w),_(E).mul(b)).mul(2);N.addAssign(A.mul(U))}),N.max(D(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),ww=P(({normal:o,viewDir:t,roughness:e})=>{const s=o.dot(t).saturate(),i=e.pow2(),n=Ie(e.lessThan(.25),_(-339.2).mul(i).add(_(161.4).mul(e)).sub(25.9),_(-8.48).mul(i).add(_(14.3).mul(e)).sub(9.95)),r=Ie(e.lessThan(.25),_(44).mul(i).sub(_(23.7).mul(e)).add(3.26),_(1.97).mul(i).sub(_(3.27).mul(e)).add(.72));return Ie(e.lessThan(.25),0,_(.1).mul(e).sub(.025)).add(n.mul(s).add(r).exp()).mul(1/Math.PI).saturate()}),B1=D(.04),P1=_(1);class h9 extends Gl{constructor(t=!1,e=!1,s=!1,i=!1,n=!1,r=!1){super(),this.clearcoat=t,this.sheen=e,this.iridescence=s,this.anisotropy=i,this.transmission=n,this.dispersion=r,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(t){if(this.clearcoat===!0&&(this.clearcoatRadiance=D().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=D().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=D().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=D().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=D().toVar("sheenSpecularIndirect")),this.iridescence===!0){const e=ce.dot(qt).clamp();this.iridescenceFresnel=xw({outsideIOR:_(1),eta2:g2,cosTheta1:e,thinFilmThickness:f2,baseF0:ss}),this.iridescenceF0=c9({f:this.iridescenceFresnel,f90:1,dotVH:e})}if(this.transmission===!0){const e=qi,s=$6.sub(qi).normalize(),i=Ul;t.backdrop=gw(i,s,pi,Tt,ss,Ka,e,Is,ms,Dn,Ea,m2,x2,y2,this.dispersion?w2:null),t.backdropAlpha=Kc,Tt.a.mulAssign(Mt(1,t.backdrop.a,Kc))}}computeMultiscattering(t,e,s){const i=ce.dot(qt).clamp(),n=Z2({roughness:pi,dotNV:i}),a=(this.iridescenceF0?Fl.mix(ss,this.iridescenceF0):ss).mul(n.x).add(s.mul(n.y)),l=n.x.add(n.y).oneMinus(),u=ss.add(ss.oneMinus().mul(.047619)),p=a.mul(u).div(l.mul(u).oneMinus());t.addAssign(a),e.addAssign(p.mul(l))}direct({lightDirection:t,lightColor:e,reflectedLight:s}){const n=ce.dot(t).clamp().mul(e);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(n.mul(cw({lightDirection:t}))),this.clearcoat===!0){const a=mr.dot(t).clamp().mul(e);this.clearcoatSpecularDirect.addAssign(a.mul(hp({lightDirection:t,f0:B1,f90:P1,roughness:ja,normalView:mr})))}s.directDiffuse.addAssign(n.mul(bo({diffuseColor:Tt.rgb}))),s.directSpecular.addAssign(n.mul(hp({lightDirection:t,f0:ss,f90:1,roughness:pi,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:t,lightPosition:e,halfWidth:s,halfHeight:i,reflectedLight:n,ltc_1:r,ltc_2:a}){const c=e.add(s).sub(i),l=e.sub(s).sub(i),u=e.sub(s).add(i),p=e.add(s).add(i),h=ce,d=qt,g=be.toVar(),f=lw({N:h,V:d,roughness:pi}),m=r.uv(f).toVar(),x=a.uv(f).toVar(),w=qe(D(m.x,0,m.y),D(0,1,0),D(m.z,0,m.w)).toVar(),b=ss.mul(x.x).add(ss.oneMinus().mul(x.y)).toVar();n.directSpecular.addAssign(t.mul(b).mul(b3({N:h,V:d,P:g,mInv:w,p0:c,p1:l,p2:u,p3:p}))),n.directDiffuse.addAssign(t.mul(Tt).mul(b3({N:h,V:d,P:g,mInv:qe(1,0,0,0,1,0,0,0,1),p0:c,p1:l,p2:u,p3:p})))}indirect(t,e,s){this.indirectDiffuse(t,e,s),this.indirectSpecular(t,e,s),this.ambientOcclusion(t,e,s)}indirectDiffuse({irradiance:t,reflectedLight:e}){e.indirectDiffuse.addAssign(t.mul(bo({diffuseColor:Tt})))}indirectSpecular({radiance:t,iblIrradiance:e,reflectedLight:s}){if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(e.mul(no,ww({normal:ce,viewDir:qt,roughness:Cl}))),this.clearcoat===!0){const l=mr.dot(qt).clamp(),u=a9({dotNV:l,specularColor:B1,specularF90:P1,roughness:ja});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(u))}const i=D().toVar("singleScattering"),n=D().toVar("multiScattering"),r=e.mul(1/Math.PI);this.computeMultiscattering(i,n,Ka);const a=i.add(n),c=Tt.mul(a.r.max(a.g).max(a.b).oneMinus());s.indirectSpecular.addAssign(t.mul(i)),s.indirectSpecular.addAssign(n.mul(r)),s.indirectDiffuse.addAssign(c.mul(r))}ambientOcclusion({ambientOcclusion:t,reflectedLight:e}){const i=ce.dot(qt).clamp().add(t),n=pi.mul(-16).oneMinus().negate().exp2(),r=t.sub(i.pow(n).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),e.indirectDiffuse.mulAssign(t),e.indirectSpecular.mulAssign(r)}finish(t){const{outgoingLight:e}=t;if(this.clearcoat===!0){const s=mr.dot(qt).clamp(),i=Lr({dotVH:s,f0:B1,f90:P1}),n=e.mul(Xc.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(Xc));e.assign(n)}if(this.sheen===!0){const s=no.r.max(no.g).max(no.b).mul(.157).oneMinus(),i=e.mul(s).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);e.assign(i)}}}const R3=_(1),fp=_(-2),j0=_(.8),I1=_(-1),K0=_(.4),L1=_(2),J0=_(.305),U1=_(3),E3=_(.21),bw=_(4),D3=_(4),vw=_(16),_w=P(([o])=>{const t=D(Ot(o)).toVar(),e=_(-1).toVar();return pt(t.x.greaterThan(t.z),()=>{pt(t.x.greaterThan(t.y),()=>{e.assign(Ie(o.x.greaterThan(0),0,3))}).Else(()=>{e.assign(Ie(o.y.greaterThan(0),1,4))})}).Else(()=>{pt(t.z.greaterThan(t.y),()=>{e.assign(Ie(o.z.greaterThan(0),2,5))}).Else(()=>{e.assign(Ie(o.y.greaterThan(0),1,4))})}),e}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),Sw=P(([o,t])=>{const e=G().toVar();return pt(t.equal(0),()=>{e.assign(G(o.z,o.y).div(Ot(o.x)))}).ElseIf(t.equal(1),()=>{e.assign(G(o.x.negate(),o.z.negate()).div(Ot(o.y)))}).ElseIf(t.equal(2),()=>{e.assign(G(o.x.negate(),o.y).div(Ot(o.z)))}).ElseIf(t.equal(3),()=>{e.assign(G(o.z.negate(),o.y).div(Ot(o.x)))}).ElseIf(t.equal(4),()=>{e.assign(G(o.x.negate(),o.z).div(Ot(o.y)))}).Else(()=>{e.assign(G(o.x,o.y).div(Ot(o.z)))}),ct(.5,e.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),Tw=P(([o])=>{const t=_(0).toVar();return pt(o.greaterThanEqual(j0),()=>{t.assign(R3.sub(o).mul(I1.sub(fp)).div(R3.sub(j0)).add(fp))}).ElseIf(o.greaterThanEqual(K0),()=>{t.assign(j0.sub(o).mul(L1.sub(I1)).div(j0.sub(K0)).add(I1))}).ElseIf(o.greaterThanEqual(J0),()=>{t.assign(K0.sub(o).mul(U1.sub(L1)).div(K0.sub(J0)).add(L1))}).ElseIf(o.greaterThanEqual(E3),()=>{t.assign(J0.sub(o).mul(bw.sub(U1)).div(J0.sub(E3)).add(U1))}).Else(()=>{t.assign(_(-2).mul(fi(ct(1.16,o))))}),t}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),d9=P(([o,t])=>{const e=o.toVar();e.assign(ct(2,e).sub(1));const s=D(e,1).toVar();return pt(t.equal(0),()=>{s.assign(s.zyx)}).ElseIf(t.equal(1),()=>{s.assign(s.xzy),s.xz.mulAssign(-1)}).ElseIf(t.equal(2),()=>{s.x.mulAssign(-1)}).ElseIf(t.equal(3),()=>{s.assign(s.zyx),s.xz.mulAssign(-1)}).ElseIf(t.equal(4),()=>{s.assign(s.xzy),s.xy.mulAssign(-1)}).ElseIf(t.equal(5),()=>{s.z.mulAssign(-1)}),s}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),g9=P(([o,t,e,s,i,n])=>{const r=_(e),a=D(t),c=wi(Tw(r),fp,n),l=tn(c),u=mi(c),p=D(mp(o,a,u,s,i,n)).toVar();return pt(l.notEqual(0),()=>{const h=D(mp(o,a,u.add(1),s,i,n)).toVar();p.assign(Mt(p,h,l))}),p}),mp=P(([o,t,e,s,i,n])=>{const r=_(e).toVar(),a=D(t),c=_(_w(a)).toVar(),l=_(le(D3.sub(r),0)).toVar();r.assign(le(r,D3));const u=_(Pr(r)).toVar(),p=G(Sw(a,c).mul(u.sub(2)).add(1)).toVar();return pt(c.greaterThan(2),()=>{p.y.addAssign(u),c.subAssign(3)}),p.x.addAssign(c.mul(u)),p.x.addAssign(l.mul(ct(3,vw))),p.y.addAssign(ct(4,Pr(n).sub(u))),p.x.mulAssign(s),p.y.mulAssign(i),o.uv(p).grad(G(),G())}),z1=P(({envMap:o,mipInt:t,outputDirection:e,theta:s,axis:i,CUBEUV_TEXEL_WIDTH:n,CUBEUV_TEXEL_HEIGHT:r,CUBEUV_MAX_MIP:a})=>{const c=Ii(s),l=e.mul(c).add(i.cross(e).mul(Ss(s))).add(i.mul(i.dot(e).mul(c.oneMinus())));return mp(o,l,t,n,r,a)}),f9=P(({n:o,latitudinal:t,poleAxis:e,outputDirection:s,weights:i,samples:n,dTheta:r,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})=>{const h=D(Ie(t,e,Bl(e,s))).toVar();pt(_2(h.equals(D(0))),()=>{h.assign(D(s.z,0,s.x.negate()))}),h.assign(Ki(h));const d=D().toVar();return d.addAssign(i.element(C(0)).mul(z1({theta:0,axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),Nt({start:C(1),end:o},({i:g})=>{pt(g.greaterThanEqual(n),()=>{H7()});const f=_(r.mul(_(g))).toVar();d.addAssign(i.element(g).mul(z1({theta:f.mul(-1),axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p}))),d.addAssign(i.element(g).mul(z1({theta:f,axis:h,outputDirection:s,mipInt:a,envMap:c,CUBEUV_TEXEL_WIDTH:l,CUBEUV_TEXEL_HEIGHT:u,CUBEUV_MAX_MIP:p})))}),J(d,1)});let sl=null;const B3=new WeakMap;function Mw(o){const t=Math.log2(o)-2,e=1/o;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:e,maxMip:t}}function Aw(o){let t=B3.get(o);if((t!==void 0?t.pmremVersion:-1)!==o.pmremVersion){const s=o.image;if(o.isCubeTexture)if(Cw(s))t=sl.fromCubemap(o,t);else return null;else if(Fw(s))t=sl.fromEquirectangular(o,t);else return null;t.pmremVersion=o.pmremVersion,B3.set(o,t)}return t.texture}class Nw extends pe{static get type(){return"PMREMNode"}constructor(t,e=null,s=null){super("vec3"),this._value=t,this._pmrem=null,this.uvNode=e,this.levelNode=s,this._generator=null;const i=new Ke;i.isRenderTargetTexture=!0,this._texture=yt(i),this._width=Q(0),this._height=Q(0),this._maxMip=Q(0),this.updateBeforeType=rt.RENDER}set value(t){this._value=t,this._pmrem=null}get value(){return this._value}updateFromTexture(t){const e=Mw(t.image.height);this._texture.value=t,this._width.value=e.texelWidth,this._height.value=e.texelHeight,this._maxMip.value=e.maxMip}updateBefore(){let t=this._pmrem;const e=t?t.pmremVersion:-1,s=this._value;e!==s.pmremVersion&&(s.isPMREMTexture===!0?t=s:t=Aw(s),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(t){sl===null&&(sl=t.createPMREMGenerator()),this.updateBefore(t);let e=this.uvNode;e===null&&t.context.getUV&&(e=t.context.getUV(this));const s=this.value;t.renderer.coordinateSystem===js&&s.isPMREMTexture!==!0&&s.isRenderTargetTexture===!0&&(e=D(e.x.negate(),e.yz));let i=this.levelNode;return i===null&&t.context.getTextureLevel&&(i=t.context.getTextureLevel(this)),g9(this._texture,e,i,this._width,this._height,this._maxMip)}}function Cw(o){if(o==null)return!1;let t=0;const e=6;for(let s=0;s<e;s++)o[s]!==void 0&&t++;return t===e}function Fw(o){return o==null?!1:o.height>0}const j2=L(Nw),P3=new WeakMap;class Rw extends Wr{static get type(){return"EnvironmentNode"}constructor(t=null){super(),this.envNode=t}setup(t){const{material:e}=t;let s=this.envNode;if(s.isTextureNode||s.isMaterialReferenceNode){const d=s.isTextureNode?s.value:e[s.property];let g=P3.get(d);g===void 0&&(g=j2(d),P3.set(d,g)),s=g}const n=e.envMap?Et("envMapIntensity","float",t.material):Et("environmentIntensity","float",t.scene),a=e.useAnisotropy===!0||e.anisotropy>0?r7:ce,c=s.context(I3(pi,a)).mul(n),l=s.context(Ew(Ul)).mul(Math.PI).mul(n),u=Da(c),p=Da(l);t.context.radiance.addAssign(u),t.context.iblIrradiance.addAssign(p);const h=t.context.lightingModel.clearcoatRadiance;if(h){const d=s.context(I3(ja,mr)).mul(n),g=Da(d);h.addAssign(g)}}}const I3=(o,t)=>{let e=null;return{getUV:()=>(e===null&&(e=qt.negate().reflect(t),e=o.mul(o).mix(e,t).normalize(),e=e.transformDirection(ms)),e),getTextureLevel:()=>o}},Ew=o=>({getUV:()=>o,getTextureLevel:()=>_(1)}),Dw=new xi;class ds extends ue{static get type(){return"MeshStandardNodeMaterial"}constructor(t){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Dw),this.setValues(t)}setupEnvironment(t){let e=super.setupEnvironment(t);return e===null&&t.environmentNode&&(e=t.environmentNode),e?new Rw(e):null}setupLightingModel(){return new h9}setupSpecular(){const t=Mt(D(.04),Tt.rgb,Za);ss.assign(t),Ka.assign(1)}setupVariants(){const t=this.metalnessNode?_(this.metalnessNode):f7;Za.assign(t);let e=this.roughnessNode?_(this.roughnessNode):g7;e=X2({roughness:e}),pi.assign(e),this.setupSpecular(),Tt.assign(J(Tt.rgb.mul(t.oneMinus()),Tt.a))}copy(t){return this.emissiveNode=t.emissiveNode,this.metalnessNode=t.metalnessNode,this.roughnessNode=t.roughnessNode,super.copy(t)}}const Bw=new H4;class Pw extends ds{static get type(){return"MeshPhysicalNodeMaterial"}constructor(t){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(Bw),this.setValues(t)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const t=this.iorNode?_(this.iorNode):F7;Ea.assign(t),ss.assign(Mt(ps(C2(Ea.sub(1).div(Ea.add(1))).mul(d7),D(1)).mul(pp),Tt.rgb,Za)),Ka.assign(Mt(pp,1,Za))}setupLightingModel(){return new h9(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(t){if(super.setupVariants(t),this.useClearcoat){const e=this.clearcoatNode?_(this.clearcoatNode):y7,s=this.clearcoatRoughnessNode?_(this.clearcoatRoughnessNode):x7;Xc.assign(e),ja.assign(X2({roughness:s}))}if(this.useSheen){const e=this.sheenNode?D(this.sheenNode):v7,s=this.sheenRoughnessNode?_(this.sheenRoughnessNode):_7;no.assign(e),Cl.assign(s)}if(this.useIridescence){const e=this.iridescenceNode?_(this.iridescenceNode):T7,s=this.iridescenceIORNode?_(this.iridescenceIORNode):M7,i=this.iridescenceThicknessNode?_(this.iridescenceThicknessNode):A7;Fl.assign(e),g2.assign(s),f2.assign(i)}if(this.useAnisotropy){const e=(this.anisotropyNode?G(this.anisotropyNode):S7).toVar();dn.assign(e.length()),pt(dn.equal(0),()=>{e.assign(G(1,0))}).Else(()=>{e.divAssign(G(dn)),dn.assign(dn.saturate())}),Zc.assign(dn.pow2().mix(pi.pow2(),1)),Ra.assign(oo[0].mul(e.x).add(oo[1].mul(e.y))),lo.assign(oo[1].mul(e.x).sub(oo[0].mul(e.y)))}if(this.useTransmission){const e=this.transmissionNode?_(this.transmissionNode):N7,s=this.thicknessNode?_(this.thicknessNode):C7,i=this.attenuationDistanceNode?_(this.attenuationDistanceNode):R7,n=this.attenuationColorNode?D(this.attenuationColorNode):E7;if(Kc.assign(e),m2.assign(s),y2.assign(i),x2.assign(n),this.useDispersion){const r=this.dispersionNode?_(this.dispersionNode):L7;w2.assign(r)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?D(this.clearcoatNormalNode):w7}setup(t){t.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(t),super.setup(t)}copy(t){return this.clearcoatNode=t.clearcoatNode,this.clearcoatRoughnessNode=t.clearcoatRoughnessNode,this.clearcoatNormalNode=t.clearcoatNormalNode,this.sheenNode=t.sheenNode,this.sheenRoughnessNode=t.sheenRoughnessNode,this.iridescenceNode=t.iridescenceNode,this.iridescenceIORNode=t.iridescenceIORNode,this.iridescenceThicknessNode=t.iridescenceThicknessNode,this.specularIntensityNode=t.specularIntensityNode,this.specularColorNode=t.specularColorNode,this.transmissionNode=t.transmissionNode,this.thicknessNode=t.thicknessNode,this.attenuationDistanceNode=t.attenuationDistanceNode,this.attenuationColorNode=t.attenuationColorNode,this.dispersionNode=t.dispersionNode,this.anisotropyNode=t.anisotropyNode,super.copy(t)}}const Iw=P(({normal:o,lightDirection:t,builder:e})=>{const s=o.dot(t),i=G(s.mul(.5).add(.5),0);if(e.material.gradientMap){const n=zi("gradientMap","texture").context({getUV:()=>i});return D(n.r)}else{const n=i.fwidth().mul(.5);return Mt(D(.7),D(1),Ji(_(.7).sub(n.x),_(.7).add(n.x),i.x))}});class Lw extends Gl{direct({lightDirection:t,lightColor:e,reflectedLight:s},i,n){const r=Iw({normal:Il,lightDirection:t,builder:n}).mul(e);s.directDiffuse.addAssign(r.mul(bo({diffuseColor:Tt.rgb})))}indirect({ambientOcclusion:t,irradiance:e,reflectedLight:s}){s.indirectDiffuse.addAssign(e.mul(bo({diffuseColor:Tt}))),s.indirectDiffuse.mulAssign(t)}}const Uw=new mm;class zw extends ue{static get type(){return"MeshToonNodeMaterial"}constructor(t){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Uw),this.setValues(t)}setupLightingModel(){return new Lw}}class kw extends pe{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const t=D(qt.z,0,qt.x.negate()).normalize(),e=qt.cross(t);return G(t.dot(ce),e.dot(ce)).mul(.495).add(.5)}}const m9=H(kw),Vw=new wm;class Gw extends ue{static get type(){return"MeshMatcapNodeMaterial"}constructor(t){super(),this.lights=!1,this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(Vw),this.setValues(t)}setupVariants(t){const e=m9;let s;t.material.matcap?s=zi("matcap","texture").context({getUV:()=>e}):s=D(Mt(.2,.8,e.y)),Tt.rgb.mulAssign(s.rgb)}}const Ow=new xo;class w0 extends ue{static get type(){return"PointsNodeMaterial"}constructor(t){super(),this.isPointsNodeMaterial=!0,this.lights=!1,this.transparent=!0,this.sizeNode=null,this.setDefaultValues(Ow),this.setValues(t)}copy(t){return this.sizeNode=t.sizeNode,super.copy(t)}}class Ww extends pe{static get type(){return"RotateNode"}constructor(t,e){super(),this.positionNode=t,this.rotationNode=e}getNodeType(t){return this.positionNode.getNodeType(t)}setup(t){const{rotationNode:e,positionNode:s}=this;if(this.getNodeType(t)==="vec2"){const n=e.cos(),r=e.sin();return Nl(n,r,r.negate(),n).mul(s)}else{const n=e,r=co(J(1,0,0,0),J(0,Ii(n.x),Ss(n.x).negate(),0),J(0,Ss(n.x),Ii(n.x),0),J(0,0,0,1)),a=co(J(Ii(n.y),0,Ss(n.y),0),J(0,1,0,0),J(Ss(n.y).negate(),0,Ii(n.y),0),J(0,0,0,1)),c=co(J(Ii(n.z),Ss(n.z).negate(),0,0),J(Ss(n.z),Ii(n.z),0,0),J(0,0,1,0),J(0,0,0,1));return r.mul(a).mul(c).mul(J(s,1)).xyz}}}const K2=L(Ww),$w=new If;class Hw extends ue{static get type(){return"SpriteNodeMaterial"}constructor(t){super(),this.isSpriteNodeMaterial=!0,this.lights=!1,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.setDefaultValues($w),this.setValues(t)}setupPosition({object:t,camera:e,context:s}){const i=this.sizeAttenuation,{positionNode:n,rotationNode:r,scaleNode:a}=this,c=re;let l=Co.mul(D(n||0)),u=G(Is[0].xyz.length(),Is[1].xyz.length());if(a!==null&&(u=u.mul(a)),!i)if(e.isPerspectiveCamera)u=u.mul(l.z.negate());else{const f=_(2).div(Dn.element(1).element(1));u=u.mul(f.mul(2))}let p=c.xy;if(t.center&&t.center.isVector2===!0){const f=hy("center","vec2");p=p.sub(f.sub(.5))}p=p.mul(u);const h=_(r||b7),d=K2(p,h);l=J(l.xy.add(d),l.zw);const g=Dn.mul(l);return s.vertex=c,g}copy(t){return this.positionNode=t.positionNode,this.rotationNode=t.rotationNode,this.scaleNode=t.scaleNode,super.copy(t)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(t){this._useSizeAttenuation!==t&&(this._useSizeAttenuation=t,this.needsUpdate=!0)}}class qw extends Gl{constructor(){super(),this.shadowNode=_(1).toVar("shadowMask")}direct({shadowMask:t}){this.shadowNode.mulAssign(t)}finish(t){Tt.a.mulAssign(this.shadowNode.oneMinus()),t.outgoingLight.rgb.assign(Tt.rgb)}}const Yw=new gm;class Xw extends ue{static get type(){return"ShadowNodeMaterial"}constructor(t){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Yw),this.setValues(t)}setupLightingModel(){return new qw}}const Zw=P(({texture:o,uv:t})=>{const s=D().toVar();return pt(t.x.lessThan(1e-4),()=>{s.assign(D(1,0,0))}).ElseIf(t.y.lessThan(1e-4),()=>{s.assign(D(0,1,0))}).ElseIf(t.z.lessThan(1e-4),()=>{s.assign(D(0,0,1))}).ElseIf(t.x.greaterThan(1-1e-4),()=>{s.assign(D(-1,0,0))}).ElseIf(t.y.greaterThan(1-1e-4),()=>{s.assign(D(0,-1,0))}).ElseIf(t.z.greaterThan(1-1e-4),()=>{s.assign(D(0,0,-1))}).Else(()=>{const n=o.uv(t.add(D(-.01,0,0))).r.sub(o.uv(t.add(D(.01,0,0))).r),r=o.uv(t.add(D(0,-.01,0))).r.sub(o.uv(t.add(D(0,.01,0))).r),a=o.uv(t.add(D(0,0,-.01))).r.sub(o.uv(t.add(D(0,0,.01))).r);s.assign(D(n,r,a))}),s.normalize()});class jw extends vi{static get type(){return"Texture3DNode"}constructor(t,e=null,s=null){super(t,e,s),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return D(.5,.5,.5)}setUpdateMatrix(){}setupUV(t,e){return e}generateUV(t,e){return e.build(t,"vec3")}normal(t){return Zw({texture:this,uv:t})}}const Kw=L(jw);class Jw{constructor(t,e){this.nodes=t,this.info=e,this._context=self,this._animationLoop=null,this._requestId=null}start(){const t=(e,s)=>{this._requestId=this._context.requestAnimationFrame(t),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(e,s)};t()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}setAnimationLoop(t){this._animationLoop=t}setContext(t){this._context=t}dispose(){this.stop()}}class Ti{constructor(){this.weakMap=new WeakMap}get(t){let e=this.weakMap;for(let s=0;s<t.length;s++)if(e=e.get(t[s]),e===void 0)return;return e.get(t[t.length-1])}set(t,e){let s=this.weakMap;for(let i=0;i<t.length;i++){const n=t[i];s.has(n)===!1&&s.set(n,new WeakMap),s=s.get(n)}return s.set(t[t.length-1],e)}delete(t){let e=this.weakMap;for(let s=0;s<t.length;s++)if(e=e.get(t[s]),e===void 0)return!1;return e.delete(t[t.length-1])}}let Qw=0;function tb(o){const t=Object.keys(o);let e=Object.getPrototypeOf(o);for(;e;){const s=Object.getOwnPropertyDescriptors(e);for(const i in s)if(s[i]!==void 0){const n=s[i];n&&typeof n.get=="function"&&t.push(i)}e=Object.getPrototypeOf(e)}return t}class eb{constructor(t,e,s,i,n,r,a,c,l,u){this._nodes=t,this._geometries=e,this.id=Qw++,this.renderer=s,this.object=i,this.material=n,this.scene=r,this.camera=a,this.lightsNode=c,this.context=l,this.geometry=i.geometry,this.version=n.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=u,this.clippingContextCacheKey=u!==null?u.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(t){this.clippingContext=t}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().monitor)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(t){this.geometry=t,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const t=this.getNodeBuilderState().nodeAttributes,e=this.geometry,s=[],i=new Set;for(const n of t){const r=n.node&&n.node.attribute?n.node.attribute:e.getAttribute(n.name);if(r===void 0)continue;s.push(r);const a=r.isInterleavedBufferAttribute?r.data:r;i.add(a)}return this.attributes=s,this.vertexBuffers=Array.from(i.values()),s}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:t,material:e,geometry:s,group:i,drawRange:n}=this,r=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),a=this.getIndex(),c=a!==null,l=s.isInstancedBufferGeometry?s.instanceCount:t.count>1?t.count:1;if(l===0)return null;if(r.instanceCount=l,t.isBatchedMesh===!0)return r;let u=1;e.wireframe===!0&&!t.isPoints&&!t.isLineSegments&&!t.isLine&&!t.isLineLoop&&(u=2);let p=n.start*u,h=(n.start+n.count)*u;i!==null&&(p=Math.max(p,i.start*u),h=Math.min(h,(i.start+i.count)*u));const d=s.attributes.position;let g=1/0;c?g=a.count:d!=null&&(g=d.count),p=Math.max(p,0),h=Math.min(h,g);const f=h-p;return f<0||f===1/0?null:(r.vertexCount=f,r.firstVertex=p,r)}getGeometryCacheKey(){const{geometry:t}=this;let e="";for(const s of Object.keys(t.attributes).sort()){const i=t.attributes[s];e+=s+",",i.data&&(e+=i.data.stride+","),i.offset&&(e+=i.offset+","),i.itemSize&&(e+=i.itemSize+","),i.normalized&&(e+="n,")}return t.index&&(e+="index,"),e}getMaterialCacheKey(){const{object:t,material:e}=this;let s=e.customProgramCacheKey();for(const i of tb(e)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const n=e[i];let r;if(n!==null){const a=typeof n;a==="number"?r=n!==0?"1":"0":a==="object"?(r="{",n.isTexture&&(r+=n.mapping),r+="}"):r=String(n)}else r=String(n);s+=r+","}return s+=this.clippingContextCacheKey+",",t.geometry&&(s+=this.getGeometryCacheKey()),t.skeleton&&(s+=t.skeleton.bones.length+","),t.morphTargetInfluences&&(s+=t.morphTargetInfluences.length+","),t.isBatchedMesh&&(s+=t._matricesTexture.uuid+",",t._colorsTexture!==null&&(s+=t._colorsTexture.uuid+",")),t.count>1&&(s+=t.uuid+","),s+=t.receiveShadow+",",Z4(s)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let t=this._nodes.getCacheKey(this.scene,this.lightsNode);return this.object.receiveShadow&&(t+=1),t}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Yo=[];class sb{constructor(t,e,s,i,n,r){this.renderer=t,this.nodes=e,this.geometries=s,this.pipelines=i,this.bindings=n,this.info=r,this.chainMaps={}}get(t,e,s,i,n,r,a,c){const l=this.getChainMap(c);Yo[0]=t,Yo[1]=e,Yo[2]=r,Yo[3]=n;let u=l.get(Yo);return u===void 0?(u=this.createRenderObject(this.nodes,this.geometries,this.renderer,t,e,s,i,n,r,a,c),l.set(Yo,u)):(u.updateClipping(a),u.needsGeometryUpdate&&u.setGeometry(t.geometry),(u.version!==e.version||u.needsUpdate)&&(u.initialCacheKey!==u.getCacheKey()?(u.dispose(),u=this.get(t,e,s,i,n,r,a,c)):u.version=e.version)),u}getChainMap(t="default"){return this.chainMaps[t]||(this.chainMaps[t]=new Ti)}dispose(){this.chainMaps={}}createRenderObject(t,e,s,i,n,r,a,c,l,u,p){const h=this.getChainMap(p),d=new eb(t,e,s,i,n,r,a,c,l,u);return d.onDispose=()=>{this.pipelines.delete(d),this.bindings.delete(d),this.nodes.delete(d),h.delete(d.getChainArray())},d}}class Vn{constructor(){this.data=new WeakMap}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}delete(t){let e;return this.data.has(t)&&(e=this.data.get(t),this.data.delete(t)),e}has(t){return this.data.has(t)}dispose(){this.data=new WeakMap}}const hi={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},wn=16,ib=211,nb=212;class ob extends Vn{constructor(t){super(),this.backend=t}delete(t){const e=super.delete(t);return e!==void 0&&this.backend.destroyAttribute(t),e}update(t,e){const s=this.get(t);if(s.version===void 0)e===hi.VERTEX?this.backend.createAttribute(t):e===hi.INDEX?this.backend.createIndexAttribute(t):e===hi.STORAGE?this.backend.createStorageAttribute(t):e===hi.INDIRECT&&this.backend.createIndirectStorageAttribute(t),s.version=this._getBufferAttribute(t).version;else{const i=this._getBufferAttribute(t);(s.version<i.version||i.usage===vn)&&(this.backend.updateAttribute(t),s.version=i.version)}}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}function rb(o){for(let t=o.length-1;t>=0;--t)if(o[t]>=65535)return!0;return!1}function y9(o){return o.index!==null?o.index.version:o.attributes.position.version}function L3(o){const t=[],e=o.index,s=o.attributes.position;if(e!==null){const n=e.array;for(let r=0,a=n.length;r<a;r+=3){const c=n[r+0],l=n[r+1],u=n[r+2];t.push(c,l,l,u,u,c)}}else{const n=s.array;for(let r=0,a=n.length/3-1;r<a;r+=3){const c=r+0,l=r+1,u=r+2;t.push(c,l,l,u,u,c)}}const i=new(rb(t)?A4:M4)(t,1);return i.version=y9(o),i}class ab extends Vn{constructor(t,e){super(),this.attributes=t,this.info=e,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(t){const e=t.geometry;return super.has(e)&&this.get(e).initialized===!0}updateForRender(t){this.has(t)===!1&&this.initGeometry(t),this.updateAttributes(t)}initGeometry(t){const e=t.geometry,s=this.get(e);s.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const n=e.index,r=t.getAttributes();n!==null&&this.attributes.delete(n);for(const c of r)this.attributes.delete(c);const a=this.wireframes.get(e);a!==void 0&&this.attributes.delete(a),e.removeEventListener("dispose",i)};e.addEventListener("dispose",i)}updateAttributes(t){const e=t.getAttributes();for(const n of e)n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute?this.updateAttribute(n,hi.STORAGE):this.updateAttribute(n,hi.VERTEX);const s=this.getIndex(t);s!==null&&this.updateAttribute(s,hi.INDEX);const i=t.geometry.indirect;i!==null&&this.updateAttribute(i,hi.INDIRECT)}updateAttribute(t,e){const s=this.info.render.calls;t.isInterleavedBufferAttribute?this.attributeCall.get(t)===void 0?(this.attributes.update(t,e),this.attributeCall.set(t,s)):this.attributeCall.get(t.data)!==s&&(this.attributes.update(t,e),this.attributeCall.set(t.data,s),this.attributeCall.set(t,s)):this.attributeCall.get(t)!==s&&(this.attributes.update(t,e),this.attributeCall.set(t,s))}getIndirect(t){return t.geometry.indirect}getIndex(t){const{geometry:e,material:s}=t;let i=e.index;if(s.wireframe===!0){const n=this.wireframes;let r=n.get(e);r===void 0?(r=L3(e),n.set(e,r)):r.version!==y9(e)&&(this.attributes.delete(r),r=L3(e),n.set(e,r)),i=r}return i}}class cb{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.compute={calls:0,frameCalls:0,timestamp:0,previousFrameCalls:0,timestampCalls:0},this.memory={geometries:0,textures:0}}update(t,e,s){this.render.drawCalls++,t.isMesh||t.isSprite?this.render.triangles+=s*(e/3):t.isPoints?this.render.points+=s*e:t.isLineSegments?this.render.lines+=s*(e/2):t.isLine?this.render.lines+=s*(e-1):console.error("THREE.WebGPUInfo: Unknown object type.")}updateTimestamp(t,e){this[t].timestampCalls===0&&(this[t].timestamp=0),this[t].timestamp+=e,this[t].timestampCalls++,this[t].timestampCalls>=this[t].previousFrameCalls&&(this[t].timestampCalls=0)}reset(){const t=this.render.frameCalls;this.render.previousFrameCalls=t;const e=this.compute.frameCalls;this.compute.previousFrameCalls=e,this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class x9{constructor(t){this.cacheKey=t,this.usedTimes=0}}class lb extends x9{constructor(t,e,s){super(t),this.vertexProgram=e,this.fragmentProgram=s}}class ub extends x9{constructor(t,e){super(t),this.computeProgram=e,this.isComputePipeline=!0}}let pb=0;class k1{constructor(t,e,s=null,i=null){this.id=pb++,this.code=t,this.stage=e,this.transforms=s,this.attributes=i,this.usedTimes=0}}class hb extends Vn{constructor(t,e){super(),this.backend=t,this.nodes=e,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(t,e){const{backend:s}=this,i=this.get(t);if(this._needsComputeUpdate(t)){const n=i.pipeline;n&&(n.usedTimes--,n.computeProgram.usedTimes--);const r=this.nodes.getForCompute(t);let a=this.programs.compute.get(r.computeShader);a===void 0&&(n&&n.computeProgram.usedTimes===0&&this._releaseProgram(n.computeProgram),a=new k1(r.computeShader,"compute",r.transforms,r.nodeAttributes),this.programs.compute.set(r.computeShader,a),s.createProgram(a));const c=this._getComputeCacheKey(t,a);let l=this.caches.get(c);l===void 0&&(n&&n.usedTimes===0&&this._releasePipeline(n),l=this._getComputePipeline(t,a,c,e)),l.usedTimes++,a.usedTimes++,i.version=t.version,i.pipeline=l}return i.pipeline}getForRender(t,e=null){const{backend:s}=this,i=this.get(t);if(this._needsRenderUpdate(t)){const n=i.pipeline;n&&(n.usedTimes--,n.vertexProgram.usedTimes--,n.fragmentProgram.usedTimes--);const r=t.getNodeBuilderState();let a=this.programs.vertex.get(r.vertexShader);a===void 0&&(n&&n.vertexProgram.usedTimes===0&&this._releaseProgram(n.vertexProgram),a=new k1(r.vertexShader,"vertex"),this.programs.vertex.set(r.vertexShader,a),s.createProgram(a));let c=this.programs.fragment.get(r.fragmentShader);c===void 0&&(n&&n.fragmentProgram.usedTimes===0&&this._releaseProgram(n.fragmentProgram),c=new k1(r.fragmentShader,"fragment"),this.programs.fragment.set(r.fragmentShader,c),s.createProgram(c));const l=this._getRenderCacheKey(t,a,c);let u=this.caches.get(l);u===void 0?(n&&n.usedTimes===0&&this._releasePipeline(n),u=this._getRenderPipeline(t,a,c,l,e)):t.pipeline=u,u.usedTimes++,a.usedTimes++,c.usedTimes++,i.pipeline=u}return i.pipeline}delete(t){const e=this.get(t).pipeline;return e&&(e.usedTimes--,e.usedTimes===0&&this._releasePipeline(e),e.isComputePipeline?(e.computeProgram.usedTimes--,e.computeProgram.usedTimes===0&&this._releaseProgram(e.computeProgram)):(e.fragmentProgram.usedTimes--,e.vertexProgram.usedTimes--,e.vertexProgram.usedTimes===0&&this._releaseProgram(e.vertexProgram),e.fragmentProgram.usedTimes===0&&this._releaseProgram(e.fragmentProgram))),super.delete(t)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(t){this.getForRender(t)}_getComputePipeline(t,e,s,i){s=s||this._getComputeCacheKey(t,e);let n=this.caches.get(s);return n===void 0&&(n=new ub(s,e),this.caches.set(s,n),this.backend.createComputePipeline(n,i)),n}_getRenderPipeline(t,e,s,i,n){i=i||this._getRenderCacheKey(t,e,s);let r=this.caches.get(i);return r===void 0&&(r=new lb(i,e,s),this.caches.set(i,r),t.pipeline=r,this.backend.createRenderPipeline(t,n)),r}_getComputeCacheKey(t,e){return t.id+","+e.id}_getRenderCacheKey(t,e,s){return e.id+","+s.id+","+this.backend.getRenderCacheKey(t)}_releasePipeline(t){this.caches.delete(t.cacheKey)}_releaseProgram(t){const e=t.code,s=t.stage;this.programs[s].delete(e)}_needsComputeUpdate(t){const e=this.get(t);return e.pipeline===void 0||e.version!==t.version}_needsRenderUpdate(t){return this.get(t).pipeline===void 0||this.backend.needsRenderUpdate(t)}}class db extends Vn{constructor(t,e,s,i,n,r){super(),this.backend=t,this.textures=s,this.pipelines=n,this.attributes=i,this.nodes=e,this.info=r,this.pipelines.bindings=this}getForRender(t){const e=t.getBindings();for(const s of e){const i=this.get(s);i.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,e,0),i.bindGroup=s)}return e}getForCompute(t){const e=this.nodes.getForCompute(t).bindings;for(const s of e){const i=this.get(s);i.bindGroup===void 0&&(this._init(s),this.backend.createBindings(s,e,0),i.bindGroup=s)}return e}updateForCompute(t){this._updateBindings(this.getForCompute(t))}updateForRender(t){this._updateBindings(this.getForRender(t))}_updateBindings(t){for(const e of t)this._update(e,t)}_init(t){for(const e of t.bindings)if(e.isSampledTexture)this.textures.updateTexture(e.texture);else if(e.isStorageBuffer){const s=e.attribute,i=s.isIndirectStorageBufferAttribute?hi.INDIRECT:hi.STORAGE;this.attributes.update(s,i)}}_update(t,e){const{backend:s}=this;let i=!1,n=!0,r=0,a=0;for(const c of t.bindings)if(!(c.isNodeUniformsGroup&&!this.nodes.updateGroup(c))){if(c.isUniformBuffer)c.update()&&s.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const l=this.textures.get(c.texture);c.needsBindingsUpdate(l.generation)&&(i=!0);const u=c.update(),p=c.texture;u&&this.textures.updateTexture(p);const h=s.get(p);if(h.externalTexture!==void 0||l.isDefaultTexture?n=!1:(r=r*10+p.id,a+=p.version),s.isWebGPUBackend===!0&&h.texture===void 0&&h.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,u,p,c.textureNode.value,i),this.textures.updateTexture(p),i=!0),p.isStorageTexture===!0){const d=this.get(p);c.store===!0?d.needsMipmap=!0:this.textures.needsMipmaps(p)&&d.needsMipmap===!0&&(this.backend.generateMipmaps(p),d.needsMipmap=!1)}}}i===!0&&this.backend.updateBindings(t,e,n?r:0,a)}}function gb(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.material.id!==t.material.id?o.material.id-t.material.id:o.z!==t.z?o.z-t.z:o.id-t.id}function U3(o,t){return o.groupOrder!==t.groupOrder?o.groupOrder-t.groupOrder:o.renderOrder!==t.renderOrder?o.renderOrder-t.renderOrder:o.z!==t.z?t.z-o.z:o.id-t.id}function z3(o){return(o.transmission>0||o.transmissionNode)&&o.side===Kt&&o.forceSinglePass===!1}class fb{constructor(t,e,s){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=t.getNode(e,s),this.lightsArray=[],this.scene=e,this.camera=s,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(t,e,s,i,n,r,a){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:t.id,object:t,geometry:e,material:s,groupOrder:i,renderOrder:t.renderOrder,z:n,group:r,clippingContext:a},this.renderItems[this.renderItemsIndex]=c):(c.id=t.id,c.object=t,c.geometry=e,c.material=s,c.groupOrder=i,c.renderOrder=t.renderOrder,c.z=n,c.group=r,c.clippingContext=a),this.renderItemsIndex++,c}push(t,e,s,i,n,r,a){const c=this.getNextRenderItem(t,e,s,i,n,r,a);t.occlusionTest===!0&&this.occlusionQueryCount++,s.transparent===!0||s.transmission>0?(z3(s)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(t,e,s,i,n,r,a){const c=this.getNextRenderItem(t,e,s,i,n,r,a);s.transparent===!0||s.transmission>0?(z3(s)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(t){this.bundles.push(t)}pushLight(t){this.lightsArray.push(t)}sort(t,e){this.opaque.length>1&&this.opaque.sort(t||gb),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(e||U3),this.transparent.length>1&&this.transparent.sort(e||U3)}finish(){this.lightsNode.setLights(this.lightsArray);for(let t=this.renderItemsIndex,e=this.renderItems.length;t<e;t++){const s=this.renderItems[t];if(s.id===null)break;s.id=null,s.object=null,s.geometry=null,s.material=null,s.groupOrder=null,s.renderOrder=null,s.z=null,s.group=null,s.clippingContext=null}}}class mb{constructor(t){this.lighting=t,this.lists=new Ti}get(t,e){const s=this.lists,i=[t,e];let n=s.get(i);return n===void 0&&(n=new fb(this.lighting,t,e),s.set(i,n)),n}dispose(){this.lists=new Ti}}let yb=0;class xb{constructor(){this.id=yb++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new vt,this.scissor=!1,this.scissorValue=new vt,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.sampleCount=1,this.width=0,this.height=0,this.isRenderContext=!0}getCacheKey(){return w9(this)}}function w9(o){const{textures:t,activeCubeFace:e}=o,s=[e];for(const i of t)s.push(i.id);return o2(s)}class wb{constructor(){this.chainMaps={}}get(t,e,s=null){const i=[t,e];let n;if(s===null)n="default";else{const c=s.texture.format;n=`${s.textures.length}:${c}:${s.samples}:${s.depthBuffer}:${s.stencilBuffer}`}const r=this.getChainMap(n);let a=r.get(i);return a===void 0&&(a=new xb,r.set(i,a)),s!==null&&(a.sampleCount=s.samples===0?1:s.samples),a}getChainMap(t){return this.chainMaps[t]||(this.chainMaps[t]=new Ti)}dispose(){this.chainMaps={}}}const bb=new S;class vb extends Vn{constructor(t,e,s){super(),this.renderer=t,this.backend=e,this.info=s}updateRenderTarget(t,e=0){const s=this.get(t),i=t.samples===0?1:t.samples,n=s.depthTextureMips||(s.depthTextureMips={}),r=t.textures,a=this.getSize(r[0]),c=a.width>>e,l=a.height>>e;let u=t.depthTexture||n[e];const p=t.depthBuffer===!0||t.stencilBuffer===!0;let h=!1;u===void 0&&p&&(u=new To,u.format=t.stencilBuffer?Er:ro,u.type=t.stencilBuffer?n0:Pe,u.image.width=c,u.image.height=l,n[e]=u),(s.width!==a.width||a.height!==s.height)&&(h=!0,u&&(u.needsUpdate=!0,u.image.width=c,u.image.height=l)),s.width=a.width,s.height=a.height,s.textures=r,s.depthTexture=u||null,s.depth=t.depthBuffer,s.stencil=t.stencilBuffer,s.renderTarget=t,s.sampleCount!==i&&(h=!0,u&&(u.needsUpdate=!0),s.sampleCount=i);const d={sampleCount:i};for(let g=0;g<r.length;g++){const f=r[g];h&&(f.needsUpdate=!0),this.updateTexture(f,d)}if(u&&this.updateTexture(u,d),s.initialized!==!0){s.initialized=!0;const g=()=>{t.removeEventListener("dispose",g);for(let f=0;f<r.length;f++)this._destroyTexture(r[f]);u&&this._destroyTexture(u),this.delete(t)};t.addEventListener("dispose",g)}}updateTexture(t,e={}){const s=this.get(t);if(s.initialized===!0&&s.version===t.version)return;const i=t.isRenderTargetTexture||t.isDepthTexture||t.isFramebufferTexture,n=this.backend;if(i&&s.initialized===!0&&(n.destroySampler(t),n.destroyTexture(t)),t.isFramebufferTexture){const l=this.renderer.getRenderTarget();l?t.type=l.texture.type:t.type=Mn}const{width:r,height:a,depth:c}=this.getSize(t);if(e.width=r,e.height=a,e.depth=c,e.needsMipmaps=this.needsMipmaps(t),e.levels=e.needsMipmaps?this.getMipLevels(t,r,a):1,i||t.isStorageTexture===!0)n.createSampler(t),n.createTexture(t,e),s.generation=t.version;else if(s.initialized!==!0&&n.createSampler(t),t.version>0){const u=t.image;if(u===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(u.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(t.images){const p=[];for(const h of t.images)p.push(h);e.images=p}else e.image=u;(s.isDefaultTexture===void 0||s.isDefaultTexture===!0)&&(n.createTexture(t,e),s.isDefaultTexture=!1,s.generation=t.version),t.source.dataReady===!0&&n.updateTexture(t,e),e.needsMipmaps&&t.mipmaps.length===0&&n.generateMipmaps(t)}}else n.createDefaultTexture(t),s.isDefaultTexture=!0,s.generation=t.version;if(s.initialized!==!0){s.initialized=!0,s.generation=t.version,this.info.memory.textures++;const l=()=>{t.removeEventListener("dispose",l),this._destroyTexture(t),this.info.memory.textures--};t.addEventListener("dispose",l)}s.version=t.version}getSize(t,e=bb){let s=t.images?t.images[0]:t.image;return s?(s.image!==void 0&&(s=s.image),e.width=s.width||1,e.height=s.height||1,e.depth=t.isCubeTexture?6:s.depth||1):e.width=e.height=e.depth=1,e}getMipLevels(t,e,s){let i;return t.isCompressedTexture?t.mipmaps?i=t.mipmaps.length:i=1:i=Math.floor(Math.log2(Math.max(e,s)))+1,i}needsMipmaps(t){return this.isEnvironmentTexture(t)||t.isCompressedTexture===!0||t.generateMipmaps}isEnvironmentTexture(t){const e=t.mapping;return e===s0||e===i0||e===mo||e===Fr}_destroyTexture(t){this.backend.destroySampler(t),this.backend.destroyTexture(t),this.delete(t)}}class J2 extends W{constructor(t,e,s,i=1){super(t,e,s),this.a=i}set(t,e,s,i=1){return this.a=i,super.set(t,e,s)}copy(t){return t.a!==void 0&&(this.a=t.a),super.copy(t)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class b9 extends Ft{static get type(){return"ParameterNode"}constructor(t,e=null){super(t,e),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}const _b=(o,t)=>k(new b9(o,t));class Sb extends tt{static get type(){return"StackNode"}constructor(t=null){super(),this.nodes=[],this.outputNode=null,this.parent=t,this._currentCond=null,this.isStackNode=!0}getNodeType(t){return this.outputNode?this.outputNode.getNodeType(t):"void"}add(t){return this.nodes.push(t),this}If(t,e){const s=new Fa(e);return this._currentCond=Ie(t,s),this.add(this._currentCond)}ElseIf(t,e){const s=new Fa(e),i=Ie(t,s);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(t){return this._currentCond.elseNode=new Fa(t),this}build(t,...e){const s=u2();Ya(this);for(const i of this.nodes)i.build(t,"void");return Ya(s),this.outputNode?this.outputNode.build(t,...e):super.build(t,...e)}else(...t){return console.warn("TSL.StackNode: .else() has been renamed to .Else()."),this.Else(...t)}elseif(...t){return console.warn("TSL.StackNode: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...t)}}const Rc=L(Sb);class Tb extends tt{static get type(){return"StructTypeNode"}constructor(t){super(),this.types=t,this.isStructTypeNode=!0}getMemberTypes(){return this.types}}class v9 extends tt{static get type(){return"OutputStructNode"}constructor(...t){super(),this.members=t,this.isOutputStructNode=!0}setup(t){super.setup(t);const e=this.members,s=[];for(let i=0;i<e.length;i++)s.push(e[i].getNodeType(t));this.nodeType=t.getStructTypeFromNode(new Tb(s)).name}generate(t,e){const s=t.getOutputStructName(),i=this.members,n=s!==""?s+".":"";for(let r=0;r<i.length;r++){const a=i[r].build(t,e);t.addLineFlowCode(`${n}m${r} = ${a}`,this)}return s}}const Mb=L(v9);function _9(o,t){for(let e=0;e<o.length;e++)if(o[e].name===t)return e;return-1}class Ab extends v9{static get type(){return"MRTNode"}constructor(t){super(),this.outputNodes=t,this.isMRTNode=!0}has(t){return this.outputNodes[t]!==void 0}get(t){return this.outputNodes[t]}merge(t){const e={...this.outputNodes,...t.outputNodes};return S9(e)}setup(t){const e=this.outputNodes,s=t.renderer.getRenderTarget(),i=[],n=s.textures;for(const r in e){const a=_9(n,r);i[a]=J(e[r])}return this.members=i,super.setup(t)}}const S9=L(Ab),Nb=P(([o])=>{const t=o.toUint().mul(747796405).add(2891336453),e=t.shiftRight(t.shiftRight(28).add(4)).bitXor(t).mul(277803737);return e.shiftRight(22).bitXor(e).toFloat().mul(1/2**32)}),yp=(o,t)=>Ks(ct(4,o.mul(wt(1,o))),t),Cb=(o,t)=>o.lessThan(.5)?yp(o.mul(2),t).div(2):wt(1,yp(ct(wt(1,o),2),t).div(2)),Fb=(o,t,e)=>Ks(si(Ks(o,t),fe(Ks(o,t),Ks(wt(1,o),e))),1/t),Rb=(o,t)=>Ss(Jc.mul(t.mul(o).sub(1))).div(Jc.mul(t.mul(o).sub(1))),ui=P(([o])=>o.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),T9=P(([o])=>D(ui(o.z.add(ui(o.y.mul(1)))),ui(o.z.add(ui(o.x.mul(1)))),ui(o.y.add(ui(o.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Eb=P(([o,t,e])=>{const s=D(o).toVar(),i=_(1.4).toVar(),n=_(0).toVar(),r=D(s).toVar();return Nt({start:_(0),end:_(3),type:"float",condition:"<="},()=>{const a=D(T9(r.mul(2))).toVar();s.addAssign(a.add(e.mul(_(.1).mul(t)))),r.mulAssign(1.8),i.mulAssign(1.5),s.mulAssign(1.2);const c=_(ui(s.z.add(ui(s.x.add(ui(s.y)))))).toVar();n.addAssign(c.div(i)),r.addAssign(.14)}),n}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"p",type:"vec3"},{name:"spd",type:"float"},{name:"time",type:"float"}]});class Db extends tt{static get type(){return"FunctionOverloadingNode"}constructor(t=[],...e){super(),this.functionNodes=t,this.parametersNodes=e,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(t){const e=this.parametersNodes;let s=this._candidateFnCall;if(s===null){let i=null,n=-1;for(const r of this.functionNodes){const c=r.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const l=c.inputs;if(e.length===l.length){let u=0;for(let p=0;p<e.length;p++){const h=e[p],d=l[p];h.getNodeType(t)===d.type?u++:u=0}u>n&&(i=r,n=u)}}this._candidateFnCall=s=i(...e)}return s}}const Bb=L(Db),Le=o=>(...t)=>Bb(o,...t),Fo=Q(0).setGroup(st).onRenderUpdate(o=>o.time),M9=Q(0).setGroup(st).onRenderUpdate(o=>o.deltaTime),Pb=Q(0,"uint").setGroup(st).onRenderUpdate(o=>o.frameId),Ib=(o=1)=>(console.warn('TSL: timerLocal() is deprecated. Use "time" instead.'),Fo.mul(o)),Lb=(o=1)=>(console.warn('TSL: timerGlobal() is deprecated. Use "time" instead.'),Fo.mul(o)),Ub=(o=1)=>(console.warn('TSL: timerDelta() is deprecated. Use "deltaTime" instead.'),M9.mul(o)),zb=(o=Fo)=>o.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),kb=(o=Fo)=>o.fract().round(),Vb=(o=Fo)=>o.add(.5).fract().mul(2).sub(1).abs(),Gb=(o=Fo)=>o.fract(),Ob=P(([o,t,e=G(.5)])=>K2(o.sub(e),t).add(e)),Wb=P(([o,t,e=G(.5)])=>{const s=o.sub(e),i=s.dot(s),r=i.mul(i).mul(t);return o.add(s.mul(r))}),$b=P(({position:o=null,horizontal:t=!0,vertical:e=!1})=>{let s;o!==null?(s=Is.toVar(),s[3][0]=o.x,s[3][1]=o.y,s[3][2]=o.z):s=Is;const i=ms.mul(s);return qa(t)&&(i[0][0]=Is[0].length(),i[0][1]=0,i[0][2]=0),qa(e)&&(i[1][0]=0,i[1][1]=Is[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,Dn.mul(i).mul(re)}),Hb=P(([o=null])=>{const t=el();return el(O2(o)).sub(t).lessThan(0).select(Si,o)});class qb extends tt{static get type(){return"SpriteSheetUVNode"}constructor(t,e=ee(),s=_(0)){super("vec2"),this.countNode=t,this.uvNode=e,this.frameNode=s}setup(){const{frameNode:t,uvNode:e,countNode:s}=this,{width:i,height:n}=s,r=t.mod(i.mul(n)).floor(),a=r.mod(i),c=n.sub(r.add(1).div(i).ceil()),l=s.reciprocal(),u=G(a,c);return e.add(u).mul(l)}}const Yb=L(qb);class Xb extends tt{static get type(){return"TriplanarTexturesNode"}constructor(t,e=null,s=null,i=_(1),n=re,r=hs){super("vec4"),this.textureXNode=t,this.textureYNode=e,this.textureZNode=s,this.scaleNode=i,this.positionNode=n,this.normalNode=r}setup(){const{textureXNode:t,textureYNode:e,textureZNode:s,scaleNode:i,positionNode:n,normalNode:r}=this;let a=r.abs().normalize();a=a.div(a.dot(D(1)));const c=n.yz.mul(i),l=n.zx.mul(i),u=n.xy.mul(i),p=t.value,h=e!==null?e.value:p,d=s!==null?s.value:p,g=yt(p,c).mul(a.x),f=yt(h,l).mul(a.y),m=yt(d,u).mul(a.z);return fe(g,f,m)}}const A9=L(Xb),Zb=(...o)=>A9(...o),Xo=new hn,Yn=new S,Zo=new S,V1=new S,oa=new gt,Q0=new S(0,0,-1),ri=new vt,ra=new S,tc=new S,aa=new vt,ec=new Y,il=new In,jb=Si.flipX();il.depthTexture=new To(1,1);let G1=!1;class Q2 extends vi{static get type(){return"ReflectorNode"}constructor(t={}){super(t.defaultTexture||il.texture,jb),this._reflectorBaseNode=t.reflector||new Kb(this,t),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=k(new Q2({defaultTexture:il.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(t){return t.object.isQuadMesh||this._reflectorBaseNode.build(t),super.setup(t)}clone(){const t=new this.constructor(this.reflectorNode);return t._reflectorBaseNode=this._reflectorBaseNode,t}}class Kb extends tt{static get type(){return"ReflectorBaseNode"}constructor(t,e={}){super();const{target:s=new Xt,resolution:i=1,generateMipmaps:n=!1,bounces:r=!0,depth:a=!1}=e;this.textureNode=t,this.target=s,this.resolution=i,this.generateMipmaps=n,this.bounces=r,this.depth=a,this.updateBeforeType=r?rt.RENDER:rt.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap}_updateResolution(t,e){const s=this.resolution;e.getDrawingBufferSize(ec),t.setSize(Math.round(ec.width*s),Math.round(ec.height*s))}setup(t){return this._updateResolution(il,t.renderer),super.setup(t)}getVirtualCamera(t){let e=this.virtualCameras.get(t);return e===void 0&&(e=t.clone(),this.virtualCameras.set(t,e)),e}getRenderTarget(t){let e=this.renderTargets.get(t);return e===void 0&&(e=new In(0,0,{type:Qs}),this.generateMipmaps===!0&&(e.texture.minFilter=Tg,e.texture.generateMipmaps=!0),this.depth===!0&&(e.depthTexture=new To),this.renderTargets.set(t,e)),e}updateBefore(t){if(this.bounces===!1&&G1)return;G1=!0;const{scene:e,camera:s,renderer:i,material:n}=t,{target:r}=this,a=this.getVirtualCamera(s),c=this.getRenderTarget(a);if(i.getDrawingBufferSize(ec),this._updateResolution(c,i),Zo.setFromMatrixPosition(r.matrixWorld),V1.setFromMatrixPosition(s.matrixWorld),oa.extractRotation(r.matrixWorld),Yn.set(0,0,1),Yn.applyMatrix4(oa),ra.subVectors(Zo,V1),ra.dot(Yn)>0)return;ra.reflect(Yn).negate(),ra.add(Zo),oa.extractRotation(s.matrixWorld),Q0.set(0,0,-1),Q0.applyMatrix4(oa),Q0.add(V1),tc.subVectors(Zo,Q0),tc.reflect(Yn).negate(),tc.add(Zo),a.coordinateSystem=s.coordinateSystem,a.position.copy(ra),a.up.set(0,1,0),a.up.applyMatrix4(oa),a.up.reflect(Yn),a.lookAt(tc),a.near=s.near,a.far=s.far,a.updateMatrixWorld(),a.projectionMatrix.copy(s.projectionMatrix),Xo.setFromNormalAndCoplanarPoint(Yn,Zo),Xo.applyMatrix4(a.matrixWorldInverse),ri.set(Xo.normal.x,Xo.normal.y,Xo.normal.z,Xo.constant);const l=a.projectionMatrix;aa.x=(Math.sign(ri.x)+l.elements[8])/l.elements[0],aa.y=(Math.sign(ri.y)+l.elements[9])/l.elements[5],aa.z=-1,aa.w=(1+l.elements[10])/l.elements[14],ri.multiplyScalar(1/ri.dot(aa));const u=0;l.elements[2]=ri.x,l.elements[6]=ri.y,l.elements[10]=i.coordinateSystem===Xi?ri.z-u:ri.z+1-u,l.elements[14]=ri.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),n.visible=!1;const p=i.getRenderTarget(),h=i.getMRT();i.setMRT(null),i.setRenderTarget(c),i.render(e,a),i.setMRT(h),i.setRenderTarget(p),n.visible=!0,G1=!1}}const Jb=o=>k(new Q2(o)),O1=new n2(-1,1,1,-1,0,1);class Qb extends zt{constructor(t=!1){super();const e=t===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new mt([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new mt(e,2))}}const tv=new Qb;class th extends V{constructor(t=null){super(tv,t),this.camera=O1,this.isQuadMesh=!0}renderAsync(t){return t.renderAsync(this,O1)}render(t){t.render(this,O1)}}const ev=new Y;class sv extends vi{static get type(){return"RTTNode"}constructor(t,e=null,s=null,i={type:Qs}){const n=new In(e,s,i);super(n.texture,ee()),this.node=t,this.width=e,this.height=s,this.renderTarget=n,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this.updateMap=new WeakMap,this._rttNode=null,this._quadMesh=new th(new ue),this.updateBeforeType=rt.RENDER}get autoSize(){return this.width===null}setup(t){return this._rttNode=this.node.context(t.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(t)}setSize(t,e){this.width=t,this.height=e;const s=t*this.pixelRatio,i=e*this.pixelRatio;this.renderTarget.setSize(s,i),this.textureNeedsUpdate=!0}setPixelRatio(t){this.pixelRatio=t,this.setSize(this.width,this.height)}updateBefore({renderer:t}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoSize===!0){this.pixelRatio=t.getPixelRatio();const s=t.getSize(ev);this.setSize(s.width,s.height)}this._quadMesh.material.fragmentNode=this._rttNode;const e=t.getRenderTarget();t.setRenderTarget(this.renderTarget),this._quadMesh.render(t),t.setRenderTarget(e)}clone(){const t=new vi(this.value,this.uvNode,this.levelNode);return t.sampler=this.sampler,t.referenceNode=this,t}}const N9=(o,...t)=>k(new sv(k(o),...t)),iv=(o,...t)=>o.isTextureNode?o:o.isPassNode?o.getTextureNode():N9(o,...t),cr=P(([o,t,e],s)=>{let i;s.renderer.coordinateSystem===Xi?(o=G(o.x,o.y.oneMinus()).mul(2).sub(1),i=J(D(o,t),1)):i=J(D(o.x,o.y.oneMinus(),t).mul(2).sub(1),1);const n=J(e.mul(i));return n.xyz.div(n.w)}),nv=P(([o,t])=>{const e=t.mul(J(o,1)),s=e.xy.div(e.w).mul(.5).add(.5).toVar();return G(s.x,s.y.oneMinus())}),ov=P(([o,t,e])=>{const s=uo(ae(t)),i=Me(o.mul(s)).toVar(),n=ae(t,i).toVar(),r=ae(t,i.sub(Me(2,0))).toVar(),a=ae(t,i.sub(Me(1,0))).toVar(),c=ae(t,i.add(Me(1,0))).toVar(),l=ae(t,i.add(Me(2,0))).toVar(),u=ae(t,i.add(Me(0,2))).toVar(),p=ae(t,i.add(Me(0,1))).toVar(),h=ae(t,i.sub(Me(0,1))).toVar(),d=ae(t,i.sub(Me(0,2))).toVar(),g=Ot(wt(_(2).mul(a).sub(r),n)).toVar(),f=Ot(wt(_(2).mul(c).sub(l),n)).toVar(),m=Ot(wt(_(2).mul(p).sub(u),n)).toVar(),x=Ot(wt(_(2).mul(h).sub(d),n)).toVar(),w=cr(o,n,e).toVar(),b=g.lessThan(f).select(w.sub(cr(o.sub(G(_(1).div(s.x),0)),a,e)),w.negate().add(cr(o.add(G(_(1).div(s.x),0)),c,e))),v=m.lessThan(x).select(w.sub(cr(o.add(G(0,_(1).div(s.y))),p,e)),w.negate().add(cr(o.sub(G(0,_(1).div(s.y))),h,e)));return Ki(Bl(b,v))});class rv extends Ga{constructor(t,e,s=Float32Array){ArrayBuffer.isView(t)===!1&&(t=new s(t*e)),super(t,e),this.isStorageInstancedBufferAttribute=!0}}class av extends it{constructor(t,e,s=Float32Array){ArrayBuffer.isView(t)===!1&&(t=new s(t*e)),super(t,e),this.isStorageBufferAttribute=!0}}class cv extends No{static get type(){return"StorageArrayElementNode"}constructor(t,e){super(t,e),this.isStorageArrayElementNode=!0}set storageBufferNode(t){this.node=t}get storageBufferNode(){return this.node}setup(t){return t.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&t.setupPBO(this.node),super.setup(t)}generate(t,e){let s;const i=t.context.assign;if(t.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||t.shaderStage!=="compute")?s=t.generatePBO(this):s=this.node.build(t):s=super.generate(t),i!==!0){const n=this.getNodeType(t);s=t.format(s,n,e)}return s}}const lv=L(cv);class uv extends I2{static get type(){return"StorageBufferNode"}constructor(t,e=null,s=0){e===null&&(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute)&&(e=J4(t.itemSize),s=t.count),super(t,e,s),this.isStorageBufferNode=!0,this.access=Oe.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this.bufferCount=s,this._attribute=null,this._varying=null,this.global=!0,t.isStorageBufferAttribute!==!0&&t.isStorageInstancedBufferAttribute!==!0&&(t.isInstancedBufferAttribute?t.isStorageInstancedBufferAttribute=!0:t.isStorageBufferAttribute=!0)}getHash(t){if(this.bufferCount===0){let e=t.globalCache.getData(this.value);return e===void 0&&(e={node:this},t.globalCache.setData(this.value,e)),e.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(t){return lv(this,t)}setPBO(t){return this.isPBO=t,this}getPBO(){return this.isPBO}setAccess(t){return this.access=t,this}toReadOnly(){return this.setAccess(Oe.READ_ONLY)}setAtomic(t){return this.isAtomic=t,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=p0(this.value),this._varying=fs(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(t){if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.getNodeType(t);const{attribute:e}=this.getAttributeData();return e.getNodeType(t)}generate(t){if(t.isAvailable("storageBuffer")||t.isAvailable("indirectStorageBuffer"))return super.generate(t);const{attribute:e,varying:s}=this.getAttributeData(),i=s.build(t);return t.registerTransform(i,e),i}}const $l=(o,t,e)=>k(new uv(o,t,e)),pv=(o,t,e)=>(console.warn('THREE.TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),$l(o,t,e).setPBO(!0)),hv=(o,t="float")=>{const e=Q4(t),s=new av(o,e);return $l(s,t,o)},dv=(o,t="float")=>{const e=Q4(t),s=new rv(o,e);return $l(s,t,o)};class gv extends O6{static get type(){return"VertexColorNode"}constructor(t=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=t}getAttributeName(){const t=this.index;return"color"+(t>0?t:"")}generate(t){const e=this.getAttributeName(t),s=t.hasGeometryAttribute(e);let i;return s===!0?i=super.generate(t):i=t.generateConst(this.nodeType,new vt(1,1,1,1)),i}serialize(t){super.serialize(t),t.index=this.index}deserialize(t){super.deserialize(t),this.index=t.index}}const fv=(...o)=>k(new gv(...o));class mv extends tt{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const yv=H(mv),ca=new As,W1=new gt;class rs extends tt{static get type(){return"SceneNode"}constructor(t=rs.BACKGROUND_BLURRINESS,e=null){super(),this.scope=t,this.scene=e}setup(t){const e=this.scope,s=this.scene!==null?this.scene:t.scene;let i;return e===rs.BACKGROUND_BLURRINESS?i=Et("backgroundBlurriness","float",s):e===rs.BACKGROUND_INTENSITY?i=Et("backgroundIntensity","float",s):e===rs.BACKGROUND_ROTATION?i=Q("mat4").label("backgroundRotation").setGroup(st).onRenderUpdate(()=>{const n=s.background;return n!==null&&n.isTexture&&n.mapping!==Lp?(ca.copy(s.backgroundRotation),ca.x*=-1,ca.y*=-1,ca.z*=-1,W1.makeRotationFromEuler(ca)):W1.identity(),W1}):console.error("THREE.SceneNode: Unknown scope:",e),i}}rs.BACKGROUND_BLURRINESS="backgroundBlurriness";rs.BACKGROUND_INTENSITY="backgroundIntensity";rs.BACKGROUND_ROTATION="backgroundRotation";const C9=H(rs,rs.BACKGROUND_BLURRINESS),xp=H(rs,rs.BACKGROUND_INTENSITY),F9=H(rs,rs.BACKGROUND_ROTATION);class xv extends vi{static get type(){return"StorageTextureNode"}constructor(t,e,s=null){super(t,e),this.storeNode=s,this.isStorageTextureNode=!0,this.access=Oe.WRITE_ONLY}getInputType(){return"storageTexture"}setup(t){super.setup(t);const e=t.getNodeProperties(this);e.storeNode=this.storeNode}setAccess(t){return this.access=t,this}generate(t,e){let s;return this.storeNode!==null?s=this.generateStore(t):s=super.generate(t,e),s}toReadWrite(){return this.setAccess(Oe.READ_WRITE)}toReadOnly(){return this.setAccess(Oe.READ_ONLY)}toWriteOnly(){return this.setAccess(Oe.WRITE_ONLY)}generateStore(t){const e=t.getNodeProperties(this),{uvNode:s,storeNode:i}=e,n=super.generate(t,"property"),r=s.build(t,"uvec2"),a=i.build(t,"vec4"),c=t.generateTextureStore(t,n,r,a);t.addLineFlowCode(c,this)}}const R9=L(xv),wv=(o,t,e)=>{const s=R9(o,t,e);return e!==null&&s.append(),s};class bv extends zl{static get type(){return"UserDataNode"}constructor(t,e,s=null){super(t,e,s),this.userData=s}updateReference(t){return this.reference=this.userData!==null?this.userData:t.object.userData,this.reference}}const vv=(o,t,e)=>k(new bv(o,t,e)),k3=new WeakMap;class _v extends pe{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=rt.OBJECT,this.updateAfterType=rt.OBJECT,this.previousModelWorldMatrix=Q(new gt),this.previousProjectionMatrix=Q(new gt).setGroup(st),this.previousCameraViewMatrix=Q(new gt)}setProjectionMatrix(t){this.projectionMatrix=t}update({frameId:t,camera:e,object:s}){const i=V3(s);this.previousModelWorldMatrix.value.copy(i);const n=E9(e);n.frameId!==t&&(n.frameId=t,n.previousProjectionMatrix===void 0?(n.previousProjectionMatrix=new gt,n.previousCameraViewMatrix=new gt,n.currentProjectionMatrix=new gt,n.currentCameraViewMatrix=new gt,n.previousProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.previousCameraViewMatrix.copy(e.matrixWorldInverse)):(n.previousProjectionMatrix.copy(n.currentProjectionMatrix),n.previousCameraViewMatrix.copy(n.currentCameraViewMatrix)),n.currentProjectionMatrix.copy(this.projectionMatrix||e.projectionMatrix),n.currentCameraViewMatrix.copy(e.matrixWorldInverse),this.previousProjectionMatrix.value.copy(n.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(n.previousCameraViewMatrix))}updateAfter({object:t}){V3(t).copy(t.matrixWorld)}setup(){const t=this.projectionMatrix===null?Dn:Q(this.projectionMatrix),e=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),s=t.mul(Co).mul(re),i=this.previousProjectionMatrix.mul(e).mul(tl),n=s.xy.div(s.w),r=i.xy.div(i.w);return wt(n,r)}}function E9(o){let t=k3.get(o);return t===void 0&&(t={},k3.set(o,t)),t}function V3(o,t=0){const e=E9(o);let s=e[t];return s===void 0&&(e[t]=s=new gt),s}const Sv=H(_v),D9=P(([o,t])=>ps(1,o.oneMinus().div(t)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),B9=P(([o,t])=>ps(o.div(t.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),P9=P(([o,t])=>o.oneMinus().mul(t.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),I9=P(([o,t])=>Mt(o.mul(2).mul(t),o.oneMinus().mul(2).mul(t.oneMinus()).oneMinus(),Dl(.5,o))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),Tv=P(([o,t])=>{const e=t.a.add(o.a.mul(t.a.oneMinus()));return J(t.rgb.mul(t.a).add(o.rgb.mul(o.a).mul(t.a.oneMinus())).div(e),e)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),Mv=(...o)=>(console.warn('THREE.TSL: "burn" has been renamed. Use "blendBurn" instead.'),D9(o)),Av=(...o)=>(console.warn('THREE.TSL: "dodge" has been renamed. Use "blendDodge" instead.'),B9(o)),Nv=(...o)=>(console.warn('THREE.TSL: "screen" has been renamed. Use "blendScreen" instead.'),P9(o)),Cv=(...o)=>(console.warn('THREE.TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),I9(o)),Fv=P(([o])=>Hl(o.rgb)),Rv=P(([o,t=_(1)])=>t.mix(Hl(o.rgb),o.rgb)),Ev=P(([o,t=_(1)])=>{const e=fe(o.r,o.g,o.b).div(3),s=o.r.max(o.g.max(o.b)),i=s.sub(e).mul(t).mul(-3);return Mt(o.rgb,s,i)}),Dv=P(([o,t=_(1)])=>{const e=D(.57735,.57735,.57735),s=t.cos();return D(o.rgb.mul(s).add(e.cross(o.rgb).mul(t.sin()).add(e.mul(kn(e,o.rgb).mul(s.oneMinus())))))}),Hl=(o,t=D(he.getLuminanceCoefficients(new S)))=>kn(o,t),Bv=(o,t)=>Mt(D(0),o,Hl(o).sub(t).max(0)),Pv=P(([o,t=D(1),e=D(0),s=D(1),i=_(1),n=D(he.getLuminanceCoefficients(new S,Oi))])=>{const r=o.rgb.dot(D(n)),a=le(o.rgb.mul(t).add(e),0).toVar(),c=a.pow(s).toVar();return pt(a.r.greaterThan(0),()=>{a.r.assign(c.r)}),pt(a.g.greaterThan(0),()=>{a.g.assign(c.g)}),pt(a.b.greaterThan(0),()=>{a.b.assign(c.b)}),a.assign(r.add(a.sub(r).mul(i))),J(a.rgb,o.a)});class Iv extends pe{static get type(){return"PosterizeNode"}constructor(t,e){super(),this.sourceNode=t,this.stepsNode=e}setup(){const{sourceNode:t,stepsNode:e}=this;return t.mul(e).floor().div(e)}}const Lv=L(Iv),Uv=new Y;class L9 extends vi{static get type(){return"PassTextureNode"}constructor(t,e){super(e),this.passNode=t,this.setUpdateMatrix(!1)}setup(t){return t.object.isQuadMesh&&this.passNode.build(t),super.setup(t)}clone(){return new this.constructor(this.passNode,this.value)}}class G3 extends L9{static get type(){return"PassMultipleTextureNode"}constructor(t,e,s=!1){super(t,null),this.textureName=e,this.previousTexture=s}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(t){return this.updateTexture(),super.setup(t)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Mi extends pe{static get type(){return"PassNode"}constructor(t,e,s,i={}){super("vec4"),this.scope=t,this.scene=e,this.camera=s,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const n=new To;n.isRenderTargetTexture=!0,n.name="depth";const r=new In(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Qs,...i});r.texture.name="output",r.depthTexture=n,this.renderTarget=r,this.updateBeforeType=rt.FRAME,this._textures={output:r.texture,depth:n},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Q(0),this._cameraFar=Q(0),this._mrt=null,this.isPassNode=!0}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(t){let e=this._textures[t];return e===void 0&&(e=this.renderTarget.texture.clone(),e.isRenderTargetTexture=!0,e.name=t,this._textures[t]=e,this.renderTarget.textures.push(e)),e}getPreviousTexture(t){let e=this._previousTextures[t];return e===void 0&&(e=this.getTexture(t).clone(),e.isRenderTargetTexture=!0,this._previousTextures[t]=e),e}toggleTexture(t){const e=this._previousTextures[t];if(e!==void 0){const s=this._textures[t],i=this.renderTarget.textures.indexOf(s);this.renderTarget.textures[i]=e,this._textures[t]=e,this._previousTextures[t]=s,this._textureNodes[t].updateTexture(),this._previousTextureNodes[t].updateTexture()}}getTextureNode(t="output"){let e=this._textureNodes[t];return e===void 0&&(e=k(new G3(this,t)),e.updateTexture(),this._textureNodes[t]=e),e}getPreviousTextureNode(t="output"){let e=this._previousTextureNodes[t];return e===void 0&&(this._textureNodes[t]===void 0&&this.getTextureNode(t),e=k(new G3(this,t,!0)),e.updateTexture(),this._previousTextureNodes[t]=e),e}getViewZNode(t="depth"){let e=this._viewZNodes[t];if(e===void 0){const s=this._cameraNear,i=this._cameraFar;this._viewZNodes[t]=e=W2(this.getTextureNode(t),s,i)}return e}getLinearDepthNode(t="depth"){let e=this._linearDepthNodes[t];if(e===void 0){const s=this._cameraNear,i=this._cameraFar,n=this.getViewZNode(t);this._linearDepthNodes[t]=e=Ar(n,s,i)}return e}setup({renderer:t}){return this.renderTarget.samples=this.options.samples===void 0?t.samples:this.options.samples,t.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.depthTexture.isMultisampleRenderTargetTexture=this.renderTarget.samples>1,this.scope===Mi.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(t){const{renderer:e}=t,{scene:s,camera:i}=this;this._pixelRatio=e.getPixelRatio();const n=e.getSize(Uv);this.setSize(n.width,n.height);const r=e.getRenderTarget(),a=e.getMRT();this._cameraNear.value=i.near,this._cameraFar.value=i.far;for(const c in this._previousTextures)this.toggleTexture(c);e.setRenderTarget(this.renderTarget),e.setMRT(this._mrt),e.render(s,i),e.setRenderTarget(r),e.setMRT(a)}setSize(t,e){this._width=t,this._height=e;const s=this._width*this._pixelRatio,i=this._height*this._pixelRatio;this.renderTarget.setSize(s,i)}setPixelRatio(t){this._pixelRatio=t,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Mi.COLOR="color";Mi.DEPTH="depth";const zv=(o,t,e)=>k(new Mi(Mi.COLOR,o,t,e)),kv=(o,t)=>k(new L9(o,t)),Vv=(o,t)=>k(new Mi(Mi.DEPTH,o,t));class Gv extends Mi{static get type(){return"ToonOutlinePassNode"}constructor(t,e,s,i,n){super(Mi.COLOR,t,e),this.colorNode=s,this.thicknessNode=i,this.alphaNode=n,this._materialCache=new WeakMap}updateBefore(t){const{renderer:e}=t,s=e.getRenderObjectFunction();e.setRenderObjectFunction((i,n,r,a,c,l,u,p)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const h=this._getOutlineMaterial(c);e.renderObject(i,n,r,a,h,l,u,p)}e.renderObject(i,n,r,a,c,l,u,p)}),super.updateBefore(t),e.setRenderObjectFunction(s)}_createMaterial(){const t=new ue;t.isMeshToonOutlineMaterial=!0,t.name="Toon_Outline",t.side=ls;const e=hs.negate(),s=Dn.mul(Co),i=_(1),n=s.mul(J(re,1)),r=s.mul(J(re.add(e),1)),a=Ki(n.sub(r));return t.vertexNode=n.add(a.mul(this.thicknessNode).mul(n.w).mul(i)),t.colorNode=J(this.colorNode,this.alphaNode),t}_getOutlineMaterial(t){let e=this._materialCache.get(t);return e===void 0&&(e=this._createMaterial(),this._materialCache.set(t,e)),e}}const Ov=(o,t,e=new W(0,0,0),s=.003,i=1)=>k(new Gv(o,t,k(e),k(s),k(i))),U9=P(([o,t])=>o.mul(t).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),z9=P(([o,t])=>(o=o.mul(t),o.div(o.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),k9=P(([o,t])=>{o=o.mul(t),o=o.sub(.004).max(0);const e=o.mul(o.mul(6.2).add(.5)),s=o.mul(o.mul(6.2).add(1.7)).add(.06);return e.div(s).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),Wv=P(([o])=>{const t=o.mul(o.add(.0245786)).sub(90537e-9),e=o.mul(o.add(.432951).mul(.983729)).add(.238081);return t.div(e)}),V9=P(([o,t])=>{const e=qe(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),s=qe(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return o=o.mul(t).div(.6),o=e.mul(o),o=Wv(o),o=s.mul(o),o.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$v=qe(D(1.6605,-.1246,-.0182),D(-.5876,1.1329,-.1006),D(-.0728,-.0083,1.1187)),Hv=qe(D(.6274,.0691,.0164),D(.3293,.9195,.088),D(.0433,.0113,.8956)),qv=P(([o])=>{const t=D(o).toVar(),e=D(t.mul(t)).toVar(),s=D(e.mul(e)).toVar();return _(15.5).mul(s.mul(e)).sub(ct(40.14,s.mul(t))).add(ct(31.96,s).sub(ct(6.868,e.mul(t))).add(ct(.4298,e).add(ct(.1191,t).sub(.00232))))}),G9=P(([o,t])=>{const e=D(o).toVar(),s=qe(D(.856627153315983,.137318972929847,.11189821299995),D(.0951212405381588,.761241990602591,.0767994186031903),D(.0482516061458583,.101439036467562,.811302368396859)),i=qe(D(1.1271005818144368,-.1413297634984383,-.14132976349843826),D(-.11060664309660323,1.157823702216272,-.11060664309660294),D(-.016493938717834573,-.016493938717834257,1.2519364065950405)),n=_(-12.47393),r=_(4.026069);return e.mulAssign(t),e.assign(Hv.mul(e)),e.assign(s.mul(e)),e.assign(le(e,1e-10)),e.assign(fi(e)),e.assign(e.sub(n).div(r.sub(n))),e.assign(wi(e,0,1)),e.assign(qv(e)),e.assign(i.mul(e)),e.assign(Ks(le(D(0),e),D(2.2))),e.assign($v.mul(e)),e.assign(wi(e,0,1)),e}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),O9=P(([o,t])=>{const e=_(.76),s=_(.15);o=o.mul(t);const i=ps(o.r,ps(o.g,o.b)),n=Ie(i.lessThan(.08),i.sub(ct(6.25,i.mul(i))),.04);o.subAssign(n);const r=le(o.r,le(o.g,o.b));pt(r.lessThan(e),()=>o);const a=wt(1,e),c=wt(1,a.mul(a).div(r.add(a.sub(e))));o.mulAssign(c.div(r));const l=wt(1,si(1,s.mul(r.sub(c)).add(1)));return Mt(o,D(c),l)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class xe extends tt{static get type(){return"CodeNode"}constructor(t="",e=[],s=""){super("code"),this.isCodeNode=!0,this.code=t,this.language=s,this.includes=e}isGlobal(){return!0}setIncludes(t){return this.includes=t,this}getIncludes(){return this.includes}generate(t){const e=this.getIncludes(t);for(const i of e)i.build(t);const s=t.getCodeFromNode(this,this.getNodeType(t));return s.code=this.code,s.code}serialize(t){super.serialize(t),t.code=this.code,t.language=this.language}deserialize(t){super.deserialize(t),this.code=t.code,this.language=t.language}}const ql=L(xe),Yv=(o,t)=>ql(o,t,"js"),Xv=(o,t)=>ql(o,t,"wgsl"),Zv=(o,t)=>ql(o,t,"glsl");class W9 extends xe{static get type(){return"FunctionNode"}constructor(t="",e=[],s=""){super(t,e,s)}getNodeType(t){return this.getNodeFunction(t).type}getInputs(t){return this.getNodeFunction(t).inputs}getNodeFunction(t){const e=t.getDataFromNode(this);let s=e.nodeFunction;return s===void 0&&(s=t.parser.parseFunction(this.code),e.nodeFunction=s),s}generate(t,e){super.generate(t);const s=this.getNodeFunction(t),i=s.name,n=s.type,r=t.getCodeFromNode(this,n);i!==""&&(r.name=i);const a=t.getPropertyName(r),c=this.getNodeFunction(t).getCode(a);return r.code=c+`
`,e==="property"?a:t.format(`${a}()`,n,e)}}const $9=(o,t=[],e="")=>{for(let n=0;n<t.length;n++){const r=t[n];typeof r=="function"&&(t[n]=r.functionNode)}const s=k(new W9(o,t,e)),i=(...n)=>s.call(...n);return i.functionNode=s,i},jv=(o,t)=>$9(o,t,"glsl"),Kv=(o,t)=>$9(o,t,"wgsl");class Jv extends tt{static get type(){return"ScriptableValueNode"}constructor(t=null){super(),this._value=t,this._cache=null,this.inputType=null,this.outpuType=null,this.events=new Pn,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(t){this._value!==t&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=t,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const t=this.value;if(t&&this._cache===null&&this.inputType==="URL"&&t.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([t.value]));else if(t&&t.value!==null&&t.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof t.value=="string"||this.inputType==="Number"&&typeof t.value=="number"||this.inputType==="Vector2"&&t.value.isVector2||this.inputType==="Vector3"&&t.value.isVector3||this.inputType==="Vector4"&&t.value.isVector4||this.inputType==="Color"&&t.value.isColor||this.inputType==="Matrix3"&&t.value.isMatrix3||this.inputType==="Matrix4"&&t.value.isMatrix4))return t.value;return this._cache||t}getNodeType(t){return this.value&&this.value.isNode?this.value.getNodeType(t):"float"}setup(){return this.value&&this.value.isNode?this.value:_()}serialize(t){super.serialize(t),this.value!==null?this.inputType==="ArrayBuffer"?t.value=e8(this.value):t.value=this.value?this.value.toJSON(t.meta).uuid:null:t.value=null,t.inputType=this.inputType,t.outputType=this.outputType}deserialize(t){super.deserialize(t);let e=null;t.value!==null&&(t.inputType==="ArrayBuffer"?e=s8(t.value):t.inputType==="Texture"?e=t.meta.textures[t.value]:e=t.meta.nodes[t.value]||null),this.value=e,this.inputType=t.inputType,this.outputType=t.outputType}}const Ec=L(Jv);class H9 extends Map{get(t,e=null,...s){if(this.has(t))return super.get(t);if(e!==null){const i=e(...s);return this.set(t,i),i}}}class Qv{constructor(t){this.scriptableNode=t}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(t){return this.scriptableNode.getInputLayout(t)}get(t){const e=this.parameters[t];return e?e.getValue():null}}const Dc=new H9;class t_ extends tt{static get type(){return"ScriptableNode"}constructor(t=null,e={}){super(),this.codeNode=t,this.parameters=e,this._local=new H9,this._output=Ec(),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(t,e){return this._local.set(t,e)}getLocal(t){return this._local.get(t)}onRefresh(){this._refresh()}getInputLayout(t){for(const e of this.getLayout())if(e.inputType&&(e.id===t||e.name===t))return e}getOutputLayout(t){for(const e of this.getLayout())if(e.outputType&&(e.id===t||e.name===t))return e}setOutput(t,e){const s=this._outputs;return s[t]===void 0?s[t]=Ec(e):s[t].value=e,this}getOutput(t){return this._outputs[t]}getParameter(t){return this.parameters[t]}setParameter(t,e){const s=this.parameters;return e&&e.isScriptableNode?(this.deleteParameter(t),s[t]=e,s[t].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):e&&e.isScriptableValueNode?(this.deleteParameter(t),s[t]=e,s[t].events.addEventListener("refresh",this.onRefresh)):s[t]===void 0?(s[t]=Ec(e),s[t].events.addEventListener("refresh",this.onRefresh)):s[t].value=e,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(t){let e=this.parameters[t];return e&&(e.isScriptableNode&&(e=e.getDefaultOutput()),e.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const t of Object.keys(this.parameters))this.deleteParameter(t);return this.needsUpdate=!0,this}call(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i(...e)}async callAsync(t,...e){const i=this.getObject()[t];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...e):i(...e)}getNodeType(t){return this.getDefaultOutputNode().getNodeType(t)}refresh(t=null){t!==null?this.getOutput(t).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const t=()=>this.refresh(),e=(l,u)=>this.setOutput(l,u),s=new Qv(this),i=Dc.get("THREE"),n=Dc.get("TSL"),r=this.getMethod(this.codeNode),a=[s,this._local,Dc,t,e,i,n];this._object=r(...a);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const l of c.elements){const u=l.id||l.name;l.inputType&&(this.getParameter(u)===void 0&&this.setParameter(u,null),this.getParameter(u).inputType=l.inputType),l.outputType&&(this.getOutput(u)===void 0&&this.setOutput(u,null),this.getOutput(u).outputType=l.outputType)}return this._object}deserialize(t){super.deserialize(t);for(const e in this.parameters){let s=this.parameters[e];s.isScriptableNode&&(s=s.getDefaultOutput()),s.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const t=this.getDefaultOutput().value;return t&&t.isNode?t:_()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const t=["parameters","local","global","refresh","setOutput","THREE","TSL"],s=["layout","init","main","dispose"].join(", "),i="var "+s+`; var output = {};
`,n=`
return { ...output, `+s+" };",r=i+this.codeNode.code+n;return this._method=new Function(...t,r),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(t){const e=[Z4(this.source),this.getDefaultOutputNode().getCacheKey(t)];for(const s in this.parameters)e.push(this.parameters[s].getCacheKey(t));return o2(e)}set needsUpdate(t){t===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const e_=L(t_);class eh extends tt{static get type(){return"FogNode"}constructor(t,e){super("float"),this.isFogNode=!0,this.colorNode=t,this.factorNode=e}getViewZNode(t){let e;const s=t.context.getViewZ;return s!==void 0&&(e=s(this)),(e||be.z).negate()}setup(){return this.factorNode}}const s_=L(eh);class i_ extends eh{static get type(){return"FogRangeNode"}constructor(t,e,s){super(t),this.isFogRangeNode=!0,this.nearNode=e,this.farNode=s}setup(t){const e=this.getViewZNode(t);return Ji(this.nearNode,this.farNode,e)}}const q9=L(i_);class n_ extends eh{static get type(){return"FogExp2Node"}constructor(t,e){super(t),this.isFogExp2Node=!0,this.densityNode=e}setup(t){const e=this.getViewZNode(t),s=this.densityNode;return s.mul(s,e,e).negate().exp().oneMinus()}}const Y9=L(n_);let Xn=null,Zn=null;class o_ extends tt{static get type(){return"RangeNode"}constructor(t=_(),e=_()){super(),this.minNode=t,this.maxNode=e}getVectorLength(t){const e=t.getTypeLength(_n(this.minNode.value)),s=t.getTypeLength(_n(this.maxNode.value));return e>s?e:s}getNodeType(t){return t.object.count>1?t.getTypeFromLength(this.getVectorLength(t)):"float"}setup(t){const e=t.object;let s=null;if(e.count>1){const i=this.minNode.value,n=this.maxNode.value,r=t.getTypeLength(_n(i)),a=t.getTypeLength(_n(n));Xn=Xn||new vt,Zn=Zn||new vt,Xn.setScalar(0),Zn.setScalar(0),r===1?Xn.setScalar(i):i.isColor?Xn.set(i.r,i.g,i.b):Xn.set(i.x,i.y,i.z||0,i.w||0),a===1?Zn.setScalar(n):n.isColor?Zn.set(n.r,n.g,n.b):Zn.set(n.x,n.y,n.z||0,n.w||0);const c=4,l=c*e.count,u=new Float32Array(l);for(let h=0;h<l;h++){const d=h%c,g=Xn.getComponent(d),f=Zn.getComponent(d);u[h]=Gt.lerp(g,f,Math.random())}const p=this.getNodeType(t);if(e.count<=4096)s=d0(u,"vec4",e.count).element(y0).convert(p);else{const h=new Ga(u,4);t.geometry.setAttribute("__range"+this.id,h),s=Qc(h).convert(p)}}else s=_(0);return s}}const r_=L(o_);class a_ extends tt{static get type(){return"ComputeBuiltinNode"}constructor(t,e){super(e),this._builtinName=t}getHash(t){return this.getBuiltinName(t)}getNodeType(){return this.nodeType}setBuiltinName(t){return this._builtinName=t,this}getBuiltinName(){return this._builtinName}hasBuiltin(t){t.hasBuiltin(this._builtinName)}generate(t,e){const s=this.getBuiltinName(t),i=this.getNodeType(t);return t.shaderStage==="compute"?t.format(s,i,e):(console.warn(`ComputeBuiltinNode: Compute built-in value ${s} can not be accessed in the ${t.shaderStage} stage`),t.generateConst(i))}serialize(t){super.serialize(t),t.global=this.global,t._builtinName=this._builtinName}deserialize(t){super.deserialize(t),this.global=t.global,this._builtinName=t._builtinName}}const Yl=(o,t)=>k(new a_(o,t)),c_=Yl("numWorkgroups","uvec3"),l_=Yl("workgroupId","uvec3"),u_=Yl("localId","uvec3"),p_=Yl("subgroupSize","uint");class h_ extends tt{constructor(t){super(),this.scope=t}generate(t){const{scope:e}=this,{renderer:s}=t;s.backend.isWebGLBackend===!0?t.addFlowCode(`	// ${e}Barrier 
`):t.addLineFlowCode(`${e}Barrier()`,this)}}const sh=L(h_),d_=()=>sh("workgroup").append(),g_=()=>sh("storage").append(),f_=()=>sh("texture").append();class m_ extends No{constructor(t,e){super(t,e),this.isWorkgroupInfoElementNode=!0}generate(t,e){let s;const i=t.context.assign;if(s=super.generate(t),i!==!0){const n=this.getNodeType(t);s=t.format(s,n,e)}return s}}class y_ extends tt{constructor(t,e,s=0){super(e),this.bufferType=e,this.bufferCount=s,this.isWorkgroupInfoNode=!0,this.scope=t}label(t){return this.name=t,this}getHash(){return this.uuid}setScope(t){return this.scope=t,this}getInputType(){return`${this.scope}Array`}element(t){return k(new m_(this,t))}generate(t){return t.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const x_=(o,t)=>k(new y_("Workgroup",o,t));class Ee extends pe{static get type(){return"AtomicFunctionNode"}constructor(t,e,s,i=null){super("uint"),this.method=t,this.pointerNode=e,this.valueNode=s,this.storeNode=i}getInputType(t){return this.pointerNode.getNodeType(t)}getNodeType(t){return this.getInputType(t)}generate(t){const e=this.method,s=this.getNodeType(t),i=this.getInputType(t),n=this.pointerNode,r=this.valueNode,a=[];a.push(`&${n.build(t,i)}`),a.push(r.build(t,i));const c=`${t.getMethod(e,s)}( ${a.join(", ")} )`;if(this.storeNode!==null){const l=this.storeNode.build(t,i);t.addLineFlowCode(`${l} = ${c}`,this)}else t.addLineFlowCode(c,this)}}Ee.ATOMIC_LOAD="atomicLoad";Ee.ATOMIC_STORE="atomicStore";Ee.ATOMIC_ADD="atomicAdd";Ee.ATOMIC_SUB="atomicSub";Ee.ATOMIC_MAX="atomicMax";Ee.ATOMIC_MIN="atomicMin";Ee.ATOMIC_AND="atomicAnd";Ee.ATOMIC_OR="atomicOr";Ee.ATOMIC_XOR="atomicXor";const w_=L(Ee),en=(o,t,e,s)=>{const i=w_(o,t,e,s);return i.append(),i},b_=(o,t,e=null)=>en(Ee.ATOMIC_STORE,o,t,e),v_=(o,t,e=null)=>en(Ee.ATOMIC_ADD,o,t,e),__=(o,t,e=null)=>en(Ee.ATOMIC_SUB,o,t,e),S_=(o,t,e=null)=>en(Ee.ATOMIC_MAX,o,t,e),T_=(o,t,e=null)=>en(Ee.ATOMIC_MIN,o,t,e),M_=(o,t,e=null)=>en(Ee.ATOMIC_AND,o,t,e),A_=(o,t,e=null)=>en(Ee.ATOMIC_OR,o,t,e),N_=(o,t,e=null)=>en(Ee.ATOMIC_XOR,o,t,e);let sc;function b0(o){sc=sc||new WeakMap;let t=sc.get(o);return t===void 0&&sc.set(o,t={}),t}function ih(o){const t=b0(o);return t.shadowMatrix||(t.shadowMatrix=Q("mat4").setGroup(st).onRenderUpdate(()=>(o.shadow.updateMatrices(o),o.shadow.matrix)))}function X9(o){const t=b0(o);if(t.projectionUV===void 0){const e=ih(o).mul(qi);t.projectionUV=e.xyz.div(e.w)}return t.projectionUV}function nh(o){const t=b0(o);return t.position||(t.position=Q(new S).setGroup(st).onRenderUpdate((e,s)=>s.value.setFromMatrixPosition(o.matrixWorld)))}function Z9(o){const t=b0(o);return t.targetPosition||(t.targetPosition=Q(new S).setGroup(st).onRenderUpdate((e,s)=>s.value.setFromMatrixPosition(o.target.matrixWorld)))}function Xl(o){const t=b0(o);return t.viewPosition||(t.viewPosition=Q(new S).setGroup(st).onRenderUpdate(({camera:e},s)=>{s.value=s.value||new S,s.value.setFromMatrixPosition(o.matrixWorld),s.value.applyMatrix4(e.matrixWorldInverse)}))}const oh=o=>ms.transformDirection(nh(o).sub(Z9(o))),C_=o=>o.sort((t,e)=>t.id-e.id),F_=(o,t)=>{for(const e of t)if(e.isAnalyticLightNode&&e.light.id===o)return e;return null},$1=new WeakMap;class rh extends tt{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=D().toVar("totalDiffuse"),this.totalSpecularNode=D().toVar("totalSpecular"),this.outgoingLightNode=D().toVar("outgoingLight"),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}getHash(t){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(t);const e=[];for(const s of this._lightNodes)e.push(s.getSelf().getHash());this._lightNodesHash="lights-"+e.join(",")}return this._lightNodesHash}analyze(t){const e=t.getDataFromNode(this);for(const s of e.nodes)s.build(t)}setupLightsNode(t){const e=[],s=this._lightNodes,i=C_(this._lights),n=t.renderer.library;for(const r of i)if(r.isNode)e.push(k(r));else{let a=null;if(s!==null&&(a=F_(r.id,s)),a===null){const c=n.getLightNodeClass(r.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${r.constructor.name}`);continue}let l=null;$1.has(r)?l=$1.get(r):(l=k(new c(r)),$1.set(r,l)),e.push(l)}}this._lightNodes=e}setupLights(t,e){for(const s of e)s.build(t)}setup(t){this._lightNodes===null&&this.setupLightsNode(t);const e=t.context,s=e.lightingModel;let i=this.outgoingLightNode;if(s){const{_lightNodes:n,totalDiffuseNode:r,totalSpecularNode:a}=this;e.outgoingLight=i;const c=t.addStack(),l=t.getDataFromNode(this);l.nodes=c.nodes,s.start(e,c,t),this.setupLights(t,n),s.indirect(e,c,t);const{backdrop:u,backdropAlpha:p}=e,{directDiffuse:h,directSpecular:d,indirectDiffuse:g,indirectSpecular:f}=e.reflectedLight;let m=h.add(g);u!==null&&(p!==null?m=D(p.mix(m,u)):m=D(u),e.material.transparent=!0),r.assign(m),a.assign(d.add(f)),i.assign(r.add(a)),s.finish(e,c,t),i=i.bypass(t.removeStack())}return i}setLights(t){return this._lights=t,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const R_=(o=[])=>k(new rh).setLights(o),O3=new WeakMap,W3=D().toVar("shadowWorldPosition"),E_=P(([o,t,e])=>{let s=qi.sub(o).length();return s=s.sub(t).div(e.sub(t)),s=s.saturate(),s}),D_=o=>{const t=o.shadow.camera,e=Et("near","float",t).setGroup(st),s=Et("far","float",t).setGroup(st),i=H6(o);return E_(i,e,s)},B_=o=>{let t=O3.get(o);if(t===void 0){const e=o.isPointLight?D_(o):null;t=new ue,t.colorNode=J(0,0,0,1),t.depthNode=e,t.isShadowNodeMaterial=!0,t.blending=fo,t.name="ShadowMaterial",O3.set(o,t)}return t},j9=P(({depthTexture:o,shadowCoord:t})=>yt(o,t.xy).compare(t.z)),K9=P(({depthTexture:o,shadowCoord:t,shadow:e})=>{const s=(f,m)=>yt(o,f).compare(m),i=Et("mapSize","vec2",e).setGroup(st),n=Et("radius","float",e).setGroup(st),r=G(1).div(i),a=r.x.negate().mul(n),c=r.y.negate().mul(n),l=r.x.mul(n),u=r.y.mul(n),p=a.div(2),h=c.div(2),d=l.div(2),g=u.div(2);return fe(s(t.xy.add(G(a,c)),t.z),s(t.xy.add(G(0,c)),t.z),s(t.xy.add(G(l,c)),t.z),s(t.xy.add(G(p,h)),t.z),s(t.xy.add(G(0,h)),t.z),s(t.xy.add(G(d,h)),t.z),s(t.xy.add(G(a,0)),t.z),s(t.xy.add(G(p,0)),t.z),s(t.xy,t.z),s(t.xy.add(G(d,0)),t.z),s(t.xy.add(G(l,0)),t.z),s(t.xy.add(G(p,g)),t.z),s(t.xy.add(G(0,g)),t.z),s(t.xy.add(G(d,g)),t.z),s(t.xy.add(G(a,u)),t.z),s(t.xy.add(G(0,u)),t.z),s(t.xy.add(G(l,u)),t.z)).mul(1/17)}),J9=P(({depthTexture:o,shadowCoord:t,shadow:e})=>{const s=(u,p)=>yt(o,u).compare(p),i=Et("mapSize","vec2",e).setGroup(st),n=G(1).div(i),r=n.x,a=n.y,c=t.xy,l=tn(c.mul(i).add(.5));return c.subAssign(l.mul(n)),fe(s(c,t.z),s(c.add(G(r,0)),t.z),s(c.add(G(0,a)),t.z),s(c.add(n),t.z),Mt(s(c.add(G(r.negate(),0)),t.z),s(c.add(G(r.mul(2),0)),t.z),l.x),Mt(s(c.add(G(r.negate(),a)),t.z),s(c.add(G(r.mul(2),a)),t.z),l.x),Mt(s(c.add(G(0,a.negate())),t.z),s(c.add(G(0,a.mul(2))),t.z),l.y),Mt(s(c.add(G(r,a.negate())),t.z),s(c.add(G(r,a.mul(2))),t.z),l.y),Mt(Mt(s(c.add(G(r.negate(),a.negate())),t.z),s(c.add(G(r.mul(2),a.negate())),t.z),l.x),Mt(s(c.add(G(r.negate(),a.mul(2))),t.z),s(c.add(G(r.mul(2),a.mul(2))),t.z),l.x),l.y)).mul(1/9)}),Q9=P(({depthTexture:o,shadowCoord:t})=>{const e=_(1).toVar(),s=yt(o).uv(t.xy).rg,i=Dl(t.z,s.x);return pt(i.notEqual(_(1)),()=>{const n=t.z.sub(s.x),r=le(0,s.y.mul(s.y));let a=r.div(r.add(n.mul(n)));a=wi(wt(a,.3).div(.95-.3)),e.assign(wi(le(i,a)))}),e}),P_=P(({samples:o,radius:t,size:e,shadowPass:s})=>{const i=_(0).toVar(),n=_(0).toVar(),r=o.lessThanEqual(_(1)).select(_(0),_(2).div(o.sub(1))),a=o.lessThanEqual(_(1)).select(_(0),_(-1));Nt({start:C(0),end:C(o),type:"int",condition:"<"},({i:l})=>{const u=a.add(_(l).mul(r)),p=s.uv(fe(x0.xy,G(0,u).mul(t)).div(e)).x;i.addAssign(p),n.addAssign(p.mul(p))}),i.divAssign(o),n.divAssign(o);const c=Ai(n.sub(i.mul(i)));return G(i,c)}),I_=P(({samples:o,radius:t,size:e,shadowPass:s})=>{const i=_(0).toVar(),n=_(0).toVar(),r=o.lessThanEqual(_(1)).select(_(0),_(2).div(o.sub(1))),a=o.lessThanEqual(_(1)).select(_(0),_(-1));Nt({start:C(0),end:C(o),type:"int",condition:"<"},({i:l})=>{const u=a.add(_(l).mul(r)),p=s.uv(fe(x0.xy,G(u,0).mul(t)).div(e));i.addAssign(p.x),n.addAssign(fe(p.y.mul(p.y),p.x.mul(p.x)))}),i.divAssign(o),n.divAssign(o);const c=Ai(n.sub(i.mul(i)));return G(i,c)}),L_=[j9,K9,J9,Q9],ic=new th;class td extends tt{static get type(){return"ShadowNode"}constructor(t,e=null){super(),this.light=t,this.shadow=e||t.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this.updateBeforeType=rt.RENDER,this._node=null,this.isShadowNode=!0}setupShadowFilter(t,{filterFn:e,depthTexture:s,shadowCoord:i,shadow:n}){const r=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),a=e({depthTexture:s,shadowCoord:i,shadow:n});return r.select(a,_(1))}setupShadowCoord(t,e){const{shadow:s}=this,{renderer:i}=t,n=Et("bias","float",s).setGroup(st);let r=e,a;if(s.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)r=r.xyz.div(r.w),a=r.z,i.coordinateSystem===Xi&&(a=a.mul(2).sub(1));else{const c=r.w;r=r.xy.div(c);const l=Et("near","float",s.camera).setGroup(st),u=Et("far","float",s.camera).setGroup(st);a=$2(c.negate(),l,u)}return r=D(r.x,r.y.oneMinus(),a.add(n)),r}getShadowFilterFn(t){return L_[t]}setupShadow(t){const{renderer:e}=t,{light:s,shadow:i}=this,n=e.shadowMap.type,r=new To(i.mapSize.width,i.mapSize.height);r.compareFunction=Gp;const a=t.createRenderTarget(i.mapSize.width,i.mapSize.height);if(a.depthTexture=r,i.camera.updateProjectionMatrix(),n===T0){r.compareFunction=null,this.vsmShadowMapVertical=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:ka,type:Qs}),this.vsmShadowMapHorizontal=t.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:ka,type:Qs});const x=yt(r),w=yt(this.vsmShadowMapVertical.texture),b=Et("blurSamples","float",i).setGroup(st),v=Et("radius","float",i).setGroup(st),T=Et("mapSize","vec2",i).setGroup(st);let M=this.vsmMaterialVertical||(this.vsmMaterialVertical=new ue);M.fragmentNode=P_({samples:b,radius:v,size:T,shadowPass:x}).context(t.getSharedContext()),M.name="VSMVertical",M=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new ue),M.fragmentNode=I_({samples:b,radius:v,size:T,shadowPass:w}).context(t.getSharedContext()),M.name="VSMHorizontal"}const c=Et("intensity","float",i).setGroup(st),l=Et("normalBias","float",i).setGroup(st),u=ih(s).mul(W3.add(Ul.mul(l))),p=this.setupShadowCoord(t,u),h=i.filterNode||this.getShadowFilterFn(e.shadowMap.type)||null;if(h===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const d=n===T0?this.vsmShadowMapHorizontal.texture:r,g=this.setupShadowFilter(t,{filterFn:h,shadowTexture:a.texture,depthTexture:d,shadowCoord:p,shadow:i}),f=yt(a.texture,p),m=Mt(1,g.rgb.mix(f,1),c.mul(f.a)).toVar();return this.shadowMap=a,this.shadow.map=a,m}setup(t){if(t.renderer.shadowMap.enabled!==!1)return P(({material:e})=>{W3.assign(e.shadowPositionNode||qi);let s=this._node;return s===null&&(this._node=s=this.setupShadow(t)),t.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),t.material.receivedShadowNode&&(s=t.material.receivedShadowNode(s)),s})()}renderShadow(t){const{shadow:e,shadowMap:s}=this,{renderer:i,scene:n}=t;s.setSize(e.mapSize.width,e.mapSize.height),i.render(n,e.camera)}updateShadow(t){const{shadowMap:e,light:s,shadow:i}=this,{renderer:n,scene:r,camera:a}=t,c=n.shadowMap.type,l=e.depthTexture.version;this._depthVersionCached=l;const u=r.overrideMaterial;r.overrideMaterial=B_(s),i.camera.layers.mask=a.layers.mask;const p=n.getRenderTarget(),h=n.getRenderObjectFunction(),d=n.getMRT();n.setMRT(null),n.setRenderObjectFunction((g,...f)=>{(g.castShadow===!0||g.receiveShadow&&c===T0)&&n.renderObject(g,...f)}),n.setRenderTarget(e),this.renderShadow(t),n.setRenderObjectFunction(h),s.isPointLight!==!0&&c===T0&&this.vsmPass(n),n.setRenderTarget(p),n.setMRT(d),r.overrideMaterial=u}vsmPass(t){const{shadow:e}=this;this.vsmShadowMapVertical.setSize(e.mapSize.width,e.mapSize.height),this.vsmShadowMapHorizontal.setSize(e.mapSize.width,e.mapSize.height),t.setRenderTarget(this.vsmShadowMapVertical),ic.material=this.vsmMaterialVertical,ic.render(t),t.setRenderTarget(this.vsmShadowMapHorizontal),ic.material=this.vsmMaterialHorizontal,ic.render(t)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),this.updateBeforeType=rt.NONE}updateBefore(t){const{shadow:e}=this;(e.needsUpdate||e.autoUpdate)&&(this.updateShadow(t),this.shadowMap.depthTexture.version===this._depthVersionCached&&(e.needsUpdate=!1))}}const ed=(o,t)=>k(new td(o,t));class Ro extends Wr{static get type(){return"AnalyticLightNode"}constructor(t=null){super(),this.light=t,this.color=new W,this.colorNode=t&&t.colorNode||Q(this.color).setGroup(st),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=rt.FRAME}getCacheKey(){return j4(super.getCacheKey(),this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}setupShadowNode(){return ed(this.light)}setupShadow(t){const{renderer:e}=t;if(e.shadowMap.enabled===!1)return;let s=this.shadowColorNode;if(s===null){const i=this.light.shadow.shadowNode;let n;i!==void 0?n=k(i):n=this.setupShadowNode(t),this.shadowNode=n,this.shadowColorNode=s=this.colorNode.mul(n),this.baseColorNode=this.colorNode}this.colorNode=s}setup(t){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?t.object.receiveShadow&&this.setupShadow(t):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null)}update(){const{light:t}=this;this.color.copy(t.color).multiplyScalar(t.intensity)}}const ah=P(o=>{const{lightDistance:t,cutoffDistance:e,decayExponent:s}=o,i=t.pow(s).max(.01).reciprocal();return e.greaterThan(0).select(i.mul(t.div(e).pow4().oneMinus().clamp().pow2()),i)}),U_=new W,ci=P(([o,t])=>{const e=o.toVar(),s=Ot(e),i=si(1,le(s.x,le(s.y,s.z)));s.mulAssign(i),e.mulAssign(i.mul(t.mul(2).oneMinus()));const n=G(e.xy).toVar(),a=t.mul(1.5).oneMinus();return pt(s.z.greaterThanEqual(a),()=>{pt(e.z.greaterThan(0),()=>{n.x.assign(wt(4,e.x))})}).ElseIf(s.x.greaterThanEqual(a),()=>{const c=Ja(e.x);n.x.assign(e.z.mul(c).add(c.mul(2)))}).ElseIf(s.y.greaterThanEqual(a),()=>{const c=Ja(e.y);n.x.assign(e.x.add(c.mul(2)).add(2)),n.y.assign(e.z.mul(c).sub(2))}),G(.125,.25).mul(n).add(G(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),z_=P(({depthTexture:o,bd3D:t,dp:e,texelSize:s})=>yt(o,ci(t,s.y)).compare(e)),k_=P(({depthTexture:o,bd3D:t,dp:e,texelSize:s,shadow:i})=>{const n=Et("radius","float",i).setGroup(st),r=G(-1,1).mul(n).mul(s.y);return yt(o,ci(t.add(r.xyy),s.y)).compare(e).add(yt(o,ci(t.add(r.yyy),s.y)).compare(e)).add(yt(o,ci(t.add(r.xyx),s.y)).compare(e)).add(yt(o,ci(t.add(r.yyx),s.y)).compare(e)).add(yt(o,ci(t,s.y)).compare(e)).add(yt(o,ci(t.add(r.xxy),s.y)).compare(e)).add(yt(o,ci(t.add(r.yxy),s.y)).compare(e)).add(yt(o,ci(t.add(r.xxx),s.y)).compare(e)).add(yt(o,ci(t.add(r.yxx),s.y)).compare(e)).mul(1/9)}),V_=P(({filterFn:o,depthTexture:t,shadowCoord:e,shadow:s})=>{const i=e.xyz.toVar(),n=i.length(),r=Q("float").setGroup(st).onRenderUpdate(()=>s.camera.near),a=Q("float").setGroup(st).onRenderUpdate(()=>s.camera.far),c=Et("bias","float",s).setGroup(st),l=Q(s.mapSize).setGroup(st),u=_(1).toVar();return pt(n.sub(a).lessThanEqual(0).and(n.sub(r).greaterThanEqual(0)),()=>{const p=n.sub(r).div(a.sub(r)).toVar();p.addAssign(c);const h=i.normalize(),d=G(1).div(l.mul(G(4,2)));u.assign(o({depthTexture:t,bd3D:h,dp:p,texelSize:d,shadow:s}))}),u}),$3=new vt,jo=new Y,la=new Y;class G_ extends td{static get type(){return"PointShadowNode"}constructor(t,e=null){super(t,e)}getShadowFilterFn(t){return t===dg?z_:k_}setupShadowCoord(t,e){return e}setupShadowFilter(t,{filterFn:e,shadowTexture:s,depthTexture:i,shadowCoord:n,shadow:r}){return V_({filterFn:e,shadowTexture:s,depthTexture:i,shadowCoord:n,shadow:r})}renderShadow(t){const{shadow:e,shadowMap:s,light:i}=this,{renderer:n,scene:r}=t,a=e.getFrameExtents();la.copy(e.mapSize),la.multiply(a),s.setSize(la.width,la.height),jo.copy(e.mapSize);const c=n.autoClear,l=n.getClearColor(U_),u=n.getClearAlpha();n.autoClear=!1,n.setClearColor(e.clearColor,e.clearAlpha),n.clear();const p=e.getViewportCount();for(let h=0;h<p;h++){const d=e.getViewport(h),g=jo.x*d.x,f=la.y-jo.y-jo.y*d.y;$3.set(g,f,jo.x*d.z,jo.y*d.w),s.viewport.copy($3),e.updateMatrices(i,h),n.render(r,e.camera)}n.autoClear=c,n.setClearColor(l,u)}}const O_=(o,t)=>k(new G_(o,t)),sd=P(({color:o,lightViewPosition:t,cutoffDistance:e,decayExponent:s},i)=>{const n=i.context.lightingModel,r=t.sub(be),a=r.normalize(),c=r.length(),l=ah({lightDistance:c,cutoffDistance:e,decayExponent:s}),u=o.mul(l),p=i.context.reflectedLight;n.direct({lightDirection:a,lightColor:u,reflectedLight:p},i.stack,i)});class W_ extends Ro{static get type(){return"PointLightNode"}constructor(t=null){super(t),this.cutoffDistanceNode=Q(0).setGroup(st),this.decayExponentNode=Q(0).setGroup(st)}update(t){const{light:e}=this;super.update(t),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}setupShadowNode(){return O_(this.light)}setup(t){super.setup(t),sd({color:this.colorNode,lightViewPosition:Xl(this.light),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode}).append()}}const $_=P(([o=ee()])=>{const t=o.mul(2),e=t.x.floor(),s=t.y.floor();return e.add(s).mod(2).sign()}),Ia=P(([o,t,e])=>{const s=_(e).toVar(),i=_(t).toVar(),n=ji(o).toVar();return Ie(n,i,s)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),nl=P(([o,t])=>{const e=ji(t).toVar(),s=_(o).toVar();return Ie(e,s.negate(),s)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),ge=P(([o])=>{const t=_(o).toVar();return C(mi(t))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),Zt=P(([o,t])=>{const e=_(o).toVar();return t.assign(ge(e)),e.sub(_(t))}),H_=P(([o,t,e,s,i,n])=>{const r=_(n).toVar(),a=_(i).toVar(),c=_(s).toVar(),l=_(e).toVar(),u=_(t).toVar(),p=_(o).toVar(),h=_(wt(1,a)).toVar();return wt(1,r).mul(p.mul(h).add(u.mul(a))).add(r.mul(l.mul(h).add(c.mul(a))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),q_=P(([o,t,e,s,i,n])=>{const r=_(n).toVar(),a=_(i).toVar(),c=D(s).toVar(),l=D(e).toVar(),u=D(t).toVar(),p=D(o).toVar(),h=_(wt(1,a)).toVar();return wt(1,r).mul(p.mul(h).add(u.mul(a))).add(r.mul(l.mul(h).add(c.mul(a))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),id=Le([H_,q_]),Y_=P(([o,t,e,s,i,n,r,a,c,l,u])=>{const p=_(u).toVar(),h=_(l).toVar(),d=_(c).toVar(),g=_(a).toVar(),f=_(r).toVar(),m=_(n).toVar(),x=_(i).toVar(),w=_(s).toVar(),b=_(e).toVar(),v=_(t).toVar(),T=_(o).toVar(),M=_(wt(1,d)).toVar(),F=_(wt(1,h)).toVar();return _(wt(1,p)).toVar().mul(F.mul(T.mul(M).add(v.mul(d))).add(h.mul(b.mul(M).add(w.mul(d))))).add(p.mul(F.mul(x.mul(M).add(m.mul(d))).add(h.mul(f.mul(M).add(g.mul(d))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),X_=P(([o,t,e,s,i,n,r,a,c,l,u])=>{const p=_(u).toVar(),h=_(l).toVar(),d=_(c).toVar(),g=D(a).toVar(),f=D(r).toVar(),m=D(n).toVar(),x=D(i).toVar(),w=D(s).toVar(),b=D(e).toVar(),v=D(t).toVar(),T=D(o).toVar(),M=_(wt(1,d)).toVar(),F=_(wt(1,h)).toVar();return _(wt(1,p)).toVar().mul(F.mul(T.mul(M).add(v.mul(d))).add(h.mul(b.mul(M).add(w.mul(d))))).add(p.mul(F.mul(x.mul(M).add(m.mul(d))).add(h.mul(f.mul(M).add(g.mul(d))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),nd=Le([Y_,X_]),Z_=P(([o,t,e])=>{const s=_(e).toVar(),i=_(t).toVar(),n=q(o).toVar(),r=q(n.bitAnd(q(7))).toVar(),a=_(Ia(r.lessThan(q(4)),i,s)).toVar(),c=_(ct(2,Ia(r.lessThan(q(4)),s,i))).toVar();return nl(a,ji(r.bitAnd(q(1)))).add(nl(c,ji(r.bitAnd(q(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),j_=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=_(t).toVar(),a=q(o).toVar(),c=q(a.bitAnd(q(15))).toVar(),l=_(Ia(c.lessThan(q(8)),r,n)).toVar(),u=_(Ia(c.lessThan(q(4)),n,Ia(c.equal(q(12)).or(c.equal(q(14))),r,i))).toVar();return nl(l,ji(c.bitAnd(q(1)))).add(nl(u,ji(c.bitAnd(q(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Ce=Le([Z_,j_]),K_=P(([o,t,e])=>{const s=_(e).toVar(),i=_(t).toVar(),n=Or(o).toVar();return D(Ce(n.x,i,s),Ce(n.y,i,s),Ce(n.z,i,s))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),J_=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=_(t).toVar(),a=Or(o).toVar();return D(Ce(a.x,r,n,i),Ce(a.y,r,n,i),Ce(a.z,r,n,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Fs=Le([K_,J_]),Q_=P(([o])=>{const t=_(o).toVar();return ct(.6616,t)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),tS=P(([o])=>{const t=_(o).toVar();return ct(.982,t)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),eS=P(([o])=>{const t=D(o).toVar();return ct(.6616,t)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),od=Le([Q_,eS]),sS=P(([o])=>{const t=D(o).toVar();return ct(.982,t)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),rd=Le([tS,sS]),_s=P(([o,t])=>{const e=C(t).toVar(),s=q(o).toVar();return s.shiftLeft(e).bitOr(s.shiftRight(C(32).sub(e)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),ad=P(([o,t,e])=>{o.subAssign(e),o.bitXorAssign(_s(e,C(4))),e.addAssign(t),t.subAssign(o),t.bitXorAssign(_s(o,C(6))),o.addAssign(e),e.subAssign(t),e.bitXorAssign(_s(t,C(8))),t.addAssign(o),o.subAssign(e),o.bitXorAssign(_s(e,C(16))),e.addAssign(t),t.subAssign(o),t.bitXorAssign(_s(o,C(19))),o.addAssign(e),e.subAssign(t),e.bitXorAssign(_s(t,C(4))),t.addAssign(o)}),v0=P(([o,t,e])=>{const s=q(e).toVar(),i=q(t).toVar(),n=q(o).toVar();return s.bitXorAssign(i),s.subAssign(_s(i,C(14))),n.bitXorAssign(s),n.subAssign(_s(s,C(11))),i.bitXorAssign(n),i.subAssign(_s(n,C(25))),s.bitXorAssign(i),s.subAssign(_s(i,C(16))),n.bitXorAssign(s),n.subAssign(_s(s,C(4))),i.bitXorAssign(n),i.subAssign(_s(n,C(14))),s.bitXorAssign(i),s.subAssign(_s(i,C(24))),s}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),He=P(([o])=>{const t=q(o).toVar();return _(t).div(_(q(C(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),yi=P(([o])=>{const t=_(o).toVar();return t.mul(t).mul(t).mul(t.mul(t.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),iS=P(([o])=>{const t=C(o).toVar(),e=q(q(1)).toVar(),s=q(q(C(3735928559)).add(e.shiftLeft(q(2))).add(q(13))).toVar();return v0(s.add(q(t)),s,s)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),nS=P(([o,t])=>{const e=C(t).toVar(),s=C(o).toVar(),i=q(q(2)).toVar(),n=q().toVar(),r=q().toVar(),a=q().toVar();return n.assign(r.assign(a.assign(q(C(3735928559)).add(i.shiftLeft(q(2))).add(q(13))))),n.addAssign(q(s)),r.addAssign(q(e)),v0(n,r,a)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),oS=P(([o,t,e])=>{const s=C(e).toVar(),i=C(t).toVar(),n=C(o).toVar(),r=q(q(3)).toVar(),a=q().toVar(),c=q().toVar(),l=q().toVar();return a.assign(c.assign(l.assign(q(C(3735928559)).add(r.shiftLeft(q(2))).add(q(13))))),a.addAssign(q(n)),c.addAssign(q(i)),l.addAssign(q(s)),v0(a,c,l)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),rS=P(([o,t,e,s])=>{const i=C(s).toVar(),n=C(e).toVar(),r=C(t).toVar(),a=C(o).toVar(),c=q(q(4)).toVar(),l=q().toVar(),u=q().toVar(),p=q().toVar();return l.assign(u.assign(p.assign(q(C(3735928559)).add(c.shiftLeft(q(2))).add(q(13))))),l.addAssign(q(a)),u.addAssign(q(r)),p.addAssign(q(n)),ad(l,u,p),l.addAssign(q(i)),v0(l,u,p)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),aS=P(([o,t,e,s,i])=>{const n=C(i).toVar(),r=C(s).toVar(),a=C(e).toVar(),c=C(t).toVar(),l=C(o).toVar(),u=q(q(5)).toVar(),p=q().toVar(),h=q().toVar(),d=q().toVar();return p.assign(h.assign(d.assign(q(C(3735928559)).add(u.shiftLeft(q(2))).add(q(13))))),p.addAssign(q(l)),h.addAssign(q(c)),d.addAssign(q(a)),ad(p,h,d),p.addAssign(q(r)),h.addAssign(q(n)),v0(p,h,d)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),Dt=Le([iS,nS,oS,rS,aS]),cS=P(([o,t])=>{const e=C(t).toVar(),s=C(o).toVar(),i=q(Dt(s,e)).toVar(),n=Or().toVar();return n.x.assign(i.bitAnd(C(255))),n.y.assign(i.shiftRight(C(8)).bitAnd(C(255))),n.z.assign(i.shiftRight(C(16)).bitAnd(C(255))),n}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),lS=P(([o,t,e])=>{const s=C(e).toVar(),i=C(t).toVar(),n=C(o).toVar(),r=q(Dt(n,i,s)).toVar(),a=Or().toVar();return a.x.assign(r.bitAnd(C(255))),a.y.assign(r.shiftRight(C(8)).bitAnd(C(255))),a.z.assign(r.shiftRight(C(16)).bitAnd(C(255))),a}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Rs=Le([cS,lS]),uS=P(([o])=>{const t=G(o).toVar(),e=C().toVar(),s=C().toVar(),i=_(Zt(t.x,e)).toVar(),n=_(Zt(t.y,s)).toVar(),r=_(yi(i)).toVar(),a=_(yi(n)).toVar(),c=_(id(Ce(Dt(e,s),i,n),Ce(Dt(e.add(C(1)),s),i.sub(1),n),Ce(Dt(e,s.add(C(1))),i,n.sub(1)),Ce(Dt(e.add(C(1)),s.add(C(1))),i.sub(1),n.sub(1)),r,a)).toVar();return od(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),pS=P(([o])=>{const t=D(o).toVar(),e=C().toVar(),s=C().toVar(),i=C().toVar(),n=_(Zt(t.x,e)).toVar(),r=_(Zt(t.y,s)).toVar(),a=_(Zt(t.z,i)).toVar(),c=_(yi(n)).toVar(),l=_(yi(r)).toVar(),u=_(yi(a)).toVar(),p=_(nd(Ce(Dt(e,s,i),n,r,a),Ce(Dt(e.add(C(1)),s,i),n.sub(1),r,a),Ce(Dt(e,s.add(C(1)),i),n,r.sub(1),a),Ce(Dt(e.add(C(1)),s.add(C(1)),i),n.sub(1),r.sub(1),a),Ce(Dt(e,s,i.add(C(1))),n,r,a.sub(1)),Ce(Dt(e.add(C(1)),s,i.add(C(1))),n.sub(1),r,a.sub(1)),Ce(Dt(e,s.add(C(1)),i.add(C(1))),n,r.sub(1),a.sub(1)),Ce(Dt(e.add(C(1)),s.add(C(1)),i.add(C(1))),n.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return rd(p)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),ch=Le([uS,pS]),hS=P(([o])=>{const t=G(o).toVar(),e=C().toVar(),s=C().toVar(),i=_(Zt(t.x,e)).toVar(),n=_(Zt(t.y,s)).toVar(),r=_(yi(i)).toVar(),a=_(yi(n)).toVar(),c=D(id(Fs(Rs(e,s),i,n),Fs(Rs(e.add(C(1)),s),i.sub(1),n),Fs(Rs(e,s.add(C(1))),i,n.sub(1)),Fs(Rs(e.add(C(1)),s.add(C(1))),i.sub(1),n.sub(1)),r,a)).toVar();return od(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),dS=P(([o])=>{const t=D(o).toVar(),e=C().toVar(),s=C().toVar(),i=C().toVar(),n=_(Zt(t.x,e)).toVar(),r=_(Zt(t.y,s)).toVar(),a=_(Zt(t.z,i)).toVar(),c=_(yi(n)).toVar(),l=_(yi(r)).toVar(),u=_(yi(a)).toVar(),p=D(nd(Fs(Rs(e,s,i),n,r,a),Fs(Rs(e.add(C(1)),s,i),n.sub(1),r,a),Fs(Rs(e,s.add(C(1)),i),n,r.sub(1),a),Fs(Rs(e.add(C(1)),s.add(C(1)),i),n.sub(1),r.sub(1),a),Fs(Rs(e,s,i.add(C(1))),n,r,a.sub(1)),Fs(Rs(e.add(C(1)),s,i.add(C(1))),n.sub(1),r,a.sub(1)),Fs(Rs(e,s.add(C(1)),i.add(C(1))),n,r.sub(1),a.sub(1)),Fs(Rs(e.add(C(1)),s.add(C(1)),i.add(C(1))),n.sub(1),r.sub(1),a.sub(1)),c,l,u)).toVar();return rd(p)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),lh=Le([hS,dS]),gS=P(([o])=>{const t=_(o).toVar(),e=C(ge(t)).toVar();return He(Dt(e))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),fS=P(([o])=>{const t=G(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar();return He(Dt(e,s))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),mS=P(([o])=>{const t=D(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar(),i=C(ge(t.z)).toVar();return He(Dt(e,s,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),yS=P(([o])=>{const t=J(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar(),i=C(ge(t.z)).toVar(),n=C(ge(t.w)).toVar();return He(Dt(e,s,i,n))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),xS=Le([gS,fS,mS,yS]),wS=P(([o])=>{const t=_(o).toVar(),e=C(ge(t)).toVar();return D(He(Dt(e,C(0))),He(Dt(e,C(1))),He(Dt(e,C(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),bS=P(([o])=>{const t=G(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar();return D(He(Dt(e,s,C(0))),He(Dt(e,s,C(1))),He(Dt(e,s,C(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),vS=P(([o])=>{const t=D(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar(),i=C(ge(t.z)).toVar();return D(He(Dt(e,s,i,C(0))),He(Dt(e,s,i,C(1))),He(Dt(e,s,i,C(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),_S=P(([o])=>{const t=J(o).toVar(),e=C(ge(t.x)).toVar(),s=C(ge(t.y)).toVar(),i=C(ge(t.z)).toVar(),n=C(ge(t.w)).toVar();return D(He(Dt(e,s,i,n,C(0))),He(Dt(e,s,i,n,C(1))),He(Dt(e,s,i,n,C(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),cd=Le([wS,bS,vS,_S]),ol=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=C(t).toVar(),a=D(o).toVar(),c=_(0).toVar(),l=_(1).toVar();return Nt(r,()=>{c.addAssign(l.mul(ch(a))),l.mulAssign(i),a.mulAssign(n)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),ld=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=C(t).toVar(),a=D(o).toVar(),c=D(0).toVar(),l=_(1).toVar();return Nt(r,()=>{c.addAssign(l.mul(lh(a))),l.mulAssign(i),a.mulAssign(n)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),SS=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=C(t).toVar(),a=D(o).toVar();return G(ol(a,r,n,i),ol(a.add(D(C(19),C(193),C(17))),r,n,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),TS=P(([o,t,e,s])=>{const i=_(s).toVar(),n=_(e).toVar(),r=C(t).toVar(),a=D(o).toVar(),c=D(ld(a,r,n,i)).toVar(),l=_(ol(a.add(D(C(19),C(193),C(17))),r,n,i)).toVar();return J(c,l)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),MS=P(([o,t,e,s,i,n,r])=>{const a=C(r).toVar(),c=_(n).toVar(),l=C(i).toVar(),u=C(s).toVar(),p=C(e).toVar(),h=C(t).toVar(),d=G(o).toVar(),g=D(cd(G(h.add(u),p.add(l)))).toVar(),f=G(g.x,g.y).toVar();f.subAssign(.5),f.mulAssign(c),f.addAssign(.5);const m=G(G(_(h),_(p)).add(f)).toVar(),x=G(m.sub(d)).toVar();return pt(a.equal(C(2)),()=>Ot(x.x).add(Ot(x.y))),pt(a.equal(C(3)),()=>le(Ot(x.x),Ot(x.y))),kn(x,x)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),AS=P(([o,t,e,s,i,n,r,a,c])=>{const l=C(c).toVar(),u=_(a).toVar(),p=C(r).toVar(),h=C(n).toVar(),d=C(i).toVar(),g=C(s).toVar(),f=C(e).toVar(),m=C(t).toVar(),x=D(o).toVar(),w=D(cd(D(m.add(d),f.add(h),g.add(p)))).toVar();w.subAssign(.5),w.mulAssign(u),w.addAssign(.5);const b=D(D(_(m),_(f),_(g)).add(w)).toVar(),v=D(b.sub(x)).toVar();return pt(l.equal(C(2)),()=>Ot(v.x).add(Ot(v.y)).add(Ot(v.z))),pt(l.equal(C(3)),()=>le(le(Ot(v.x),Ot(v.y)),Ot(v.z))),kn(v,v)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),$r=Le([MS,AS]),NS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=G(o).toVar(),r=C().toVar(),a=C().toVar(),c=G(Zt(n.x,r),Zt(n.y,a)).toVar(),l=_(1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:u})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:p})=>{const h=_($r(c,u,p,r,a,i,s)).toVar();l.assign(ps(l,h))})}),pt(s.equal(C(0)),()=>{l.assign(Ai(l))}),l}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),CS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=G(o).toVar(),r=C().toVar(),a=C().toVar(),c=G(Zt(n.x,r),Zt(n.y,a)).toVar(),l=G(1e6,1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:u})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:p})=>{const h=_($r(c,u,p,r,a,i,s)).toVar();pt(h.lessThan(l.x),()=>{l.y.assign(l.x),l.x.assign(h)}).ElseIf(h.lessThan(l.y),()=>{l.y.assign(h)})})}),pt(s.equal(C(0)),()=>{l.assign(Ai(l))}),l}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),FS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=G(o).toVar(),r=C().toVar(),a=C().toVar(),c=G(Zt(n.x,r),Zt(n.y,a)).toVar(),l=D(1e6,1e6,1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:u})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:p})=>{const h=_($r(c,u,p,r,a,i,s)).toVar();pt(h.lessThan(l.x),()=>{l.z.assign(l.y),l.y.assign(l.x),l.x.assign(h)}).ElseIf(h.lessThan(l.y),()=>{l.z.assign(l.y),l.y.assign(h)}).ElseIf(h.lessThan(l.z),()=>{l.z.assign(h)})})}),pt(s.equal(C(0)),()=>{l.assign(Ai(l))}),l}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),RS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=D(o).toVar(),r=C().toVar(),a=C().toVar(),c=C().toVar(),l=D(Zt(n.x,r),Zt(n.y,a),Zt(n.z,c)).toVar(),u=_(1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:p})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:h})=>{Nt({start:-1,end:C(1),name:"z",condition:"<="},({z:d})=>{const g=_($r(l,p,h,d,r,a,c,i,s)).toVar();u.assign(ps(u,g))})})}),pt(s.equal(C(0)),()=>{u.assign(Ai(u))}),u}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ES=Le([NS,RS]),DS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=D(o).toVar(),r=C().toVar(),a=C().toVar(),c=C().toVar(),l=D(Zt(n.x,r),Zt(n.y,a),Zt(n.z,c)).toVar(),u=G(1e6,1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:p})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:h})=>{Nt({start:-1,end:C(1),name:"z",condition:"<="},({z:d})=>{const g=_($r(l,p,h,d,r,a,c,i,s)).toVar();pt(g.lessThan(u.x),()=>{u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.y.assign(g)})})})}),pt(s.equal(C(0)),()=>{u.assign(Ai(u))}),u}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),BS=Le([CS,DS]),PS=P(([o,t,e])=>{const s=C(e).toVar(),i=_(t).toVar(),n=D(o).toVar(),r=C().toVar(),a=C().toVar(),c=C().toVar(),l=D(Zt(n.x,r),Zt(n.y,a),Zt(n.z,c)).toVar(),u=D(1e6,1e6,1e6).toVar();return Nt({start:-1,end:C(1),name:"x",condition:"<="},({x:p})=>{Nt({start:-1,end:C(1),name:"y",condition:"<="},({y:h})=>{Nt({start:-1,end:C(1),name:"z",condition:"<="},({z:d})=>{const g=_($r(l,p,h,d,r,a,c,i,s)).toVar();pt(g.lessThan(u.x),()=>{u.z.assign(u.y),u.y.assign(u.x),u.x.assign(g)}).ElseIf(g.lessThan(u.y),()=>{u.z.assign(u.y),u.y.assign(g)}).ElseIf(g.lessThan(u.z),()=>{u.z.assign(g)})})})}),pt(s.equal(C(0)),()=>{u.assign(Ai(u))}),u}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),IS=Le([FS,PS]),LS=P(([o])=>{const t=o.y,e=o.z,s=D().toVar();return pt(t.lessThan(1e-4),()=>{s.assign(D(e,e,e))}).Else(()=>{let i=o.x;i=i.sub(mi(i)).mul(6).toVar();const n=C(A2(i)),r=i.sub(_(n)),a=e.mul(t.oneMinus()),c=e.mul(t.mul(r).oneMinus()),l=e.mul(t.mul(r.oneMinus()).oneMinus());pt(n.equal(C(0)),()=>{s.assign(D(e,l,a))}).ElseIf(n.equal(C(1)),()=>{s.assign(D(c,e,a))}).ElseIf(n.equal(C(2)),()=>{s.assign(D(a,e,l))}).ElseIf(n.equal(C(3)),()=>{s.assign(D(a,c,e))}).ElseIf(n.equal(C(4)),()=>{s.assign(D(l,a,e))}).Else(()=>{s.assign(D(e,a,c))})}),s}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),US=P(([o])=>{const t=D(o).toVar(),e=_(t.x).toVar(),s=_(t.y).toVar(),i=_(t.z).toVar(),n=_(ps(e,ps(s,i))).toVar(),r=_(le(e,le(s,i))).toVar(),a=_(r.sub(n)).toVar(),c=_().toVar(),l=_().toVar(),u=_().toVar();return u.assign(r),pt(r.greaterThan(0),()=>{l.assign(a.div(r))}).Else(()=>{l.assign(0)}),pt(l.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{pt(e.greaterThanEqual(r),()=>{c.assign(s.sub(i).div(a))}).ElseIf(s.greaterThanEqual(r),()=>{c.assign(fe(2,i.sub(e).div(a)))}).Else(()=>{c.assign(fe(4,e.sub(s).div(a)))}),c.mulAssign(1/6),pt(c.lessThan(0),()=>{c.addAssign(1)})}),D(c,l,u)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),zS=P(([o])=>{const t=D(o).toVar(),e=p2(v2(t,D(.04045))).toVar(),s=D(t.div(12.92)).toVar(),i=D(Ks(le(t.add(D(.055)),D(0)).div(1.055),D(2.4))).toVar();return Mt(s,i,e)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),ud=(o,t)=>{o=_(o),t=_(t);const e=G(t.dFdx(),t.dFdy()).length().mul(.7071067811865476);return Ji(o.sub(e),o.add(e),t)},pd=(o,t,e,s)=>Mt(o,t,e[s].clamp()),kS=(o,t,e=ee())=>pd(o,t,e,"x"),VS=(o,t,e=ee())=>pd(o,t,e,"y"),hd=(o,t,e,s,i)=>Mt(o,t,ud(e,s[i])),GS=(o,t,e,s=ee())=>hd(o,t,e,s,"x"),OS=(o,t,e,s=ee())=>hd(o,t,e,s,"y"),WS=(o=1,t=0,e=ee())=>e.mul(o).add(t),$S=(o,t=1)=>(o=_(o),o.abs().pow(t).mul(o.sign())),HS=(o,t=1,e=.5)=>_(o).sub(e).mul(t).add(e),qS=(o=ee(),t=1,e=0)=>ch(o.convert("vec2|vec3")).mul(t).add(e),YS=(o=ee(),t=1,e=0)=>lh(o.convert("vec2|vec3")).mul(t).add(e),XS=(o=ee(),t=1,e=0)=>(o=o.convert("vec2|vec3"),J(lh(o),ch(o.add(G(19,73)))).mul(t).add(e)),ZS=(o=ee(),t=1)=>ES(o.convert("vec2|vec3"),t,C(1)),jS=(o=ee(),t=1)=>BS(o.convert("vec2|vec3"),t,C(1)),KS=(o=ee(),t=1)=>IS(o.convert("vec2|vec3"),t,C(1)),JS=(o=ee())=>xS(o.convert("vec2|vec3")),QS=(o=ee(),t=3,e=2,s=.5,i=1)=>ol(o,C(t),e,s).mul(i),tT=(o=ee(),t=3,e=2,s=.5,i=1)=>SS(o,C(t),e,s).mul(i),eT=(o=ee(),t=3,e=2,s=.5,i=1)=>ld(o,C(t),e,s).mul(i),sT=(o=ee(),t=3,e=2,s=.5,i=1)=>TS(o,C(t),e,s).mul(i),iT=P(([o,t,e])=>{const s=Ki(o).toVar("nDir"),i=wt(_(.5).mul(t.sub(e)),qi).div(s).toVar("rbmax"),n=wt(_(-.5).mul(t.sub(e)),qi).div(s).toVar("rbmin"),r=D().toVar("rbminmax");r.x=s.x.greaterThan(_(0)).select(i.x,n.x),r.y=s.y.greaterThan(_(0)).select(i.y,n.y),r.z=s.z.greaterThan(_(0)).select(i.z,n.z);const a=ps(ps(r.x,r.y),r.z).toVar("correction");return qi.add(s.mul(a)).toVar("boxIntersection").sub(e)}),dd=P(([o,t])=>{const e=o.x,s=o.y,i=o.z;let n=t.element(0).mul(.886227);return n=n.add(t.element(1).mul(2*.511664).mul(s)),n=n.add(t.element(2).mul(2*.511664).mul(i)),n=n.add(t.element(3).mul(2*.511664).mul(e)),n=n.add(t.element(4).mul(2*.429043).mul(e).mul(s)),n=n.add(t.element(5).mul(2*.429043).mul(s).mul(i)),n=n.add(t.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),n=n.add(t.element(7).mul(2*.429043).mul(e).mul(i)),n=n.add(t.element(8).mul(.429043).mul(ct(e,e).sub(ct(s,s)))),n});var y=Object.freeze({__proto__:null,BRDF_GGX:hp,BRDF_Lambert:bo,BasicShadowFilter:j9,Break:H7,Continue:dx,DFGApprox:Z2,D_GGX:r9,Discard:V6,EPSILON:O8,F_Schlick:Lr,Fn:P,INFINITY:oy,If:pt,Loop:Nt,NodeAccess:Oe,NodeShaderStage:ep,NodeType:Im,NodeUpdateType:rt,PCFShadowFilter:K9,PCFSoftShadowFilter:J9,PI:Jc,PI2:ry,Return:wy,Schlick_to_F0:c9,ScriptableNodeResources:Dc,ShaderNode:Fa,TBNViewMatrix:oo,VSMShadowFilter:Q9,V_GGX_SmithCorrelated:o9,abs:Ot,acesFilmicToneMapping:V9,acos:j8,add:fe,addMethodChaining:z,addNodeElement:vy,agxToneMapping:G9,all:_2,alphaT:Zc,and:E8,anisotropy:dn,anisotropyB:lo,anisotropyT:Ra,any:W8,append:l8,arrayBuffer:ty,asin:Z8,assign:T8,atan:K8,atan2:n6,atomicAdd:v_,atomicAnd:M_,atomicFunc:en,atomicMax:S_,atomicMin:T_,atomicOr:A_,atomicStore:b_,atomicSub:__,atomicXor:N_,attenuationColor:x2,attenuationDistance:y2,attribute:bi,attributeArray:hv,backgroundBlurriness:C9,backgroundIntensity:xp,backgroundRotation:F9,batch:O7,billboarding:$b,bitAnd:I8,bitNot:L8,bitOr:U8,bitXor:z8,bitangentGeometry:qy,bitangentLocal:Yy,bitangentView:i7,bitangentWorld:Xy,bitcast:ay,blendBurn:D9,blendColor:Tv,blendDodge:B9,blendOverlay:I9,blendScreen:P9,blur:f9,bool:ji,buffer:d0,bufferAttribute:p0,bumpMap:a7,burn:Mv,bvec2:h8,bvec3:p2,bvec4:m8,bypass:I6,cache:Da,call:M8,cameraFar:xn,cameraNear:yn,cameraNormalMatrix:Ny,cameraPosition:$6,cameraProjectionMatrix:Dn,cameraProjectionMatrixInverse:My,cameraViewMatrix:ms,cameraWorldMatrix:Ay,cbrt:p6,cdl:Pv,ceil:El,checker:$_,cineonToneMapping:k9,clamp:wi,clearcoat:Xc,clearcoatRoughness:ja,code:ql,color:u8,colorSpaceToWorking:E2,colorToDirection:Ox,compute:P6,cond:x6,context:Pl,convert:x8,convertColorSpace:uy,convertToTexture:iv,cos:Ii,cross:Bl,cubeTexture:Ir,dFdx:T2,dFdy:M2,dashSize:Cc,defaultBuildStages:sp,defaultShaderStages:i8,defined:qa,degrees:q8,deltaTime:M9,densityFog:Y9,depth:H2,depthPass:Vv,difference:a6,diffuseColor:Tt,directPointLight:sd,directionToColor:J7,dispersion:w2,distance:r6,div:si,dodge:Av,dot:kn,drawIndex:k7,dynamicBufferAttribute:B6,element:y8,emissive:rp,equal:A8,equals:$8,equirectUV:q2,exp:S2,exp2:Pr,expression:En,faceDirection:h0,faceForward:g6,float:_,floor:mi,fog:s_,fract:tn,frameGroup:v8,frameId:Pb,frontFacing:Y6,fwidth:s6,gain:Cb,gapSize:ap,getConstNodeType:c8,getCurrentStack:u2,getDirection:d9,getDistanceAttenuation:ah,getGeometryRoughness:n9,getNormalFromDepth:ov,getParallaxCorrectNormal:iT,getRoughness:X2,getScreenPosition:nv,getShIrradianceAt:dd,getTextureIndex:_9,getViewPosition:cr,glsl:Zv,glslFn:jv,grayscale:Fv,greaterThan:v2,greaterThanEqual:R8,hash:Nb,highPrecisionModelNormalViewMatrix:zy,highPrecisionModelViewMatrix:Uy,hue:Dv,instance:cx,instanceIndex:y0,instancedArray:dv,instancedBufferAttribute:Qc,instancedDynamicBufferAttribute:cp,instancedMesh:G7,int:C,inverseSqrt:Y8,invocationLocalIndex:ax,invocationSubgroupIndex:rx,ior:Ea,iridescence:Fl,iridescenceIOR:g2,iridescenceThickness:f2,ivec2:Me,ivec3:d8,ivec4:g8,js:Yv,label:b6,length:Hi,lengthSq:h6,lessThan:C8,lessThanEqual:F8,lightPosition:nh,lightProjectionUV:X9,lightShadowMatrix:ih,lightTargetDirection:oh,lightTargetPosition:Z9,lightViewPosition:Xl,lightingContext:Y7,lights:R_,linearDepth:el,linearToneMapping:U9,localId:u_,log:Rl,log2:fi,logarithmicDepthToViewZ:Nx,loop:gx,luminance:Hl,mat2:Nl,mat3:qe,mat4:co,matcapUV:m9,materialAOMap:U7,materialAlphaTest:c7,materialAnisotropy:S7,materialAnisotropyVector:ar,materialAttenuationColor:E7,materialAttenuationDistance:R7,materialClearcoat:y7,materialClearcoatNormal:w7,materialClearcoatRoughness:x7,materialColor:l7,materialDispersion:L7,materialEmissive:p7,materialIOR:F7,materialIridescence:T7,materialIridescenceIOR:M7,materialIridescenceThickness:A7,materialLightMap:z2,materialLineDashOffset:I7,materialLineDashSize:B7,materialLineGapSize:P7,materialLineScale:D7,materialLineWidth:sx,materialMetalness:f7,materialNormal:m7,materialOpacity:U2,materialPointWidth:ix,materialReference:zi,materialReflectivity:Fc,materialRefractionRatio:j6,materialRotation:b7,materialRoughness:g7,materialSheen:v7,materialSheenRoughness:_7,materialShininess:u7,materialSpecular:h7,materialSpecularColor:d7,materialSpecularIntensity:pp,materialSpecularStrength:Ba,materialThickness:C7,materialTransmission:N7,max:le,maxMipLevel:W6,metalness:Za,min:ps,mix:Mt,mixElement:m6,mod:N2,modInt:b2,modelDirection:Dy,modelNormalMatrix:q6,modelPosition:By,modelScale:Py,modelViewMatrix:Co,modelViewPosition:Iy,modelViewProjection:k2,modelWorldMatrix:Is,modelWorldMatrixInverse:Ly,morphReference:q7,mrt:S9,mul:ct,mx_aastep:ud,mx_cell_noise_float:JS,mx_contrast:HS,mx_fractal_noise_float:QS,mx_fractal_noise_vec2:tT,mx_fractal_noise_vec3:eT,mx_fractal_noise_vec4:sT,mx_hsvtorgb:LS,mx_noise_float:qS,mx_noise_vec3:YS,mx_noise_vec4:XS,mx_ramplr:kS,mx_ramptb:VS,mx_rgbtohsv:US,mx_safepower:$S,mx_splitlr:GS,mx_splittb:OS,mx_srgb_texture_to_lin_rec709:zS,mx_transform_uv:WS,mx_worley_noise_float:ZS,mx_worley_noise_vec2:jS,mx_worley_noise_vec3:KS,negate:J8,neutralToneMapping:O9,nodeArray:ao,nodeImmutable:H,nodeObject:k,nodeObjects:a0,nodeProxy:L,normalFlat:X6,normalGeometry:Il,normalLocal:hs,normalMap:up,normalView:ks,normalWorld:Ll,normalize:Ki,not:B8,notEqual:N8,numWorkgroups:c_,objectDirection:Cy,objectGroup:d2,objectPosition:H6,objectScale:Ry,objectViewPosition:Ey,objectWorldMatrix:Fy,oneMinus:Q8,or:D8,orthographicDepthToViewZ:Ax,oscSawtooth:Gb,oscSine:zb,oscSquare:kb,oscTriangle:Vb,output:S8,outputStruct:Mb,overlay:Cv,overloadingFn:Le,parabola:yp,parallaxDirection:o7,parallaxUV:jy,parameter:_b,pass:zv,passTexture:kv,pcurve:Fb,perspectiveDepthToViewZ:W2,pmremTexture:j2,pointUV:yv,pointWidth:sy,positionGeometry:D2,positionLocal:re,positionPrevious:tl,positionView:be,positionViewDirection:qt,positionWorld:qi,positionWorldDirection:B2,posterize:Lv,pow:Ks,pow2:C2,pow3:c6,pow4:l6,property:_8,radians:H8,rand:f6,range:r_,rangeFog:q9,reciprocal:e6,reference:Et,referenceBuffer:lp,reflect:o6,reflectVector:Q6,reflectView:K6,reflector:Jb,refract:F2,refractVector:t7,refractView:J6,reinhardToneMapping:z9,remainder:G8,remap:U6,remapClamp:z6,renderGroup:st,renderOutput:G6,rendererReference:R6,rotate:K2,rotateUV:Ob,roughness:pi,round:t6,rtt:N9,sRGBTransferEOTF:T6,sRGBTransferOETF:M6,sampler:Ty,saturate:d6,saturation:Rv,screen:Nv,screenCoordinate:x0,screenSize:Qa,screenUV:Si,scriptable:e_,scriptableValue:Ec,select:Ie,setCurrentStack:Ya,shaderStages:ip,shadow:ed,sharedUniformGroup:h2,sheen:no,sheenRoughness:Cl,shiftLeft:k8,shiftRight:V8,shininess:jc,sign:Ja,sin:Ss,sinc:Rb,skinning:px,skinningReference:$7,smoothstep:Ji,smoothstepElement:y6,specularColor:ss,specularF90:Ka,spherizeUV:Wb,split:ey,spritesheetUV:Yb,sqrt:Ai,stack:Rc,step:Dl,storage:$l,storageBarrier:g_,storageObject:pv,storageTexture:R9,string:Qm,sub:wt,subgroupIndex:ox,subgroupSize:p_,tan:X8,tangentGeometry:kl,tangentLocal:g0,tangentView:f0,tangentWorld:s7,temp:S6,texture:yt,texture3D:Kw,textureBarrier:f_,textureBicubic:p9,textureCubeUV:g9,textureLoad:ae,textureSize:uo,textureStore:wv,thickness:m2,threshold:Bv,time:Fo,timerDelta:Ub,timerGlobal:Lb,timerLocal:Ib,toOutputColorSpace:A6,toWorkingColorSpace:N6,toneMapping:E6,toneMappingExposure:D6,toonOutlinePass:Ov,transformDirection:u6,transformNormal:Z6,transformNormalToView:P2,transformedBentNormalView:r7,transformedBitangentView:n7,transformedBitangentWorld:Zy,transformedClearcoatNormalView:mr,transformedNormalView:ce,transformedNormalWorld:Ul,transformedTangentView:L2,transformedTangentWorld:Hy,transmission:Kc,transpose:i6,tri:ui,tri3:T9,triNoise3D:Eb,triplanarTexture:Zb,triplanarTextures:A9,trunc:A2,tslFn:Jm,uint:q,uniform:Q,uniformArray:Ui,uniformGroup:b8,uniforms:Oy,userData:vv,uv:ee,uvec2:p8,uvec3:Or,uvec4:f8,varying:fs,varyingProperty:Xa,vec2:G,vec3:D,vec4:J,vectorComponents:Ao,velocity:Sv,vertexColor:fv,vertexIndex:z7,vibrance:Ev,viewZToLogarithmicDepth:$2,viewZToOrthographicDepth:Ar,viewZToPerspectiveDepth:j7,viewport:V2,viewportBottomLeft:Sx,viewportCoordinate:Z7,viewportDepthTexture:O2,viewportLinearDepth:Cx,viewportMipTexture:G2,viewportResolution:vx,viewportSafeUV:Hb,viewportSharedTexture:Gx,viewportSize:X7,viewportTexture:Tx,viewportTopLeft:_x,viewportUV:bx,wgsl:Xv,wgslFn:Kv,workgroupArray:x_,workgroupBarrier:d_,workgroupId:l_,workingToColorSpace:C6,xor:P8});const Di=new J2;class nT extends Vn{constructor(t,e){super(),this.renderer=t,this.nodes=e}update(t,e,s){const i=this.renderer,n=this.nodes.getBackgroundNode(t)||t.background;let r=!1;if(n===null)i._clearColor.getRGB(Di,Oi),Di.a=i._clearColor.a;else if(n.isColor===!0)n.getRGB(Di,Oi),Di.a=1,r=!0;else if(n.isNode===!0){const a=this.get(t),c=n;Di.copy(i._clearColor);let l=a.backgroundMesh;if(l===void 0){const p=Pl(J(c).mul(xp),{getUV:()=>F9.mul(Ll),getTextureLevel:()=>C9});let h=k2();h=h.setZ(h.w);const d=new ue;d.name="Background.material",d.side=ls,d.depthTest=!1,d.depthWrite=!1,d.fog=!1,d.lights=!1,d.vertexNode=h,d.colorNode=p,a.backgroundMeshNode=p,a.backgroundMesh=l=new V(new ne(1,32,32),d),l.frustumCulled=!1,l.name="Background.mesh",l.onBeforeRender=function(g,f,m){this.matrixWorld.copyPosition(m.matrixWorld)}}const u=c.getCacheKey();a.backgroundCacheKey!==u&&(a.backgroundMeshNode.node=J(c).mul(xp),a.backgroundMeshNode.needsUpdate=!0,l.material.needsUpdate=!0,a.backgroundCacheKey=u),e.unshift(l,l.geometry,l.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",n);if(i.autoClear===!0||r===!0){const a=s.clearColorValue;a.r=Di.r,a.g=Di.g,a.b=Di.b,a.a=Di.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(a.r*=a.a,a.g*=a.a,a.b*=a.a),s.depthClearValue=i._clearDepth,s.stencilClearValue=i._clearStencil,s.clearColor=i.autoClearColor===!0,s.clearDepth=i.autoClearDepth===!0,s.clearStencil=i.autoClearStencil===!0}else s.clearColor=!1,s.clearDepth=!1,s.clearStencil=!1}}let oT=0;class wp{constructor(t="",e=[],s=0,i=[]){this.name=t,this.bindings=e,this.index=s,this.bindingsReference=i,this.id=oT++}}class rT{constructor(t,e,s,i,n,r,a,c,l,u=[]){this.vertexShader=t,this.fragmentShader=e,this.computeShader=s,this.transforms=u,this.nodeAttributes=i,this.bindings=n,this.updateNodes=r,this.updateBeforeNodes=a,this.updateAfterNodes=c,this.monitor=l,this.usedTimes=0}createBindings(){const t=[];for(const e of this.bindings)if(e.bindings[0].groupNode.shared!==!0){const i=new wp(e.name,[],e.index,e);t.push(i);for(const n of e.bindings)i.bindings.push(n.clone())}else t.push(e);return t}}class H3{constructor(t,e,s=null){this.isNodeAttribute=!0,this.name=t,this.type=e,this.node=s}}class aT{constructor(t,e,s){this.isNodeUniform=!0,this.name=t,this.type=e,this.node=s.getSelf()}get value(){return this.node.value}set value(t){this.node.value=t}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class gd{constructor(t,e){this.isNodeVar=!0,this.name=t,this.type=e}}class cT extends gd{constructor(t,e){super(t,e),this.needsInterpolation=!1,this.isNodeVarying=!0}}class lT{constructor(t,e,s=""){this.name=t,this.type=e,this.code=s,Object.defineProperty(this,"isNodeCode",{value:!0})}}let uT=0;class H1{constructor(t=null){this.id=uT++,this.nodesData=new WeakMap,this.parent=t}getData(t){let e=this.nodesData.get(t);return e===void 0&&this.parent!==null&&(e=this.parent.getData(t)),e}setData(t,e){this.nodesData.set(t,e)}}class Eo{constructor(t,e){this.name=t,this.value=e,this.boundary=0,this.itemSize=0,this.offset=0}setValue(t){this.value=t}getValue(){return this.value}}class pT extends Eo{constructor(t,e=0){super(t,e),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class hT extends Eo{constructor(t,e=new Y){super(t,e),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class dT extends Eo{constructor(t,e=new S){super(t,e),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class gT extends Eo{constructor(t,e=new vt){super(t,e),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class fT extends Eo{constructor(t,e=new W){super(t,e),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class mT extends Eo{constructor(t,e=new gs){super(t,e),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class yT extends Eo{constructor(t,e=new gt){super(t,e),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class xT extends pT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class wT extends hT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class bT extends dT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class vT extends gT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class _T extends fT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class ST extends mT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class TT extends yT{constructor(t){super(t.name,t.value),this.nodeUniform=t}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const yr=4,q3=[.125,.215,.35,.446,.526,.582],eo=20,q1=new n2(-1,1,1,-1,0,1),MT=new li(90,1),Y3=new W;let Y1=null,X1=0,Z1=0;const Jn=(1+Math.sqrt(5))/2,Ko=1/Jn,X3=[new S(-Jn,Ko,0),new S(Jn,Ko,0),new S(-Ko,0,Jn),new S(Ko,0,Jn),new S(0,Jn,-Ko),new S(0,Jn,Ko),new S(-1,1,-1),new S(1,1,-1),new S(-1,1,1),new S(1,1,1)],AT=[3,1,5,0,4,2],j1=d9(ee(),bi("faceIndex")).normalize(),uh=D(j1.x,j1.y.negate(),j1.z);class NT{constructor(t){this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(t,e=0,s=.1,i=100,n=null){if(this._setSize(256),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const a=n||this._allocateTargets();return this.fromSceneAsync(t,e,s,i,a),a}Y1=this._renderer.getRenderTarget(),X1=this._renderer.getActiveCubeFace(),Z1=this._renderer.getActiveMipmapLevel();const r=n||this._allocateTargets();return r.depthBuffer=!0,this._sceneToCubeUV(t,s,i,r),e>0&&this._blur(r,0,0,e),this._applyPMREM(r),this._cleanup(r),r}async fromSceneAsync(t,e=0,s=.1,i=100,n=null){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(t,e,s,i,n)}fromEquirectangular(t,e=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(t);const s=e||this._allocateTargets();return this.fromEquirectangularAsync(t,s),s}return this._fromTexture(t,e)}async fromEquirectangularAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}fromCubemap(t,e=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(t);const s=e||this._allocateTargets();return this.fromCubemapAsync(t,e),s}return this._fromTexture(t,e)}async fromCubemapAsync(t,e=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(t,e)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=j3(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=K3(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(t){t.mapping===mo||t.mapping===Fr?this._setSize(t.image.length===0?16:t.image[0].width||t.image[0].image.width):this._setSize(t.image.width/4)}_setSize(t){this._lodMax=Math.floor(Math.log2(t)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let t=0;t<this._lodPlanes.length;t++)this._lodPlanes[t].dispose()}_cleanup(t){this._renderer.setRenderTarget(Y1,X1,Z1),t.scissorTest=!1,nc(t,0,0,t.width,t.height)}_fromTexture(t,e){this._setSizeFromTexture(t),Y1=this._renderer.getRenderTarget(),X1=this._renderer.getActiveCubeFace(),Z1=this._renderer.getActiveMipmapLevel();const s=e||this._allocateTargets();return this._textureToCubeUV(t,s),this._applyPMREM(s),this._cleanup(s),s}_allocateTargets(){const t=3*Math.max(this._cubeSize,112),e=4*this._cubeSize,s={magFilter:Je,minFilter:Je,generateMipmaps:!1,type:Qs,format:Cn,colorSpace:Oi},i=Z3(t,e,s);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==t||this._pingPongRenderTarget.height!==e){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=Z3(t,e,s);const{_lodMax:n}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=CT(n)),this._blurMaterial=FT(n,t,e)}return i}async _compileMaterial(t){const e=new V(this._lodPlanes[0],t);await this._renderer.compile(e,q1)}_sceneToCubeUV(t,e,s,i){const n=MT;n.near=e,n.far=s;const r=[-1,1,-1,-1,-1,-1],a=[1,1,1,-1,-1,-1],c=this._renderer,l=c.autoClear;c.getClearColor(Y3),c.autoClear=!1;let u=this._backgroundBox;if(u===null){const d=new gi({name:"PMREM.Background",side:ls,depthWrite:!1,depthTest:!1});u=new V(new Un,d)}let p=!1;const h=t.background;h?h.isColor&&(u.material.color.copy(h),t.background=null,p=!0):(u.material.color.copy(Y3),p=!0),c.setRenderTarget(i),c.clear(),p&&c.render(u,n);for(let d=0;d<6;d++){const g=d%3;g===0?(n.up.set(0,r[d],0),n.lookAt(a[d],0,0)):g===1?(n.up.set(0,0,r[d]),n.lookAt(0,a[d],0)):(n.up.set(0,r[d],0),n.lookAt(0,0,a[d]));const f=this._cubeSize;nc(i,g*f,d>2?f:0,f,f),c.render(t,n)}c.autoClear=l,t.background=h}_textureToCubeUV(t,e){const s=this._renderer,i=t.mapping===mo||t.mapping===Fr;i?this._cubemapMaterial===null&&(this._cubemapMaterial=j3(t)):this._equirectMaterial===null&&(this._equirectMaterial=K3(t));const n=i?this._cubemapMaterial:this._equirectMaterial;n.fragmentNode.value=t;const r=this._lodMeshes[0];r.material=n;const a=this._cubeSize;nc(e,0,0,3*a,2*a),s.setRenderTarget(e),s.render(r,q1)}_applyPMREM(t){const e=this._renderer,s=e.autoClear;e.autoClear=!1;const i=this._lodPlanes.length;for(let n=1;n<i;n++){const r=Math.sqrt(this._sigmas[n]*this._sigmas[n]-this._sigmas[n-1]*this._sigmas[n-1]),a=X3[(i-n-1)%X3.length];this._blur(t,n-1,n,r,a)}e.autoClear=s}_blur(t,e,s,i,n){const r=this._pingPongRenderTarget;this._halfBlur(t,r,e,s,i,"latitudinal",n),this._halfBlur(r,t,s,s,i,"longitudinal",n)}_halfBlur(t,e,s,i,n,r,a){const c=this._renderer,l=this._blurMaterial;r!=="latitudinal"&&r!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const u=3,p=this._lodMeshes[i];p.material=l;const h=l.uniforms,d=this._sizeLods[s]-1,g=isFinite(n)?Math.PI/(2*d):2*Math.PI/(2*eo-1),f=n/g,m=isFinite(n)?1+Math.floor(u*f):eo;m>eo&&console.warn(`sigmaRadians, ${n}, is too large and will clip, as it requested ${m} samples when the maximum is set to ${eo}`);const x=[];let w=0;for(let F=0;F<eo;++F){const N=F/f,A=Math.exp(-N*N/2);x.push(A),F===0?w+=A:F<m&&(w+=2*A)}for(let F=0;F<x.length;F++)x[F]=x[F]/w;t.texture.frame=(t.texture.frame||0)+1,h.envMap.value=t.texture,h.samples.value=m,h.weights.array=x,h.latitudinal.value=r==="latitudinal"?1:0,a&&(h.poleAxis.value=a);const{_lodMax:b}=this;h.dTheta.value=g,h.mipInt.value=b-s;const v=this._sizeLods[i],T=3*v*(i>b-yr?i-b+yr:0),M=4*(this._cubeSize-v);nc(e,T,M,3*v,2*v),c.setRenderTarget(e),c.render(p,q1)}}function CT(o){const t=[],e=[],s=[],i=[];let n=o;const r=o-yr+1+q3.length;for(let a=0;a<r;a++){const c=Math.pow(2,n);e.push(c);let l=1/c;a>o-yr?l=q3[a-o+yr-1]:a===0&&(l=0),s.push(l);const u=1/(c-2),p=-u,h=1+u,d=[p,p,h,p,h,h,p,p,h,h,p,h],g=6,f=6,m=3,x=2,w=1,b=new Float32Array(m*f*g),v=new Float32Array(x*f*g),T=new Float32Array(w*f*g);for(let F=0;F<g;F++){const N=F%3*2/3-1,A=F>2?0:-1,E=[N,A,0,N+2/3,A,0,N+2/3,A+1,0,N,A,0,N+2/3,A+1,0,N,A+1,0],U=AT[F];b.set(E,m*f*U),v.set(d,x*f*U);const $=[U,U,U,U,U,U];T.set($,w*f*U)}const M=new zt;M.setAttribute("position",new it(b,m)),M.setAttribute("uv",new it(v,x)),M.setAttribute("faceIndex",new it(T,w)),t.push(M),i.push(new V(M,null)),n>yr&&n--}return{lodPlanes:t,sizeLods:e,sigmas:s,lodMeshes:i}}function Z3(o,t,e){const s=new In(o,t,e);return s.texture.mapping=Cu,s.texture.name="PMREM.cubeUv",s.texture.isPMREMTexture=!0,s.scissorTest=!0,s}function nc(o,t,e,s,i){o.viewport.set(t,e,s,i),o.scissor.set(t,e,s,i)}function ph(o){const t=new ue;return t.depthTest=!1,t.depthWrite=!1,t.blending=fo,t.name=`PMREM_${o}`,t}function FT(o,t,e){const s=Ui(new Array(eo).fill(0)),i=Q(new S(0,1,0)),n=Q(0),r=_(eo),a=Q(0),c=Q(1),l=yt(null),u=Q(0),p=_(1/t),h=_(1/e),d=_(o),g={n:r,latitudinal:a,weights:s,poleAxis:i,outputDirection:uh,dTheta:n,samples:c,envMap:l,mipInt:u,CUBEUV_TEXEL_WIDTH:p,CUBEUV_TEXEL_HEIGHT:h,CUBEUV_MAX_MIP:d},f=ph("blur");return f.uniforms=g,f.fragmentNode=f9({...g,latitudinal:a.equal(1)}),f}function j3(o){const t=ph("cubemap");return t.fragmentNode=Ir(o,uh),t}function K3(o){const t=ph("equirect");return t.fragmentNode=yt(o,q2(uh),0),t}const J3=new WeakMap,RT=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),oc=o=>/e/g.test(o)?String(o).replace(/\+/g,""):(o=Number(o),o+(o%1?"":".0"));class fd{constructor(t,e,s){this.object=t,this.material=t&&t.material||null,this.geometry=t&&t.geometry||null,this.renderer=e,this.parser=s,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.monitor=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.flow={code:""},this.chaining=[],this.stack=Rc(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new H1,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null,this.useComparisonMethod=!1}getBindGroupsCache(){let t=J3.get(this.renderer);return t===void 0&&(t=new Ti,J3.set(this.renderer,t)),t}createRenderTarget(t,e,s){return new In(t,e,s)}createCubeRenderTarget(t,e){return new Q7(t,e)}createPMREMGenerator(){return new NT(this.renderer)}includes(t){return this.nodes.includes(t)}_getBindGroup(t,e){const s=this.getBindGroupsCache(),i=[];let n=!0;for(const a of e)i.push(a),n=n&&a.groupNode.shared!==!0;let r;return n?(r=s.get(i),r===void 0&&(r=new wp(t,i,this.bindingsIndexes[t].group,i),s.set(i,r))):r=new wp(t,i,this.bindingsIndexes[t].group,i),r}getBindGroupArray(t,e){const s=this.bindings[e];let i=s[t];return i===void 0&&(this.bindingsIndexes[t]===void 0&&(this.bindingsIndexes[t]={binding:0,group:Object.keys(this.bindingsIndexes).length}),s[t]=i=[]),i}getBindings(){let t=this.bindGroups;if(t===null){const e={},s=this.bindings;for(const i of ip)for(const n in s[i]){const r=s[i][n];(e[n]||(e[n]=[])).push(...r)}t=[];for(const i in e){const n=e[i],r=this._getBindGroup(i,n);t.push(r)}this.bindGroups=t}return t}sortBindingGroups(){const t=this.getBindings();t.sort((e,s)=>e.bindings[0].groupNode.order-s.bindings[0].groupNode.order);for(let e=0;e<t.length;e++){const s=t[e];this.bindingsIndexes[s.name].group=e,s.index=e}}setHashNode(t,e){this.hashNodes[e]=t}addNode(t){this.nodes.includes(t)===!1&&(this.nodes.push(t),this.setHashNode(t,t.getHash(this)))}addSequentialNode(t){this.sequentialNodes.includes(t)===!1&&this.sequentialNodes.push(t)}buildUpdateNodes(){for(const t of this.nodes)t.getUpdateType()!==rt.NONE&&this.updateNodes.push(t.getSelf());for(const t of this.sequentialNodes){const e=t.getUpdateBeforeType(),s=t.getUpdateAfterType();e!==rt.NONE&&this.updateBeforeNodes.push(t.getSelf()),s!==rt.NONE&&this.updateAfterNodes.push(t.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(t){return t.magFilter===Je||t.magFilter===Ru||t.magFilter===Tr||t.magFilter===Gi||t.minFilter===Je||t.minFilter===Ru||t.minFilter===Tr||t.minFilter===Gi}addChain(t){this.chaining.push(t)}removeChain(t){if(this.chaining.pop()!==t)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(t){return t}getNodeFromHash(t){return this.hashNodes[t]}addFlow(t,e){return this.flowNodes[t].push(e),e}setContext(t){this.context=t}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(t){this.cache=t}getCache(){return this.cache}getCacheFromNode(t,e=!0){const s=this.getDataFromNode(t);return s.cache===void 0&&(s.cache=new H1(e?this.getCache():null)),s.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(t){const e=this.getDataFromNode(t);return e.usageCount=e.usageCount===void 0?1:e.usageCount+1,e.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateConst(t,e=null){if(e===null&&(t==="float"||t==="int"||t==="uint"?e=0:t==="bool"?e=!1:t==="color"?e=new W:t==="vec2"?e=new Y:t==="vec3"?e=new S:t==="vec4"&&(e=new vt)),t==="float")return oc(e);if(t==="int")return`${Math.round(e)}`;if(t==="uint")return e>=0?`${Math.round(e)}u`:"0u";if(t==="bool")return e?"true":"false";if(t==="color")return`${this.getType("vec3")}( ${oc(e.r)}, ${oc(e.g)}, ${oc(e.b)} )`;const s=this.getTypeLength(t),i=this.getComponentType(t),n=r=>this.generateConst(i,r);if(s===2)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)} )`;if(s===3)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)}, ${n(e.z)} )`;if(s===4)return`${this.getType(t)}( ${n(e.x)}, ${n(e.y)}, ${n(e.z)}, ${n(e.w)} )`;if(s>4&&e&&(e.isMatrix3||e.isMatrix4))return`${this.getType(t)}( ${e.elements.map(n).join(", ")} )`;if(s>4)return`${this.getType(t)}()`;throw new Error(`NodeBuilder: Type '${t}' not found in generate constant attempt.`)}getType(t){return t==="color"?"vec3":t}hasGeometryAttribute(t){return this.geometry&&this.geometry.getAttribute(t)!==void 0}getAttribute(t,e){const s=this.attributes;for(const n of s)if(n.name===t)return n;const i=new H3(t,e);return s.push(i),i}getPropertyName(t){return t.name}isVector(t){return/vec\d/.test(t)}isMatrix(t){return/mat\d/.test(t)}isReference(t){return t==="void"||t==="property"||t==="sampler"||t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="depthTexture"||t==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(t){const e=t.type;if(t.isDataTexture){if(e===Ze)return"int";if(e===Pe)return"uint"}return"float"}getElementType(t){return t==="mat2"?"vec2":t==="mat3"?"vec3":t==="mat4"?"vec4":this.getComponentType(t)}getComponentType(t){if(t=this.getVectorType(t),t==="float"||t==="bool"||t==="int"||t==="uint")return t;const e=/(b|i|u|)(vec|mat)([2-4])/.exec(t);return e===null?null:e[1]==="b"?"bool":e[1]==="i"?"int":e[1]==="u"?"uint":"float"}getVectorType(t){return t==="color"?"vec3":t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"?"vec4":t}getTypeFromLength(t,e="float"){if(t===1)return e;const s=J4(t);return(e==="float"?"":e[0])+s}getTypeFromArray(t){return RT.get(t.constructor)}getTypeFromAttribute(t){let e=t;t.isInterleavedBufferAttribute&&(e=t.data);const s=e.array,i=t.itemSize,n=t.normalized;let r;return!(t instanceof N4)&&n!==!0&&(r=this.getTypeFromArray(s)),this.getTypeFromLength(i,r)}getTypeLength(t){const e=this.getVectorType(t),s=/vec([2-4])/.exec(e);return s!==null?Number(s[1]):e==="float"||e==="bool"||e==="int"||e==="uint"?1:/mat2/.test(t)===!0?4:/mat3/.test(t)===!0?9:/mat4/.test(t)===!0?16:0}getVectorFromMatrix(t){return t.replace("mat","vec")}changeComponentType(t,e){return this.getTypeFromLength(this.getTypeLength(t),e)}getIntegerType(t){const e=this.getComponentType(t);return e==="int"||e==="uint"?t:this.changeComponentType(t,"int")}addStack(){return this.stack=Rc(this.stack),this.stacks.push(u2()||this.stack),Ya(this.stack),this.stack}removeStack(){const t=this.stack;return this.stack=t.parent,Ya(this.stacks.pop()),t}getDataFromNode(t,e=this.shaderStage,s=null){s=s===null?t.isGlobal(this)?this.globalCache:this.cache:s;let i=s.getData(t);return i===void 0&&(i={},s.setData(t,i)),i[e]===void 0&&(i[e]={}),i[e]}getNodeProperties(t,e="any"){const s=this.getDataFromNode(t,e);return s.properties||(s.properties={outputNode:null})}getBufferAttributeFromNode(t,e){const s=this.getDataFromNode(t);let i=s.bufferAttribute;if(i===void 0){const n=this.uniforms.index++;i=new H3("nodeAttribute"+n,e,t),this.bufferAttributes.push(i),s.bufferAttribute=i}return i}getStructTypeFromNode(t,e=this.shaderStage){const s=this.getDataFromNode(t,e);if(s.structType===void 0){const i=this.structs.index++;t.name=`StructType${i}`,this.structs[e].push(t),s.structType=t}return t}getUniformFromNode(t,e,s=this.shaderStage,i=null){const n=this.getDataFromNode(t,s,this.globalCache);let r=n.uniform;if(r===void 0){const a=this.uniforms.index++;r=new aT(i||"nodeUniform"+a,e,t),this.uniforms[s].push(r),n.uniform=r}return r}getVarFromNode(t,e=null,s=t.getNodeType(this),i=this.shaderStage){const n=this.getDataFromNode(t,i);let r=n.variable;if(r===void 0){const a=this.vars[i]||(this.vars[i]=[]);e===null&&(e="nodeVar"+a.length),r=new gd(e,s),a.push(r),n.variable=r}return r}getVaryingFromNode(t,e=null,s=t.getNodeType(this)){const i=this.getDataFromNode(t,"any");let n=i.varying;if(n===void 0){const r=this.varyings,a=r.length;e===null&&(e="nodeVarying"+a),n=new cT(e,s),r.push(n),i.varying=n}return n}getCodeFromNode(t,e,s=this.shaderStage){const i=this.getDataFromNode(t);let n=i.code;if(n===void 0){const r=this.codes[s]||(this.codes[s]=[]),a=r.length;n=new lT("nodeCode"+a,e),r.push(n),i.code=n}return n}addFlowCodeHierarchy(t,e){const{flowCodes:s,flowCodeBlock:i}=this.getDataFromNode(t);let n=!0,r=e;for(;r;){if(i.get(r)===!0){n=!1;break}r=this.getDataFromNode(r).parentNodeBlock}if(n)for(const a of s)this.addLineFlowCode(a)}addLineFlowCodeBlock(t,e,s){const i=this.getDataFromNode(t),n=i.flowCodes||(i.flowCodes=[]),r=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);n.push(e),r.set(s,!0)}addLineFlowCode(t,e=null){return t===""?this:(e!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(e,t,this.context.nodeBlock),t=this.tab+t,/;\s*$/.test(t)||(t=t+`;
`),this.flow.code+=t,this)}addFlowCode(t){return this.flow.code+=t,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(t){return this.flowsData.get(t)}flowNode(t){const e=t.getNodeType(this),s=this.flowChildNode(t,e);return this.flowsData.set(t,s),s}buildFunctionNode(t){const e=new W9,s=this.currentFunctionNode;return this.currentFunctionNode=e,e.code=this.buildFunctionCode(t),this.currentFunctionNode=s,e}flowShaderNode(t){const e=t.layout,s={[Symbol.iterator](){let r=0;const a=Object.values(this);return{next:()=>({value:a[r],done:r++>=a.length})}}};for(const r of e.inputs)s[r.name]=new b9(r.type,r.name);t.layout=null;const i=t.call(s),n=this.flowStagesNode(i,e.type);return t.layout=e,n}flowStagesNode(t,e=null){const s=this.flow,i=this.vars,n=this.cache,r=this.buildStage,a=this.stack,c={code:""};this.flow=c,this.vars={},this.cache=new H1,this.stack=Rc();for(const l of sp)this.setBuildStage(l),c.result=t.build(this,e);return c.vars=this.getVars(this.shaderStage),this.flow=s,this.vars=i,this.cache=n,this.stack=a,this.setBuildStage(r),c}getFunctionOperator(){return null}flowChildNode(t,e=null){const s=this.flow,i={code:""};return this.flow=i,i.result=t.build(this,e),this.flow=s,i}flowNodeFromShaderStage(t,e,s=null,i=null){const n=this.shaderStage;this.setShaderStage(t);const r=this.flowChildNode(e,s);return i!==null&&(r.code+=`${this.tab+i} = ${r.result};
`),this.flowCode[t]=this.flowCode[t]+r.code,this.setShaderStage(n),r}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(t,e){return`${this.getType(t)} ${e}`}getVars(t){let e="";const s=this.vars[t];if(s!==void 0)for(const i of s)e+=`${this.getVar(i.type,i.name)}; `;return e}getUniforms(){console.warn("Abstract function.")}getCodes(t){const e=this.codes[t];let s="";if(e!==void 0)for(const i of e)s+=i.code+`
`;return s}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(t){this.shaderStage=t}getShaderStage(){return this.shaderStage}setBuildStage(t){this.buildStage=t}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:t,material:e,renderer:s}=this;if(e!==null){let i=s.library.fromMaterial(e);i===null&&(console.error(`NodeMaterial: Material "${e.type}" is not compatible.`),i=new ue),i.build(this)}else this.addFlow("compute",t);for(const i of sp){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const n of ip){this.setShaderStage(n);const r=this.flowNodes[n];for(const a of r)i==="generate"?this.flowNode(a):a.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(t,e){if(e==="float"||e==="int"||e==="uint")return new xT(t);if(e==="vec2"||e==="ivec2"||e==="uvec2")return new wT(t);if(e==="vec3"||e==="ivec3"||e==="uvec3")return new bT(t);if(e==="vec4"||e==="ivec4"||e==="uvec4")return new vT(t);if(e==="color")return new _T(t);if(e==="mat3")return new ST(t);if(e==="mat4")return new TT(t);throw new Error(`Uniform "${e}" not declared.`)}createNodeMaterial(t="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${t}() instead.`)}format(t,e,s){if(e=this.getVectorType(e),s=this.getVectorType(s),e===s||s===null||this.isReference(s))return t;const i=this.getTypeLength(e),n=this.getTypeLength(s);return i===16&&n===9?`${this.getType(s)}(${t}[0].xyz, ${t}[1].xyz, ${t}[2].xyz)`:i===9&&n===4?`${this.getType(s)}(${t}[0].xy, ${t}[1].xy)`:i>4||n>4||n===0?t:i===n?`${this.getType(s)}( ${t} )`:i>n?this.format(`${t}.${"xyz".slice(0,n)}`,this.getTypeFromLength(n,this.getComponentType(e)),s):n===4&&i>1?`${this.getType(s)}( ${this.format(t,e,"vec3")}, 1.0 )`:i===2?`${this.getType(s)}( ${this.format(t,e,"vec2")}, 0.0 )`:(i===1&&n>1&&e!==this.getComponentType(s)&&(t=`${this.getType(this.getComponentType(s))}( ${t} )`),`${this.getType(s)}( ${t} )`)}getSignature(){return`// Three.js r${wl} - Node System
`}}class Q3{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.startTime=null,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(t,e){let s=t.get(e);return s===void 0&&(s={renderMap:new WeakMap,frameMap:new WeakMap},t.set(e,s)),s}updateBeforeNode(t){const e=t.getUpdateBeforeType(),s=t.updateReference(this);if(e===rt.FRAME){const{frameMap:i}=this._getMaps(this.updateBeforeMap,s);i.get(s)!==this.frameId&&t.updateBefore(this)!==!1&&i.set(s,this.frameId)}else if(e===rt.RENDER){const{renderMap:i}=this._getMaps(this.updateBeforeMap,s);i.get(s)!==this.renderId&&t.updateBefore(this)!==!1&&i.set(s,this.renderId)}else e===rt.OBJECT&&t.updateBefore(this)}updateAfterNode(t){const e=t.getUpdateAfterType(),s=t.updateReference(this);if(e===rt.FRAME){const{frameMap:i}=this._getMaps(this.updateAfterMap,s);i.get(s)!==this.frameId&&t.updateAfter(this)!==!1&&i.set(s,this.frameId)}else if(e===rt.RENDER){const{renderMap:i}=this._getMaps(this.updateAfterMap,s);i.get(s)!==this.renderId&&t.updateAfter(this)!==!1&&i.set(s,this.renderId)}else e===rt.OBJECT&&t.updateAfter(this)}updateNode(t){const e=t.getUpdateType(),s=t.updateReference(this);if(e===rt.FRAME){const{frameMap:i}=this._getMaps(this.updateMap,s);i.get(s)!==this.frameId&&t.update(this)!==!1&&i.set(s,this.frameId)}else if(e===rt.RENDER){const{renderMap:i}=this._getMaps(this.updateMap,s);i.get(s)!==this.renderId&&t.update(this)!==!1&&i.set(s,this.renderId)}else e===rt.OBJECT&&t.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class hh{constructor(t,e,s=null,i="",n=!1){this.type=t,this.name=e,this.count=s,this.qualifier=i,this.isConst=n}}hh.isNodeFunctionInput=!0;class ET extends Ro{static get type(){return"DirectionalLightNode"}constructor(t=null){super(t)}setup(t){super.setup(t);const e=t.context.lightingModel,s=this.colorNode,i=oh(this.light),n=t.context.reflectedLight;e.direct({lightDirection:i,lightColor:s,reflectedLight:n},t.stack,t)}}const K1=new gt,rc=new gt;let ua=null;class DT extends Ro{static get type(){return"RectAreaLightNode"}constructor(t=null){super(t),this.halfHeight=Q(new S).setGroup(st),this.halfWidth=Q(new S).setGroup(st),this.updateType=rt.RENDER}update(t){super.update(t);const{light:e}=this,s=t.camera.matrixWorldInverse;rc.identity(),K1.copy(e.matrixWorld),K1.premultiply(s),rc.extractRotation(K1),this.halfWidth.value.set(e.width*.5,0,0),this.halfHeight.value.set(0,e.height*.5,0),this.halfWidth.value.applyMatrix4(rc),this.halfHeight.value.applyMatrix4(rc)}setup(t){super.setup(t);let e,s;t.isAvailable("float32Filterable")?(e=yt(ua.LTC_FLOAT_1),s=yt(ua.LTC_FLOAT_2)):(e=yt(ua.LTC_HALF_1),s=yt(ua.LTC_HALF_2));const{colorNode:i,light:n}=this,r=t.context.lightingModel,a=Xl(n),c=t.context.reflectedLight;r.directRectArea({lightColor:i,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,reflectedLight:c,ltc_1:e,ltc_2:s},t.stack,t)}static setLTC(t){ua=t}}class md extends Ro{static get type(){return"SpotLightNode"}constructor(t=null){super(t),this.coneCosNode=Q(0).setGroup(st),this.penumbraCosNode=Q(0).setGroup(st),this.cutoffDistanceNode=Q(0).setGroup(st),this.decayExponentNode=Q(0).setGroup(st)}update(t){super.update(t);const{light:e}=this;this.coneCosNode.value=Math.cos(e.angle),this.penumbraCosNode.value=Math.cos(e.angle*(1-e.penumbra)),this.cutoffDistanceNode.value=e.distance,this.decayExponentNode.value=e.decay}getSpotAttenuation(t){const{coneCosNode:e,penumbraCosNode:s}=this;return Ji(e,s,t)}setup(t){super.setup(t);const e=t.context.lightingModel,{colorNode:s,cutoffDistanceNode:i,decayExponentNode:n,light:r}=this,a=Xl(r).sub(be),c=a.normalize(),l=c.dot(oh(r)),u=this.getSpotAttenuation(l),p=a.length(),h=ah({lightDistance:p,cutoffDistance:i,decayExponent:n});let d=s.mul(u).mul(h);if(r.map){const f=X9(r),m=yt(r.map,f.xy).onRenderUpdate(()=>r.map);d=f.mul(2).sub(1).abs().lessThan(1).all().select(d.mul(m),d)}const g=t.context.reflectedLight;e.direct({lightDirection:c,lightColor:d,reflectedLight:g},t.stack,t)}}class BT extends md{static get type(){return"IESSpotLightNode"}getSpotAttenuation(t){const e=this.light.iesMap;let s=null;if(e&&e.isTexture===!0){const i=t.acos().mul(1/Math.PI);s=yt(e,G(i,0),0).r}else s=super.getSpotAttenuation(t);return s}}class PT extends Ro{static get type(){return"AmbientLightNode"}constructor(t=null){super(t)}setup({context:t}){t.irradiance.addAssign(this.colorNode)}}class IT extends Ro{static get type(){return"HemisphereLightNode"}constructor(t=null){super(t),this.lightPositionNode=nh(t),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Q(new W).setGroup(st)}update(t){const{light:e}=this;super.update(t),this.lightPositionNode.object3d=e,this.groundColorNode.value.copy(e.groundColor).multiplyScalar(e.intensity)}setup(t){const{colorNode:e,groundColorNode:s,lightDirectionNode:i}=this,r=ks.dot(i).mul(.5).add(.5),a=Mt(s,e,r);t.context.irradiance.addAssign(a)}}class LT extends Ro{static get type(){return"LightProbeNode"}constructor(t=null){super(t);const e=[];for(let s=0;s<9;s++)e.push(new S);this.lightProbe=Ui(e)}update(t){const{light:e}=this;super.update(t);for(let s=0;s<9;s++)this.lightProbe.array[s].copy(e.sh.coefficients[s]).multiplyScalar(e.intensity)}setup(t){const e=dd(Ll,this.lightProbe);t.context.irradiance.addAssign(e)}}class yd{parseFunction(){console.warn("Abstract function.")}}class dh{constructor(t,e,s="",i=""){this.type=t,this.inputs=e,this.name=s,this.precision=i}getCode(){console.warn("Abstract function.")}}dh.isNodeFunction=!0;const UT=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,zT=/[a-z_0-9]+/ig,t5="#pragma main",kT=o=>{o=o.trim();const t=o.indexOf(t5),e=t!==-1?o.slice(t+t5.length):o,s=e.match(UT);if(s!==null&&s.length===5){const i=s[4],n=[];let r=null;for(;(r=zT.exec(i))!==null;)n.push(r);const a=[];let c=0;for(;c<n.length;){const g=n[c][0]==="const";g===!0&&c++;let f=n[c][0];f==="in"||f==="out"||f==="inout"?c++:f="";const m=n[c++][0];let x=Number.parseInt(n[c][0]);Number.isNaN(x)===!1?c++:x=null;const w=n[c++][0];a.push(new hh(m,w,x,f,g))}const l=e.substring(s[0].length),u=s[3]!==void 0?s[3]:"",p=s[2],h=s[1]!==void 0?s[1]:"",d=t!==-1?o.slice(0,t):"";return{type:p,inputs:a,name:u,precision:h,inputsCode:i,blockCode:l,headerCode:d}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class VT extends dh{constructor(t){const{type:e,inputs:s,name:i,precision:n,inputsCode:r,blockCode:a,headerCode:c}=kT(t);super(e,s,i,n),this.inputsCode=r,this.blockCode=a,this.headerCode=c}getCode(t=this.name){let e;const s=this.blockCode;if(s!==""){const{type:i,inputsCode:n,headerCode:r,precision:a}=this;let c=`${i} ${t} ( ${n.trim()} )`;a!==""&&(c=`${a} ${c}`),e=r+c+s}else e="";return e}}class GT extends yd{parseFunction(t){return new VT(t)}}const e5=new WeakMap;class OT extends Vn{constructor(t,e){super(),this.renderer=t,this.backend=e,this.nodeFrame=new Q3,this.nodeBuilderCache=new Map,this.callHashCache=new Ti,this.groupsData=new Ti}updateGroup(t){const e=t.groupNode,s=e.name;if(s===d2.name)return!0;if(s===st.name){const r=this.get(t),a=this.nodeFrame.renderId;return r.renderId!==a?(r.renderId=a,!0):!1}if(s===v8.name){const r=this.get(t),a=this.nodeFrame.frameId;return r.frameId!==a?(r.frameId=a,!0):!1}const i=[e,t];let n=this.groupsData.get(i);return n===void 0&&this.groupsData.set(i,n={}),n.version!==e.version?(n.version=e.version,!0):!1}getForRenderCacheKey(t){return t.initialCacheKey}getForRender(t){const e=this.get(t);let s=e.nodeBuilderState;if(s===void 0){const{nodeBuilderCache:i}=this,n=this.getForRenderCacheKey(t);if(s=i.get(n),s===void 0){const r=this.backend.createNodeBuilder(t.object,this.renderer);r.scene=t.scene,r.material=t.material,r.camera=t.camera,r.context.material=t.material,r.lightsNode=t.lightsNode,r.environmentNode=this.getEnvironmentNode(t.scene),r.fogNode=this.getFogNode(t.scene),r.clippingContext=t.clippingContext,r.build(),s=this._createNodeBuilderState(r),i.set(n,s)}s.usedTimes++,e.nodeBuilderState=s}return s}delete(t){if(t.isRenderObject){const e=this.get(t).nodeBuilderState;e.usedTimes--,e.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(t))}return super.delete(t)}getForCompute(t){const e=this.get(t);let s=e.nodeBuilderState;if(s===void 0){const i=this.backend.createNodeBuilder(t,this.renderer);i.build(),s=this._createNodeBuilderState(i),e.nodeBuilderState=s}return s}_createNodeBuilderState(t){return new rT(t.vertexShader,t.fragmentShader,t.computeShader,t.getAttributesArray(),t.getBindings(),t.updateNodes,t.updateBeforeNodes,t.updateAfterNodes,t.monitor,t.transforms)}getEnvironmentNode(t){return t.environmentNode||this.get(t).environmentNode||null}getBackgroundNode(t){return t.backgroundNode||this.get(t).backgroundNode||null}getFogNode(t){return t.fogNode||this.get(t).fogNode||null}getCacheKey(t,e){const s=[t,e],i=this.renderer.info.calls;let n=this.callHashCache.get(s);if(n===void 0||n.callId!==i){const r=this.getEnvironmentNode(t),a=this.getFogNode(t),c=[];e&&c.push(e.getCacheKey(!0)),r&&c.push(r.getCacheKey()),a&&c.push(a.getCacheKey()),c.push(this.renderer.shadowMap.enabled?1:0),n={callId:i,cacheKey:o2(c)},this.callHashCache.set(s,n)}return n.cacheKey}updateScene(t){this.updateEnvironment(t),this.updateFog(t),this.updateBackground(t)}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(t){const e=this.get(t),s=t.background;if(s){const i=t.backgroundBlurriness===0&&e.backgroundBlurriness>0||t.backgroundBlurriness>0&&e.backgroundBlurriness===0;if(e.background!==s||i){let n=null;if(s.isCubeTexture===!0||s.mapping===s0||s.mapping===i0||s.mapping===Cu)if(t.backgroundBlurriness>0||s.mapping===Cu)n=j2(s);else{let r;s.isCubeTexture===!0?r=Ir(s):r=yt(s),n=e9(r)}else s.isTexture===!0?n=yt(s,Si.flipY()).setUpdateMatrix(!0):s.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",s);e.backgroundNode=n,e.background=s,e.backgroundBlurriness=t.backgroundBlurriness}}else e.backgroundNode&&(delete e.backgroundNode,delete e.background)}updateFog(t){const e=this.get(t),s=t.fog;if(s){if(e.fog!==s){let i=null;if(s.isFogExp2){const n=Et("color","color",s).setGroup(st),r=Et("density","float",s).setGroup(st);i=Y9(n,r)}else if(s.isFog){const n=Et("color","color",s).setGroup(st),r=Et("near","float",s).setGroup(st),a=Et("far","float",s).setGroup(st);i=q9(n,r,a)}else console.error("WebGPUNodes: Unsupported fog configuration.",s);e.fogNode=i,e.fog=s}}else delete e.fogNode,delete e.fog}updateEnvironment(t){const e=this.get(t),s=t.environment;if(s){if(e.environment!==s){let i=null;s.isCubeTexture===!0?i=Ir(s):s.isTexture===!0?i=yt(s):console.error("Nodes: Unsupported environment configuration.",s),e.environmentNode=i,e.environment=s}}else e.environmentNode&&(delete e.environmentNode,delete e.environment)}getNodeFrame(t=this.renderer,e=null,s=null,i=null,n=null){const r=this.nodeFrame;return r.renderer=t,r.scene=e,r.object=s,r.camera=i,r.material=n,r}getNodeFrameForRender(t){return this.getNodeFrame(t.renderer,t.scene,t.object,t.camera,t.material)}getOutputCacheKey(){const t=this.renderer;return t.toneMapping+","+t.currentColorSpace}hasOutputChange(t){return e5.get(t)!==this.getOutputCacheKey()}getOutputNode(t){const e=this.renderer,s=this.getOutputCacheKey(),i=yt(t,Si).renderOutput(e.toneMapping,e.currentColorSpace);return e5.set(t,s),i}updateBefore(t){const e=t.getNodeBuilderState();for(const s of e.updateBeforeNodes)this.getNodeFrameForRender(t).updateBeforeNode(s)}updateAfter(t){const e=t.getNodeBuilderState();for(const s of e.updateAfterNodes)this.getNodeFrameForRender(t).updateAfterNode(s)}updateForCompute(t){const e=this.getNodeFrame(),s=this.getForCompute(t);for(const i of s.updateNodes)e.updateNode(i)}updateForRender(t){const e=this.getNodeFrameForRender(t),s=t.getNodeBuilderState();for(const i of s.updateNodes)e.updateNode(i)}needsRefresh(t){const e=this.getNodeFrameForRender(t);return t.getMonitor().needsRefresh(t,e)}dispose(){super.dispose(),this.nodeFrame=new Q3,this.nodeBuilderCache=new Map}}const J1=new hn;class rl{constructor(t=null){this.version=0,this.clipIntersection=null,this.cacheKey="",t===null?(this.intersectionPlanes=[],this.unionPlanes=[],this.viewNormalMatrix=new gs,this.clippingGroupContexts=new WeakMap,this.shadowPass=!1):(this.viewNormalMatrix=t.viewNormalMatrix,this.clippingGroupContexts=t.clippingGroupContexts,this.shadowPass=t.shadowPass,this.viewMatrix=t.viewMatrix),this.parentVersion=null}projectPlanes(t,e,s){const i=t.length;for(let n=0;n<i;n++){J1.copy(t[n]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const r=e[s+n],a=J1.normal;r.x=-a.x,r.y=-a.y,r.z=-a.z,r.w=J1.constant}}updateGlobal(t,e){this.shadowPass=t.overrideMaterial!==null&&t.overrideMaterial.isShadowNodeMaterial,this.viewMatrix=e.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(t,e){let s=!1;t.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(t.intersectionPlanes),this.unionPlanes=Array.from(t.unionPlanes),this.parentVersion=t.version),this.clipIntersection!==e.clipIntersection&&(this.clipIntersection=e.clipIntersection,this.clipIntersection?this.unionPlanes.length=t.unionPlanes.length:this.intersectionPlanes.length=t.intersectionPlanes.length);const i=e.clippingPlanes,n=i.length;let r,a;if(this.clipIntersection?(r=this.intersectionPlanes,a=t.intersectionPlanes.length):(r=this.unionPlanes,a=t.unionPlanes.length),r.length!==a+n){r.length=a+n;for(let c=0;c<n;c++)r[a+c]=new vt;s=!0}this.projectPlanes(i,r,a),s&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(t){if(this.shadowPass&&!t.clipShadows)return this;let e=this.clippingGroupContexts.get(t);return e===void 0&&(e=new rl(this),this.clippingGroupContexts.set(t,e)),e.update(this,t),e}get unionClippingCount(){return this.unionPlanes.length}}class WT{constructor(t,e){this.scene=t,this.camera=e}clone(){return Object.assign(new this.constructor,this)}}class $T{constructor(){this.lists=new Ti}get(t,e){const s=this.lists,i=[t,e];let n=s.get(i);return n===void 0&&(n=new WT(t,e),s.set(i,n)),n}dispose(){this.lists=new Ti}}class xd{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(t){if(t.isNodeMaterial)return t;let e=null;const s=this.getMaterialNodeClass(t.type);if(s!==null){e=new s;for(const i in t)e[i]=t[i]}return e}addToneMapping(t,e){this.addType(t,e,this.toneMappingNodes)}getToneMappingFunction(t){return this.toneMappingNodes.get(t)||null}getMaterialNodeClass(t){return this.materialNodes.get(t)||null}addMaterial(t,e){this.addType(t,e,this.materialNodes)}getLightNodeClass(t){return this.lightNodes.get(t)||null}addLight(t,e){this.addClass(t,e,this.lightNodes)}addType(t,e,s){if(s.has(e)){console.warn(`Redefinition of node ${e}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e=="function"||typeof e=="object")throw new Error(`Base class ${e} is not a class.`);s.set(e,t)}addClass(t,e,s){if(s.has(e)){console.warn(`Redefinition of node ${e.name}`);return}if(typeof t!="function")throw new Error(`Node class ${t.name} is not a class.`);if(typeof e!="function")throw new Error(`Base class ${e.name} is not a class.`);s.set(e,t)}}const HT=new rh;class qT extends Ti{constructor(){super()}createNode(t=[]){return new rh().setLights(t)}getNode(t,e){if(t.isQuadMesh)return HT;const s=[t,e];let i=this.get(s);return i===void 0&&(i=this.createNode(),this.set(s,i)),i}}const s5=new Yp,ac=new Y,Q1=new vt,tu=new jp,cc=new gt,ln=new vt;class YT{constructor(t,e={}){this.isRenderer=!0;const{logarithmicDepthBuffer:s=!1,alpha:i=!0,depth:n=!0,stencil:r=!1,antialias:a=!1,samples:c=0,getFallback:l=null}=e;this.domElement=t.getDomElement(),this.backend=t,this.samples=c||a===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=s,this.outputColorSpace=et,this.toneMapping=Sr,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=n,this.stencil=r,this.info=new cb,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new xd,this.lighting=new qT,this._getFallback=l,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new vt(0,0,this._width,this._height),this._scissor=new vt(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new th(new ue),this._quad.material.type="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const u=this.alpha===!0?0:1;this._clearColor=new J2(0,0,0,u),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:gg},this.xr={enabled:!1},this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(p,h,d)=>{await this.compileAsync(p,h);const g=this._renderLists.get(p,h),f=this._renderContexts.get(p,h,this._renderTarget),m=p.overrideMaterial||d.material,x=this._objects.get(d,m,p,h,g.lightsNode,f,f.clippingContext),{fragmentShader:w,vertexShader:b}=x.getNodeBuilderState();return{fragmentShader:w,vertexShader:b}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(t,e)=>{let s=this.backend;try{await s.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=s=this._getFallback(i),await s.init(this)}catch(n){e(n);return}else{e(i);return}}this._nodes=new OT(this,s),this._animation=new Jw(this._nodes,this.info),this._attributes=new ob(s),this._background=new nT(this,this._nodes),this._geometries=new ab(this._attributes,this.info),this._textures=new vb(this,s,this.info),this._pipelines=new hb(s,this._nodes),this._bindings=new db(s,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new sb(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new mb(this.lighting),this._bundles=new $T,this._renderContexts=new wb,this._animation.start(),this._initialized=!0,t()}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(t,e,s=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,n=i.renderId,r=this._currentRenderContext,a=this._currentRenderObjectFunction,c=this._compilationPromises,l=t.isScene===!0?t:s5;s===null&&(s=t);const u=this._renderTarget,p=this._renderContexts.get(s,e,u),h=this._activeMipmapLevel,d=[];this._currentRenderContext=p,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=d,i.renderId++,i.update(),p.depth=this.depth,p.stencil=this.stencil,p.clippingContext||(p.clippingContext=new rl),p.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,u);const g=this._renderLists.get(t,e);if(g.begin(),this._projectObject(t,e,0,g,p.clippingContext),s!==t&&s.traverseVisible(function(b){b.isLight&&b.layers.test(e.layers)&&g.pushLight(b)}),g.finish(),u!==null){this._textures.updateRenderTarget(u,h);const b=this._textures.get(u);p.textures=b.textures,p.depthTexture=b.depthTexture}else p.textures=null,p.depthTexture=null;this._nodes.updateScene(l),this._background.update(l,g,p);const f=g.opaque,m=g.transparent,x=g.transparentDoublePass,w=g.lightsNode;this.opaque===!0&&f.length>0&&this._renderObjects(f,e,l,w),this.transparent===!0&&m.length>0&&this._renderTransparents(m,x,e,l,w),i.renderId=n,this._currentRenderContext=r,this._currentRenderObjectFunction=a,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(d)}async renderAsync(t,e){this._initialized===!1&&await this.init();const s=this._renderScene(t,e);await this.backend.resolveTimestampAsync(s,"render")}async waitForGPU(){await this.backend.waitForGPU()}setMRT(t){return this._mrt=t,this}getMRT(){return this._mrt}_onDeviceLost(t){let e=`THREE.WebGPURenderer: ${t.api} Device Lost:

Message: ${t.message}`;t.reason&&(e+=`
Reason: ${t.reason}`),console.error(e),this._isDeviceLost=!0}_renderBundle(t,e,s){const{bundleGroup:i,camera:n,renderList:r}=t,a=this._currentRenderContext,c=this._bundles.get(i,n),l=this.backend.get(c);l.renderContexts===void 0&&(l.renderContexts=new Set);const u=i.version!==l.version,p=l.renderContexts.has(a)===!1||u;if(l.renderContexts.add(a),p){this.backend.beginBundle(a),(l.renderObjects===void 0||u)&&(l.renderObjects=[]),this._currentRenderBundle=c;const h=r.opaque;this.opaque===!0&&h.length>0&&this._renderObjects(h,n,e,s),this._currentRenderBundle=null,this.backend.finishBundle(a,c),l.version=i.version}else{const{renderObjects:h}=l;for(let d=0,g=h.length;d<g;d++){const f=h[d];this._nodes.needsRefresh(f)&&(this._nodes.updateBefore(f),this._nodes.updateForRender(f),this._bindings.updateForRender(f),this._nodes.updateAfter(f))}}this.backend.addBundle(a,c)}render(t,e){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(t,e);this._renderScene(t,e)}_getFrameBufferTarget(){const{currentToneMapping:t,currentColorSpace:e}=this;if(t!==Sr===!1&&e!==Oi===!1)return null;const{width:n,height:r}=this.getDrawingBufferSize(ac),{depth:a,stencil:c}=this;let l=this._frameBufferTarget;return l===null&&(l=new In(n,r,{depthBuffer:a,stencilBuffer:c,type:Qs,format:Cn,colorSpace:Oi,generateMipmaps:!1,minFilter:Je,magFilter:Je,samples:this.samples}),l.isPostProcessingRenderTarget=!0,this._frameBufferTarget=l),l.depthBuffer=a,l.stencilBuffer=c,l.setSize(n,r),l.viewport.copy(this._viewport),l.scissor.copy(this._scissor),l.viewport.multiplyScalar(this._pixelRatio),l.scissor.multiplyScalar(this._pixelRatio),l.scissorTest=this._scissorTest,l}_renderScene(t,e,s=!0){if(this._isDeviceLost===!0)return;const i=s?this._getFrameBufferTarget():null,n=this._nodes.nodeFrame,r=n.renderId,a=this._currentRenderContext,c=this._currentRenderObjectFunction,l=t.isScene===!0?t:s5,u=this._renderTarget,p=this._activeCubeFace,h=this._activeMipmapLevel;let d;i!==null?(d=i,this.setRenderTarget(d)):d=u;const g=this._renderContexts.get(t,e,d);this._currentRenderContext=g,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,n.renderId=this.info.calls;const f=this.coordinateSystem;e.coordinateSystem!==f&&(e.coordinateSystem=f,e.updateProjectionMatrix()),t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),e.parent===null&&e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld();let m=this._viewport,x=this._scissor,w=this._pixelRatio;d!==null&&(m=d.viewport,x=d.scissor,w=1),this.getDrawingBufferSize(ac),Q1.set(0,0,ac.width,ac.height);const b=m.minDepth===void 0?0:m.minDepth,v=m.maxDepth===void 0?1:m.maxDepth;g.viewportValue.copy(m).multiplyScalar(w).floor(),g.viewportValue.width>>=h,g.viewportValue.height>>=h,g.viewportValue.minDepth=b,g.viewportValue.maxDepth=v,g.viewport=g.viewportValue.equals(Q1)===!1,g.scissorValue.copy(x).multiplyScalar(w).floor(),g.scissor=this._scissorTest&&g.scissorValue.equals(Q1)===!1,g.scissorValue.width>>=h,g.scissorValue.height>>=h,g.clippingContext||(g.clippingContext=new rl),g.clippingContext.updateGlobal(l,e),l.onBeforeRender(this,t,e,d),cc.multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse),tu.setFromProjectionMatrix(cc,f);const T=this._renderLists.get(t,e);if(T.begin(),this._projectObject(t,e,0,T,g.clippingContext),T.finish(),this.sortObjects===!0&&T.sort(this._opaqueSort,this._transparentSort),d!==null){this._textures.updateRenderTarget(d,h);const U=this._textures.get(d);g.textures=U.textures,g.depthTexture=U.depthTexture,g.width=U.width,g.height=U.height,g.renderTarget=d,g.depth=d.depthBuffer,g.stencil=d.stencilBuffer}else g.textures=null,g.depthTexture=null,g.width=this.domElement.width,g.height=this.domElement.height,g.depth=this.depth,g.stencil=this.stencil;g.width>>=h,g.height>>=h,g.activeCubeFace=p,g.activeMipmapLevel=h,g.occlusionQueryCount=T.occlusionQueryCount,this._nodes.updateScene(l),this._background.update(l,T,g),this.backend.beginRender(g);const{bundles:M,lightsNode:F,transparentDoublePass:N,transparent:A,opaque:E}=T;if(M.length>0&&this._renderBundles(M,l,F),this.opaque===!0&&E.length>0&&this._renderObjects(E,e,l,F),this.transparent===!0&&A.length>0&&this._renderTransparents(A,N,e,l,F),this.backend.finishRender(g),n.renderId=r,this._currentRenderContext=a,this._currentRenderObjectFunction=c,i!==null){this.setRenderTarget(u,p,h);const U=this._quad;this._nodes.hasOutputChange(d.texture)&&(U.material.fragmentNode=this._nodes.getOutputNode(d.texture),U.material.needsUpdate=!0),this._renderScene(U,U.camera,!1)}return l.onAfterRender(this,t,e,d),g}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(t){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(t)}async getArrayBufferAsync(t){return await this.backend.getArrayBufferAsync(t)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(t){return t.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(t){return t.set(this._width,this._height)}setPixelRatio(t=1){this._pixelRatio!==t&&(this._pixelRatio=t,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(t,e,s){this._width=t,this._height=e,this._pixelRatio=s,this.domElement.width=Math.floor(t*s),this.domElement.height=Math.floor(e*s),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setSize(t,e,s=!0){this._width=t,this._height=e,this.domElement.width=Math.floor(t*this._pixelRatio),this.domElement.height=Math.floor(e*this._pixelRatio),s===!0&&(this.domElement.style.width=t+"px",this.domElement.style.height=e+"px"),this.setViewport(0,0,t,e),this._initialized&&this.backend.updateSize()}setOpaqueSort(t){this._opaqueSort=t}setTransparentSort(t){this._transparentSort=t}getScissor(t){const e=this._scissor;return t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height,t}setScissor(t,e,s,i){const n=this._scissor;t.isVector4?n.copy(t):n.set(t,e,s,i)}getScissorTest(){return this._scissorTest}setScissorTest(t){this._scissorTest=t,this.backend.setScissorTest(t)}getViewport(t){return t.copy(this._viewport)}setViewport(t,e,s,i,n=0,r=1){const a=this._viewport;t.isVector4?a.copy(t):a.set(t,e,s,i),a.minDepth=n,a.maxDepth=r}getClearColor(t){return t.copy(this._clearColor)}setClearColor(t,e=1){this._clearColor.set(t),this._clearColor.a=e}getClearAlpha(){return this._clearColor.a}setClearAlpha(t){this._clearColor.a=t}getClearDepth(){return this._clearDepth}setClearDepth(t){this._clearDepth=t}getClearStencil(){return this._clearStencil}setClearStencil(t){this._clearStencil=t}isOccluded(t){const e=this._currentRenderContext;return e&&this.backend.isOccluded(e,t)}clear(t=!0,e=!0,s=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(t,e,s);const i=this._renderTarget||this._getFrameBufferTarget();let n=null;if(i!==null&&(this._textures.updateRenderTarget(i),n=this._textures.get(i)),this.backend.clear(t,e,s,n),i!==null&&this._renderTarget===null){const r=this._quad;this._nodes.hasOutputChange(i.texture)&&(r.material.fragmentNode=this._nodes.getOutputNode(i.texture),r.material.needsUpdate=!0),this._renderScene(r,r.camera,!1)}}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(t=!0,e=!0,s=!0){this._initialized===!1&&await this.init(),this.clear(t,e,s)}clearColorAsync(){return this.clearAsync(!0,!1,!1)}clearDepthAsync(){return this.clearAsync(!1,!0,!1)}clearStencilAsync(){return this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this._renderTarget!==null?Sr:this.toneMapping}get currentColorSpace(){return this._renderTarget!==null?Oi:this.outputColorSpace}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(t,e=0,s=0){this._renderTarget=t,this._activeCubeFace=e,this._activeMipmapLevel=s}getRenderTarget(){return this._renderTarget}setRenderObjectFunction(t){this._renderObjectFunction=t}getRenderObjectFunction(){return this._renderObjectFunction}compute(t){if(this.isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(t);const e=this._nodes.nodeFrame,s=e.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,e.renderId=this.info.calls;const i=this.backend,n=this._pipelines,r=this._bindings,a=this._nodes,c=Array.isArray(t)?t:[t];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(t);for(const l of c){if(n.has(l)===!1){const h=()=>{l.removeEventListener("dispose",h),n.delete(l),r.delete(l),a.delete(l)};l.addEventListener("dispose",h);const d=l.onInitFunction;d!==null&&d.call(l,{renderer:this})}a.updateForCompute(l),r.updateForCompute(l);const u=r.getForCompute(l),p=n.getForCompute(l,u);i.compute(t,l,u,p)}i.finishCompute(t),e.renderId=s}async computeAsync(t){this._initialized===!1&&await this.init(),this.compute(t),await this.backend.resolveTimestampAsync(t,"compute")}async hasFeatureAsync(t){return this._initialized===!1&&await this.init(),this.backend.hasFeature(t)}hasFeature(t){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(t)}hasInitialized(){return this._initialized}async initTextureAsync(t){this._initialized===!1&&await this.init(),this._textures.updateTexture(t)}initTexture(t){if(this._initialized===!1)return console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),!1;this._textures.updateTexture(t)}copyFramebufferToTexture(t,e=null){if(e!==null)if(e.isVector2)e=ln.set(e.x,e.y,t.image.width,t.image.height).floor();else if(e.isVector4)e=ln.copy(e).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else e=ln.set(0,0,t.image.width,t.image.height);let s=this._currentRenderContext,i;s!==null?i=s.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),s=this._textures.get(i))),this._textures.updateTexture(t,{renderTarget:i}),this.backend.copyFramebufferToTexture(t,s,e)}copyTextureToTexture(t,e,s=null,i=null,n=0){this._textures.updateTexture(t),this._textures.updateTexture(e),this.backend.copyTextureToTexture(t,e,s,i,n)}readRenderTargetPixelsAsync(t,e,s,i,n,r=0,a=0){return this.backend.copyTextureToBuffer(t.textures[r],e,s,i,n,a)}_projectObject(t,e,s,i,n){if(t.visible===!1)return;if(t.layers.test(e.layers)){if(t.isGroup)s=t.renderOrder,t.isClippingGroup&&t.enabled&&(n=n.getGroupContext(t));else if(t.isLOD)t.autoUpdate===!0&&t.update(e);else if(t.isLight)i.pushLight(t);else if(t.isSprite){if(!t.frustumCulled||tu.intersectsSprite(t)){this.sortObjects===!0&&ln.setFromMatrixPosition(t.matrixWorld).applyMatrix4(cc);const{geometry:c,material:l}=t;l.visible&&i.push(t,c,l,s,ln.z,null,n)}}else if(t.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((t.isMesh||t.isLine||t.isPoints)&&(!t.frustumCulled||tu.intersectsObject(t))){const{geometry:c,material:l}=t;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),ln.copy(c.boundingSphere.center).applyMatrix4(t.matrixWorld).applyMatrix4(cc)),Array.isArray(l)){const u=c.groups;for(let p=0,h=u.length;p<h;p++){const d=u[p],g=l[d.materialIndex];g&&g.visible&&i.push(t,c,g,s,ln.z,d,n)}}else l.visible&&i.push(t,c,l,s,ln.z,null,n)}}if(t.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(t,e),i.begin(),c.pushBundle({bundleGroup:t,camera:e,renderList:i}),i.finish()}const a=t.children;for(let c=0,l=a.length;c<l;c++)this._projectObject(a[c],e,s,i,n)}_renderBundles(t,e,s){for(const i of t)this._renderBundle(i,e,s)}_renderTransparents(t,e,s,i,n){if(e.length>0){for(const{material:r}of e)r.side=ls;this._renderObjects(e,s,i,n,"backSide");for(const{material:r}of e)r.side=go;this._renderObjects(t,s,i,n);for(const{material:r}of e)r.side=Kt}else this._renderObjects(t,s,i,n)}_renderObjects(t,e,s,i,n=null){for(let r=0,a=t.length;r<a;r++){const c=t[r],{object:l,geometry:u,material:p,group:h,clippingContext:d}=c;if(e.isArrayCamera){const g=e.cameras;for(let f=0,m=g.length;f<m;f++){const x=g[f];if(l.layers.test(x.layers)){const w=x.viewport,b=w.minDepth===void 0?0:w.minDepth,v=w.maxDepth===void 0?1:w.maxDepth,T=this._currentRenderContext.viewportValue;T.copy(w).multiplyScalar(this._pixelRatio).floor(),T.minDepth=b,T.maxDepth=v,this.backend.updateViewport(this._currentRenderContext),this._currentRenderObjectFunction(l,s,x,u,p,h,i,d,n)}}}else this._currentRenderObjectFunction(l,s,e,u,p,h,i,d,n)}}renderObject(t,e,s,i,n,r,a,c=null,l=null){let u,p,h;if(t.onBeforeRender(this,e,s,i,n,r),e.overrideMaterial!==null){const d=e.overrideMaterial;n.positionNode&&n.positionNode.isNode&&(u=d.positionNode,d.positionNode=n.positionNode),d.alphaTest=n.alphaTest,d.alphaMap=n.alphaMap,d.isShadowNodeMaterial&&(d.side=n.shadowSide===null?n.side:n.shadowSide,n.depthNode&&n.depthNode.isNode&&(h=d.depthNode,d.depthNode=n.depthNode),n.castShadowNode&&n.castShadowNode.isNode&&(p=d.colorNode,d.colorNode=n.castShadowNode)),n=d}n.transparent===!0&&n.side===Kt&&n.forceSinglePass===!1?(n.side=ls,this._handleObjectFunction(t,n,e,s,a,r,c,"backSide"),n.side=go,this._handleObjectFunction(t,n,e,s,a,r,c,l),n.side=Kt):this._handleObjectFunction(t,n,e,s,a,r,c,l),u!==void 0&&(e.overrideMaterial.positionNode=u),h!==void 0&&(e.overrideMaterial.depthNode=h),p!==void 0&&(e.overrideMaterial.colorNode=p),t.onAfterRender(this,e,s,i,n,r)}_renderObjectDirect(t,e,s,i,n,r,a,c){const l=this._objects.get(t,e,s,i,n,this._currentRenderContext,a,c);l.drawRange=t.geometry.drawRange,l.group=r;const u=this._nodes.needsRefresh(l);u&&(this._nodes.updateBefore(l),this._geometries.updateForRender(l),this._nodes.updateForRender(l),this._bindings.updateForRender(l)),this._pipelines.updateForRender(l),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(l),l.bundle=this._currentRenderBundle.scene),this.backend.draw(l,this.info),u&&this._nodes.updateAfter(l)}_createObjectPipeline(t,e,s,i,n,r,a){const c=this._objects.get(t,e,s,i,n,this._currentRenderContext,r,a);this._nodes.updateBefore(c),this._geometries.updateForRender(c),this._nodes.updateForRender(c),this._bindings.updateForRender(c),this._pipelines.getForRender(c,this._compilationPromises),this._nodes.updateAfter(c)}get compile(){return this.compileAsync}}class gh{constructor(t=""){this.name=t,this.visibility=0}setVisibility(t){this.visibility|=t}clone(){return Object.assign(new this.constructor,this)}}function XT(o){return o+(wn-o%wn)%wn}class wd extends gh{constructor(t,e=null){super(t),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=e}get byteLength(){return XT(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class bd extends wd{constructor(t,e=null){super(t,e),this.isUniformBuffer=!0}}let ZT=0;class vd extends bd{constructor(t,e){super("UniformBuffer_"+ZT++,t?t.value:null),this.nodeUniform=t,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class jT extends bd{constructor(t){super(t),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(t){return this.uniforms.push(t),this}removeUniform(t){const e=this.uniforms.indexOf(t);return e!==-1&&this.uniforms.splice(e,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let t=this._buffer;if(t===null){const e=this.byteLength;t=new Float32Array(new ArrayBuffer(e)),this._buffer=t}return t}get byteLength(){let t=0;for(let e=0,s=this.uniforms.length;e<s;e++){const i=this.uniforms[e],{boundary:n,itemSize:r}=i,a=t%wn,c=wn-a;a!==0&&c-n<0?t+=wn-a:a%n!==0&&(t+=a%n),i.offset=t/this.bytesPerElement,t+=r*this.bytesPerElement}return Math.ceil(t/wn)*wn}update(){let t=!1;for(const e of this.uniforms)this.updateByType(e)===!0&&(t=!0);return t}updateByType(t){if(t.isNumberUniform)return this.updateNumber(t);if(t.isVector2Uniform)return this.updateVector2(t);if(t.isVector3Uniform)return this.updateVector3(t);if(t.isVector4Uniform)return this.updateVector4(t);if(t.isColorUniform)return this.updateColor(t);if(t.isMatrix3Uniform)return this.updateMatrix3(t);if(t.isMatrix4Uniform)return this.updateMatrix4(t);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",t)}updateNumber(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,r=t.getType();if(s[n]!==i){const a=this._getBufferForType(r);a[n]=s[n]=i,e=!0}return e}updateVector2(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,r=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y){const a=this._getBufferForType(r);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,e=!0}return e}updateVector3(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,r=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y||s[n+2]!==i.z){const a=this._getBufferForType(r);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,a[n+2]=s[n+2]=i.z,e=!0}return e}updateVector4(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset,r=t.getType();if(s[n+0]!==i.x||s[n+1]!==i.y||s[n+2]!==i.z||s[n+4]!==i.w){const a=this._getBufferForType(r);a[n+0]=s[n+0]=i.x,a[n+1]=s[n+1]=i.y,a[n+2]=s[n+2]=i.z,a[n+3]=s[n+3]=i.w,e=!0}return e}updateColor(t){let e=!1;const s=this.values,i=t.getValue(),n=t.offset;if(s[n+0]!==i.r||s[n+1]!==i.g||s[n+2]!==i.b){const r=this.buffer;r[n+0]=s[n+0]=i.r,r[n+1]=s[n+1]=i.g,r[n+2]=s[n+2]=i.b,e=!0}return e}updateMatrix3(t){let e=!1;const s=this.values,i=t.getValue().elements,n=t.offset;if(s[n+0]!==i[0]||s[n+1]!==i[1]||s[n+2]!==i[2]||s[n+4]!==i[3]||s[n+5]!==i[4]||s[n+6]!==i[5]||s[n+8]!==i[6]||s[n+9]!==i[7]||s[n+10]!==i[8]){const r=this.buffer;r[n+0]=s[n+0]=i[0],r[n+1]=s[n+1]=i[1],r[n+2]=s[n+2]=i[2],r[n+4]=s[n+4]=i[3],r[n+5]=s[n+5]=i[4],r[n+6]=s[n+6]=i[5],r[n+8]=s[n+8]=i[6],r[n+9]=s[n+9]=i[7],r[n+10]=s[n+10]=i[8],e=!0}return e}updateMatrix4(t){let e=!1;const s=this.values,i=t.getValue().elements,n=t.offset;return JT(s,i,n)===!1&&(this.buffer.set(i,n),KT(s,i,n),e=!0),e}_getBufferForType(t){return t==="int"||t==="ivec2"||t==="ivec3"||t==="ivec4"?new Int32Array(this.buffer.buffer):t==="uint"||t==="uvec2"||t==="uvec3"||t==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function KT(o,t,e){for(let s=0,i=t.length;s<i;s++)o[e+s]=t[s]}function JT(o,t,e){for(let s=0,i=t.length;s<i;s++)if(o[e+s]!==t[s])return!1;return!0}let QT=0;class _d extends jT{constructor(t,e){super(t),this.id=QT++,this.groupNode=e,this.isNodeUniformsGroup=!0}getNodes(){const t=[];for(const e of this.uniforms){const s=e.nodeUniform.node;if(!s)throw new Error("NodeUniformsGroup: Uniform has no node.");t.push(s)}return t}}let tM=0;class eM extends gh{constructor(t,e){super(t),this.id=tM++,this.texture=e,this.version=e?e.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(t){const{texture:e}=this;return t!==this.generation?(this.generation=t,!0):e.isVideoTexture}update(){const{texture:t,version:e}=this;return e!==t.version?(this.version=t.version,!0):!1}}class Zl extends eM{constructor(t,e,s,i=null){super(t,e?e.value:null),this.textureNode=e,this.groupNode=s,this.access=i}needsBindingsUpdate(t){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(t)}update(){const{textureNode:t}=this;return this.texture!==t.value?(this.texture=t.value,!0):super.update()}}class Sd extends Zl{constructor(t,e,s,i){super(t,e,s,i),this.isSampledCubeTexture=!0}}class Td extends Zl{constructor(t,e,s,i){super(t,e,s,i),this.isSampledTexture3D=!0}}const sM={atan2:"atan",textureDimensions:"textureSize",equals:"equal"},iM={low:"lowp",medium:"mediump",high:"highp"},i5={swizzleAssign:!0,storageBuffer:!1},n5=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class nM extends fd{constructor(t,e){super(t,e,new GT),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]},this.useComparisonMethod=!0}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==yo}getMethod(t){return sM[t]||t}getOutputStructName(){return""}buildFunctionCode(t){const e=t.layout,s=this.flowShaderNode(t),i=[];for(const r of e.inputs)i.push(this.getType(r.type)+" "+r.name);return`${this.getType(e.type)} ${e.name}( ${i.join(", ")} ) {

	${s.vars}

${s.code}
	return ${s.result};

}`}setupPBO(t){const e=t.value;if(e.pbo===void 0){const s=e.array,i=e.count*e.itemSize,{itemSize:n}=e,r=e.array.constructor.name.toLowerCase().includes("int");let a=r?zp:vl;n===2?a=r?kp:ka:n===3?a=r?Rg:Up:n===4&&(a=r?Vp:Cn);const c={Float32Array:ns,Uint8Array:Mn,Uint16Array:dr,Uint32Array:Pe,Int8Array:va,Int16Array:_a,Int32Array:Ze,Uint8ClampedArray:Mn},l=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/n))));let u=Math.ceil(i/n/l);l*u*n<i&&u++;const p=l*u*n,h=new s.constructor(p);h.set(s,0),e.array=h;const d=new Zp(e.array,l,u,a,c[e.array.constructor.name]||ns);d.needsUpdate=!0,d.isPBOTexture=!0;const g=new vi(d,null,null);g.setPrecision("high"),e.pboNode=g,e.pbo=g.value,this.getUniformFromNode(e.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(t,e=this.shaderStage){return t.isNodeUniform&&t.node.isTextureNode!==!0&&t.node.isBufferNode!==!0?e.charAt(0)+"_"+t.name:super.getPropertyName(t,e)}generatePBO(t){const{node:e,indexNode:s}=t,i=e.value;if(this.renderer.backend.has(i)){const u=this.renderer.backend.get(i);u.pbo=i.pbo}const n=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),r=this.getPropertyName(n);this.increaseUsage(s);const a=s.build(this,"uint"),c=this.getDataFromNode(t);let l=c.propertyName;if(l===void 0){const u=this.getVarFromNode(t);l=this.getPropertyName(u);const p=this.getDataFromNode(e);let h=p.propertySizeName;h===void 0&&(h=l+"Size",this.getVarFromNode(e,h,"uint"),this.addLineFlowCode(`${h} = uint( textureSize( ${r}, 0 ).x )`,t),p.propertySizeName=h);const{itemSize:d}=i,g="."+Ao.join("").slice(0,d),f=`ivec2(${a} % ${h}, ${a} / ${h})`,m=this.generateTextureLoad(null,r,f,null,"0");let x="vec4";i.pbo.type===Pe?x="uvec4":i.pbo.type===Ze&&(x="ivec4"),this.addLineFlowCode(`${l} = ${x}(${m})${g}`,t),c.propertyName=l}return l}generateTextureLoad(t,e,s,i,n="0"){return i?`texelFetch( ${e}, ivec3( ${s}, ${i} ), ${n} )`:`texelFetch( ${e}, ${s}, ${n} )`}generateTexture(t,e,s,i){return t.isDepthTexture?`texture( ${e}, ${s} ).x`:(i&&(s=`vec3( ${s}, ${i} )`),`texture( ${e}, ${s} )`)}generateTextureLevel(t,e,s,i){return`textureLod( ${e}, ${s}, ${i} )`}generateTextureBias(t,e,s,i){return`texture( ${e}, ${s}, ${i} )`}generateTextureGrad(t,e,s,i){return`textureGrad( ${e}, ${s}, ${i[0]}, ${i[1]} )`}generateTextureCompare(t,e,s,i,n,r=this.shaderStage){if(r==="fragment")return`texture( ${e}, vec3( ${s}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${r} shader.`)}getVars(t){const e=[],s=this.vars[t];if(s!==void 0)for(const i of s)e.push(`${this.getVar(i.type,i.name)};`);return e.join(`
	`)}getUniforms(t){const e=this.uniforms[t],s=[],i={};for(const r of e){let a=null,c=!1;if(r.type==="texture"){const u=r.node.value;let p="";u.isDataTexture===!0&&(u.type===Pe?p="u":u.type===Ze&&(p="i")),u.compareFunction?a=`sampler2DShadow ${r.name};`:u.isDataArrayTexture===!0||u.isCompressedArrayTexture===!0?a=`${p}sampler2DArray ${r.name};`:a=`${p}sampler2D ${r.name};`}else if(r.type==="cubeTexture")a=`samplerCube ${r.name};`;else if(r.type==="texture3D")a=`sampler3D ${r.name};`;else if(r.type==="buffer"){const u=r.node,p=this.getType(u.bufferType),h=u.bufferCount,d=h>0?h:"";a=`${u.name} {
	${p} ${r.name}[${d}];
};
`}else a=`${this.getVectorType(r.type)} ${this.getPropertyName(r,t)};`,c=!0;const l=r.node.precision;if(l!==null&&(a=iM[l]+" "+a),c){a="	"+a;const u=r.groupNode.name;(i[u]||(i[u]=[])).push(a)}else a="uniform "+a,s.push(a)}let n="";for(const r in i){const a=i[r];n+=this._getGLSLUniformStruct(t+"_"+r,a.join(`
`))+`
`}return n+=s.join(`
`),n}getTypeFromAttribute(t){let e=super.getTypeFromAttribute(t);if(/^[iu]/.test(e)&&t.gpuType!==Ze){let s=t;t.isInterleavedBufferAttribute&&(s=t.data);const i=s.array;i instanceof Uint32Array||i instanceof Int32Array||(e=e.slice(1))}return e}getAttributes(t){let e="";if(t==="vertex"||t==="compute"){const s=this.getAttributesArray();let i=0;for(const n of s)e+=`layout( location = ${i++} ) in ${n.type} ${n.name};
`}return e}getStructMembers(t){const e=[],s=t.getMemberTypes();for(let i=0;i<s.length;i++){const n=s[i];e.push(`layout( location = ${i} ) out ${n} m${i};`)}return e.join(`
`)}getStructs(t){const e=[],s=this.structs[t];if(s.length===0)return`layout( location = 0 ) out vec4 fragColor;
`;for(let i=0,n=s.length;i<n;i++){const r=s[i];let a=`
`;a+=this.getStructMembers(r),a+=`
`,e.push(a)}return e.join(`

`)}getVaryings(t){let e="";const s=this.varyings;if(t==="vertex"||t==="compute")for(const i of s){t==="compute"&&(i.needsInterpolation=!0);const n=this.getType(i.type),r=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";e+=`${r}${i.needsInterpolation?"out":"/*out*/"} ${n} ${i.name};
`}else if(t==="fragment"){for(const i of s)if(i.needsInterpolation){const n=this.getType(i.type),r=n.includes("int")||n.includes("uv")||n.includes("iv")?"flat ":"";e+=`${r}in ${n} ${i.name};
`}}for(const i of this.builtins[t])e+=`${i};
`;return e}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((s,i)=>s*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(t,e,s=this.shaderStage){const i=this.extensions[s]||(this.extensions[s]=new Map);i.has(t)===!1&&i.set(t,{name:t,behavior:e})}getExtensions(t){const e=[];if(t==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",t)}const s=this.extensions[t];if(s!==void 0)for(const{name:i,behavior:n}of s.values())e.push(`#extension ${i} : ${n}`);return e.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(t){let e=i5[t];if(e===void 0){let s;switch(e=!1,t){case"float32Filterable":s="OES_texture_float_linear";break;case"clipDistance":s="WEBGL_clip_cull_distance";break}if(s!==void 0){const i=this.renderer.backend.extensions;i.has(s)&&(i.get(s),e=!0)}i5[t]=e}return e}isFlipY(){return!0}enableHardwareClipping(t){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${t} ]`)}registerTransform(t,e){this.transforms.push({varyingName:t,attributeNode:e})}getTransforms(){const t=this.transforms;let e="";for(let s=0;s<t.length;s++){const i=t[s],n=this.getPropertyName(i.attributeNode);e+=`${i.varyingName} = ${n};
	`}return e}_getGLSLUniformStruct(t,e){return`
layout( std140 ) uniform ${t} {
${e}
};`}_getGLSLVertexCode(t){return`#version 300 es

${this.getSignature()}

// extensions 
${t.extensions}

// precision
${n5}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// attributes
${t.attributes}

// codes
${t.codes}

void main() {

	// vars
	${t.vars}

	// transforms
	${t.transforms}

	// flow
	${t.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(t){return`#version 300 es

${this.getSignature()}

// precision
${n5}

// uniforms
${t.uniforms}

// varyings
${t.varyings}

// codes
${t.codes}

${t.structs}

void main() {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){let s=`// code

`;s+=this.flowCode[e];const i=this.flowNodes[e],n=i[i.length-1];for(const a of i){const c=this.getFlowData(a),l=a.name;l&&(s.length>0&&(s+=`
`),s+=`	// flow -> ${l}
	`),s+=`${c.code}
	`,a===n&&e!=="compute"&&(s+=`// result
	`,e==="vertex"?(s+="gl_Position = ",s+=`${c.result};`):e==="fragment"&&(a.outputNode.isOutputStructNode||(s+="fragColor = ",s+=`${c.result};`)))}const r=t[e];r.extensions=this.getExtensions(e),r.uniforms=this.getUniforms(e),r.attributes=this.getAttributes(e),r.varyings=this.getVaryings(e),r.vars=this.getVars(e),r.structs=this.getStructs(e),r.codes=this.getCodes(e),r.transforms=this.getTransforms(e),r.flow=s}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(t.vertex),this.fragmentShader=this._getGLSLFragmentCode(t.fragment)):this.computeShader=this._getGLSLVertexCode(t.compute)}getUniformFromNode(t,e,s,i=null){const n=super.getUniformFromNode(t,e,s,i),r=this.getDataFromNode(t,s,this.globalCache);let a=r.uniformGPU;if(a===void 0){const c=t.groupNode,l=c.name,u=this.getBindGroupArray(l,s);if(e==="texture")a=new Zl(n.name,n.node,c),u.push(a);else if(e==="cubeTexture")a=new Sd(n.name,n.node,c),u.push(a);else if(e==="texture3D")a=new Td(n.name,n.node,c),u.push(a);else if(e==="buffer"){t.name=`NodeBuffer_${t.id}`,n.name=`buffer${t.id}`;const p=new vd(t,c);p.name=t.name,u.push(p),a=p}else{const p=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=p[l];h===void 0&&(h=new _d(s+"_"+l,c),p[l]=h,u.push(h)),a=this.getNodeUniform(n,e),h.addUniform(a)}r.uniformGPU=a}return n}}let eu=null,su=null,Jo=null;class Md{constructor(t={}){this.parameters=Object.assign({},t),this.data=new WeakMap,this.renderer=null,this.domElement=null}async init(t){this.renderer=t}begin(){}finish(){}draw(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}createRenderPipeline(){}createComputePipeline(){}destroyPipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}createDefaultTexture(){}createTexture(){}copyTextureToBuffer(){}createAttribute(){}createIndexAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}resolveTimestampAsync(){}hasFeatureAsync(){}hasFeature(){}getInstanceCount(t){const{object:e,geometry:s}=t;return s.isInstancedBufferGeometry?s.instanceCount:e.count>1?e.count:1}getDrawingBufferSize(){return eu=eu||new Y,this.renderer.getDrawingBufferSize(eu)}getScissor(){return su=su||new vt,this.renderer.getScissor(su)}setScissorTest(){}getClearColor(){const t=this.renderer;return Jo=Jo||new J2,t.getClearColor(Jo),Jo.getRGB(Jo,this.renderer.currentColorSpace),Jo}getDomElement(){let t=this.domElement;return t===null&&(t=this.parameters.canvas!==void 0?this.parameters.canvas:pf(),"setAttribute"in t&&t.setAttribute("data-engine",`three.js r${wl} webgpu`),this.domElement=t),t}set(t,e){this.data.set(t,e)}get(t){let e=this.data.get(t);return e===void 0&&(e={},this.data.set(t,e)),e}has(t){return this.data.has(t)}delete(t){this.data.delete(t)}dispose(){}}let oM=0;class rM{constructor(t,e){this.buffers=[t.bufferGPU,e],this.type=t.type,this.bufferType=t.bufferType,this.pbo=t.pbo,this.byteLength=t.byteLength,this.bytesPerElement=t.BYTES_PER_ELEMENT,this.version=t.version,this.isInteger=t.isInteger,this.activeBufferIndex=0,this.baseId=t.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class aM{constructor(t){this.backend=t}createAttribute(t,e){const s=this.backend,{gl:i}=s,n=t.array,r=t.usage||i.STATIC_DRAW,a=t.isInterleavedBufferAttribute?t.data:t,c=s.get(a);let l=c.bufferGPU;l===void 0&&(l=this._createBuffer(i,e,n,r),c.bufferGPU=l,c.bufferType=e,c.version=a.version);let u;if(n instanceof Float32Array)u=i.FLOAT;else if(n instanceof Uint16Array)t.isFloat16BufferAttribute?u=i.HALF_FLOAT:u=i.UNSIGNED_SHORT;else if(n instanceof Int16Array)u=i.SHORT;else if(n instanceof Uint32Array)u=i.UNSIGNED_INT;else if(n instanceof Int32Array)u=i.INT;else if(n instanceof Int8Array)u=i.BYTE;else if(n instanceof Uint8Array)u=i.UNSIGNED_BYTE;else if(n instanceof Uint8ClampedArray)u=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+n);let p={bufferGPU:l,bufferType:e,type:u,byteLength:n.byteLength,bytesPerElement:n.BYTES_PER_ELEMENT,version:t.version,pbo:t.pbo,isInteger:u===i.INT||u===i.UNSIGNED_INT||t.gpuType===Ze,id:oM++};if(t.isStorageBufferAttribute||t.isStorageInstancedBufferAttribute){const h=this._createBuffer(i,e,n,r);p=new rM(p,h)}s.set(t,p)}updateAttribute(t){const e=this.backend,{gl:s}=e,i=t.array,n=t.isInterleavedBufferAttribute?t.data:t,r=e.get(n),a=r.bufferType,c=t.isInterleavedBufferAttribute?t.data.updateRanges:t.updateRanges;if(s.bindBuffer(a,r.bufferGPU),c.length===0)s.bufferSubData(a,0,i);else{for(let l=0,u=c.length;l<u;l++){const p=c[l];s.bufferSubData(a,p.start*i.BYTES_PER_ELEMENT,i,p.start,p.count)}n.clearUpdateRanges()}s.bindBuffer(a,null),r.version=n.version}destroyAttribute(t){const e=this.backend,{gl:s}=e;t.isInterleavedBufferAttribute&&e.delete(t.data);const i=e.get(t);s.deleteBuffer(i.bufferGPU),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,{gl:s}=e,i=t.isInterleavedBufferAttribute?t.data:t,{bufferGPU:n}=e.get(i),r=t.array,a=r.byteLength;s.bindBuffer(s.COPY_READ_BUFFER,n);const c=s.createBuffer();s.bindBuffer(s.COPY_WRITE_BUFFER,c),s.bufferData(s.COPY_WRITE_BUFFER,a,s.STREAM_READ),s.copyBufferSubData(s.COPY_READ_BUFFER,s.COPY_WRITE_BUFFER,0,0,a),await e.utils._clientWaitAsync();const l=new t.array.constructor(r.length);return s.bindBuffer(s.COPY_WRITE_BUFFER,c),s.getBufferSubData(s.COPY_WRITE_BUFFER,0,l),s.deleteBuffer(c),s.bindBuffer(s.COPY_READ_BUFFER,null),s.bindBuffer(s.COPY_WRITE_BUFFER,null),l.buffer}_createBuffer(t,e,s,i){const n=t.createBuffer();return t.bindBuffer(e,n),t.bufferData(e,s,i),t.bindBuffer(e,null),n}}let o5=!1,iu,pa;class cM{constructor(t){this.backend=t,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},o5===!1&&(this._init(this.gl),o5=!0)}_init(t){iu={[mn]:t.FUNC_ADD,[Z5]:t.FUNC_SUBTRACT,[j5]:t.FUNC_REVERSE_SUBTRACT},pa={[K5]:t.ZERO,[J5]:t.ONE,[Q5]:t.SRC_COLOR,[Wc]:t.SRC_ALPHA,[o4]:t.SRC_ALPHA_SATURATE,[i4]:t.DST_COLOR,[e4]:t.DST_ALPHA,[t4]:t.ONE_MINUS_SRC_COLOR,[$c]:t.ONE_MINUS_SRC_ALPHA,[n4]:t.ONE_MINUS_DST_COLOR,[s4]:t.ONE_MINUS_DST_ALPHA}}enable(t){const{enabled:e}=this;e[t]!==!0&&(this.gl.enable(t),e[t]=!0)}disable(t){const{enabled:e}=this;e[t]!==!1&&(this.gl.disable(t),e[t]=!1)}setFlipSided(t){if(this.currentFlipSided!==t){const{gl:e}=this;t?e.frontFace(e.CW):e.frontFace(e.CCW),this.currentFlipSided=t}}setCullFace(t){const{gl:e}=this;t!==ug?(this.enable(e.CULL_FACE),t!==this.currentCullFace&&(t===pg?e.cullFace(e.BACK):t===hg?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):this.disable(e.CULL_FACE),this.currentCullFace=t}setLineWidth(t){const{currentLineWidth:e,gl:s}=this;t!==e&&(s.lineWidth(t),this.currentLineWidth=t)}setBlending(t,e,s,i,n,r,a,c){const{gl:l}=this;if(t===fo){this.currentBlendingEnabled===!0&&(this.disable(l.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(l.BLEND),this.currentBlendingEnabled=!0),t!==X5){if(t!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==mn||this.currentBlendEquationAlpha!==mn)&&(l.blendEquation(l.FUNC_ADD),this.currentBlendEquation=mn,this.currentBlendEquationAlpha=mn),c)switch(t){case Tn:l.blendFuncSeparate(l.ONE,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case Jt:l.blendFunc(l.ONE,l.ONE);break;case Gc:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case Oc:l.blendFuncSeparate(l.ZERO,l.SRC_COLOR,l.ZERO,l.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}else switch(t){case Tn:l.blendFuncSeparate(l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA);break;case Jt:l.blendFunc(l.SRC_ALPHA,l.ONE);break;case Gc:l.blendFuncSeparate(l.ZERO,l.ONE_MINUS_SRC_COLOR,l.ZERO,l.ONE);break;case Oc:l.blendFunc(l.ZERO,l.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",t);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=t,this.currentPremultipledAlpha=c}return}n=n||e,r=r||s,a=a||i,(e!==this.currentBlendEquation||n!==this.currentBlendEquationAlpha)&&(l.blendEquationSeparate(iu[e],iu[n]),this.currentBlendEquation=e,this.currentBlendEquationAlpha=n),(s!==this.currentBlendSrc||i!==this.currentBlendDst||r!==this.currentBlendSrcAlpha||a!==this.currentBlendDstAlpha)&&(l.blendFuncSeparate(pa[s],pa[i],pa[r],pa[a]),this.currentBlendSrc=s,this.currentBlendDst=i,this.currentBlendSrcAlpha=r,this.currentBlendDstAlpha=a),this.currentBlending=t,this.currentPremultipledAlpha=!1}setColorMask(t){this.currentColorMask!==t&&(this.gl.colorMask(t,t,t,t),this.currentColorMask=t)}setDepthTest(t){const{gl:e}=this;t?this.enable(e.DEPTH_TEST):this.disable(e.DEPTH_TEST)}setDepthMask(t){this.currentDepthMask!==t&&(this.gl.depthMask(t),this.currentDepthMask=t)}setDepthFunc(t){if(this.currentDepthFunc!==t){const{gl:e}=this;switch(t){case r4:e.depthFunc(e.NEVER);break;case a4:e.depthFunc(e.ALWAYS);break;case c4:e.depthFunc(e.LESS);break;case Hc:e.depthFunc(e.LEQUAL);break;case l4:e.depthFunc(e.EQUAL);break;case u4:e.depthFunc(e.GEQUAL);break;case p4:e.depthFunc(e.GREATER);break;case h4:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}this.currentDepthFunc=t}}setStencilTest(t){const{gl:e}=this;t?this.enable(e.STENCIL_TEST):this.disable(e.STENCIL_TEST)}setStencilMask(t){this.currentStencilMask!==t&&(this.gl.stencilMask(t),this.currentStencilMask=t)}setStencilFunc(t,e,s){(this.currentStencilFunc!==t||this.currentStencilRef!==e||this.currentStencilFuncMask!==s)&&(this.gl.stencilFunc(t,e,s),this.currentStencilFunc=t,this.currentStencilRef=e,this.currentStencilFuncMask=s)}setStencilOp(t,e,s){(this.currentStencilFail!==t||this.currentStencilZFail!==e||this.currentStencilZPass!==s)&&(this.gl.stencilOp(t,e,s),this.currentStencilFail=t,this.currentStencilZFail=e,this.currentStencilZPass=s)}setMaterial(t,e,s){const{gl:i}=this;t.side===Kt?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let n=t.side===ls;e&&(n=!n),this.setFlipSided(n),t.blending===Tn&&t.transparent===!1?this.setBlending(fo):this.setBlending(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha),this.setDepthFunc(t.depthFunc),this.setDepthTest(t.depthTest),this.setDepthMask(t.depthWrite),this.setColorMask(t.colorWrite);const r=t.stencilWrite;if(this.setStencilTest(r),r&&(this.setStencilMask(t.stencilWriteMask),this.setStencilFunc(t.stencilFunc,t.stencilRef,t.stencilFuncMask),this.setStencilOp(t.stencilFail,t.stencilZFail,t.stencilZPass)),this.setPolygonOffset(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits),t.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),s>0&&this.currentClippingPlanes!==s)for(let c=0;c<8;c++)c<s?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(t,e,s){const{gl:i}=this;t?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==e||this.currentPolygonOffsetUnits!==s)&&(i.polygonOffset(e,s),this.currentPolygonOffsetFactor=e,this.currentPolygonOffsetUnits=s)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(t){return this.currentProgram!==t?(this.gl.useProgram(t),this.currentProgram=t,!0):!1}bindFramebuffer(t,e){const{gl:s,currentBoundFramebuffers:i}=this;return i[t]!==e?(s.bindFramebuffer(t,e),i[t]=e,t===s.DRAW_FRAMEBUFFER&&(i[s.FRAMEBUFFER]=e),t===s.FRAMEBUFFER&&(i[s.DRAW_FRAMEBUFFER]=e),!0):!1}drawBuffers(t,e){const{gl:s}=this;let i=[],n=!1;if(t.textures!==null){i=this.currentDrawbuffers.get(e),i===void 0&&(i=[],this.currentDrawbuffers.set(e,i));const r=t.textures;if(i.length!==r.length||i[0]!==s.COLOR_ATTACHMENT0){for(let a=0,c=r.length;a<c;a++)i[a]=s.COLOR_ATTACHMENT0+a;i.length=r.length,n=!0}}else i[0]!==s.BACK&&(i[0]=s.BACK,n=!0);n&&s.drawBuffers(i)}activeTexture(t){const{gl:e,currentTextureSlot:s,maxTextures:i}=this;t===void 0&&(t=e.TEXTURE0+i-1),s!==t&&(e.activeTexture(t),this.currentTextureSlot=t)}bindTexture(t,e,s){const{gl:i,currentTextureSlot:n,currentBoundTextures:r,maxTextures:a}=this;s===void 0&&(n===null?s=i.TEXTURE0+a-1:s=n);let c=r[s];c===void 0&&(c={type:void 0,texture:void 0},r[s]=c),(c.type!==t||c.texture!==e)&&(n!==s&&(i.activeTexture(s),this.currentTextureSlot=s),i.bindTexture(t,e),c.type=t,c.texture=e)}bindBufferBase(t,e,s){const{gl:i}=this,n=`${t}-${e}`;return this.currentBoundBufferBases[n]!==s?(i.bindBufferBase(t,e,s),this.currentBoundBufferBases[n]=s,!0):!1}unbindTexture(){const{gl:t,currentTextureSlot:e,currentBoundTextures:s}=this,i=s[e];i!==void 0&&i.type!==void 0&&(t.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}}class lM{constructor(t){this.backend=t,this.gl=this.backend.gl,this.extensions=t.extensions}convert(t,e=yo){const{gl:s,extensions:i}=this;let n;if(t===Mn)return s.UNSIGNED_BYTE;if(t===Mg)return s.UNSIGNED_SHORT_4_4_4_4;if(t===Ag)return s.UNSIGNED_SHORT_5_5_5_1;if(t===g4)return s.UNSIGNED_INT_5_9_9_9_REV;if(t===va)return s.BYTE;if(t===_a)return s.SHORT;if(t===dr)return s.UNSIGNED_SHORT;if(t===Ze)return s.INT;if(t===Pe)return s.UNSIGNED_INT;if(t===ns)return s.FLOAT;if(t===Qs)return s.HALF_FLOAT;if(t===Ng)return s.ALPHA;if(t===Up)return s.RGB;if(t===Cn)return s.RGBA;if(t===Cg)return s.LUMINANCE;if(t===Fg)return s.LUMINANCE_ALPHA;if(t===ro)return s.DEPTH_COMPONENT;if(t===Er)return s.DEPTH_STENCIL;if(t===vl)return s.RED;if(t===zp)return s.RED_INTEGER;if(t===ka)return s.RG;if(t===kp)return s.RG_INTEGER;if(t===Vp)return s.RGBA_INTEGER;if(t===s1||t===Mc||t===Ac||t===Nc)if(e===et)if(n=i.get("WEBGL_compressed_texture_s3tc_srgb"),n!==null){if(t===s1)return n.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(t===Mc)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(t===Ac)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(t===Nc)return n.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(n=i.get("WEBGL_compressed_texture_s3tc"),n!==null){if(t===s1)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(t===Mc)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(t===Ac)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(t===Nc)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(t===Th||t===Mh||t===Ah||t===Nh)if(n=i.get("WEBGL_compressed_texture_pvrtc"),n!==null){if(t===Th)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(t===Mh)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(t===Ah)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(t===Nh)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(t===Ch||t===Eu||t===Du)if(n=i.get("WEBGL_compressed_texture_etc"),n!==null){if(t===Ch||t===Eu)return e===et?n.COMPRESSED_SRGB8_ETC2:n.COMPRESSED_RGB8_ETC2;if(t===Du)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:n.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(t===Bu||t===Pu||t===Iu||t===Lu||t===Uu||t===zu||t===ku||t===Vu||t===Gu||t===Ou||t===Wu||t===$u||t===Hu||t===qu)if(n=i.get("WEBGL_compressed_texture_astc"),n!==null){if(t===Bu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:n.COMPRESSED_RGBA_ASTC_4x4_KHR;if(t===Pu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:n.COMPRESSED_RGBA_ASTC_5x4_KHR;if(t===Iu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:n.COMPRESSED_RGBA_ASTC_5x5_KHR;if(t===Lu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:n.COMPRESSED_RGBA_ASTC_6x5_KHR;if(t===Uu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:n.COMPRESSED_RGBA_ASTC_6x6_KHR;if(t===zu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:n.COMPRESSED_RGBA_ASTC_8x5_KHR;if(t===ku)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:n.COMPRESSED_RGBA_ASTC_8x6_KHR;if(t===Vu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:n.COMPRESSED_RGBA_ASTC_8x8_KHR;if(t===Gu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:n.COMPRESSED_RGBA_ASTC_10x5_KHR;if(t===Ou)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:n.COMPRESSED_RGBA_ASTC_10x6_KHR;if(t===Wu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:n.COMPRESSED_RGBA_ASTC_10x8_KHR;if(t===$u)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:n.COMPRESSED_RGBA_ASTC_10x10_KHR;if(t===Hu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:n.COMPRESSED_RGBA_ASTC_12x10_KHR;if(t===qu)return e===et?n.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:n.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(t===i1)if(n=i.get("EXT_texture_compression_bptc"),n!==null){if(t===i1)return e===et?n.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:n.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(t===Eg||t===Fh||t===Rh||t===Eh)if(n=i.get("EXT_texture_compression_rgtc"),n!==null){if(t===i1)return n.COMPRESSED_RED_RGTC1_EXT;if(t===Fh)return n.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(t===Rh)return n.COMPRESSED_RED_GREEN_RGTC2_EXT;if(t===Eh)return n.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return t===n0?s.UNSIGNED_INT_24_8:s[t]!==void 0?s[t]:null}_clientWaitAsync(){const{gl:t}=this,e=t.fenceSync(t.SYNC_GPU_COMMANDS_COMPLETE,0);return t.flush(),new Promise((s,i)=>{function n(){const r=t.clientWaitSync(e,t.SYNC_FLUSH_COMMANDS_BIT,0);if(r===t.WAIT_FAILED){t.deleteSync(e),i();return}if(r===t.TIMEOUT_EXPIRED){requestAnimationFrame(n);return}t.deleteSync(e),s()}n()})}}let r5=!1,lc,nu,a5;class uM{constructor(t){this.backend=t,this.gl=t.gl,this.extensions=t.extensions,this.defaultTextures={},r5===!1&&(this._init(this.gl),r5=!0)}_init(t){lc={[Nn]:t.REPEAT,[bn]:t.CLAMP_TO_EDGE,[Rr]:t.MIRRORED_REPEAT},nu={[Fe]:t.NEAREST,[Fu]:t.NEAREST_MIPMAP_NEAREST,[Tr]:t.NEAREST_MIPMAP_LINEAR,[Je]:t.LINEAR,[Ru]:t.LINEAR_MIPMAP_NEAREST,[Gi]:t.LINEAR_MIPMAP_LINEAR},a5={[f4]:t.NEVER,[v4]:t.ALWAYS,[Gp]:t.LESS,[y4]:t.LEQUAL,[m4]:t.EQUAL,[b4]:t.GEQUAL,[x4]:t.GREATER,[w4]:t.NOTEQUAL}}filterFallback(t){const{gl:e}=this;return t===Fe||t===Fu||t===Tr?e.NEAREST:e.LINEAR}getGLTextureType(t){const{gl:e}=this;let s;return t.isCubeTexture===!0?s=e.TEXTURE_CUBE_MAP:t.isDataArrayTexture===!0||t.isCompressedArrayTexture===!0?s=e.TEXTURE_2D_ARRAY:t.isData3DTexture===!0?s=e.TEXTURE_3D:s=e.TEXTURE_2D,s}getInternalFormat(t,e,s,i,n=!1){const{gl:r,extensions:a}=this;if(t!==null){if(r[t]!==void 0)return r[t];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+t+"'")}let c=e;return e===r.RED&&(s===r.FLOAT&&(c=r.R32F),s===r.HALF_FLOAT&&(c=r.R16F),s===r.UNSIGNED_BYTE&&(c=r.R8),s===r.UNSIGNED_SHORT&&(c=r.R16),s===r.UNSIGNED_INT&&(c=r.R32UI),s===r.BYTE&&(c=r.R8I),s===r.SHORT&&(c=r.R16I),s===r.INT&&(c=r.R32I)),e===r.RED_INTEGER&&(s===r.UNSIGNED_BYTE&&(c=r.R8UI),s===r.UNSIGNED_SHORT&&(c=r.R16UI),s===r.UNSIGNED_INT&&(c=r.R32UI),s===r.BYTE&&(c=r.R8I),s===r.SHORT&&(c=r.R16I),s===r.INT&&(c=r.R32I)),e===r.RG&&(s===r.FLOAT&&(c=r.RG32F),s===r.HALF_FLOAT&&(c=r.RG16F),s===r.UNSIGNED_BYTE&&(c=r.RG8),s===r.UNSIGNED_SHORT&&(c=r.RG16),s===r.UNSIGNED_INT&&(c=r.RG32UI),s===r.BYTE&&(c=r.RG8I),s===r.SHORT&&(c=r.RG16I),s===r.INT&&(c=r.RG32I)),e===r.RG_INTEGER&&(s===r.UNSIGNED_BYTE&&(c=r.RG8UI),s===r.UNSIGNED_SHORT&&(c=r.RG16UI),s===r.UNSIGNED_INT&&(c=r.RG32UI),s===r.BYTE&&(c=r.RG8I),s===r.SHORT&&(c=r.RG16I),s===r.INT&&(c=r.RG32I)),e===r.RGB&&(s===r.FLOAT&&(c=r.RGB32F),s===r.HALF_FLOAT&&(c=r.RGB16F),s===r.UNSIGNED_BYTE&&(c=r.RGB8),s===r.UNSIGNED_SHORT&&(c=r.RGB16),s===r.UNSIGNED_INT&&(c=r.RGB32UI),s===r.BYTE&&(c=r.RGB8I),s===r.SHORT&&(c=r.RGB16I),s===r.INT&&(c=r.RGB32I),s===r.UNSIGNED_BYTE&&(c=i===et&&n===!1?r.SRGB8:r.RGB8),s===r.UNSIGNED_SHORT_5_6_5&&(c=r.RGB565),s===r.UNSIGNED_SHORT_5_5_5_1&&(c=r.RGB5_A1),s===r.UNSIGNED_SHORT_4_4_4_4&&(c=r.RGB4),s===r.UNSIGNED_INT_5_9_9_9_REV&&(c=r.RGB9_E5)),e===r.RGB_INTEGER&&(s===r.UNSIGNED_BYTE&&(c=r.RGB8UI),s===r.UNSIGNED_SHORT&&(c=r.RGB16UI),s===r.UNSIGNED_INT&&(c=r.RGB32UI),s===r.BYTE&&(c=r.RGB8I),s===r.SHORT&&(c=r.RGB16I),s===r.INT&&(c=r.RGB32I)),e===r.RGBA&&(s===r.FLOAT&&(c=r.RGBA32F),s===r.HALF_FLOAT&&(c=r.RGBA16F),s===r.UNSIGNED_BYTE&&(c=r.RGBA8),s===r.UNSIGNED_SHORT&&(c=r.RGBA16),s===r.UNSIGNED_INT&&(c=r.RGBA32UI),s===r.BYTE&&(c=r.RGBA8I),s===r.SHORT&&(c=r.RGBA16I),s===r.INT&&(c=r.RGBA32I),s===r.UNSIGNED_BYTE&&(c=i===et&&n===!1?r.SRGB8_ALPHA8:r.RGBA8),s===r.UNSIGNED_SHORT_4_4_4_4&&(c=r.RGBA4),s===r.UNSIGNED_SHORT_5_5_5_1&&(c=r.RGB5_A1)),e===r.RGBA_INTEGER&&(s===r.UNSIGNED_BYTE&&(c=r.RGBA8UI),s===r.UNSIGNED_SHORT&&(c=r.RGBA16UI),s===r.UNSIGNED_INT&&(c=r.RGBA32UI),s===r.BYTE&&(c=r.RGBA8I),s===r.SHORT&&(c=r.RGBA16I),s===r.INT&&(c=r.RGBA32I)),e===r.DEPTH_COMPONENT&&(s===r.UNSIGNED_INT&&(c=r.DEPTH24_STENCIL8),s===r.FLOAT&&(c=r.DEPTH_COMPONENT32F)),e===r.DEPTH_STENCIL&&s===r.UNSIGNED_INT_24_8&&(c=r.DEPTH24_STENCIL8),(c===r.R16F||c===r.R32F||c===r.RG16F||c===r.RG32F||c===r.RGBA16F||c===r.RGBA32F)&&a.get("EXT_color_buffer_float"),c}setTextureParameters(t,e){const{gl:s,extensions:i,backend:n}=this;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e.flipY),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),s.pixelStorei(s.UNPACK_ALIGNMENT,e.unpackAlignment),s.pixelStorei(s.UNPACK_COLORSPACE_CONVERSION_WEBGL,s.NONE),s.texParameteri(t,s.TEXTURE_WRAP_S,lc[e.wrapS]),s.texParameteri(t,s.TEXTURE_WRAP_T,lc[e.wrapT]),(t===s.TEXTURE_3D||t===s.TEXTURE_2D_ARRAY)&&s.texParameteri(t,s.TEXTURE_WRAP_R,lc[e.wrapR]),s.texParameteri(t,s.TEXTURE_MAG_FILTER,nu[e.magFilter]);const r=e.mipmaps!==void 0&&e.mipmaps.length>0,a=e.minFilter===Je&&r?Gi:e.minFilter;if(s.texParameteri(t,s.TEXTURE_MIN_FILTER,nu[a]),e.compareFunction&&(s.texParameteri(t,s.TEXTURE_COMPARE_MODE,s.COMPARE_REF_TO_TEXTURE),s.texParameteri(t,s.TEXTURE_COMPARE_FUNC,a5[e.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(e.magFilter===Fe||e.minFilter!==Tr&&e.minFilter!==Gi||e.type===ns&&i.has("OES_texture_float_linear")===!1)return;if(e.anisotropy>1){const c=i.get("EXT_texture_filter_anisotropic");s.texParameterf(t,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(e.anisotropy,n.getMaxAnisotropy()))}}}createDefaultTexture(t){const{gl:e,backend:s,defaultTextures:i}=this,n=this.getGLTextureType(t);let r=i[n];r===void 0&&(r=e.createTexture(),s.state.bindTexture(n,r),e.texParameteri(n,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(n,e.TEXTURE_MAG_FILTER,e.NEAREST),i[n]=r),s.set(t,{textureGPU:r,glTextureType:n,isDefault:!0})}createTexture(t,e){const{gl:s,backend:i}=this,{levels:n,width:r,height:a,depth:c}=e,l=i.utils.convert(t.format,t.colorSpace),u=i.utils.convert(t.type),p=this.getInternalFormat(t.internalFormat,l,u,t.colorSpace,t.isVideoTexture),h=s.createTexture(),d=this.getGLTextureType(t);i.state.bindTexture(d,h),this.setTextureParameters(d,t),t.isDataArrayTexture||t.isCompressedArrayTexture?s.texStorage3D(s.TEXTURE_2D_ARRAY,n,p,r,a,c):t.isData3DTexture?s.texStorage3D(s.TEXTURE_3D,n,p,r,a,c):t.isVideoTexture||s.texStorage2D(d,n,p,r,a),i.set(t,{textureGPU:h,glTextureType:d,glFormat:l,glType:u,glInternalFormat:p})}copyBufferToTexture(t,e){const{gl:s,backend:i}=this,{textureGPU:n,glTextureType:r,glFormat:a,glType:c}=i.get(e),{width:l,height:u}=e.source.data;s.bindBuffer(s.PIXEL_UNPACK_BUFFER,t),i.state.bindTexture(r,n),s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,!1),s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),s.texSubImage2D(r,0,0,0,l,u,a,c,0),s.bindBuffer(s.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(t,e){const{gl:s}=this,{width:i,height:n}=e,{textureGPU:r,glTextureType:a,glFormat:c,glType:l,glInternalFormat:u}=this.backend.get(t);if(t.isRenderTargetTexture||r===void 0)return;const p=h=>h.isDataTexture?h.image.data:typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap||h instanceof OffscreenCanvas?h:h.data;if(this.backend.state.bindTexture(a,r),this.setTextureParameters(a,t),t.isCompressedTexture){const h=t.mipmaps,d=e.image;for(let g=0;g<h.length;g++){const f=h[g];t.isCompressedArrayTexture?t.format!==s.RGBA?c!==null?s.compressedTexSubImage3D(s.TEXTURE_2D_ARRAY,g,0,0,0,f.width,f.height,d.depth,c,f.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):s.texSubImage3D(s.TEXTURE_2D_ARRAY,g,0,0,0,f.width,f.height,d.depth,c,l,f.data):c!==null?s.compressedTexSubImage2D(s.TEXTURE_2D,g,0,0,f.width,f.height,c,f.data):console.warn("Unsupported compressed texture format")}}else if(t.isCubeTexture){const h=e.images;for(let d=0;d<6;d++){const g=p(h[d]);s.texSubImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+d,0,0,0,i,n,c,l,g)}}else if(t.isDataArrayTexture){const h=e.image;s.texSubImage3D(s.TEXTURE_2D_ARRAY,0,0,0,0,h.width,h.height,h.depth,c,l,h.data)}else if(t.isData3DTexture){const h=e.image;s.texSubImage3D(s.TEXTURE_3D,0,0,0,0,h.width,h.height,h.depth,c,l,h.data)}else if(t.isVideoTexture)t.update(),s.texImage2D(a,0,u,c,l,e.image);else{const h=p(e.image);s.texSubImage2D(a,0,0,0,i,n,c,l,h)}}generateMipmaps(t){const{gl:e,backend:s}=this,{textureGPU:i,glTextureType:n}=s.get(t);s.state.bindTexture(n,i),e.generateMipmap(n)}deallocateRenderBuffers(t){const{gl:e,backend:s}=this;if(t){const i=s.get(t);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const n in i.framebuffers)e.deleteFramebuffer(i.framebuffers[n]);delete i.framebuffers}if(i.depthRenderbuffer&&(e.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(e.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(e.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let n=0;n<i.msaaRenderbuffers.length;n++)e.deleteRenderbuffer(i.msaaRenderbuffers[n]);delete i.msaaRenderbuffers}}}destroyTexture(t){const{gl:e,backend:s}=this,{textureGPU:i,renderTarget:n}=s.get(t);this.deallocateRenderBuffers(n),e.deleteTexture(i),s.delete(t)}copyTextureToTexture(t,e,s=null,i=null,n=0){const{gl:r,backend:a}=this,{state:c}=this.backend,{textureGPU:l,glTextureType:u,glType:p,glFormat:h}=a.get(e);let d,g,f,m,x,w;s!==null?(d=s.max.x-s.min.x,g=s.max.y-s.min.y,f=s.min.x,m=s.min.y):(d=t.image.width,g=t.image.height,f=0,m=0),i!==null?(x=i.x,w=i.y):(x=0,w=0),c.bindTexture(u,l),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment),r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,e.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,e.unpackAlignment);const b=r.getParameter(r.UNPACK_ROW_LENGTH),v=r.getParameter(r.UNPACK_IMAGE_HEIGHT),T=r.getParameter(r.UNPACK_SKIP_PIXELS),M=r.getParameter(r.UNPACK_SKIP_ROWS),F=r.getParameter(r.UNPACK_SKIP_IMAGES),N=t.isCompressedTexture?t.mipmaps[n]:t.image;if(r.pixelStorei(r.UNPACK_ROW_LENGTH,N.width),r.pixelStorei(r.UNPACK_IMAGE_HEIGHT,N.height),r.pixelStorei(r.UNPACK_SKIP_PIXELS,f),r.pixelStorei(r.UNPACK_SKIP_ROWS,m),t.isRenderTargetTexture||t.isDepthTexture){const A=a.get(t),E=a.get(e),U=a.get(A.renderTarget),$=a.get(E.renderTarget),Z=U.framebuffers[A.cacheKey],j=$.framebuffers[E.cacheKey];c.bindFramebuffer(r.READ_FRAMEBUFFER,Z),c.bindFramebuffer(r.DRAW_FRAMEBUFFER,j);let ut=r.COLOR_BUFFER_BIT;t.isDepthTexture&&(ut=r.DEPTH_BUFFER_BIT),r.blitFramebuffer(f,m,d,g,x,w,d,g,ut,r.NEAREST),c.bindFramebuffer(r.READ_FRAMEBUFFER,null),c.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)}else t.isDataTexture?r.texSubImage2D(r.TEXTURE_2D,n,x,w,d,g,h,p,N.data):t.isCompressedTexture?r.compressedTexSubImage2D(r.TEXTURE_2D,n,x,w,N.width,N.height,h,N.data):r.texSubImage2D(r.TEXTURE_2D,n,x,w,d,g,h,p,N);r.pixelStorei(r.UNPACK_ROW_LENGTH,b),r.pixelStorei(r.UNPACK_IMAGE_HEIGHT,v),r.pixelStorei(r.UNPACK_SKIP_PIXELS,T),r.pixelStorei(r.UNPACK_SKIP_ROWS,M),r.pixelStorei(r.UNPACK_SKIP_IMAGES,F),n===0&&e.generateMipmaps&&r.generateMipmap(r.TEXTURE_2D),c.unbindTexture()}copyFramebufferToTexture(t,e,s){const{gl:i}=this,{state:n}=this.backend,{textureGPU:r}=this.backend.get(t),{x:a,y:c,z:l,w:u}=s,p=t.isDepthTexture===!0||e.renderTarget&&e.renderTarget.samples>0,h=e.renderTarget?e.renderTarget.height:this.backend.gerDrawingBufferSize().y;if(p){const d=a!==0||c!==0;let g,f;if(t.isDepthTexture===!0?(g=i.DEPTH_BUFFER_BIT,f=i.DEPTH_ATTACHMENT,e.stencil&&(g|=i.STENCIL_BUFFER_BIT)):(g=i.COLOR_BUFFER_BIT,f=i.COLOR_ATTACHMENT0),d){const m=this.backend.get(e.renderTarget),x=m.framebuffers[e.getCacheKey()],w=m.msaaFrameBuffer;n.bindFramebuffer(i.DRAW_FRAMEBUFFER,x),n.bindFramebuffer(i.READ_FRAMEBUFFER,w);const b=h-c-u;i.blitFramebuffer(a,b,a+l,b+u,a,b,a+l,b+u,g,i.NEAREST),n.bindFramebuffer(i.READ_FRAMEBUFFER,x),n.bindTexture(i.TEXTURE_2D,r),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,b,l,u),n.unbindTexture()}else{const m=i.createFramebuffer();n.bindFramebuffer(i.DRAW_FRAMEBUFFER,m),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,f,i.TEXTURE_2D,r,0),i.blitFramebuffer(0,0,l,u,0,0,l,u,g,i.NEAREST),i.deleteFramebuffer(m)}}else n.bindTexture(i.TEXTURE_2D,r),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,a,h-u-c,l,u),n.unbindTexture();t.generateMipmaps&&this.generateMipmaps(t),this.backend._setFramebuffer(e)}setupRenderBufferStorage(t,e){const{gl:s}=this,i=e.renderTarget,{samples:n,depthTexture:r,depthBuffer:a,stencilBuffer:c,width:l,height:u}=i;if(s.bindRenderbuffer(s.RENDERBUFFER,t),a&&!c){let p=s.DEPTH_COMPONENT24;n>0?(r&&r.isDepthTexture&&r.type===s.FLOAT&&(p=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,p,l,u)):s.renderbufferStorage(s.RENDERBUFFER,p,l,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t)}else a&&c&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,l,u):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,l,u),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,t))}async copyTextureToBuffer(t,e,s,i,n,r){const{backend:a,gl:c}=this,{textureGPU:l,glFormat:u,glType:p}=this.backend.get(t),h=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,h);const d=t.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+r:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,d,l,0);const g=this._getTypedArrayType(p),f=this._getBytesPerTexel(p,u),x=i*n*f,w=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,w),c.bufferData(c.PIXEL_PACK_BUFFER,x,c.STREAM_READ),c.readPixels(e,s,i,n,u,p,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await a.utils._clientWaitAsync();const b=new g(x/g.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,w),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,b),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(h),b}_getTypedArrayType(t){const{gl:e}=this;if(t===e.UNSIGNED_BYTE)return Uint8Array;if(t===e.UNSIGNED_SHORT_4_4_4_4||t===e.UNSIGNED_SHORT_5_5_5_1||t===e.UNSIGNED_SHORT_5_6_5||t===e.UNSIGNED_SHORT)return Uint16Array;if(t===e.UNSIGNED_INT)return Uint32Array;if(t===e.HALF_FLOAT)return Uint16Array;if(t===e.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${t}`)}_getBytesPerTexel(t,e){const{gl:s}=this;let i=0;if(t===s.UNSIGNED_BYTE&&(i=1),(t===s.UNSIGNED_SHORT_4_4_4_4||t===s.UNSIGNED_SHORT_5_5_5_1||t===s.UNSIGNED_SHORT_5_6_5||t===s.UNSIGNED_SHORT||t===s.HALF_FLOAT)&&(i=2),(t===s.UNSIGNED_INT||t===s.FLOAT)&&(i=4),e===s.RGBA)return i*4;if(e===s.RGB)return i*3;if(e===s.ALPHA)return i}}class pM{constructor(t){this.backend=t,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(t){let e=this.extensions[t];return e===void 0&&(e=this.gl.getExtension(t),this.extensions[t]=e),e}has(t){return this.availableExtensions.includes(t)}}class hM{constructor(t){this.backend=t,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const t=this.backend.gl,e=this.backend.extensions;if(e.has("EXT_texture_filter_anisotropic")===!0){const s=e.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=t.getParameter(s.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}}const c5={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};class dM{constructor(t){this.gl=t.gl,this.extensions=t.extensions,this.info=t.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(t,e){const{gl:s,mode:i,object:n,type:r,info:a,index:c}=this;c!==0?s.drawElements(i,e,r,t):s.drawArrays(i,t,e),a.update(n,e,i,1)}renderInstances(t,e,s){const{gl:i,mode:n,type:r,index:a,object:c,info:l}=this;s!==0&&(a!==0?i.drawElementsInstanced(n,e,r,t,s):i.drawArraysInstanced(n,t,e,s),l.update(c,e,n,s))}renderMultiDraw(t,e,s){const{extensions:i,mode:n,object:r,info:a}=this;if(s===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let l=0;l<s;l++)this.render(t[l],e[l]);else{this.index!==0?c.multiDrawElementsWEBGL(n,e,0,this.type,t,0,s):c.multiDrawArraysWEBGL(n,t,0,e,0,s);let l=0;for(let u=0;u<s;u++)l+=e[u];a.update(r,l,n,1)}}renderMultiDrawInstances(t,e,s,i){const{extensions:n,mode:r,object:a,info:c}=this;if(s===0)return;const l=n.get("WEBGL_multi_draw");if(l===null)for(let u=0;u<s;u++)this.renderInstances(t[u],e[u],i[u]);else{this.index!==0?l.multiDrawElementsInstancedWEBGL(r,e,0,this.type,t,0,i,0,s):l.multiDrawArraysInstancedWEBGL(r,t,0,e,0,i,0,s);let u=0;for(let p=0;p<s;p++)u+=e[p]*i[p];c.update(a,u,r,1)}}}class l5 extends Md{constructor(t={}){super(t),this.isWebGLBackend=!0}init(t){super.init(t);const e=this.parameters,s=e.context!==void 0?e.context:t.domElement.getContext("webgl2");function i(n){n.preventDefault();const r={api:"WebGL",message:n.statusMessage||"Unknown reason",reason:null,originalEvent:n};t.onDeviceLost(r)}this._onContextLost=i,t.domElement.addEventListener("webglcontextlost",i,!1),this.gl=s,this.extensions=new pM(this),this.capabilities=new hM(this),this.attributeUtils=new aM(this),this.textureUtils=new uM(this),this.bufferRenderer=new dM(this),this.state=new cM(this),this.utils=new lM(this),this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.trackTimestamp=e.trackTimestamp===!0,this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile"),this._knownBindings=new WeakSet,this._currentContext=null}get coordinateSystem(){return js}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}async waitForGPU(){await this.utils._clientWaitAsync()}initTimestampQuery(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(this.queryRunning){e.queryQueue||(e.queryQueue=[]),e.queryQueue.push(t);return}e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.activeQuery=null),e.activeQuery=this.gl.createQuery(),e.activeQuery!==null&&(this.gl.beginQuery(this.disjoint.TIME_ELAPSED_EXT,e.activeQuery),this.queryRunning=!0)}prepareTimestampBuffer(t){if(!this.disjoint||!this.trackTimestamp)return;const e=this.get(t);if(e.activeQuery&&(this.gl.endQuery(this.disjoint.TIME_ELAPSED_EXT),e.gpuQueries||(e.gpuQueries=[]),e.gpuQueries.push({query:e.activeQuery}),e.activeQuery=null,this.queryRunning=!1,e.queryQueue&&e.queryQueue.length>0)){const s=e.queryQueue.shift();this.initTimestampQuery(s)}}async resolveTimestampAsync(t,e="render"){if(!this.disjoint||!this.trackTimestamp)return;const s=this.get(t);s.gpuQueries||(s.gpuQueries=[]);for(let i=0;i<s.gpuQueries.length;i++){const n=s.gpuQueries[i],r=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT_AVAILABLE),a=this.gl.getParameter(this.disjoint.GPU_DISJOINT_EXT);if(r&&!a){const c=this.gl.getQueryParameter(n.query,this.gl.QUERY_RESULT),l=Number(c)/1e6;this.gl.deleteQuery(n.query),s.gpuQueries.splice(i,1),i--,this.renderer.info.updateTimestamp(e,l)}}}getContext(){return this.gl}beginRender(t){const{gl:e}=this,s=this.get(t);if(this.initTimestampQuery(t),s.previousContext=this._currentContext,this._currentContext=t,this._setFramebuffer(t),this.clear(t.clearColor,t.clearDepth,t.clearStencil,t,!1),t.viewport?this.updateViewport(t):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight),t.scissor){const{x:n,y:r,width:a,height:c}=t.scissorValue;e.scissor(n,t.height-c-r,a,c)}const i=t.occlusionQueryCount;i>0&&(s.currentOcclusionQueries=s.occlusionQueries,s.currentOcclusionQueryObjects=s.occlusionQueryObjects,s.lastOcclusionObject=null,s.occlusionQueries=new Array(i),s.occlusionQueryObjects=new Array(i),s.occlusionQueryIndex=0)}finishRender(t){const{gl:e,state:s}=this,i=this.get(t),n=i.previousContext,r=t.occlusionQueryCount;r>0&&(r>i.occlusionQueryIndex&&e.endQuery(e.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(t));const a=t.textures;if(a!==null)for(let c=0;c<a.length;c++){const l=a[c];l.generateMipmaps&&this.generateMipmaps(l)}if(this._currentContext=n,t.textures!==null&&t.renderTarget){const c=this.get(t.renderTarget),{samples:l}=t.renderTarget;if(l>0){const u=c.framebuffers[t.getCacheKey()],p=e.COLOR_BUFFER_BIT,h=c.msaaFrameBuffer,d=t.textures;s.bindFramebuffer(e.READ_FRAMEBUFFER,h),s.bindFramebuffer(e.DRAW_FRAMEBUFFER,u);for(let g=0;g<d.length;g++)if(t.scissor){const{x:f,y:m,width:x,height:w}=t.scissorValue,b=t.height-w-m;e.blitFramebuffer(f,b,f+x,b+w,f,b,f+x,b+w,p,e.NEAREST),e.invalidateSubFramebuffer(e.READ_FRAMEBUFFER,c.invalidationArray,f,b,x,w)}else e.blitFramebuffer(0,0,t.width,t.height,0,0,t.width,t.height,p,e.NEAREST),e.invalidateFramebuffer(e.READ_FRAMEBUFFER,c.invalidationArray)}}n!==null&&(this._setFramebuffer(n),n.viewport?this.updateViewport(n):e.viewport(0,0,e.drawingBufferWidth,e.drawingBufferHeight)),this.prepareTimestampBuffer(t)}resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueries:s,currentOcclusionQueryObjects:i}=e;if(s&&i){const n=new WeakSet,{gl:r}=this;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueries=null;const a=()=>{let c=0;for(let l=0;l<s.length;l++){const u=s[l];u!==null&&r.getQueryParameter(u,r.QUERY_RESULT_AVAILABLE)&&(r.getQueryParameter(u,r.QUERY_RESULT)>0&&n.add(i[l]),s[l]=null,r.deleteQuery(u),c++)}c<s.length?requestAnimationFrame(a):e.occluded=n};a()}}isOccluded(t,e){const s=this.get(t);return s.occluded&&s.occluded.has(e)}updateViewport(t){const e=this.gl,{x:s,y:i,width:n,height:r}=t.viewportValue;e.viewport(s,t.height-r-i,n,r)}setScissorTest(t){const e=this.gl;t?e.enable(e.SCISSOR_TEST):e.disable(e.SCISSOR_TEST)}clear(t,e,s,i=null,n=!0){const{gl:r}=this;if(i===null){const c=this.getClearColor();c.r*=c.a,c.g*=c.a,c.b*=c.a,i={textures:null,clearColorValue:c}}let a=0;if(t&&(a|=r.COLOR_BUFFER_BIT),e&&(a|=r.DEPTH_BUFFER_BIT),s&&(a|=r.STENCIL_BUFFER_BIT),a!==0){let c;if(i.clearColorValue?c=i.clearColorValue:(c=this.getClearColor(),c.r*=c.a,c.g*=c.a,c.b*=c.a),e&&this.state.setDepthMask(!0),i.textures===null)r.clearColor(c.r,c.g,c.b,c.a),r.clear(a);else{if(n&&this._setFramebuffer(i),t)for(let l=0;l<i.textures.length;l++)r.clearBufferfv(r.COLOR,l,[c.r,c.g,c.b,c.a]);e&&s?r.clearBufferfi(r.DEPTH_STENCIL,0,1,0):e?r.clearBufferfv(r.DEPTH,0,[1]):s&&r.clearBufferiv(r.STENCIL,0,[0])}}}beginCompute(t){const{state:e,gl:s}=this;e.bindFramebuffer(s.FRAMEBUFFER,null),this.initTimestampQuery(t)}compute(t,e,s,i){const{state:n,gl:r}=this;this.discard||(r.enable(r.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:a,transformBuffers:c,attributes:l}=this.get(i),u=this._getVaoKey(null,l),p=this.vaoCache[u];p===void 0?this._createVao(null,l):r.bindVertexArray(p),n.useProgram(a),this._bindUniforms(s);const h=this._getTransformFeedback(c);r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,h),r.beginTransformFeedback(r.POINTS),l[0].isStorageInstancedBufferAttribute?r.drawArraysInstanced(r.POINTS,0,1,e.count):r.drawArrays(r.POINTS,0,e.count),r.endTransformFeedback(),r.bindTransformFeedback(r.TRANSFORM_FEEDBACK,null);for(let d=0;d<c.length;d++){const g=c[d];g.pbo&&this.textureUtils.copyBufferToTexture(g.transformBuffer,g.pbo),g.switchBuffers()}}finishCompute(t){const e=this.gl;this.discard=!1,e.disable(e.RASTERIZER_DISCARD),this.prepareTimestampBuffer(t),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(t){const{object:e,pipeline:s,material:i,context:n,hardwareClippingPlanes:r}=t,{programGPU:a}=this.get(s),{gl:c,state:l}=this,u=this.get(n),p=t.getDrawParameters();if(p===null)return;this._bindUniforms(t.getBindings());const h=e.isMesh&&e.matrixWorld.determinant()<0;l.setMaterial(i,h,r),l.useProgram(a);const d=this.get(t);let g=d.staticVao;if(g===void 0||d.geometryId!==t.geometry.id){const T=this._getVaoKey(t.getIndex(),t.getAttributes());if(g=this.vaoCache[T],g===void 0){let M;({vaoGPU:g,staticVao:M}=this._createVao(t.getIndex(),t.getAttributes())),M&&(d.staticVao=g,d.geometryId=t.geometry.id)}}c.bindVertexArray(g);const f=t.getIndex(),m=u.lastOcclusionObject;if(m!==e&&m!==void 0){if(m!==null&&m.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),u.occlusionQueryIndex++),e.occlusionTest===!0){const T=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,T),u.occlusionQueries[u.occlusionQueryIndex]=T,u.occlusionQueryObjects[u.occlusionQueryIndex]=e}u.lastOcclusionObject=e}const x=this.bufferRenderer;e.isPoints?x.mode=c.POINTS:e.isLineSegments?x.mode=c.LINES:e.isLine?x.mode=c.LINE_STRIP:e.isLineLoop?x.mode=c.LINE_LOOP:i.wireframe===!0?(l.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),x.mode=c.LINES):x.mode=c.TRIANGLES;const{vertexCount:w,instanceCount:b}=p;let{firstVertex:v}=p;if(x.object=e,f!==null){v*=f.array.BYTES_PER_ELEMENT;const T=this.get(f);x.index=f.count,x.type=T.type}else x.index=0;e.isBatchedMesh?e._multiDrawInstances!==null?x.renderMultiDrawInstances(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount,e._multiDrawInstances):this.hasFeature("WEBGL_multi_draw")?x.renderMultiDraw(e._multiDrawStarts,e._multiDrawCounts,e._multiDrawCount):hf("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):b>1?x.renderInstances(v,w,b):x.render(v,w),c.bindVertexArray(null)}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,s,i,n,r){return this.textureUtils.copyTextureToBuffer(t,e,s,i,n,r)}createSampler(){}destroySampler(){}createNodeBuilder(t,e){return new nM(t,e)}createProgram(t){const e=this.gl,{stage:s,code:i}=t,n=s==="fragment"?e.createShader(e.FRAGMENT_SHADER):e.createShader(e.VERTEX_SHADER);e.shaderSource(n,i),e.compileShader(n),this.set(t,{shaderGPU:n})}destroyProgram(){console.warn("Abstract class.")}createRenderPipeline(t,e){const s=this.gl,i=t.pipeline,{fragmentProgram:n,vertexProgram:r}=i,a=s.createProgram(),c=this.get(n).shaderGPU,l=this.get(r).shaderGPU;if(s.attachShader(a,c),s.attachShader(a,l),s.linkProgram(a),this.set(i,{programGPU:a,fragmentShader:c,vertexShader:l}),e!==null&&this.parallel){const u=new Promise(p=>{const h=this.parallel,d=()=>{s.getProgramParameter(a,h.COMPLETION_STATUS_KHR)?(this._completeCompile(t,i),p()):requestAnimationFrame(d)};d()});e.push(u);return}this._completeCompile(t,i)}_handleSource(t,e){const s=t.split(`
`),i=[],n=Math.max(e-6,0),r=Math.min(e+6,s.length);for(let a=n;a<r;a++){const c=a+1;i.push(`${c===e?">":" "} ${c}: ${s[a]}`)}return i.join(`
`)}_getShaderErrors(t,e,s){const i=t.getShaderParameter(e,t.COMPILE_STATUS),n=t.getShaderInfoLog(e).trim();if(i&&n==="")return"";const r=/ERROR: 0:(\d+)/.exec(n);if(r){const a=parseInt(r[1]);return s.toUpperCase()+`

`+n+`

`+this._handleSource(t.getShaderSource(e),a)}else return n}_logProgramError(t,e,s){if(this.renderer.debug.checkShaderErrors){const i=this.gl,n=i.getProgramInfoLog(t).trim();if(i.getProgramParameter(t,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,t,s,e);else{const r=this._getShaderErrors(i,s,"vertex"),a=this._getShaderErrors(i,e,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(t,i.VALIDATE_STATUS)+`

Program Info Log: `+n+`
`+r+`
`+a)}else n!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",n)}}_completeCompile(t,e){const{state:s,gl:i}=this,n=this.get(e),{programGPU:r,fragmentShader:a,vertexShader:c}=n;i.getProgramParameter(r,i.LINK_STATUS)===!1&&this._logProgramError(r,a,c),s.useProgram(r);const l=t.getBindings();this._setupBindings(l,r),this.set(e,{programGPU:r})}createComputePipeline(t,e){const{state:s,gl:i}=this,n={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(n);const{computeProgram:r}=t,a=i.createProgram(),c=this.get(n).shaderGPU,l=this.get(r).shaderGPU,u=r.transforms,p=[],h=[];for(let m=0;m<u.length;m++){const x=u[m];p.push(x.varyingName),h.push(x.attributeNode)}i.attachShader(a,c),i.attachShader(a,l),i.transformFeedbackVaryings(a,p,i.SEPARATE_ATTRIBS),i.linkProgram(a),i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,c,l),s.useProgram(a),this._setupBindings(e,a);const d=r.attributes,g=[],f=[];for(let m=0;m<d.length;m++){const x=d[m].node.attribute;g.push(x),this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER)}for(let m=0;m<h.length;m++){const x=h[m].attribute;this.has(x)||this.attributeUtils.createAttribute(x,i.ARRAY_BUFFER);const w=this.get(x);f.push(w)}this.set(t,{programGPU:a,transformBuffers:f,attributes:g})}createBindings(t,e){if(this._knownBindings.has(e)===!1){this._knownBindings.add(e);let s=0,i=0;for(const n of e){this.set(n,{textures:i,uniformBuffers:s});for(const r of n.bindings)r.isUniformBuffer&&s++,r.isSampledTexture&&i++}}this.updateBindings(t,e)}updateBindings(t){const{gl:e}=this,s=this.get(t);let i=s.uniformBuffers,n=s.textures;for(const r of t.bindings)if(r.isUniformsGroup||r.isUniformBuffer){const a=r.buffer,c=e.createBuffer();e.bindBuffer(e.UNIFORM_BUFFER,c),e.bufferData(e.UNIFORM_BUFFER,a,e.DYNAMIC_DRAW),this.set(r,{index:i++,bufferGPU:c})}else if(r.isSampledTexture){const{textureGPU:a,glTextureType:c}=this.get(r.texture);this.set(r,{index:n++,textureGPU:a,glTextureType:c})}}updateBinding(t){const e=this.gl;if(t.isUniformsGroup||t.isUniformBuffer){const i=this.get(t).bufferGPU,n=t.buffer;e.bindBuffer(e.UNIFORM_BUFFER,i),e.bufferData(e.UNIFORM_BUFFER,n,e.DYNAMIC_DRAW)}}createIndexAttribute(t){const e=this.gl;this.attributeUtils.createAttribute(t,e.ELEMENT_ARRAY_BUFFER)}createAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}createStorageAttribute(t){if(this.has(t))return;const e=this.gl;this.attributeUtils.createAttribute(t,e.ARRAY_BUFFER)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){}hasFeature(t){const e=Object.keys(c5).filter(i=>c5[i]===t),s=this.extensions;for(let i=0;i<e.length;i++)if(s.has(e[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(t,e,s,i,n){this.textureUtils.copyTextureToTexture(t,e,s,i,n)}copyFramebufferToTexture(t,e,s){this.textureUtils.copyFramebufferToTexture(t,e,s)}_setFramebuffer(t){const{gl:e,state:s}=this;let i=null;if(t.textures!==null){const n=t.renderTarget,r=this.get(n),{samples:a,depthBuffer:c,stencilBuffer:l}=n,u=n.isWebGLCubeRenderTarget===!0;let p=r.msaaFrameBuffer,h=r.depthRenderbuffer;const d=w9(t);let g;if(u?(r.cubeFramebuffers||(r.cubeFramebuffers={}),g=r.cubeFramebuffers[d]):(r.framebuffers||(r.framebuffers={}),g=r.framebuffers[d]),g===void 0){g=e.createFramebuffer(),s.bindFramebuffer(e.FRAMEBUFFER,g);const f=t.textures;if(u){r.cubeFramebuffers[d]=g;const{textureGPU:m}=this.get(f[0]),x=this.renderer._activeCubeFace;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+x,m,0)}else{r.framebuffers[d]=g;for(let m=0;m<f.length;m++){const x=f[m],w=this.get(x);w.renderTarget=t.renderTarget,w.cacheKey=d;const b=e.COLOR_ATTACHMENT0+m;e.framebufferTexture2D(e.FRAMEBUFFER,b,e.TEXTURE_2D,w.textureGPU,0)}s.drawBuffers(t,g)}if(t.depthTexture!==null){const m=this.get(t.depthTexture),x=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;m.renderTarget=t.renderTarget,m.cacheKey=d,e.framebufferTexture2D(e.FRAMEBUFFER,x,e.TEXTURE_2D,m.textureGPU,0)}}if(a>0){if(p===void 0){const f=[];p=e.createFramebuffer(),s.bindFramebuffer(e.FRAMEBUFFER,p);const m=[],x=t.textures;for(let w=0;w<x.length;w++){if(m[w]=e.createRenderbuffer(),e.bindRenderbuffer(e.RENDERBUFFER,m[w]),f.push(e.COLOR_ATTACHMENT0+w),c){const T=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;f.push(T)}const b=t.textures[w],v=this.get(b);e.renderbufferStorageMultisample(e.RENDERBUFFER,a,v.glInternalFormat,t.width,t.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0+w,e.RENDERBUFFER,m[w])}if(r.msaaFrameBuffer=p,r.msaaRenderbuffers=m,h===void 0){h=e.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(h,t),r.depthRenderbuffer=h;const w=l?e.DEPTH_STENCIL_ATTACHMENT:e.DEPTH_ATTACHMENT;f.push(w)}r.invalidationArray=f}i=r.msaaFrameBuffer}else i=g}s.bindFramebuffer(e.FRAMEBUFFER,i)}_getVaoKey(t,e){let s=[];if(t!==null){const i=this.get(t);s+=":"+i.id}for(let i=0;i<e.length;i++){const n=this.get(e[i]);s+=":"+n.id}return s}_createVao(t,e){const{gl:s}=this,i=s.createVertexArray();let n="",r=!0;if(s.bindVertexArray(i),t!==null){const a=this.get(t);s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,a.bufferGPU),n+=":"+a.id}for(let a=0;a<e.length;a++){const c=e[a],l=this.get(c);n+=":"+l.id,s.bindBuffer(s.ARRAY_BUFFER,l.bufferGPU),s.enableVertexAttribArray(a),(c.isStorageBufferAttribute||c.isStorageInstancedBufferAttribute)&&(r=!1);let u,p;c.isInterleavedBufferAttribute===!0?(u=c.data.stride*l.bytesPerElement,p=c.offset*l.bytesPerElement):(u=0,p=0),l.isInteger?s.vertexAttribIPointer(a,c.itemSize,l.type,u,p):s.vertexAttribPointer(a,c.itemSize,l.type,c.normalized,u,p),c.isInstancedBufferAttribute&&!c.isInterleavedBufferAttribute?s.vertexAttribDivisor(a,c.meshPerAttribute):c.isInterleavedBufferAttribute&&c.data.isInstancedInterleavedBuffer&&s.vertexAttribDivisor(a,c.data.meshPerAttribute)}return s.bindBuffer(s.ARRAY_BUFFER,null),this.vaoCache[n]=i,{vaoGPU:i,staticVao:r}}_getTransformFeedback(t){let e="";for(let n=0;n<t.length;n++)e+=":"+t[n].id;let s=this.transformFeedbackCache[e];if(s!==void 0)return s;const{gl:i}=this;s=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,s);for(let n=0;n<t.length;n++){const r=t[n];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,n,r.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[e]=s,s}_setupBindings(t,e){const s=this.gl;for(const i of t)for(const n of i.bindings){const a=this.get(n).index;if(n.isUniformsGroup||n.isUniformBuffer){const c=s.getUniformBlockIndex(e,n.name);s.uniformBlockBinding(e,c,a)}else if(n.isSampledTexture){const c=s.getUniformLocation(e,n.name);s.uniform1i(c,a)}}}_bindUniforms(t){const{gl:e,state:s}=this;for(const i of t)for(const n of i.bindings){const r=this.get(n),a=r.index;n.isUniformsGroup||n.isUniformBuffer?s.bindBufferBase(e.UNIFORM_BUFFER,a,r.bufferGPU):n.isSampledTexture&&s.bindTexture(r.glTextureType,r.textureGPU,e.TEXTURE0+a)}}dispose(){this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const xr={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},De={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},Be={Store:"store"},ye={Load:"load",Clear:"clear"},ou={CCW:"ccw"},ru={None:"none",Front:"front",Back:"back"},Ur={Uint16:"uint16",Uint32:"uint32"},R={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},au={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},so={Linear:"linear",Nearest:"nearest"},lt={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},jn={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},u5={None:0,All:15},un={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},cu={Storage:"storage",ReadOnlyStorage:"read-only-storage"},lu={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},ha={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},p5={TwoD:"2d",ThreeD:"3d"},Es={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},gM={All:"all"},uc={Vertex:"vertex",Instance:"instance"},bp={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class fM extends gh{constructor(t,e){super(t),this.texture=e,this.version=e?e.version:0,this.isSampler=!0}}class mM extends fM{constructor(t,e,s){super(t,e?e.value:null),this.textureNode=e,this.groupNode=s}update(){this.texture=this.textureNode.value}}class yM extends wd{constructor(t,e){super(t,e?e.array:null),this.attribute=e,this.isStorageBuffer=!0}}let xM=0;class wM extends yM{constructor(t,e){super("StorageBuffer_"+xM++,t?t.value:null),this.nodeUniform=t,this.access=t?t.access:Oe.READ_WRITE,this.groupNode=e}get buffer(){return this.nodeUniform.value}}class bM extends Vn{constructor(t){super(),this.device=t;const e=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,s=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=t.createSampler({minFilter:so.Linear}),this.flipYSampler=t.createSampler({minFilter:so.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=t.createShaderModule({label:"mipmapVertex",code:e}),this.mipmapFragmentShaderModule=t.createShaderModule({label:"mipmapFragment",code:s}),this.flipYFragmentShaderModule=t.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(t){let e=this.transferPipelines[t];return e===void 0&&(e=this.device.createRenderPipeline({label:`mipmap-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:xr.TriangleStrip,stripIndexFormat:Ur.Uint32},layout:"auto"}),this.transferPipelines[t]=e),e}getFlipYPipeline(t){let e=this.flipYPipelines[t];return e===void 0&&(e=this.device.createRenderPipeline({label:`flipY-${t}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:t}]},primitive:{topology:xr.TriangleStrip,stripIndexFormat:Ur.Uint32},layout:"auto"}),this.flipYPipelines[t]=e),e}flipY(t,e,s=0){const i=e.format,{width:n,height:r}=e.size,a=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),l=this.device.createTexture({size:{width:n,height:r,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),u=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:Es.TwoD,baseArrayLayer:s}),p=l.createView({baseMipLevel:0,mipLevelCount:1,dimension:Es.TwoD,baseArrayLayer:0}),h=this.device.createCommandEncoder({}),d=(g,f,m)=>{const x=g.getBindGroupLayout(0),w=this.device.createBindGroup({layout:x,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:f}]}),b=h.beginRenderPass({colorAttachments:[{view:m,loadOp:ye.Clear,storeOp:Be.Store,clearValue:[0,0,0,0]}]});b.setPipeline(g),b.setBindGroup(0,w),b.draw(4,1,0,0),b.end()};d(a,u,p),d(c,p,u),this.device.queue.submit([h.finish()]),l.destroy()}generateMipmaps(t,e,s=0){const i=this.get(t);i.useCount===void 0&&(i.useCount=0,i.layers=[]);const n=i.layers[s]||this._mipmapCreateBundles(t,e,s),r=this.device.createCommandEncoder({});this._mipmapRunBundles(r,n),this.device.queue.submit([r.finish()]),i.useCount!==0&&(i.layers[s]=n),i.useCount++}_mipmapCreateBundles(t,e,s){const i=this.getTransferPipeline(e.format),n=i.getBindGroupLayout(0);let r=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:Es.TwoD,baseArrayLayer:s});const a=[];for(let c=1;c<e.mipLevelCount;c++){const l=this.device.createBindGroup({layout:n,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:r}]}),u=t.createView({baseMipLevel:c,mipLevelCount:1,dimension:Es.TwoD,baseArrayLayer:s}),p={colorAttachments:[{view:u,loadOp:ye.Clear,storeOp:Be.Store,clearValue:[0,0,0,0]}]},h=this.device.createRenderBundleEncoder({colorFormats:[e.format]});h.setPipeline(i),h.setBindGroup(0,l),h.draw(4,1,0,0),a.push({renderBundles:[h.finish()],passDescriptor:p}),r=u}return a}_mipmapRunBundles(t,e){const s=e.length;for(let i=0;i<s;i++){const n=e[i],r=t.beginRenderPass(n.passDescriptor);r.executeBundles(n.renderBundles),r.end()}}}const vM={[f4]:"never",[Gp]:"less",[m4]:"equal",[y4]:"less-equal",[x4]:"greater",[b4]:"greater-equal",[v4]:"always",[w4]:"not-equal"},_M=[0,1,3,2,4,5];class SM{constructor(t){this.backend=t,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new To,this.depthTexture.name="depthBuffer"}createSampler(t){const e=this.backend,s=e.device,i=e.get(t),n={addressModeU:this._convertAddressMode(t.wrapS),addressModeV:this._convertAddressMode(t.wrapT),addressModeW:this._convertAddressMode(t.wrapR),magFilter:this._convertFilterMode(t.magFilter),minFilter:this._convertFilterMode(t.minFilter),mipmapFilter:this._convertFilterMode(t.minFilter),maxAnisotropy:1};n.magFilter===so.Linear&&n.minFilter===so.Linear&&n.mipmapFilter===so.Linear&&(n.maxAnisotropy=t.anisotropy),t.isDepthTexture&&t.compareFunction!==null&&(n.compare=vM[t.compareFunction]),i.sampler=s.createSampler(n)}createDefaultTexture(t){let e;const s=vp(t);t.isCubeTexture?e=this._getDefaultCubeTextureGPU(s):t.isVideoTexture?this.backend.get(t).externalTexture=this._getDefaultVideoFrame():e=this._getDefaultTextureGPU(s),this.backend.get(t).texture=e}createTexture(t,e={}){const s=this.backend,i=s.get(t);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");e.needsMipmaps===void 0&&(e.needsMipmaps=!1),e.levels===void 0&&(e.levels=1),e.depth===void 0&&(e.depth=1);const{width:n,height:r,depth:a,levels:c}=e;t.isFramebufferTexture&&(e.renderTarget?e.format=this.backend.utils.getCurrentColorFormat(e.renderTarget):e.format=this.backend.utils.getPreferredCanvasFormat());const l=this._getDimension(t),u=t.internalFormat||e.format||vp(t,s.device);i.format=u;let p=e.sampleCount!==void 0?e.sampleCount:1;p=s.utils.getSampleCount(p);const h=t.isRenderTargetTexture&&!t.isMultisampleRenderTargetTexture?1:p;let d=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;t.isStorageTexture===!0&&(d|=GPUTextureUsage.STORAGE_BINDING),t.isCompressedTexture!==!0&&t.isCompressedArrayTexture!==!0&&(d|=GPUTextureUsage.RENDER_ATTACHMENT);const g={label:t.name,size:{width:n,height:r,depthOrArrayLayers:a},mipLevelCount:c,sampleCount:h,dimension:l,format:u,usage:d};if(t.isVideoTexture){const f=t.source.data,m=new VideoFrame(f);g.size.width=m.displayWidth,g.size.height=m.displayHeight,m.close(),i.externalTexture=f}else{if(u===void 0)return console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(t);i.texture=s.device.createTexture(g)}if(t.isRenderTargetTexture&&p>1&&!t.isMultisampleRenderTargetTexture){const f=Object.assign({},g);f.label=f.label+"-msaa",f.sampleCount=p,i.msaaTexture=s.device.createTexture(f)}i.initialized=!0,i.textureDescriptorGPU=g}destroyTexture(t){const e=this.backend,s=e.get(t);s.texture!==void 0&&s.texture.destroy(),s.msaaTexture!==void 0&&s.msaaTexture.destroy(),e.delete(t)}destroySampler(t){const s=this.backend.get(t);delete s.sampler}generateMipmaps(t){const e=this.backend.get(t);if(t.isCubeTexture)for(let s=0;s<6;s++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,s);else{const s=t.image.depth||1;for(let i=0;i<s;i++)this._generateMipmaps(e.texture,e.textureDescriptorGPU,i)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const t=this.backend,{width:e,height:s}=t.getDrawingBufferSize();return this.colorBuffer=t.device.createTexture({label:"colorBuffer",size:{width:e,height:s,depthOrArrayLayers:1},sampleCount:t.utils.getSampleCount(t.renderer.samples),format:t.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(t=!0,e=!1){const s=this.backend,{width:i,height:n}=s.getDrawingBufferSize(),r=this.depthTexture,a=s.get(r).texture;let c,l;if(e?(c=Er,l=n0):t&&(c=ro,l=Pe),a!==void 0){if(r.image.width===i&&r.image.height===n&&r.format===c&&r.type===l)return a;this.destroyTexture(r)}return r.name="depthBuffer",r.format=c,r.type=l,r.image.width=i,r.image.height=n,this.createTexture(r,{sampleCount:s.utils.getSampleCount(s.renderer.samples),width:i,height:n}),s.get(r).texture}updateTexture(t,e){const s=this.backend.get(t),{textureDescriptorGPU:i}=s;if(!(t.isRenderTargetTexture||i===void 0)){if(t.isDataTexture)this._copyBufferToTexture(e.image,s.texture,i,0,t.flipY);else if(t.isDataArrayTexture||t.isData3DTexture)for(let n=0;n<e.image.depth;n++)this._copyBufferToTexture(e.image,s.texture,i,n,t.flipY,n);else if(t.isCompressedTexture||t.isCompressedArrayTexture)this._copyCompressedBufferToTexture(t.mipmaps,s.texture,i);else if(t.isCubeTexture)this._copyCubeMapToTexture(e.images,s.texture,i,t.flipY);else if(t.isVideoTexture){const n=t.source.data;s.externalTexture=n}else this._copyImageToTexture(e.image,s.texture,i,0,t.flipY);s.version=t.version,t.onUpdate&&t.onUpdate(t)}}async copyTextureToBuffer(t,e,s,i,n,r){const a=this.backend.device,c=this.backend.get(t),l=c.texture,u=c.textureDescriptorGPU.format,p=this._getBytesPerTexel(u);let h=i*p;h=Math.ceil(h/256)*256;const d=a.createBuffer({size:i*n*p,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),g=a.createCommandEncoder();g.copyTextureToBuffer({texture:l,origin:{x:e,y:s,z:r}},{buffer:d,bytesPerRow:h},{width:i,height:n});const f=this._getTypedArrayType(u);a.queue.submit([g.finish()]),await d.mapAsync(GPUMapMode.READ);const m=d.getMappedRange();return new f(m)}_isEnvironmentTexture(t){const e=t.mapping;return e===s0||e===i0||e===mo||e===Fr}_getDefaultTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const s=new Ke;s.minFilter=Fe,s.magFilter=Fe,this.createTexture(s,{width:1,height:1,format:t}),this.defaultTexture[t]=e=s}return this.backend.get(e).texture}_getDefaultCubeTextureGPU(t){let e=this.defaultTexture[t];if(e===void 0){const s=new $p;s.minFilter=Fe,s.magFilter=Fe,this.createTexture(s,{width:1,height:1,depth:6}),this.defaultCubeTexture[t]=e=s}return this.backend.get(e).texture}_getDefaultVideoFrame(){let t=this.defaultVideoFrame;if(t===null){const e={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=t=new VideoFrame(new Uint8Array([0,0,0,255]),e)}return t}_copyCubeMapToTexture(t,e,s,i){for(let n=0;n<6;n++){const r=t[n],a=i===!0?_M[n]:n;r.isDataTexture?this._copyBufferToTexture(r.image,e,s,a,i):this._copyImageToTexture(r,e,s,a,i)}}_copyImageToTexture(t,e,s,i,n){this.backend.device.queue.copyExternalImageToTexture({source:t},{texture:e,mipLevel:0,origin:{x:0,y:0,z:i}},{width:t.width,height:t.height,depthOrArrayLayers:1}),n===!0&&this._flipY(e,s,i)}_getPassUtils(){let t=this._passUtils;return t===null&&(this._passUtils=t=new bM(this.backend.device)),t}_generateMipmaps(t,e,s=0){this._getPassUtils().generateMipmaps(t,e,s)}_flipY(t,e,s=0){this._getPassUtils().flipY(t,e,s)}_copyBufferToTexture(t,e,s,i,n,r=0){const a=this.backend.device,c=t.data,l=this._getBytesPerTexel(s.format),u=t.width*l;a.queue.writeTexture({texture:e,mipLevel:0,origin:{x:0,y:0,z:i}},c,{offset:t.width*t.height*l*r,bytesPerRow:u},{width:t.width,height:t.height,depthOrArrayLayers:1}),n===!0&&this._flipY(e,s,i)}_copyCompressedBufferToTexture(t,e,s){const i=this.backend.device,n=this._getBlockData(s.format),r=s.size.depthOrArrayLayers>1;for(let a=0;a<t.length;a++){const c=t[a],l=c.width,u=c.height,p=r?s.size.depthOrArrayLayers:1,h=Math.ceil(l/n.width)*n.byteLength,d=h*Math.ceil(u/n.height);for(let g=0;g<p;g++)i.queue.writeTexture({texture:e,mipLevel:a,origin:{x:0,y:0,z:g}},c.data,{offset:g*d,bytesPerRow:h,rowsPerImage:Math.ceil(u/n.height)},{width:Math.ceil(l/n.width)*n.width,height:Math.ceil(u/n.height)*n.height,depthOrArrayLayers:1})}}_getBlockData(t){if(t===R.BC1RGBAUnorm||t===R.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.BC2RGBAUnorm||t===R.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.BC3RGBAUnorm||t===R.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.BC4RUnorm||t===R.BC4RSNorm)return{byteLength:8,width:4,height:4};if(t===R.BC5RGUnorm||t===R.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(t===R.BC6HRGBUFloat||t===R.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(t===R.BC7RGBAUnorm||t===R.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.ETC2RGB8Unorm||t===R.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.ETC2RGB8A1Unorm||t===R.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(t===R.ETC2RGBA8Unorm||t===R.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.EACR11Unorm)return{byteLength:8,width:4,height:4};if(t===R.EACR11Snorm)return{byteLength:8,width:4,height:4};if(t===R.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(t===R.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(t===R.ASTC4x4Unorm||t===R.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(t===R.ASTC5x4Unorm||t===R.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(t===R.ASTC5x5Unorm||t===R.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(t===R.ASTC6x5Unorm||t===R.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(t===R.ASTC6x6Unorm||t===R.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(t===R.ASTC8x5Unorm||t===R.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(t===R.ASTC8x6Unorm||t===R.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(t===R.ASTC8x8Unorm||t===R.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(t===R.ASTC10x5Unorm||t===R.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(t===R.ASTC10x6Unorm||t===R.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(t===R.ASTC10x8Unorm||t===R.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(t===R.ASTC10x10Unorm||t===R.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(t===R.ASTC12x10Unorm||t===R.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(t===R.ASTC12x12Unorm||t===R.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(t){let e=au.ClampToEdge;return t===Nn?e=au.Repeat:t===Rr&&(e=au.MirrorRepeat),e}_convertFilterMode(t){let e=so.Linear;return(t===Fe||t===Fu||t===Tr)&&(e=so.Nearest),e}_getBytesPerTexel(t){if(t===R.R8Unorm||t===R.R8Snorm||t===R.R8Uint||t===R.R8Sint)return 1;if(t===R.R16Uint||t===R.R16Sint||t===R.R16Float||t===R.RG8Unorm||t===R.RG8Snorm||t===R.RG8Uint||t===R.RG8Sint)return 2;if(t===R.R32Uint||t===R.R32Sint||t===R.R32Float||t===R.RG16Uint||t===R.RG16Sint||t===R.RG16Float||t===R.RGBA8Unorm||t===R.RGBA8UnormSRGB||t===R.RGBA8Snorm||t===R.RGBA8Uint||t===R.RGBA8Sint||t===R.BGRA8Unorm||t===R.BGRA8UnormSRGB||t===R.RGB9E5UFloat||t===R.RGB10A2Unorm||t===R.RG11B10UFloat||t===R.Depth32Float||t===R.Depth24Plus||t===R.Depth24PlusStencil8||t===R.Depth32FloatStencil8)return 4;if(t===R.RG32Uint||t===R.RG32Sint||t===R.RG32Float||t===R.RGBA16Uint||t===R.RGBA16Sint||t===R.RGBA16Float)return 8;if(t===R.RGBA32Uint||t===R.RGBA32Sint||t===R.RGBA32Float)return 16}_getTypedArrayType(t){if(t===R.R8Uint)return Uint8Array;if(t===R.R8Sint)return Int8Array;if(t===R.R8Unorm)return Uint8Array;if(t===R.R8Snorm)return Int8Array;if(t===R.RG8Uint)return Uint8Array;if(t===R.RG8Sint)return Int8Array;if(t===R.RG8Unorm)return Uint8Array;if(t===R.RG8Snorm)return Int8Array;if(t===R.RGBA8Uint)return Uint8Array;if(t===R.RGBA8Sint)return Int8Array;if(t===R.RGBA8Unorm)return Uint8Array;if(t===R.RGBA8Snorm)return Int8Array;if(t===R.R16Uint)return Uint16Array;if(t===R.R16Sint)return Int16Array;if(t===R.RG16Uint)return Uint16Array;if(t===R.RG16Sint)return Int16Array;if(t===R.RGBA16Uint)return Uint16Array;if(t===R.RGBA16Sint)return Int16Array;if(t===R.R16Float||t===R.RG16Float||t===R.RGBA16Float)return Uint16Array;if(t===R.R32Uint)return Uint32Array;if(t===R.R32Sint)return Int32Array;if(t===R.R32Float)return Float32Array;if(t===R.RG32Uint)return Uint32Array;if(t===R.RG32Sint)return Int32Array;if(t===R.RG32Float)return Float32Array;if(t===R.RGBA32Uint)return Uint32Array;if(t===R.RGBA32Sint)return Int32Array;if(t===R.RGBA32Float)return Float32Array;if(t===R.BGRA8Unorm||t===R.BGRA8UnormSRGB)return Uint8Array;if(t===R.RGB10A2Unorm||t===R.RGB9E5UFloat||t===R.RG11B10UFloat)return Uint32Array;if(t===R.Depth32Float)return Float32Array;if(t===R.Depth24Plus||t===R.Depth24PlusStencil8)return Uint32Array;if(t===R.Depth32FloatStencil8)return Float32Array}_getDimension(t){let e;return t.isData3DTexture?e=p5.ThreeD:e=p5.TwoD,e}}function vp(o,t=null){const e=o.format,s=o.type,i=o.colorSpace;let n;if(o.isCompressedTexture===!0||o.isCompressedArrayTexture===!0)switch(e){case Mc:n=i===et?R.BC1RGBAUnormSRGB:R.BC1RGBAUnorm;break;case Ac:n=i===et?R.BC2RGBAUnormSRGB:R.BC2RGBAUnorm;break;case Nc:n=i===et?R.BC3RGBAUnormSRGB:R.BC3RGBAUnorm;break;case Eu:n=i===et?R.ETC2RGB8UnormSRGB:R.ETC2RGB8Unorm;break;case Du:n=i===et?R.ETC2RGBA8UnormSRGB:R.ETC2RGBA8Unorm;break;case Bu:n=i===et?R.ASTC4x4UnormSRGB:R.ASTC4x4Unorm;break;case Pu:n=i===et?R.ASTC5x4UnormSRGB:R.ASTC5x4Unorm;break;case Iu:n=i===et?R.ASTC5x5UnormSRGB:R.ASTC5x5Unorm;break;case Lu:n=i===et?R.ASTC6x5UnormSRGB:R.ASTC6x5Unorm;break;case Uu:n=i===et?R.ASTC6x6UnormSRGB:R.ASTC6x6Unorm;break;case zu:n=i===et?R.ASTC8x5UnormSRGB:R.ASTC8x5Unorm;break;case ku:n=i===et?R.ASTC8x6UnormSRGB:R.ASTC8x6Unorm;break;case Vu:n=i===et?R.ASTC8x8UnormSRGB:R.ASTC8x8Unorm;break;case Gu:n=i===et?R.ASTC10x5UnormSRGB:R.ASTC10x5Unorm;break;case Ou:n=i===et?R.ASTC10x6UnormSRGB:R.ASTC10x6Unorm;break;case Wu:n=i===et?R.ASTC10x8UnormSRGB:R.ASTC10x8Unorm;break;case $u:n=i===et?R.ASTC10x10UnormSRGB:R.ASTC10x10Unorm;break;case Hu:n=i===et?R.ASTC12x10UnormSRGB:R.ASTC12x10Unorm;break;case qu:n=i===et?R.ASTC12x12UnormSRGB:R.ASTC12x12Unorm;break;case Cn:n=i===et?R.RGBA8UnormSRGB:R.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",e)}else switch(e){case Cn:switch(s){case va:n=R.RGBA8Snorm;break;case _a:n=R.RGBA16Sint;break;case dr:n=R.RGBA16Uint;break;case Pe:n=R.RGBA32Uint;break;case Ze:n=R.RGBA32Sint;break;case Mn:n=i===et?R.RGBA8UnormSRGB:R.RGBA8Unorm;break;case Qs:n=R.RGBA16Float;break;case ns:n=R.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",s)}break;case Up:s===g4?n=R.RGB9E5UFloat:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",s);break;case vl:switch(s){case va:n=R.R8Snorm;break;case _a:n=R.R16Sint;break;case dr:n=R.R16Uint;break;case Pe:n=R.R32Uint;break;case Ze:n=R.R32Sint;break;case Mn:n=R.R8Unorm;break;case Qs:n=R.R16Float;break;case ns:n=R.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",s)}break;case ka:switch(s){case va:n=R.RG8Snorm;break;case _a:n=R.RG16Sint;break;case dr:n=R.RG16Uint;break;case Pe:n=R.RG32Uint;break;case Ze:n=R.RG32Sint;break;case Mn:n=R.RG8Unorm;break;case Qs:n=R.RG16Float;break;case ns:n=R.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",s)}break;case ro:switch(s){case dr:n=R.Depth16Unorm;break;case Pe:n=R.Depth24Plus;break;case ns:n=R.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",s)}break;case Er:switch(s){case n0:n=R.Depth24PlusStencil8;break;case ns:t&&t.features.has(bp.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),n=R.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",s)}break;case zp:switch(s){case Ze:n=R.R32Sint;break;case Pe:n=R.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",s)}break;case kp:switch(s){case Ze:n=R.RG32Sint;break;case Pe:n=R.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",s)}break;case Vp:switch(s){case Ze:n=R.RGBA32Sint;break;case Pe:n=R.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",s)}break;default:console.error("WebGPURenderer: Unsupported texture format.",e)}return n}const TM=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,MM=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,h5={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},AM=o=>{o=o.trim();const t=o.match(TM);if(t!==null&&t.length===4){const e=t[2],s=[];let i=null;for(;(i=MM.exec(e))!==null;)s.push({name:i[1],type:i[2]});const n=[];for(let u=0;u<s.length;u++){const{name:p,type:h}=s[u];let d=h;d.startsWith("ptr")?d="pointer":(d.startsWith("texture")&&(d=h.split("<")[0]),d=h5[d]),n.push(new hh(d,p))}const r=o.substring(t[0].length),a=t[3]||"void",c=t[1]!==void 0?t[1]:"";return{type:h5[a]||a,inputs:n,name:c,inputsCode:e,blockCode:r,outputType:a}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class NM extends dh{constructor(t){const{type:e,inputs:s,name:i,inputsCode:n,blockCode:r,outputType:a}=AM(t);super(e,s,i),this.inputsCode=n,this.blockCode=r,this.outputType=a}getCode(t=this.name){const e=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${t} ( ${this.inputsCode.trim()} ) ${e}`+this.blockCode}}class CM extends yd{parseFunction(t){return new NM(t)}}const Qo=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},FM={[Oe.READ_ONLY]:"read",[Oe.WRITE_ONLY]:"write",[Oe.READ_WRITE]:"read_write"},d5={[Nn]:"repeat",[bn]:"clamp",[Rr]:"mirror"},pc={vertex:Qo?Qo.VERTEX:1,fragment:Qo?Qo.FRAGMENT:2,compute:Qo?Qo.COMPUTE:4},g5={instance:!0,swizzleAssign:!1,storageBuffer:!0},RM={"^^":"tsl_xor"},EM={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},f5={},Ds={tsl_xor:new xe("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new xe("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new xe("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new xe("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new xe("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new xe("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new xe("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new xe("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new xe("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new xe("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new xe("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new xe("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new xe(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},ma={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(Ds.pow_float=new xe("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),Ds.pow_vec2=new xe("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[Ds.pow_float]),Ds.pow_vec3=new xe("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[Ds.pow_float]),Ds.pow_vec4=new xe("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[Ds.pow_float]),ma.pow_float="tsl_pow_float",ma.pow_vec2="tsl_pow_vec2",ma.pow_vec3="tsl_pow_vec3",ma.pow_vec4="tsl_pow_vec4");let Ad="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(Ad+=`diagnostic( off, derivative_uniformity );
`);class DM extends fd{constructor(t,e){super(t,e,new CM),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(t){return t.isVideoTexture===!0&&t.colorSpace!==yo}_generateTextureSample(t,e,s,i,n=this.shaderStage){return n==="fragment"?i?`textureSample( ${e}, ${e}_sampler, ${s}, ${i} )`:`textureSample( ${e}, ${e}_sampler, ${s} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,s):this.generateTextureLod(t,e,s,i,"0")}_generateVideoSample(t,e,s=this.shaderStage){if(s==="fragment")return`textureSampleBaseClampToEdge( ${t}, ${t}_sampler, vec2<f32>( ${e}.x, 1.0 - ${e}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${s} shader.`)}_generateTextureSampleLevel(t,e,s,i,n,r=this.shaderStage){return r==="fragment"&&this.isUnfilterable(t)===!1?`textureSampleLevel( ${e}, ${e}_sampler, ${s}, ${i} )`:this.isFilteredTexture(t)?this.generateFilteredTexture(t,e,s,i):this.generateTextureLod(t,e,s,n,i)}generateWrapFunction(t){const e=`tsl_coord_${d5[t.wrapS]}S_${d5[t.wrapT]}T`;let s=f5[e];if(s===void 0){const i=[];let n=`fn ${e}( coord : vec2f ) -> vec2f {

	return vec2f(
`;const r=(a,c)=>{a===Nn?(i.push(Ds.repeatWrapping_float),n+=`		tsl_repeatWrapping_float( coord.${c} )`):a===bn?(i.push(Ds.clampWrapping_float),n+=`		tsl_clampWrapping_float( coord.${c} )`):a===Rr?(i.push(Ds.mirrorWrapping_float),n+=`		tsl_mirrorWrapping_float( coord.${c} )`):(n+=`		coord.${c}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${a}" for vertex shader.`))};r(t.wrapS,"x"),n+=`,
`,r(t.wrapT,"y"),n+=`
	);

}
`,f5[e]=s=new xe(n,i)}return s.build(this),e}generateTextureDimension(t,e,s){const i=this.getDataFromNode(t,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let n=i.dimensionsSnippet[s];if(i.dimensionsSnippet[s]===void 0){let r;t.isMultisampleRenderTargetTexture===!0?r=e:r=`${e}, u32( ${s} )`,n=new v6(new k6(`textureDimensions( ${r} )`,"uvec2")),i.dimensionsSnippet[s]=n}return n.build(this)}generateFilteredTexture(t,e,s,i="0u"){this._include("biquadraticTexture");const n=this.generateWrapFunction(t),r=this.generateTextureDimension(t,e,i);return`tsl_biquadraticTexture( ${e}, ${n}( ${s} ), ${r}, u32( ${i} ) )`}generateTextureLod(t,e,s,i,n="0u"){const r=this.generateWrapFunction(t),a=this.generateTextureDimension(t,e,n),c=`vec2u( ${r}( ${s} ) * vec2f( ${a} ) )`;return this.generateTextureLoad(t,e,c,i,n)}generateTextureLoad(t,e,s,i,n="0u"){return t.isVideoTexture===!0||t.isStorageTexture===!0?`textureLoad( ${e}, ${s} )`:i?`textureLoad( ${e}, ${s}, ${i}, u32( ${n} ) )`:`textureLoad( ${e}, ${s}, u32( ${n} ) )`}generateTextureStore(t,e,s,i){return`textureStore( ${e}, ${s}, ${i} )`}isSampleCompare(t){return t.isDepthTexture===!0&&t.compareFunction!==null}isUnfilterable(t){return this.getComponentTypeFromTexture(t)!=="float"||!this.isAvailable("float32Filterable")&&t.isDataTexture===!0&&t.type===ns||this.isSampleCompare(t)===!1&&t.minFilter===Fe&&t.magFilter===Fe||t.isMultisampleRenderTargetTexture===!0}generateTexture(t,e,s,i,n=this.shaderStage){let r=null;return t.isVideoTexture===!0?r=this._generateVideoSample(e,s,n):this.isUnfilterable(t)?r=this.generateTextureLod(t,e,s,i,"0",n):r=this._generateTextureSample(t,e,s,i,n),r}generateTextureGrad(t,e,s,i,n,r=this.shaderStage){if(r==="fragment")return`textureSampleGrad( ${e}, ${e}_sampler, ${s},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${r} shader.`)}generateTextureCompare(t,e,s,i,n,r=this.shaderStage){if(r==="fragment")return`textureSampleCompare( ${e}, ${e}_sampler, ${s}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${r} shader.`)}generateTextureLevel(t,e,s,i,n,r=this.shaderStage){let a=null;return t.isVideoTexture===!0?a=this._generateVideoSample(e,s,r):a=this._generateTextureSampleLevel(t,e,s,i,n,r),a}generateTextureBias(t,e,s,i,n,r=this.shaderStage){if(r==="fragment")return`textureSampleBias( ${e}, ${e}_sampler, ${s}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${r} shader.`)}getPropertyName(t,e=this.shaderStage){if(t.isNodeVarying===!0&&t.needsInterpolation===!0){if(e==="vertex")return`varyings.${t.name}`}else if(t.isNodeUniform===!0){const s=t.name,i=t.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?s:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?`NodeBuffer_${t.id}.${s}`:t.groupNode.name+"."+s}return super.getPropertyName(t)}getOutputStructName(){return"output"}_getUniformGroupCount(t){return Object.keys(this.uniforms[t]).length}getFunctionOperator(t){const e=RM[t];return e!==void 0?(this._include(e),e):null}getNodeAccess(t,e){return e!=="compute"?Oe.READ_ONLY:t.access}getStorageAccess(t,e){return FM[this.getNodeAccess(t,e)]}getUniformFromNode(t,e,s,i=null){const n=super.getUniformFromNode(t,e,s,i),r=this.getDataFromNode(t,s,this.globalCache);if(r.uniformGPU===void 0){let a;const c=t.groupNode,l=c.name,u=this.getBindGroupArray(l,s);if(e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"){let p=null;const h=this.getNodeAccess(t,s);if(e==="texture"||e==="storageTexture"?p=new Zl(n.name,n.node,c,h):e==="cubeTexture"?p=new Sd(n.name,n.node,c,h):e==="texture3D"&&(p=new Td(n.name,n.node,c,h)),p.store=t.isStorageTextureNode===!0,p.setVisibility(pc[s]),s==="fragment"&&this.isUnfilterable(t.value)===!1&&p.store===!1){const d=new mM(`${n.name}_sampler`,n.node,c);d.setVisibility(pc[s]),u.push(d,p),a=[d,p]}else u.push(p),a=[p]}else if(e==="buffer"||e==="storageBuffer"||e==="indirectStorageBuffer"){const p=e==="buffer"?vd:wM,h=new p(t,c);h.setVisibility(pc[s]),u.push(h),a=h}else{const p=this.uniformGroups[s]||(this.uniformGroups[s]={});let h=p[l];h===void 0&&(h=new _d(l,c),h.setVisibility(pc[s]),p[l]=h,u.push(h)),a=this.getNodeUniform(n,e),h.addUniform(a)}r.uniformGPU=a}return n}getBuiltin(t,e,s,i=this.shaderStage){const n=this.builtins[i]||(this.builtins[i]=new Map);return n.has(t)===!1&&n.set(t,{name:t,property:e,type:s}),e}hasBuiltin(t,e=this.shaderStage){return this.builtins[e]!==void 0&&this.builtins[e].has(t)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(t){const e=t.layout,s=this.flowShaderNode(t),i=[];for(const r of e.inputs)i.push(r.name+" : "+this.getType(r.type));let n=`fn ${e.name}( ${i.join(", ")} ) -> ${this.getType(e.type)} {
${s.vars}
${s.code}
`;return s.result&&(n+=`	return ${s.result};
`),n+=`
}
`,n}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(t,e=this.shaderStage){(this.directives[e]||(this.directives[e]=new Set)).add(t)}getDirectives(t){const e=[],s=this.directives[t];if(s!==void 0)for(const i of s)e.push(`enable ${i};`);return e.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(t){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${t} >`,"vertex")}getBuiltins(t){const e=[],s=this.builtins[t];if(s!==void 0)for(const{name:i,property:n,type:r}of s.values())e.push(`@builtin( ${i} ) ${n} : ${r}`);return e.join(`,
	`)}getScopedArray(t,e,s,i){return this.scopedArrays.has(t)===!1&&this.scopedArrays.set(t,{name:t,scope:e,bufferType:s,bufferCount:i}),t}getScopedArrays(t){if(t!=="compute")return;const e=[];for(const{name:s,scope:i,bufferType:n,bufferCount:r}of this.scopedArrays.values()){const a=this.getType(n);e.push(`var<${i}> ${s}: array< ${a}, ${r} >;`)}return e.join(`
`)}getAttributes(t){const e=[];if(t==="compute"&&(this.getBuiltin("global_invocation_id","id","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",t),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),t==="vertex"||t==="compute"){const s=this.getBuiltins("attribute");s&&e.push(s);const i=this.getAttributesArray();for(let n=0,r=i.length;n<r;n++){const a=i[n],c=a.name,l=this.getType(a.type);e.push(`@location( ${n} ) ${c} : ${l}`)}}return e.join(`,
	`)}getStructMembers(t){const e=[],s=t.getMemberTypes();for(let n=0;n<s.length;n++){const r=s[n];e.push(`	@location( ${n} ) m${n} : ${r}<f32>`)}const i=this.getBuiltins("output");return i&&e.push("	"+i),e.join(`,
`)}getStructs(t){const e=[],s=this.structs[t];for(let i=0,n=s.length;i<n;i++){const r=s[i],a=r.name;let c=`struct ${a} {
`;c+=this.getStructMembers(r),c+=`
}`,e.push(c),e.push(`
var<private> output : ${a};

`)}return e.join(`

`)}getVar(t,e){return`var ${e} : ${this.getType(t)}`}getVars(t){const e=[],s=this.vars[t];if(s!==void 0)for(const i of s)e.push(`	${this.getVar(i.type,i.name)};`);return`
${e.join(`
`)}
`}getVaryings(t){const e=[];if(t==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),t==="vertex"||t==="fragment"){const n=this.varyings,r=this.vars[t];for(let a=0;a<n.length;a++){const c=n[a];if(c.needsInterpolation){let l=`@location( ${a} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(l+=" @interpolate( flat )"),e.push(`${l} ${c.name} : ${this.getType(c.type)}`)}else t==="vertex"&&r.includes(c)===!1&&r.push(c)}}const s=this.getBuiltins(t);s&&e.push(s);const i=e.join(`,
	`);return t==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}getUniforms(t){const e=this.uniforms[t],s=[],i=[],n=[],r={};for(const c of e){const l=c.groupNode.name,u=this.bindingsIndexes[l];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const p=c.node.value;t==="fragment"&&this.isUnfilterable(p)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(p)?s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler_comparison;`):s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name}_sampler : sampler;`));let h,d="";if(p.isMultisampleRenderTargetTexture===!0&&(d="_multisampled"),p.isCubeTexture===!0)h="texture_cube<f32>";else if(p.isDataArrayTexture===!0||p.isCompressedArrayTexture===!0)h="texture_2d_array<f32>";else if(p.isDepthTexture===!0)h=`texture_depth${d}_2d`;else if(p.isVideoTexture===!0)h="texture_external";else if(p.isData3DTexture===!0)h="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const g=vp(p),f=this.getStorageAccess(c.node,t);h=`texture_storage_2d<${g}, ${f}>`}else{const g=this.getComponentTypeFromTexture(p).charAt(0);h=`texture${d}_2d<${g}32>`}s.push(`@binding( ${u.binding++} ) @group( ${u.group} ) var ${c.name} : ${h};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const p=c.node,h=this.getType(p.bufferType),d=p.bufferCount,g=d>0&&c.type==="buffer"?", "+d:"",f=p.isAtomic?`atomic<${h}>`:`${h}`,m=`	${c.name} : array< ${f}${g} >
`,x=p.isStorageBufferNode?`storage, ${this.getStorageAccess(p,t)}`:"uniform";i.push(this._getWGSLStructBinding("NodeBuffer_"+p.id,m,x,u.binding++,u.group))}else{const p=this.getType(this.getVectorType(c.type)),h=c.groupNode.name;(r[h]||(r[h]={index:u.binding++,id:u.group,snippets:[]})).snippets.push(`	${c.name} : ${p}`)}}for(const c in r){const l=r[c];n.push(this._getWGSLStructBinding(c,l.snippets.join(`,
`),"uniform",l.index,l.id))}let a=s.join(`
`);return a+=i.join(`
`),a+=n.join(`
`),a}buildCode(){const t=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const e in t){const s=t[e];s.uniforms=this.getUniforms(e),s.attributes=this.getAttributes(e),s.varyings=this.getVaryings(e),s.structs=this.getStructs(e),s.vars=this.getVars(e),s.codes=this.getCodes(e),s.directives=this.getDirectives(e),s.scopedArrays=this.getScopedArrays(e);let i=`// code

`;i+=this.flowCode[e];const n=this.flowNodes[e],r=n[n.length-1],a=r.outputNode,c=a!==void 0&&a.isOutputStructNode===!0;for(const l of n){const u=this.getFlowData(l),p=l.name;if(p&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${p}
	`),i+=`${u.code}
	`,l===r&&e!=="compute"){if(i+=`// result

	`,e==="vertex")i+=`varyings.Vertex = ${u.result};`;else if(e==="fragment")if(c)s.returnType=a.nodeType,i+=`return ${u.result};`;else{let h="	@location(0) color: vec4<f32>";const d=this.getBuiltins("output");d&&(h+=`,
	`+d),s.returnType="OutputStruct",s.structs+=this._getWGSLStruct("OutputStruct",h),s.structs+=`
var<private> output : OutputStruct;

`,i+=`output.color = ${u.result};

	return output;`}}}s.flow=i}this.material!==null?(this.vertexShader=this._getWGSLVertexCode(t.vertex),this.fragmentShader=this._getWGSLFragmentCode(t.fragment)):this.computeShader=this._getWGSLComputeCode(t.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(t,e=null){let s;return e!==null&&(s=this._getWGSLMethod(t+"_"+e)),s===void 0&&(s=this._getWGSLMethod(t)),s||t}getType(t){return EM[t]||t}isAvailable(t){let e=g5[t];return e===void 0&&(t==="float32Filterable"?e=this.renderer.hasFeature("float32-filterable"):t==="clipDistance"&&(e=this.renderer.hasFeature("clip-distances")),g5[t]=e),e}_getWGSLMethod(t){return Ds[t]!==void 0&&this._include(t),ma[t]}_include(t){const e=Ds[t];return e.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e),e}_getWGSLVertexCode(t){return`${this.getSignature()}
// directives
${t.directives}

// uniforms
${t.uniforms}

// varyings
${t.varyings}
var<private> varyings : VaryingsStruct;

// codes
${t.codes}

@vertex
fn main( ${t.attributes} ) -> VaryingsStruct {

	// vars
	${t.vars}

	// flow
	${t.flow}

	return varyings;

}
`}_getWGSLFragmentCode(t){return`${this.getSignature()}
// global
${Ad}

// uniforms
${t.uniforms}

// structs
${t.structs}

// codes
${t.codes}

@fragment
fn main( ${t.varyings} ) -> ${t.returnType} {

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLComputeCode(t,e){return`${this.getSignature()}
// directives
${t.directives}

// system
var<private> instanceIndex : u32;

// locals
${t.scopedArrays}

// uniforms
${t.uniforms}

// codes
${t.codes}

@compute @workgroup_size( ${e} )
fn main( ${t.attributes} ) {

	// system
	instanceIndex = id.x + id.y * numWorkgroups.x * u32(${e}) + id.z * numWorkgroups.x * numWorkgroups.y * u32(${e});

	// vars
	${t.vars}

	// flow
	${t.flow}

}
`}_getWGSLStruct(t,e){return`
struct ${t} {
${e}
};`}_getWGSLStructBinding(t,e,s,i=0,n=0){const r=t+"Struct";return`${this._getWGSLStruct(r,e)}
@binding( ${i} ) @group( ${n} )
var<${s}> ${t} : ${r};`}}class BM{constructor(t){this.backend=t}getCurrentDepthStencilFormat(t){let e;return t.depthTexture!==null?e=this.getTextureFormatGPU(t.depthTexture):t.depth&&t.stencil?e=R.Depth24PlusStencil8:t.depth&&(e=R.Depth24Plus),e}getTextureFormatGPU(t){return this.backend.get(t).format}getCurrentColorFormat(t){let e;return t.textures!==null?e=this.getTextureFormatGPU(t.textures[0]):e=this.getPreferredCanvasFormat(),e}getCurrentColorSpace(t){return t.textures!==null?t.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(t,e){if(t.isPoints)return xr.PointList;if(t.isLineSegments||t.isMesh&&e.wireframe===!0)return xr.LineList;if(t.isLine)return xr.LineStrip;if(t.isMesh)return xr.TriangleList}getSampleCount(t){let e=1;return t>1&&(e=Math.pow(2,Math.floor(Math.log2(t))),e===2&&(e=4)),e}getSampleCountRenderContext(t){return t.textures!==null?this.getSampleCount(t.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){return navigator.userAgent.includes("Quest")?R.BGRA8Unorm:navigator.gpu.getPreferredCanvasFormat()}}const PM=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),IM=new Map([[N4,["float16"]]]),LM=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class UM{constructor(t){this.backend=t}createAttribute(t,e){const s=this._getBufferAttribute(t),i=this.backend,n=i.get(s);let r=n.buffer;if(r===void 0){const a=i.device;let c=s.array;if(t.normalized===!1&&(c.constructor===Int16Array||c.constructor===Uint16Array)){const u=new Uint32Array(c.length);for(let p=0;p<c.length;p++)u[p]=c[p];c=u}if(s.array=c,(s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute)&&s.itemSize===3){c=new c.constructor(s.count*4);for(let u=0;u<s.count;u++)c.set(s.array.subarray(u*3,u*3+3),u*4);s.itemSize=4,s.array=c}const l=c.byteLength+(4-c.byteLength%4)%4;r=a.createBuffer({label:s.name,size:l,usage:e,mappedAtCreation:!0}),new c.constructor(r.getMappedRange()).set(c),r.unmap(),n.buffer=r}}updateAttribute(t){const e=this._getBufferAttribute(t),s=this.backend,i=s.device,n=s.get(e).buffer,r=e.array,a=this._isTypedArray(r),c=e.updateRanges;if(c.length===0)i.queue.writeBuffer(n,0,r,0);else{const l=a?1:r.BYTES_PER_ELEMENT;for(let u=0,p=c.length;u<p;u++){const h=c[u],d=h.start*l,g=h.count*l;i.queue.writeBuffer(n,0,r,d,g)}e.clearUpdateRanges()}}createShaderVertexBuffers(t){const e=t.getAttributes(),s=new Map;for(let i=0;i<e.length;i++){const n=e[i],r=n.array.BYTES_PER_ELEMENT,a=this._getBufferAttribute(n);let c=s.get(a);if(c===void 0){let p,h;n.isInterleavedBufferAttribute===!0?(p=n.data.stride*r,h=n.data.isInstancedInterleavedBuffer?uc.Instance:uc.Vertex):(p=n.itemSize*r,h=n.isInstancedBufferAttribute?uc.Instance:uc.Vertex),n.normalized===!1&&(n.array.constructor===Int16Array||n.array.constructor===Uint16Array)&&(p=4),c={arrayStride:p,attributes:[],stepMode:h},s.set(a,c)}const l=this._getVertexFormat(n),u=n.isInterleavedBufferAttribute===!0?n.offset*r:0;c.attributes.push({shaderLocation:i,offset:u,format:l})}return Array.from(s.values())}destroyAttribute(t){const e=this.backend;e.get(this._getBufferAttribute(t)).buffer.destroy(),e.delete(t)}async getArrayBufferAsync(t){const e=this.backend,s=e.device,n=e.get(this._getBufferAttribute(t)).buffer,r=n.size,a=s.createBuffer({label:t.name,size:r,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=s.createCommandEncoder({});c.copyBufferToBuffer(n,0,a,0,r),a.unmap();const l=c.finish();return s.queue.submit([l]),await a.mapAsync(GPUMapMode.READ),a.getMappedRange()}_getVertexFormat(t){const{itemSize:e,normalized:s}=t,i=t.array.constructor,n=t.constructor;let r;if(e==1)r=LM.get(i);else{const c=(IM.get(n)||PM.get(i))[s?1:0];if(c){const l=i.BYTES_PER_ELEMENT*e,p=Math.floor((l+3)/4)*4/i.BYTES_PER_ELEMENT;if(p%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");r=`${c}x${p}`}}return r||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),r}_isTypedArray(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}_getBufferAttribute(t){return t.isInterleavedBufferAttribute&&(t=t.data),t}}class zM{constructor(t){this.backend=t,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(t){const s=this.backend.device,i=[];let n=0;for(const r of t.bindings){const a={binding:n++,visibility:r.visibility};if(r.isUniformBuffer||r.isStorageBuffer){const c={};r.isStorageBuffer&&(r.visibility&4&&(r.access===Oe.READ_WRITE||r.access===Oe.WRITE_ONLY)?c.type=cu.Storage:c.type=cu.ReadOnlyStorage),a.buffer=c}else if(r.isSampler){const c={};r.texture.isDepthTexture&&r.texture.compareFunction!==null&&(c.type="comparison"),a.sampler=c}else if(r.isSampledTexture&&r.texture.isVideoTexture)a.externalTexture={};else if(r.isSampledTexture&&r.store){const c={};c.format=this.backend.get(r.texture).texture.format;const l=r.access;l===Oe.READ_WRITE?c.access=lu.ReadWrite:l===Oe.WRITE_ONLY?c.access=lu.WriteOnly:c.access=lu.ReadOnly,a.storageTexture=c}else if(r.isSampledTexture){const c={};if(r.texture.isMultisampleRenderTargetTexture===!0&&(c.multisampled=!0),r.texture.isDepthTexture)c.sampleType=ha.Depth;else if(r.texture.isDataTexture||r.texture.isDataArrayTexture||r.texture.isData3DTexture){const l=r.texture.type;l===Ze?c.sampleType=ha.SInt:l===Pe?c.sampleType=ha.UInt:l===ns&&(this.backend.hasFeature("float32-filterable")?c.sampleType=ha.Float:c.sampleType=ha.UnfilterableFloat)}r.isSampledCubeTexture?c.viewDimension=Es.Cube:r.texture.isDataArrayTexture||r.texture.isCompressedArrayTexture?c.viewDimension=Es.TwoDArray:r.isSampledTexture3D&&(c.viewDimension=Es.ThreeD),a.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${r}".`);i.push(a)}return s.createBindGroupLayout({entries:i})}createBindings(t,e,s,i=0){const{backend:n,bindGroupLayoutCache:r}=this,a=n.get(t);let c=r.get(t.bindingsReference);c===void 0&&(c=this.createBindingsLayout(t),r.set(t.bindingsReference,c));let l;s>0&&(a.groups===void 0&&(a.groups=[],a.versions=[]),a.versions[s]===i&&(l=a.groups[s])),l===void 0&&(l=this.createBindGroup(t,c),s>0&&(a.groups[s]=l,a.versions[s]=i)),a.group=l,a.layout=c}updateBinding(t){const e=this.backend,s=e.device,i=t.buffer,n=e.get(t).buffer;s.queue.writeBuffer(n,0,i,0)}createBindGroup(t,e){const s=this.backend,i=s.device;let n=0;const r=[];for(const a of t.bindings){if(a.isUniformBuffer){const c=s.get(a);if(c.buffer===void 0){const l=a.byteLength,u=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,p=i.createBuffer({label:"bindingBuffer_"+a.name,size:l,usage:u});c.buffer=p}r.push({binding:n,resource:{buffer:c.buffer}})}else if(a.isStorageBuffer){const c=s.get(a);if(c.buffer===void 0){const l=a.attribute;c.buffer=s.get(l).buffer}r.push({binding:n,resource:{buffer:c.buffer}})}else if(a.isSampler){const c=s.get(a.texture);r.push({binding:n,resource:c.sampler})}else if(a.isSampledTexture){const c=s.get(a.texture);let l;if(c.externalTexture!==void 0)l=i.importExternalTexture({source:c.externalTexture});else{const u=a.store?1:c.texture.mipLevelCount,p=`view-${c.texture.width}-${c.texture.height}-${u}`;if(l=c[p],l===void 0){const h=gM.All;let d;a.isSampledCubeTexture?d=Es.Cube:a.isSampledTexture3D?d=Es.ThreeD:a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?d=Es.TwoDArray:d=Es.TwoD,l=c[p]=c.texture.createView({aspect:h,dimension:d,mipLevelCount:u})}}r.push({binding:n,resource:l})}n++}return i.createBindGroup({label:"bindGroup_"+t.name,layout:e,entries:r})}}class kM{constructor(t){this.backend=t}_getSampleCount(t){return this.backend.utils.getSampleCountRenderContext(t)}createRenderPipeline(t,e){const{object:s,material:i,geometry:n,pipeline:r}=t,{vertexProgram:a,fragmentProgram:c}=r,l=this.backend,u=l.device,p=l.utils,h=l.get(r),d=[];for(const Z of t.getBindings()){const j=l.get(Z);d.push(j.layout)}const g=l.attributeUtils.createShaderVertexBuffers(t);let f;i.transparent===!0&&i.blending!==fo&&(f=this._getBlending(i));let m={};i.stencilWrite===!0&&(m={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const x=this._getColorWriteMask(i),w=[];if(t.context.textures!==null){const Z=t.context.textures;for(let j=0;j<Z.length;j++){const ut=p.getTextureFormatGPU(Z[j]);w.push({format:ut,blend:f,writeMask:x})}}else{const Z=p.getCurrentColorFormat(t.context);w.push({format:Z,blend:f,writeMask:x})}const b=l.get(a).module,v=l.get(c).module,T=this._getPrimitiveState(s,n,i),M=this._getDepthCompare(i),F=p.getCurrentDepthStencilFormat(t.context),N=this._getSampleCount(t.context),A={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},b,{buffers:g}),fragment:Object.assign({},v,{targets:w}),primitive:T,multisample:{count:N,alphaToCoverageEnabled:i.alphaToCoverage&&N>1},layout:u.createPipelineLayout({bindGroupLayouts:d})},E={},U=t.context.depth,$=t.context.stencil;if((U===!0||$===!0)&&(U===!0&&(E.format=F,E.depthWriteEnabled=i.depthWrite,E.depthCompare=M),$===!0&&(E.stencilFront=m,E.stencilBack={},E.stencilReadMask=i.stencilFuncMask,E.stencilWriteMask=i.stencilWriteMask),A.depthStencil=E),e===null)h.pipeline=u.createRenderPipeline(A);else{const Z=new Promise(j=>{u.createRenderPipelineAsync(A).then(ut=>{h.pipeline=ut,j()})});e.push(Z)}}createBundleEncoder(t){const e=this.backend,{utils:s,device:i}=e,n=s.getCurrentDepthStencilFormat(t),r=s.getCurrentColorFormat(t),a=this._getSampleCount(t),c={label:"renderBundleEncoder",colorFormats:[r],depthStencilFormat:n,sampleCount:a};return i.createRenderBundleEncoder(c)}createComputePipeline(t,e){const s=this.backend,i=s.device,n=s.get(t.computeProgram).module,r=s.get(t),a=[];for(const c of e){const l=s.get(c);a.push(l.layout)}r.pipeline=i.createComputePipeline({compute:n,layout:i.createPipelineLayout({bindGroupLayouts:a})})}_getBlending(t){let e,s;const i=t.blending,n=t.blendSrc,r=t.blendDst,a=t.blendEquation;if(i===X5){const c=t.blendSrcAlpha!==null?t.blendSrcAlpha:n,l=t.blendDstAlpha!==null?t.blendDstAlpha:r,u=t.blendEquationAlpha!==null?t.blendEquationAlpha:a;e={srcFactor:this._getBlendFactor(n),dstFactor:this._getBlendFactor(r),operation:this._getBlendOperation(a)},s={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(l),operation:this._getBlendOperation(u)}}else{const c=t.premultipliedAlpha,l=(u,p,h,d)=>{e={srcFactor:u,dstFactor:p,operation:jn.Add},s={srcFactor:h,dstFactor:d,operation:jn.Add}};if(c)switch(i){case Tn:l(lt.One,lt.OneMinusSrcAlpha,lt.One,lt.OneMinusSrcAlpha);break;case Jt:l(lt.One,lt.One,lt.One,lt.One);break;case Gc:l(lt.Zero,lt.OneMinusSrc,lt.Zero,lt.One);break;case Oc:l(lt.Zero,lt.Src,lt.Zero,lt.SrcAlpha);break}else switch(i){case Tn:l(lt.SrcAlpha,lt.OneMinusSrcAlpha,lt.One,lt.OneMinusSrcAlpha);break;case Jt:l(lt.SrcAlpha,lt.One,lt.SrcAlpha,lt.One);break;case Gc:l(lt.Zero,lt.OneMinusSrc,lt.Zero,lt.One);break;case Oc:l(lt.Zero,lt.Src,lt.Zero,lt.Src);break}}if(e!==void 0&&s!==void 0)return{color:e,alpha:s};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(t){let e;switch(t){case K5:e=lt.Zero;break;case J5:e=lt.One;break;case Q5:e=lt.Src;break;case t4:e=lt.OneMinusSrc;break;case Wc:e=lt.SrcAlpha;break;case $c:e=lt.OneMinusSrcAlpha;break;case i4:e=lt.Dst;break;case n4:e=lt.OneMinusDstColor;break;case e4:e=lt.DstAlpha;break;case s4:e=lt.OneMinusDstAlpha;break;case o4:e=lt.SrcAlphaSaturated;break;case ib:e=lt.Constant;break;case nb:e=lt.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",t)}return e}_getStencilCompare(t){let e;const s=t.stencilFunc;switch(s){case Vg:e=De.Never;break;case Yu:e=De.Always;break;case Gg:e=De.Less;break;case Wg:e=De.LessEqual;break;case Og:e=De.Equal;break;case qg:e=De.GreaterEqual;break;case $g:e=De.Greater;break;case Hg:e=De.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",s)}return e}_getStencilOperation(t){let e;switch(t){case Kn:e=un.Keep;break;case Bg:e=un.Zero;break;case Pg:e=un.Replace;break;case kg:e=un.Invert;break;case Ig:e=un.IncrementClamp;break;case Lg:e=un.DecrementClamp;break;case Ug:e=un.IncrementWrap;break;case zg:e=un.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",e)}return e}_getBlendOperation(t){let e;switch(t){case mn:e=jn.Add;break;case Z5:e=jn.Subtract;break;case j5:e=jn.ReverseSubtract;break;case fg:e=jn.Min;break;case mg:e=jn.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",t)}return e}_getPrimitiveState(t,e,s){const i={},n=this.backend.utils;switch(i.topology=n.getPrimitiveTopology(t,s),e.index!==null&&t.isLine===!0&&t.isLineSegments!==!0&&(i.stripIndexFormat=e.index.array instanceof Uint16Array?Ur.Uint16:Ur.Uint32),s.side){case go:i.frontFace=ou.CCW,i.cullMode=ru.Back;break;case ls:i.frontFace=ou.CCW,i.cullMode=ru.Front;break;case Kt:i.frontFace=ou.CCW,i.cullMode=ru.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",s.side);break}return i}_getColorWriteMask(t){return t.colorWrite===!0?u5.All:u5.None}_getDepthCompare(t){let e;if(t.depthTest===!1)e=De.Always;else{const s=t.depthFunc;switch(s){case r4:e=De.Never;break;case a4:e=De.Always;break;case c4:e=De.Less;break;case Hc:e=De.LessEqual;break;case l4:e=De.Equal;break;case u4:e=De.GreaterEqual;break;case p4:e=De.Greater;break;case h4:e=De.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",s)}}return e}}class VM extends Md{constructor(t={}){super(t),this.isWebGPUBackend=!0,this.parameters.alpha=t.alpha===void 0?!0:t.alpha,this.parameters.requiredLimits=t.requiredLimits===void 0?{}:t.requiredLimits,this.trackTimestamp=t.trackTimestamp===!0,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new BM(this),this.attributeUtils=new UM(this),this.bindingUtils=new zM(this),this.pipelineUtils=new kM(this),this.textureUtils=new SM(this),this.occludedResolveCache=new Map}async init(t){await super.init(t);const e=this.parameters;let s;if(e.device===void 0){const r={powerPreference:e.powerPreference},a=typeof navigator<"u"?await navigator.gpu.requestAdapter(r):null;if(a===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(bp),l=[];for(const p of c)a.features.has(p)&&l.push(p);const u={requiredFeatures:l,requiredLimits:e.requiredLimits};s=await a.requestDevice(u)}else s=e.device;s.lost.then(r=>{const a={api:"WebGPU",message:r.message||"Unknown reason",reason:r.reason||null,originalEvent:r};t.onDeviceLost(a)});const i=e.context!==void 0?e.context:t.domElement.getContext("webgpu");this.device=s,this.context=i;const n=e.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(bp.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:n}),this.updateSize()}get coordinateSystem(){return Xi}async getArrayBufferAsync(t){return await this.attributeUtils.getArrayBufferAsync(t)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let t=this.defaultRenderPassdescriptor;if(t===null){const s=this.renderer;t={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(t.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(s.depth,s.stencil).createView()});const i=t.colorAttachments[0];this.renderer.samples>0?i.view=this.colorBuffer.createView():i.resolveTarget=void 0,this.defaultRenderPassdescriptor=t}const e=t.colorAttachments[0];return this.renderer.samples>0?e.resolveTarget=this.context.getCurrentTexture().createView():e.view=this.context.getCurrentTexture().createView(),t}_getRenderPassDescriptor(t){const e=t.renderTarget,s=this.get(e);let i=s.descriptors;if(i===void 0||s.width!==e.width||s.height!==e.height||s.activeMipmapLevel!==e.activeMipmapLevel||s.samples!==e.samples){i={},s.descriptors=i;const a=()=>{e.removeEventListener("dispose",a),this.delete(e)};e.addEventListener("dispose",a)}const n=t.getCacheKey();let r=i[n];if(r===void 0){const a=t.textures,c=[];for(let l=0;l<a.length;l++){const u=this.get(a[l]),p=u.texture.createView({baseMipLevel:t.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:t.activeCubeFace,dimension:Es.TwoD});let h,d;u.msaaTexture!==void 0?(h=u.msaaTexture.createView(),d=p):(h=p,d=void 0),c.push({view:h,resolveTarget:d,loadOp:ye.Load,storeOp:Be.Store})}if(r={colorAttachments:c},t.depth){const u={view:this.get(t.depthTexture).texture.createView()};r.depthStencilAttachment=u}i[n]=r,s.width=e.width,s.height=e.height,s.samples=e.samples,s.activeMipmapLevel=e.activeMipmapLevel}return r}beginRender(t){const e=this.get(t),s=this.device,i=t.occlusionQueryCount;let n;i>0&&(e.currentOcclusionQuerySet&&e.currentOcclusionQuerySet.destroy(),e.currentOcclusionQueryBuffer&&e.currentOcclusionQueryBuffer.destroy(),e.currentOcclusionQuerySet=e.occlusionQuerySet,e.currentOcclusionQueryBuffer=e.occlusionQueryBuffer,e.currentOcclusionQueryObjects=e.occlusionQueryObjects,n=s.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${t.id}`}),e.occlusionQuerySet=n,e.occlusionQueryIndex=0,e.occlusionQueryObjects=new Array(i),e.lastOcclusionObject=null);let r;t.textures===null?r=this._getDefaultRenderPassDescriptor():r=this._getRenderPassDescriptor(t),this.initTimestampQuery(t,r),r.occlusionQuerySet=n;const a=r.depthStencilAttachment;if(t.textures!==null){const u=r.colorAttachments;for(let p=0;p<u.length;p++){const h=u[p];t.clearColor?(h.clearValue=p===0?t.clearColorValue:{r:0,g:0,b:0,a:1},h.loadOp=ye.Clear,h.storeOp=Be.Store):(h.loadOp=ye.Load,h.storeOp=Be.Store)}}else{const u=r.colorAttachments[0];t.clearColor?(u.clearValue=t.clearColorValue,u.loadOp=ye.Clear,u.storeOp=Be.Store):(u.loadOp=ye.Load,u.storeOp=Be.Store)}t.depth&&(t.clearDepth?(a.depthClearValue=t.clearDepthValue,a.depthLoadOp=ye.Clear,a.depthStoreOp=Be.Store):(a.depthLoadOp=ye.Load,a.depthStoreOp=Be.Store)),t.stencil&&(t.clearStencil?(a.stencilClearValue=t.clearStencilValue,a.stencilLoadOp=ye.Clear,a.stencilStoreOp=Be.Store):(a.stencilLoadOp=ye.Load,a.stencilStoreOp=Be.Store));const c=s.createCommandEncoder({label:"renderContext_"+t.id}),l=c.beginRenderPass(r);if(e.descriptor=r,e.encoder=c,e.currentPass=l,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.renderBundles=[],t.viewport&&this.updateViewport(t),t.scissor){const{x:u,y:p,width:h,height:d}=t.scissorValue;l.setScissorRect(u,p,h,d)}}finishRender(t){const e=this.get(t),s=t.occlusionQueryCount;if(e.renderBundles.length>0&&e.currentPass.executeBundles(e.renderBundles),s>e.occlusionQueryIndex&&e.currentPass.endOcclusionQuery(),e.currentPass.end(),s>0){const i=s*8;let n=this.occludedResolveCache.get(i);n===void 0&&(n=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,n));const r=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});e.encoder.resolveQuerySet(e.occlusionQuerySet,0,s,n,0),e.encoder.copyBufferToBuffer(n,0,r,0,i),e.occlusionQueryBuffer=r,this.resolveOccludedAsync(t)}if(this.prepareTimestampBuffer(t,e.encoder),this.device.queue.submit([e.encoder.finish()]),t.textures!==null){const i=t.textures;for(let n=0;n<i.length;n++){const r=i[n];r.generateMipmaps===!0&&this.textureUtils.generateMipmaps(r)}}}isOccluded(t,e){const s=this.get(t);return s.occluded&&s.occluded.has(e)}async resolveOccludedAsync(t){const e=this.get(t),{currentOcclusionQueryBuffer:s,currentOcclusionQueryObjects:i}=e;if(s&&i){const n=new WeakSet;e.currentOcclusionQueryObjects=null,e.currentOcclusionQueryBuffer=null,await s.mapAsync(GPUMapMode.READ);const r=s.getMappedRange(),a=new BigUint64Array(r);for(let c=0;c<i.length;c++)a[c]!==BigInt(0)&&n.add(i[c]);s.destroy(),e.occluded=n}}updateViewport(t){const{currentPass:e}=this.get(t),{x:s,y:i,width:n,height:r,minDepth:a,maxDepth:c}=t.viewportValue;e.setViewport(s,i,n,r,a,c)}clear(t,e,s,i=null){const n=this.device,r=this.renderer;let a=[],c,l,u,p;if(t){const g=this.getClearColor();if(this.renderer.alpha===!0){const f=g.a;l={r:g.r*f,g:g.g*f,b:g.b*f,a:f}}else l={r:g.r,g:g.g,b:g.b,a:g.a}}if(i===null){u=r.depth,p=r.stencil;const g=this._getDefaultRenderPassDescriptor();if(t){a=g.colorAttachments;const f=a[0];f.clearValue=l,f.loadOp=ye.Clear,f.storeOp=Be.Store}(u||p)&&(c=g.depthStencilAttachment)}else{if(u=i.depth,p=i.stencil,t)for(const g of i.textures){const f=this.get(g),m=f.texture.createView();let x,w;f.msaaTexture!==void 0?(x=f.msaaTexture.createView(),w=m):(x=m,w=void 0),a.push({view:x,resolveTarget:w,clearValue:l,loadOp:ye.Clear,storeOp:Be.Store})}(u||p)&&(c={view:this.get(i.depthTexture).texture.createView()})}u&&(e?(c.depthLoadOp=ye.Clear,c.depthClearValue=r.getClearDepth(),c.depthStoreOp=Be.Store):(c.depthLoadOp=ye.Load,c.depthStoreOp=Be.Store)),p&&(s?(c.stencilLoadOp=ye.Clear,c.stencilClearValue=r.getClearStencil(),c.stencilStoreOp=Be.Store):(c.stencilLoadOp=ye.Load,c.stencilStoreOp=Be.Store));const h=n.createCommandEncoder({});h.beginRenderPass({colorAttachments:a,depthStencilAttachment:c}).end(),n.queue.submit([h.finish()])}beginCompute(t){const e=this.get(t),s={};this.initTimestampQuery(t,s),e.cmdEncoderGPU=this.device.createCommandEncoder(),e.passEncoderGPU=e.cmdEncoderGPU.beginComputePass(s)}compute(t,e,s,i){const{passEncoderGPU:n}=this.get(t),r=this.get(i).pipeline;n.setPipeline(r);for(let u=0,p=s.length;u<p;u++){const h=s[u],d=this.get(h);n.setBindGroup(u,d.group)}const a=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(e);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:l}=c;e.dispatchCount>a?(l.x=Math.min(e.dispatchCount,a),l.y=Math.ceil(e.dispatchCount/a)):l.x=e.dispatchCount,n.dispatchWorkgroups(l.x,l.y,l.z)}finishCompute(t){const e=this.get(t);e.passEncoderGPU.end(),this.prepareTimestampBuffer(t,e.cmdEncoderGPU),this.device.queue.submit([e.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(t,e){const{object:s,context:i,pipeline:n}=t,r=t.getBindings(),a=this.get(i),c=this.get(n).pipeline,l=a.currentSets,u=a.currentPass,p=t.getDrawParameters();if(p===null)return;l.pipeline!==c&&(u.setPipeline(c),l.pipeline=c);const h=l.bindingGroups;for(let m=0,x=r.length;m<x;m++){const w=r[m],b=this.get(w);h[w.index]!==w.id&&(u.setBindGroup(w.index,b.group),h[w.index]=w.id)}const d=t.getIndex(),g=d!==null;if(g===!0&&l.index!==d){const m=this.get(d).buffer,x=d.array instanceof Uint16Array?Ur.Uint16:Ur.Uint32;u.setIndexBuffer(m,x),l.index=d}const f=t.getVertexBuffers();for(let m=0,x=f.length;m<x;m++){const w=f[m];if(l.attributes[m]!==w){const b=this.get(w).buffer;u.setVertexBuffer(m,b),l.attributes[m]=w}}if(a.occlusionQuerySet!==void 0){const m=a.lastOcclusionObject;m!==s&&(m!==null&&m.occlusionTest===!0&&(u.endOcclusionQuery(),a.occlusionQueryIndex++),s.occlusionTest===!0&&(u.beginOcclusionQuery(a.occlusionQueryIndex),a.occlusionQueryObjects[a.occlusionQueryIndex]=s),a.lastOcclusionObject=s)}if(s.isBatchedMesh===!0){const m=s._multiDrawStarts,x=s._multiDrawCounts,w=s._multiDrawCount,b=s._multiDrawInstances,v=g?d.array.BYTES_PER_ELEMENT:1;for(let T=0;T<w;T++){const M=b?b[T]:1,F=M>1?0:T;u.drawIndexed(x[T],M,m[T]/v,0,F)}}else if(g===!0){const{vertexCount:m,instanceCount:x,firstVertex:w}=p,b=t.getIndirect();if(b!==null){const v=this.get(b).buffer;u.drawIndexedIndirect(v,0)}else u.drawIndexed(m,x,w,0,0);e.update(s,m,x)}else{const{vertexCount:m,instanceCount:x,firstVertex:w}=p,b=t.getIndirect();if(b!==null){const v=this.get(b).buffer;u.drawIndirect(v,0)}else u.draw(m,x,w,0);e.update(s,m,x)}}needsRenderUpdate(t){const e=this.get(t),{object:s,material:i}=t,n=this.utils,r=n.getSampleCountRenderContext(t.context),a=n.getCurrentColorSpace(t.context),c=n.getCurrentColorFormat(t.context),l=n.getCurrentDepthStencilFormat(t.context),u=n.getPrimitiveTopology(s,i);let p=!1;return(e.material!==i||e.materialVersion!==i.version||e.transparent!==i.transparent||e.blending!==i.blending||e.premultipliedAlpha!==i.premultipliedAlpha||e.blendSrc!==i.blendSrc||e.blendDst!==i.blendDst||e.blendEquation!==i.blendEquation||e.blendSrcAlpha!==i.blendSrcAlpha||e.blendDstAlpha!==i.blendDstAlpha||e.blendEquationAlpha!==i.blendEquationAlpha||e.colorWrite!==i.colorWrite||e.depthWrite!==i.depthWrite||e.depthTest!==i.depthTest||e.depthFunc!==i.depthFunc||e.stencilWrite!==i.stencilWrite||e.stencilFunc!==i.stencilFunc||e.stencilFail!==i.stencilFail||e.stencilZFail!==i.stencilZFail||e.stencilZPass!==i.stencilZPass||e.stencilFuncMask!==i.stencilFuncMask||e.stencilWriteMask!==i.stencilWriteMask||e.side!==i.side||e.alphaToCoverage!==i.alphaToCoverage||e.sampleCount!==r||e.colorSpace!==a||e.colorFormat!==c||e.depthStencilFormat!==l||e.primitiveTopology!==u||e.clippingContextCacheKey!==t.clippingContextCacheKey)&&(e.material=i,e.materialVersion=i.version,e.transparent=i.transparent,e.blending=i.blending,e.premultipliedAlpha=i.premultipliedAlpha,e.blendSrc=i.blendSrc,e.blendDst=i.blendDst,e.blendEquation=i.blendEquation,e.blendSrcAlpha=i.blendSrcAlpha,e.blendDstAlpha=i.blendDstAlpha,e.blendEquationAlpha=i.blendEquationAlpha,e.colorWrite=i.colorWrite,e.depthWrite=i.depthWrite,e.depthTest=i.depthTest,e.depthFunc=i.depthFunc,e.stencilWrite=i.stencilWrite,e.stencilFunc=i.stencilFunc,e.stencilFail=i.stencilFail,e.stencilZFail=i.stencilZFail,e.stencilZPass=i.stencilZPass,e.stencilFuncMask=i.stencilFuncMask,e.stencilWriteMask=i.stencilWriteMask,e.side=i.side,e.alphaToCoverage=i.alphaToCoverage,e.sampleCount=r,e.colorSpace=a,e.colorFormat=c,e.depthStencilFormat=l,e.primitiveTopology=u,e.clippingContextCacheKey=t.clippingContextCacheKey,p=!0),p}getRenderCacheKey(t){const{object:e,material:s}=t,i=this.utils,n=t.context;return[s.transparent,s.blending,s.premultipliedAlpha,s.blendSrc,s.blendDst,s.blendEquation,s.blendSrcAlpha,s.blendDstAlpha,s.blendEquationAlpha,s.colorWrite,s.depthWrite,s.depthTest,s.depthFunc,s.stencilWrite,s.stencilFunc,s.stencilFail,s.stencilZFail,s.stencilZPass,s.stencilFuncMask,s.stencilWriteMask,s.side,i.getSampleCountRenderContext(n),i.getCurrentColorSpace(n),i.getCurrentColorFormat(n),i.getCurrentDepthStencilFormat(n),i.getPrimitiveTopology(e,s),t.getGeometryCacheKey(),t.clippingContextCacheKey].join()}createSampler(t){this.textureUtils.createSampler(t)}destroySampler(t){this.textureUtils.destroySampler(t)}createDefaultTexture(t){this.textureUtils.createDefaultTexture(t)}createTexture(t,e){this.textureUtils.createTexture(t,e)}updateTexture(t,e){this.textureUtils.updateTexture(t,e)}generateMipmaps(t){this.textureUtils.generateMipmaps(t)}destroyTexture(t){this.textureUtils.destroyTexture(t)}copyTextureToBuffer(t,e,s,i,n,r){return this.textureUtils.copyTextureToBuffer(t,e,s,i,n,r)}initTimestampQuery(t,e){if(!this.trackTimestamp)return;const s=this.get(t);if(!s.timeStampQuerySet){const i=t.isComputeNode?"compute":"render",n=this.device.createQuerySet({type:"timestamp",count:2,label:`timestamp_${i}_${t.id}`});Object.assign(e,{timestampWrites:{querySet:n,beginningOfPassWriteIndex:0,endOfPassWriteIndex:1}}),s.timeStampQuerySet=n}}prepareTimestampBuffer(t,e){if(!this.trackTimestamp)return;const s=this.get(t),i=2*BigInt64Array.BYTES_PER_ELEMENT;s.currentTimestampQueryBuffers===void 0&&(s.currentTimestampQueryBuffers={resolveBuffer:this.device.createBuffer({label:"timestamp resolve buffer",size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),resultBuffer:this.device.createBuffer({label:"timestamp result buffer",size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})});const{resolveBuffer:n,resultBuffer:r}=s.currentTimestampQueryBuffers;e.resolveQuerySet(s.timeStampQuerySet,0,2,n,0),r.mapState==="unmapped"&&e.copyBufferToBuffer(n,0,r,0,i)}async resolveTimestampAsync(t,e="render"){if(!this.trackTimestamp)return;const s=this.get(t);if(s.currentTimestampQueryBuffers===void 0)return;const{resultBuffer:i}=s.currentTimestampQueryBuffers;await this.device.queue.onSubmittedWorkDone(),i.mapState==="unmapped"&&i.mapAsync(GPUMapMode.READ).then(()=>{const n=new BigUint64Array(i.getMappedRange()),r=Number(n[1]-n[0])/1e6;this.renderer.info.updateTimestamp(e,r),i.unmap()})}createNodeBuilder(t,e){return new DM(t,e)}createProgram(t){const e=this.get(t);e.module={module:this.device.createShaderModule({code:t.code,label:t.stage}),entryPoint:"main"}}destroyProgram(t){this.delete(t)}createRenderPipeline(t,e){this.pipelineUtils.createRenderPipeline(t,e)}createComputePipeline(t,e){this.pipelineUtils.createComputePipeline(t,e)}beginBundle(t){const e=this.get(t);e._currentPass=e.currentPass,e._currentSets=e.currentSets,e.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.currentPass=this.pipelineUtils.createBundleEncoder(t)}finishBundle(t,e){const s=this.get(t),n=s.currentPass.finish();this.get(e).bundleGPU=n,s.currentSets=s._currentSets,s.currentPass=s._currentPass}addBundle(t,e){this.get(t).renderBundles.push(this.get(e).bundleGPU)}createBindings(t,e,s,i){this.bindingUtils.createBindings(t,e,s,i)}updateBindings(t,e,s,i){this.bindingUtils.createBindings(t,e,s,i)}updateBinding(t){this.bindingUtils.updateBinding(t)}createIndexAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(t){this.attributeUtils.createAttribute(t,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(t){this.attributeUtils.updateAttribute(t)}destroyAttribute(t){this.attributeUtils.destroyAttribute(t)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(t){return this.device.features.has(t)}copyTextureToTexture(t,e,s=null,i=null,n=0){let r=0,a=0,c=0,l=0,u=0,p=0,h=t.image.width,d=t.image.height;s!==null&&(l=s.x,u=s.y,p=s.z||0,h=s.width,d=s.height),i!==null&&(r=i.x,a=i.y,c=i.z||0);const g=this.device.createCommandEncoder({label:"copyTextureToTexture_"+t.id+"_"+e.id}),f=this.get(t).texture,m=this.get(e).texture;g.copyTextureToTexture({texture:f,mipLevel:n,origin:{x:l,y:u,z:p}},{texture:m,mipLevel:n,origin:{x:r,y:a,z:c}},[h,d,1]),this.device.queue.submit([g.finish()])}copyFramebufferToTexture(t,e,s){const i=this.get(e);let n=null;e.renderTarget?t.isDepthTexture?n=this.get(e.depthTexture).texture:n=this.get(e.textures[0]).texture:t.isDepthTexture?n=this.textureUtils.getDepthBuffer(e.depth,e.stencil):n=this.context.getCurrentTexture();const r=this.get(t).texture;if(n.format!==r.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",n.format,r.format);return}let a;if(i.currentPass?(i.currentPass.end(),a=i.encoder):a=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+t.id}),a.copyTextureToTexture({texture:n,origin:[s.x,s.y,0]},{texture:r},[s.z,s.w]),t.generateMipmaps&&this.textureUtils.generateMipmaps(t),i.currentPass){const{descriptor:c}=i;for(let l=0;l<c.colorAttachments.length;l++)c.colorAttachments[l].loadOp=ye.Load;if(e.depth&&(c.depthStencilAttachment.depthLoadOp=ye.Load),e.stencil&&(c.depthStencilAttachment.stencilLoadOp=ye.Load),i.currentPass=a.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},e.viewport&&this.updateViewport(e),e.scissor){const{x:l,y:u,width:p,height:h}=e.scissorValue;i.currentPass.setScissorRect(l,u,p,h)}}else this.device.queue.submit([a.finish()])}}class GM extends Y4{constructor(t,e,s,i,n,r){super(t,e,s,i,n,r),this.iesMap=null}copy(t,e){return super.copy(t,e),this.iesMap=t.iesMap,this}}class OM extends xd{constructor(){super(),this.addMaterial(sw,"MeshPhongMaterial"),this.addMaterial(ds,"MeshStandardMaterial"),this.addMaterial(Pw,"MeshPhysicalMaterial"),this.addMaterial(zw,"MeshToonMaterial"),this.addMaterial(Ol,"MeshBasicMaterial"),this.addMaterial(tw,"MeshLambertMaterial"),this.addMaterial($x,"MeshNormalMaterial"),this.addMaterial(Gw,"MeshMatcapMaterial"),this.addMaterial(Ux,"LineBasicMaterial"),this.addMaterial(kx,"LineDashedMaterial"),this.addMaterial(w0,"PointsMaterial"),this.addMaterial(Hw,"SpriteMaterial"),this.addMaterial(Xw,"ShadowMaterial"),this.addLight(W_,zn),this.addLight(ET,X4),this.addLight(DT,Mm),this.addLight(md,Y4),this.addLight(PT,Tm),this.addLight(IT,q4),this.addLight(LT,Nm),this.addLight(BT,GM),this.addToneMapping(U9,wg),this.addToneMapping(z9,bg),this.addToneMapping(k9,vg),this.addToneMapping(V9,d4),this.addToneMapping(G9,_g),this.addToneMapping(O9,Sg)}}class WM extends YT{constructor(t={}){let e;t.forceWebGL?e=l5:(e=VM,t.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new l5(t)));const s=new e(t);super(s,t),this.library=new OM,this.isWebGPURenderer=!0}}y.BRDF_GGX;y.BRDF_Lambert;y.BasicShadowFilter;y.Break;y.Continue;y.DFGApprox;y.D_GGX;y.Discard;y.EPSILON;y.F_Schlick;const Do=y.Fn;y.INFINITY;y.If;y.Loop;y.NodeShaderStage;y.NodeType;y.NodeUpdateType;y.NodeAccess;y.PCFShadowFilter;y.PCFSoftShadowFilter;y.PI;y.PI2;y.Return;y.Schlick_to_F0;y.ScriptableNodeResources;y.ShaderNode;y.TBNViewMatrix;y.VSMShadowFilter;y.V_GGX_SmithCorrelated;const jl=y.abs;y.acesFilmicToneMapping;y.acos;y.add;y.addMethodChaining;y.addNodeElement;y.agxToneMapping;y.all;y.alphaT;y.and;y.anisotropy;y.anisotropyB;y.anisotropyT;y.any;y.append;y.arrayBuffer;y.asin;y.assign;y.atan;const $M=y.atan2;y.atomicAdd;y.atomicAnd;y.atomicFunc;y.atomicMax;y.atomicMin;y.atomicOr;y.atomicStore;y.atomicSub;y.atomicXor;y.attenuationColor;y.attenuationDistance;const Bs=y.attribute;y.attributeArray;y.backgroundBlurriness;y.backgroundIntensity;y.backgroundRotation;y.batch;y.billboarding;y.bitAnd;y.bitNot;y.bitOr;y.bitXor;y.bitangentGeometry;y.bitangentLocal;y.bitangentView;y.bitangentWorld;y.bitcast;y.blendBurn;y.blendColor;y.blendDodge;y.blendOverlay;y.blendScreen;y.blur;y.bool;y.buffer;y.bufferAttribute;y.bumpMap;y.burn;y.bvec2;y.bvec3;y.bvec4;y.bypass;y.cache;y.call;y.cameraFar;y.cameraNear;y.cameraNormalMatrix;const Kl=y.cameraPosition;y.cameraProjectionMatrix;y.cameraProjectionMatrixInverse;y.cameraViewMatrix;y.cameraWorldMatrix;y.cbrt;y.cdl;y.ceil;y.checker;y.cineonToneMapping;y.clamp;y.clearcoat;y.clearcoatRoughness;y.code;const ot=y.color;y.colorSpaceToWorking;y.colorToDirection;y.compute;y.cond;y.context;y.convert;y.convertColorSpace;y.convertToTexture;const zr=y.cos;y.cross;y.cubeTexture;y.dFdx;y.dFdy;y.dashSize;y.defaultBuildStages;y.defaultShaderStages;y.defined;y.degrees;y.deltaTime;y.densityFog;y.depth;y.depthPass;y.difference;y.diffuseColor;y.directPointLight;y.directionToColor;y.dispersion;const HM=y.distance;y.div;y.dodge;const kr=y.dot;y.drawIndex;y.dynamicBufferAttribute;y.element;y.emissive;y.equal;y.equals;y.equirectUV;const qM=y.exp;y.exp2;y.expression;y.faceDirection;y.faceForward;const X=y.float,m5=y.floor;y.fog;y.fract;y.frameGroup;y.frameId;y.frontFacing;y.fwidth;y.gain;y.gapSize;y.getConstNodeType;y.getCurrentStack;y.getDirection;y.getDistanceAttenuation;y.getGeometryRoughness;y.getNormalFromDepth;y.getParallaxCorrectNormal;y.getRoughness;y.getScreenPosition;y.getShIrradianceAt;y.getTextureIndex;y.getViewPosition;y.glsl;y.glslFn;y.grayscale;y.greaterThan;y.greaterThanEqual;y.hash;y.highPrecisionModelNormalViewMatrix;y.highPrecisionModelViewMatrix;y.hue;y.instance;y.instanceIndex;y.instancedArray;y.instancedBufferAttribute;y.instancedDynamicBufferAttribute;y.instancedMesh;y.int;y.inverseSqrt;y.invocationLocalIndex;y.invocationSubgroupIndex;y.ior;y.iridescence;y.iridescenceIOR;y.iridescenceThickness;y.ivec2;y.ivec3;y.ivec4;y.js;y.label;const YM=y.length;y.lengthSq;y.lessThan;y.lessThanEqual;y.lightPosition;y.lightTargetDirection;y.lightTargetPosition;y.lightViewPosition;y.lightingContext;y.lights;y.linearDepth;y.linearToneMapping;y.localId;y.log;y.log2;y.logarithmicDepthToViewZ;y.loop;y.luminance;y.mat2;y.mat3;y.mat4;y.matcapUV;y.materialAOMap;y.materialAlphaTest;y.materialAnisotropy;y.materialAnisotropyVector;y.materialAttenuationColor;y.materialAttenuationDistance;y.materialClearcoat;y.materialClearcoatNormal;y.materialClearcoatRoughness;y.materialColor;y.materialDispersion;y.materialEmissive;y.materialIOR;y.materialIridescence;y.materialIridescenceIOR;y.materialIridescenceThickness;y.materialLightMap;y.materialLineDashOffset;y.materialLineDashSize;y.materialLineGapSize;y.materialLineScale;y.materialLineWidth;y.materialMetalness;y.materialNormal;y.materialOpacity;y.materialPointWidth;y.materialReference;y.materialReflectivity;y.materialRefractionRatio;y.materialRotation;y.materialRoughness;y.materialSheen;y.materialSheenRoughness;y.materialShininess;y.materialSpecular;y.materialSpecularColor;y.materialSpecularIntensity;y.materialSpecularStrength;y.materialThickness;y.materialTransmission;const fh=y.max;y.maxMipLevel;y.metalness;y.min;const de=y.mix;y.mixElement;y.mod;y.modInt;y.modelDirection;y.modelNormalMatrix;y.modelPosition;y.modelScale;y.modelViewMatrix;y.modelViewPosition;y.modelViewProjection;y.modelWorldMatrix;y.modelWorldMatrixInverse;y.morphReference;y.mrt;y.mul;y.mx_aastep;y.mx_cell_noise_float;y.mx_contrast;y.mx_fractal_noise_float;y.mx_fractal_noise_vec2;y.mx_fractal_noise_vec3;y.mx_fractal_noise_vec4;y.mx_hsvtorgb;const We=y.mx_noise_float;y.mx_noise_vec3;y.mx_noise_vec4;y.mx_ramplr;y.mx_ramptb;y.mx_rgbtohsv;y.mx_safepower;y.mx_splitlr;y.mx_splittb;y.mx_srgb_texture_to_lin_rec709;y.mx_transform_uv;y.mx_worley_noise_float;y.mx_worley_noise_vec2;y.mx_worley_noise_vec3;y.negate;y.neutralToneMapping;y.nodeArray;y.nodeImmutable;y.nodeObject;y.nodeObjects;y.nodeProxy;y.normalFlat;y.normalGeometry;const Nd=y.normalLocal;y.normalMap;const XM=y.normalView,po=y.normalWorld,Vr=y.normalize;y.not;y.notEqual;y.numWorkgroups;y.objectDirection;y.objectGroup;y.objectPosition;y.objectScale;y.objectViewPosition;y.objectWorldMatrix;y.oneMinus;y.or;y.orthographicDepthToViewZ;y.oscSawtooth;y.oscSine;y.oscSquare;y.oscTriangle;y.output;y.outputStruct;y.overlay;y.overloadingFn;y.parabola;y.parallaxDirection;y.parallaxUV;y.parameter;y.pass;y.passTexture;y.pcurve;y.perspectiveDepthToViewZ;y.pmremTexture;y.pointUV;y.pointWidth;y.positionGeometry;const Lt=y.positionLocal;y.positionPrevious;y.positionView;y.positionViewDirection;const Ls=y.positionWorld;y.positionWorldDirection;y.posterize;const ZM=y.pow;y.pow2;y.pow3;y.pow4;y.property;y.radians;y.rand;y.range;y.rangeFog;y.reciprocal;y.reference;y.referenceBuffer;const jM=y.reflect;y.reflectVector;y.reflectView;y.reflector;y.refract;y.refractVector;y.refractView;y.reinhardToneMapping;y.remainder;y.remap;y.remapClamp;y.renderGroup;y.renderOutput;y.rendererReference;y.rotate;y.rotateUV;y.roughness;y.round;y.rtt;y.sRGBTransferEOTF;y.sRGBTransferOETF;y.sampler;y.saturate;y.saturation;y.screen;y.screenCoordinate;y.screenSize;const KM=y.screenUV;y.scriptable;y.scriptableValue;y.select;y.setCurrentStack;y.shaderStages;y.shadow;y.sharedUniformGroup;y.sheen;y.sheenRoughness;y.shiftLeft;y.shiftRight;y.shininess;const y5=y.sign,At=y.sin;y.sinc;y.skinning;y.skinningReference;const Pt=y.smoothstep;y.smoothstepElement;y.specularColor;y.specularF90;y.spherizeUV;y.split;y.spritesheetUV;y.sqrt;y.stack;y.step;y.storage;y.storageBarrier;y.storageObject;y.storageTexture;y.string;y.sub;y.subgroupIndex;y.subgroupSize;y.tan;y.tangentGeometry;y.tangentLocal;y.tangentView;y.tangentWorld;y.temp;const JM=y.texture;y.texture3D;y.textureBarrier;y.textureBicubic;y.textureCubeUV;y.textureLoad;y.textureSize;y.textureStore;y.thickness;y.threshold;const Ge=y.time;y.timerDelta;y.timerGlobal;y.timerLocal;y.toOutputColorSpace;y.toWorkingColorSpace;y.toneMapping;y.toneMappingExposure;y.toonOutlinePass;y.transformDirection;y.transformNormal;y.transformNormalToView;y.transformedBentNormalView;y.transformedBitangentView;y.transformedBitangentWorld;y.transformedClearcoatNormalView;y.transformedNormalView;y.transformedNormalWorld;y.transformedTangentView;y.transformedTangentWorld;y.transmission;y.transpose;y.tri;y.tri3;y.triNoise3D;y.triplanarTexture;y.triplanarTextures;y.trunc;y.tslFn;y.uint;const Ct=y.uniform;y.uniformArray;y.uniformGroup;y.uniforms;y.userData;const ti=y.uv;y.uvec2;y.uvec3;y.uvec4;y.varying;y.varyingProperty;const al=y.vec2,at=y.vec3,mh=y.vec4;y.vectorComponents;y.velocity;y.vertexColor;y.vertexIndex;y.vibrance;y.viewZToLogarithmicDepth;y.viewZToOrthographicDepth;y.viewZToPerspectiveDepth;y.viewport;y.viewportBottomLeft;y.viewportCoordinate;y.viewportDepthTexture;y.viewportLinearDepth;y.viewportMipTexture;y.viewportResolution;y.viewportSafeUV;const uu=y.viewportSharedTexture;y.viewportSize;y.viewportTexture;y.viewportTopLeft;y.viewportUV;y.wgsl;y.wgslFn;y.workgroupArray;y.workgroupBarrier;y.workgroupId;y.workingToColorSpace;y.xor;const QM=(o,t,e)=>{const s=de(X(2048),X(32),e),i=m5(o.mul(s)).div(s),n=X(10),a=m5(t.mul(X(5))).div(X(5)).add(e.mul(X(100))),c=We(a.mul(n)),l=We(a.mul(n).add(at(12.3,4.5,6.7))),u=We(a.mul(n).add(at(7.8,9,1.2))),p=at(c,l,u).sub(.5).mul(e).mul(.5),h=t.add(p);return{uv:i,position:h}},ft={unitSphere:new ne(1,16,16),unitCylinder:new Re(1,1,1,12).translate(0,.5,0),unitCone:new Rn(1,1,16).translate(0,.5,0),quad:new $i(1,1),sphere:new ne(1,16,16),sphereLow:new ne(1,8,8),cylinder:new Re(1,1,1,12).translate(0,.5,0),cylinderLow:new Re(1,1,1,8).translate(0,.5,0),capsule:new o0(.5,1,6,8),eye:new ne(.12,16,16),pupil:new ne(.05,12,12),mushroomCap:new ne(1,24,24,0,Math.PI*2,0,Math.PI/1.8),mushroomGillCenter:new Rn(1,1,24,1,!0),unitCylinder:new Re(1,1,1,12).translate(0,.5,0),unitSphere:new ne(1,16,16)},x5=ft.eye;let tA=0;const Bc=[],Nr=new W,_p=Ct(0),Sp=Ct(at(1,0,0)),$e=Ct(0),Vi=Ct(0),zs=Ct(0),Bn=Ct(0);function eA(o){if(o.length===0)return 0;const t=[...o].sort((s,i)=>s-i),e=Math.floor(t.length/2);return t.length%2!==0?t[e]:(t[e-1]+t[e])/2}const sA=Do(([o,t])=>{const e=o.mul(t),s=jl(po),i=We(at(e.y,e.z,0)),n=We(at(e.x,e.z,0)),r=We(at(e.x,e.y,0)),a=s.div(s.x.add(s.y).add(s.z));return i.mul(a.x).add(n.mul(a.y)).add(r.mul(a.z))}),iA=Do(([o,t,e,s])=>{const i=X(.01),n=e,r=We(o.mul(n)),a=We(o.add(at(i,0,0)).mul(n)),c=We(o.add(at(0,i,0)).mul(n)),l=We(o.add(at(0,0,i)).mul(n)),u=a.sub(r).div(i),p=c.sub(r).div(i),h=l.sub(r).div(i),d=at(u,p,h);return Vr(t.sub(d.mul(s)))}),_0=Do(([o,t,e,s])=>{const i=Vr(Kl.sub(Ls)),r=jl(kr(s||po,i)),a=X(1).sub(r).pow(e);return o.mul(a).mul(t)});Do(([o,t])=>o.add(_0(ot(16777215),X(.5),X(3),t)));function is(o,t={}){const{roughness:e=.5,metalness:s=0,bumpStrength:i=0,noiseScale:n=5,triplanar:r=!1,side:a=go,transmission:c=0,thickness:l=0,ior:u=1.5,thicknessDistortion:p=0,subsurfaceStrength:h=0,subsurfaceColor:d=16777215,iridescenceStrength:g=0,iridescenceFresnelPower:f=4,sheen:m=0,sheenColor:x=16777215,sheenRoughness:w=1,animateMoisture:b=!1,animatePulse:v=!1}=t,T=new ds;T.colorNode=ot(o),T.roughnessNode=X(e),T.metalnessNode=X(s),T.side=a;let M=X(0);if(i>0||p>0||b){let A=Lt;if(b){const E=at(0,$e.mul(.2),0);A=A.add(E)}r?M=sA(A,X(n)):M=We(A.mul(X(n)))}if(i>0){T.normalNode=iA(Lt,po,X(n),X(i));const A=Pt(.3,.7,M);T.colorNode=T.colorNode.mul(A.mul(.5).add(.5))}if(b){const A=M.mul(.3);T.roughnessNode=T.roughnessNode.sub(A)}if(c>0){T.transmissionNode=X(c),T.iorNode=X(u),T.transparent=!0;let A=X(l);p>0&&(A=A.mul(M.mul(p).add(1))),T.thicknessNode=A;const E=qM(A.negate().mul(.5));T.colorNode=T.colorNode.mul(E.add(.2))}if(h>0){const A=Vr(at(.5,1,.5)),E=kr(po,A),U=X(1).sub(fh(0,E)).pow(2),$=ot(d),Z=U.mul(h).mul($);T.colorNode=T.colorNode.add(Z)}if(g>0){const A=Vr(Kl.sub(Ls)),E=jl(kr(po,A)),U=X(1).sub(E).pow(X(f)),$=At(U.mul(10)),Z=At(U.mul(10).add(2)),j=At(U.mul(10).add(4)),ut=at($,Z,j).mul(.5).add(.5);T.emissiveNode=ut.mul(g).mul(U)}if(v){const A=At($e.mul(3)).mul(.2).add(.8);T.emissiveNode=(T.emissiveNode||ot(0)).add(T.colorNode.mul(A.mul(.2)))}m>0&&(T.sheen=m,T.sheenColorNode=ot(x),T.sheenRoughnessNode=X(w));const F=T.positionNode||Lt,N=QM(ti(),F,Vi);return T.positionNode=N.position,T.userData.isUnified=!0,T}const Vt={Clay:(o,t={})=>is(o,{roughness:.8,bumpStrength:.15,noiseScale:8,triplanar:!0,...t}),Sugar:(o,t={})=>is(o,{roughness:.6,bumpStrength:.8,noiseScale:60,sheen:1,sheenColor:16777215,sheenRoughness:.5,...t}),Gummy:(o,t={})=>is(o,{transmission:.9,thickness:1.5,roughness:.2,ior:1.4,subsurfaceStrength:.6,subsurfaceColor:o,thicknessDistortion:.3,...t}),SeaJelly:(o,t={})=>is(o,{transmission:.95,thickness:.8,ior:1.33,roughness:.05,subsurfaceStrength:.4,subsurfaceColor:13434879,animateMoisture:!0,thicknessDistortion:.5,...t}),Crystal:(o,t={})=>is(o,{transmission:1,thickness:4,roughness:0,ior:2,iridescenceStrength:.7,iridescenceFresnelPower:2.5,...t}),Velvet:(o,t={})=>is(o,{roughness:1,sheen:1,sheenColor:o,sheenRoughness:1,bumpStrength:.05,...t}),OilSlick:(o=2236962,t={})=>is(o,{roughness:.3,metalness:.8,iridescenceStrength:1,iridescenceFresnelPower:1.5,...t})};function Ut(o){return Vt.Clay(o)}function S0(o){return Vt.Gummy(o)}function Bo(o={}){const t=new ds;return o.color!==void 0&&(t.colorNode=ot(o.color)),o.roughness!==void 0&&(t.roughnessNode=X(o.roughness)),o.metalness!==void 0&&(t.metalnessNode=X(o.metalness)),o.emissive!==void 0&&(t.emissiveNode=ot(o.emissive)),o.emissiveIntensity!==void 0&&o.emissive!==void 0&&(t.emissiveNode=ot(o.emissive).mul(X(o.emissiveIntensity))),o.transparent&&(t.transparent=!0),o.opacity!==void 0&&(t.opacity=o.opacity),o.side!==void 0&&(t.side=o.side),o.blending!==void 0&&(t.blending=o.blending),o.depthWrite!==void 0&&(t.depthWrite=o.depthWrite),t}function La(o={}){const t=Bo(o);return t.transparent=!0,t.depthWrite=o.depthWrite!==void 0?o.depthWrite:!1,t}const Rt={stem:Vt.Clay(6728277),flowerCenter:Vt.Velvet(4465169),vine:Vt.Clay(5605427),wood:is(9127187,{roughness:.9,bumpStrength:.3,noiseScale:3}),leaf:is(2263842,{roughness:.6,side:Kt,bumpStrength:.1}),flowerStem:Vt.Clay(6728277),lotusRing:Vt.Gummy(16777215),opticCable:is(1118481,{roughness:.4}),opticTip:Bo({color:16777215,emissive:16711935,emissiveIntensity:1,roughness:.2}),lightBeam:new ds({color:16777215,transparent:!0,opacity:.2,blending:Jt,depthWrite:!1,roughness:1}),mushroomStem:(()=>{const o=Vt.Clay(16119260),t=Lt.y,e=X(1).sub(ZM(t.sub(.3),2).mul(.5)),s=at(Lt.x.mul(e),Lt.y,Lt.z.mul(e));o.positionNode=s;const i=t.sub(.3),n=at(Lt.x,i,Lt.z).normalize();return o.normalNode=n,o})(),mushroomCap:[Vt.Clay(16739179),Vt.Gummy(16752451),Vt.Sugar(16632686),Vt.Crystal(5546239),Vt.OilSlick()],mushroomCheek:Vt.Velvet(16755404),mushroomGills:Vt.Clay(3351057,{side:Kt}),mushroomSpots:Vt.Sugar(16777215),flowerPetal:[Vt.Velvet(16738740,{side:Kt}),Vt.Gummy(16766720,{side:Kt}),Vt.Crystal(16777215,{side:Kt}),Vt.Sugar(10040319,{side:Kt})],eye:Vt.Gummy(16777215),pupil:new ds({color:0,roughness:0}),mouth:Vt.Clay(2962486),clayMouth:Vt.Clay(2962486)};function te(o){Bc.push(o)}function Hr(o){return o[Math.floor(Math.random()*o.length)]}function Wt(o,t={}){o.userData.reactivityType=t.type||o.userData.reactivityType||"flora",typeof o.userData.reactivityId>"u"&&(o.userData.reactivityId=tA++);const e=t.lightPreference||{};return o.userData.minLight=typeof e.min<"u"?e.min:o.userData.minLight??0,o.userData.maxLight=typeof e.max<"u"?e.max:o.userData.maxLight??1,o}function nA(){const o=["lightBeam","mushroomCap","opticTip","lotusRing","flowerStem"];let t=!0;return o.forEach(e=>{Rt[e]||(console.error(`[Foliage] Missing material: ${e}. Using fallback.`),Rt[e]=new ds({color:16711935}),t=!1)}),t}function oA(o){const t=[];function e(i){if(!i)return 0;if(i.index)return i.index.count;let n=0;for(const r in i.attributes)if(Object.prototype.hasOwnProperty.call(i.attributes,r)){const a=i.attributes[r];a&&a.count>n&&(n=a.count)}return n}function s(i){const n=[];let r=i;for(;r;){const a=r.name||r.type||r.uuid;n.unshift(a),r=r.parent}return n.join("/")||i.uuid}if(o.traverse(i=>{if(i.isMesh||i.isPoints){const n=i.geometry;if(n){if(!n.attributes.position){const r=Object.keys(n.attributes||{}).join(", ")||"(none)",a=e(n);if(a>0){const c=new Float32Array(a*3);n.setAttribute("position",new it(c,3))}else try{const c=new S;i.getWorldPosition(c);const l=new Float32Array(3);l[0]=c.x,l[1]=c.y,l[2]=c.z,n.setAttribute("position",new it(l,3));const u=new Float32Array(3);u[0]=0,u[1]=1,u[2]=0,n.setAttribute("normal",new it(u,3)),i.userData._patchedByValidate=!0;const p=i.name||"Unnamed",h=i.userData?.type||"Unknown Type",d=Object.keys(n.attributes||{}).join(", ")||"(none)",g=n.type||n.constructor?.name||"UnknownGeo";let f=i.parent,m=null,x=null,w=0;for(;f&&w<10;){if(f.userData&&f.userData.type){m=f.userData.type,x=f.name||f.userData.type;break}f=f.parent,w++}t.push({name:p,type:h,obj:i,geoType:g,attrKeys:d,path:s(i),patched:!0,ancestorType:m,ancestorName:x,preAttrKeys:r})}catch{const l=i.name||"Unnamed",u=i.userData?.type||"Unknown Type",p=Object.keys(n.attributes||{}).join(", ")||"(none)",h=n.type||n.constructor?.name||"UnknownGeo";t.push({name:l,type:u,obj:i,geoType:h,attrKeys:p,path:s(i),preAttrKeys:r})}}if(!n.attributes.normal){const r=n.attributes.position?n.attributes.position.count:e(n);if(r>0){const a=new Float32Array(r*3);for(let c=0;c<r*3;c+=3)a[c]=0,a[c+1]=1,a[c+2]=0;n.setAttribute("normal",new it(a,3))}}}}}),t.length>0){const i=`[TSL] ${t.length} geometries missing 'position' attribute.`,n=t.slice(0,10).map(l=>`${l.path} -> ${l.name}(${l.type}) [${l.geoType}] attrs: ${l.attrKeys}${l.patched?" (patched)":""}${l.ancestorType?` ancestor:${l.ancestorType}`:""}`),r=t.filter(l=>l.patched).length,a=t.length>10?` + ${t.length-10} more`:"";let c=`${i} Examples: ${n.join("; ")}${a}.`;r>0&&(c+=` Note: ${r} were auto-patched with minimal position/normal data; consider fixing the source constructor.`),console.warn(c)}}const w5=new S,pu=new gt,da=new Xt;function b5(o,t){const e=Vt.Gummy(o,{transmission:.6,thickness:.8,roughness:.2,ior:1.4,subsurfaceStrength:1,subsurfaceColor:o}),s=kr(Ls,at(.5)).mul(5),i=X(8),n=At($e.mul(i).add(s)).pow(4),r=zs.mul(.25),a=X(1).add(n.mul(r));e.positionNode=Lt.mul(a);const c=ot(o),l=ot(16777215),u=de(c,l,n.mul(zs).mul(.5)),p=t.add(n.mul(zs));return e.emissiveNode=u.mul(p),e}function v5(o,t){o.userData&&(o.userData.weatherGlow=Math.min(2,(o.userData.weatherGlow||0)+t))}function _5(o,t,e){const s=o.userData.berryMesh;if(!s||!s.userData.initialTransforms)return;const{positions:i,quaternions:n,scales:r}=s.userData.initialTransforms,a=s.count;let c=1;switch(t){case"sunset":c=1+e*.3;break;case"dusk":c=1.3-e*.1;break;case"deepNight":c=1.2-e*.4;break;case"preDawn":c=.8+e*.2;break;default:c=1}for(let l=0;l<a;l++){const u=i[l*3],p=i[l*3+1],h=i[l*3+2],d=n[l*4],g=n[l*4+1],f=n[l*4+2],m=n[l*4+3],x=r[l];da.position.set(u,p,h),da.quaternion.set(d,g,f,m),da.scale.setScalar(x*c),da.updateMatrix(),s.setMatrixAt(l,da.matrix)}s.instanceMatrix.needsUpdate=!0}let t0=[];const rA=50;let ya=null;function aA(o){ya=new K,ya.name="fallingBerries";const t=new ne(.06,16,16),e=Ct(X(.8));b5(16737792,e);for(let s=0;s<rA;s++){const i=Ct(ot(16737792)),n=b5(16737792,e);n.colorNode=i,n.userData.uColor=i;const r=new V(t,n);r.visible=!1,r.userData.velocity=new S,r.userData.active=!1,r.userData.age=0,ya.add(r),t0.push(r)}o.add(ya)}function cA(o,t=16737792){const e=t0.find(s=>!s.userData.active);e&&(e.position.copy(o),e.material.userData.uColor&&e.material.userData.uColor.value.setHex(t),e.userData.velocity.set((Math.random()-.5)*2,-2-Math.random()*3,(Math.random()-.5)*2),e.userData.active=!0,e.userData.age=0,e.visible=!0,e.scale.setScalar(1))}function lA(o){if(!ya)return;const t=-9.8,e=3;t0.forEach(s=>{if(!s.userData.active)return;s.userData.age+=o,s.userData.velocity.y+=t*o,s.position.x+=s.userData.velocity.x*o,s.position.y+=s.userData.velocity.y*o,s.position.z+=s.userData.velocity.z*o;const i=1-s.userData.age/e;s.scale.setScalar(i),(s.position.y<0||s.userData.age>e)&&(s.userData.active=!1,s.visible=!1)})}function S5(o,t){const e=o.userData.berryMesh;if(!e)return;const s=e.count;for(let i=0;i<s;i++)Math.random()<t*.02&&(e.getMatrixAt(i,pu),pu.premultiply(o.matrixWorld),w5.setFromMatrixPosition(pu),cA(w5,o.userData.berryColor||16737792))}function uA(o,t=1){if(!t0)return 0;let e=0;const s=t*t;return t0.forEach(i=>{if(!i.userData.active)return;i.position.distanceToSquared(o)<s&&(i.userData.active=!1,i.visible=!1,e++)}),e}const Cd=Ct(ot(8308963)),Fd=Ct(ot(16762323)),Tp=Ct(ot(16770508)),Rd=Ct(.3),yh=Ct(0);function pA(){const o=new ne(1e3,32,24),t=X(40),e=X(.6),s=Ls.add(t).normalize().y,i=s.max(0).pow(e),r=Pt(0,.15,s).mul(Pt(.4,.15,s)).mul(Rd),a=de(Tp,Fd,Pt(0,.3,i)),c=de(a,Cd,Pt(.2,1,i)),u=de(c,Tp,r).mul(X(1).sub(yh)),p=new Ol;return p.colorNode=u,p.side=ls,new V(o,p)}let Pc=[];const ga=new Xt,hu=1e3;function hA(o,t=5e3){Pc=[];const e=.8,s=new Un(.05,e,.05);s.translate(0,e/2,0),s.computeVertexNormals();const i=new ds({color:8190976,roughness:.8,metalness:0}),n=Ge.mul(_p.max(.5)),r=X(.1),a=Ls.x.mul(r).add(Ls.z.mul(r)).add(n),c=At(a).mul(Lt.y).mul(.3),l=Ge.mul(15).add(Ls.x.mul(.5)).add(Ls.z.mul(.5)),u=At(l).mul(Bn).mul(.15).mul(Lt.y),p=c.add(u),h=p.mul(Sp.x),d=p.mul(Sp.z),g=zs.mul(.2),f=X(1).sub(g),m=Lt.y.mul(f),x=g.mul(.5).mul(Lt.y),w=Lt.x.add(h).add(y5(Lt.x).mul(x)),b=Lt.z.add(d).add(y5(Lt.z).mul(x));i.positionNode=at(w,m,b);const v=at(0,0,1),T=fh(0,kr(XM,v)),M=X(1).sub(T).pow(3).mul(.6),F=ot(8190976),N=ot(11206570),A=Lt.y.div(X(e)),E=yh.mul(Bn).mul(A).mul(2),U=ot(65450),$=F.add(N.mul(M));i.colorNode=$,i.emissiveNode=U.mul(E);const Z=Math.ceil(t/hu);for(let j=0;j<Z;j++){const ut=Math.min(hu,t-j*hu),nt=new D4(s,i,ut);nt.instanceMatrix.setUsage(vn),nt.count=0,nt.receiveShadow=!0,o.add(nt),Pc.push(nt)}return Pc}function dA(o,t,e){const s=Pc.find(r=>r.count<r.instanceMatrix.count);if(!s)return;const i=s.count;ga.position.set(o,t,e),ga.rotation.y=Math.random()*Math.PI;const n=.8+Math.random()*.4;ga.scale.set(n,n,n),ga.updateMatrix(),s.setMatrixAt(i,ga.matrix),s.count++,s.instanceMatrix.needsUpdate=!0}const hc=[{note:"C",color:16728128,name:"C Red"},{note:"C#",color:15667840,name:"C# Magenta"},{note:"D",color:12591296,name:"D Magenta"},{note:"D#",color:8397039,name:"D# Violet"},{note:"E",color:4210943,name:"E Blue"},{note:"F",color:1212655,name:"F Azure"},{note:"F#",color:49344,name:"F# Cyan"},{note:"G",color:1240960,name:"G Spring"},{note:"G#",color:4259648,name:"G# Green"},{note:"A",color:8449810,name:"A Lime"},{note:"A#",color:12632064,name:"A# Yellow"},{note:"B",color:15695890,name:"B Orange"}];function An(o={}){const{size:t="regular",scale:e=1,colorIndex:s=-1,hasFace:i=!1,isBouncy:n=!1,note:r=null,noteIndex:a=-1}=o,c=new K,l=t==="giant",u=l||i;let p=null,h=null,d=-1;if(a>=0&&a<hc.length)d=a,p=hc[a],h=p.color;else if(r){const xt=hc.find(ts=>ts.note===r);xt&&(p=xt,h=xt.color,d=hc.indexOf(xt))}const g=d>=0?d/11:Math.random(),f=l?8*e:1*e,m=.8+g*.6,x=1.2-g*.4,w=(1+Math.random()*.3)*f*m,b=(.15+Math.random()*.05)*f*x,v=b*(2.5+Math.random()*.5)*(l?1:1.2)*x,T=new V(ft.unitCylinder,Rt.mushroomStem);T.scale.set(b,w,b),T.castShadow=!0,T.receiveShadow=!0,c.add(T);let M,F;h!==null?(M=(Rt.mushroomCap[0]||Rt.mushroomStem).clone(),M.color.setHex(h),M.roughness=.7,F=d):s>=0&&s<Rt.mushroomCap.length?(F=s,M=Rt.mushroomCap[F]):(F=Math.floor(Math.random()*Rt.mushroomCap.length),M=Rt.mushroomCap[F]);const N=M.clone();N.userData.baseEmissive=new W(0),h!==null&&(N.userData.noteColor=new W(h));const A=Lt,E=Ge.mul(l?2:3),U=X(l?.05:.02),$=At(E),Z=zs.mul(.15),j=X(1).add($.mul(U)).sub(Z),ut=X(1).sub($.mul(U).mul(.5)).add(Z.mul(.5)),nt=at(A.x.mul(ut),A.y.mul(j),A.z.mul(ut));N.positionNode=nt;const Ue=Ct(N.emissive),_e=X(.4).add(Bn.mul(.5)),It=_0(ot(16777215),_e,X(3));let se=Ue.add(It);if(l){const oi=At(nt.y.mul(10).sub(Ge.mul(2))).add(1).mul(.5).pow(2),Gs=At(E.mul(2)).mul(.1).add(.2),es=ot(N.color).mul(.5);se=se.add(es.mul(oi.mul(.5).add(Gs)))}N.emissiveNode=se;const _t=new V(ft.mushroomCap,N);_t.scale.setScalar(v),_t.position.y=w-v*.2,_t.castShadow=!0,_t.receiveShadow=!0,c.add(_t);const kt=Rt.mushroomGills,Bt=new V(ft.mushroomGillCenter,kt);Bt.scale.set(v*.9,v*.4,v*.9),Bt.position.y=w-v*.2,Bt.rotation.x=Math.PI,c.add(Bt);const Ae=d>=0?3+d%5:3+Math.floor(Math.random()*5),Se=v*.15,Qe=Rt.mushroomSpots;let Gn=Qe;if(h!==null){Gn=Qe.clone();const xt=new W(h);Gn.color.copy(new W(16777215).lerp(xt,.4))}for(let xt=0;xt<Ae;xt++){const ts=Math.random(),Vs=Math.random()*.5,oi=2*Math.PI*ts,Gs=Math.acos(1-Vs),es=Math.sin(Gs)*Math.cos(oi)*v,Yr=Math.cos(Gs)*v,Ql=Math.sin(Gs)*Math.sin(oi)*v,Xr=h!==null&&xt%2===0,On=new V(ft.unitSphere,Xr?Gn:Qe);On.position.set(es,Yr+w-v*.2,Ql),On.scale.set(Se,Se*.2,Se),On.lookAt(0,w+v,0),c.add(On)}if(u){const xt=new K;xt.position.set(0,w*.6,b*.85);const ts=l?f:f*.6;xt.scale.set(ts,ts,ts);const Vs=new V(x5,Rt.eye);Vs.position.set(-.15,.1,.1);const oi=new V(x5,Rt.eye);oi.position.set(.15,.1,.1);const Gs=new ne(.06,8,8),es=new V(Gs,Rt.pupil);es.position.set(0,0,.1),Vs.add(es);const Yr=new V(Gs,Rt.pupil);Yr.position.set(0,0,.1),oi.add(Yr);const Ql=new Qi(.12,.04,6,12,Math.PI),Xr=new V(Ql,Rt.clayMouth);Xr.rotation.z=Math.PI,Xr.position.set(0,-.05,.1);const On=new ne(.08,8,8),t1=new V(On,Rt.mushroomCheek);t1.position.set(-.25,0,.05),t1.scale.set(1,.6,.5);const e1=new V(On,Rt.mushroomCheek);e1.position.set(.25,0,.05),e1.scale.set(1,.6,.5),xt.add(Vs,oi,Xr,t1,e1),c.add(xt)}if(c.userData.animationType=Hr(["wobble","bounce","accordion"]),c.userData.animationOffset=Math.random()*10,c.userData.type="mushroom",c.userData.colorIndex=typeof F=="number"?F:-1,p&&(c.userData.musicalNote=p.note,c.userData.noteColor=h,c.userData.noteIndex=d),p!==null||o.isBioluminescent){const xt=h!==null?new W(h):N&&N.color?N.color:new W(65416),ts=new zn(xt,0,4);ts.position.set(0,w*.5,0),c.add(ts),c.userData.glowLight=ts,Bt&&Bt.material&&(Bt.material=Bt.material.clone(),Bt.material.emissive=xt.clone().multiplyScalar(.3),Bt.material.emissiveIntensity=.3),c.userData.isBioluminescent=!0}return c.userData.size=t,c.userData.capRadius=v,c.userData.capHeight=w,c.userData.stemRadius=b,c.userData.reactiveMeshes=[_t],(l||n)&&(c.userData.isTrampoline=!0),Wt(c,{type:"flora"}),c.reactToNote=(xt,ts,Vs)=>{if(c.userData.musicalNote){let es=xt;if(typeof xt=="string"?es=xt.replace(/[0-9-]/g,""):typeof xt=="number"&&(es=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][xt%12]),es!==c.userData.musicalNote)return}if(c.userData.noteColor?Nr.setHex(c.userData.noteColor):Nr.setHex(ts),_t.userData.flashColor||(_t.userData.flashColor=new W),_t.userData.flashColor.copy(Nr),_t.userData.flashIntensity=1.5+Vs*2.5,_t.userData.flashDecay=.15,c.userData.glowLight){const es=c.userData.glowLight;es.intensity=2+Vs*3,es.userData.baseIntensity||(es.userData.baseIntensity=.8)}const oi=1-Vs*.3,Gs=1+Vs*.3;c.scale.set(f*Gs,f*oi,f*Gs),c.userData.scaleTarget=f,c.userData.scaleAnimTime=.08,c.userData.scaleAnimStart=Date.now()},c}function gA(o,t){if(!t||!t.parent)return null;const e=t.position.clone(),s=t.rotation.clone(),i=t.userData.colorIndex,n=t.userData.noteIndex,r=t.userData.musicalNote,a=t.userData.noteColor;t.parent.remove(t);const c=An({size:"giant",scale:1,colorIndex:i,noteIndex:n,hasFace:!0,isBouncy:!0});r&&(c.userData.musicalNote=r),a&&(c.userData.noteColor=a),c.position.copy(e),c.rotation.copy(s),o.add(c),c.scale.set(.1,.1,.1);const l=1;return c.userData.popTime=0,c.userData.onBeforeRender=(u,p,h,d,g,f)=>{if(c.userData.popTime<1){c.userData.popTime+=.04;const m=Math.min(1,c.userData.popTime),x=l*(1+.5*Math.sin(m*18)*(1-m));c.scale.setScalar(Math.max(.1,x))}},c}function xh(o={}){const{color:t=null,shape:e="simple"}=o,s=new K,i=.6+Math.random()*.4,n=new V(ft.unitCylinder,Rt.flowerStem);n.scale.set(.05,i,.05),n.castShadow=!0,s.add(n);const r=new K;r.position.y=i,s.add(r);const a=new V(ft.unitSphere,Rt.flowerCenter);a.scale.setScalar(.1),a.name="flowerCenter",r.add(a);const c=3,l=Ut(16776960);for(let p=0;p<c;p++){const h=new V(ft.unitCylinder,l);h.position.y=.075,h.scale.set(.01,.15,.01),h.rotation.z=(Math.random()-.5)*1,h.rotation.x=(Math.random()-.5)*1,r.add(h)}let u;if(t?(u=Ut(t),te(u)):u=Rt.flowerPetal[Math.floor(Math.random()*Rt.flowerPetal.length)],e==="simple"){const p=5+Math.floor(Math.random()*2),h=new Dr(.15,0);h.scale(1,.5,1);for(let d=0;d<p;d++){const g=d/p*Math.PI*2,f=new V(h,u);f.position.set(Math.cos(g)*.18,0,Math.sin(g)*.18),f.rotation.z=Math.PI/4,r.add(f)}}else if(e==="multi"){const p=8+Math.floor(Math.random()*4);for(let h=0;h<p;h++){const d=h/p*Math.PI*2,g=new V(ft.unitSphere,u);g.scale.setScalar(.12),g.position.set(Math.cos(d)*.2,Math.sin(h*.5)*.1,Math.sin(d)*.2),r.add(g)}}else if(e==="spiral")for(let h=0;h<10;h++){const d=h/10*Math.PI*4,g=.05+h/10*.15,f=new V(ft.unitCone,u);f.scale.set(.1,.2,.1),f.position.set(Math.cos(d)*g,h/10*.1,Math.sin(d)*g),f.rotation.z=d,r.add(f)}else if(e==="layered")for(let p=0;p<2;p++){const d=new Dr(.12,0);d.scale(1,.5,1);const g=p===0?u:Ut(t?t+1118481:16766720);p!==0&&te(g);for(let f=0;f<5;f++){const m=f/5*Math.PI*2+p*Math.PI/5,x=new V(d,g);x.position.set(Math.cos(m)*(.15+p*.05),p*.05,Math.sin(m)*(.15+p*.05)),x.rotation.z=Math.PI/4,r.add(x)}}if(Math.random()>.5){const p=new V(ft.unitCone,Rt.lightBeam.clone());p.scale.set(.1,1,.1),p.position.y=i,p.userData.isBeam=!0,s.add(p)}return s.userData.animationOffset=Math.random()*10,s.userData.animationType=Hr(["sway","wobble","accordion"]),s.userData.type="flower",s.userData.isFlower=!0,e==="sunflower"||e==="multi"?Wt(s,{}):Wt(s,{})}function Ed(o={}){const{color:t=16766720,intensity:e=1.5}=o,s=new K,i=.6+Math.random()*.4,n=new V(ft.unitCylinder,Rt.flowerStem);n.scale.set(.05,i,.05),n.castShadow=!0,s.add(n);const r=Bo({color:t,emissive:t,emissiveIntensity:e,roughness:.8});te(r);const a=new V(ft.unitSphere,r);a.scale.setScalar(.2),a.position.y=i,s.add(a);const c=new V(ft.unitSphere,Rt.lightBeam);c.scale.setScalar(1.5),c.position.y=i,c.userData.isWash=!0,s.add(c);const l=new zn(t,.5,3);return l.position.y=i,s.add(l),s.userData.animationType="glowPulse",s.userData.animationOffset=Math.random()*10,s.userData.type="flower",Wt(s,{})}function fA(o={}){const{color:t=16740039}=o,e=new K,s=.7+Math.random()*.4,i=new V(ft.unitCylinder,Ut(2263842));i.scale.set(.04,s,.04),i.castShadow=!0,e.add(i);const n=new V(ft.unitSphere,Rt.flowerCenter);n.scale.setScalar(.09),n.position.y=s,e.add(n);const r=Ut(t);te(r);const a=6+Math.floor(Math.random()*3);for(let u=0;u<a;u++){const p=new V(ft.unitCone,r);p.scale.set(.09,.2,.09);const h=u/a*Math.PI*2;p.position.set(Math.cos(h)*.16,s,Math.sin(h)*.16),p.rotation.x=Math.PI*.5,p.rotation.z=h,e.add(p)}const c=Rt.lightBeam.clone();c.colorNode=ot(t);const l=new V(ft.unitCone,c);return l.position.y=s,l.scale.set(.02,4,.02),l.userData.isBeam=!0,e.add(l),e.userData.animationType="spin",e.userData.animationOffset=Math.random()*10,e.userData.type="starflower",Wt(e,{})}function mA(o={}){const t=new K,e=Ut(6111287),s=1+Math.random()*.5,i=new V(ft.unitCylinder,e);i.scale.set(.15,s,.15),i.castShadow=!0,t.add(i);const n=3+Math.floor(Math.random()*3),r=[16711765,16755200,52479,16711935,65416];for(let a=0;a<n;a++){const c=new K;c.position.y=s*.8,c.rotation.y=a/n*Math.PI*2,c.rotation.z=Math.PI/4;const l=.8+Math.random()*.5,u=new V(ft.unitCylinder,e);u.scale.set(.08,l,.08),c.add(u);const p=new K;p.position.y=l;const h=r[Math.floor(Math.random()*r.length)],d=Bo({color:h,roughness:.7,emissive:0,emissiveIntensity:0});te(d);const g=new s2(.25,.08,64,8,2,3),f=new V(g,d);f.scale.set(1,.6,1),p.add(f);const m=new V(ft.unitSphere,d);m.scale.setScalar(.15),m.position.y=.05,p.add(m);const x=Rt.lightBeam.clone();x.colorNode=ot(h);const w=new V(ft.unitSphere,x);w.scale.setScalar(1.2),w.userData.isWash=!0,p.add(w),c.add(p),t.add(c)}return t.userData.animationType=Hr(["sway","wobble"]),t.userData.animationOffset=Math.random()*10,t.userData.type="flower",Wt(t,{})}function yA(o={}){const{color:t=9055202,intensity:e=1}=o,s=new K,i=.5+Math.random()*.3,n=new V(ft.unitCylinder,Ut(2263842));n.scale.set(.03,i,.03),n.castShadow=!0,s.add(n);const r=new K;r.position.y=i,s.add(r);const a=Bo({color:t,emissive:t,emissiveIntensity:.8*e,roughness:.3});te(a);const c=new V(ft.unitSphere,a);c.scale.setScalar(.08),r.add(c);const l=5,u=new _l(.15,8),p=La({color:t,emissive:t,emissiveIntensity:.4*e,roughness:.4,opacity:.7,side:Kt});te(p);for(let d=0;d<l;d++){const g=new V(u,p),f=d/l*Math.PI*2;g.position.set(Math.cos(f)*.12,0,Math.sin(f)*.12),g.rotation.x=-Math.PI/2+Math.random()*.3,g.rotation.z=f,g.userData.vibratoPhase=Math.random()*Math.PI*2,r.add(g)}const h=new zn(t,.3*e,2);return h.position.y=0,r.add(h),s.userData.animationType="vibratoShake",s.userData.animationOffset=Math.random()*10,s.userData.type="vibratoViolet",s.userData.headGroup=r,Wt(s,{})}function Dd(o={}){const{color:t=16737095,size:e=1}=o,s=new K,i=(.8+Math.random()*.4)*e,n=new V(ft.unitCylinder,Ut(2263842));n.scale.set(.04*e,i,.04*e),n.castShadow=!0,s.add(n);const r=new K;r.position.y=i,s.add(r);const a=new Re(.2*e,.05*e,.25*e,12,1,!0);a.translate(0,-.125*e,0);const c=La({color:t,emissive:t,emissiveIntensity:.3,roughness:.5,opacity:.9,side:Kt});te(c);const l=new V(a,c);l.rotation.x=Math.PI,r.add(l);const u=La({color:16777215,opacity:.5,blending:Jt,depthWrite:!1}),p=new V(ft.unitSphere,u);p.scale.setScalar(.08*e),p.position.y=-.1*e,r.add(p),s.userData.vortex=p;const h=new Qi(.2*e,.02,8,16),d=La({color:t,opacity:.6,blending:Jt}),g=new V(h,d);return g.rotation.x=Math.PI/2,g.position.y=-.02*e,r.add(g),s.userData.animationType="tremeloPulse",s.userData.animationOffset=Math.random()*10,s.userData.type="tremoloTulip",s.userData.headGroup=r,s.userData.bellMaterial=c,Wt(s,{})}function xA(o={}){const{color:t=16753920,height:e=2.5}=o,s=new K,i=Ut(3100495),n=new V(ft.unitCylinder,i);n.scale.set(.1,e,.1),n.position.y=e*.5,n.castShadow=!0,s.add(n);const r=new K;r.position.set(0,e,0);const a=new Qi(.5,.08,6,8,Math.PI),c=new V(a,i);c.rotation.z=-Math.PI/2,c.position.set(.5,0,0),r.add(c),s.add(r);const l=new K;l.position.set(1,e-.2,0),s.add(l);const u=new Rn(.2,.2,6),p=new V(u,i);l.add(p);const h=Bo({color:16777215,emissive:t,emissiveIntensity:2,roughness:.2});te(h);const d=new V(ft.unitSphere,h);d.scale.set(.25,.4,.25),d.position.y=-.3,l.add(d);const g=new zn(t,1,8);g.position.y=-.5,g.castShadow=!0,l.add(g),s.userData.animationType="sway",s.userData.animationOffset=Math.random()*10,s.userData.type="lanternFlower";const f=Wt(s,{});return f.reactToNote=(m,x,w)=>{h.emissiveIntensity=2+w*3,g.intensity=1+w*2},f}function wA(o={}){const{color:t=65280}=o,e=new G4;e.moveTo(0,0),e.quadraticCurveTo(.1,.1,0,.2),e.quadraticCurveTo(-.1,.1,0,0);const s=new e2(e),i=Ut(t),n=new V(s,i);return n.castShadow=!0,n}function bA(o={}){const{color:t=13607167,strands:e=4}=o,s=new K,i=Ut(t);te(i);for(let n=0;n<e;n++){const r=new K,a=3+Math.floor(Math.random()*3);for(let c=0;c<a;c++){const l=new V(ft.cylinderLow,Ut(3050327));if(l.scale.set(.03,.4,.03),l.position.y=-c*.35,l.rotation.z=Math.sin(c*.5)*.15,r.add(l),c>0&&Math.random()>.6){const u=new V(ft.sphereLow,i);u.scale.setScalar(.05),u.position.y=l.position.y-.1,u.position.x=(Math.random()-.5)*.06,u.position.z=(Math.random()-.5)*.06,r.add(u)}}r.position.x=(Math.random()-.5)*.6,r.position.y=0,s.add(r)}return s.userData.animationType=Hr(["vineSway","spiralWave"]),s.userData.animationOffset=Math.random()*10,s.userData.type="vine",s}function Bd(o={}){const{color:t=9055202}=o,e=new K,s=2.5+Math.random(),i=new V(ft.cylinder,Ut(6111287));i.scale.set(.5,s,.5),i.position.y=s/2,i.castShadow=!0,e.add(i);const n=4+Math.floor(Math.random()*2),r=Ut(t);te(r);for(let a=0;a<n;a++){const c=new K;c.position.y=s*.9,c.rotation.y=a/n*Math.PI*2;const l=1.5+Math.random(),u=new o0(.2,l,8,16),p=new V(u,r);p.position.set(.5,-l/2,0),p.rotation.z=-Math.PI/6,c.add(p),e.add(c)}return e.userData.animationType="gentleSway",e.userData.animationOffset=Math.random()*10,e.userData.type="tree",Wt(e)}function Pd(o={}){const{color:t=64154}=o,e=new K;class s extends ii{constructor(h=1){super(),this.scale=h}getPoint(h,d=new S){const g=Math.cos(h*Math.PI*4)*.2*h*this.scale,f=h*2*this.scale,m=Math.sin(h*Math.PI*4)*.2*h*this.scale;return d.set(g,f,m)}}const i=new s(1+Math.random()*.5),n=new Tl(i,20,.08,8,!1),r=Ut(t);te(r);const a=new V(n,r);a.castShadow=!0,e.add(a);const c=new xi({color:16777215,emissive:16775885,emissiveIntensity:.5,roughness:.5});te(c);const l=new V(ft.sphereLow,c);l.scale.setScalar(.15);const u=i.getPoint(1);return l.position.copy(u),e.add(l),e.userData.animationType=Hr(["spring","wobble"]),e.userData.animationOffset=Math.random()*10,e.userData.type="shrub",Wt(e)}function Id(o={}){const{color:t=16729344}=o,e=new K,s=5+Math.floor(Math.random()*5),i=Ut(t);te(i);for(let n=0;n<s;n++){const r=.3+Math.random()*.4,a=new V(ft.sphere,i);a.scale.setScalar(r),a.position.set((Math.random()-.5)*.8,r+Math.random()*.8,(Math.random()-.5)*.8),a.castShadow=!0,e.add(a)}return e.userData.animationType=Hr(["bounce","accordion","hop"]),e.userData.animationOffset=Math.random()*10,e.userData.type="shrub",Wt(e)}function vA(o={}){const{color:t=16766720}=o,e=new K,s=3,i=10,n=new K,r=new Qi(.3,.15,8,16),a=Ut(9127187);for(let h=0;h<i;h++){const d=new V(r,a);d.rotation.x=Math.PI/2,d.position.y=h*(s/i),h%2===0&&(d.material=Ut(10506797)),n.add(d)}e.add(n);const c=6,l=new Re(.05,.1,1.5,8);l.translate(0,.75,0);const u=Ut(t);te(u);const p=new K;p.position.y=s,n.add(p);for(let h=0;h<c;h++){const d=new V(l,u);d.rotation.z=Math.PI/3,d.rotation.y=h/c*Math.PI*2,p.add(d)}return e.userData.animationType="accordionStretch",e.userData.animationOffset=Math.random()*10,e.userData.type="tree",e.userData.trunk=n,e}function _A(o={}){const{color:t=16777215}=o,e=new K,s=2.5+Math.random(),i=new V(ft.cylinder,Ut(2236962));i.scale.set(.3,s,.3),i.position.y=s/2,i.castShadow=!0,e.add(i);const n=8,r=Rt.opticCable,a=Rt.opticTip.clone();te(a);for(let c=0;c<n;c++){const l=new K;l.position.y=s*.9,l.rotation.y=c/n*Math.PI*2;const u=1.5+Math.random(),p=new K;p.rotation.z=Math.PI/4;const h=new V(ft.cylinderLow,r);h.scale.set(.02,u,.02),h.position.set(0,-u/2,0),p.add(h);const d=new V(ft.sphereLow,a);d.scale.setScalar(.08),d.position.set(0,-u,0),p.add(d),l.add(p),e.add(l)}return e.userData.animationType="fiberWhip",e.userData.animationOffset=Math.random()*10,e.userData.type="willow",Wt(e)}const T5=new S,du=new S;class SA{constructor(t,e=8){this.vine=t,this.anchorPoint=t.position.clone(),this.length=e,this.isPlayerAttached=!1,this.swingAngle=0,this.swingAngularVel=0,this.swingPlane=new S(1,0,0),this.rotationAxis=new S(0,0,1),this.defaultDown=new S(0,-1,0)}update(t,e,s){const n=-20/this.length*Math.sin(this.swingAngle);this.swingAngularVel+=n*e,this.swingAngularVel*=.99,this.isPlayerAttached&&s&&(s.forward?Math.abs(this.swingAngularVel)>.1?this.swingAngularVel+=Math.sign(this.swingAngularVel)*3*e:this.swingAngularVel+=3*e:s.backward&&(this.swingAngularVel-=Math.sign(this.swingAngularVel)*3*e)),this.swingAngle+=this.swingAngularVel*e;const r=Math.PI*.45;this.swingAngle>r?(this.swingAngle=r,this.swingAngularVel*=-.5):this.swingAngle<-r&&(this.swingAngle=-r,this.swingAngularVel*=-.5);const a=-Math.cos(this.swingAngle)*this.length,c=Math.sin(this.swingAngle)*this.length,l=T5.copy(this.anchorPoint);l.y+=a,l.addScaledVector(this.swingPlane,c),this.isPlayerAttached&&t.position.copy(l);const u=du.subVectors(l,this.anchorPoint).normalize();this.vine.quaternion.setFromUnitVectors(this.defaultDown,u)}attach(t,e){this.isPlayerAttached=!0;const s=T5.set(e.x,0,e.z);if(s.lengthSq()>1)this.swingPlane.copy(s.normalize());else{const h=du.subVectors(t.position,this.anchorPoint);h.y=0,h.lengthSq()>.1&&this.swingPlane.copy(h.normalize())}const i=du.subVectors(t.position,this.anchorPoint),n=i.y,r=i.dot(this.swingPlane);this.swingAngle=Math.atan2(r,-n);const a=Math.cos(this.swingAngle),c=Math.sin(this.swingAngle),l=s.length()*(e.dot(this.swingPlane)>0?1:-1),u=e.y,p=l*a+u*c;this.swingAngularVel=p/this.length}detach(t){this.isPlayerAttached=!1;const e=this.swingAngularVel*this.length,s=Math.cos(this.swingAngle),i=Math.sin(this.swingAngle),n=e*s,r=e*i;return t.velocity.x=this.swingPlane.x*n,t.velocity.z=this.swingPlane.z*n,t.velocity.y=r,t.velocity.y+=5,Date.now()}}function TA(o={}){const{length:t=12,color:e=3050327}=o,s=new K,i=8,n=t/i;for(let l=0;l<i;l++){const u=Ut(e),p=new K;p.position.y=-l*n;const h=new V(ft.cylinderLow,u);if(h.scale.set(.15,n,.15),h.position.y=-n/2,h.rotation.z=(Math.random()-.5)*.1,h.rotation.x=(Math.random()-.5)*.1,p.add(h),Math.random()>.4){const d=wA({color:3329330});d.position.y=-n*.5,d.position.x=.1,d.rotation.z=Math.PI/4,p.add(d)}s.add(p)}const r=new Re(.5,.5,t,8);r.translate(0,-t/2,0);const a=new gi({color:16776960,wireframe:!0,visible:!1}),c=new V(r,a);return c.userData.isVineHitbox=!0,s.add(c),s.userData.type="vine",s.userData.isSwingable=!0,s.userData.vineLength=t,s}const Ic=Ct(0),xa=Ct(0),wa=Ct(ot(16777215)),MA=new Dr(1,1),AA=new S,tr=new Xt;function NA(){const o=new ds({color:16777215,roughness:1,metalness:0,flatShading:!1}),t=X(1.5),e=X(.15),s=at(0,$e.mul(e),0),i=Lt.mul(t).add(s),n=We(i),r=X(1).add(zs.mul(1.5)),a=X(.15).mul(r);o.positionNode=Lt.add(Nd.mul(n.mul(a)));const c=wa.mul(xa.mul(2)),l=ot(16775399),u=X(.4),p=X(1.5),h=_0(l,u,p),d=Vr(Kl.sub(Ls)),g=jl(kr(po,d)),f=X(1).sub(g).pow(X(2)),m=At(f.mul(10)),x=At(f.mul(10).add(2)),w=At(f.mul(10).add(4)),v=at(m,x,w).mul(.5).add(.5).mul(Ic).mul(f);return o.emissiveNode=c.add(h).add(v),o}const CA=NA();function Ld(o={}){const{scale:t=1,size:e=1}=o,s=t*(typeof e=="number"?e:1);return FA({scale:s})}function FA(o={}){const{scale:t=1,tier:e=1,puffCount:s=12+Math.floor(Math.random()*8)}=o,i=new K;i.userData.type="cloud",i.userData.tier=e,i.userData.isRainCloud=!1;const n=new D4(MA,CA,s);n.castShadow=!0,n.receiveShadow=!0;for(let r=0;r<s;r++){const a=(Math.random()*2.5+.5)*t,c=Math.random()*Math.PI*2,l=Math.acos(2*Math.random()-1),u=a*Math.sin(l)*Math.cos(c),p=a*Math.sin(l)*Math.sin(c);let h=a*Math.cos(l);h*=.6,tr.position.set(u,h,p);const g=1-tr.position.length()/(3.5*t)*.5,f=.5+Math.random()*1,m=Math.max(.2,g*f*t);tr.scale.setScalar(m),tr.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),tr.updateMatrix(),n.setMatrixAt(r,tr.matrix)}return n.computeBoundingSphere(),i.add(n),i.scale.set(1.4,1,1.2),i.userData.originalScale=i.scale.clone(),i.userData.animOffset=Math.random()*100,i.onAnimate=(r,a)=>{const c=a+i.userData.animOffset;i.position.y+=Math.sin(c*.5)*.05*r,i.rotation.y+=Math.cos(c*.1)*.02*r},i.userData.onAnimate=i.onAnimate,i}function RA(o,t,e){if(!o||!t)return;const s=AA.subVectors(t,o.position);if(s.y=0,s.lengthSq()>1){s.normalize(),o.position.addScaledVector(s,4*e);const r=.1;o.rotation.z=-s.x*r,o.rotation.x=s.z*r}else o.rotation.z*=.95,o.rotation.x*=.95,o.position.x+=(t.x-o.position.x)*2*e,o.position.z+=(t.z-o.position.z)*2*e}function EA(o,t,e=3){const s=o.position.x-t.x,i=o.position.z-t.z;return s*s+i*i<e*e}function DA(o,t,e){for(let s=t.length-1;s>=0;s--){const i=t[s];if(i.userData.isFalling){i.userData.velocity.y-=20*o,i.position.addScaledVector(i.userData.velocity,o);const n=e(i.position.x,i.position.z);i.position.y<n-2&&BA(i)}}}function BA(o){o.userData.isFalling=!1,o.position.set((Math.random()-.5)*200,40+Math.random()*20,(Math.random()-.5)*200)}function Ud(o,t,e=5){const s=new K;s.name="Waterfall";const i=o.y-t.y,n=(o.y+t.y)/2,r=new Re(e,e*1.5,i,32,16,!0),a=Vt.SeaJelly(65535,{transmission:.9,thickness:1.2,roughness:.1,ior:1.33,subsurfaceStrength:.5,subsurfaceColor:13434879,animateMoisture:!0,thicknessDistortion:.6,side:Kt}),l=ti().add(al(0,Ge.mul(2).negate())),u=At(l.y.mul(15).add(l.x.mul(5))).mul(.5).add(.5),p=At(l.y.mul(25).sub(l.x.mul(10)).add(Ge)).mul(.5).add(.5),h=u.mul(p),d=Ct(0),g=X(.2),f=de(ot(16711935),ot(65535),ti().y);a.colorNode=de(a.colorNode,f,.5);const m=f.mul(g.add(d)).mul(h.add(.2));a.emissiveNode=m,a.roughnessNode=(a.roughnessNode||X(a.roughness)).add(h.mul(.5));const x=new V(r,a);x.position.set(o.x,n,o.z),x.userData.uPulseIntensity=d,te(a),s.add(x);const w=8,b=new K,v=new ne(e*.15,8,8),T=Vt.Sugar(16777215,{roughness:.4,bumpStrength:.2});for(let M=0;M<w;M++){const F=new V(v,T);F.position.set(o.x+(Math.random()-.5)*e,t.y,o.z+(Math.random()-.5)*e),F.userData={velocity:new S((Math.random()-.5)*2,Math.random()*8+2,(Math.random()-.5)*2),originalY:t.y,originalPos:new S().copy(F.position)},b.add(F)}return s.add(b),s.userData.type="waterfall",s.userData.splashes=b.children,Wt(s,{type:"flora"}),s.reactToNote=(M,F,N)=>{x.userData.uPulseIntensity.value=.5+N*2,N>.5&&s.userData.splashes.forEach(A=>{Math.random()>.5||(A.userData.velocity.y+=N*5,A.userData.velocity.x+=(Math.random()-.5)*N,A.userData.velocity.z+=(Math.random()-.5)*N)})},s.onAnimate=(M,F)=>{x.userData.uPulseIntensity.value>.01&&(x.userData.uPulseIntensity.value=Gt.lerp(x.userData.uPulseIntensity.value,0,M*5)),s.userData.splashes.forEach(N=>{N.position.addScaledVector(N.userData.velocity,M),N.userData.velocity.y-=20*M,N.position.y<N.userData.originalY&&(N.position.y=N.userData.originalY,N.userData.velocity.y=Math.abs(N.userData.velocity.y)*.4,N.userData.velocity.y<1&&(N.position.x=o.x+(Math.random()-.5)*e,N.position.z=o.z+(Math.random()-.5)*e,N.userData.velocity.set((Math.random()-.5)*2,Math.random()*8+2,(Math.random()-.5)*2)))})},s}function PA(o={}){const{color:t=8900331,size:e=.5}=o,s=new ne(e,8,8),i=new xi({color:t,emissive:t,emissiveIntensity:.8});te(i);const n=new V(s,i);n.castShadow=!0,n.userData.animationType="float",n.userData.animationOffset=Math.random()*10,n.userData.type="orb";const r=new zn(t,.5,4);return n.add(r),Wt(n)}function zd(o={}){const{color:t=16729344,maxHeight:e=5}=o,s=new K,i=new r0(.1,.4,8,1);i.rotateX(-Math.PI/2);const n=new xi({color:1706496,roughness:.9,emissive:t,emissiveIntensity:.1}),r=new V(i,n);s.add(r);const a=new Re(.08,.12,.1,8);a.translate(0,-.05,0);const c=new xi({color:t,emissive:t,emissiveIntensity:.8,roughness:.3});te(c);const l=new V(a,c);s.add(l);const u=50,p=new zt,h=new Float32Array(u*3),d=new Float32Array(u*3),g=new Float32Array(u);for(let w=0;w<u;w++)h[w*3]=(Math.random()-.5)*.2,h[w*3+1]=0,h[w*3+2]=(Math.random()-.5)*.2,d[w*3]=0,d[w*3+1]=1,d[w*3+2]=0,g[w]=.5+Math.random()*.5;p.setAttribute("position",new it(h,3)),p.setAttribute("normal",new it(d,3)),p.setAttribute("velocity",new it(g,1));const f=new xo({color:t,size:.15,transparent:!0,opacity:.8,blending:Jt,depthWrite:!1}),m=new Zi(p,f);m.visible=!1,s.add(m);const x=new zn(t,0,5);return x.position.y=1,s.add(x),s.userData.animationType="geyserErupt",s.userData.animationOffset=Math.random()*10,s.userData.type="geyser",s.userData.plume=m,s.userData.plumeLight=x,s.userData.coreMaterial=c,s.userData.maxHeight=e,s.userData.eruptionStrength=0,Wt(s)}function IA(o=80,t=100){const e=new zt,s=new Float32Array(o*3),i=new Float32Array(o*3),n=new Float32Array(o),r=new Float32Array(o);for(let b=0;b<o;b++)s[b*3]=(Math.random()-.5)*t,s[b*3+1]=.5+Math.random()*4,s[b*3+2]=(Math.random()-.5)*t,i[b*3]=0,i[b*3+1]=1,i[b*3+2]=0,n[b]=Math.random()*Math.PI*2,r[b]=.5+Math.random()*1.5;e.setAttribute("position",new it(s,3)),e.setAttribute("normal",new it(i,3)),e.setAttribute("phase",new it(n,1)),e.setAttribute("speed",new it(r,1));const a=new w0({size:.2,transparent:!0,depthWrite:!1,blending:Jt}),c=Bs("phase"),l=Bs("speed"),u=At($e.mul(.3).add(c)).mul(4),p=zr($e.mul(.5).add(c.mul(1.3))).mul(1),h=At($e.mul(.4).add(c.mul(.7))).mul(4),d=Lt.add(at(u,p,h)),g=d.y.max(.3).min(6);a.positionNode=at(d.x,g,d.z);const m=At($e.mul(l).add(c)).sub(.7).max(0).mul(3.33),x=de(ot(8978176),ot(16776960),m);a.colorNode=x.mul(m.add(.1)),a.opacityNode=m.add(.05).min(1);const w=new Zi(e,a);return w.userData.isFireflies=!0,w.visible=!1,w}const LA="modulepreload",UA=function(o,t){return new URL(o,t).href},M5={},wr=function(t,e,s){let i=Promise.resolve();if(e&&e.length>0){let l=function(u){return Promise.all(u.map(p=>Promise.resolve(p).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};const r=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),c=a?.nonce||a?.getAttribute("nonce");i=l(e.map(u=>{if(u=UA(u,s),u in M5)return;M5[u]=!0;const p=u.endsWith(".css"),h=p?'[rel="stylesheet"]':"";if(s)for(let g=r.length-1;g>=0;g--){const f=r[g];if(f.href===u&&(!p||f.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${u}"]${h}`))return;const d=document.createElement("link");if(d.rel=p?"stylesheet":LA,p||(d.as="script"),d.crossOrigin="",d.href=u,c&&d.setAttribute("nonce",c),document.head.appendChild(d),p)return new Promise((g,f)=>{d.addEventListener("load",g),d.addEventListener("error",()=>f(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return i.then(r=>{for(const a of r||[])a.status==="rejected"&&n(a.reason);return t().catch(n)})},A5="/candy-world";async function zA(o){const t=`${A5}/${o}`;try{if((await fetch(t,{method:"HEAD"})).ok)return{exists:!0,path:A5}}catch{}const e=`./${o}`;try{if((await fetch(e,{method:"HEAD"})).ok)return{exists:!0,path:""}}catch{}return{exists:!1,path:null}}function kA(){const o=window.NativeWebAssembly||WebAssembly,t=o.instantiate,e=o.instantiateStreaming;function s(i){try{const n=i&&i.instance?i.instance:i,r=n&&n.exports;if(!r)return i;Object.keys(r).forEach(a=>{if(a&&a.startsWith("_")){const c=a.slice(1);if(!(c in r))try{r[c]=r[a]}catch{}}})}catch(n){console.warn("[WASM Utils] Failed to alias exports",n)}return i}return typeof o.instantiate=="function"&&(o.instantiate=async function(...i){const n=await t.apply(this,i);return s(n)}),typeof o.instantiateStreaming=="function"&&(o.instantiateStreaming=async function(...i){const n=await e.apply(this,i);return s(n)}),function(){try{o.instantiate=t}catch{}try{o.instantiateStreaming=e}catch{}}}function wh(o,t="",e=4e3){const s=document.getElementById("now-playing-toast"),i=document.getElementById("now-playing-text");if(s&&i){const n=s.querySelector(".icon");i.innerText=o,n&&(n.innerText=t),s.classList.add("visible"),s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(()=>{s.classList.remove("visible")},e)}}const dc=Object.freeze(Object.defineProperty({__proto__:null,showToast:wh},Symbol.toStringTag,{value:"Module"}));let Ht=null,gc=null,Zs=null,lr=null,io=null,Ve=null,Mp=null,Ap=null,VA=null,Np=null,GA=null,Cp=null,ur=null,Fp=null,ki=null,N5=null;const OA=0,WA=4096,$A=8192,HA=16384;async function qA(){if(typeof SharedArrayBuffer>"u")return console.warn("[Native] SharedArrayBuffer is missing. Pthreads will NOT work. Using JS fallback."),!1;try{await cl("Loading Native Engine...");const o=await zA("./candy_native.wasm");if(!o.exists)return console.log("[WASM] candy_native.wasm not found. Using JS fallback."),!1;const t=o.path;let e;try{e=(await wr(()=>import(`${t}/candy_native.js?v=${Date.now()}`),[],import.meta.url)).default}catch{return console.log("[WASM] candy_native.js not found. Using JS fallback."),!1}await cl("Spawning Physics Workers...");const s=kA();try{ki=await e({locateFile:(i,n)=>i.endsWith(".wasm")?`${t}/candy_native.wasm`:n+i,print:i=>console.log("[Native]",i),printErr:i=>console.warn("[Native Err]",i)}),console.log("[WASM] Emscripten Pthreads Ready")}finally{s()}return ki.wasmMemory?N5=ki.wasmMemory:ki.HEAP8&&(N5=ki.HEAP8.buffer),!0}catch(o){return console.warn("[WASM] Native module unavailable, using JS fallback:",o),!1}}function Ts(o){return ki&&ki["_"+o]||null}let C5=!1;async function YA(o){if(!(!o||C5))try{const{startBootstrap:t}=await wr(async()=>{const{startBootstrap:e}=await import("./bootstrap-loader-BwEUJlid.js");return{startBootstrap:e}},[],import.meta.url);t&&t(o)&&(C5=!0,console.log("[WASM] Bootstrap terrain pre-computation started"))}catch(t){console.warn("[WASM] Bootstrap loader error:",t)}}async function cl(o){window.setLoadingStatus&&window.setLoadingStatus(o);const t=document.getElementById("startButton");t&&(t.textContent=o),console.log("[WASM Progress]",o),await new Promise(e=>setTimeout(e,20))}async function XA(){if(Ht)return!0;const o=document.getElementById("startButton");o&&(o.disabled=!0,o.style.cursor="wait"),console.log("[WASM] initWasm started"),await cl("Downloading Physics Engine...");try{const t="./candy_physics.wasm?v="+Date.now(),e=await fetch(t);if(!e.ok)return console.warn("WASM not found, using JS fallbacks"),o&&(o.disabled=!1),!1;const s=await e.arrayBuffer(),i={fd_close:()=>0,fd_seek:()=>0,fd_write:()=>0,fd_read:()=>0,fd_fdstat_get:()=>0,fd_prestat_get:()=>0,fd_prestat_dir_name:()=>0,path_open:()=>0,environ_sizes_get:()=>0,environ_get:()=>0,proc_exit:()=>{},clock_time_get:(c,l,u)=>{const p=BigInt(Date.now())*1000000n;if(gc){const h=typeof u=="bigint"?Number(u):u,d=new BigInt64Array(gc.buffer);h>=0&&h>>3<d.length&&(d[h>>3]=p)}return 0}};await cl("Compiling Physics (WASM)...");const n=window.NativeWebAssembly||WebAssembly,r={env:{abort:(c,l,u,p)=>{console.error(`WASM abort at ${l}:${u}:${p}: ${c}`)},seed:()=>Date.now()*Math.random(),now:()=>Date.now()},wasi_snapshot_preview1:i};let a;try{a=await n.instantiateStreaming(fetch(t),r)}catch{a=await n.instantiate(s,r)}if(window.setLoadingStatus&&window.setLoadingStatus("Physics Engine Ready..."),Ht=a.instance,!Ht.exports.getGroundHeight)return console.error("WASM exports missing getGroundHeight"),o&&(o.disabled=!1),!1;if(Ht.exports.memory){gc=Ht.exports.memory;const c=gc.buffer;Zs=new Float32Array(c,OA,1024),lr=new Float32Array(c,WA,1024),io=new Float32Array(c,$A,1024),Ve=new Float32Array(c,HA,8)}return Mp=Ht.exports.getGroundHeight,Ap=Ht.exports.freqToHue,VA=Ht.exports.lerp,Np=Ht.exports.batchMushroomSpawnCandidates||null,GA=Ht.exports.updateFoliageBatch||null,Cp=Ht.exports.initCollisionSystem||null,ur=Ht.exports.addCollisionObject||null,Fp=Ht.exports.resolveGameCollisions||null,await qA(),ki&&await YA(ki),o&&(o.disabled=!1,o.textContent="Start Exploration ",o.style.cursor="pointer"),!0}catch(t){return console.warn("Failed to load WASM:",t),wh("Physics Engine Failed to Load",""),o&&(o.disabled=!1),!1}}function kd(){return Ht!==null}function pr(){return Ht}function ZA(o,t,e,s){return!Cp||!ur?!1:(Cp(),o&&o.forEach(i=>{if(i.userData.isBlocked){const n=i.userData.gatePosition.clone().applyMatrix4(i.matrixWorld);ur(3,n.x,n.y,n.z,2.5,5,0,0)}}),t&&t.forEach(i=>{i.userData.isTrampoline?ur(4,i.position.x,i.position.y,i.position.z,i.userData.capRadius||2,i.userData.capHeight||3,0,0):ur(1,i.position.x,i.position.y,i.position.z,i.userData.capRadius||2,i.userData.capHeight||3,0,0)}),e&&e.forEach(i=>{i.userData.tier===1&&ur(2,i.position.x,i.position.y,i.position.z,i.scale.x||1,i.scale.y||1,0,0)}),console.log("[WASM] Uploaded collision objects to ASC."),!0)}function jA(o,t){return!Fp||!Ve?!1:(Ve[0]=o.position.x,Ve[1]=o.position.y,Ve[2]=o.position.z,Ve[3]=o.velocity.x,Ve[4]=o.velocity.y,Ve[5]=o.velocity.z,Ve[6]=o.isGrounded?1:0,Fp(t)===1?(o.position.x=Ve[0],o.position.y=Ve[1],o.position.z=Ve[2],o.velocity.x=Ve[3],o.velocity.y=Ve[4],o.velocity.z=Ve[5],o.isGrounded=Ve[6]>.5,!0):!1)}function vo(o,t){return Mp?Mp(o,t):isNaN(o)||isNaN(t)?0:Math.sin(o*.05)*2+Math.cos(t*.05)*2+Math.sin(o*.2)*.3+Math.cos(t*.15)*.3}function KA(o){return Ap?Ap(o):!o||o<50?0:Math.log2(o/55)*.1%1}function JA(o){if(!Zs)return;const t=Math.min(o.length,256);for(let e=0;e<t;e++){const s=o[e],i=e*4;Zs[i]=s.x||0,Zs[i+1]=s.y||0,Zs[i+2]=s.z||0,Zs[i+3]=s.radius||1}}function QA(o){if(!Zs||!lr)return;const t=Math.min(o.length,256);for(let e=0;e<t;e++){const s=o[e],i=e*4;Zs[i]=s.position.x,Zs[i+1]=s.position.y,Zs[i+2]=s.position.z,Zs[i+3]=s.userData?.radius||.5,lr[i]=0,lr[i+1]=0,lr[i+2]=s.position.y,lr[i+3]=s.userData?.colorIndex||0}}function F5(o,t,e,s,i,n,r,a){return Np&&Ht?Np(o,t,e,s,i,n,r,a):0}function tN(o){if(!io)return[];const t=[],e=Math.min(o,128);for(let s=0;s<e;s++){const i=s*4,n=io[i],r=io[i+1],a=io[i+2],c=io[i+3];isNaN(n)||isNaN(r)||isNaN(a)||t.push({x:n,y:r,z:a,colorIndex:Math.round(c)})}return t}function eN(o,t,e,s){return Ht?(Ht.exports.batchAnimationCalc(o,t,e,s),io.slice(0,s*4)):null}let er={targetStep:0,unfurlStep:0};function sN(o,t,e,s,i,n){const r=Ts("calcArpeggioStep_c");if(r){r(o,t,e?1:0,s?1:0,i?1:0,n);const u=Ts("getArpeggioTargetStep_c"),p=Ts("getArpeggioUnfurlStep_c");if(u&&p)return er.targetStep=u(),er.unfurlStep=p(),er}if(Ht&&Ht.exports.calcArpeggioStep)return Ht.exports.calcArpeggioStep(o,t,e?1:0,s?1:0,i?1:0,n),er.targetStep=Ht.exports.getArpeggioTargetStep(),er.unfurlStep=Ht.exports.getArpeggioUnfurlStep(),er;let a=t;s?i&&!e&&(a=Math.min(n,a+1)):a=0;const c=a>o?.3:.05,l=o+(a-o)*c;return{targetStep:a,unfurlStep:l}}function iN(o,t,e,s){if(Ht)return Ht.exports.calcRainDropY(o,t,e,s);const n=t*e%s;return o-n}function nN(o,t,e,s,i,n,r,a){const c=Ts("updatePhysicsCPP");return c?c(o,t,e,s,i?1:0,n?1:0,r?1:0,a):-1}function oN(o,t,e){const s=Ts("initPhysics");s&&s(o,t,e)}function gu(o,t,e,s,i,n,r,a,c){const l=Ts("addObstacle");l&&l(o,t,e,s,i,n,r,a,c?1:0)}function rN(o,t,e,s,i,n){const r=Ts("setPlayerState");r&&r(o,t,e,s,i,n)}function aN(){const o=Ts("getPlayerX")(),t=Ts("getPlayerY")(),e=Ts("getPlayerZ")(),s=Ts("getPlayerVX")(),i=Ts("getPlayerVY")(),n=Ts("getPlayerVZ")();return{x:o,y:t,z:e,vx:s,vy:i,vz:n}}const ei=60,_o=420,Yi=60,ll=180,ul=120,Vd=120,Js=ei+_o+Yi+ll+ul+Vd,Xe={day:{skyTop:new W(8900331),skyBot:new W(12117744),horizon:new W(16770508),fog:new W(16762323),sun:new W(16775920),amb:new W(16774638),sunInt:.9,ambInt:.65,atmosphereIntensity:.3},neon:{skyTop:new W(2228292),skyBot:new W(16711935),horizon:new W(65535),fog:new W(5570730),sun:new W(16711850),amb:new W(4456584),sunInt:.8,ambInt:.7,atmosphereIntensity:.9},glitch:{skyTop:new W(0),skyBot:new W(8947848),horizon:new W(16777215),fog:new W(11184810),sun:new W(16777215),amb:new W(4473924),sunInt:1,ambInt:.5,atmosphereIntensity:0},sunset:{skyTop:new W(4930959),skyBot:new W(16739146),horizon:new W(16757575),fog:new W(15235999),sun:new W(16752704),amb:new W(10178640),sunInt:.55,ambInt:.45,atmosphereIntensity:.7},night:{skyTop:new W(657966),skyBot:new W(1710645),horizon:new W(2763338),fog:new W(657944),sun:new W(3359846),amb:new W(526357),sunInt:.12,ambInt:.08,atmosphereIntensity:.15},sunrise:{skyTop:new W(4774120),skyBot:new W(16751532),horizon:new W(16766115),fog:new W(16770250),sun:new W(16769126),amb:new W(16763096),sunInt:.65,ambInt:.55,atmosphereIntensity:.6}},as={colors:{ground:2236962,fog:1710638},interaction:{maxDistance:60,proximityRadius:12,interactionDistance:8},noteColorMap:{global:{C:16711680,"C#":16744192,D:16776960,"D#":8388352,E:65280,F:65407,"F#":65535,G:32767,"G#":255,A:8323327,"A#":16711935,B:16711807},mushroom:{C:16728128,"C#":15667840,D:12591296,"D#":8397039,E:4210943,F:1212655,"F#":49344,G:1240960,"G#":4259648,A:8449810,"A#":12632064,B:15695890},flower:{C:16738740,"C#":16716947,D:16758465,"D#":16761035,E:14524637,F:15631086,"F#":14315734,G:12211667,"G#":9662683,A:9055202,"A#":9699539,B:10040012},tree:{C:25600,"C#":2263842,D:3329330,"D#":9498256,E:10025880,F:65280,"F#":11403055,G:8388352,"G#":8190976,A:7048739,"A#":5597999,B:8421376},cloud:{C:15792383,"C#":15132410,D:11584734,"D#":11393254,E:8900331,F:8900346,"F#":49151,G:2003199,"G#":6591981,A:4620980,"A#":6266528,B:3100495}},reactivity:{mushroom:{smoothingRate:8,scale:.6,maxAmplitude:1,minThreshold:.02}},flashScale:2};function cN(o,t,e){let s=!1,i=!1;if(e&&e.channelData)for(const l of e.channelData)(l.activeEffect===4||l.activeEffect===0&&l.effectValue&&l.effectValue>0)&&(s=!0),l.trigger>.1&&(i=!0);o.userData.unfurlStep===void 0&&(o.userData.unfurlStep=0),o.userData.targetStep===void 0&&(o.userData.targetStep=0),o.userData.lastTrigger===void 0&&(o.userData.lastTrigger=!1);const n=12,r=sN(o.userData.unfurlStep,o.userData.targetStep,o.userData.lastTrigger,s,i,n);o.userData.targetStep=r.targetStep,o.userData.unfurlStep=r.unfurlStep,o.userData.lastTrigger=i;const a=(o.userData.unfurlStep||0)/n,c=o.userData.fronds;c&&c.forEach((l,u)=>{l.forEach((p,h)=>{const d=Gt.lerp(p.initialCurl,.2,a),g=Math.sin(t*5+h*.5)*.1*a;p.pivot.rotation.x=d+g})}),o.userData.originalY===void 0&&(o.userData.originalY=o.position.y),o.position.y=o.userData.originalY+a*.2}const Pi=4e3,R5=16384,Hs=Pi*4;class br{constructor(){this.initialized=!1,this.batches={sway:this.createBatch(),bounce:this.createBatch(!0),hop:this.createBatch(!0),gentleSway:this.createBatch(),wobble:this.createBatch(!1,!0,!0)}}static getInstance(){return br.instance||(br.instance=new br),br.instance}createBatch(t=!1,e=!1,s=!1){return{count:0,offsets:new Float32Array(Pi),intensities:new Float32Array(Pi),originalYs:t?new Float32Array(Pi):void 0,wobbleBoosts:e?new Float32Array(Pi):void 0,outScalars:new Float32Array(Pi),outScalars2:s?new Float32Array(Pi):void 0,objects:new Array(Pi),ptrOffsets:0,ptrIntensities:0,ptrOriginalYs:0,ptrWobbleBoosts:0,ptrOutScalars:0,ptrOutScalars2:0}}initBatchMemory(t,e){if(t.ptrOffsets!==0||!pr())return;let i=e;t.ptrOffsets=i,i+=Hs,t.ptrIntensities=i,i+=Hs,t.ptrOutScalars=i,i+=Hs,t.originalYs&&(t.ptrOriginalYs=i,i+=Hs),t.wobbleBoosts&&(t.ptrWobbleBoosts=i,i+=Hs),t.outScalars2&&(t.ptrOutScalars2=i,i+=Hs)}init(){const t=pr();if(this.initialized||!t)return;let e=R5;this.initBatchMemory(this.batches.sway,e),e+=Hs*3,this.initBatchMemory(this.batches.bounce,e),e+=Hs*4,this.initBatchMemory(this.batches.hop,e),e+=Hs*4,this.initBatchMemory(this.batches.gentleSway,e),e+=Hs*3,this.initBatchMemory(this.batches.wobble,e),e+=Hs*5,this.initialized=!0,console.log("[FoliageBatcher] WASM memory allocated using fixed offsets for batching"),console.log(`[FoliageBatcher] Total memory used: ${e-R5} bytes`)}queue(t,e,s,i){if(this.initialized||this.init(),!this.initialized)return!1;let n;if(e==="sway"?n=this.batches.sway:e==="bounce"?n=this.batches.bounce:e==="hop"?n=this.batches.hop:e==="gentleSway"?n=this.batches.gentleSway:e==="wobble"&&(n=this.batches.wobble),!n||n.count>=Pi)return!1;const r=n.count;return n.objects[r]=t,n.offsets[r]=t.userData.animationOffset||0,n.intensities[r]=s,n.originalYs&&(t.userData.originalY===void 0&&(t.userData.originalY=t.position.y),n.originalYs[r]=t.userData.originalY),n.wobbleBoosts&&(n.wobbleBoosts[r]=t.userData.wobbleCurrent||0),n.count++,!0}flush(t,e){this.initialized&&(this.processSimpleBatch(this.batches.sway,"computeSway",t,(s,i)=>{s.rotation.z=i}),this.processSimpleBatch(this.batches.gentleSway,"computeGentleSway",t,(s,i)=>{s.rotation.z=i}),this.processPhysicsBatch(this.batches.bounce,"computeBounce",t,e,(s,i)=>{s.position.y=i}),this.processPhysicsBatch(this.batches.hop,"computeHop",t,e,(s,i)=>{s.position.y=i}),this.processWobbleBatch(this.batches.wobble,t))}processSimpleBatch(t,e,s,i){if(t.count===0)return;const n=pr();if(!n)return;const r=new Float32Array(n.exports.memory.buffer),a=t.ptrOffsets>>>2,c=t.ptrIntensities>>>2;r.set(t.offsets.subarray(0,t.count),a),r.set(t.intensities.subarray(0,t.count),c);const l=n.exports[e];if(l){l(t.count,s,t.ptrOffsets,t.ptrIntensities,t.ptrOutScalars);const u=t.ptrOutScalars>>>2,p=r.subarray(u,u+t.count);for(let h=0;h<t.count;h++)i(t.objects[h],p[h]),t.objects[h]=void 0}t.count=0}processPhysicsBatch(t,e,s,i,n){if(t.count===0)return;const r=pr();if(!r)return;const a=new Float32Array(r.exports.memory.buffer),c=t.ptrOffsets>>>2,l=t.ptrIntensities>>>2,u=t.ptrOriginalYs>>>2;a.set(t.offsets.subarray(0,t.count),c),a.set(t.intensities.subarray(0,t.count),l),a.set(t.originalYs.subarray(0,t.count),u);const p=r.exports[e];if(p){p(t.count,s,t.ptrOriginalYs,t.ptrOffsets,t.ptrIntensities,i,t.ptrOutScalars);const h=t.ptrOutScalars>>>2,d=a.subarray(h,h+t.count);for(let g=0;g<t.count;g++)n(t.objects[g],d[g]),t.objects[g]=void 0}t.count=0}processWobbleBatch(t,e){if(t.count===0)return;const s=pr();if(!s)return;const i=new Float32Array(s.exports.memory.buffer),n=t.ptrOffsets>>>2,r=t.ptrIntensities>>>2,a=t.ptrWobbleBoosts>>>2;i.set(t.offsets.subarray(0,t.count),n),i.set(t.intensities.subarray(0,t.count),r),i.set(t.wobbleBoosts.subarray(0,t.count),a);const c=s.exports.computeWobble;if(c){c(t.count,e,t.ptrOffsets,t.ptrIntensities,t.ptrWobbleBoosts,t.ptrOutScalars,t.ptrOutScalars2);const l=t.ptrOutScalars>>>2,u=t.ptrOutScalars2>>>2;for(let p=0;p<t.count;p++){const h=t.objects[p];h.rotation.x=i[l+p],h.rotation.z=i[u+p],h.userData.wobbleCurrent&&(h.userData.wobbleCurrent*=.9),t.objects[p]=void 0}}t.count=0}}const Gd=br.getInstance(),lN=new S(1,1,1),uN=new W(16777215);function fa(o,t){o.forEach(e=>{if(e.userData.initialScale===void 0&&(e.userData.initialScale=e.scale.x),!e.userData.maxScale){const r=e.userData.type==="mushroom"?2.5:1.5;e.userData.maxScale=e.userData.initialScale*r}e.userData.minScale||(e.userData.minScale=e.userData.initialScale*.5);const s=e.scale.x,i=t*.01;let n=s+i;i>0?n>e.userData.maxScale&&(n=e.userData.maxScale):n<e.userData.minScale&&(n=e.userData.minScale),Math.abs(n-s)>1e-4&&e.scale.setScalar(n)})}function pN(o,t){o.forEach(e=>{if(e.userData.type==="flower"&&(e.userData.isFlower||e.userData.type==="flower")&&(e.userData.maxBloom||(e.userData.maxBloom=e.scale.x*1.3),e.scale.x<e.userData.maxBloom)){const s=t*.02;e.scale.addScalar(s)}})}function hN(o,t){if(o.userData.dryRoughness===void 0&&(o.userData.dryRoughness=o.roughness||.5,o.userData.dryMetalness=o.metalness||0,o.color&&(o.userData.dryColor=o.color.clone())),o.roughness!==void 0&&o.userData.dryRoughness!==void 0){const e=Gt.lerp(o.userData.dryRoughness,.2,t);o.roughness=e}if(o.metalness!==void 0&&o.userData.dryMetalness!==void 0){const e=Gt.lerp(o.userData.dryMetalness,.15,t);o.metalness=e}if(o.color&&o.userData.dryColor){const e=o.userData.dryColor.clone().multiplyScalar(1-t*.3);o.color.lerp(e,.1)}}function dN(o,t,e){o.forEach(s=>{if(!s||!s.isMaterial)return;let i=0;t==="rain"?i=e*.5:t==="storm"&&(i=e*.8),hN(s,i)})}function gN(o,t,e=null,s=0){if(o){if(t){const i=o.channelData;i&&i.length>0&&Bc.forEach((n,r)=>{const a=r%4+1,c=i[Math.min(a,i.length-1)];if(c&&c.freq>0){const u=KA(c.freq);Nr.setHSL(u,1,.6),n.isMeshBasicMaterial&&n.color?n.color.lerp(Nr,.3):n.emissive&&n.emissive.lerp(Nr,.3)}const l=.2+(c?.volume||0)+(c?.trigger||0)*2;!n.isMeshBasicMaterial&&n.emissiveIntensity!==void 0&&(n.emissiveIntensity=l)})}else Bc.forEach(i=>{i.emissive&&(i.emissive.setHex(0),i.emissiveIntensity=0)});e&&s>0&&dN(Bc,e,s)}}function fN(o,t,e,s,i=!1){const n=o.userData.animationOffset||0,r=o.userData.animationType,a=o.userData.reactiveMeshes;if(a&&a.length>0){let f=!1,m=!1;for(let x=0;x<a.length;x++){const w=a[x];if((w.userData.flashIntensity||0)>0&&(f=!0),w.userData._needsFadeBack&&(m=!0),f&&m)break}if(f||m)for(let x=0;x<a.length;x++){const w=a[x];let b=w.userData.flashIntensity||0;const v=w.userData.flashDecay??.05,T=Array.isArray(w.material)?w.material:w.material?[w.material]:[];if(b>0){const M=w.userData.flashColor||uN;for(const F of T){if(!F)continue;const N=Math.min(1,b*1.2)*.8;F.isMeshBasicMaterial&&F.color?b>.7?F.color.copy(M):F.color.lerp(M,N):F.emissive&&(b>.7?F.emissive.copy(M):F.emissive.lerp(M,N),F.emissiveIntensity=Math.max(.2,b*as.flashScale))}w.userData.flashIntensity=Math.max(0,b-v),w.userData.flashIntensity===0&&(delete w.userData.flashColor,delete w.userData.flashDecay,w.userData._needsFadeBack=!0)}else if(w.userData._needsFadeBack){const M=as.reactivity?.fadeSpeed??.06,F=as.reactivity?.fadeSnapThreshold??.06,N=F*F;let A=!0;for(const E of T)if(E){if(E.isMeshBasicMaterial)E.userData&&E.userData.baseColor&&E.color&&(E.color.distanceToSquared(E.userData.baseColor)>N?(E.color.lerp(E.userData.baseColor,M),A=!1):E.color.copy(E.userData.baseColor));else if(E.emissive){E.userData&&E.userData.baseEmissive&&E.emissive.lerp(E.userData.baseEmissive,M);const U=E.emissiveIntensity||0;U>F?(E.emissiveIntensity=Gt.lerp(U,0,M),A=!1):(E.userData&&E.userData.baseEmissive&&E.emissive.copy(E.userData.baseEmissive),E.emissiveIntensity=0)}}A&&(w.userData._needsFadeBack=!1)}}}if(o.userData.glowLight&&o.userData.isBioluminescent){const f=o.userData.glowLight,m=f.userData.baseIntensity||.8;if(f.intensity>m*1.2)f.intensity=Gt.lerp(f.intensity,m,.08);else{const x=2+(o.userData.animationOffset||0)*.3,w=Math.sin(t*x)*.2+1;f.intensity=m*w}}if(o.userData.scaleAnimStart){const f=Date.now()-o.userData.scaleAnimStart,m=o.userData.scaleAnimTime||.08,x=Math.min(1,f/(m*1e3));if(x<1){const w=o.userData.scaleTarget||1;o.scale.x=Gt.lerp(o.scale.x,w,x*.5),o.scale.y=Gt.lerp(o.scale.y,w,x*.5),o.scale.z=Gt.lerp(o.scale.z,w,x*.5)}else o.scale.setScalar(o.userData.scaleTarget||1),delete o.userData.scaleAnimStart,delete o.userData.scaleTarget,delete o.userData.scaleAnimTime}if(o.userData.type==="mushroom"){const f=o.userData.noteBuffer||[],m=eA(f),x=as.reactivity?.mushroom||{},w=x.scale||1,b=Math.min(x.maxAmplitude??1,Math.max(x.minThreshold??.01,m*w)),v=o.userData.wobbleCurrent||0,T=Math.min(.25,(x.smoothingRate||8)*.02);o.userData.wobbleCurrent=Gt.lerp(v,b,T)}if(i&&!(o.userData.type==="flower"&&o.userData.animationType==="glowPulse")){const w=Math.sin(t*.5+n)*.02;o.rotation.z=w,o.rotation.x=w*.5;return}let c=0,l=0,u=0,p=0;e&&(c=e.kickTrigger||0,l=e.grooveAmount||0,u=e.beatPhase||0,p=e.channelData?.[2]?.volume||0);const h=!s,d=h?1+l*5:.2,g=t+u;if(!(r&&Gd.queue(o,r,d,g,c))){if(r==="arpeggioUnfurl")cN(o,t,e);else if(r==="snareSnap"){let f=0;e&&e.channelData&&e.channelData[1]&&(f=e.channelData[1].trigger||0);const m=o.userData.leftJaw,x=o.userData.rightJaw;if(m&&x){f>.2?o.userData.snapState=1:o.userData.snapState=Math.max(0,(o.userData.snapState||0)-.1);const w=o.userData.snapState||0;m.rotation.x=Gt.lerp(-.5,0,w),x.rotation.x=Gt.lerp(.5+Math.PI,Math.PI,w)}}else if(r==="accordionStretch"){const f=o.userData.trunk;if(f){const m=1+Math.max(0,Math.sin(g*10+n))*.31*d;f.scale.y=m;const x=1/Math.sqrt(m);f.scale.x=x,f.scale.z=x}}else if(r==="fiberWhip"){o.rotation.y=Math.sin(t*.5+n)*.111;const f=p*2;o.children.forEach((m,x)=>{if(m===o.children[0])return;const w=x*.51,b=m.children[0];let v=Math.PI/4+Math.sin(t*2+w)*.13;if(h){v+=Math.sin(t*10+w)*f;const T=b.children[0];T&&(T.visible=Math.random()<.5+f)}b&&(b.rotation.z=v)})}else if(r==="bounce"){const f=o.userData.originalY??o.position.y;o.userData.originalY=f,o.position.y=f+Math.sin(g*3+n)*.12*d,h&&c>.12&&(o.position.y+=c*.21)}else if(r==="sway")o.rotation.z=Math.sin(t+n)*.11*d;else if(r==="wobble"){const f=o.userData.wobbleCurrent||0;o.rotation.x=Math.sin(g*3+n)*.15*d*(1+f),o.rotation.z=Math.cos(g*3+n)*.16*d*(1+f)}else if(r==="accordion"){const f=o.userData.trunk||o,m=1+Math.max(0,Math.sin(g*10+n))*.3*d;if(f.scale.y=m,o.userData.trunk){const x=1/Math.sqrt(m);f.scale.x=x,f.scale.z=x}}else if(r==="hop"){const f=o.userData.originalY??o.position.y;o.userData.originalY=f;const m=g*4+n,x=Math.max(0,Math.sin(m))*.3*d;o.position.y=f+x,h&&c>.1&&(o.position.y+=c*.15)}else if(r==="shiver"){const f=Math.sin(g*20+n)*.05*d;o.rotation.z=f,o.rotation.x=f*.5}else if(r==="spring"){const f=g*5+n;o.scale.y=1+Math.sin(f)*.1*d,o.scale.x=1-Math.sin(f)*.05*d,o.scale.z=1-Math.sin(f)*.05*d}else if(r==="gentleSway")o.rotation.z=Math.sin(t*.5+n)*.05*d;else if(r==="vineSway")o.rotation.z=Math.sin(t*1.5+n)*.2*d,o.rotation.x=Math.cos(t*1.2+n)*.1*d;else if(r==="spiralWave")o.children.forEach((f,m)=>{f.rotation.y=Math.sin(t*2+n+m*.5)*.3*d});else if(r==="float"){const f=o.userData.originalY??o.position.y;o.userData.originalY=f,o.position.y=f+Math.sin(t*2+n)*.5*d}else if(r==="spin")o.rotation.y+=.01*d;else if(r==="glowPulse"){const f=o.userData.originalY??o.position.y;o.userData.originalY=f,o.position.y=f+Math.sin(t*2+n)*.1}else if(r==="rain"){const f=o.children.find(x=>x.type==="Points");if(f&&f.geometry&&f.geometry.attributes.position){const x=f.geometry.attributes.position.array;for(let w=0;w<x.length;w+=3)x[w+1]-=.1,x[w+1]<-6&&(x[w+1]=0);f.geometry.attributes.position.needsUpdate=!0}const m=o.userData.originalY??o.position.y;o.userData.originalY=m,o.position.y=m+Math.sin(t*.3+n)*.2}else if(r==="cloudBob"){const f=o.userData.originalY??o.position.y;o.userData.originalY=f,o.position.y=f+Math.sin(t*.5+n)*.3,o.rotation.y=Math.sin(t*.2+n*.5)*.05}else if(r==="vibratoShake"){const f=o.userData.headGroup;if(f){let m=0;if(e&&e.channelData)for(const b of e.channelData)b.activeEffect===1&&(m=Math.max(m,b.effectValue||0));m=Math.max(m,l*.5);const x=50+m*100,w=.05+m*.25;f.children.forEach((b,v)=>{if(v===0)return;const T=b.userData.vibratoPhase||v*.5;b.rotation.x=-Math.PI/2+Math.sin(t*x+T)*w,b.rotation.y=Math.cos(t*x*1.3+T)*w*.8;const M=1+Math.random()*m*.2;b.scale.setScalar(M)}),f.rotation.z=Math.sin(t*15+n)*.1*d}}else if(r==="tremeloPulse"){const f=o.userData.headGroup,m=o.userData.bellMaterial,x=o.userData.vortex;let w=0;if(e&&e.channelData)for(const b of e.channelData)b.activeEffect===3&&(w=Math.max(w,b.effectValue||0));if(w=Math.max(w,Math.sin(u*Math.PI*2)*.3),f){const b=8+w*15,v=.1+w*.3,T=1+Math.sin(t*b+n)*v;f.scale.set(T,T,T),m&&(m.opacity=.7+Math.sin(t*b+n)*.2*d,m.emissiveIntensity=.3+w*.7),x&&(x.scale.setScalar(1-Math.sin(t*b+n)*.4),x.material.opacity=.3+Math.sin(t*b+n+Math.PI)*.4)}o.rotation.z=Math.sin(t+n)*.03*d}else if(r==="cymbalShake"){const f=o.children[1];if(f){let m=0;if(e&&e.channelData){const x=e.channelData[3]?.volume||0,w=e.channelData[4]?.volume||0;m=Math.max(x,w)}if(m>.05){const x=m*.2;f.rotation.z=(Math.random()-.5)*x,f.rotation.x=(Math.random()-.5)*x,f.children.forEach(w=>{w.rotation.z+=(Math.random()-.5)*x*2,w.rotation.z*=.8})}else f.rotation.z*=.9,f.rotation.x*=.9;if(m>.4){const x=1+(m-.4)*.5;f.scale.set(x,x,x)}else f.scale.lerp(lN,.1)}}else if(r==="panningBob"){const f=o.userData.panBias||0;let m=0;if(e&&e.channelData)for(const F of e.channelData){const N=F.volume||0,A=F.pan||0;f*A>0&&(m+=N*Math.abs(A)),Math.abs(A)<.2&&(m+=N*.3)}const x=o.userData.currentBob||0,w=Gt.lerp(x,m,.1);o.userData.currentBob=w;const b=w*1.5*d,v=o.userData.originalY??o.position.y;o.userData.originalY=v,o.position.y=v+Math.sin(t*2+n)*.1+b,o.rotation.z=f*b*.2;const T=o.userData.glowMaterial,M=o.userData.glowUniform;M?M.value=.6+b*.8:T&&(T.opacity=.6+b*.5)}else if(r==="spiritFade"){const f=o.userData.spiritMaterial;let m=1;if(e){let T=0;if(e.channelData){for(const M of e.channelData)T+=M.volume||0;m=T/4}}m<.1?(o.userData.targetOpacity=.8,o.userData.fleeSpeed=Math.max(0,o.userData.fleeSpeed-.01)):(o.userData.targetOpacity=0,o.userData.currentOpacity>.1&&(o.userData.fleeSpeed=Math.min(.2,o.userData.fleeSpeed+.01)));const w=o.userData.currentOpacity||0,b=o.userData.targetOpacity,v=Gt.lerp(w,b,.05);if(o.userData.currentOpacity=v,f&&(f.opacity=v,f.visible=v>.01),o.userData.fleeSpeed>0&&(o.position.z-=o.userData.fleeSpeed),v>.01){const T=o.userData.originalY??o.position.y;o.userData.originalY=T,o.position.y=T+Math.sin(t*1.5+n)*.2}}else if(r==="geyserErupt"){const f=o.userData.plume,m=o.userData.plumeLight,x=o.userData.coreMaterial,w=o.userData.maxHeight||5,b=.3;let v=o.userData.eruptionStrength||0;if(c>b?v=Math.min(1,v+c*.5):v=Math.max(0,v-.03),o.userData.eruptionStrength=v,f){if(f.visible=v>.05,f.visible&&f.geometry.attributes.position){const T=f.geometry.attributes.position.array,M=f.geometry.attributes.velocity.array,F=w*v;for(let N=0;N<T.length/3;N++){const A=N*3,E=M[N];T[A+1]+=E*v*.3;const U=T[A+1]/F;T[A]+=(Math.random()-.5)*.02*U,T[A+2]+=(Math.random()-.5)*.02*U,(T[A+1]>F||T[A+1]<0)&&(T[A]=(Math.random()-.5)*.2,T[A+1]=0,T[A+2]=(Math.random()-.5)*.2)}f.geometry.attributes.position.needsUpdate=!0}f.material.opacity!==void 0&&(f.material.opacity=.5+v*.5)}m&&(m.intensity=v*2,m.position.y=1+v*w*.3),x&&(x.emissiveIntensity=.3+v*1.5+Math.sin(t*20)*.2*v)}}}const mN=Ct(1);function yN(o=400,t=400){const e=new $i(o,t,128,128);e.rotateX(-Math.PI/2);const s=Do(([T])=>{const M=At(T.x.mul(.05).add(Ge.mul(.5))).mul(2),F=zr(T.z.mul(.1).sub(Ge.mul(1))).mul(zs.mul(3).add(.5)),N=At(T.x.mul(.5).add(Ge.mul(2))),A=zr(T.z.mul(.4).sub(Ge.mul(2.5))),E=N.mul(A).mul(Bn.mul(1.5));return M.add(F).add(E).mul(mN)}),i=Vt.SeaJelly(4500223,{roughness:.1,metalness:.1,transmission:.9,ior:1.33,thickness:2,animateMoisture:!0}),n=Lt,r=s(n),a=at(n.x,n.y.add(r),n.z);i.positionNode=a;const c=Pt(2,5,r),l=ot(16777215),u=i.colorNode;i.colorNode=de(u,l,c.mul(.5));const p=Ls.mul(.5),h=Ge.mul(.5),d=We(p.add(h)),g=Pt(.8,1,d),f=at(.6,1,1),m=Bn.mul(g).mul(3),x=_0(ot(11202303),X(.5),X(2),Nd),w=zs.mul(.2),b=at(.1,.3,.6).mul(w);i.emissiveNode=b.add(f.mul(m)).add(x);const v=new V(e,i);return v.userData.type="water",v.receiveShadow=!0,v.frustumCulled=!1,v}const cs=Ct(0);function xN(){const o=new $i(2,2),t=Do(()=>{const n=KM.sub(.5),r=n.length(),a=cs.mul(.5),c=X(1).add(r.mul(r).mul(a)),l=n.mul(c).add(.5),u=n.normalize(),p=cs.mul(.02),h=l.sub(u.mul(p)),d=l.add(u.mul(p)),g=l,f=uu(h).r,m=uu(g).g,x=uu(d).b,w=at(f,m,x);return mh(w,1)}),e=new Ol;e.colorNode=t(),e.depthTest=!1,e.depthWrite=!1,e.transparent=!0;const s=new V(o,e);return s.frustumCulled=!1,s.renderOrder=9999,s.userData.isFullScreenEffect=!0,s.position.set(0,0,-1),s.scale.set(10,10,1),s}const Ua=Ct(0),fu=Ct(ot(16777215)),Rp=Ct(0);function wN(o=1500){const t=new zt,e=new Float32Array(o*3),s=new Float32Array(o),i=new Float32Array(o),n=new Float32Array(o*3),r=new Float32Array(o*3),a=400;for(let E=0;E<o;E++){const U=Math.random(),$=Math.random(),Z=2*Math.PI*U,j=Math.acos(2*$-1),ut=a*(.9+Math.random()*.2),nt=ut*Math.sin(j)*Math.cos(Z),Ue=ut*Math.sin(j)*Math.sin(Z),_e=ut*Math.cos(j);e[E*3]=nt,e[E*3+1]=Math.abs(Ue),e[E*3+2]=_e,r[E*3]=0,r[E*3+1]=1,r[E*3+2]=0,s[E]=Math.random()*2.5+.3,i[E]=Math.random()*100;const It=Math.random();It<.7?(n[E*3]=1,n[E*3+1]=1,n[E*3+2]=1):It<.85?(n[E*3]=.8,n[E*3+1]=.9,n[E*3+2]=1):(n[E*3]=1,n[E*3+1]=.9,n[E*3+2]=.7)}t.setAttribute("position",new it(e,3)),t.setAttribute("normal",new it(r,3)),t.setAttribute("size",new it(s,1)),t.setAttribute("offset",new it(i,1)),t.setAttribute("starColor",new it(n,3));const c=new w0({size:1.5,transparent:!0,opacity:0,blending:Jt,depthWrite:!1,fog:!1}),l=Bs("offset","float"),u=Bs("size","float"),p=Bs("starColor","vec3"),h=Ge.add(l).sin().mul(.3).add(.5),d=Ge.mul(2.3).add(l.mul(.7)).sin().mul(.2).add(.5),f=h.mul(d).add(Ua.mul(1.5)),m=at(p.x,p.y,p.z),x=at(fu.r,fu.g,fu.b),w=de(m,x,Ua.mul(.8));c.colorNode=mh(w,Rp).mul(c.color),c.sizeNode=u.mul(f.max(.3));const b=Lt,v=Ua.mul(20),T=b.add(b.normalize().mul(v)),M=Ge.mul(.02),F=T.x.mul(zr(M)).sub(T.z.mul(At(M))),N=T.x.mul(At(M)).add(T.z.mul(zr(M)));c.positionNode=at(F,T.y,N);const A=new Zi(t,c);return A.userData.isStars=!0,A}const ba={blinkDuration:.2,danceAmplitude:.5,danceSpeed:2};function bN(){const o=new K;o.name="Moon";const t=new ne(15,32,32),e=new ds({roughness:.8,metalness:.1}),s=ot(14544639),i=Ct(0);e.uBlink=i;const n=i.mul(2);e.colorNode=s,e.emissiveNode=ot(16777215).mul(n);const r=new V(t,e);r.castShadow=!0,o.add(r);const a=new K;a.position.z=14.5;const c=new ne(1.5,16,16),l=new xi({color:1118481,roughness:.2}),u=new V(c,l);u.position.set(-4,3,0),u.scale.z=.5;const p=new V(c,l);p.position.set(4,3,0),p.scale.z=.5,o.userData.eyes=[u,p];const h=new Qi(3,.5,8,16,Math.PI),d=new xi({color:1118481,roughness:.5}),g=new V(h,d);return g.rotation.z=Math.PI,g.position.set(0,-2,0),a.add(u,p,g),a.lookAt(0,0,100),o.add(a),o.userData.isMoon=!0,o.userData.originalPosition=new S,o.userData.velocity=new S,o.userData.blinkTimer=0,o.userData.type="moon",o.userData.reactivityType="sky",Wt(o)}function vN(o,t,e){if(!o||!o.userData.isMoon)return;const s=performance.now()*.001,i=e?.beatPhase||0,n=e?.grooveAmount||0,r=Math.sin(s*ba.danceSpeed)*ba.danceAmplitude,a=Math.max(0,Math.sin(i*Math.PI*2))*n*2,c=o.children[0];if(c&&(c.position.y=r+a,c.rotation.z=Math.sin(s)*.05),o.userData.blinkTimer>0){if(o.userData.blinkTimer-=t,c.material.uBlink){const u=1-o.userData.blinkTimer/ba.blinkDuration,p=Math.sin(u*Math.PI);c.material.uBlink.value=p}const l=o.userData.eyes;l&&l.forEach(u=>u.scale.y=.1+(1-Math.sin(Math.PI*(1-o.userData.blinkTimer/ba.blinkDuration)))*.9)}else{const l=o.userData.eyes;l&&l.forEach(u=>u.scale.y=1),c.material.uBlink&&(c.material.uBlink.value=0),Math.random()<.005&&Ep(o),o.userData.flashIntensity>.1&&(Ep(o),o.userData.flashIntensity=0)}}function Ep(o){o.userData.blinkTimer=ba.blinkDuration}const Dp=Ct(0),Lc=Ct(ot(65433)),_N=Ct(.2);function SN(){const o=new Re(800,800,400,64,16,!0);o.translate(0,300,0);const t=Do(()=>{const i=ti(),n=Ge.mul(_N),r=At(i.x.mul(20).add(n)).mul(.1),a=At(i.x.mul(45).sub(n.mul(1.5))).mul(.05),c=i.x.add(r).add(a),l=At(c.mul(60)).mul(.5).add(.5),u=Pt(0,.2,i.y).mul(Pt(1,.6,i.y)),p=at(i.y.mul(.5),0,i.y.mul(.2).negate()),d=at(Lc.r,Lc.g,Lc.b).add(p),g=l.mul(u).mul(Dp).mul(.6);return mh(d,g)}),e=new Ol;e.colorNode=t(),e.transparent=!0,e.blending=Jt,e.side=Kt,e.depthWrite=!1,e.fog=!1;const s=new V(o,e);return s.userData.type="aurora",s.userData.isAurora=!0,s.frustumCulled=!1,s}function Od(o={}){const{radius:t=1,baseColor:e=3050327,glowColor:s=65535}=o,i=new K,n=is(13421772,{roughness:.1,metalness:.9,iridescenceStrength:.8,iridescenceFresnelPower:2,bumpStrength:.05,noiseScale:4,sheen:.5,sheenColor:s});te(n);const r=new V(ft.unitCylinder,n);r.scale.set(t,.1,t),r.position.y=0,r.castShadow=!0,r.receiveShadow=!0,i.add(r);const a=Bo({color:s,roughness:1,transparent:!0,opacity:.6,blending:Jt,depthWrite:!1,side:Kt}),c=al(.5,.5),l=HM(ti(),c).mul(2),u=Pt(.8,.9,l).sub(Pt(.9,1,l)),p=X(1).sub(l),h=Ct(.6);a.opacityNode=p.mul(.3).add(u).mul(h),a.emissiveNode=ot(s).mul(a.opacityNode);const d=new V(ft.quad,a);d.rotation.x=-Math.PI/2,d.position.y=.11,d.scale.set(t*2.2,t*2.2,1),r.add(d),i.userData.glowMaterial=a,i.userData.glowUniform=h,i.userData.type="panningPad",i.userData.animationType="panningBob",i.userData.animationOffset=Math.random()*100;const g=o.panBias!==void 0?o.panBias:Math.random()>.5?-1:1;return i.userData.panBias=g,Wt(i,{}),i}function Wd(o={}){const t=new K,{scale:e=1}=o,s=La({color:15663103,emissive:8965375,emissiveIntensity:.5,roughness:.2,opacity:0,transparent:!0,depthWrite:!1,blending:Jt}),i=new o0(.3*e,1*e,4,8);i.translate(0,.8*e,0);const n=new V(i,s);t.add(n);const r=new ne(.25*e,8,8),a=new V(r,s);return a.position.y=1.4*e,n.add(a),t.userData.type="silenceSpirit",t.userData.animationType="spiritFade",t.userData.isVisible=!1,t.userData.targetOpacity=0,t.userData.currentOpacity=0,t.userData.fleeSpeed=0,t.userData.spiritMaterial=s,t}function $d(o={}){const{instrumentID:t=0,scale:e=1}=o,s=new K,i=is(3355443,{roughness:.2,metalness:.8,bumpStrength:.1}),n=X(t),r=ti().mul(10),a=At(r.x.add(n)).mul(zr(r.y.add(n))),c=We(at(r.x,r.y,n)),l=At(n.mul(.5)).add(1).mul(.5),u=de(a,c,l),p=t*.1%1,h=new W().setHSL(p,1,.5),d=ot(h);i.emissiveNode=d.mul(u.add(.5).mul(2));const g=new Un(1,3,1),f=new V(g,i);f.scale.set(e,e,e),f.position.y=1.5*e,f.castShadow=!0,s.add(f);const m=is(16777215,{transmission:1,thickness:1,roughness:0,ior:1.5,iridescenceStrength:1}),x=new V(ft.unitSphere,m);return x.position.y=3.5*e,x.scale.setScalar(.5*e),s.add(x),s.userData.type="instrumentShrine",s.userData.instrumentID=t,s.userData.animationType="float",s.userData.animationOffset=Math.random()*100,Wt(s,{}),s}const gn=200,Bp=.8,fc=2,E5=15,D5=1,pl=Ct(0);Ct(at(0,1,1));function TN(o){const t=new K;t.name="MelodyRibbonSystem";const e=(gn+1)*2,s=new zt,i=new Float32Array(e*3),n=new Float32Array(e*2),r=[];for(let f=0;f<=gn;f++)if(i[f*6+0]=-Bp/2,i[f*6+1]=0,i[f*6+2]=f*D5,n[f*4+0]=0,n[f*4+1]=f/gn,i[f*6+3]=Bp/2,i[f*6+4]=0,i[f*6+5]=f*D5,n[f*4+2]=1,n[f*4+3]=f/gn,f<gn){const m=f*2;r.push(m,m+1,m+2),r.push(m+1,m+3,m+2)}s.setAttribute("position",new it(i,3).setUsage(vn)),s.setAttribute("uv",new it(n,2)),s.setAttribute("normal",new it(new Float32Array(e*3).fill(0),3)),s.setIndex(r);const a=is(65535,{roughness:.2,metalness:.1,transmission:.5,thickness:.1,ior:1.2,side:Kt}),c=ti(),l=We(Lt.mul(10).add(pl)),u=Pt(.8,1,l),p=de(at(0,.5,1),at(1,.2,.8),At(c.y.mul(10).add(pl)).mul(.5).add(.5)),h=Pt(0,.2,c.y);a.colorNode=p,a.emissiveNode=p.mul(u.mul(2).add(.5)),a.opacityNode=h,a.transparent=!0;const d=new V(s,a);d.frustumCulled=!1,t.add(d);const g=[];for(let f=0;f<=gn;f++)g.push({x:0,y:-100,z:0,width:0});return t.userData={mesh:d,pathHistory:g,headPosition:new S(0,5,0),headDirection:new S(0,0,1),currentPitchHeight:5,targetPitchHeight:5,isActive:!1},o.add(t),t}function MN(o,t,e){if(!o||!o.userData.mesh)return;const{mesh:s,pathHistory:i,headPosition:n,headDirection:r}=o.userData;pl.value+=t;let a=0,c=0;if(e&&e.channelData){const m=e.channelData[2];m&&(a=m.trigger||0,c=m.note||0)}const l=a>.05,u=pl.value,p=30,h=.5,d=Math.sin(u*h)*p,g=Math.cos(u*h)*p;if(n.x+=(d-n.x)*t*2,n.z+=(g-n.z)*t*2,l){const x=c%24/24;o.userData.targetPitchHeight=fc+x*(E5-fc)}else o.userData.targetPitchHeight=fc+(E5-fc)*.5;n.y+=(o.userData.targetPitchHeight-n.y)*t*5,i.shift(),i.push({x:n.x,y:n.y,z:n.z,width:Bp+a*2});const f=s.geometry.attributes.position.array;for(let m=0;m<=gn;m++){const x=i[m];let w=0,b=1;if(m<gn){const F=i[m+1],N=F.x-x.x,A=F.z-x.z,E=Math.sqrt(N*N+A*A);E>.001&&(w=N/E,b=A/E)}const v=-b,T=w,M=x.width/2;f[m*6+0]=x.x-v*M,f[m*6+1]=x.y,f[m*6+2]=x.z-T*M,f[m*6+3]=x.x+v*M,f[m*6+4]=x.y,f[m*6+5]=x.z+T*M}s.geometry.attributes.position.needsUpdate=!0,s.geometry.computeVertexNormals()}let Bi=null;function AN(){if(Bi)return Bi;const o=512,t=new Uint8Array(o*o*4);for(let e=0;e<o;e++)for(let s=0;s<o;s++){const i=(e*o+s)*4,n=s/o,r=e/o,a=new W().setHSL(.6+n*.1,.8,.2+r*.6),c=Math.sin(n*20+r*15)*.5+.5,l=new W(16777215);a.lerp(l,c*.3*(1-r)),t[i]=a.r*255,t[i+1]=a.g*255,t[i+2]=a.b*255,t[i+3]=255}return Bi=new Zp(t,o,o,Cn),Bi.wrapS=Nn,Bi.wrapT=Nn,Bi.minFilter=Je,Bi.magFilter=Je,Bi.needsUpdate=!0,Bi}function NN(o={}){const t=o.scale||1,e=o.shards||3,s=new K;s.userData.type="melody_mirror";const i=AN(),n=new ds;n.roughnessNode=X(.1),n.metalnessNode=X(1);const r=Vr(Kl.sub(Ls)),a=po,c=jM(r.negate(),a),l=$e.mul(2),u=At(Ls.y.mul(5).add(l)),p=Bn.mul(.2).add(.05),d=al(c.x.mul(.5).add(.5),c.y.mul(.5).add(.5)).add(al(u,u).mul(p)),g=JM(i,d).rgb,f=ot(13426175),m=_0(f,X(2),X(3),a);n.colorNode=ot(1118481),n.emissiveNode=g.add(m);const x=new Re(0,1,3,4,1);x.translate(0,0,0);for(let w=0;w<e;w++){const b=new V(x,n),v=t*(.5+Math.random()*.5);b.scale.set(v,v*(1.5+Math.random()),v*.2),b.position.set((Math.random()-.5)*t,(Math.random()-.5)*t,(Math.random()-.5)*t),b.rotation.set(Math.random()*Math.PI,Math.random()*Math.PI,Math.random()*Math.PI),b.userData.rotSpeed=new S((Math.random()-.5)*.5,(Math.random()-.5)*.5,(Math.random()-.5)*.5),s.add(b)}return Wt(s,{type:"sky",lightPreference:{min:0,max:1}}),s.userData.onUpdate=(w,b)=>{s.children.forEach(v=>{v.rotation.x+=v.userData.rotSpeed.x*w,v.rotation.y+=v.userData.rotSpeed.y*w,v.rotation.z+=v.userData.rotSpeed.z*w}),s.position.y+=Math.sin($e.value+s.id)*.005},s}const Uc=500;function CN(){const o=new zt,t=new Float32Array(Uc*3),e=new Float32Array(Uc),s=new Float32Array(Uc);e.fill(-1e3),o.setAttribute("position",new it(t,3)),o.setAttribute("birthTime",new it(e,1)),o.setAttribute("lifeSpan",new it(s,1));const i=new w0({size:.3,transparent:!0,depthWrite:!1,blending:Jt}),n=Bs("birthTime"),r=Bs("lifeSpan"),a=$e.sub(n),c=a.div(r),l=Pt(0,.2,c).mul(X(1).sub(Pt(.5,1,c))),u=X(.3).mul(X(1).sub(c));i.sizeNode=u;const p=ot(16766720),h=ot(16711935),d=At(a.mul(20)).mul(.5).add(.5);i.colorNode=de(p,h,d).mul(2),i.opacityNode=l;const g=new Zi(o,i);return g.frustumCulled=!1,g.userData.head=0,g.userData.isSparkleTrail=!0,g}const mc=new S;function FN(o,t,e,s){if(!o||!o.userData.isSparkleTrail)return;const i=e.length();if(i<8)return;const n=Math.min(Math.floor(i/3),10),r=o.geometry.attributes.position,a=o.geometry.attributes.birthTime,c=o.geometry.attributes.lifeSpan;let u=o.userData.head;for(let p=0;p<n;p++)mc.set((Math.random()-.5)*.8,.1+Math.random()*.8,(Math.random()-.5)*.8),r.setXYZ(u,t.x+mc.x,t.y+mc.y,t.z+mc.z),a.setX(u,s),c.setX(u,.4+Math.random()*.4),u=(u+1)%Uc;o.userData.head=u,r.needsUpdate=!0,a.needsUpdate=!0,c.needsUpdate=!0}const Qn=1500;let vr=null,mu=0;function RN(){const o=new zt,t=new Float32Array(Qn*3),e=new Float32Array(Qn*3),s=new Float32Array(Qn),i=new Float32Array(Qn),n=new Float32Array(Qn*3),r=new Float32Array(Qn);s.fill(-1e3),o.setAttribute("position",new it(t,3)),o.setAttribute("velocity",new it(e,3)),o.setAttribute("birthTime",new it(s,1)),o.setAttribute("lifeSpan",new it(i,1)),o.setAttribute("color",new it(n,3)),o.setAttribute("size",new it(r,1));const a=new w0({size:1,transparent:!0,depthWrite:!1,blending:Jt}),c=Bs("birthTime"),l=Bs("lifeSpan"),u=Bs("velocity"),p=Bs("color"),h=Bs("size"),d=$e.sub(c),g=d.div(l),f=g.greaterThan(0).and(g.lessThan(1)),m=at(0,-10,0),x=u.mul(d).add(m.mul(d.mul(d).mul(.5)));a.positionNode=Lt.add(x);const w=X(1).sub(Pt(0,1,g));return a.opacityNode=w.mul(f),a.colorNode=p,a.sizeNode=h.mul(X(1).sub(g)),vr=new Zi(o,a),vr.frustumCulled=!1,vr.userData.isImpactSystem=!0,vr}function hl(o,t="jump"){if(!vr)return;const e=vr.geometry,s=e.attributes.position,i=e.attributes.velocity,n=e.attributes.birthTime,r=e.attributes.lifeSpan,a=e.attributes.color,c=e.attributes.size,l=t==="land"?40:t==="dash"?30:20,u=$e.value;for(let p=0;p<l;p++){const h=mu;mu=(mu+1)%Qn;const d=(Math.random()-.5)*.5,g=(Math.random()-.5)*.2,f=(Math.random()-.5)*.5;s.setXYZ(h,o.x+d,o.y+g,o.z+f);let m,x,w;if(t==="jump"){const b=Math.random()*Math.PI*2,v=Math.random()*1.5;m=Math.cos(b)*v,x=2+Math.random()*3,w=Math.sin(b)*v}else if(t==="land"){const b=Math.random()*Math.PI*2,v=3+Math.random()*4;m=Math.cos(b)*v,x=Math.random()*2,w=Math.sin(b)*v}else if(t==="dash"){const b=Math.random()*Math.PI*2,v=Math.random()*Math.PI,T=2+Math.random()*5;m=Math.sin(v)*Math.cos(b)*T,x=Math.cos(v)*T,w=Math.sin(v)*Math.sin(b)*T}i.setXYZ(h,m,x,w),n.setX(h,u),r.setX(h,.4+Math.random()*.4),t==="jump"?a.setXYZ(h,1,.9,.5):t==="land"?a.setXYZ(h,.9,.85,.8):t==="dash"&&a.setXYZ(h,0,1,1),c.setX(h,.3+Math.random()*.4)}s.needsUpdate=!0,i.needsUpdate=!0,n.needsUpdate=!0,r.needsUpdate=!0,a.needsUpdate=!0,c.needsUpdate=!0}function EN(o={}){const{color:t=3050327,scale:e=1}=o,s=new K;s.scale.setScalar(e);const i=Ut(t),n=new V(ft.unitCylinder,i);n.scale.set(1.5,.2,1.5),n.position.y=0,n.castShadow=!0,n.receiveShadow=!0,s.add(n);const r=new ds;r.colorNode=ot(16777215),r.roughnessNode=X(.2),r.metalnessNode=X(.5);const a=zs.mul(.8),c=We(at($e.mul(20),0,0)).mul(Vi).mul(.5),l=a.add(c),u=at(1,1,1),p=at(.8,0,1),h=de(u,p,Vi),d=h.mul(a.add(.2));r.colorNode=h,r.emissiveNode=d;const g=Lt.add(at(0,l,0));r.positionNode=g,te(r);for(let Z=1;Z<=3;Z++){const j=Z*.35,ut=new Qi(j,.06,8,32),nt=new V(ut,r);nt.rotation.x=-Math.PI/2,nt.position.y=.3,nt.position.y+=(3-Z)*.1,n.add(nt)}const f=new _l(.25,32),m=new ds;m.roughnessNode=X(0);const x=ti().sub(.5).mul(2),w=YM(x),b=$e.mul(5).add(Vi.mul(20)),v=X($M(x.y,x.x)).add(b.mul(X(1).sub(w))),T=At(v.mul(5).sub(w.mul(10))),M=fh(Pt(.1,.5,Vi),Pt(.7,1,zs)),F=at(0,0,0),N=at(.5,0,1),A=at(1,0,.5),E=de(F,N,T.mul(M)),U=Pt(.2,0,w).mul(A).mul(M);m.colorNode=at(0),m.emissiveNode=E.add(U);const $=new V(f,m);return $.rotation.x=-Math.PI/2,$.position.y=.6,n.add($),s.userData.animationType="sway",s.userData.type="subwoofer_lotus",Wt(s,{})}function Hd(o={}){const{color:t=65416,scale:e=1}=o,s=new K,i=new Rn(.2*e,.5*e,6),n=Ut(3050327),r=new V(i,n);r.position.y=.25*e,s.add(r);const a=5,c=8,l=S0(t);te(l),s.userData.fronds=[];for(let p=0;p<a;p++){const h=new K;h.rotation.y=p/a*Math.PI*2,h.position.y=.4*e;const d=[];let g=h;for(let f=0;f<c;f++){const m=new Un(.1*e,.3*e,.02*e);m.scale(1-f/c*.8,1,1),m.translate(0,.15*e,0);const x=new V(m,l),w=new K;w.position.y=f===0?0:.28*e;const b=-.5;w.rotation.x=b,w.add(x),g.add(w),g=w,d.push({pivot:w,initialCurl:b})}s.add(h),s.userData.fronds.push(d)}s.userData.animationType="arpeggioUnfurl",s.userData.type="fern";const u=Wt(s);return Jl(u)}function qd(o={}){const{color:t=13467442,height:e=4}=o,s=new K,i=6,n=e/i,r=Ut(9127187),a=S0(3050327);let c=s;for(let l=0;l<i;l++){const u=new K;u.position.y=l===0?0:n;const p=.4*(1-l/i)+.1,h=.4*(1-(l+1)/i)+.1,d=new Re(h,p,n,8);d.translate(0,n/2,0);const g=new V(d,r);if(l>1)for(let m=0;m<8;m++){const x=new V(new Rn(.1,.6,4),a);x.position.y=n*.5,x.rotation.y=m/8*Math.PI*2,x.rotation.z=1.5,x.position.x=p,g.add(x)}u.add(g),c.add(u),c=u,s.userData.segments||(s.userData.segments=[]),s.userData.segments.push(u)}return s.userData.animationType="portamentoBend",s.userData.type="tree",Jl(s)}function Yd(o={}){const{scale:t=1}=o,e=new K,s=new V(new Re(.02*t,.02*t,1.5*t),Ut(5597999));s.position.y=.75*t,e.add(s);const i=new K;i.position.y=1.5*t,e.add(i);const n=24,r=new Re(.01,.01,.4*t);r.translate(0,.2*t,0);const a=new ne(.04*t),c=S0(16766720);te(c);for(let u=0;u<n;u++){const p=new K,h=Math.acos(-1+2*u/n),d=Math.sqrt(n*Math.PI)*h;p.rotation.setFromVector3(new S(Math.sin(h)*Math.cos(d),Math.sin(h)*Math.sin(d),Math.cos(h)).normalize().multiplyScalar(1.5)),p.lookAt(p.position.clone().add(new S(0,1,0)));const g=new V(r,Ut(16777215)),f=new V(a,c);f.position.y=.4*t,g.add(f),i.add(g),g.quaternion.setFromUnitVectors(new S(0,1,0),new S(Math.sin(h)*Math.cos(d),Math.cos(h),Math.sin(h)*Math.sin(d)))}e.userData.animationType="cymbalShake",e.userData.type="flower";const l=Wt(e);return Jl(l)}function Xd(o={}){const{color:t=16729344,scale:e=1}=o,s=new K,i=new V(new Re(.4,.5,.2),Ut(3026478));s.add(i);const n=S0(t);te(n);const r=Ut(16777215),a=new K,c=new K,l=new Qi(.5*e,.1*e,8,16,Math.PI),u=new V(l,n);u.rotation.x=Math.PI/2,a.add(u);const p=new V(l,n);p.rotation.x=Math.PI/2,c.add(p);for(let d=0;d<5;d++){const g=new V(new Rn(.05,.2),r);g.position.set((d-2)*.2,0,.1),g.rotation.x=-1,a.add(g);const f=g.clone();f.rotation.x=1,f.position.z=-.1,c.add(f)}a.position.set(0,.2,-.2),c.position.set(0,.2,.2),a.rotation.x=-.5,c.rotation.x=.5+Math.PI,s.add(a),s.add(c),s.userData.leftJaw=a,s.userData.rightJaw=c,s.userData.animationType="snareSnap",s.userData.type="trap";const h=Wt(s);return Jl(h)}class DN{constructor(){this.systems=new Map,this.dummy=new Xt,this._position=new S,this._quaternion=new Gr,this._scale=new S,this.instanceColors=null}register(t,e,s){!e||!s||s.length===0||(console.log(`[MusicalFlora] Registering system: ${t} (${s.length} items)`),JA(s),this.systems.set(t,{mesh:e,data:s,count:s.length}))}update(t,e,s){const i=s?.kickTrigger||0,n=s?.energy||0;for(const[r,a]of this.systems)this.animateSystem(a,t,n,i)}animateSystem(t,e,s,i){const{mesh:n,count:r,data:a}=t,c=eN(e,s,i,r);if(c){for(let l=0;l<r;l++){const u=a[l],p=l*4,h=c[p],d=c[p+1],g=c[p+2];this._position.set(u.x,u.y+h,u.z),this._quaternion.setFromEuler(new As(d,0,g));const f=1+i*.2*s,m=1+h*.5,x=u.scale||1;this._scale.set(x*f,x*m,x*f),this.dummy.position.copy(this._position),this.dummy.quaternion.copy(this._quaternion),this.dummy.scale.copy(this._scale),this.dummy.updateMatrix(),n.setMatrixAt(l,this.dummy.matrix)}n.instanceMatrix.needsUpdate=!0}}}new DN;function Jl(o){return o.userData.originalScale||(o.userData.originalScale=o.scale.clone()),o.userData.isHovered=!1,o.userData.onProximityEnter=t=>{o.traverse(e=>{e.isMesh&&e.material&&e.material.emissive&&(e.userData.baseEmissive=e.material.emissive.getHex(),e.material.emissive.setHex(1118481))})},o.userData.onProximityLeave=()=>{o.scale.copy(o.userData.originalScale),o.traverse(t=>{t.isMesh&&t.material&&t.material.emissive&&t.userData.baseEmissive!==void 0&&t.material.emissive.setHex(t.userData.baseEmissive)})},o.userData.onGazeEnter=()=>{o.userData.isHovered=!0;const t=o.userData.originalScale.clone().multiplyScalar(1.2);o.scale.copy(t),o.traverse(e=>{e.isMesh&&e.material&&e.material.emissive&&(e.material.emissiveIntensity=.5,e.material.emissive.setHex(4473924))})},o.userData.onGazeLeave=()=>{o.userData.isHovered=!1,o.scale.copy(o.userData.originalScale),o.traverse(t=>{t.isMesh&&t.material&&t.material.emissive&&(t.material.emissiveIntensity=0,t.material.emissive.setHex(1118481))})},o.userData.onInteract=()=>{console.log("Interacted with:",o.userData.type||"Object");const t=o.rotation.y,e=performance.now(),s=()=>{const i=performance.now(),n=Math.min((i-e)/500,1),r=1-(1-n)*(1-n);o.rotation.y=t+r*Math.PI*2,n<1?requestAnimationFrame(s):o.rotation.y=t};s()},o}function yu(o){const t=Math.acos(Math.random()*2-1),e=Math.random()*Math.PI*2,s=o*Math.sin(t)*Math.cos(e),i=Math.abs(o*Math.cos(t)),n=o*Math.sin(t)*Math.sin(e);return new S(s,Math.max(100,i),n)}function BN(){const o=new K,t=new ne(4,16,16),e=new gi({color:11206655}),s=new V(t,e);o.add(s);const i=new ne(8,16,16),n=new gi({color:65535,transparent:!0,opacity:.3,blending:Jt,side:ls}),r=new V(i,n);return o.add(r),o.userData.type="pulsar",o.userData.reactivityType="sky",o.userData.minLight=0,o.userData.maxLight=1,Wt(o)}function PN(){const o=new K,t=new Dr(15,2),e=new xi({color:16729156,flatShading:!0,roughness:.8}),s=new V(t,e);o.add(s);const i=new r0(20,35,32),n=new gi({color:16755336,side:Kt,transparent:!0,opacity:.6}),r=new V(i,n);return r.rotation.x=Math.PI/2.5,o.add(r),o.userData.type="planet",o.userData.reactivityType="flora",o.userData.reactivityId=0,Wt(o)}function IN(){const t=new zt,e=new Float32Array(1e3*3),s=new Float32Array(1e3*3),i=new Float32Array(1e3),n=new W(16736304),r=new W(1784196);for(let u=0;u<1e3;u++){const p=Math.random()*40,h=p*.5,d=u%3*(Math.PI*2/3),g=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),f=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),m=Math.pow(Math.random(),3)*(Math.random()<.5?1:-1),x=Math.cos(h+d)*p+g,w=Math.random()*2+f,b=Math.sin(h+d)*p+m;e[u*3]=x,e[u*3+1]=w,e[u*3+2]=b;const v=n.clone();v.lerp(r,p/40),s[u*3]=v.r,s[u*3+1]=v.g,s[u*3+2]=v.b,i[u]=Math.random()*2}t.setAttribute("position",new it(e,3));const a=new Float32Array(1e3*3);for(let u=0;u<1e3*3;u+=3)a[u]=0,a[u+1]=1,a[u+2]=0;t.setAttribute("normal",new it(a,3)),t.setAttribute("color",new it(s,3)),t.setAttribute("size",new it(i,1));const c=new xo({size:.8,vertexColors:!0,blending:Jt,depthWrite:!1,transparent:!0}),l=new Zi(t,c);return l.userData.type="galaxy",l.userData.reactivityType="flora",l.userData.baseRotationSpeed=5e-4,Wt(l)}function LN(o){const t=[],e=IN();e.position.copy(yu(900)),e.lookAt(0,0,0),o.add(e),t.push(e);for(let i=0;i<2;i++){const n=BN();n.position.copy(yu(950)),o.add(n),t.push(n)}const s=PN();return s.position.copy(yu(800)),o.add(s),t.push(s),t}class UN{constructor(t,e){this.camera=t,this.raycaster=new Rm,this.raycaster.far=as?.interaction?.maxDistance,this.hoveredObject=null,this._nearbySetA=new Set,this._nearbySetB=new Set,this.nearbyObjects=this._nearbySetA,this._candidatesScratch=[],this._scratchVec2=new Y(0,0),this.reticleCallback=e,this.proximityRadius=as?.interaction?.proximityRadius,this.interactionDistance=as?.interaction?.interactionDistance}update(t,e,...s){const i=this.nearbyObjects,n=i===this._nearbySetA?this._nearbySetB:this._nearbySetA;n.clear();for(let a=0;a<s.length;a++){const c=s[a];if(!c||!Array.isArray(c))continue;const l=c.length;for(let u=0;u<l;u++){const p=c[u];if(!p||!p.position||!p.visible)continue;e.distanceTo(p.position)<this.proximityRadius&&n.add(p)}}for(const a of n)if(!i.has(a)&&a.userData?.onProximityEnter)try{a.userData.onProximityEnter(e.distanceTo(a.position))}catch(c){console.warn("Proximity Enter Error:",c)}for(const a of i)if(!n.has(a)){if(a.userData?.onProximityLeave)try{a.userData.onProximityLeave()}catch(c){console.warn("Proximity Leave Error:",c)}this.hoveredObject===a&&this.handleHover(null)}this.nearbyObjects=n,this._candidatesScratch.length=0;for(const a of this.nearbyObjects)this._candidatesScratch.push(a);const r=this._candidatesScratch;if(r.length>0){this._scratchVec2.set(0,0),this.raycaster.setFromCamera(this._scratchVec2,this.camera);try{const a=this.raycaster.intersectObjects(r,!0);if(a.length>0){let c=a[0].object,l=null;const u=a[0].distance;let p=0;for(;c&&p<10;){if(this.nearbyObjects.has(c)){l=c;break}c=c.parent,p++}if(l&&u<this.interactionDistance){this.handleHover(l);return}}}catch(a){Math.random()<.01&&console.warn("Interaction Raycast Warning:",a)}}this.handleHover(null)}handleHover(t){if(this.hoveredObject!==t){if(this.hoveredObject&&this.hoveredObject.userData?.onGazeLeave)try{this.hoveredObject.userData.onGazeLeave()}catch{}if(this.hoveredObject=t,this.hoveredObject){if(this.hoveredObject.userData?.onGazeEnter)try{this.hoveredObject.userData.onGazeEnter()}catch{}this.reticleCallback&&this.reticleCallback("hover")}else this.reticleCallback&&this.reticleCallback("idle")}}triggerClick(){if(this.hoveredObject&&this.hoveredObject.userData?.onInteract)try{return this.hoveredObject.userData.onInteract(),this.reticleCallback&&(this.reticleCallback("interact"),setTimeout(()=>this.reticleCallback("hover"),150)),!0}catch(t){console.warn("Interact Error",t)}return!1}}const zN=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],yc={},xu={};new Ln;function kN(o,t){const e=o.userData.minLight!==void 0?o.userData.minLight:0,s=o.userData.maxLight!==void 0?o.userData.maxLight:1,i=.1,n=(t-e)/i,r=(s-t)/i,a=Math.min(Math.max(n,0),Math.max(r,0),1);return{lightFactor:a,shouldReact:a>0}}function VN(o,t,e){let s=o.userData._cacheIdx;if(s===void 0||o.userData._cacheTotal!==t){const i=o.userData.reactivityType||"flora",n=o.userData.reactivityId||0;if(i==="sky"){const r=t-e;s=r>0?e+n%r:t-1}else{const r=e;s=r>0?n%r:0}o.userData._cacheIdx=s,o.userData._cacheTotal=t}return s}function GN(o){if(typeof o=="number"){const t=o%12;return zN[t]}else if(typeof o=="string"){if(yc[o])return yc[o];const t=o.replace(/[0-9-]/g,"");return Object.keys(yc).length<200&&(yc[o]=t),t}return""}function ON(o,t,e){const s=GN(o);let i=e[t];if(!i)if(xu[t])i=xu[t];else{const n=(t||"").toLowerCase();n.includes("flower")||n.includes("tulip")||n.includes("violet")||n.includes("rose")||n.includes("bloom")||n.includes("lotus")||n.includes("puff")?i=e.flower:n.includes("mushroom")||n.includes("mush")?i=e.mushroom:n.includes("tree")||n.includes("willow")||n.includes("palm")||n.includes("bush")?i=e.tree:n.includes("cloud")||n.includes("orb")||n.includes("geyser")||n.includes("moon")?i=e.cloud||e.global:i=e.global,xu[t]=i}return i[s]||16777215}function WN(o){return Math.ceil(o/2)}function $N(o,t){return o%t===0}function HN(o,t,e){const s=Math.min(10,e),i=Math.max(t,s);return(o+i)%e}const wu=new jp,B5=new gt,bu=new Ln;function qN(o,t="global"){return ON(o,t,as.noteColorMap)}class YN{constructor(t,e={}){this.scene=t,this.config=e,this.updateStartIndex=0,this._lastCameraVersion=-1}getUpdateStartIndex(){return this.updateStartIndex}reactObject(t,e,s){if(!t.userData.type)return;const i=t.userData.type;if(typeof t.reactToNote=="function"){const n=qN(e,i);t.reactToNote(e,n,s)}if(t.userData.type==="pulsar"){const n=1+s*.5;t.scale.setScalar(n),t.children[1]&&(t.children[1].material.opacity=.3+s*.7)}else if(t.userData.type==="planet"){const n=1+s*.1;t.scale.setScalar(n),t.children[1]&&(t.children[1].rotation.z+=s*.1)}else t.userData.type==="galaxy"&&(t.rotation.y-=t.userData.baseRotationSpeed+s*.02)}isObjectActive(t){return t.visible}update(t,e,s,i,n,r,a,c){if(e&&e.channelData&&r&&c){for(const j of e.channelData)if(j.trigger>.5&&j.instrument===2){Ep(c);break}}const l=s&&typeof s.getGlobalLightLevel=="function"?s.currentLightLevel:1,u=n.matrixWorldAutoUpdate?n.matrixWorld.elements[0]:this._lastCameraVersion;u!==this._lastCameraVersion&&(B5.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),wu.setFromProjectionMatrix(B5),this._lastCameraVersion=u);const p=n.position,h=p.x,d=p.y,g=p.z,f=300,m=f*f,x=2,w=typeof performance<"u"?performance.now():Date.now();let b=0;const v=300,T=30,M=e&&e.channelData?e.channelData:null,F=M?M.length:0,N=WN(F),A=i.length,E=this.updateStartIndex;let U=0;for(let j=0;j<A;j++){const ut=(E+j)%A,nt=i[ut],Ue=nt.position.x-h,_e=nt.position.y-d,It=nt.position.z-g;if(Ue*Ue+_e*_e+It*It>m)continue;let _t=!1;if(nt.geometry&&nt.geometry.boundingSphere?_t=wu.intersectsObject(nt):(bu.center.copy(nt.position),bu.radius=nt.userData.radius||5,_t=wu.intersectsSphere(bu)),!_t)continue;if($N(U,T)&&typeof performance<"u"&&performance.now()-w>x||b>=v)break;if(U++,nt.userData.animationType==="wobble"&&(nt.userData.animationOffset+=.05),fN(nt,t,e,!r,a),b++,M){const{lightFactor:Bt,shouldReact:Ae}=kN(nt,l);if(Ae){const Se=VN(nt,F,N);if(Se<F){const Qe=M[Se];Qe&&Qe.trigger>.1&&this.reactObject(nt,Qe.note,Qe.trigger*Bt)}}}}let $=0;e&&($=e.kickTrigger||0);const Z=e&&e.beatPhase?e.beatPhase:0;Gd.flush(t+Z,$),this.updateStartIndex=HN(E,U,A),typeof window<"u"&&window.updatePerfStats&&window.updatePerfStats(A,U,b)}applyReaction(t,e,s){this.reactObject(t,e,s)}}const XN=44100,ZN=(o,t,e)=>o+(t-o)*e,vu=(o,t,e,s)=>ZN(o,t,1-Math.exp(-e*s)),jN=o=>{if(!o)return 0;const t=o.toUpperCase(),e={C:0,"C#":1,DB:1,D:2,"D#":3,EB:3,E:4,F:5,"F#":6,GB:6,G:7,"G#":8,AB:8,A:9,"A#":10,BB:10,B:11},s=t.match(/^([A-G](?:#|B)?)\-?(\d)$/);if(!s)return 0;const i=e[s[1]]??0,n=(parseInt(s[2],10)+1)*12+i;return 440*Math.pow(2,(n-69)/12)};class KN{constructor(){this.libopenmpt=null,this.currentModulePtr=0,this.audioContext=null,this.scriptNode=null,this.stereoPanner=null,this.gainNode=null,this.leftBufferPtr=0,this.rightBufferPtr=0,this.moduleInfo={title:"...",order:0,row:0,bpm:0,numChannels:0},this.patternMatrices={},this.isPlaying=!1,this.isReady=!1,this.volume=1,this.previousVolume=1,this.isMuted=!1,this.playlist=[],this.currentIndex=-1,this.onPlaylistUpdate=null,this.onTrackChange=null,this.visualState={beatPhase:0,kickTrigger:0,grooveAmount:0,activeChannels:0,channelData:[],bpm:120,patternIndex:0,row:0},this.init()}async init(){window.setLoadingStatus&&window.setLoadingStatus("Starting Audio System...");try{const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t;const s=window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+"js/audio-processor.js";console.log(`[AudioSystem] Attempting to load Worklet from: ${s}`);try{const i=await fetch(s,{cache:"no-store"});if(!i.ok)throw console.error(`[AudioSystem] Worklet fetch failed with status=${i.status} for ${s}`),new Error(`Worklet fetch failed: ${i.status}`);const n=i.headers.get("content-type")||"";let r=await i.text();const a=r.trim().startsWith("<");if(r.trim().length<20||a){console.warn(`[AudioSystem] Worklet content at ${s} looks suspicious (length=${r.length}, looksLikeHTML=${a}). Trying root '/js/audio-processor.js' as a fallback.`);try{const u=await fetch("/js/audio-processor.js",{cache:"no-store"});if(u.ok){const p=u.headers.get("content-type")||"",h=await u.text();h.trim().length>20&&(/javascript|ecmascript|module/.test(p)||/\b(import|registerProcessor|class)\b/.test(h.slice(0,200)))?(console.log("[AudioSystem] Fallback /js/audio-processor.js looks like valid JS. Using it."),r=h):console.warn("[AudioSystem] Fallback /js/audio-processor.js did not contain valid JS.")}else console.warn(`[AudioSystem] Fallback fetch failed with status=${u.status}`)}catch(u){console.warn("[AudioSystem] Fallback fetch for /js/audio-processor.js failed",u)}if(r.trim().length<20||r.trim().startsWith("<"))throw console.error(`[AudioSystem] Worklet content is invalid after fallback. First chars: ${r.slice(0,160)}`),new Error("Worklet content invalid or HTML fallback")}!/javascript|ecmascript|module/.test(n)&&!/\b(import|registerProcessor|class)\b/.test(r.slice(0,200))&&console.warn(`[AudioSystem] Worklet content-type="${n}" and file does not look like JS. First chars: ${r.slice(0,120)}`);let c=r;try{const u=p=>{if(/^[a-zA-Z][a-zA-Z0-9+-.]*:\/\//.test(p)||p.startsWith("//")||!p.startsWith(".")&&!p.startsWith("/"))return p;try{return new URL(p,s).href}catch{return p}};c=c.replace(/(from\s+)(['"])([^'"\n]+)\2/g,(p,h,d,g)=>{const f=u(g);return`${h}${d}${f}${d}`}),c=c.replace(/(import\s+)(['"])([^'"\n]+)\2/g,(p,h,d,g)=>{const f=u(g);return`${h}${d}${f}${d}`}),c=c.replace(/(import\()(['"])([^'"\n]+)\2(\))/g,(p,h,d,g,f)=>{const m=u(g);return`${h}${d}${m}${d}${f}`}),c!==r&&console.log("[AudioSystem] Rewrote import specifiers in worklet to absolute URLs to avoid blob-relative resolution issues.")}catch(u){console.warn("[AudioSystem] Failed to rewrite import specifiers, proceeding with original text",u)}const l=URL.createObjectURL(new Blob([c],{type:"application/javascript"}));try{await this.audioContext.audioWorklet.addModule(l),window.setLoadingStatus&&window.setLoadingStatus("Audio Worklet Ready..."),URL.revokeObjectURL(l)}catch(u){throw console.error(`[AudioSystem] addModule failed for blob derived from ${s}`),u}}catch(i){throw console.error(`[AudioSystem] Failed to load worklet at ${s}. Check the Network tab in DevTools for 404s or HTML responses.`),i}this.workletNode=new AudioWorkletNode(this.audioContext,"chiptune-processor"),this.workletNode.port.onmessage=i=>{const{type:n,data:r}=i.data||{};n==="VISUAL_UPDATE"?this.handleVisualUpdate(r):n==="SONG_END"?(console.log("AudioSystem: Song finished (Worklet)."),this.playNext()):n==="READY"&&(this.isReady=!0,console.log("AudioSystem: Worklet Ready."),this.playlist.length>0&&this.currentIndex===-1&&this.playNext(0))},this.gainNode=this.audioContext.createGain(),this.gainNode.gain.value=this.volume,this.workletNode.connect(this.gainNode),this.gainNode.connect(this.audioContext.destination)}catch(t){console.error("AudioSystem Init Failed:",t)}}setVolume(t){if(this.volume=Math.max(0,Math.min(1,t)),this.gainNode){const e=this.audioContext?this.audioContext.currentTime:0;try{this.gainNode.gain.setTargetAtTime(this.volume,e,.1)}catch{this.gainNode.gain.value=this.volume}}}toggleMute(){return this.isMuted?(this.setVolume(this.previousVolume),this.isMuted=!1):(this.previousVolume=this.volume>0?this.volume:1,this.setVolume(0),this.isMuted=!0),this.isMuted}async addToQueue(t){if(!this.isReady)return;const e=this.playlist.length;for(let s=0;s<t.length;s++)this.playlist.push(t[s]),console.log(`Added to queue: ${t[s].name}`);this.onPlaylistUpdate&&this.onPlaylistUpdate(this.playlist),(this.currentIndex===-1||!this.isPlaying)&&this.playNext(e)}async playNext(t=null){if(this.playlist.length===0)return;let e=t!==null?t:this.currentIndex+1;e>=this.playlist.length&&(console.log("Playlist finished. Looping to start."),e=0),this.currentIndex=e,this.onTrackChange&&this.onTrackChange(this.currentIndex);const s=this.playlist[this.currentIndex];console.log(`Loading track ${this.currentIndex+1}/${this.playlist.length}: ${s.name}`),await this.loadModule(s)}playAtIndex(t){t>=0&&t<this.playlist.length&&this.playNext(t)}getPlaylist(){return this.playlist}getCurrentIndex(){return this.currentIndex}async loadModule(t){this.audioContext&&this.audioContext.state==="suspended"&&await this.audioContext.resume();try{const e=await t.arrayBuffer();if(this.workletNode&&this.workletNode.port)try{this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name},[e])}catch{this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name})}else console.warn("Worklet not ready to receive LOAD message. Attempting to init worklet and retry."),await this.init(),this.workletNode&&this.workletNode.port&&this.workletNode.port.postMessage({type:"LOAD",fileData:e,fileName:t.name},[e]);await this.play()}catch(e){console.error("Error loading file:",e),this.playNext()}}processModuleData(t,e){if(this.libopenmpt){this.stop(!1),this.currentModulePtr!==0&&(this.libopenmpt._openmpt_module_destroy(this.currentModulePtr),this.currentModulePtr=0);try{const s=this.libopenmpt,i=s._malloc(t.length);s.HEAPU8.set(t,i);const n=s._openmpt_module_create_from_memory2(i,t.length,0,0,0,0,0,0,0);if(s._free(i),n===0)throw new Error(`Failed to load module "${e}".`);this.currentModulePtr=n;const r=s.stringToUTF8("title"),a=s._openmpt_module_get_metadata(n,r),c=s.UTF8ToString(a)||e;s._free(r),s._openmpt_free_string(a),this.moduleInfo.title=c,this.preCachePatternData(n),this.play()}catch(s){console.error("Failed to load module:",s),this.playNext()}}}preCachePatternData(t){const e=this.libopenmpt;this.patternMatrices={};try{const s=e._openmpt_module_get_num_orders(t),i=e._openmpt_module_get_num_channels(t);this.moduleInfo.numChannels=i;for(let n=0;n<s;n++){const r=e._openmpt_module_get_order_pattern(t,n);if(r>=e._openmpt_module_get_num_patterns(t))continue;const a=e._openmpt_module_get_pattern_num_rows(t,r),c=[];for(let l=0;l<a;l++){const u=[];for(let p=0;p<i;p++){const h=e._openmpt_module_format_pattern_row_channel(t,r,l,p,12,1),d=e.UTF8ToString(h);e._openmpt_free_string(h),u.push({text:(d||"").trim()})}c.push(u)}this.patternMatrices[n]={rows:c,numRows:a,numChannels:i}}}catch(s){console.error("Pattern caching error:",s)}}async play(){if(!this.isPlaying){if(!this.audioContext){const t=window.AudioContext||window.webkitAudioContext;this.audioContext=new t({sampleRate:XN})}if(this.audioContext.state==="suspended"&&await this.audioContext.resume(),!this.workletNode)try{await this.init()}catch(t){console.warn("Worklet init failed in play()",t)}this.isPlaying=!0}}stop(t=!0){try{this.workletNode&&this.workletNode.port&&this.workletNode.port.postMessage({type:"STOP"})}catch(e){console.warn("Failed to signal STOP to worklet",e)}try{if(this.workletNode){try{this.workletNode.disconnect()}catch{}this.workletNode=null}if(this.gainNode){try{this.gainNode.disconnect()}catch{}this.gainNode=null}}catch(e){console.warn("Error disconnecting audio nodes:",e)}if(this.libopenmpt)try{this.leftBufferPtr&&(this.libopenmpt._free(this.leftBufferPtr),this.leftBufferPtr=0),this.rightBufferPtr&&(this.libopenmpt._free(this.rightBufferPtr),this.rightBufferPtr=0)}catch{}this.isPlaying=!1}handleVisualUpdate(t){const{bpm:e,channelData:s,anyTrigger:i,order:n,row:r}=t;for(this.visualState.bpm=e||120,n!==void 0&&(this.visualState.patternIndex=n),r!==void 0&&(this.visualState.row=r),i&&(this.visualState.kickTrigger=1);this.visualState.channelData.length<s.length;)this.visualState.channelData.push({volume:0,pan:0,trigger:0,note:"",freq:0,instrument:0,activeEffect:0,effectValue:0});for(let a=0;a<s.length;a++){const c=s[a],l=this.visualState.channelData[a];l.volume=c.volume,c.note&&(l.trigger=1,l.note=c.note,l.freq=jN(c.note)),l.instrument=c.instrument,l.activeEffect=c.activeEffect,l.effectValue=c.effectValue}}update(){this.visualState.kickTrigger=vu(this.visualState.kickTrigger,0,8,1/60),this.visualState.grooveAmount=vu(this.visualState.grooveAmount,0,3,1/60),this.visualState.beatPhase=(this.visualState.beatPhase+this.visualState.bpm/60*(1/60))%1;for(const t of this.visualState.channelData)t.trigger=vu(t.trigger,0,10,1/60);return this.visualState}}class JN{constructor(t){this.audio=t,this.lastBeatPhase=0,this.beatCallbacks=[]}onBeat(t){typeof t=="function"&&this.beatCallbacks.push(t)}offBeat(t){const e=this.beatCallbacks.indexOf(t);e>=0&&this.beatCallbacks.splice(e,1)}update(){const t=this.audio.visualState||this.audio.update&&this.audio.update()||{beatPhase:0},e=t&&t.beatPhase?t.beatPhase:0;if(e<this.lastBeatPhase&&this.lastBeatPhase>.8)for(const s of this.beatCallbacks)try{s(t)}catch(i){console.warn("BeatSync callback error",i)}this.lastBeatPhase=e}getState(){return this.audio.visualState}}const Pp=Ct(0);function QN(){const e=new r0(80,90,64,1,0,Math.PI),s=new ds;s.transparent=!0,s.side=Kt,s.depthWrite=!1,s.blending=Jt;const i=ot(16711680),n=ot(16753920),r=ot(16776960),a=ot(32768),c=ot(255),l=ot(4915330),u=ot(15631086),p=ti().y;let h=de(i,n,Pt(0,.16,p));h=de(h,r,Pt(.16,.33,p)),h=de(h,a,Pt(.33,.5,p)),h=de(h,c,Pt(.5,.66,p)),h=de(h,l,Pt(.66,.83,p)),h=de(h,u,Pt(.83,1,p));const d=Pt(0,.2,p).mul(Pt(1,.8,p)),g=Pt(0,.1,ti().x).mul(Pt(1,.9,ti().x)),f=At(Ge.mul(2)).mul(.1).add(.9);s.colorNode=h,s.opacityNode=Pp.mul(d).mul(g).mul(f),s.emissiveNode=h.mul(.5);const m=new V(e,s);return m.name="Rainbow",m}const ai={skyTop:new W,skyBot:new W,horizon:new W,fog:new W,sun:new W,amb:new W,sunInt:0,ambInt:0,atmosphereIntensity:0};function xc(o,t,e){return ai.skyTop.copy(o.skyTop).lerp(t.skyTop,e),ai.skyBot.copy(o.skyBot).lerp(t.skyBot,e),ai.horizon.copy(o.horizon).lerp(t.horizon,e),ai.fog.copy(o.fog).lerp(t.fog,e),ai.sun.copy(o.sun).lerp(t.sun,e),ai.amb.copy(o.amb).lerp(t.amb,e),ai.sunInt=Gt.lerp(o.sunInt,t.sunInt,e),ai.ambInt=Gt.lerp(o.ambInt,t.ambInt,e),ai.atmosphereIntensity=Gt.lerp(o.atmosphereIntensity,t.atmosphereIntensity,e),ai}function tC(o,t="standard"){const e=o%Js;let s=Xe.day,i=Xe.sunset,n=Xe.night,r=Xe.sunrise;if(t==="neon"?(s=Xe.neon,i=Xe.sunset,n=Xe.neon,r=Xe.neon):t==="glitch"&&(s=Xe.glitch,i=Xe.glitch,n=Xe.glitch,r=Xe.glitch),e<ei)return xc(n,r,e/ei);let a=ei;if(e<a+_o){const c=e-a;return c<60?xc(r,s,c/60):s}if(a+=_o,e<a+Yi){const c=e-a;return xc(s,i,c/Yi)}if(a+=Yi,e<a+ll){const c=e-a;return c<60?xc(i,n,c/60):n}return a+=ll,e<a+ul||(a+=ul,e<a+Vd),n}function Zd(o){const t=o%Js,e=ei,s=ei+_o,i=s+Yi;let n=0,r=0;if(t>=e&&t<=s)n=1,r=0;else if(t<e)n=t/ei,r=1-n;else if(t>s&&t<i){const a=(t-s)/Yi;n=1-a,r=a}else n=0,r=1;return{sunIntensity:n,moonIntensity:r}}const P5=Js*40,I5=Js*8;function eC(o){const t=o%P5/P5;let e="Spring";t>.75?e="Winter":t>.5?e="Autumn":t>.25&&(e="Summer");const s=Math.sin(t*Math.PI*2-Math.PI/2)*.5+.5,i=o%I5/I5,n=1-Math.abs(i-.5)*2;return{season:e,sunInclination:s,moonPhase:n,yearProgress:t}}function sC(o={}){const{scale:t=1,depth:e=20,width:s=8,height:i=6}=o,n=new K;n.userData.type="cave",n.userData.isBlocked=!1;const r=new xi({color:4868682,roughness:.9,flatShading:!0,side:Kt}),a=new I4([new S(0,0,0),new S(0,-2,-e*.3),new S(4,-4,-e*.6),new S(10,-6,-e)]),c=new Tl(a,12,s/2,8,!1),l=c.attributes.position;for(let g=0;g<l.count;g++){const f=l.getX(g),m=l.getY(g),x=l.getZ(g);l.setX(g,f+(Math.random()-.5)*.5),l.setY(g,m+(Math.random()-.5)*.5),l.setZ(g,x+(Math.random()-.5)*.5)}c.computeVertexNormals();const u=new V(c,r);u.castShadow=!0,u.receiveShadow=!0,n.add(u);const p=new S(0,i*.7,-2),h=new S(0,-1,-2),d=Ud(p,h,s*.7);return d.visible=!1,d.name="WaterGate",n.add(d),n.userData.waterfall=d,n.userData.gatePosition=new S(0,0,-2),n.scale.setScalar(t),n}function iC(o,t){const e=o.userData.waterfall,s=.2;if(t>s){e.visible||(e.visible=!0);const i=(t-s)/(1-s);e.scale.set(1,1,.5+i*.5),o.userData.isBlocked=i>.1}else e.visible&&(e.visible=!1),o.userData.isBlocked=!1;e.visible&&e.onAnimate&&e.onAnimate(.016,Date.now()/1e3)}class nC{constructor(){this.percussionRain=null,this.melodicMist=null}init(t){this.initRain(t),this.initMist(t)}initRain(t){const s=new zt,i=new Float32Array(500*3),n=new Float32Array(500*3),r=new Float32Array(500),a=new Float32Array(500);for(let l=0;l<500;l++)i[l*3]=(Math.random()-.5)*100,i[l*3+1]=20+Math.random()*30,i[l*3+2]=(Math.random()-.5)*100,n[l*3]=0,n[l*3+1]=1,n[l*3+2]=0,r[l]=5+Math.random()*5,a[l]=Math.random()*50;s.setAttribute("position",new it(i,3)),s.setAttribute("normal",new it(n,3)),s.userData={velocities:r,offsets:a};const c=new xo({color:8965375,size:.3,transparent:!0,opacity:.8,blending:Jt});this.percussionRain=new Zi(s,c),this.percussionRain.visible=!1,t.add(this.percussionRain)}initMist(t){const s=new zt,i=new Float32Array(300*3),n=new Float32Array(300*3),r=new Float32Array(300);for(let c=0;c<300;c++)i[c*3]=(Math.random()-.5)*80,i[c*3+1]=Math.random()*5,i[c*3+2]=(Math.random()-.5)*80,n[c*3]=0,n[c*3+1]=1,n[c*3+2]=0,r[c]=c*.1;s.setAttribute("position",new it(i,3)),s.setAttribute("normal",new it(n,3)),s.userData={offsets:r};const a=new xo({color:11206570,size:.15,transparent:!0,opacity:.4,blending:Jt});this.melodicMist=new Zi(s,a),this.melodicMist.visible=!1,t.add(this.melodicMist)}update(t,e,s,i,n,r){this.updatePercussionRain(t,e,i,n,r),this.updateMelodicMist(t,s,i,n)}updatePercussionRain(t,e,s,i,n){if(!this.percussionRain)return;const r=e>.2||s!=="clear";if(this.percussionRain.visible=r,!r)return;const a=this.percussionRain.geometry.attributes.position.array,c=this.percussionRain.geometry.userData.velocities,l=this.percussionRain.geometry.userData.offsets;this.percussionRain.material.size=.3+e*.5,this.percussionRain.material.opacity=.4+n*.6,i==="mist"?this.percussionRain.material.color.setHex(14742783):i==="drizzle"?this.percussionRain.material.color.setHex(10139080):i==="thunderstorm"||s==="storm"?this.percussionRain.material.color.setHex(6328496):this.percussionRain.material.color.setHex(8965375);for(let u=0;u<a.length/3;u++){const p=50+l[u],h=c[u]*(1+e),d=iN(p,t,h,50);a[u*3+1]=d,d<0&&(a[u*3]=(Math.random()-.5)*100,a[u*3+2]=(Math.random()-.5)*100)}this.percussionRain.geometry.attributes.position.needsUpdate=!0}updateMelodicMist(t,e,s,i){if(!this.melodicMist)return;const n=e>.2||i==="mist"&&s==="rain";if(this.melodicMist.visible=n,!n)return;const r=this.melodicMist.geometry.attributes.position.array;for(let a=0;a<r.length/3;a++){const c=a*.1;r[a*3+1]=1+Math.sin(t+c)*2*Math.max(e,.3),r[a*3]+=Math.sin(t*.5+c)*.01,r[a*3+2]+=Math.cos(t*.4+c)*.01}this.melodicMist.material.opacity=.3+e*.4,i==="mist"?(this.melodicMist.material.color.setHex(14548957),this.melodicMist.material.opacity=.6):this.melodicMist.material.color.setHex(11206570),this.melodicMist.geometry.attributes.position.needsUpdate=!0}dispose(t){this.percussionRain&&(t.remove(this.percussionRain),this.percussionRain.geometry.dispose(),this.percussionRain.material.dispose()),this.melodicMist&&(t.remove(this.melodicMist),this.melodicMist.geometry.dispose(),this.melodicMist.material.dispose())}}class oC extends nC{constructor(){super(),this.wasmUpdateRainBatch=null,this.wasmUpdateMistBatch=null}update(t,e,s,i,n,r){if(!kd()){super.update(t,e,s,i,n,r);return}const a=pr();!this.wasmUpdateRainBatch&&a.exports.updateRainBatch&&(this.wasmUpdateRainBatch=a.exports.updateRainBatch,this.wasmUpdateMistBatch=a.exports.updateMelodicMistBatch),this.wasmUpdateRainBatch?this.updateRainWasm(a,t,e,i,n,r):super.updatePercussionRain(t,e,i,n,r),this.wasmUpdateMistBatch?this.updateMistWasm(a,t,s,i,n):super.updateMelodicMist(t,s,i,n)}updateRainWasm(t,e,s,i,n,r){if(!this.percussionRain)return;const a=s>.2||i!=="clear";if(this.percussionRain.visible=a,!a)return;this.percussionRain.material.size=.3+s*.5,this.percussionRain.material.opacity=.4+r*.6,n==="mist"?this.percussionRain.material.color.setHex(14742783):n==="drizzle"?this.percussionRain.material.color.setHex(10139080):n==="thunderstorm"||i==="storm"?this.percussionRain.material.color.setHex(6328496):this.percussionRain.material.color.setHex(8965375);const c=this.percussionRain.geometry.attributes.position,l=this.percussionRain.geometry.userData.velocities,u=this.percussionRain.geometry.userData.offsets,p=c.count;if(!this.rainPtr){const g=p*5*4;this.rainPtr=t.exports.__new(g,0),this.rainPosPtr=this.rainPtr,this.rainVelPtr=this.rainPtr+p*3*4,this.rainOffPtr=this.rainPtr+p*4*4;const f=new Float32Array(t.exports.memory.buffer),m=this.rainPosPtr/4,x=this.rainVelPtr/4,w=this.rainOffPtr/4;f.set(c.array,m),f.set(l,x),f.set(u,w),this.rainCount=p}this.wasmUpdateRainBatch(this.rainPosPtr,this.rainVelPtr,this.rainOffPtr,p,e,s);const h=new Float32Array(t.exports.memory.buffer),d=this.rainPosPtr/4;c.array.set(h.subarray(d,d+p*3)),c.needsUpdate=!0}updateMistWasm(t,e,s,i,n){if(!this.melodicMist)return;const r=s>.2||n==="mist"&&i==="rain";if(this.melodicMist.visible=r,!r)return;this.melodicMist.material.opacity=.3+s*.4,n==="mist"?(this.melodicMist.material.color.setHex(14548957),this.melodicMist.material.opacity=.6):this.melodicMist.material.color.setHex(11206570);const a=this.melodicMist.geometry.attributes.position,c=a.count;if(!this.mistPtr){const p=c*3*4;this.mistPtr=t.exports.__new(p,0),new Float32Array(t.exports.memory.buffer).set(a.array,this.mistPtr/4),this.mistCount=c}this.wasmUpdateMistBatch(this.mistPtr,c,e,s);const l=new Float32Array(t.exports.memory.buffer),u=this.mistPtr/4;a.array.set(l.subarray(u,u+c*3)),a.needsUpdate=!0}}const ho=[],jd=[],dl=[],Kd=[],Ps=[],gl=[],Jd=new K,Qd=new K;Jd.add(Qd);let Cr=null,tg=0;function eg(o){Cr=o}function rC(o){tg=o}const bt={CLEAR:"clear",RAIN:"rain",STORM:"storm"},aC=new S(0,1,0),L5=new S,U5=new S,z5=new S,cC=new W(0);class lC{constructor(t){this.scene=t,this.state=bt.CLEAR,this.intensity=0,this.stormCharge=0,this.cloudDensity=1,this.cloudRegenRate=5e-4,this.groundWaterLevel=0,this.trackedCaves=[],this.particles=new oC,this.mushroomWaterfalls=new Map,this.lightningLight=null,this.lightningTimer=0,this.lightningActive=!1,this.rainbow=null,this.rainbowTimer=0,this.lastState=bt.CLEAR,this.trackedTrees=[],this.trackedShrubs=[],this.trackedFlowers=[],this.trackedMushrooms=[],this.targetIntensity=0,this.transitionSpeed=.02,this.windDirection=new S(1,0,.3).normalize(),this.windSpeed=0,this.windTargetSpeed=0,this.onSpawnFoliage=null,this._lastSpawnCheck=0,this._spawnCapPerFrame=3,this._spawnThrottle=.5,this._spawnQueue=[],this.fog=t.fog,this.baseFogNear=t.fog?t.fog.near:20,this.baseFogFar=t.fog?t.fog.far:100,this._claimedMushroomsScratch=new Set,this.initParticles(),this.initLightning(),this.initRainbow()}initRainbow(){this.rainbow=QN(),this.rainbow.position.set(0,-20,-100),this.rainbow.scale.setScalar(2),this.scene.add(this.rainbow)}initParticles(){this.particles.init(this.scene)}registerMushroom(t){t&&(this.trackedMushrooms.includes(t)||this.trackedMushrooms.push(t))}registerCave(t){this.trackedCaves.includes(t)||this.trackedCaves.push(t)}initLightning(){this.lightningLight=new zn(16777215,0,200),this.lightningLight.position.set(0,50,0),this.scene.add(this.lightningLight)}registerTree(t){this.trackedTrees.push(t)}registerShrub(t){this.trackedShrubs.push(t)}registerFlower(t){this.trackedFlowers.push(t)}notifyCloudShot(t){this.cloudDensity=Math.max(.2,this.cloudDensity-.05)}getGlobalLightLevel(t,e){const s=t.sunIntensity*(e?e.sunInclination:1),i=t.moonIntensity*(e?e.moonPhase:1)*.25,n=.05,r=this.cloudDensity,a=(s+i+n)*(1-r*.8);return Math.min(1,a)}updateEcosystem(t){if(!Ps||Ps.length===0||this.trackedMushrooms.length===0)return;const e=this._claimedMushroomsScratch;e.clear(),Ps.forEach(s=>{s.userData.targetMushroom&&e.add(s.userData.targetMushroom.uuid)}),Ps.forEach(s=>{if(s.userData.isFalling){s.userData.targetMushroom=null;return}if(!s.userData.targetMushroom){let i=1e3,n=null;for(const r of this.trackedMushrooms){if(e.has(r.uuid))continue;const a=s.position.distanceTo(r.position);a<50&&a<i&&(i=a,n=r)}n&&(s.userData.targetMushroom=n,e.add(n.uuid))}if(s.userData.targetMushroom){const i=s.userData.targetMushroom;if(!i.parent){s.userData.targetMushroom=null;return}RA(s,i.position,t),EA(s,i.position)&&(i.userData.wetness||(i.userData.wetness=0),i.userData.wetness+=t*1.5,i.userData.wetness>3&&i.userData.size!=="giant"&&this.transformMushroom(i))}})}transformMushroom(t){const e=this.trackedMushrooms.indexOf(t);if(e===-1)return;const s=gA(this.scene,t);s&&(this.trackedMushrooms[e]=s,Ps.forEach(i=>{i.userData.targetMushroom===t&&(i.userData.targetMushroom=s,i.position.y=Math.max(i.position.y,s.position.y+25))}))}update(t,e,s=null){if(!e)return;const i=.016;this.cloudDensity=Math.min(1,this.cloudDensity+this.cloudRegenRate),this.updateEcosystem(i);const n=e.kickTrigger||0,r=e.grooveAmount||0,a=e.channelData||[],c=a[2]?.volume||0,l=Zd(t),u=eC(t);this.currentSeason=u.season;const p=e.patternIndex||0;if(p!==this.lastPatternIndex&&(this.lastPatternIndex=p),this.updateWeatherState(n,c,r,s,u),this.state===bt.RAIN?this.groundWaterLevel=Math.min(1,this.groundWaterLevel+5e-4):this.state===bt.STORM?this.groundWaterLevel=Math.min(1,this.groundWaterLevel+.0015):this.groundWaterLevel=Math.max(0,this.groundWaterLevel-3e-4),this.trackedCaves.length>0&&this.trackedCaves.forEach(F=>{iC(F,this.groundWaterLevel)}),this.lastState===bt.STORM&&this.state!==bt.STORM&&(this.rainbowTimer=45),this.lastState=this.state,this.rainbowTimer>0){this.rainbowTimer-=i;let F=1;this.rainbowTimer>40?F=(45-this.rainbowTimer)/5:this.rainbowTimer<5&&(F=this.rainbowTimer/5),Pp.value=F*.6}else Pp.value=0;this.currentLightLevel=this.getGlobalLightLevel(l,u),this.targetIntensity*=this.cloudDensity;const h=a[3]?.volume||0,d=(c*.5+h*.5)*this.cloudDensity;try{Ic&&(Ic.value+=(d-Ic.value)*.05)}catch{}if(this.state===bt.STORM&&(n>.8||Math.random()<.01)){try{xa&&(xa.value=1)}catch{}const F=Object.keys(as.noteColorMap&&as.noteColorMap.cloud||{});if(F.length>0){const N=F[Math.floor(Math.random()*F.length)],A=as.noteColorMap.cloud[N];try{wa&&wa.value&&wa.value.setHex&&wa.value.setHex(A)}catch{}this.lightningLight.color.setHex(A),this.lightningLight.intensity=10*this.cloudDensity,this.lightningLight.position.set((Math.random()-.5)*100,50,(Math.random()-.5)*100),this.lightningActive=!0}}else{try{xa&&(xa.value*=.85)}catch{}this.lightningActive&&(this.lightningLight.intensity*=.85,this.lightningLight.intensity<.1&&(this.lightningActive=!1))}this.applyDarknessLogic(l,u.moonPhase);const g=l.sunIntensity*(1-this.cloudDensity*.7),f=l.moonIntensity*.3,m=Math.max(0,g+f),x=this.intensity+this.stormCharge*.5;let w=m*(.5+x);x>.9&&(w*=.5);let b=(1-m)*(.2+x*1.5),v=(this.state===bt.STORM?1:0)+(1-m)*.2;this.particles.percussionRain&&this.particles.percussionRain.visible&&(this.trackedTrees.length>0&&fa(this.trackedTrees,w*n*.1),this.trackedFlowers.length>0&&fa(this.trackedFlowers,w*n*.1));let T=0;this.state===bt.RAIN||this.state===bt.STORM?T=.5+n*.5:m>.6&&this.cloudDensity<.5?T=-.5:T=-.05,this.trackedMushrooms.length>0&&fa(this.trackedMushrooms,T),this.handleSpawning(t,b,v,m),this.updateMushroomWaterfalls(t,n),this.intensity+=(this.targetIntensity-this.intensity)*this.transitionSpeed,this.particles.update(t,n,c,this.state,this.weatherType,this.intensity),this.state===bt.STORM&&(this.updateLightning(t,n),this.chargeBerryGlow(n)),this.state!==bt.CLEAR?this.stormCharge=Math.min(2,this.stormCharge+.001):this.stormCharge=Math.max(0,this.stormCharge-5e-4),this.updateWind(t,e,l),this.updateFog(e)}handleSpawning(t,e,s,i){t-this._lastSpawnCheck<this._spawnThrottle||(this._lastSpawnCheck=t,e>.8&&Math.random()<.4&&this.spawnFoliage("mushroom",!0),s>.6&&Math.random()<.3&&this.spawnFoliage("lantern",!1),i>.7&&e<.3&&Math.random()<.2&&this.spawnFoliage("flower",!1))}spawnFoliage(t,e){if(!this.onSpawnFoliage)return;const s=(Math.random()-.5)*60,i=(Math.random()-.5)*60,n=vo(s,i);let r;t==="mushroom"?r=An({size:"regular",scale:.5+Math.random()*.5,isBioluminescent:e}):t==="lantern"&&(r=xA({height:2+Math.random()*1.5,color:16755200})),r&&(r.position.set(s,n,i),r.scale.setScalar(.01),this.onSpawnFoliage(r,!0,0),t==="mushroom"&&this.registerMushroom(r),t==="lantern"&&this.registerFlower(r))}updateWind(t,e,s){const i=e.channelData||[],n=i[3]?.volume||0,r=i[2]?.volume||0;this.windTargetSpeed=Math.max(n,r*.5),this.windSpeed+=(this.windTargetSpeed-this.windSpeed)*.02;const a=(e.beatPhase||0)*.001;this.windDirection.applyAxisAngle(aC,a);const l=t%Js/Js*Math.PI*2;L5.set(Math.cos(l),Math.sin(l),0),U5.copy(L5).negate(),this.windDirection.lerp(U5,.1),this.windDirection.normalize();let u=0,p=0,h=0;if(this.trackedMushrooms.forEach(g=>{g.userData.size==="giant"&&(u+=g.position.x,p+=g.position.z,h++)}),h>0){const g=u/h,f=p/h;z5.set(g,0,f).normalize(),this.windDirection.lerp(z5,.05),this.windDirection.normalize()}const d=this.trackedMushrooms.length;if(this.windSpeed>.4&&d>0){const g=t;if(g-this._lastSpawnCheck>this._spawnThrottle)if(this._lastSpawnCheck=g,!kd()||typeof F5!="function"){let f=0;for(let m=0;m<this.trackedMushrooms.length&&f<this._spawnCapPerFrame;m++){const x=this.trackedMushrooms[m],w=x.userData?.colorIndex??-1,v=(w>=0&&w<=3?.02:.005)*this.windSpeed;if(Math.random()<v){const T=3+Math.random()*8,M=2+Math.random()*3,F=x.position.x+this.windDirection.x*T+(Math.random()-.5)*M,N=x.position.z+this.windDirection.z*T+(Math.random()-.5)*M,A=vo(F,N),E=An({size:"regular",scale:.7,colorIndex:w});if(E.position.set(F,A,N),E.rotation.y=Math.random()*Math.PI*2,this.onSpawnFoliage)try{this.onSpawnFoliage(E,!0,.5)}catch{}else this.scene.add(E),this.registerMushroom(E);f++}}}else try{QA(this.trackedMushrooms);const w=F5(t,this.windDirection.x,this.windDirection.z,this.windSpeed,d,1,3,8);if(w>0){const b=tN(w);let v=0;for(const T of b){if(v>=this._spawnCapPerFrame)break;const M=An({size:"regular",scale:.7,colorIndex:T.colorIndex});if(M.position.set(T.x,T.y,T.z),M.rotation.y=Math.random()*Math.PI*2,this.onSpawnFoliage)try{this.onSpawnFoliage(M,!0,.5)}catch{}else this.scene.add(M),this.registerMushroom(M);v++}}}catch(f){console.warn("WASM spawn path failed, falling back to JS:",f)}}}updateMushroomWaterfalls(t,e){const s=this.state!==bt.CLEAR&&this.intensity>.4;this.trackedMushrooms.forEach(i=>{if(i.userData.size==="giant"){const n=i.uuid;if(s){if(!this.mushroomWaterfalls.has(n)){const a=i.userData.capRadius||5,c=i.userData.capHeight||8,l=Ud(new S(i.position.x+a*.8,c*.8,i.position.z),new S(i.position.x+a*1.1,0,i.position.z),2);this.scene.add(l),this.mushroomWaterfalls.set(n,l)}const r=this.mushroomWaterfalls.get(n);r.onAnimate&&r.onAnimate(.016,t),e>.5&&r.scale.setScalar(1+e*.1)}else if(this.mushroomWaterfalls.has(n)){const r=this.mushroomWaterfalls.get(n);this.scene.remove(r),this.mushroomWaterfalls.delete(n)}}})}applyDarknessLogic(t,e){const s=t.moonIntensity,i=this.cloudDensity,n=1-(e||0)*.5,r=s*i*n*.95;this.scene.fog&&this.scene.fog.color&&this.scene.fog.color.lerp(cC,r),yh.value=r,this.darknessFactor=r}updateFog(t){if(!this.fog)return;let e=1;switch(this.state){case bt.RAIN:e=.8;break;case bt.STORM:e=.6;break;default:e=1}let s=0;t&&(s=(t.average||0)*.3);const i=1-this.intensity*(1-e),n=1-(this.darknessFactor||0)*.7,r=1-s,a=i*n*r,c=this.baseFogNear*a,l=this.baseFogFar*a;this.fog.near+=(c-this.fog.near)*.05,this.fog.far+=(l-this.fog.far)*.05}updateBerrySeasonalSize(t,e){let l="day",u=0;t<60?(l="sunrise",u=t/60):t<480?(l="day",u=(t-60)/420):t<540?(l="sunset",u=(t-60-420)/60):t<720?(l="dusk",u=(t-60-420-60)/180):t<840?(l="deepNight",u=(t-60-420-60-180)/120):(l="preDawn",u=(t-60-420-60-180-120)/120),this.trackedTrees.forEach(p=>{p.userData.berries&&_5(p.userData.berries,l,u)}),this.trackedShrubs.forEach(p=>{p.userData.berries&&_5(p.userData.berries,l,u)})}updateWeatherState(t,e,s,i=null,n=null){let r=bt.CLEAR,a=0;if(t>.7&&s>.5?(r=bt.STORM,a=1):(t>.3||e>.4)&&(r=bt.RAIN,a=.5),n){const c=Math.random();n.season==="Winter"&&r===bt.STORM&&c>.3&&(r=bt.RAIN),n.season==="Summer"&&r===bt.RAIN&&c>.7&&(r=bt.STORM),n.season==="Spring"&&r===bt.CLEAR&&c>.9&&(r=bt.RAIN,a=.3)}if(i){let l=bt.CLEAR;i.biasState==="storm"?l=bt.STORM:i.biasState==="rain"&&(l=bt.RAIN),r!==l?Math.random()<.4?(this.state=l,this.targetIntensity=i.biasIntensity):(this.state=r,this.targetIntensity=a):(this.state=r,this.targetIntensity=a*(1-.4)+i.biasIntensity*.4),this.weatherType=i.type||"default"}else this.state=r,this.targetIntensity=a,this.weatherType="audio"}updateLightning(t,e){this.lightningTimer-=.016,e>.8&&this.lightningTimer<=0&&Math.random()>.7&&(this.lightningActive=!0,this.lightningTimer=.5+Math.random()*1,this.lightningLight.intensity=5+Math.random()*5,this.lightningLight.position.set((Math.random()-.5)*60,40+Math.random()*20,(Math.random()-.5)*60)),this.lightningActive&&(this.lightningLight.intensity*=.85,this.lightningLight.intensity<.1&&(this.lightningActive=!1,this.lightningLight.intensity=0))}chargeBerryGlow(t){const e=t*.05;this.trackedTrees.forEach(s=>{s.userData.berries&&v5(s.userData.berries,e)}),this.trackedShrubs.forEach(s=>{s.userData.berries&&v5(s.userData.berries,e)}),t>.6&&(this.trackedTrees.forEach(s=>{s.userData.berries&&S5(s.userData.berries,t)}),this.trackedShrubs.forEach(s=>{s.userData.berries&&S5(s.userData.berries,t)}))}growPlants(t){fa(this.trackedTrees,t),fa(this.trackedMushrooms,t)}bloomFlora(t){pN(this.trackedFlowers,t)}getState(){return this.state}getStormCharge(){return this.stormCharge}getIntensity(){return this.intensity}forceState(t){switch(this.state=t,t){case bt.STORM:this.targetIntensity=1;break;case bt.RAIN:this.targetIntensity=.5;break;default:this.targetIntensity=0}}dispose(){this.particles&&this.particles.dispose(this.scene),this.lightningLight&&this.scene.remove(this.lightningLight),this.rainbow&&(this.scene.remove(this.rainbow),this.rainbow.geometry.dispose()),this.mushroomWaterfalls&&this.mushroomWaterfalls.size>0&&(this.mushroomWaterfalls.forEach(t=>{this.scene.remove(t)}),this.mushroomWaterfalls.clear())}}class uC{constructor(){this.enabled=!1,this.measures=new Map,this.frameStart=0,this.frameHistory=[],this.logThresholdMs=34,this.maxBars=10,this.canvas=document.createElement("canvas"),this.canvas.style.cssText="position:fixed; bottom:10px; right:10px; z-index:9999; pointer-events:none; display:none; background:rgba(0,0,0,0.8); border-radius:8px;",this.canvas.width=300,this.canvas.height=200,document.body.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d")}toggle(){this.enabled=!this.enabled,this.canvas.style.display=this.enabled?"block":"none",console.log(`[Profiler] ${this.enabled?"Enabled":"Disabled"}`)}startFrame(){this.enabled&&(this.measures.clear(),this.frameStart=performance.now())}measure(t,e){if(!this.enabled)return e();const s=performance.now(),i=e(),r=performance.now()-s,a=this.measures.get(t)||0;return this.measures.set(t,a+r),i}endFrame(){if(!this.enabled)return;const t=performance.now()-this.frameStart;if(t>this.logThresholdMs){console.warn(` LAG SPIKE: ${t.toFixed(1)}ms`);const e=[...this.measures.entries()].sort((s,i)=>i[1]-s[1]);console.table(e.map(([s,i])=>({System:s,"Time (ms)":i.toFixed(2),"% of Frame":(i/t*100).toFixed(1)+"%"})))}this.drawUI(t)}drawUI(t){const e=this.ctx,s=this.canvas.width,i=this.canvas.height;e.clearRect(0,0,s,i),e.fillStyle="#fff",e.font="12px monospace",e.fillText(`Frame: ${t.toFixed(1)}ms (${(1e3/t).toFixed(0)} FPS)`,10,20);let n=40;const r=s-20;[...this.measures.entries()].sort((c,l)=>l[1]-c[1]).forEach(([c,l])=>{if(n>i-10)return;const u=Math.min(l/t,1),p=Math.max(1,u*r);l>10?e.fillStyle="#ff4444":l>4?e.fillStyle="#ffbb33":e.fillStyle="#00C851",e.fillRect(10,n,p,14),e.fillStyle="#fff",e.fillText(`${c}: ${l.toFixed(1)}ms`,14,n+11),n+=20})}}const qs=new uC;let fl=typeof navigator<"u"&&navigator.gpu!==void 0;typeof window<"u"&&fl&&(fl=await navigator.gpu.requestAdapter());class k5{static isAvailable(){return!!fl}static getStaticAdapter(){return fl}static getErrorMessage(){const t='Your browser does not support <a href="https://gpuweb.github.io/gpuweb/" style="color:blue">WebGPU</a> yet',e=document.createElement("div");return e.id="webgpumessage",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.maxWidth="400px",e.style.margin="5em auto 0",e.innerHTML=t,e}}function pC(){const o=document.querySelector("#glCanvas"),t=new Yp;t.fog=new qp(Xe.day.fog,20,100);const e=new li(60,window.innerWidth/window.innerHeight,.1,2e3);if(e.position.set(0,5,0),!k5.isAvailable()){const g=k5.getErrorMessage();throw document.body.appendChild(g),new Error("WebGPU not supported")}const s=new WM({canvas:o,antialias:!0});s.setSize(window.innerWidth,window.innerHeight),s.setPixelRatio(Math.min(window.devicePixelRatio,1.5)),s.toneMapping=d4,s.toneMappingExposure=1;const i=new q4(Xe.day.skyTop,as.colors.ground,1.1);t.add(i);const n=new X4(Xe.day.sun,.9);n.position.set(50,80,30),n.castShadow=!0,n.shadow.mapSize.width=1024,n.shadow.mapSize.height=1024,t.add(n);const r=new gi({color:16770457,transparent:!0,opacity:.25,blending:Jt,side:Kt,depthWrite:!1}),a=new V(new $i(80,80),r);a.position.copy(n.position.clone().normalize().multiplyScalar(400)),a.lookAt(0,0,0),t.add(a);const c=new gi({color:16774358,transparent:!0,opacity:.15,blending:Jt,side:Kt,depthWrite:!1}),l=new V(new $i(150,150),c);l.position.copy(n.position.clone().normalize().multiplyScalar(390)),l.lookAt(0,0,0),t.add(l);const u=new K,p=12,h=new $i(8,200),d=new gi({color:16770464,transparent:!0,opacity:0,blending:Jt,side:Kt,depthWrite:!1});for(let g=0;g<p;g++){const f=new V(h,d.clone()),m=g/p*Math.PI*2;f.rotation.z=m,u.add(f)}return u.position.copy(n.position.clone().normalize().multiplyScalar(380)),u.visible=!1,t.add(u),window.addEventListener("resize",()=>{e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),s.setSize(window.innerWidth,window.innerHeight)}),{scene:t,camera:e,renderer:s,ambientLight:i,sunLight:n,sunGlow:a,sunCorona:l,lightShaftGroup:u,sunGlowMat:r,coronaMat:c}}async function hC(o,t,e){const s=e.layers.mask,i=e.position.clone(),n=e.rotation.clone(),r=o.autoClear,a=[];t.traverse(l=>{l.isMesh&&l.frustumCulled&&(l.frustumCulled=!1,a.push(l))});const c=new vt;o.getViewport(c),o.setViewport(0,0,1,1),e.layers.enableAll(),e.position.set(0,50,0),e.lookAt(0,0,0);try{o.render(t,e)}catch(l){console.warn("Warmup error",l)}o.setViewport(c),a.forEach(l=>l.frustumCulled=!0),e.layers.mask=s,e.position.copy(i),e.rotation.copy(n),o.autoClear=r,o.clear()}const sr=new As(0,0,0,"YXZ"),ir=new S,dC={type:"change"},gC={type:"lock"},fC={type:"unlock"},V5=Math.PI/2;class mC extends Em{constructor(t,e=null){super(t,e),this.isLocked=!1,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.pointerSpeed=1,this._onMouseMove=yC.bind(this),this._onPointerlockChange=xC.bind(this),this._onPointerlockError=wC.bind(this),this.domElement!==null&&this.connect()}connect(){this.domElement.ownerDocument.addEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.addEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.addEventListener("pointerlockerror",this._onPointerlockError)}disconnect(){this.domElement.ownerDocument.removeEventListener("mousemove",this._onMouseMove),this.domElement.ownerDocument.removeEventListener("pointerlockchange",this._onPointerlockChange),this.domElement.ownerDocument.removeEventListener("pointerlockerror",this._onPointerlockError)}dispose(){this.disconnect()}getObject(){return console.warn("THREE.PointerLockControls: getObject() has been deprecated. Use controls.object instead."),this.object}getDirection(t){return t.set(0,0,-1).applyQuaternion(this.object.quaternion)}moveForward(t){if(this.enabled===!1)return;const e=this.object;ir.setFromMatrixColumn(e.matrix,0),ir.crossVectors(e.up,ir),e.position.addScaledVector(ir,t)}moveRight(t){if(this.enabled===!1)return;const e=this.object;ir.setFromMatrixColumn(e.matrix,0),e.position.addScaledVector(ir,t)}lock(){this.domElement.requestPointerLock()}unlock(){this.domElement.ownerDocument.exitPointerLock()}}function yC(o){if(this.enabled===!1||this.isLocked===!1)return;const t=this.object;sr.setFromQuaternion(t.quaternion),sr.y-=o.movementX*.002*this.pointerSpeed,sr.x-=o.movementY*.002*this.pointerSpeed,sr.x=Math.max(V5-this.maxPolarAngle,Math.min(V5-this.minPolarAngle,sr.x)),t.quaternion.setFromEuler(sr),this.dispatchEvent(dC)}function xC(){this.domElement.ownerDocument.pointerLockElement===this.domElement?(this.dispatchEvent(gC),this.isLocked=!0):(this.dispatchEvent(fC),this.isLocked=!1)}function wC(){console.error("THREE.PointerLockControls: Unable to use Pointer Lock API")}const Te={forward:!1,backward:!1,left:!1,right:!1,jump:!1,sneak:!1,sprint:!1,dash:!1},_u=(o,t)=>{if(!o)return;o.dataset.originalText||(o.dataset.originalText=o.innerText);const e=o.dataset.originalText;o.innerText=` ${t} Song${t>1?"s":""} Added!`,setTimeout(()=>{o.innerText=e},2e3)};function bC(o,t,e){const s=new mC(o,document.body),i=document.getElementById("instructions"),n=document.getElementById("startButton"),r=document.getElementById("playlist-overlay"),a=document.getElementById("playlist-list"),c=document.getElementById("closePlaylistBtn"),l=document.getElementById("playlistUploadInput");let u=!1;if(!document.getElementById("game-reticle")){const A=document.createElement("div");A.id="game-reticle",document.body.appendChild(A)}function p(A){const E=document.getElementById("game-reticle");E&&(E.classList.remove("hover","interact"),A==="hover"?E.classList.add("hover"):A==="interact"&&E.classList.add("interact"))}function h(){if(!a)return;a.innerHTML="";const A=t.getPlaylist(),E=t.getCurrentIndex();if(A.forEach((U,$)=>{const Z=document.createElement("li");Z.className=`playlist-item ${$===E?"active":""}`;const j=document.createElement("button");j.className="playlist-btn",j.title=U.name,j.setAttribute("aria-label",`Play ${U.name}`),$===E&&j.setAttribute("aria-current","true"),j.innerHTML=`
                <span class="song-title">${$+1}. ${U.name}</span>
                <span class="status-icon" aria-hidden="true">${$===E?"":""}</span>
            `,j.onclick=ut=>{ut.stopPropagation(),t.playAtIndex($),h(),requestAnimationFrame(()=>{const nt=a.querySelectorAll(".playlist-btn");nt[$]&&nt[$].focus()})},Z.appendChild(j),a.appendChild(Z)}),A.length===0){const U=document.createElement("li");U.style.listStyle="none",U.style.padding="20px 0",U.style.textAlign="center";const $=document.createElement("button");$.className="secondary-button",$.style.fontSize="1em",$.innerText="No songs... Click to Add! ",$.setAttribute("aria-label","Playlist empty. Click to upload music files."),$.onclick=Z=>{Z.stopPropagation(),l&&l.click()},U.appendChild($),a.appendChild(U)}}t.onPlaylistUpdate=()=>{u&&h()},t.onTrackChange=A=>{u&&h();const E=t.getPlaylist();E&&E[A]&&wr(async()=>{const{showToast:U}=await Promise.resolve().then(()=>dc);return{showToast:U}},void 0,import.meta.url).then(({showToast:U})=>{U(`Now Playing: ${E[A].name}`,"")})};function d(){u=!u,u?(s.unlock(),i&&(i.style.display="none"),r.style.display="flex",h(),requestAnimationFrame(()=>{c&&c.focus()})):(r.style.display="none",s.lock())}c&&c.addEventListener("click",d),l&&l.addEventListener("change",A=>{const E=A.target.files;if(E&&E.length>0){t.addToQueue(E);const U=document.querySelector('label[for="playlistUploadInput"]');_u(U,E.length)}}),n&&n.addEventListener("click",()=>{s.lock()}),i&&i.addEventListener("click",A=>{A.target===i&&s.lock()}),s.addEventListener("lock",()=>{const A=document.getElementById("startButton");A&&A.disabled||(i&&(i.style.display="none"),u=!1,r&&(r.style.display="none"))}),s.addEventListener("unlock",()=>{u||(i&&(i.style.display="flex"),n&&(n.innerText="Resume Exploration ",requestAnimationFrame(()=>n.focus())))});const g=function(A){if(A.ctrlKey&&A.code!=="ControlLeft"&&A.code!=="ControlRight"&&A.preventDefault(),u){if(A.code==="Escape"||A.code==="KeyQ"){A.preventDefault(),d();return}if(A.code==="ArrowDown"||A.code==="ArrowUp"){const E=Array.from(r.querySelectorAll(".playlist-btn"));if(E.length>0){A.preventDefault();const U=E.indexOf(document.activeElement);let $;A.code==="ArrowDown"?$=U===-1?0:(U+1)%E.length:$=U===-1?E.length-1:(U-1+E.length)%E.length,E[$].focus()}return}if(A.code==="Tab"){const E=r.querySelectorAll('button, input, [href], select, textarea, [tabindex]:not([tabindex="-1"])');if(E.length===0)return;const U=E[0],$=E[E.length-1];A.shiftKey?document.activeElement===U&&($.focus(),A.preventDefault()):document.activeElement===$&&(U.focus(),A.preventDefault());return}return}switch(A.code){case"KeyQ":d();break;case"KeyW":Te.forward=!0;break;case"KeyA":Te.left=!0;break;case"KeyS":Te.backward=!0;break;case"KeyD":Te.right=!0;break;case"KeyE":Te.dash=!0;break;case"Space":Te.jump=!0;break;case"KeyN":e&&e();break;case"KeyM":T();break;case"ControlLeft":case"ControlRight":Te.sneak=!0,A.preventDefault();break;case"ShiftLeft":case"ShiftRight":Te.sprint=!0;break}},f=function(A){switch(A.code){case"KeyW":Te.forward=!1;break;case"KeyA":Te.left=!1;break;case"KeyS":Te.backward=!1;break;case"KeyD":Te.right=!1;break;case"KeyE":Te.dash=!1;break;case"Space":Te.jump=!1;break;case"ControlLeft":case"ControlRight":Te.sneak=!1;break;case"ShiftLeft":case"ShiftRight":Te.sprint=!1;break}},m=function(A){u||A.button===2&&(Te.forward=!0)},x=function(A){u||A.button===2&&(Te.forward=!1)};document.addEventListener("keydown",g),document.addEventListener("keyup",f),document.addEventListener("mousedown",m),document.addEventListener("mouseup",x);const w=document.getElementById("musicUpload");w&&w.addEventListener("change",A=>{const E=A.target.files;if(E&&E.length>0){t.addToQueue(E);const U=document.querySelector('label[for="musicUpload"]');_u(U,E.length)}});const b=document.getElementById("toggleDayNight");b&&e&&b.addEventListener("click",e);const v=document.getElementById("toggleMuteBtn"),T=()=>{const A=t.toggleMute();v&&(v.setAttribute("aria-pressed",A),v.innerHTML=A?" Unmute (M)":" Mute (M)",v.setAttribute("aria-label",A?"Unmute Audio":"Mute Audio")),wr(async()=>{const{showToast:E}=await Promise.resolve().then(()=>dc);return{showToast:E}},void 0,import.meta.url).then(({showToast:E})=>{E(A?"Audio Muted ":"Audio Unmuted ",A?"":"")})};v&&v.addEventListener("click",A=>{A.stopPropagation(),T()});const M=document.getElementById("openJukeboxBtn");M&&M.addEventListener("click",A=>{A.stopPropagation(),d()});const F=document.getElementById("drag-overlay");let N=0;return F&&(window.addEventListener("dragenter",A=>{A.preventDefault(),N++,F.classList.add("active"),F.setAttribute("aria-hidden","false")}),window.addEventListener("dragleave",A=>{A.preventDefault(),N--,N<=0&&(N=0,F.classList.remove("active"),F.setAttribute("aria-hidden","true"))}),window.addEventListener("dragover",A=>{A.preventDefault()}),window.addEventListener("drop",A=>{A.preventDefault(),N=0,F.classList.remove("active"),F.setAttribute("aria-hidden","true");const E=A.dataTransfer.files;if(E&&E.length>0){t.addToQueue(E),wr(async()=>{const{showToast:$}=await Promise.resolve().then(()=>dc);return{showToast:$}},void 0,import.meta.url).then(({showToast:$})=>{$(`Added ${E.length} Song${E.length>1?"s":""}! `,"")});const U=document.querySelector('label[for="musicUpload"]');U&&_u(U,E.length)}})),{controls:s,updateReticleState:p,updateDayNightButtonState:A=>{b&&(b.setAttribute("aria-pressed",A),b.innerHTML=A?" Switch to Day (N)":" Switch to Night (N)",wr(async()=>{const{showToast:E}=await Promise.resolve().then(()=>dc);return{showToast:E}},void 0,import.meta.url).then(({showToast:E})=>{E(A?"Night Mode Active ":"Day Mode Active ",A?"":"")}))}}}class vC{constructor(){this.discoveredItems=new Set,this.storageKey="candy_world_discovery",this.loadDiscovery()}loadDiscovery(){try{const t=localStorage.getItem(this.storageKey);if(t){const e=JSON.parse(t);Array.isArray(e)&&e.forEach(s=>this.discoveredItems.add(s))}}catch(t){console.warn("DiscoverySystem: Failed to load from localStorage",t)}}saveDiscovery(){try{localStorage.setItem(this.storageKey,JSON.stringify(Array.from(this.discoveredItems)))}catch(t){console.warn("DiscoverySystem: Failed to save to localStorage",t)}}discover(t,e,s=""){return t?this.discoveredItems.has(t)?!1:(this.discoveredItems.add(t),this.saveDiscovery(),wh(`New Discovery: ${e}!`,s,5e3),console.log(`[Discovery] Discovered: ${e} (${t})`),!0):!1}isDiscovered(t){return this.discoveredItems.has(t)}reset(){this.discoveredItems.clear(),this.saveDiscovery(),console.log("[Discovery] Progress reset.")}}const e0=new vC,Sn={minX:-38,maxX:78,minZ:-28,maxZ:68},_C=-2,SC=new S,TC=new S,MC=new S,AC=new S(0,1,0),NC=new S;function CC(o,t,e){const s=t.sprint?e.sprintSpeed:t.sneak?e.sneakSpeed:e.speed,i=SC;o.getWorldDirection(i),i.y=0,i.lengthSq()>.001?i.normalize():i.set(0,0,-1);const n=TC;n.crossVectors(i,AC);const r=MC.set(0,0,0);return t.forward&&r.add(i),t.backward&&r.sub(i),t.right&&r.add(n),t.left&&r.sub(n),r.lengthSq()>1&&r.normalize(),{moveVec:r,moveSpeed:s}}function bh(o,t){return o>Sn.minX&&o<Sn.maxX&&t>Sn.minZ&&t<Sn.maxZ}function FC(o,t,e){let s=e(o,t);if(bh(o,t)){const i=Math.min(o-Sn.minX,Sn.maxX-o),n=Math.min(t-Sn.minZ,Sn.maxZ-t),r=Math.min(i,n),a=Math.min(1,r/10),c=Gt.lerp(s,_C,a);c<s&&(s=c)}return s}function RC(o,t){let e=-100;return t.forEach(s=>{if(s.userData.isBlocked){const i=NC.copy(s.userData.gatePosition).applyMatrix4(s.matrixWorld);o.distanceTo(i)<2.5&&(e=i.y+5)}}),bh(o.x,o.z)&&(e=Math.max(e,1.5)),e}const EC=20,DC=2,BC=4,Ms={DEFAULT:"default",SWIMMING:"swimming",CLIMBING:"climbing",VINE:"vine"},O={position:new S,velocity:new S,speed:15,sprintSpeed:25,sneakSpeed:5,gravity:EC,energy:0,maxEnergy:10,currentState:Ms.DEFAULT,airJumpsLeft:1,dashCooldown:0,canDash:!0,isGrounded:!1,isUnderwater:!1},ml={jump:!1,dash:!1};new S(1,0,0);const to={multiplier:1,targetMultiplier:1,baseGravity:20},PC=new S,_r=new S,sg=new S,IC=new S,LC=new S;new S;const ig=new S(0,1,0);let G5=!1,vh=[];function UC(o,t){return FC(o,t,vo)}function zC(o){vh.push(o)}function kC(o,t,e,s,i){switch(O.position.copy(t.position),VC(o,i),GC(t,s),O.currentState){case Ms.VINE:WC(o,t,s);break;case Ms.SWIMMING:OC(o,t,e,s);break;case Ms.CLIMBING:$C();break;case Ms.DEFAULT:default:qC(o,t,e,s,i);break}ml.jump=s.jump,ml.dash=s.dash,t.position.copy(O.position)}function VC(o,t){if(t){const e=t.grooveAmount||0;to.targetMultiplier=1-e*.4,to.multiplier+=(to.targetMultiplier-to.multiplier)*o*5,O.gravity=to.baseGravity*to.multiplier,t.bpm}}function GC(o,t){const e=O.position,s=RC(e,vh),i=O.currentState===Ms.SWIMMING,n=e.y<s;O.isUnderwater=n,n&&!i?(O.currentState=Ms.SWIMMING,O.velocity.multiplyScalar(.5)):!n&&i&&e.y>s&&(O.currentState=Ms.DEFAULT,t.jump&&(O.velocity.y=8)),Cr?(O.currentState=Ms.VINE,e0.discover("vine_swing","Swingable Vine","")):O.currentState===Ms.VINE&&(O.currentState=Ms.DEFAULT)}function OC(o,t,e,s){O.velocity.y+=DC*o,O.velocity.multiplyScalar(1-BC*o);const i=O.speed*.6,n=PC.set(0,0,0);if(s.forward&&(n.z+=1),s.backward&&(n.z-=1),s.right&&(n.x+=1),s.left&&(n.x-=1),n.lengthSq()>0){n.normalize();const r=_r;t.getWorldDirection(r);const a=sg;a.crossVectors(r,ig);const c=IC.set(0,0,0).addScaledVector(r,n.z).addScaledVector(a,n.x);O.velocity.addScaledVector(c,i*o)}s.jump&&(O.velocity.y+=10*o),s.sneak&&(O.velocity.y-=10*o),O.position.x+=O.velocity.x*o,O.position.z+=O.velocity.z*o,O.position.y+=O.velocity.y*o}function WC(o,t,e){Cr&&(Cr.update(t,o,e),e.jump&&(rC(Cr.detach(O)),eg(null),e.jump=!1,O.currentState=Ms.DEFAULT))}function $C(o,t,e,s){O.velocity.set(0,0,0),O.currentState=Ms.DEFAULT}function HC(o,t,e){O.dashCooldown>0&&(O.dashCooldown-=o),O.isGrounded&&(O.airJumpsLeft=1),e.jump&&!ml.jump&&!O.isGrounded&&O.airJumpsLeft>0&&(O.velocity.y=12,O.airJumpsLeft--,hl(O.position,"jump"),cs&&(cs.value=.2),e0.discover("ability_double_jump","Double Jump","")),e.dash&&!ml.dash&&O.dashCooldown<=0&&(t.getWorldDirection(_r),_r.y=0,_r.normalize(),O.velocity.addScaledVector(_r,25),O.isGrounded||(O.velocity.y=0),O.dashCooldown=1,hl(O.position,"dash"),cs&&(cs.value=.5),e0.discover("ability_dash","Dash",""))}function qC(o,t,e,s,i){G5||(XC(t),G5=!0),gl.forEach(g=>{g!==Cr&&g.update(t,o,null)}),Date.now()-tg>500&&ZC(t),HC(o,t,s),cs&&cs.value>0&&(cs.value=Math.max(0,cs.value-o*2));const{moveVec:n,moveSpeed:r}=CC(t,s,O);rN(O.position.x,O.position.y,O.position.z,O.velocity.x,O.velocity.y,O.velocity.z);const a=O.position.x,c=O.position.z,l=bh(a,c);let u=-1;const p=O.isGrounded&&s.jump?1:0;if(l||(u=nN(o,n.x,n.z,r,p,s.sprint?1:0,s.sneak?1:0,to.multiplier)),u>=0){const g=aN();O.position.set(g.x,g.y,g.z),O.velocity.set(g.vx,g.vy,g.vz),O.velocity.y>0&&O.isGrounded&&(s.jump=!1);const f=O.isGrounded;O.isGrounded=u===1,!f&&O.isGrounded&&O.velocity.y<-1&&hl(O.position,"land")}else YC(o,t,e,s,r);const h=i?.kickTrigger||0;jA(O,h)&&(O.velocity.y>12&&(e0.discover("trampoline_shroom","Trampoline Mushroom",""),s.jump=!1),O.isGrounded&&O.position.y>10&&e0.discover("cloud_platform","Solid Cloud",""))}function YC(o,t,e,s,i){const n=_r;t.getWorldDirection(n),n.y=0,n.normalize();const r=sg.crossVectors(n,ig),a=LC.set(0,0,0);s.forward&&a.add(n),s.backward&&a.sub(n),s.right&&a.add(r),s.left&&a.sub(r),a.lengthSq()>0&&a.normalize().multiplyScalar(i);const c=Math.min(1,15*o);O.velocity.x+=(a.x-O.velocity.x)*c,O.velocity.z+=(a.z-O.velocity.z)*c,O.velocity.y-=O.gravity*o,O.position.x+=O.velocity.x*o,O.position.z+=O.velocity.z*o,O.position.y+=O.velocity.y*o;const l=UC(O.position.x,O.position.z),u=O.isGrounded;O.position.y<l+1.8&&O.velocity.y<=0?(O.position.y=l+1.8,O.velocity.y=0,O.isGrounded=!0,u||hl(O.position,"land")):O.isGrounded=!1,O.isGrounded&&s.jump&&(O.velocity.y=8,O.isGrounded=!1)}function XC(o){oN(o.position.x,o.position.y,o.position.z);for(const t of dl)gu(0,t.position.x,t.position.y,t.position.z,0,t.userData.capHeight||3,t.userData.stemRadius||.5,t.userData.capRadius||2,t.userData.isTrampoline?1:0);for(const t of Ps)gu(1,t.position.x,t.position.y,t.position.z,(t.scale.x||1)*2,(t.scale.y||1)*.8,0,t.userData.tier||1,0);for(const t of Kd)gu(2,t.position.x,t.position.y,t.position.z,t.userData.bounceRadius||.5,t.userData.bounceHeight||.5,t.userData.bounceForce||12,0,0);ZA(vh,dl,Ps),console.log("[Physics] Engines Initialized (C++ & ASC).")}function ZC(o){const t=O.position;for(const e of gl){const s=t.x-e.anchorPoint.x,i=t.z-e.anchorPoint.z,n=Math.sqrt(s*s+i*i),r=e.anchorPoint.y-e.length;if(n<2&&t.y<e.anchorPoint.y&&t.y>r&&n<1){e.attach(o,O.velocity),eg(e);break}}}const O5=JSON.parse('[{"type":"mushroom","position":[25,0,0],"scale":1.2,"variant":"regular","note":"C","noteIndex":0,"hasFace":false},{"type":"mushroom","position":[21.65,0,12.5],"scale":1.2,"variant":"regular","note":"C#","noteIndex":1,"hasFace":false},{"type":"mushroom","position":[12.5,0,21.65],"scale":1.2,"variant":"regular","note":"D","noteIndex":2,"hasFace":false},{"type":"mushroom","position":[0,0,25],"scale":1.2,"variant":"regular","note":"D#","noteIndex":3,"hasFace":false},{"type":"mushroom","position":[-12.5,0,21.65],"scale":1.2,"variant":"regular","note":"E","noteIndex":4,"hasFace":false},{"type":"mushroom","position":[-21.65,0,12.5],"scale":1.2,"variant":"regular","note":"F","noteIndex":5,"hasFace":false},{"type":"mushroom","position":[-25,0,0],"scale":1.2,"variant":"regular","note":"F#","noteIndex":6,"hasFace":false},{"type":"mushroom","position":[-21.65,0,-12.5],"scale":1.2,"variant":"regular","note":"G","noteIndex":7,"hasFace":false},{"type":"mushroom","position":[-12.5,0,-21.65],"scale":1.2,"variant":"regular","note":"G#","noteIndex":8,"hasFace":false},{"type":"mushroom","position":[0,0,-25],"scale":1.2,"variant":"regular","note":"A","noteIndex":9,"hasFace":false},{"type":"mushroom","position":[12.5,0,-21.65],"scale":1.2,"variant":"regular","note":"A#","noteIndex":10,"hasFace":false},{"type":"mushroom","position":[21.65,0,-12.5],"scale":1.2,"variant":"regular","note":"B","noteIndex":11,"hasFace":false},{"type":"mushroom","position":[72,0,-40],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[66,0,-29.607695154586736],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[54,0,-29.607695154586736],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[48,0,-40],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[53.99999999999999,0,-50.392304845413264],"scale":1.5,"variant":"giant","hasFace":true},{"type":"mushroom","position":[66,0,-50.392304845413264],"scale":1.5,"variant":"giant","hasFace":true},{"type":"portamento_pine","position":[-47.22911016463579,0,-0.1255438425534603],"scale":0.9374434605235864},{"type":"tremolo_tulip","position":[-40.543526587193824,0,-6.501984401399766],"scale":1.0453580444760104},{"type":"tremolo_tulip","position":[-47.64864023911153,0,-7.174714975268854],"scale":1.0930116674734562},{"type":"tremolo_tulip","position":[-47.83239902515943,0,-6.72533117503884],"scale":0.8031491105100604},{"type":"tremolo_tulip","position":[-48.63930823476214,0,-7.176793236973787],"scale":0.9306455807912338},{"type":"prism_rose_bush","position":[-48.049974851790104,0,-7.594525476036271],"scale":1.1636334853694503},{"type":"prism_rose_bush","position":[-52.777369041429615,0,-6.311771619973262],"scale":0.874331714198389},{"type":"prism_rose_bush","position":[-49.676046349699035,0,-11.18063119800394],"scale":0.9444590508448274},{"type":"prism_rose_bush","position":[119.76576256388121,0,11.282430741476926],"scale":0.8108908930982137},{"type":"tremolo_tulip","position":[124.40140164851591,0,10.30193958403372],"scale":1.1797933198653967},{"type":"portamento_pine","position":[119.52465877947792,0,11.206682617909273],"scale":1.1106525614033895},{"type":"portamento_pine","position":[119.18450529879063,0,7.866906129568365],"scale":1.1231816712992806},{"type":"arpeggio_fern","position":[118.3652948449315,0,7.325511979380682],"scale":1.0736005067797172},{"type":"vibrato_violet","position":[121.5129502246927,0,12.065561150703646],"scale":0.8798744832030643},{"type":"tremolo_tulip","position":[120.50944629578314,0,10.73012969003906],"scale":1.1582220855207417},{"type":"vibrato_violet","position":[116.16074926043052,0,7.0060833807841565],"scale":1.1687494973386434},{"type":"arpeggio_fern","position":[118.91040609820976,0,12.412317576902907],"scale":1.003077234405893},{"type":"portamento_pine","position":[119.57803860755212,0,10.527755360427552],"scale":1.1003052292476632},{"type":"prism_rose_bush","position":[104.29205958954961,0,-8.878971313154244],"scale":0.8479231986446575},{"type":"prism_rose_bush","position":[97.69989355674667,0,-17.640631483993353],"scale":0.946662538452866},{"type":"portamento_pine","position":[95.28384228595107,0,-5.220051339856421],"scale":1.1481714622834858},{"type":"prism_rose_bush","position":[97.4047452881846,0,-15.781343803804809],"scale":0.921761601297653},{"type":"portamento_pine","position":[98.14235900800283,0,-11.679187503160001],"scale":0.9743284807235675},{"type":"prism_rose_bush","position":[96.20048995883936,0,-18.743274581423755],"scale":0.9922194392383505},{"type":"arpeggio_fern","position":[99.4120568739739,0,-11.046351450552823],"scale":1.0742663314289531},{"type":"arpeggio_fern","position":[99.6642763637413,0,-10.172403990417576],"scale":0.9457034234272924},{"type":"arpeggio_fern","position":[102.58367871622582,0,-10.633298774869342],"scale":1.1326173456185114},{"type":"prism_rose_bush","position":[95.63961290175702,0,-8.5005662911608],"scale":1.1285766399365986},{"type":"arpeggio_fern","position":[99.01294247742509,0,-9.679037492657544],"scale":1.0639822437809596},{"type":"subwoofer_lotus","position":[39.918033770384966,0,2.34248769559657],"scale":0.8920341765134564},{"type":"accordion_palm","position":[43.88268020331673,0,16.002265511515958],"scale":0.9665690448394947},{"type":"accordion_palm","position":[40.60967918670037,0,10.206675748342915],"scale":0.8138140961668201},{"type":"kick_drum_geyser","position":[37.04981076183964,0,11.552361276774095],"scale":0.9155642394617505},{"type":"kick_drum_geyser","position":[45.673283591643994,0,12.723730784534336],"scale":1.1316616588614075},{"type":"kick_drum_geyser","position":[32.74655775193414,0,11.8814106868065],"scale":0.8640132495050038},{"type":"prism_rose_bush","position":[-99.65169122768516,0,-36.380677709583324],"scale":1.1334699000818218},{"type":"arpeggio_fern","position":[-97.46579158948322,0,-33.7393513523269],"scale":1.1833276174414797},{"type":"portamento_pine","position":[-95.48556747382372,0,-31.507488958036845],"scale":0.837793518018398},{"type":"arpeggio_fern","position":[-95.97381546251576,0,-29.447162118032537],"scale":1.0013096456670227},{"type":"arpeggio_fern","position":[-95.64106360813922,0,-32.55928153758976],"scale":0.8690088286979181},{"type":"portamento_pine","position":[90.1046498508956,0,-42.44591134699535],"scale":0.8536252065682787},{"type":"prism_rose_bush","position":[82.5550036309324,0,-38.98596623058435],"scale":1.102318085416236},{"type":"vibrato_violet","position":[81.41994275286038,0,-39.53985063934537],"scale":1.0674201155666885},{"type":"arpeggio_fern","position":[91.09436420864445,0,-41.370721372044386],"scale":0.8493853875562591},{"type":"tremolo_tulip","position":[80.43849951517944,0,-36.43411541217942],"scale":1.1347610897441633},{"type":"arpeggio_fern","position":[81.60695779566566,0,-35.39684489126519],"scale":0.944696990655058},{"type":"tremolo_tulip","position":[82.60027506822583,0,-38.73706157122184],"scale":0.9466725515883728},{"type":"prism_rose_bush","position":[84.59100053260772,0,-39.19773081498175],"scale":0.8750194763313562},{"type":"portamento_pine","position":[89.77372002057372,0,-42.47286406099562],"scale":0.9945574132115639},{"type":"tremolo_tulip","position":[81.87594915468183,0,-46.288160418635414],"scale":0.8141690528522924},{"type":"accordion_palm","position":[-88.79781334771123,0,-21.47799430383231],"scale":1.1692633794565368},{"type":"snare_trap","position":[-93.36328548677082,0,-25.097416223531713],"scale":0.9026880447042636},{"type":"subwoofer_lotus","position":[-95.32246624484179,0,-23.777569304397947],"scale":1.0984448013803905},{"type":"subwoofer_lotus","position":[-91.79341864776526,0,-25.014204193803696],"scale":1.1541500796019337},{"type":"kick_drum_geyser","position":[-92.95251901435498,0,-29.616094665185095],"scale":0.8863258223570595},{"type":"kick_drum_geyser","position":[-92.87465475196053,0,-23.455058811931234],"scale":0.870060281542649},{"type":"kick_drum_geyser","position":[-95.50621397742366,0,-17.496688497085024],"scale":1.151272144007872},{"type":"accordion_palm","position":[-98.60577158099797,0,-26.40784978073481],"scale":0.9733974941118964},{"type":"accordion_palm","position":[-93.93460216667681,0,-23.375752855572227],"scale":0.9664986119251022},{"type":"cymbal_dandelion","position":[-49.02594539931655,0,41.80285968724054],"scale":1.1593844099035353},{"type":"subwoofer_lotus","position":[-55.7572743700053,0,38.611148162407474],"scale":0.8717428391365759},{"type":"snare_trap","position":[-53.888109506291144,0,43.69816094730608],"scale":1.0631268082009424},{"type":"accordion_palm","position":[-49.80795495679224,0,37.43882274864475],"scale":1.1426974621911639},{"type":"kick_drum_geyser","position":[-52.819365828640876,0,39.16820592840743],"scale":1.1973553297204669},{"type":"accordion_palm","position":[-47.110669231448064,0,43.066031339207],"scale":0.9730255980682798},{"type":"snare_trap","position":[-53.929884143188964,0,44.541067389214156],"scale":0.8386436351003118},{"type":"accordion_palm","position":[-51.05104280105699,0,43.163743917169356],"scale":0.894441133007592},{"type":"accordion_palm","position":[-53.571898169233926,0,44.33184039918323],"scale":1.0716913563173793},{"type":"tremolo_tulip","position":[80.0538700300257,0,-47.97461837140477],"scale":0.9931466331590519},{"type":"arpeggio_fern","position":[83.07698620736448,0,-56.27617311301366],"scale":0.8861523958483911},{"type":"portamento_pine","position":[79.74878747347807,0,-53.12178396584419],"scale":1.1612366106565035},{"type":"prism_rose_bush","position":[73.26822726937327,0,-55.575242426011805],"scale":1.0395962617031744},{"type":"prism_rose_bush","position":[72.10499020338924,0,-57.61683409908401],"scale":1.0352898374864716},{"type":"tremolo_tulip","position":[83.05795130267002,0,-50.24113278290652],"scale":0.9503942362044122},{"type":"vibrato_violet","position":[-15.71990977028575,0,39.20101118643635],"scale":1.134646217031062},{"type":"portamento_pine","position":[-23.091694306750664,0,28.142528510800087],"scale":0.8267769608779887},{"type":"tremolo_tulip","position":[-24.882413058425335,0,33.6947885176295],"scale":1.0167508175324467},{"type":"arpeggio_fern","position":[-14.868592593420445,0,30.307129156833305],"scale":1.100392559261811},{"type":"arpeggio_fern","position":[-20.780749893443044,0,32.50885171941463],"scale":1.1550058296353567},{"type":"tremolo_tulip","position":[-11.664819385970105,0,30.69092538026287],"scale":1.0268907454210294},{"type":"arpeggio_fern","position":[-20.642246118339383,0,40.61753374980115],"scale":0.8561804216792663},{"type":"portamento_pine","position":[-18.552411988347693,0,34.575967745089095],"scale":1.077367955700064},{"type":"portamento_pine","position":[-18.141913525522366,0,34.047334290376895],"scale":1.1079360549594899},{"type":"vibrato_violet","position":[41.43027457741349,0,38.725662073221415],"scale":1.1204521709775725},{"type":"vibrato_violet","position":[47.0816688555319,0,41.85834446466186],"scale":1.014317464960814},{"type":"arpeggio_fern","position":[33.61017882998094,0,38.42058117719781],"scale":1.0986192346461519},{"type":"tremolo_tulip","position":[39.1173923791177,0,45.035345192366215],"scale":0.8406542303042778},{"type":"arpeggio_fern","position":[38.31824003596915,0,40.457264983806326],"scale":1.0604926701348498},{"type":"prism_rose_bush","position":[39.40445918545167,0,41.9625565691024],"scale":1.0004720561820766},{"type":"portamento_pine","position":[41.379974100611214,0,41.051512466018664],"scale":0.9460835320795433},{"type":"tremolo_tulip","position":[47.18247908706261,0,41.24321669412563],"scale":1.174098183821479},{"type":"vibrato_violet","position":[41.459549920041944,0,37.34116011843633],"scale":1.0599630403448388},{"type":"portamento_pine","position":[43.52217285428323,0,39.54746098716194],"scale":1.0308405813288084},{"type":"snare_trap","position":[-53.19984888470764,0,-100.6986158552477],"scale":1.120398482315219},{"type":"accordion_palm","position":[-51.99330342931394,0,-92.1796426746822],"scale":0.8834521833640497},{"type":"kick_drum_geyser","position":[-52.114259004061275,0,-94.72806306264009],"scale":0.8272330239842545},{"type":"kick_drum_geyser","position":[-53.977484149797526,0,-96.03216769503626],"scale":0.9430323097894462},{"type":"subwoofer_lotus","position":[-57.37118606552557,0,-98.69398862583571],"scale":1.1685840003531272},{"type":"snare_trap","position":[-51.88787451438698,0,-97.40223236593638],"scale":1.07003823102538},{"type":"cymbal_dandelion","position":[-53.74691847129073,0,-97.0894644626069],"scale":1.1046890666932239},{"type":"subwoofer_lotus","position":[-50.95267916857115,0,-99.79015135323348],"scale":0.8800259850275564},{"type":"subwoofer_lotus","position":[-55.51691349150403,0,-98.70619532262297],"scale":0.9430168103152341},{"type":"snare_trap","position":[-54.822457967133175,0,-90.87841072879833],"scale":0.8803625042547809},{"type":"kick_drum_geyser","position":[-46.49537875252543,0,-97.57283283960712],"scale":1.0607945299997539},{"type":"cymbal_dandelion","position":[-55.97060788546942,0,-97.88582412452101],"scale":0.9813741495979758},{"type":"fiber_optic_willow","position":[-107.83391007801761,0,-31.304563128740387],"scale":0.986015613534345},{"type":"fiber_optic_willow","position":[71.00201806116925,0,47.76280589100914],"scale":1.0043558984176926},{"type":"balloon_bush","position":[23.003398423838497,0,63.27106602963155],"scale":1.1415249369605789},{"type":"floating_orb","position":[-119.91615094415577,0,-8.494360014016742],"scale":1.4984708133513283},{"type":"cloud","position":[-112.59903565179454,41.63615848315962,-58.48214023426522],"size":2.034218205970102},{"type":"balloon_bush","position":[-33.1085219460295,0,-11.759038496727134],"scale":1.2972895722937567},{"type":"helix_plant","position":[3.470647443787697,0,-32.99105882090267],"scale":1.0790860445438026},{"type":"helix_plant","position":[-125.08161389322673,0,17.361933062987198],"scale":0.9505704219913998},{"type":"floating_orb","position":[75.59873844730139,0,75.66383441659225],"scale":1.0318142741849725},{"type":"cloud","position":[35.448837083688474,49.47437558121186,18.146314351559887],"size":2.4749023472949334},{"type":"floating_orb","position":[7.0740295471790935,0,39.42874167452246],"scale":1.001507242209681},{"type":"balloon_bush","position":[-54.69964294715163,0,-109.62700645327244],"scale":1.1475745948672675},{"type":"helix_plant","position":[3.247327553497337,0,104.60284542518704],"scale":1.2713343428676456},{"type":"bubble_willow","position":[4.624564515986328,0,138.43005278722208],"scale":1.3272631436263096},{"type":"balloon_bush","position":[116.95914985086107,0,-47.112467138511455],"scale":1.129679921064155},{"type":"cloud","position":[-77.88365076416657,61.61785651135781,-29.222142191437932],"size":1.8485854072985317},{"type":"bubble_willow","position":[-62.040498384346876,0,-131.79486809943518],"scale":1.4593245942918638},{"type":"floating_orb","position":[-13.313135586808585,0,-26.644503750210788],"scale":0.9144877618712476},{"type":"balloon_bush","position":[-138.95483832000707,0,4.96464566523048],"scale":1.2892614040242114},{"type":"fiber_optic_willow","position":[10.939949542176707,0,-47.0328187392231],"scale":1.3572706283509077},{"type":"balloon_bush","position":[-62.39315897867437,0,108.48174687940846],"scale":1.4320102665201349},{"type":"cloud","position":[95.2820050140259,59.57592577375578,109.52125877905935],"size":2.148591694424708},{"type":"floating_orb","position":[-1.9148714946786534,0,-52.96118856228077],"scale":1.3455090842904065},{"type":"helix_plant","position":[-0.6722842289604921,0,81.34560605788411],"scale":0.9247364512251874},{"type":"fiber_optic_willow","position":[72.95359853298517,0,37.095055480292444],"scale":1.3981079630771869},{"type":"cloud","position":[-33.48024635025627,46.63904710288556,89.85322107330335],"size":2.1069190705797576},{"type":"cloud","position":[14.930324832962643,47.826202054803005,14.161826203389708],"size":1.991394833695241},{"type":"bubble_willow","position":[-104.21039271332185,0,-69.85011091550493],"scale":0.981137013030323},{"type":"wisteria_cluster","position":[24.989091468563654,0,12.307082045536129],"scale":0.9819735000275821},{"type":"fiber_optic_willow","position":[24.534021839922204,0,118.61154111078731],"scale":1.2548326199633824},{"type":"balloon_bush","position":[-102.82792707431676,0,-9.21062646983854],"scale":0.913549055317636},{"type":"balloon_bush","position":[14.178878921321107,0,28.89571503316916],"scale":1.0982100939107595},{"type":"floating_orb","position":[95.30292078285586,0,61.02756011347877],"scale":1.0647393320123202},{"type":"cloud","position":[29.982936783662442,58.16298784565561,-91.5932686219503],"size":2.2209575619605175},{"type":"balloon_bush","position":[-44.73742867588362,0,133.22581135491507],"scale":1.3077755833205171},{"type":"bubble_willow","position":[-45.58541603736963,0,25.335591349028064],"scale":1.4249678222657163},{"type":"floating_orb","position":[-20.634351887090375,0,-23.779953163048646],"scale":1.3453369392137333},{"type":"balloon_bush","position":[106.78871809610276,0,-98.41562769696642],"scale":1.326730174699894},{"type":"fiber_optic_willow","position":[62.525230438392924,0,-37.79147650103577],"scale":1.2711981703221982},{"type":"fiber_optic_willow","position":[29.325436278883924,0,70.65249501956262],"scale":1.0447878689105452},{"type":"balloon_bush","position":[-11.56638016213383,0,-38.63287456836198],"scale":1.051979992215855},{"type":"bubble_willow","position":[-57.54095389482364,0,84.56635413617391],"scale":1.1728122071099474},{"type":"bubble_willow","position":[28.357897417889102,0,-69.33057899102269],"scale":1.082035145700773},{"type":"bubble_willow","position":[4.905169589238176,0,91.45344555338403],"scale":0.9605720199825255},{"type":"bubble_willow","position":[-35.682411039133186,0,-17.163509067393967],"scale":1.2792921808127935},{"type":"balloon_bush","position":[-107.56560131801643,0,-45.96977736187065],"scale":1.3795107807248075},{"type":"cloud","position":[53.50851949529446,57.90814990794311,-45.8710449501235],"size":2.318201819863587},{"type":"helix_plant","position":[-110.50945836523098,0,52.760747709629165],"scale":1.491778130896548},{"type":"bubble_willow","position":[58.03222162944969,0,-61.655233471599814],"scale":1.4506397184317592},{"type":"fiber_optic_willow","position":[34.27681368730905,0,-4.223024146425361],"scale":1.4020712593181388},{"type":"starflower","position":[-98.79378038230723,0,-68.61064464023659],"scale":0.8029768492342146},{"type":"mushroom","position":[83.56862436738759,0,113.66399809023576],"scale":1.0881989310243456,"variant":"regular"},{"type":"starflower","position":[5.570006436107278,0,32.285183744086574],"scale":1.1590957618300273},{"type":"starflower","position":[41.212353288792045,0,-69.04035700145205],"scale":1.0645568353373138},{"type":"flower","position":[-3.776269663569565,0,-38.500557312621005],"scale":0.9032645740452868},{"type":"starflower","position":[-54.54162581039797,0,21.684033226602367],"scale":0.7280974129239981},{"type":"starflower","position":[40.58140635793505,0,-61.00393179479322],"scale":1.0518047956384475},{"type":"starflower","position":[-33.79003737619261,0,-84.3201451708588],"scale":0.8213772682106502},{"type":"starflower","position":[-16.28595661245259,0,38.246187237442044],"scale":1.0154137903761857},{"type":"flower","position":[53.2447116961572,0,-91.01675821591172],"scale":0.8111344473446112},{"type":"mushroom","position":[-20.52167052064164,0,128.73583771838403],"scale":0.9471573969760896,"variant":"regular"},{"type":"starflower","position":[67.35700360134837,0,-13.421401746483115],"scale":1.0374444940777259},{"type":"flower","position":[-70.47955347726388,0,87.45965210683737],"scale":0.8656062069257846},{"type":"flower","position":[11.177346625237405,0,47.04180503327607],"scale":1.049798092900399},{"type":"starflower","position":[-65.6226279550783,0,54.15810314574154],"scale":1.0842171934982554},{"type":"starflower","position":[104.26010302283527,0,-1.9666461290503015],"scale":1.1225112230015404},{"type":"starflower","position":[70.19947425903855,0,17.89327607345151],"scale":0.9704218416640702},{"type":"mushroom","position":[127.65245559388775,0,-10.521860095943325],"scale":0.960408182250485,"variant":"regular"},{"type":"starflower","position":[54.599292958110055,0,-72.10958043082795],"scale":0.75481529918018},{"type":"starflower","position":[47.15614033555041,0,15.207426047120213],"scale":0.9059248363990436},{"type":"flower","position":[99.48796871329509,0,20.158728102388224],"scale":0.9423356832627282},{"type":"starflower","position":[131.97991646529772,0,-30.747861860286346],"scale":0.9240290946189861},{"type":"mushroom","position":[15.374004283617019,0,-64.86767645046045],"scale":0.8750333611668917,"variant":"regular"},{"type":"flower","position":[-8.755320756200314,0,-34.24754613098226],"scale":1.1699437175139953,"variant":"glowing"},{"type":"starflower","position":[-99.3284364203347,0,9.437123897389059],"scale":1.0186957925959232},{"type":"mushroom","position":[10.058729128353335,0,-24.231487428774233],"scale":0.7051809351607388,"variant":"regular"},{"type":"mushroom","position":[-3.1840933352870056,0,-52.39982925864937],"scale":1.0759040250392813,"variant":"regular"},{"type":"mushroom","position":[44.69993273495977,0,3.7886826487617955],"scale":1.0643661276559597,"variant":"regular"},{"type":"starflower","position":[59.39024926873719,0,84.77543522714831],"scale":0.7252649969339251},{"type":"flower","position":[-133.2096602986952,0,9.934495192558236],"scale":0.9111972666354243},{"type":"flower","position":[137.85458393663967,0,23.330387938583016],"scale":1.185868561075155},{"type":"starflower","position":[-33.18145734937935,0,0.3054941981711743],"scale":0.9161217340495502},{"type":"starflower","position":[-99.58500839882545,0,90.58686459961527],"scale":0.7911386626967758},{"type":"starflower","position":[-9.573106641160596,0,48.003524386981596],"scale":0.8990114835160267},{"type":"mushroom","position":[-31.307703798869326,0,37.07132263672781],"scale":1.1977549857047534,"variant":"regular"},{"type":"mushroom","position":[-35.27021366947536,0,-9.717393511360394],"scale":1.0770462848132514,"variant":"regular"},{"type":"flower","position":[-50.10775077340466,0,-3.3595290325641307],"scale":0.7182020866008991},{"type":"starflower","position":[-104.58565461571501,0,82.9475093707888],"scale":1.1989909478262528},{"type":"mushroom","position":[-68.06741741943826,0,-36.65417035427972],"scale":0.7787047295661882,"variant":"giant"},{"type":"mushroom","position":[-14.533722590821831,0,35.99621630983983],"scale":0.7126591122314838,"variant":"regular"},{"type":"starflower","position":[42.44703308655852,0,-120.42461373768079],"scale":1.1762138655600531},{"type":"mushroom","position":[-82.30544173086719,0,-85.75689974349531],"scale":1.1591572778342645,"variant":"regular"},{"type":"starflower","position":[17.74431308134437,0,-100.17371199446997],"scale":1.159124701704125},{"type":"flower","position":[-78.63505142398535,0,77.62193417582887],"scale":1.0821588668690536},{"type":"mushroom","position":[-13.86946547839286,0,37.615098984910965],"scale":0.924560198680102,"variant":"regular"},{"type":"starflower","position":[-76.95866768573926,0,-123.72005428992816],"scale":1.062105540705579},{"type":"starflower","position":[-54.185539218591956,0,103.99552217300639],"scale":0.8231500381519387},{"type":"starflower","position":[64.5165682386841,0,22.32166677818968],"scale":1.0450476769449328},{"type":"mushroom","position":[3.7878963745810026,0,94.0276170264386],"scale":1.0633484624027718,"variant":"regular"},{"type":"starflower","position":[-61.218140045781745,0,-16.626953384097867],"scale":1.0282124616470731},{"type":"grass","position":[-40.224606302122346,0,88.66716632004623],"scale":1.1155439666378004},{"type":"grass","position":[29.49670574023934,0,-11.485414893893623],"scale":1.2642570900883336},{"type":"grass","position":[78.87839350420535,0,45.642029960179705],"scale":1.1715374011178483},{"type":"grass","position":[13.399435175555215,0,6.888057722321276],"scale":1.256902535931454},{"type":"grass","position":[-8.94070652713972,0,-26.809920314078813],"scale":1.2489746936968593},{"type":"grass","position":[-0.9644812692296744,0,0.2696649023445153],"scale":1.29584274279433},{"type":"grass","position":[-75.04207845424102,0,-58.296982975678084],"scale":0.9227184537138231},{"type":"grass","position":[0.2559900583920787,0,33.11773198436068],"scale":1.1179576592720433},{"type":"grass","position":[118.38337354142848,0,-28.557459803157784],"scale":0.9277671782577481},{"type":"grass","position":[-101.62754927076448,0,74.43192957100437],"scale":0.8620193157613671},{"type":"grass","position":[72.26869644992071,0,46.24914757185332],"scale":1.00722981126795},{"type":"grass","position":[-14.672605923640598,0,-12.047672299378851],"scale":0.7354388371688114},{"type":"grass","position":[-9.537808167750951,0,-18.41845488220492],"scale":1.1730594024382723},{"type":"grass","position":[31.426693792322183,0,-12.711792148335114],"scale":0.7044156248131238},{"type":"grass","position":[-101.31012795084501,0,-53.1181267588117],"scale":1.0476540522148385},{"type":"grass","position":[-100.87663990202613,0,10.536084404174968],"scale":0.9661387102818664},{"type":"grass","position":[-40.3080550413268,0,-34.65671934411471],"scale":1.0177272081775828},{"type":"grass","position":[56.57395741385441,0,-3.3773113662074596],"scale":1.0317886364310742},{"type":"grass","position":[-45.2404789319899,0,7.466772125231933],"scale":1.0809817528640036},{"type":"grass","position":[16.068111889448797,0,64.86985327628564],"scale":1.085284103553197},{"type":"grass","position":[-41.62818670907434,0,-87.38687555497019],"scale":0.8356481578697109},{"type":"grass","position":[-65.42175138047715,0,108.3615457698386],"scale":1.0099896105693928},{"type":"grass","position":[3.971881311012148,0,136.78749839508885],"scale":1.1073403205007701},{"type":"grass","position":[-24.369870185780854,0,-32.79727000866275],"scale":1.253983845504835},{"type":"grass","position":[-87.87587192136053,0,-92.86017642291407],"scale":1.0642044837496578},{"type":"grass","position":[-19.888944562819358,0,3.828110019535847],"scale":0.744752744852209},{"type":"grass","position":[-78.42132942612078,0,-78.6380032844276],"scale":0.9062331823518183},{"type":"grass","position":[1.7479739568467076,0,2.1786920014301656],"scale":0.7674758288094435},{"type":"grass","position":[126.21233285670827,0,35.41415752493337],"scale":0.7455646044452199},{"type":"grass","position":[-82.26408504962181,0,-111.60783572264003],"scale":1.2692399559114054},{"type":"grass","position":[-62.957600523471946,0,-135.83717108837172],"scale":1.1483042328075783},{"type":"grass","position":[49.37886864212827,0,5.653326857734159],"scale":0.7756680556480327},{"type":"grass","position":[-17.490174341284597,0,-104.1916436877125],"scale":1.0357750553519014},{"type":"grass","position":[-11.556232869651264,0,-148.10720408246868],"scale":0.9793832305814709},{"type":"grass","position":[66.46743977626296,0,-69.22621322948915],"scale":0.9702030918129629},{"type":"grass","position":[38.52857435396466,0,69.56232389189513],"scale":0.725192081200262},{"type":"grass","position":[53.2902661504508,0,-87.40592258401516],"scale":0.7549662615789835},{"type":"grass","position":[36.47060835392114,0,4.094128987448922],"scale":0.9315459821818255},{"type":"grass","position":[-0.5802479146083404,0,-13.51591832464047],"scale":0.7653801114268988},{"type":"grass","position":[-53.432468492533665,0,4.184783760021439],"scale":0.9751625305040141},{"type":"grass","position":[-41.23659227571577,0,-11.152974027741402],"scale":1.0129793324556147},{"type":"grass","position":[-107.41014996111174,0,29.829447610531236],"scale":1.096008669466166},{"type":"grass","position":[-60.015246624834255,0,84.04451260143894],"scale":1.1524489956983919},{"type":"grass","position":[14.262701827865138,0,-83.96253227276596],"scale":1.226132738113743},{"type":"grass","position":[29.986461958201907,0,-97.25707725941047],"scale":1.2820111919711197},{"type":"grass","position":[77.93517982344933,0,-86.01117356637063],"scale":0.9285565658237587},{"type":"grass","position":[-122.95180133598735,0,3.734761362566861],"scale":1.0909808830839767},{"type":"grass","position":[-59.16438138400367,0,9.885803081603564],"scale":0.9471807240113808},{"type":"grass","position":[-72.48111655270569,0,-19.24235058541695],"scale":0.7355273855412952},{"type":"grass","position":[46.03616717814444,0,-22.958051844609383],"scale":0.7086354314425614},{"type":"grass","position":[26.37926469110247,0,-67.62543348055861],"scale":1.101147680898334},{"type":"grass","position":[3.871258035747109,0,-6.305249289625429],"scale":0.835335021876676},{"type":"grass","position":[28.881993886275296,0,-143.65781298623992],"scale":0.820149041437413},{"type":"grass","position":[-67.28800115376366,0,-125.34102037278332],"scale":1.1095847141427932},{"type":"grass","position":[3.3357624673472825,0,25.95123783555957],"scale":0.9567340409941774},{"type":"grass","position":[-38.97863663844068,0,-23.340201333473207],"scale":1.0964229385256783},{"type":"grass","position":[75.86050703822835,0,14.981788568422889],"scale":1.2589169852509818},{"type":"grass","position":[-3.182962957042341,0,-15.605750919440668],"scale":0.8929342238237636},{"type":"grass","position":[12.62315173755678,0,8.397871443563881],"scale":1.246297702121991},{"type":"grass","position":[-2.438376981172182,0,2.9546385029455418],"scale":0.9476291176531797},{"type":"grass","position":[65.2586796587984,0,40.811120473340154],"scale":1.0919341288392412},{"type":"grass","position":[-94.59676406253925,0,-113.02463265123276],"scale":1.297706187260823},{"type":"grass","position":[33.571238307956406,0,15.696813697512633],"scale":1.1517099317812785},{"type":"grass","position":[26.786718006246947,0,-45.36669674016031],"scale":0.9188595363697846},{"type":"grass","position":[-34.583516368154235,0,47.43458344228923],"scale":0.982543322257561},{"type":"grass","position":[132.1083331454044,0,64.23942120450255],"scale":0.7579322367735626},{"type":"grass","position":[84.47661745777776,0,32.13634127267056],"scale":0.9574729488534842},{"type":"grass","position":[4.225476128647864,0,-136.2286997261639],"scale":1.1553559764635464},{"type":"grass","position":[-31.22936655173142,0,-58.36328471846716],"scale":0.7978409360448993},{"type":"grass","position":[-79.07403735904492,0,18.34538990505383],"scale":0.8640403005014148},{"type":"grass","position":[53.06023881341177,0,-38.84548375586767],"scale":1.1755632981129944},{"type":"grass","position":[-25.92963926760198,0,14.269163447425788],"scale":1.1069476571635037},{"type":"grass","position":[-98.21111158201454,0,-40.41767800187973],"scale":0.7627131997969783},{"type":"grass","position":[-8.989363125916668,0,21.750818840253764],"scale":1.1355597944426061},{"type":"grass","position":[68.21535070417103,0,129.30889198883114],"scale":0.7785988530141723},{"type":"grass","position":[-120.59468602339827,0,-63.557219591057596],"scale":1.174990824412318},{"type":"grass","position":[-97.22178539733324,0,-2.196180166481396],"scale":1.2596998280451182},{"type":"grass","position":[38.88113456361245,0,2.2833717713519888],"scale":0.9552813215163449},{"type":"grass","position":[-2.3062701719183463,0,9.553126297272447],"scale":1.2167048319309415},{"type":"grass","position":[63.76774932483908,0,1.9757017700868549],"scale":0.7728121965770454},{"type":"grass","position":[66.39205640539981,0,40.226409240915956],"scale":1.1004284667198472},{"type":"grass","position":[10.900691156026,0,18.327557053344616],"scale":0.9565960933300692},{"type":"grass","position":[-60.69477845029607,0,18.7140336409257],"scale":1.2124293922007814},{"type":"grass","position":[68.48457527581287,0,119.18598998421061],"scale":1.0796497928324233},{"type":"grass","position":[-40.02642733317911,0,-8.879242690664865],"scale":1.212372194739609},{"type":"grass","position":[-33.74773885069591,0,-24.03254590383261],"scale":1.2848592126944782},{"type":"grass","position":[82.17638854402222,0,-111.97144179771927],"scale":0.8797457253478534},{"type":"grass","position":[-17.47298866734567,0,-9.63145457612079],"scale":0.8495715915189389},{"type":"grass","position":[18.020082621441933,0,36.869687132061024],"scale":1.0527448716865697},{"type":"grass","position":[-107.26716409027023,0,37.03109348082953],"scale":1.006342680253177},{"type":"grass","position":[73.20331680029467,0,6.796817425733018],"scale":0.7514542560463259},{"type":"grass","position":[90.2495008941049,0,-4.950676756320516],"scale":1.162959274471382},{"type":"grass","position":[-29.497846985344623,0,-2.8962142908417583],"scale":0.9518168170419025},{"type":"grass","position":[40.81243281664545,0,72.41243720861506],"scale":1.1881407607888659},{"type":"grass","position":[-99.39689396788162,0,99.6687403927573],"scale":0.9241058091321123},{"type":"grass","position":[16.82445162997113,0,-13.363781112466215],"scale":1.199425265270488},{"type":"grass","position":[69.12624955246363,0,-109.18066996710493],"scale":0.906962460027425},{"type":"grass","position":[105.74020279794098,0,14.542997525355494],"scale":0.8661279956047803},{"type":"grass","position":[69.37961668258872,0,-132.86388108517735],"scale":1.2797788930387188},{"type":"grass","position":[3.5679298720038473,0,-53.50321454671526],"scale":1.2337801600134752},{"type":"grass","position":[58.822363045620484,0,42.164812905633966],"scale":0.837139500363596},{"type":"grass","position":[-45.087399920015706,0,-20.63737199824753],"scale":0.8165825398330686},{"type":"grass","position":[18.20478243642269,0,-58.27135333060699],"scale":0.9825989418284244},{"type":"grass","position":[-30.596292555242268,0,120.01635672967058],"scale":0.7619032915999128},{"type":"grass","position":[7.115612927757553,0,-38.39253285373722],"scale":1.2680267723384664},{"type":"grass","position":[27.294591856016666,0,-100.64078016379078],"scale":0.8848519067976846},{"type":"grass","position":[-40.00927881398752,0,128.05491036419193],"scale":1.1230902266573688},{"type":"grass","position":[51.95600922694237,0,-16.448722927836137],"scale":0.9125142470871089},{"type":"grass","position":[11.115434623527168,0,-25.56189661738778],"scale":0.9940955465251295},{"type":"grass","position":[124.94179194251853,0,39.640017297819384],"scale":0.9360241845232811},{"type":"grass","position":[-1.234415980536876,0,-10.93507894278297],"scale":0.9466137166514864},{"type":"grass","position":[-81.46042280550279,0,31.01526981935986],"scale":0.8603365965140133},{"type":"grass","position":[-20.443173518626956,0,24.353662770343757],"scale":1.2452134261114667},{"type":"grass","position":[50.45894721231636,0,-47.315117825036225],"scale":1.1411953482418558},{"type":"grass","position":[95.36423403051465,0,70.62487536389473],"scale":0.9024007967116973},{"type":"grass","position":[129.6928056745914,0,-68.99239117079242],"scale":0.8847689272902186},{"type":"grass","position":[1.3432165667064246,0,-24.679635362721836],"scale":1.288368977908338},{"type":"grass","position":[-7.617108322124396,0,-14.00583882371436],"scale":0.9185627050053469},{"type":"grass","position":[79.79125889705239,0,38.91633066877678],"scale":1.1853640533067524},{"type":"grass","position":[-17.707975128657477,0,71.58123583990907],"scale":0.8885369625802138},{"type":"grass","position":[-20.297980752926637,0,-15.295896084810877],"scale":1.062349142705759},{"type":"grass","position":[7.524420481646106,0,-7.396444841829288],"scale":1.252747953420119},{"type":"grass","position":[-3.5214087081339907,0,1.5472164996784858],"scale":1.0312610989725175},{"type":"grass","position":[50.34676726826115,0,-66.18159847195496],"scale":1.0964591288241756},{"type":"grass","position":[145.23269593433395,0,15.143487987173172],"scale":0.7405223862964222},{"type":"grass","position":[59.39712003345788,0,58.01662381750592],"scale":0.7824587142730901},{"type":"grass","position":[59.62595401518529,0,38.059369899739835],"scale":1.1279431330381864},{"type":"grass","position":[70.48692167374313,0,53.58682544460579],"scale":1.048091778275365},{"type":"grass","position":[37.72046463162383,0,53.24193796982694],"scale":0.9832612185308076},{"type":"grass","position":[-2.7461959203503437,0,1.1866331220418662],"scale":1.2648869103156226},{"type":"grass","position":[38.957176548362504,0,-43.738171633984045],"scale":1.05694747981522},{"type":"grass","position":[34.785859799201226,0,132.73625909018705],"scale":1.2469940448617625},{"type":"grass","position":[-13.32359201840515,0,-68.65843824148907],"scale":0.8268691004988262},{"type":"grass","position":[-25.63762867797389,0,42.530542503039015],"scale":1.290117651433453},{"type":"grass","position":[102.4622466578651,0,103.87709799178009],"scale":1.1605086547296026},{"type":"grass","position":[-34.0785593189208,0,-26.927677544103382],"scale":1.2055610561400942},{"type":"grass","position":[-36.33219973519261,0,-143.98354405300543],"scale":0.7541482332892452},{"type":"grass","position":[17.449888781044667,0,-146.90391335931704],"scale":0.8733539193158654},{"type":"grass","position":[10.868461710317852,0,-7.01230392844783],"scale":1.044419418375287},{"type":"grass","position":[26.05307950882642,0,92.76414921188459],"scale":0.8261639467175707},{"type":"grass","position":[72.83420293576187,0,-15.027691418067164],"scale":1.2384427781525602},{"type":"grass","position":[148.13320828135176,0,5.4484203100501345],"scale":0.9105897556980781},{"type":"grass","position":[-32.285450704302484,0,81.43287601909033],"scale":1.2753119666771209},{"type":"grass","position":[-59.20789280293197,0,-24.88119227995956],"scale":1.0721616174855337},{"type":"grass","position":[46.240469559014485,0,35.80974153990875],"scale":1.146926334139364},{"type":"grass","position":[-42.840184905603486,0,1.7596100994103798],"scale":0.879369486552138},{"type":"grass","position":[-15.65933723208958,0,112.21488879153115],"scale":0.7761293193337429},{"type":"grass","position":[-56.81443665080664,0,-17.564588794574764],"scale":0.8345906044971283},{"type":"grass","position":[-24.151655781665323,0,30.690287523448962],"scale":1.1375824541591022},{"type":"grass","position":[-44.348414860027795,0,109.07293976394934],"scale":0.7096742968755095},{"type":"grass","position":[-127.82215325278719,0,43.06606793880819],"scale":0.7396849763450158},{"type":"grass","position":[-9.443102605200856,0,116.31351915024248],"scale":1.216661790024172},{"type":"grass","position":[-84.74596839126035,0,14.18139874007135],"scale":1.2694524676288816},{"type":"grass","position":[-4.521638749791105,0,-2.1873990325911015],"scale":0.9545803874605205},{"type":"grass","position":[85.42179965935324,0,-82.66865772963186],"scale":1.0574430809438413},{"type":"grass","position":[-26.622744206088775,0,-60.09973206499013],"scale":0.9234576403343066},{"type":"grass","position":[39.65360307748638,0,101.84437736108357],"scale":0.9126502477997942},{"type":"grass","position":[18.899665301984104,0,-80.2068784638265],"scale":1.1917818461617407},{"type":"grass","position":[102.07496773050401,0,35.767837452574206],"scale":0.720343726691334},{"type":"grass","position":[97.33935644564765,0,-0.9239341730813263],"scale":0.9722499743171693},{"type":"grass","position":[-83.25393310692475,0,-47.28744589920778],"scale":0.8899242046477293},{"type":"grass","position":[17.38430083111663,0,-0.38205017044511846],"scale":0.9958083244866308},{"type":"grass","position":[-8.886058510121066,0,5.817955644939584],"scale":0.7933525775572026},{"type":"grass","position":[-8.775833185442748,0,38.039141565498745],"scale":0.8454611895653577},{"type":"grass","position":[16.520015655596275,0,86.85528077091735],"scale":0.7812238079730128},{"type":"grass","position":[-8.227890481046225,0,-17.547631410319063],"scale":0.9678484429212852},{"type":"grass","position":[9.10638845308136,0,51.56851237197381],"scale":1.209947320573832},{"type":"grass","position":[-91.3009120257776,0,99.12582384304133],"scale":1.005434576378637},{"type":"grass","position":[93.59987669163357,0,76.61664778675878],"scale":1.1000596370081528},{"type":"grass","position":[-1.016673158917464,0,-6.656289786066545],"scale":1.1731602549399058},{"type":"grass","position":[66.53388798777246,0,52.24710466269961],"scale":0.7534773288334299},{"type":"grass","position":[37.90019563918074,0,-11.191452422252304],"scale":1.1913963423210456},{"type":"grass","position":[-148.04452324579466,0,-12.69364268125356],"scale":1.1272422567132536},{"type":"grass","position":[72.32318080411001,0,106.49655264352718],"scale":0.8993345479215611},{"type":"grass","position":[-76.77702829433937,0,-4.509956296218764],"scale":0.8707132545504399},{"type":"grass","position":[-4.510858115349918,0,-44.47453171351764],"scale":0.919920216887648},{"type":"grass","position":[-72.23624545951137,0,-38.862990120358184],"scale":0.9858983555744414},{"type":"grass","position":[41.19299520789998,0,4.580603579411891],"scale":1.2412662635237512},{"type":"grass","position":[-0.5435184586024664,0,-0.09103534048253643],"scale":1.1730513401095677},{"type":"grass","position":[-24.456833054952277,0,11.604677698250237],"scale":1.1613308499563817},{"type":"grass","position":[120.797996087196,0,57.405458404818575],"scale":1.2299916298943103},{"type":"grass","position":[-29.350235535136502,0,72.90409846033177],"scale":0.9204262847523583},{"type":"grass","position":[6.39509560218622,0,104.95448245735399],"scale":0.7798375194285542},{"type":"grass","position":[37.60564883418944,0,78.16841160547652],"scale":0.9308642717445313},{"type":"grass","position":[113.02663924207218,0,-33.73797545644238],"scale":1.0835738553482712},{"type":"grass","position":[102.6552528247468,0,-71.75546469735424],"scale":1.126310396493666},{"type":"grass","position":[-0.3704434176303861,0,-1.5256259574691227],"scale":1.241150370272407},{"type":"grass","position":[-32.04855480188744,0,1.5692356974688992],"scale":0.8008215370123453},{"type":"grass","position":[-99.59985870600033,0,43.93503227442674],"scale":1.110195936178879},{"type":"grass","position":[-43.06479895101122,0,71.59083446551689],"scale":0.9623867600426691},{"type":"grass","position":[-148.76271497383138,0,4.623855853527239],"scale":0.7815454924243685},{"type":"grass","position":[70.81613195769235,0,39.08174487063695],"scale":0.8089767631712371},{"type":"grass","position":[133.11960703625198,0,-43.69010843812184],"scale":1.1717033306414502},{"type":"grass","position":[95.08641088367814,0,-83.26009536896893],"scale":0.7926681440900515},{"type":"grass","position":[31.105524952916486,0,6.2816006161874585],"scale":1.0108419583066128},{"type":"grass","position":[-10.2906911012679,0,-133.3405365227227],"scale":1.0418690246714621},{"type":"grass","position":[-28.665831307186657,0,-10.571448062729752],"scale":1.2303607459138999},{"type":"grass","position":[9.166488176792258,0,-8.792990580525409],"scale":0.9864973643865113},{"type":"grass","position":[-63.935978124796684,0,47.28448596539051],"scale":1.1769404281756606},{"type":"grass","position":[4.650487162407939,0,-64.6921587207435],"scale":1.062003428717598},{"type":"grass","position":[-44.94991603417729,0,67.27971779845267],"scale":1.1769500322592368},{"type":"grass","position":[-131.09127290565868,0,-59.35353372031855],"scale":0.7656364385867788},{"type":"grass","position":[48.805488120415994,0,-17.787379628772904],"scale":0.7497939863990112},{"type":"grass","position":[22.24448168919144,0,66.09396324776273],"scale":0.8220126610188393},{"type":"grass","position":[66.16112756182204,0,-104.3482166182268],"scale":0.7713769823826204},{"type":"grass","position":[134.6853986162883,0,22.341843950368517],"scale":0.7963784554197731},{"type":"grass","position":[10.223468743292033,0,-12.602376859852116],"scale":1.0129214291108606},{"type":"grass","position":[102.23964718858161,0,-30.11652910336166],"scale":1.1716121605378633},{"type":"grass","position":[-33.64871161959679,0,-0.4468989078060573],"scale":0.8452922758548734},{"type":"grass","position":[82.98265674471371,0,73.06023048323623],"scale":1.021333007046529},{"type":"grass","position":[0.5203529057461291,0,0.38840260882492356],"scale":0.8344355533395977},{"type":"grass","position":[25.85390372616859,0,20.43773543639258],"scale":0.9723245473838072},{"type":"grass","position":[55.40568133687721,0,-25.20695676267458],"scale":1.2382355162628171},{"type":"grass","position":[-11.81527225328515,0,3.644366464111925],"scale":1.0547626641618877},{"type":"grass","position":[-1.8402607807257703,0,0.8385649611738513],"scale":1.297252005784732},{"type":"grass","position":[8.02759253140476,0,-3.3140658957794784],"scale":1.1667943605942979},{"type":"grass","position":[-7.8828591259374985,0,-96.02260524719489],"scale":1.09948556886026},{"type":"grass","position":[-93.8728652152619,0,32.14444012455027],"scale":0.8148342002595091},{"type":"grass","position":[-110.6311146254265,0,-90.78769204665507],"scale":1.0936939175286189},{"type":"grass","position":[-50.23849713543384,0,132.43323142532043],"scale":0.7880696827115307},{"type":"grass","position":[83.76312288649977,0,47.59051929444255],"scale":0.8133488845995638},{"type":"grass","position":[135.9052167362978,0,10.535801896142406],"scale":0.7875999667957335},{"type":"grass","position":[9.081205747489468,0,-21.015999342651963],"scale":0.8946843830601817},{"type":"grass","position":[-122.7366049193326,0,13.661023145227698],"scale":1.2104787202366212},{"type":"grass","position":[-5.063812003801405,0,114.59721437621477],"scale":0.9112987247655049},{"type":"grass","position":[-142.23397139707834,0,10.352400340437436],"scale":1.148903987081618},{"type":"grass","position":[107.52558284655713,0,-8.899485749182332],"scale":1.2092602176744327},{"type":"grass","position":[-45.081700711490875,0,110.70818114180746],"scale":0.9026313818425805},{"type":"grass","position":[41.27307875958696,0,13.418878620219045],"scale":0.7130512282805896},{"type":"grass","position":[117.86835206112607,0,84.50214513735966],"scale":1.0284786111215034},{"type":"grass","position":[-37.90214717477938,0,30.13411275676683],"scale":0.9079897210074269},{"type":"grass","position":[-71.73936360442524,0,-56.17530689580969],"scale":0.9925938892963833},{"type":"grass","position":[-57.83031007048966,0,8.718394048389344],"scale":1.067623435452634},{"type":"grass","position":[-15.880830589457913,0,-83.37239063991504],"scale":1.2827249641025469},{"type":"grass","position":[-76.40930267733599,0,-47.920853861370595],"scale":0.8162965723375948},{"type":"grass","position":[-65.4712661247593,0,-50.355238686540986],"scale":0.954843126949187},{"type":"grass","position":[-83.66216814322422,0,-25.071676693147904],"scale":1.1628025915528852},{"type":"grass","position":[1.788967912467652,0,-2.841403194450765],"scale":0.7646807273752201},{"type":"grass","position":[15.353699348111782,0,3.7175261280804803],"scale":1.0699408386572984},{"type":"grass","position":[-57.18246163149962,0,-125.50360814623416],"scale":1.1154199837961498},{"type":"grass","position":[-56.04504481789258,0,-104.87333729501518],"scale":1.155987081017504},{"type":"grass","position":[13.53449475779047,0,37.92055256762537],"scale":1.1551970020283537},{"type":"grass","position":[18.230665449799055,0,-12.782728702635486],"scale":1.2654169089795642},{"type":"grass","position":[-40.14341506316663,0,31.644524239489353],"scale":0.8693154216927593},{"type":"grass","position":[33.445604039279424,0,51.26218659239685],"scale":1.0859393949579472},{"type":"grass","position":[0.8616445830655316,0,1.1020739166944191],"scale":0.9413280240882425},{"type":"grass","position":[2.7775698737158687,0,-58.86050800999703],"scale":0.9723777895225532},{"type":"grass","position":[-6.251838286528276,0,5.461560480699522],"scale":0.9968424625200731},{"type":"grass","position":[-38.27300074126379,0,-66.46548337448812],"scale":0.721359057495271},{"type":"grass","position":[79.96950238233057,0,85.33861592339908],"scale":0.9388370129318381},{"type":"grass","position":[6.693302647298839,0,-2.1472616509855604],"scale":1.126450240895759},{"type":"grass","position":[6.765984448684301,0,-59.96033226027662],"scale":0.7497830875116899},{"type":"grass","position":[-133.95237617998677,0,-23.16131957055671],"scale":0.9846207857083846},{"type":"grass","position":[-21.2871160329136,0,-125.18943140371854],"scale":0.8333240839150429},{"type":"grass","position":[-69.63119147015426,0,104.17097845774711],"scale":1.2446914519221295},{"type":"grass","position":[4.288390749285088,0,-70.32756583896152],"scale":0.7925646273289663},{"type":"grass","position":[-51.56369346862107,0,69.92556488817245],"scale":1.0226090721395695},{"type":"grass","position":[-110.80592092925767,0,78.36114306179037],"scale":1.2886548932774942},{"type":"grass","position":[-8.022492631484354,0,-14.05182664361155],"scale":1.053106477752945},{"type":"grass","position":[-11.691396399575005,0,-139.8496760470369],"scale":1.0499048330454939},{"type":"grass","position":[-32.42216947386779,0,26.035117024545933],"scale":0.8291060863698108},{"type":"grass","position":[-41.363038300020335,0,-79.8133011085671],"scale":1.060730264048222},{"type":"grass","position":[-75.6206650818336,0,61.364654765657114],"scale":1.2433487196675705},{"type":"grass","position":[-26.586968570679108,0,32.6035503665551],"scale":0.7339515198930558},{"type":"grass","position":[-28.051409751144664,0,-58.90321315695843],"scale":0.9658440066802902},{"type":"grass","position":[134.67511444592026,0,30.97974172784888],"scale":0.7374630341343823},{"type":"grass","position":[-136.21265385586588,0,3.1654592349380946],"scale":1.1597118454931257},{"type":"grass","position":[-138.69726628104377,0,-39.38771445976873],"scale":0.956092677809337},{"type":"grass","position":[-7.198416246683235,0,-21.151125073027522],"scale":1.1692826439361603},{"type":"grass","position":[87.63788966949606,0,-93.4520825404099],"scale":0.8612752661548893},{"type":"grass","position":[-21.111186227804676,0,93.47878443213855],"scale":1.1980746615751656},{"type":"grass","position":[44.79694442485528,0,59.23849119036464],"scale":0.7119856805425743},{"type":"grass","position":[59.178372935580384,0,-107.68862427770034],"scale":1.2035388405385599},{"type":"grass","position":[-29.249277564631253,0,42.056683274774244],"scale":1.268207081940342},{"type":"grass","position":[-0.42512747795255773,0,-0.591105029395798],"scale":0.9420141688145963},{"type":"grass","position":[-62.18846329219887,0,-27.317277082943267],"scale":0.7669981245258047},{"type":"grass","position":[34.458822020672145,0,-59.22457336928772],"scale":0.877198164347179},{"type":"grass","position":[-29.524743484545215,0,-14.35798638989075],"scale":1.0639049000836476},{"type":"grass","position":[83.43830880918414,0,8.596037897661843],"scale":0.7638824871244876},{"type":"grass","position":[9.920519742442641,0,148.6647292603153],"scale":0.7284098620536614},{"type":"grass","position":[5.021804123924353,0,-13.28151509930096],"scale":1.1886452256006959},{"type":"grass","position":[55.588344002385035,0,-11.682029743201522],"scale":0.8977662126989925},{"type":"grass","position":[109.22306634085588,0,-63.48632224565416],"scale":0.7122970464163272},{"type":"grass","position":[21.08672031118623,0,99.2718369733624],"scale":1.0156393665923724},{"type":"grass","position":[-18.265824479150837,0,-12.677515316424353],"scale":0.7479444943081148},{"type":"grass","position":[-75.48572368157566,0,-50.64522505545194],"scale":1.1489590459095036},{"type":"grass","position":[-14.41364162049793,0,114.90720804164603],"scale":0.8666304210840309},{"type":"grass","position":[-58.66229862311642,0,-2.8353791677084823],"scale":1.281466901970666},{"type":"grass","position":[34.816829686110985,0,-25.755054943851068],"scale":1.1489414375043272},{"type":"grass","position":[92.2116762306731,0,13.240962860849518],"scale":1.124709788891288},{"type":"grass","position":[-84.65340677606055,0,46.41675181284883],"scale":0.9691524947431523},{"type":"grass","position":[103.00810228219308,0,-39.89575269372713],"scale":0.8070089253732904},{"type":"grass","position":[-48.04482269387033,0,-80.47995482970441],"scale":1.2676021296553979},{"type":"grass","position":[15.852912212178083,0,80.9101783927362],"scale":0.8835791612142135},{"type":"grass","position":[117.06862110896056,0,88.32489187601801],"scale":1.2629464533086345},{"type":"grass","position":[-72.03175985871397,0,-18.02481340341031],"scale":1.0514294026348332},{"type":"grass","position":[-6.684654217340148,0,20.539159784923815],"scale":1.2221432350225792},{"type":"grass","position":[61.89069419454507,0,10.861392552085757],"scale":1.288394577033761},{"type":"grass","position":[19.192541211092106,0,17.892091535168383],"scale":0.9218447131851368},{"type":"grass","position":[-41.97740311553453,0,-49.61224170482325],"scale":0.8907405412552554},{"type":"grass","position":[31.29012237643316,0,60.77395237678874],"scale":1.014393892300885},{"type":"grass","position":[74.86499445793118,0,62.067262814123445],"scale":1.2900856549690696},{"type":"grass","position":[-18.292441117589046,0,-19.237442921251525],"scale":1.1274855504679153},{"type":"grass","position":[-82.60648616047942,0,64.82069368352198],"scale":1.0284321604995394},{"type":"grass","position":[-83.00336416505817,0,-54.05644517148292],"scale":0.8187226968348225},{"type":"grass","position":[18.22497324092379,0,57.427829012339345],"scale":1.2283163773219554},{"type":"grass","position":[16.91482187750713,0,-10.06380830933839],"scale":0.7539139420601393},{"type":"grass","position":[-15.722499946642415,0,47.4725825024522],"scale":0.7706397907223194},{"type":"grass","position":[7.158362180835462,0,-9.446035249526805],"scale":0.8148444987827653},{"type":"grass","position":[-24.094721288058228,0,3.539114030781778],"scale":1.2558604787338636},{"type":"grass","position":[61.06621114685452,0,-5.122477096256399],"scale":0.8777444054891353},{"type":"grass","position":[1.0746479106830578,0,-21.533674281459543],"scale":0.7401538424754323},{"type":"grass","position":[121.00862256653471,0,-67.77953737838877],"scale":1.0812705225423673},{"type":"grass","position":[-0.3384719637316736,0,-20.61465326536465],"scale":0.9659801670593098},{"type":"grass","position":[-28.006711709317617,0,-21.17814348858852],"scale":0.9764627723582645},{"type":"grass","position":[5.472410717541728,0,-8.82346497585996],"scale":0.9508148604480229},{"type":"grass","position":[-36.171465621171826,0,-4.1865155956198326],"scale":0.9064627457389445},{"type":"grass","position":[85.09825848192368,0,-17.538328967976636],"scale":0.8692572377505228},{"type":"grass","position":[-48.55251917684539,0,1.7714458176758443],"scale":0.9428576959142448},{"type":"grass","position":[-7.402427608290567,0,37.44019351241781],"scale":0.8621396406805728},{"type":"grass","position":[-34.24951773929265,0,85.53707000825013],"scale":0.8594815818633466},{"type":"grass","position":[-33.36766150430807,0,-88.7427890663606],"scale":1.0047009647988805},{"type":"grass","position":[-0.9444609526102855,0,1.7973464469613916],"scale":0.8583387673764029},{"type":"grass","position":[-89.50325834767803,0,19.98466360244836],"scale":1.2603877289737437},{"type":"grass","position":[-32.38257124526802,0,130.73526368741292],"scale":1.272602680239019},{"type":"grass","position":[-90.52769152348039,0,21.614169326979894],"scale":1.2971512818355895},{"type":"grass","position":[46.859600443262416,0,58.92893332410013],"scale":0.8102638271940125},{"type":"grass","position":[94.11407554304627,0,36.50422488378933],"scale":1.2537447152024845},{"type":"grass","position":[-9.902866762371879,0,-52.20729387093034],"scale":0.9356184007610379},{"type":"grass","position":[33.135154866795794,0,-56.75313941830468],"scale":0.8125169082267583},{"type":"grass","position":[-29.440180970271292,0,-42.53787598103186],"scale":1.2107632231582015},{"type":"grass","position":[-66.230911078944,0,-1.2510843444663435],"scale":0.8480758549045708},{"type":"grass","position":[-2.793702982813962,0,134.4409188016091],"scale":0.7655032264700906},{"type":"grass","position":[0.4598865864555295,0,2.1691316826304425],"scale":1.0673828042237918},{"type":"grass","position":[-47.79093985063159,0,-108.71774285129274],"scale":1.0354027630795941},{"type":"grass","position":[51.97990257623591,0,122.76047432855658],"scale":1.0680196433315179},{"type":"grass","position":[-36.919290855614406,0,1.6246383311583936],"scale":0.7457585546628878},{"type":"grass","position":[-75.92866061039967,0,8.5660099086562],"scale":0.9493797443558456},{"type":"grass","position":[68.20554358654887,0,30.51610539596162],"scale":1.0846038228420098},{"type":"grass","position":[54.63055878401002,0,100.34612539756982],"scale":0.9318816769416045},{"type":"grass","position":[6.5331552764761955,0,-0.23981520987418561],"scale":0.7890905464260325},{"type":"grass","position":[62.60764345611234,0,23.689366595015436],"scale":1.006158990331301},{"type":"grass","position":[-10.302931558006696,0,64.78106475804404],"scale":0.8571782269371706},{"type":"grass","position":[54.12534030917137,0,-138.79923175673034],"scale":0.9661911723727532},{"type":"grass","position":[-61.30416381553412,0,-81.37136646493036],"scale":0.7777293352504864},{"type":"grass","position":[-120.4156489509308,0,71.19051958998557],"scale":1.1254296444799472},{"type":"grass","position":[0.3926733757299216,0,3.4274835906577725],"scale":1.2022331978870358},{"type":"grass","position":[-44.23564527949983,0,38.9959875120617],"scale":1.135895877597717},{"type":"grass","position":[33.576528386456154,0,13.411219037880194],"scale":1.0226676113671278},{"type":"grass","position":[111.88798786727183,0,-10.959056365927424],"scale":1.20330151018015},{"type":"grass","position":[2.248953566509486,0,31.98949170157453],"scale":1.1593482946770695},{"type":"grass","position":[148.92944706440838,0,15.854911611061612],"scale":1.1316604087455342},{"type":"grass","position":[54.33645177413451,0,-64.19923659021379],"scale":0.925911896261375},{"type":"grass","position":[10.49326903229477,0,-59.79793286914531],"scale":1.1222703716269804},{"type":"grass","position":[-47.52067184289811,0,-60.09327109730929],"scale":1.0112837752643173},{"type":"grass","position":[-11.791481859548679,0,-17.743507099576746],"scale":1.0931798039716618},{"type":"grass","position":[14.899824223199616,0,25.164661226449844],"scale":0.9394561655173189},{"type":"grass","position":[0.7354923467710963,0,1.9203772723235806],"scale":0.8224999923709563},{"type":"grass","position":[24.171012823452777,0,11.453409238864115],"scale":1.2567814585842414},{"type":"grass","position":[-97.78358858497214,0,51.27881107842127],"scale":0.7389074548242262},{"type":"grass","position":[-21.254099219192167,0,-13.917558277362392],"scale":1.1562593649934036},{"type":"grass","position":[-46.31189480310255,0,-1.2476170085859861],"scale":1.1859697437921013},{"type":"grass","position":[-22.817261079749322,0,-47.40025115321626],"scale":1.0992899586798832},{"type":"grass","position":[29.704152367638002,0,-120.39232417565523],"scale":0.8265263774907643},{"type":"grass","position":[115.23963206637278,0,-37.187005336363605],"scale":0.8466663505588927},{"type":"grass","position":[-18.64000157007229,0,29.385883157090223],"scale":0.8546887075851105},{"type":"grass","position":[38.11541303950987,0,89.7202615222463],"scale":1.1939808613112333},{"type":"grass","position":[-37.765836765361996,0,1.999722866359534],"scale":1.2249936147544869},{"type":"grass","position":[20.85425401445283,0,-65.55277365355143],"scale":0.7252254994568081},{"type":"grass","position":[87.43223543848244,0,60.745992658688166],"scale":1.2225040788471326},{"type":"grass","position":[111.30444501488101,0,-10.910026942541256],"scale":0.834466411185154},{"type":"grass","position":[18.859567620016794,0,-8.245677348553956],"scale":0.7376584223673047},{"type":"grass","position":[-14.97380751657055,0,38.11870014491613],"scale":0.9406091682235108},{"type":"grass","position":[-76.80885097236155,0,-119.2144151935299],"scale":1.138969210056777},{"type":"grass","position":[86.33350948042639,0,31.004883131444387],"scale":0.830166399714081},{"type":"grass","position":[-3.8310171748600257,0,55.733401722127375],"scale":0.7334291996017839},{"type":"grass","position":[136.51957298742093,0,-9.311897334359855],"scale":1.018869525837158},{"type":"grass","position":[-120.9275684198425,0,62.08985644553526],"scale":1.1382203637082422},{"type":"grass","position":[-77.08522731691595,0,40.21906529497571],"scale":0.7013805906464521},{"type":"grass","position":[26.983806424011178,0,-20.81537383939352],"scale":1.1730442379796007},{"type":"grass","position":[-35.26169186689458,0,-67.41223370091078],"scale":0.82488941009591},{"type":"grass","position":[-86.94123329320529,0,62.441508367199255],"scale":0.9773425372382958},{"type":"grass","position":[8.084177291506895,0,-6.8935121070672185],"scale":0.7510543461117021},{"type":"grass","position":[6.260245897392326,0,-65.8068280642452],"scale":1.2779720086915463},{"type":"grass","position":[-44.898591707571896,0,-51.66421008463892],"scale":1.0241074154994045},{"type":"grass","position":[-83.28057568236999,0,42.35104711992507],"scale":0.8152407627726861},{"type":"grass","position":[68.43284804557901,0,-46.285266575258355],"scale":1.1648418832861407},{"type":"grass","position":[33.565427500741315,0,-131.45405831714027],"scale":1.239696012467172},{"type":"grass","position":[1.9089931495350154,0,7.3168917026703255],"scale":0.8739859224510924},{"type":"grass","position":[-66.87571901830727,0,-29.952534848762205],"scale":1.2239886351607208},{"type":"grass","position":[-125.72042600296326,0,76.13545003525066],"scale":0.7451931671276872},{"type":"grass","position":[38.41893644478999,0,-33.76954593671161],"scale":1.0171091034224606},{"type":"grass","position":[26.34936470468538,0,-98.43090661558459],"scale":1.0682270326006655},{"type":"grass","position":[-115.58737963553581,0,3.5933164112271974],"scale":0.9454652080149912},{"type":"grass","position":[-57.13902888275774,0,-110.8042885960015],"scale":1.0609000484411233},{"type":"grass","position":[-1.4184447137577227,0,68.08437465025673],"scale":0.9648994450351849},{"type":"grass","position":[-27.983325310660394,0,0.8605070407502483],"scale":1.2528389209999031},{"type":"grass","position":[5.571265951051654,0,9.35971069971843],"scale":0.9675562530544204},{"type":"grass","position":[-95.1366534774482,0,-89.28830092046434],"scale":0.8489998946182647},{"type":"grass","position":[-52.25015456164494,0,56.89799425628376],"scale":1.2091281967920626},{"type":"grass","position":[63.506725646493365,0,-102.9567309832388],"scale":0.9798380637915322},{"type":"grass","position":[-50.848199152925346,0,103.07353150373372],"scale":1.1718389713552742},{"type":"grass","position":[35.407102412680324,0,-106.49342187593864],"scale":0.9364206992112671},{"type":"grass","position":[109.51083143948742,0,-6.808249503726643],"scale":0.8800586033361225},{"type":"grass","position":[-17.49323469989518,0,75.327280820045],"scale":1.0237705615697383},{"type":"grass","position":[-49.93539261335588,0,48.3395875322935],"scale":0.8074807745270454},{"type":"grass","position":[22.824312768698597,0,-139.93183205854396],"scale":0.9717273106962603},{"type":"grass","position":[54.676229357605365,0,93.37913357459256],"scale":0.8205606852012637},{"type":"grass","position":[-38.10449327520156,0,36.300906879489006],"scale":1.0563395249751266},{"type":"grass","position":[-33.07031859390367,0,118.82993795429189],"scale":0.8934234017141569},{"type":"grass","position":[87.57363623852561,0,34.098452838177344],"scale":0.8588983805373467},{"type":"grass","position":[-8.18362956781252,0,26.924776030483592],"scale":1.0000832423239971},{"type":"grass","position":[92.4038133350479,0,111.99605670019845],"scale":1.2779102106436717},{"type":"grass","position":[29.186816155967783,0,62.28891727504923],"scale":0.8056831297245356},{"type":"grass","position":[-36.134986838494704,0,133.18930337503824],"scale":1.13183388594611},{"type":"grass","position":[1.04172966008171,0,-77.80068224318444],"scale":0.7990309411932344},{"type":"grass","position":[1.8955553872240434,0,-7.1058227708017805],"scale":1.0823399454843425},{"type":"grass","position":[-70.4738937491019,0,10.564183383573994],"scale":0.8249148514693908},{"type":"grass","position":[58.374146542021926,0,76.89679247851304],"scale":0.7845293882524387},{"type":"grass","position":[-119.04800669494038,0,49.35486917454294],"scale":0.7753433028956097},{"type":"grass","position":[49.39409906304431,0,67.40970350983925],"scale":0.7905018198206691},{"type":"grass","position":[-1.2896207937113502,0,4.125026630467853],"scale":1.1962760392762215},{"type":"grass","position":[-92.15263797811386,0,-36.117089336297695],"scale":1.2026374446252146},{"type":"grass","position":[-48.27912274504681,0,115.50619375940983],"scale":0.7231583197784869},{"type":"grass","position":[-77.43966662355953,0,46.58227537933286],"scale":0.8021498836857566},{"type":"grass","position":[68.44490036755104,0,33.60566826924531],"scale":1.1294819937376437},{"type":"grass","position":[15.945320808897486,0,10.47032539203331],"scale":0.9526791673843037},{"type":"grass","position":[10.620268818697339,0,6.81629718121216],"scale":0.7600269867776288},{"type":"grass","position":[-27.23354656209147,0,112.22480432480286],"scale":1.1894538060189788},{"type":"grass","position":[-81.62652197128395,0,35.40769445759137],"scale":1.2651073539162216},{"type":"grass","position":[23.422869507464046,0,-6.029178471084719],"scale":1.0632836621681523},{"type":"grass","position":[-0.003974166610292439,0,0.00037589583091545857],"scale":0.9150364239761442},{"type":"grass","position":[27.94620721964353,0,40.53390167696827],"scale":1.0416682707508933},{"type":"grass","position":[-141.18535361941673,0,-38.27161629375428],"scale":1.1356479226733318},{"type":"grass","position":[106.05002737061753,0,38.61597287638563],"scale":0.9371003084475955},{"type":"grass","position":[7.85800153314533,0,-21.818040863615582],"scale":1.0612573144538102},{"type":"grass","position":[5.248450841281217,0,16.44502507949929],"scale":0.9791158630312315},{"type":"grass","position":[-112.55860423817315,0,53.969781256262706],"scale":1.0319853812865294},{"type":"grass","position":[106.45944610914415,0,-3.758291810791275],"scale":0.9060708223163787},{"type":"grass","position":[45.35074620620554,0,-34.427145586590676],"scale":0.79735729894791},{"type":"grass","position":[-51.352096348654754,0,-65.16266376362232],"scale":1.288366791202353},{"type":"grass","position":[-77.25361443469029,0,12.553664875291226],"scale":1.1319590616365},{"type":"grass","position":[-72.00901607615609,0,-108.5202528309267],"scale":1.0315681724603687},{"type":"grass","position":[-80.92762123991275,0,66.31926652530169],"scale":0.7592402986884961},{"type":"grass","position":[-54.94275124843274,0,55.6517387928703],"scale":0.7199092660302844},{"type":"grass","position":[-21.181992775638275,0,20.96133187379889],"scale":0.8090760231804648},{"type":"grass","position":[47.82513620133359,0,-17.26716194562707],"scale":0.8156585647500482},{"type":"grass","position":[51.67884870465661,0,-60.59868158015683],"scale":1.1400325748688855},{"type":"grass","position":[-44.47845898675043,0,-2.8698809867278006],"scale":0.9689573379467117},{"type":"grass","position":[27.14450016344144,0,20.211946151609105],"scale":0.7359304134906255},{"type":"grass","position":[-141.19849842940764,0,0.4690657865273368],"scale":1.0709509024630333},{"type":"grass","position":[-3.653710350542833,0,7.951225791477319],"scale":0.8784340088757794},{"type":"grass","position":[119.97429488501136,0,3.0693172203584336],"scale":0.8490936411323416},{"type":"grass","position":[-19.936282984491427,0,-40.23582887799084],"scale":1.0453921252043226},{"type":"grass","position":[57.353551309068415,0,24.580042454961003],"scale":1.0969500722967036},{"type":"grass","position":[103.56942520798812,0,-67.21213279837977],"scale":0.8113684841082526},{"type":"grass","position":[-42.362308278396476,0,24.780495682778135],"scale":1.0637532518722408},{"type":"grass","position":[-13.880497242078421,0,63.086990297780105],"scale":0.961871306228085},{"type":"grass","position":[-34.73741023241831,0,-36.596299400574644],"scale":1.034333064835716},{"type":"grass","position":[28.632634456725416,0,-138.35092150803234],"scale":1.0361562304917609},{"type":"grass","position":[41.47450925571619,0,-60.868586290337255],"scale":1.0405804165424983},{"type":"grass","position":[28.8761779006969,0,4.755872118611254],"scale":0.8024769196869803},{"type":"grass","position":[-45.50955509199043,0,-23.680583816544225],"scale":1.181449022525702},{"type":"grass","position":[3.4833581130133418,0,128.5204111432674],"scale":0.7492053990791937},{"type":"grass","position":[-12.960297656786922,0,7.85645290802352],"scale":1.2461855956503989},{"type":"grass","position":[12.499517740184997,0,-10.564110826834376],"scale":1.1444592310566164},{"type":"grass","position":[12.93411118095195,0,-16.410125923857382],"scale":0.7527797668374736},{"type":"grass","position":[28.606804731960306,0,35.69250395750095],"scale":1.213486465332261},{"type":"grass","position":[93.31017944365193,0,-70.24745509332173],"scale":1.046797513762967},{"type":"grass","position":[-1.8695343029952973,0,79.55223642741088],"scale":1.1256804771656794},{"type":"grass","position":[-38.75225830797506,0,-17.261584387443893],"scale":1.231024066324093},{"type":"grass","position":[62.18809520380949,0,5.13944259311481],"scale":0.81141061189688},{"type":"grass","position":[47.0422003699972,0,-1.220489958298453],"scale":1.0695891997716507},{"type":"grass","position":[-14.505546023209885,0,4.541507519027084],"scale":0.9865921501154149},{"type":"grass","position":[-22.418987300306288,0,113.91171715445729],"scale":1.2400896884358752},{"type":"grass","position":[13.19030830123815,0,-16.61935092946531],"scale":0.9827725147853449},{"type":"grass","position":[-26.90863852715308,0,49.053413421846805],"scale":0.8568755180114096},{"type":"grass","position":[-143.94956498447002,0,0.21069667210226312],"scale":0.9140862623118602},{"type":"grass","position":[-39.624827265590945,0,140.4943829107537],"scale":1.0703245210994496},{"type":"grass","position":[11.069185566112182,0,-17.80185156558458],"scale":1.0447501265393715},{"type":"grass","position":[47.2739887998126,0,68.32615115629963],"scale":0.7204690731201652},{"type":"grass","position":[30.07988345042894,0,-30.74586414172152],"scale":0.9958953082528069},{"type":"grass","position":[-52.67451944014011,0,-45.46045555665085],"scale":1.1256023377316253},{"type":"grass","position":[145.15489786135328,0,-4.908875894784155],"scale":0.7979665583750001},{"type":"grass","position":[57.718073531473216,0,3.7206325340015147],"scale":1.1345050870584472},{"type":"grass","position":[-22.977554380625026,0,2.18623217896553],"scale":1.281244762579099},{"type":"grass","position":[-1.5863092666036622,0,-6.964635583299546],"scale":0.7303695324252623},{"type":"grass","position":[-87.91424923771775,0,31.456696032266418],"scale":0.8670443384821186},{"type":"grass","position":[-12.040029389764598,0,-34.4477478462656],"scale":0.9277264290837509},{"type":"grass","position":[0.28903899838550545,0,0.13403365255803928],"scale":1.212877298966967},{"type":"grass","position":[44.380260901247865,0,15.767125369628973],"scale":0.9794776471263008},{"type":"grass","position":[-88.29485316940118,0,12.757061327677292],"scale":1.2339126858616893},{"type":"grass","position":[-9.045851642306628,0,91.02386148264767],"scale":1.1460619303604402},{"type":"grass","position":[104.41186060390808,0,33.96107787359231],"scale":0.9931161097282168},{"type":"grass","position":[-12.366268926464409,0,-21.79824442488188],"scale":0.7073910780026557},{"type":"grass","position":[-31.99296336797077,0,16.59381577283514],"scale":1.1420161566017384},{"type":"grass","position":[46.095902851994644,0,103.29379556840571],"scale":0.7304098505012926},{"type":"grass","position":[-20.917325276264798,0,2.088362284237216],"scale":1.2971296309171003},{"type":"grass","position":[-58.22435521432834,0,-39.674245662330335],"scale":1.0738483374190975},{"type":"grass","position":[-140.63950435354536,0,48.61368490992222],"scale":1.0954401595471646},{"type":"grass","position":[-25.916629385624077,0,24.005421958942378],"scale":0.8580394822397619},{"type":"grass","position":[-17.99733670328578,0,19.509370416434766],"scale":1.0609132439087465},{"type":"grass","position":[110.5691560892234,0,-77.0764831327529],"scale":1.258513425084474},{"type":"grass","position":[46.77643333704643,0,-75.63611914760027],"scale":1.1021354275118123},{"type":"grass","position":[-8.11309384567668,0,-18.426344461826766],"scale":1.0239286749096015},{"type":"grass","position":[4.060130484677053,0,46.60854002003068],"scale":1.2703962750652775},{"type":"grass","position":[-63.32538819239594,0,-31.258584116107272],"scale":0.9613145082678174},{"type":"grass","position":[17.66166537348703,0,-41.336227534760944],"scale":1.0967079518485545},{"type":"grass","position":[97.5094639356732,0,-18.76217897967178],"scale":1.153775879726904},{"type":"grass","position":[-28.442610049702214,0,-19.201333899871006],"scale":1.164005895807784},{"type":"grass","position":[103.1425574555459,0,72.06492510804357],"scale":0.7040595573080556},{"type":"grass","position":[-27.535728880025186,0,-34.27656602282497],"scale":0.9291472004172444},{"type":"grass","position":[-91.90937527171549,0,67.76065736514617],"scale":0.8554031312108434},{"type":"grass","position":[33.46237534271627,0,-31.306668578146688],"scale":1.21812245887858},{"type":"grass","position":[9.141228183717667,0,-4.492514501074457],"scale":1.048389086483478},{"type":"grass","position":[-52.47796954560709,0,-19.68650200578416],"scale":0.9887784294662522},{"type":"grass","position":[-29.881770668530702,0,-89.03545592748293],"scale":0.8402013707674072},{"type":"grass","position":[-0.21692118275237893,0,-0.04925471119238776],"scale":0.9631279473673279},{"type":"grass","position":[-17.552482711350176,0,117.32155565877889],"scale":1.2234529805915595},{"type":"grass","position":[-6.799950664209201,0,39.84093071379454],"scale":1.1356775930855783},{"type":"grass","position":[23.410236034567276,0,29.453713129033957],"scale":0.797471258739922},{"type":"grass","position":[-40.236638810051595,0,-18.317442126204416],"scale":1.167915086672815},{"type":"grass","position":[-1.402715035425916,0,69.34951403580224],"scale":0.7755323048253011},{"type":"grass","position":[-0.01766512005272864,0,0.12588730198473863],"scale":1.0653081897230228},{"type":"grass","position":[-7.753521837667287,0,9.086537484332089],"scale":1.0848363167092157},{"type":"grass","position":[-52.02106457631991,0,-40.606390358951586],"scale":0.9030103942043138},{"type":"grass","position":[-11.610807748669744,0,1.033777564690687],"scale":0.8004299894058349},{"type":"grass","position":[-60.16840805316001,0,-105.68922612657788],"scale":1.2678438082045111},{"type":"grass","position":[-99.27084174605795,0,26.410510692616853],"scale":0.7303402825910009},{"type":"grass","position":[-121.50904946131547,0,-33.93917121218624],"scale":1.1111344908370533},{"type":"grass","position":[-54.42607823471696,0,-53.309193636327585],"scale":0.9240913677138034},{"type":"grass","position":[-97.66371779306586,0,90.31526583142522],"scale":0.9523550188219914},{"type":"grass","position":[8.717242997670125,0,2.596455483117563],"scale":0.7314799760419686},{"type":"grass","position":[126.1970763707593,0,21.25721862561648],"scale":1.1126996665360425},{"type":"grass","position":[63.59099016075191,0,49.102288983539054],"scale":0.8886961102485147},{"type":"grass","position":[-78.30786588193011,0,-125.34963592728387],"scale":1.1142140891793404},{"type":"grass","position":[-80.79519407959252,0,-108.42583188271188],"scale":1.008296783115049},{"type":"grass","position":[-64.62483644248853,0,-32.078088741793636],"scale":0.95880698469892},{"type":"grass","position":[-65.56268104840329,0,91.96027796230905],"scale":0.9588105461416679},{"type":"grass","position":[58.54886312693533,0,-98.7213827500498],"scale":0.9983238716378284},{"type":"grass","position":[-32.192810317302836,0,110.39115465727653],"scale":0.9948523684705983},{"type":"grass","position":[-85.79233121808798,0,90.0034848953007],"scale":0.7125092543214625},{"type":"grass","position":[62.77083829407724,0,-4.114519576137876],"scale":0.7883147777735584},{"type":"grass","position":[-5.684506728915529,0,32.18552642141149],"scale":1.147011128418949},{"type":"grass","position":[12.632826112739933,0,22.587439100468647],"scale":0.9285693381488563},{"type":"grass","position":[121.36126895182616,0,-18.113034552699947],"scale":0.9160023028659311},{"type":"grass","position":[42.21851139180833,0,17.2946500052783],"scale":1.1132004909522175},{"type":"grass","position":[-136.3895161708975,0,-32.32384737328831],"scale":1.1628102697378613},{"type":"grass","position":[4.740080925603335,0,-12.754844787401721],"scale":0.8564532124516846},{"type":"grass","position":[-54.403353054188116,0,87.10461690550588],"scale":0.7029949204070679},{"type":"grass","position":[4.479805972883503,0,93.23556746746182],"scale":1.0030119742953505},{"type":"grass","position":[-18.993442199557858,0,28.950365187811347],"scale":0.9802001546370835},{"type":"grass","position":[44.187110780916285,0,-24.645440235815325],"scale":0.7744211774407881},{"type":"grass","position":[-111.10895934564013,0,26.871836889899622],"scale":1.0665281354627196},{"type":"grass","position":[37.71370912542471,0,-3.826357618981638],"scale":1.1060948795014385},{"type":"grass","position":[-40.12439920376124,0,41.7963639552829],"scale":1.0128328578797172},{"type":"grass","position":[-54.06287500350307,0,-42.88752619994321],"scale":0.8192896457687971},{"type":"grass","position":[28.082108371340233,0,-3.408105545950272],"scale":0.7835628623527493},{"type":"grass","position":[-11.47344724852992,0,-19.896495256250798],"scale":0.7620111135832239},{"type":"grass","position":[2.706689390633042,0,28.17201289185195],"scale":0.9537214590288559},{"type":"grass","position":[3.732149763611451,0,-32.810994469423385],"scale":0.8096791995645317},{"type":"grass","position":[34.91834111119037,0,-63.592731150934235],"scale":1.2434469855526173},{"type":"grass","position":[23.4299813289859,0,-22.021218575688955],"scale":1.2406420209931728},{"type":"grass","position":[87.16473044983802,0,-102.18728382506154],"scale":1.1489298881195893},{"type":"grass","position":[-81.94595012227468,0,34.659977953731726],"scale":0.92142815203962},{"type":"grass","position":[-4.66797491707622,0,-8.346760208547035],"scale":0.9322210788917176},{"type":"grass","position":[-22.574216861003276,0,-119.67206231848573],"scale":0.8647455108228677},{"type":"grass","position":[-34.11681081844184,0,-76.76230344302498],"scale":0.9125853084280079},{"type":"grass","position":[58.21438101819651,0,-65.65503121891192],"scale":0.8332203193100586},{"type":"grass","position":[-48.100374144454776,0,-53.27288750969651],"scale":0.8738460124017222},{"type":"grass","position":[4.882340002608481,0,-6.9706419009284115],"scale":0.8141252950616609},{"type":"grass","position":[-33.71598684739894,0,46.92829864035218],"scale":1.1372607853448935},{"type":"grass","position":[12.382092109102539,0,88.21156939482192],"scale":0.9693805727693792},{"type":"grass","position":[1.3502073042700438,0,-2.239719717724072],"scale":0.9488633203488891},{"type":"grass","position":[-31.134915982292277,0,-61.45072829078923],"scale":0.8851492855648238},{"type":"grass","position":[-74.01991034090565,0,-31.536016336526025],"scale":0.861725160249603},{"type":"grass","position":[10.063130868066006,0,0.003937211710288755],"scale":1.0847828245903295},{"type":"grass","position":[3.5808081426738014,0,-1.8723860870177043],"scale":1.0852873336633744},{"type":"grass","position":[-26.14215785623991,0,30.678182254450746],"scale":0.9798884409740543},{"type":"grass","position":[9.0382612484736,0,-102.57241870493833],"scale":0.8695539348799409},{"type":"grass","position":[7.6498397645996645,0,-31.677498864548898],"scale":0.8944302142522865},{"type":"grass","position":[-71.89843568654193,0,-121.03274631830877],"scale":0.9324182214801972},{"type":"grass","position":[23.026350003650585,0,50.790627045676594],"scale":1.1265406394865252},{"type":"grass","position":[-34.63536395667089,0,20.806486460432556],"scale":0.9780595064751377},{"type":"grass","position":[-62.19757205421783,0,91.19723556250196],"scale":1.0707488984224482},{"type":"grass","position":[113.66773974140473,0,37.62241858110347],"scale":0.7240871335039526},{"type":"grass","position":[1.0325705676847337,0,-1.9324274904097107],"scale":0.8750180365175027},{"type":"grass","position":[33.058860633260785,0,-60.06217128880244],"scale":1.0448929001477285},{"type":"grass","position":[-34.3736668012419,0,-19.348803794202716],"scale":1.012395594878637},{"type":"grass","position":[-98.80637363779084,0,-106.85584820276328],"scale":1.1296021097677333},{"type":"grass","position":[-7.93784769137117,0,62.15580506566835],"scale":0.8871476155018463},{"type":"grass","position":[37.03830231501048,0,24.596419219314306],"scale":0.7300270891107729},{"type":"grass","position":[55.19632690895752,0,43.7430490122226],"scale":1.1580623040816147},{"type":"grass","position":[18.018164257413684,0,16.023332896993875],"scale":0.7054320163102528},{"type":"grass","position":[-60.88426156563824,0,-60.7214547739457],"scale":1.0312025121126898},{"type":"grass","position":[4.862876395105168,0,81.58264681012918],"scale":0.749404254998907},{"type":"grass","position":[7.548585939282296,0,125.12636842029055],"scale":1.1503103694707124},{"type":"grass","position":[108.50905747507441,0,94.36292251937168],"scale":0.8317802421904371},{"type":"grass","position":[-1.819845743714497,0,-7.646788777510515],"scale":1.0628318488351334},{"type":"grass","position":[58.94280809732476,0,59.64897928982907],"scale":1.0881139497631775},{"type":"grass","position":[-11.775597259106322,0,22.22961337899936],"scale":0.7594206390901204},{"type":"grass","position":[59.02121688850415,0,125.44382927340988],"scale":1.2402676073595722},{"type":"grass","position":[-5.4806495363599925,0,4.2648440884019205],"scale":0.8760813040243038},{"type":"grass","position":[-28.164894186810706,0,25.04041904856549],"scale":0.8495083212803817},{"type":"grass","position":[3.441358591757946,0,-0.030299415487117055],"scale":1.0348756399508403},{"type":"grass","position":[-80.90810903538463,0,58.920997174448864],"scale":1.0356837957074783},{"type":"grass","position":[-74.45303377659693,0,11.99624063254811],"scale":1.0259246851303274},{"type":"grass","position":[-94.22014550649604,0,-4.137487284243129],"scale":1.284554669478497},{"type":"grass","position":[-89.01768003272635,0,95.72407958795134],"scale":0.7048252622658155},{"type":"grass","position":[77.95704673001764,0,-71.13659002158965],"scale":0.8398326663178125},{"type":"grass","position":[93.68283695988735,0,116.0275499247705],"scale":0.9319492596488913},{"type":"grass","position":[-3.3223692639948217,0,-42.022257242782054],"scale":0.9214624138508137},{"type":"grass","position":[-90.84832131460566,0,37.520524643243135],"scale":1.1711547270194707},{"type":"grass","position":[65.48017955899496,0,-62.99273396822155],"scale":1.120252441018339},{"type":"grass","position":[-10.345961507624788,0,8.804357967492075],"scale":1.0936770323744567},{"type":"grass","position":[21.8012888535596,0,2.2145481238229285],"scale":1.1444243596423422},{"type":"grass","position":[112.64670464697127,0,-6.886791910618539],"scale":1.0250032844094423},{"type":"grass","position":[59.153870135552104,0,115.19597424824735],"scale":1.002930876688687},{"type":"grass","position":[-0.6386950462943122,0,1.796198154170951],"scale":1.2174165126115666},{"type":"grass","position":[-24.3916521509815,0,-143.81605129181455],"scale":1.0777951468041094},{"type":"grass","position":[88.1266154021718,0,-32.316143643330676],"scale":1.296786985728055},{"type":"grass","position":[8.470425076984972,0,-92.40716907579686],"scale":1.2859299985592119},{"type":"grass","position":[28.568919830969552,0,-19.88683698003555],"scale":1.191132562410491},{"type":"grass","position":[-6.77366144256417,0,-134.82243336547157],"scale":0.905095734335558},{"type":"grass","position":[-0.35826015048893756,0,-8.495204259708872],"scale":1.0061937461631303},{"type":"grass","position":[-79.8993158173071,0,60.34104548392955],"scale":0.9814367233649148},{"type":"grass","position":[58.9929619890578,0,-116.84650717276635],"scale":0.7598971542373225},{"type":"grass","position":[-2.6702212069076454,0,-6.111280928370383],"scale":0.7195302152310756},{"type":"grass","position":[16.769162517190864,0,0.24114664912960454],"scale":1.2954137217182464},{"type":"grass","position":[-16.862938001314358,0,-5.9997083974085],"scale":1.2395961254947632},{"type":"grass","position":[23.371884082395265,0,-3.718320094226128],"scale":1.244668049421024},{"type":"grass","position":[-0.021009378485247168,0,-32.354488989120846],"scale":1.1770276849458856},{"type":"grass","position":[-70.76380617512191,0,128.37556170770515],"scale":1.2667271423568727},{"type":"grass","position":[-86.54876394165746,0,113.78026280300368],"scale":0.9742229365914348},{"type":"grass","position":[-35.73447738483675,0,-23.251771879687873],"scale":0.9373168914424599},{"type":"grass","position":[-2.23449696371005,0,-63.997267660572106],"scale":1.0191058927402352},{"type":"grass","position":[-34.341645530668245,0,67.65965603976365],"scale":1.111278744461417},{"type":"grass","position":[-95.17841323585412,0,91.02307748276573],"scale":1.126163897218034},{"type":"grass","position":[51.519929011406035,0,-2.9567589193821204],"scale":0.7885917325289168},{"type":"grass","position":[-21.12494672277622,0,35.561736154705365],"scale":1.2389339082534763},{"type":"grass","position":[91.74406866381162,0,50.38503084824401],"scale":0.8346716757751589},{"type":"grass","position":[-39.35601906434334,0,-3.1668853862295476],"scale":0.8409537157301965},{"type":"grass","position":[-2.8311848684098138,0,9.23684523082907],"scale":1.1713370976368926},{"type":"grass","position":[45.295816518739514,0,90.25444140564792],"scale":1.2049115632740808},{"type":"grass","position":[-74.17432646270233,0,25.440688895272174],"scale":1.0053476354962103},{"type":"grass","position":[-72.46090943327357,0,126.81847561221582],"scale":0.749585621126255},{"type":"grass","position":[-91.75992232776959,0,34.3920090952286],"scale":0.954765945015476},{"type":"grass","position":[26.148595388180627,0,-57.41412207364265],"scale":0.7288004068570018},{"type":"grass","position":[25.46896243903341,0,-108.16375197781129],"scale":0.9716669073929174},{"type":"grass","position":[72.91578446206799,0,13.527826200709034],"scale":0.7036134927869274},{"type":"grass","position":[-90.7836793492837,0,-40.77534587299],"scale":0.8436967983522465},{"type":"grass","position":[10.161529586670992,0,-28.116745440227184],"scale":0.8902699244824712},{"type":"grass","position":[-79.90246052062655,0,0.29488430134554816],"scale":1.2741853749627028},{"type":"grass","position":[-78.98352421885274,0,-27.768002724689953],"scale":1.0461050989320264},{"type":"grass","position":[1.9984677550044372,0,-3.876257198211653],"scale":1.0111049682837767},{"type":"grass","position":[-79.60485579002146,0,-16.56524457238431],"scale":1.1522548998861006},{"type":"grass","position":[61.8116833476774,0,-97.68838285359789],"scale":0.7155118938859715},{"type":"grass","position":[36.78289107094423,0,-32.189150192681986],"scale":1.0392652936977496},{"type":"grass","position":[106.46208951298452,0,-48.91518131328188],"scale":1.2429647356351063},{"type":"grass","position":[-4.796505504092666,0,23.361325376451457],"scale":1.237587159271839},{"type":"grass","position":[27.683842667661906,0,47.91348811304278],"scale":0.921936391225869},{"type":"grass","position":[77.6812532981988,0,62.51909910333703],"scale":1.0334631746129337},{"type":"grass","position":[26.301326370167075,0,-18.156312538886933],"scale":0.7344189107229266},{"type":"grass","position":[39.81342875760503,0,-34.50674681010314],"scale":1.1237909101437427},{"type":"grass","position":[36.93612368724726,0,-37.31256816798756],"scale":0.9198352562063205},{"type":"grass","position":[121.86053873816365,0,-54.17041785488907],"scale":1.2608106416524507},{"type":"grass","position":[-29.75863501198685,0,72.52895453974578],"scale":0.9308668892405502},{"type":"grass","position":[25.467320988064063,0,-9.72559085133176],"scale":1.0363874437802598},{"type":"grass","position":[-0.37675637664855677,0,-0.9388403957056863],"scale":1.2388059871314088},{"type":"grass","position":[50.034821782682926,0,127.41519023165563],"scale":0.8656207608947873},{"type":"grass","position":[-12.8091137557088,0,-37.30022932137699],"scale":0.8708682997166725},{"type":"grass","position":[-5.410079462131746,0,39.395531442704346],"scale":0.7678538137670331},{"type":"grass","position":[-100.96241130183215,0,42.25532620354275],"scale":1.0525554124714644},{"type":"grass","position":[-48.87221838240452,0,7.745879821340726],"scale":0.923032768605585},{"type":"grass","position":[-15.388766888714777,0,-17.887992098721213],"scale":1.1809129268999403},{"type":"grass","position":[5.383026231037274,0,13.879791590650497],"scale":0.7001406309937107},{"type":"grass","position":[59.83677392713732,0,-129.8592626599758],"scale":1.1332248452601328},{"type":"grass","position":[57.12254616261032,0,-26.442293573677322],"scale":1.006452884290082},{"type":"grass","position":[66.3128360692068,0,-58.1507742350808],"scale":1.0044051205144753},{"type":"grass","position":[68.59966615039468,0,54.051634024196275],"scale":1.1146071080669497},{"type":"grass","position":[81.28564803085054,0,-32.61973635965107],"scale":1.2669119523154355},{"type":"grass","position":[-5.888944558141364,0,-24.498290205352962],"scale":1.144034981337106},{"type":"grass","position":[-141.43578202798207,0,39.18414003654103],"scale":1.113389358069539},{"type":"grass","position":[-21.69805190324523,0,1.8817402625095287],"scale":1.1889528778400098},{"type":"grass","position":[-90.75590765732694,0,68.49122826770959],"scale":1.276372460686361},{"type":"grass","position":[-80.67668380381149,0,-84.96427984588922],"scale":1.0093020171310565},{"type":"grass","position":[52.676853283837374,0,-47.34323257753047],"scale":0.815072090573225},{"type":"grass","position":[-32.9097642111507,0,-24.238434422825495],"scale":1.0146240482553779},{"type":"grass","position":[28.400306324551423,0,144.31144497865589],"scale":1.296109851710086},{"type":"grass","position":[26.36162921380044,0,29.64097030230515],"scale":1.2637415683902153},{"type":"grass","position":[-31.725905233938605,0,-120.27606846891406],"scale":0.9680746885707002},{"type":"grass","position":[-30.444800954283217,0,42.280752043375095],"scale":0.7011666061591348},{"type":"grass","position":[-67.33840242638263,0,13.754595000339668],"scale":1.0637729752821061},{"type":"grass","position":[-36.046918771702195,0,104.0936628404179],"scale":1.0189675207566917},{"type":"grass","position":[-78.54607387639969,0,72.88386053235467],"scale":1.139140621788863},{"type":"grass","position":[-63.79512592821966,0,-19.770704735189053],"scale":0.8604224355267576},{"type":"grass","position":[23.109172802061543,0,98.74133062737366],"scale":1.2604953492794695},{"type":"grass","position":[134.71052039572228,0,-0.5215026920161664],"scale":0.8892460415486343},{"type":"grass","position":[-0.9734833786339798,0,-0.8450298690005182],"scale":1.1823606801786886},{"type":"grass","position":[-10.721324142045168,0,127.22891636948566],"scale":1.02317129287027},{"type":"grass","position":[-6.200262289281484,0,-4.311809901421721],"scale":1.1731411749502016},{"type":"grass","position":[-86.72415307727816,0,54.34456430452203],"scale":0.7901456283606938},{"type":"grass","position":[71.39241546251459,0,-123.33957602564071],"scale":1.2476718844706975},{"type":"grass","position":[56.81793669669422,0,133.57106515980672],"scale":1.2521087372055446},{"type":"grass","position":[11.886512695282217,0,62.54748526667905],"scale":1.1754792055660617},{"type":"grass","position":[85.31145721137649,0,-5.8197727834981565],"scale":0.8166719995501939},{"type":"grass","position":[79.65606794465855,0,8.124795955874584],"scale":0.7697667382723036},{"type":"grass","position":[118.76056075956393,0,-88.9577196470883],"scale":1.0264040675024166},{"type":"grass","position":[44.2332684309514,0,61.322307146592806],"scale":1.1783500151041095},{"type":"grass","position":[5.046394798921464,0,3.497766638788714],"scale":1.1987939874842137},{"type":"grass","position":[23.06943972456526,0,-9.575437492094501],"scale":1.023430257474173},{"type":"grass","position":[29.166346179009583,0,-11.57788021067557],"scale":1.2191677806073677},{"type":"grass","position":[12.055035188115994,0,-144.60365014392673],"scale":0.7391784656055207},{"type":"grass","position":[-46.0095513327909,0,-87.84505351255271],"scale":0.9913373628020561},{"type":"grass","position":[-87.30569346061925,0,-91.10566414084396],"scale":1.2907228806386535},{"type":"grass","position":[-49.100183611058114,0,-34.87199449499915],"scale":1.141455784835149},{"type":"grass","position":[-42.8915578127288,0,20.215169554859532],"scale":1.0436628433994306},{"type":"grass","position":[105.12753124788131,0,-100.85124284215985],"scale":1.1349251405103793},{"type":"grass","position":[15.871260340392503,0,-47.38956841839827],"scale":0.962584899888348},{"type":"grass","position":[48.28899085848588,0,52.01832564488417],"scale":1.1578541745006468},{"type":"grass","position":[81.16665156572847,0,-27.984472754232172],"scale":0.8898137205225384},{"type":"grass","position":[110.08514936835142,0,-72.43243810127164],"scale":0.9153418764224368},{"type":"grass","position":[53.39825672321954,0,5.2069020232142735],"scale":1.0939999164104046},{"type":"grass","position":[-10.616909156127521,0,-16.898515265271918],"scale":0.7061646558956179},{"type":"grass","position":[-21.647006450229537,0,-30.369211621426036],"scale":1.0013324928203198},{"type":"grass","position":[55.58298871883259,0,25.872752773307006],"scale":1.0834859486970003},{"type":"grass","position":[3.4011483075315687,0,-1.795439446217705],"scale":1.1445159320365277},{"type":"grass","position":[-93.14035832191581,0,31.916720310479686],"scale":0.8504741379956484},{"type":"grass","position":[86.01859641571673,0,-13.13942622315998],"scale":1.1064169155922576},{"type":"grass","position":[71.39223377655742,0,-130.96269424363493],"scale":1.0333378171178547},{"type":"grass","position":[12.851757842195283,0,-28.204003843448312],"scale":1.161457210023041},{"type":"grass","position":[-16.14912401262322,0,13.86594413441061],"scale":0.7821908462014977},{"type":"grass","position":[-47.32071305178135,0,11.226641363107266],"scale":0.7913148141312977},{"type":"grass","position":[6.012909182340824,0,-0.6411804062886772],"scale":1.0040583417256204},{"type":"grass","position":[-6.476254786300656,0,5.499923956989355],"scale":1.1509060086941798},{"type":"grass","position":[26.596138789762936,0,6.814134100235667],"scale":0.8567388317845415},{"type":"grass","position":[-40.34437711245875,0,63.75963570335224],"scale":0.8658705332697207},{"type":"grass","position":[-46.5338845414383,0,-23.364731095725652],"scale":0.8149122751494337},{"type":"grass","position":[-60.37464426700691,0,126.61022288750489],"scale":1.2776343253424214},{"type":"grass","position":[32.71958238375289,0,-11.330409629719252],"scale":1.2050534356882507},{"type":"grass","position":[-94.33352094263496,0,0.0020915432593353613],"scale":1.0079964324927446},{"type":"grass","position":[-0.8249384902416205,0,-0.14736830385283167],"scale":0.9721909508924591},{"type":"grass","position":[-37.24310983340154,0,-26.865302996314146],"scale":1.0913693218697817},{"type":"grass","position":[30.340577616887956,0,-20.37269074987678],"scale":1.1499760988005812},{"type":"grass","position":[3.7814189017814224,0,-9.24681177147535],"scale":1.0410935398512007},{"type":"grass","position":[74.97962390193557,0,-54.712059367545244],"scale":1.2525116752991898},{"type":"grass","position":[-29.240057892798767,0,-14.749006555020431],"scale":0.7303898117391768},{"type":"grass","position":[-71.46261933941511,0,-34.01602329388763],"scale":0.9807973367619024},{"type":"grass","position":[26.71225753868962,0,1.6293975580021984],"scale":0.9294160131520737},{"type":"grass","position":[55.403675765270286,0,-54.17670802630599],"scale":1.039710724497793},{"type":"grass","position":[-88.89499109653713,0,100.00792648830237],"scale":1.2863783798648736},{"type":"grass","position":[2.0243328318854106,0,-21.793561143962304],"scale":0.7835122613602261},{"type":"grass","position":[77.60346142395055,0,13.595724918925548],"scale":0.8869379504705691},{"type":"grass","position":[-8.70519475407529,0,71.29523795386305],"scale":1.02153639285982},{"type":"grass","position":[-19.80564401779882,0,107.33861894877323],"scale":0.7118607861705268},{"type":"grass","position":[70.76241458284228,0,-78.84232269090334],"scale":1.0078649237750177},{"type":"grass","position":[-25.296270744734255,0,82.36998966055185],"scale":1.2792677826610372},{"type":"grass","position":[6.097466574661636,0,-2.3017401028281004],"scale":0.8727971274396619},{"type":"grass","position":[-18.929720112928898,0,35.828319701631344],"scale":0.7201964657536076},{"type":"grass","position":[-19.685213868833017,0,113.692056812456],"scale":0.8546005074449696},{"type":"grass","position":[-7.063182396377491,0,-7.341884125154978],"scale":0.8099220680457421},{"type":"grass","position":[-69.77468740863141,0,20.28765250676729],"scale":0.917208982383573},{"type":"grass","position":[-92.15320189985755,0,-30.49477048214608],"scale":0.8207072700815796},{"type":"grass","position":[32.07132766095634,0,46.900763317152446],"scale":0.7003990908086403},{"type":"grass","position":[-3.38583898122048,0,-67.28402619677193],"scale":1.0624309984628317},{"type":"grass","position":[-117.00049398738784,0,70.27992794648402],"scale":0.9374192756413651},{"type":"grass","position":[-13.855931435408195,0,-22.222065494817414],"scale":1.1041546999732852},{"type":"grass","position":[-126.66798245964276,0,-24.574981642749663],"scale":1.1041782123684452},{"type":"grass","position":[7.588784968385687,0,-7.707038348408333],"scale":0.929504598564918},{"type":"grass","position":[76.26840591383956,0,-31.967614495955534],"scale":1.0326656219773012},{"type":"grass","position":[134.5201365511726,0,-20.578272673152387],"scale":0.9731404380249854},{"type":"grass","position":[-13.82542958609317,0,-11.748943449176975],"scale":1.0074977396151887},{"type":"grass","position":[57.35144208921766,0,-42.19604916798478],"scale":1.02941887705699},{"type":"grass","position":[16.769911273565206,0,99.50086535151028],"scale":1.2175403481993883},{"type":"grass","position":[128.96241610284477,0,-68.26252014227978],"scale":0.9966037732090383},{"type":"grass","position":[-102.3130334291735,0,11.330875459788016],"scale":0.8686590774798184},{"type":"grass","position":[47.52903961007078,0,-85.84782616763039],"scale":1.0871815943243872},{"type":"grass","position":[20.078587755062347,0,49.34265038271255],"scale":1.100368765789409},{"type":"grass","position":[-87.17552578388802,0,53.24056290740648],"scale":1.2893333294099487},{"type":"grass","position":[-42.16053861293782,0,8.913817327013133],"scale":0.9209807952148499},{"type":"grass","position":[0.7067012940293462,0,3.287411579125922],"scale":0.8310951980180952},{"type":"grass","position":[20.896005733500548,0,27.472843262864448],"scale":0.7949937285452668},{"type":"grass","position":[99.19269758418902,0,-48.587311698745715],"scale":1.2426241868848318},{"type":"grass","position":[9.532267068063328,0,-4.443773976681296],"scale":1.0393413551619584},{"type":"grass","position":[-117.33012895685528,0,-68.59765009176887],"scale":1.0588941412793182},{"type":"grass","position":[-19.226594983619215,0,-144.36786857242876],"scale":1.2491948060415032},{"type":"grass","position":[17.803222003329644,0,4.119131915258349],"scale":0.9305626150934969},{"type":"grass","position":[-81.48094959209676,0,11.317083982418698],"scale":1.210858616019491},{"type":"grass","position":[-13.092690208839997,0,-63.72208092423358],"scale":0.8735682948420438},{"type":"grass","position":[-3.276741803078274,0,-21.29239840610362],"scale":1.290609626924406},{"type":"grass","position":[-31.224539361139733,0,-13.13657933857649],"scale":0.7437103009450473},{"type":"grass","position":[-61.39946527882575,0,87.33290136296685],"scale":0.9424617229042165},{"type":"grass","position":[54.09489763737665,0,-38.20831140552339],"scale":0.7748011368783672},{"type":"grass","position":[-42.596107848295645,0,82.33153624213216],"scale":1.0058020328910149},{"type":"grass","position":[56.564232820310956,0,73.54148626295503],"scale":0.9751007726954435},{"type":"grass","position":[-10.142489048532543,0,-54.99101609950411],"scale":1.1173461854153148},{"type":"grass","position":[-10.85858654997087,0,112.99043720398608],"scale":1.2722249917741941},{"type":"grass","position":[0.5645204809947911,0,-0.6036501093559733],"scale":1.2298478237268429},{"type":"grass","position":[-2.3493083624264073,0,0.04295600697653107],"scale":1.2374696207325384},{"type":"grass","position":[-5.20022817034088,0,73.48913902536547],"scale":0.7903559928955182},{"type":"grass","position":[-12.514602400581843,0,-19.729442352904798],"scale":0.9530547714764721},{"type":"grass","position":[-148.42312575382866,0,12.323516016015201],"scale":0.7176421195798998},{"type":"grass","position":[-129.46037936770745,0,57.76177981428924],"scale":1.005426032252152},{"type":"grass","position":[-35.262426335564356,0,22.56422195611274],"scale":1.193014378650018},{"type":"grass","position":[-64.83852439141849,0,43.09430317721278],"scale":1.0058266584475237},{"type":"grass","position":[-31.035369979046244,0,-64.74156542582472],"scale":1.2921519458772597},{"type":"grass","position":[29.93079658360208,0,17.3810208994518],"scale":1.2521298793175246},{"type":"grass","position":[-39.060074434006275,0,-12.14414949229512],"scale":1.1175833604009264},{"type":"grass","position":[5.71278515210655,0,93.52679366979191],"scale":0.7009386894522711},{"type":"grass","position":[29.019767015364142,0,2.317806856183224],"scale":0.7253653002852553},{"type":"grass","position":[139.64426518066594,0,-13.573067383096717],"scale":1.227316760480094},{"type":"grass","position":[-24.899410441372257,0,39.04492171779965],"scale":0.7332702141736651},{"type":"grass","position":[0.1903127433836066,0,54.82521158597055],"scale":1.272579945646232},{"type":"grass","position":[52.076083656875,0,134.49105990689273],"scale":1.0975861986067488},{"type":"grass","position":[45.38160069213777,0,32.899251390823125],"scale":0.85357196861422},{"type":"grass","position":[13.810279970967313,0,-13.006872315528234],"scale":1.1596707631710959},{"type":"grass","position":[-111.63072525156763,0,49.85505185279438],"scale":0.9248718370430231},{"type":"grass","position":[-82.93547751721657,0,-56.6143945082458],"scale":0.9415974553585325},{"type":"grass","position":[50.47854951977472,0,-80.48162251764194],"scale":1.1513511607341447},{"type":"grass","position":[107.18686466999432,0,-4.015132151243916],"scale":0.8252760036655113},{"type":"grass","position":[55.22011747152467,0,-57.1680643031262],"scale":1.0041687368610808},{"type":"grass","position":[-122.8035651090765,0,-74.02750730667933],"scale":1.0498022640281683},{"type":"grass","position":[96.47449889544535,0,-6.055835528625486],"scale":1.175876646019816},{"type":"grass","position":[135.37641331021052,0,-15.936735359531289],"scale":1.0800524915810215},{"type":"grass","position":[50.92329200238008,0,-33.7115701287356],"scale":0.7365690838432635},{"type":"grass","position":[-119.43176091821724,0,78.57656109725085],"scale":0.7134836865820058},{"type":"grass","position":[-2.786891769665625,0,9.58514068115998],"scale":0.9644457565582467},{"type":"grass","position":[3.1143945419416865,0,-28.07260060244413],"scale":1.0960059773239654},{"type":"grass","position":[64.06655323199583,0,-37.64352829156434],"scale":1.2357106084047114},{"type":"grass","position":[-27.940027379939675,0,-64.02240053904806],"scale":1.1717764553735956},{"type":"grass","position":[-10.750152098817804,0,-3.2831227182981966],"scale":0.8202304556374468},{"type":"grass","position":[65.4576405529545,0,52.19102114206312],"scale":0.8887842633514832},{"type":"grass","position":[82.90588550377954,0,-72.64327364831667],"scale":1.14216561363874},{"type":"grass","position":[-29.573415464393396,0,-21.144161705370337],"scale":1.2940998759363243},{"type":"grass","position":[-94.95529876174226,0,-24.639940889213836],"scale":1.0368778072266998},{"type":"grass","position":[-19.909135041223948,0,-40.73965670109105],"scale":1.173430214484237},{"type":"grass","position":[33.99234783330034,0,-35.51167056303002],"scale":0.7656289684285761},{"type":"grass","position":[44.69139945221284,0,-49.282358293587535],"scale":1.2385803325229237},{"type":"grass","position":[5.570521942330638,0,48.08839729779631],"scale":1.184782750914842},{"type":"grass","position":[19.549123139428236,0,36.98805244334048],"scale":1.2169638503948046},{"type":"grass","position":[93.47159655870105,0,-26.48297652930852],"scale":0.7245807775563011},{"type":"grass","position":[-95.71870431304359,0,-56.197859862068185],"scale":0.7104565672154749},{"type":"grass","position":[-89.59754707035007,0,65.09781773081703],"scale":0.9839187890838794},{"type":"grass","position":[82.68860572275554,0,-110.5392651469863],"scale":1.1418739558351678},{"type":"grass","position":[-91.77631361200147,0,-96.23777000555303],"scale":0.7199787925901623},{"type":"grass","position":[11.835290390330858,0,137.1753570335962],"scale":1.251183950755978},{"type":"grass","position":[111.52398387067447,0,-9.47807295472638],"scale":1.015863914466153},{"type":"grass","position":[-13.732117618068676,0,90.03787438807882],"scale":0.9134568215949347},{"type":"grass","position":[89.54098821719195,0,56.01384190966044],"scale":1.2154939793704287},{"type":"grass","position":[-43.7698121759624,0,6.921040378786402],"scale":0.7496972295923089},{"type":"grass","position":[23.097738474942446,0,-87.32398997881103],"scale":1.2432684809107308},{"type":"grass","position":[-0.40399691618781947,0,-0.5054098028897039],"scale":0.8568723358182382},{"type":"grass","position":[-23.778303004357483,0,-12.599109509090269],"scale":0.7390772247894768},{"type":"grass","position":[17.911845797838463,0,49.73431714582133],"scale":0.8449573318747557},{"type":"grass","position":[13.783715875194828,0,110.26852720024458],"scale":1.0780059268329887},{"type":"grass","position":[20.805954774748482,0,22.143887632713742],"scale":1.0415031282067937},{"type":"grass","position":[123.13894184276779,0,17.17418600636792],"scale":1.0411248018360293},{"type":"grass","position":[34.634534518272886,0,-11.542266134466432],"scale":0.9138246031114289},{"type":"grass","position":[5.3010352554125415,0,-19.867947765261746],"scale":1.2429487279235407},{"type":"grass","position":[-64.98191137075821,0,-90.08305697963948],"scale":0.704342256262914},{"type":"grass","position":[9.086713655996688,0,18.090437127996612],"scale":1.2364289870687841},{"type":"grass","position":[-110.93371250436053,0,29.472898212451568],"scale":0.8511378336895974},{"type":"grass","position":[36.047338472348,0,41.74866174560363],"scale":1.0733596570198203},{"type":"grass","position":[-42.66047759186064,0,96.47131864415323],"scale":1.132234896091554},{"type":"grass","position":[-112.93023294638097,0,15.674440387475128],"scale":0.7009388001491476},{"type":"grass","position":[78.57860986006082,0,53.444501890528095],"scale":0.8449503958331892},{"type":"grass","position":[3.42262053254897,0,-2.3291852633137258],"scale":0.7209631745846004},{"type":"grass","position":[121.13318854220059,0,13.23980333303765],"scale":1.200421036411995},{"type":"grass","position":[-59.5857583993499,0,-53.60787194430611],"scale":1.197134548453385},{"type":"grass","position":[59.40295540630998,0,33.32803252777089],"scale":1.0217588391069605},{"type":"grass","position":[96.62114934841219,0,63.20555005181873],"scale":0.9566922008027141},{"type":"grass","position":[-92.66847253587645,0,-90.11739636843417],"scale":0.8859281557052282},{"type":"grass","position":[62.91909841790303,0,-2.2398346573498067],"scale":1.1243422573987736},{"type":"grass","position":[29.33222870526339,0,62.706239141777786],"scale":1.1885478422762177},{"type":"grass","position":[-68.78148960821056,0,-77.85428299143034],"scale":1.0831862578991027},{"type":"grass","position":[75.44397354585469,0,5.9312514509388965],"scale":1.2721437833430063},{"type":"grass","position":[-6.389439013521342,0,16.3988044851667],"scale":0.9290803784043962},{"type":"grass","position":[-56.247214249992005,0,54.72141657774547],"scale":1.0791122035272984},{"type":"grass","position":[-7.175399185755512,0,-5.126251969992807],"scale":1.1138443288344524},{"type":"grass","position":[-105.70791514498846,0,26.548617533134728],"scale":1.294852700567531},{"type":"grass","position":[-115.36895236673266,0,31.068215576915403],"scale":0.8089278414998149},{"type":"grass","position":[6.827486061149816,0,8.676214298729077],"scale":0.9951032509409456},{"type":"grass","position":[-14.90361042038975,0,-54.86682749152135],"scale":0.7947867453352084},{"type":"grass","position":[55.21883628902268,0,41.63598908982968],"scale":1.0830632182690136},{"type":"grass","position":[44.03936015515153,0,-42.37124232072133],"scale":0.7570770972682623},{"type":"grass","position":[63.3840492491612,0,-22.743196909168955],"scale":1.2434601997487522},{"type":"grass","position":[72.76053667040298,0,83.51230544992033],"scale":1.086279151513288},{"type":"grass","position":[25.810869914927018,0,-8.283304642317246],"scale":1.248224950789711},{"type":"grass","position":[79.12438069029658,0,-64.7736105335447],"scale":1.0812785645976806},{"type":"grass","position":[23.917366002307276,0,-29.839813667058852],"scale":1.1813072821188326},{"type":"grass","position":[-75.59279178275408,0,4.0486188202660465],"scale":0.7948292917864084},{"type":"grass","position":[17.25892061004398,0,-1.642121922709176],"scale":1.0365472541836227},{"type":"grass","position":[16.00051119151573,0,44.73007943449695],"scale":0.7832886672146132},{"type":"grass","position":[-12.320629230520789,0,-18.41613553585099],"scale":1.0405216905332915},{"type":"grass","position":[-7.1933117856313755,0,3.2411033860499407],"scale":1.0186032771315012},{"type":"grass","position":[6.277745234371647,0,11.076137314989039],"scale":1.295174814792078},{"type":"grass","position":[49.48052119143777,0,-127.89188890833404],"scale":0.9498400542832718},{"type":"grass","position":[-32.9879889488782,0,23.308350905714295],"scale":0.994858300346042},{"type":"grass","position":[-49.321552947863054,0,-78.51366256773169],"scale":0.8733505636737351},{"type":"grass","position":[-73.25580316779546,0,14.556934177037826],"scale":1.023922161666185},{"type":"grass","position":[67.1722755064863,0,81.33307602017017],"scale":0.8064468334397924},{"type":"grass","position":[-62.9208047302725,0,-104.72746187404309],"scale":0.7371817611309359},{"type":"grass","position":[2.8495793323734535,0,-105.53517207052062],"scale":0.8871833902439064},{"type":"grass","position":[24.573783955263874,0,144.10356386168115],"scale":1.2363671380680645},{"type":"grass","position":[-27.79378752148452,0,-88.59287270782305],"scale":1.2791565300827261},{"type":"grass","position":[1.3756272641555474,0,48.214404261593955],"scale":0.7287108415862572},{"type":"grass","position":[147.5623945397556,0,-17.951701653054894],"scale":1.2266210655206597},{"type":"grass","position":[-27.566712764771864,0,105.79007211621087],"scale":1.186497533657331},{"type":"grass","position":[56.78795955614579,0,45.12280911151399],"scale":1.162113861236112},{"type":"grass","position":[-130.71485163346358,0,21.609750522329172],"scale":1.1574165448538225},{"type":"grass","position":[-20.420239457323802,0,-95.81426211031501],"scale":0.7328230007495433},{"type":"grass","position":[-30.85962438126337,0,38.1102926363158],"scale":0.9909445282056423},{"type":"grass","position":[28.040114573082512,0,51.021984710317355],"scale":1.2146283049520514},{"type":"grass","position":[89.34435037783985,0,89.96696985530153],"scale":0.9218489196884001},{"type":"grass","position":[119.39437380297156,0,-73.85056979105282],"scale":1.2755859871160355},{"type":"grass","position":[6.70277431133952,0,-1.0261103031195205],"scale":1.2425097896989743},{"type":"grass","position":[-0.008648156865009988,0,35.63528600613183],"scale":1.1780364570485813},{"type":"grass","position":[-77.79311077871053,0,14.206755747687838],"scale":1.1397750935469577},{"type":"grass","position":[-143.00819301180334,0,4.524130225025579],"scale":1.0481000863428371},{"type":"grass","position":[-30.69454734157696,0,-118.90238470431545],"scale":0.8811520633148802},{"type":"grass","position":[-90.96462889531607,0,-50.86893000746647],"scale":0.9818395912586515},{"type":"grass","position":[-16.840444135379574,0,-119.0714804203955],"scale":1.228846761435744},{"type":"grass","position":[-2.5226293786026583,0,-84.52676207380483],"scale":0.8434548801388215},{"type":"grass","position":[0.34091849382144335,0,-3.1891167312019966],"scale":1.2694059726702018},{"type":"grass","position":[-9.593749996225746,0,77.12162435285138],"scale":0.8359762728790254},{"type":"grass","position":[7.961033968189419,0,-22.94809086436209],"scale":1.103184737296781},{"type":"grass","position":[-14.162083366865932,0,-112.99667056213701],"scale":1.0060446823876412},{"type":"grass","position":[79.81629490128002,0,57.958454839172255],"scale":0.8161160391928565},{"type":"grass","position":[81.92602003990726,0,-63.16882750819948],"scale":1.2097868885501697},{"type":"grass","position":[-6.055853157054494,0,1.321810635005604],"scale":1.2418661663883925},{"type":"grass","position":[2.2009626658071553,0,-7.242375942272993],"scale":1.1976161151921745},{"type":"grass","position":[24.294862538309246,0,-1.5839514030368487],"scale":0.7247336887240069},{"type":"grass","position":[-3.1381348710018346,0,14.603322813684388],"scale":0.819637228431606},{"type":"grass","position":[-35.289003535012235,0,41.54287700084837],"scale":0.7427165182712726},{"type":"grass","position":[-108.63483773977194,0,-5.523955201265084],"scale":0.8599190060147736},{"type":"grass","position":[12.847867779563847,0,9.60338389850826],"scale":0.9190395639669326},{"type":"grass","position":[96.2489984826661,0,39.926603118066176],"scale":1.0684196181125951},{"type":"grass","position":[119.82745013431116,0,73.206140477283],"scale":1.2261446815644668},{"type":"grass","position":[50.66862456669976,0,112.09090248222758],"scale":1.1187404391603348},{"type":"grass","position":[-40.8589789760707,0,-25.856208240306064],"scale":0.9984291197572555},{"type":"grass","position":[61.86097455686222,0,66.42893299171303],"scale":1.0494133477328957},{"type":"grass","position":[-26.954470411030915,0,-30.1386041967443],"scale":0.9140119699519331},{"type":"grass","position":[28.349228272430228,0,26.85017658243395],"scale":1.1101140770115854},{"type":"grass","position":[2.389668551310406,0,-37.108161246725686],"scale":0.8163596538704185},{"type":"grass","position":[-86.3909936622113,0,34.9563265371679],"scale":1.256967385902084},{"type":"grass","position":[27.163998065928208,0,30.457260724011523],"scale":1.07986416726014},{"type":"grass","position":[-56.639229396303115,0,12.249748678947254],"scale":1.1281149025276231},{"type":"grass","position":[14.118837753852336,0,27.858687154008322],"scale":1.2902584400822112},{"type":"grass","position":[-50.305330650385926,0,91.05127484501058],"scale":0.961099085025765},{"type":"grass","position":[56.39766299457894,0,-18.7538935989486],"scale":1.1712914223415587},{"type":"grass","position":[35.59912655718183,0,-94.34996487278597],"scale":1.050140195086312},{"type":"grass","position":[-1.5174437779849175,0,-2.3691433324454545],"scale":1.0784239807256029},{"type":"grass","position":[10.648369671047048,0,-0.706736573713033],"scale":0.8572632017128023},{"type":"grass","position":[-55.15778793123925,0,2.9524697303193994],"scale":1.0462584739283767},{"type":"grass","position":[95.90770431906618,0,-35.486122857101165],"scale":1.1790769318936567},{"type":"grass","position":[29.29715494374421,0,29.789533612375717],"scale":1.2801775021615747},{"type":"grass","position":[-3.626916140018804,0,-16.706014261666848],"scale":1.1913145279470836},{"type":"grass","position":[0.9216942076729232,0,23.33745196781481],"scale":1.2650296013731248},{"type":"grass","position":[-147.31587469787107,0,1.223194801518434],"scale":1.1538390150097726},{"type":"grass","position":[26.737722679706664,0,-52.00225878760451],"scale":0.7646301065827643},{"type":"grass","position":[2.097722276510505,0,-54.00044600452784],"scale":1.2613965750086704},{"type":"grass","position":[8.147379799976635,0,60.512027370398215],"scale":0.730752208229965},{"type":"grass","position":[76.52493911560741,0,-108.10817710455966],"scale":0.7949733354803521},{"type":"grass","position":[0.09091346982032611,0,0.3458025595251097],"scale":1.2417697691240221},{"type":"grass","position":[-72.65647700154987,0,-92.51375765822534],"scale":1.2028256029558544},{"type":"grass","position":[71.41307435641176,0,-49.59948837809845],"scale":1.113115605887283},{"type":"grass","position":[-61.62733954203283,0,77.3060716155001],"scale":0.8491297870306465},{"type":"grass","position":[-9.119766382136278,0,-11.721914584352055],"scale":1.1476724965677554},{"type":"grass","position":[-63.499306053017264,0,-13.521847062835453],"scale":1.2731020333315812},{"type":"grass","position":[124.0012026010991,0,61.993387080476644],"scale":1.141054919208027},{"type":"grass","position":[-3.7860230356957447,0,-28.66980309452079],"scale":0.8099519916936869},{"type":"grass","position":[-66.12267203056788,0,71.34482515581543],"scale":0.8446571970732741},{"type":"grass","position":[-86.1666075350275,0,39.17045590542745],"scale":0.9172414453441183},{"type":"grass","position":[25.743058806296744,0,20.235890813421605],"scale":1.1381491671066564},{"type":"grass","position":[44.751210278860135,0,87.6729245729077],"scale":0.9147690776400765},{"type":"grass","position":[51.50362128071602,0,-10.360022984250376],"scale":1.1817594405358647},{"type":"grass","position":[2.7665136669639168,0,-6.428771987156334],"scale":0.9979763070853486},{"type":"grass","position":[-43.71977450641861,0,107.64840866550506],"scale":0.7164592045542971},{"type":"grass","position":[-110.30476071712742,0,84.61371713600025],"scale":1.182433036488058},{"type":"grass","position":[-32.45647096686186,0,16.219692885084626],"scale":0.9876324584313374},{"type":"grass","position":[-38.08919496622584,0,-102.97689761973994],"scale":1.0668587192973735},{"type":"grass","position":[15.902434557889881,0,-72.23858059836762],"scale":1.1145280462049834},{"type":"grass","position":[-31.22240605945682,0,-21.173536912838724],"scale":0.702489288560695},{"type":"grass","position":[-81.20205798095301,0,40.483435769721744],"scale":0.7335700971819687},{"type":"grass","position":[-43.937016591555825,0,-12.71374345935024],"scale":0.8672176102102922},{"type":"grass","position":[-130.4141717810219,0,53.72224765278745],"scale":1.2435097729633218},{"type":"grass","position":[13.439025010834616,0,-53.02289647137559],"scale":0.8976336544628544},{"type":"grass","position":[-28.63523445884216,0,-21.66736490148797],"scale":0.9472094403260104},{"type":"grass","position":[-16.995456887553335,0,-3.5547247751624282],"scale":0.7717891956151192},{"type":"grass","position":[45.84300073841738,0,-27.171328244093157],"scale":0.7167689058803237},{"type":"grass","position":[-87.79526923661409,0,29.343611211567428],"scale":0.9152681601682385},{"type":"grass","position":[-2.762446142799395,0,0.9559526710692783],"scale":1.2173596225374153},{"type":"grass","position":[-9.210325410156594,0,-93.76959284282945],"scale":0.8181922294472631},{"type":"grass","position":[59.05121869789182,0,-22.49033763673177],"scale":1.2311816307585328},{"type":"grass","position":[13.163847013262309,0,-16.0078211490206],"scale":0.9204742061124674},{"type":"grass","position":[91.34357999915639,0,-17.17621921935461],"scale":1.0804618859709163},{"type":"grass","position":[43.345809731966,0,-91.48723719098342],"scale":0.9569302157739141},{"type":"grass","position":[26.97784702124106,0,40.44163591994581],"scale":0.8988875523206273},{"type":"grass","position":[115.26133610066061,0,44.316034531219294],"scale":1.2753778580659678},{"type":"grass","position":[60.43770188460437,0,-8.213771200279506],"scale":1.0883864942147288},{"type":"grass","position":[1.4393872008706534,0,82.18597399568365],"scale":1.1071772324578368},{"type":"grass","position":[-44.96018852755751,0,18.638951747724605],"scale":0.7829213709568862},{"type":"grass","position":[-119.20016084584502,0,-41.98819628577233],"scale":1.2656059120764955},{"type":"grass","position":[-59.37756448394218,0,119.6575951157755],"scale":1.17463448736234},{"type":"grass","position":[-80.54604457921265,0,-21.914288879146234],"scale":0.78843683161187},{"type":"grass","position":[-35.1205651020132,0,60.491171948808685],"scale":0.9742567000190832},{"type":"grass","position":[59.51396412530602,0,27.62273049975279],"scale":0.9034253801676699},{"type":"grass","position":[90.09010959693533,0,-38.765067669347275],"scale":1.1075856516797138},{"type":"grass","position":[87.11415562016431,0,-97.71831116172648],"scale":1.2020849536961715},{"type":"grass","position":[94.97624770700811,0,-17.512910287689838],"scale":1.1958061907836204},{"type":"grass","position":[54.095559216085576,0,-48.41020884573899],"scale":0.7468887305831526},{"type":"grass","position":[-126.63928306668974,0,34.81058598452179],"scale":1.1424985791389461},{"type":"grass","position":[-49.31898767620478,0,110.48500266304686],"scale":0.9745400432520667},{"type":"grass","position":[-37.48315009235992,0,17.598547893845343],"scale":1.0617506609360035},{"type":"grass","position":[-46.49491108703591,0,-114.44519565813317],"scale":0.9425548522447429},{"type":"grass","position":[-38.276702164794074,0,-49.51137384308822],"scale":1.0501265819134262},{"type":"grass","position":[8.557526070886613,0,6.006269507759047],"scale":1.135288152768793},{"type":"grass","position":[46.52101163737756,0,-41.518029576318824],"scale":0.9494845606596933},{"type":"grass","position":[-36.7127105979772,0,130.84977770232157],"scale":0.9659438991669114},{"type":"grass","position":[6.225546008591228,0,-2.5478418819567685],"scale":0.7811817999927024},{"type":"grass","position":[-38.628649026843654,0,-86.62632421777471],"scale":0.9884464112044016},{"type":"grass","position":[-37.07084937242812,0,-42.898336299644306],"scale":0.9107449958243162},{"type":"grass","position":[-38.810107755057885,0,107.79567610681107],"scale":1.1582586037315796},{"type":"grass","position":[-18.127216831526248,0,-33.19527447126521],"scale":0.8990070742936872},{"type":"grass","position":[-140.4864292007446,0,-50.69926288856958],"scale":1.227982286043722},{"type":"grass","position":[47.90663698366666,0,100.82138832388567],"scale":0.955431356090704},{"type":"grass","position":[-13.563184038907385,0,2.91548359193216],"scale":1.2367268583829523},{"type":"grass","position":[-14.626587374526135,0,15.438859098777758],"scale":0.9110732830191147},{"type":"grass","position":[-86.09007713607147,0,-72.63521448614988],"scale":0.7167263526835339},{"type":"grass","position":[45.80471278560245,0,20.38153130541424],"scale":0.7839545934069737},{"type":"grass","position":[27.857201139275887,0,94.00173536719939],"scale":0.776813445243706},{"type":"grass","position":[-5.647675533818737,0,-14.319053041225498],"scale":1.2877673996995593},{"type":"grass","position":[44.75477805669935,0,38.75634947146678],"scale":1.1556181413492932},{"type":"grass","position":[50.47377617829529,0,57.5349928940084],"scale":0.912486739478683},{"type":"grass","position":[-52.593812486827915,0,24.282710344171957],"scale":0.7334503692039182},{"type":"grass","position":[-97.40055414303322,0,-79.50641770148196],"scale":0.8885010539032394},{"type":"grass","position":[54.48895194139641,0,-51.3049938833286],"scale":0.8180791798172458},{"type":"grass","position":[-7.930414026922364,0,-90.17695438889218],"scale":1.2204704611674393},{"type":"grass","position":[-92.47105533709271,0,-81.10011628858354],"scale":1.1257787881305221},{"type":"grass","position":[7.298461903012332,0,4.489994705879598],"scale":1.0849677699157607},{"type":"grass","position":[32.21232323225342,0,-29.363355988715657],"scale":1.0868390228645837},{"type":"grass","position":[21.95077299659834,0,8.505137080285882],"scale":1.2095211683304603},{"type":"grass","position":[-80.60471549343016,0,-70.88043957688991],"scale":0.7831880871058898},{"type":"grass","position":[-119.89618105840053,0,-1.14618648056309],"scale":1.0521137580824793},{"type":"grass","position":[7.615179969040948,0,-124.37438612579429],"scale":1.040794188789684},{"type":"grass","position":[4.785475927348074,0,-49.219747049569925],"scale":1.2155361892073226},{"type":"grass","position":[9.322060157565028,0,128.4989342189353],"scale":1.0187866133191334},{"type":"grass","position":[-20.099494203158933,0,8.549061930380548],"scale":1.200592269073006},{"type":"grass","position":[-43.831731787855226,0,-11.738189814998421],"scale":1.1918528141356828},{"type":"grass","position":[-72.5587261555203,0,50.501753316682375],"scale":0.8100447773402497},{"type":"grass","position":[67.87864963566928,0,107.90612887429033],"scale":0.9382659961475484},{"type":"grass","position":[-131.37236990036845,0,45.63382503247646],"scale":0.8389315301017948},{"type":"grass","position":[62.434179825279855,0,0.2893629969947376],"scale":0.9971276445052175},{"type":"grass","position":[73.42242005805248,0,-26.07497953451002],"scale":0.7399589694941572},{"type":"grass","position":[-39.86253394471249,0,112.84194952720355],"scale":1.1951557503575123},{"type":"grass","position":[44.72033754372919,0,-88.39647079362287],"scale":0.9151559245275648},{"type":"grass","position":[-13.703274987867971,0,-116.48131522323106],"scale":1.0370079823088112},{"type":"grass","position":[66.40944101337449,0,-125.77782056635789],"scale":0.8232295617538126},{"type":"grass","position":[43.58018817560999,0,86.4309934219027],"scale":0.9442746476876633},{"type":"grass","position":[-1.7515072465338206,0,-2.378717412555966],"scale":0.783018276491918},{"type":"grass","position":[-1.6757204258617688,0,-124.1775101023492],"scale":1.1094824341148337},{"type":"grass","position":[-81.20246700728838,0,-33.40587540515358],"scale":1.2796853770291636},{"type":"grass","position":[39.33863696272224,0,136.55510547156192],"scale":0.9801524316281671},{"type":"grass","position":[-51.939695291897245,0,118.13290361641468],"scale":0.7881345936081046},{"type":"grass","position":[79.48393399584296,0,-22.81448431790029],"scale":1.1312038929083645},{"type":"grass","position":[123.67256292206328,0,16.361572475565854],"scale":1.0473304732403126},{"type":"grass","position":[1.0630872585703857,0,2.065259642666893],"scale":0.7878872264256267},{"type":"grass","position":[-32.95842849631787,0,2.0482279272696227],"scale":0.8769035553264168},{"type":"grass","position":[-3.5523952235517813,0,108.96144420056525],"scale":1.2118985453687665},{"type":"grass","position":[-98.9597061310824,0,-79.47574257572828],"scale":0.9339238216558983},{"type":"grass","position":[85.39619408166979,0,-108.4497099105753],"scale":0.9201249235783213},{"type":"grass","position":[3.5295406739458177,0,-10.097125820243695],"scale":1.0650669956269476},{"type":"grass","position":[-75.62542165152793,0,-109.95458493185515],"scale":0.7307872431109443},{"type":"grass","position":[-125.66064035553381,0,-21.029483809298096],"scale":0.9438605541768689},{"type":"grass","position":[-21.25556353482812,0,-45.52250966472478],"scale":1.080025832681314},{"type":"grass","position":[12.922064039920098,0,25.04660669594429],"scale":1.162272854368826},{"type":"grass","position":[-86.41237005248385,0,16.564521786246402],"scale":0.8827663415988196},{"type":"grass","position":[-16.026023793663175,0,84.35069664312365],"scale":0.9630420425871936},{"type":"grass","position":[-55.95516755258788,0,10.78591647992824],"scale":1.0185272106033645},{"type":"grass","position":[24.944251677195165,0,-77.61617096838488],"scale":0.9302544048656212},{"type":"grass","position":[15.303756368808545,0,5.641433625352341],"scale":1.0531829997859457},{"type":"grass","position":[-56.38885676458641,0,-29.163121768345764],"scale":1.1455419348869538},{"type":"grass","position":[56.65769591705932,0,-80.39972034189259],"scale":0.9705089808737707},{"type":"grass","position":[-87.87064300561003,0,-94.19193715542193],"scale":0.8778530033926696},{"type":"grass","position":[77.06338757747015,0,32.6573891473776],"scale":0.9636416414391329},{"type":"grass","position":[147.094247806239,0,7.941042539722934],"scale":0.9710887445830756},{"type":"grass","position":[-32.486845873453376,0,24.899133036065432],"scale":1.0245214945339955},{"type":"grass","position":[-127.26889278011035,0,59.12092905205947],"scale":1.0762871135972563},{"type":"grass","position":[-31.120477440613772,0,32.29964108486938],"scale":1.1291293020710365},{"type":"grass","position":[92.27624826719959,0,92.93111965324536],"scale":0.9921673682311156},{"type":"grass","position":[29.601172415994753,0,85.28418520578983],"scale":0.7572856564527648},{"type":"grass","position":[2.7885660107318033,0,82.28298069845752],"scale":1.0602654106026717},{"type":"grass","position":[-12.477695796958328,0,13.372361229664138],"scale":0.7212703845911429},{"type":"grass","position":[55.206045880367476,0,9.30449464891544],"scale":0.953396189314395},{"type":"grass","position":[114.50273384555005,0,-67.40221782911426],"scale":1.0243714542173001},{"type":"grass","position":[2.1293176464763666,0,-0.49429092504183364],"scale":0.8154588843092782},{"type":"grass","position":[6.02251220699001,0,-3.2086899834135836],"scale":1.1672176966864933},{"type":"grass","position":[-0.3407716831002707,0,9.709503829714091],"scale":1.2641737160142976},{"type":"grass","position":[-51.24377736236864,0,-49.36377772089373],"scale":1.011476016693791},{"type":"grass","position":[6.827675754468614,0,22.348829164565757],"scale":0.9455120761780568},{"type":"grass","position":[-8.790954320096896,0,-144.9428808512849],"scale":0.7782913086618107},{"type":"grass","position":[119.63524538160017,0,-8.85853887530273],"scale":0.9373957070739015},{"type":"grass","position":[-51.603824245369296,0,-99.3577656939001],"scale":1.114873670274827},{"type":"grass","position":[30.235956687895175,0,46.3643241453898],"scale":0.8123405395415547},{"type":"grass","position":[34.4447104572764,0,-39.779336280204724],"scale":1.2833827552307602},{"type":"grass","position":[4.083159802703095,0,-61.293176010908375],"scale":1.011052563503391},{"type":"grass","position":[60.44995633130648,0,-9.257370440540264],"scale":0.9967333812711089},{"type":"grass","position":[34.88676551676097,0,23.4068945346642],"scale":1.1073711832250046},{"type":"grass","position":[1.2416115884168377,0,-27.834454976633943],"scale":0.7985143568656236},{"type":"grass","position":[-106.35252415760388,0,4.833464172259803],"scale":1.2212314815305574},{"type":"grass","position":[-7.479451731287438,0,8.009543690276596],"scale":0.7716939119470168},{"type":"grass","position":[-55.890886864364646,0,-37.736564225939],"scale":0.8324142029606535},{"type":"grass","position":[98.97581285311264,0,100.99989448364815],"scale":1.1591806289523063},{"type":"grass","position":[38.63901143064509,0,54.22530697147165],"scale":1.1202723390799632},{"type":"grass","position":[-62.45649053580273,0,-74.14025586014462],"scale":0.7578292390642692},{"type":"grass","position":[66.13563350698263,0,-111.409124238309],"scale":1.0789289909588675},{"type":"grass","position":[-91.18912523171619,0,65.73590082543599],"scale":1.1661221112742293},{"type":"grass","position":[-22.555110082113067,0,-127.54530704104931],"scale":0.7946221433248384},{"type":"grass","position":[0.3873975043832299,0,-96.59297188433526],"scale":1.0835181318262885},{"type":"grass","position":[36.467411372891675,0,0.42333693470900263],"scale":1.1281017941533222},{"type":"grass","position":[-18.875889311944967,0,7.644872579519472],"scale":1.2478049231898907},{"type":"grass","position":[98.79184437354482,0,-47.894220194339724],"scale":0.9291242811805163},{"type":"grass","position":[-0.15298972040322967,0,-0.43699216467228297],"scale":0.7241124460051762},{"type":"grass","position":[14.848517607785727,0,-11.948533402295714],"scale":1.122985264306603},{"type":"grass","position":[-18.045062395456213,0,-21.021236302084944],"scale":0.9016768129245467},{"type":"grass","position":[4.099036876982177,0,99.82851026161262],"scale":1.0013686366384593},{"type":"grass","position":[72.7998555597347,0,39.67122429292485],"scale":1.1995092644603704},{"type":"grass","position":[-54.22467058701013,0,-107.44176445451514],"scale":0.9945371260424063},{"type":"grass","position":[5.266885636066713,0,80.37623728278842],"scale":1.2409102423012333},{"type":"grass","position":[-52.28935075686053,0,114.50690931825878],"scale":1.206145996685025},{"type":"grass","position":[-30.8344699902896,0,71.21900148841833],"scale":1.101978585401041},{"type":"grass","position":[-3.4306061196019835,0,-108.67440151611319],"scale":0.9631988903862585},{"type":"grass","position":[7.094738517846433,0,-1.4195048679612698],"scale":0.8323456131936153},{"type":"grass","position":[-14.171875519821134,0,13.296264819916649],"scale":1.220633913662156},{"type":"grass","position":[33.3809119659094,0,-74.9214712209485],"scale":0.8317054554729042},{"type":"grass","position":[-29.179854342581372,0,-38.81300180764476],"scale":1.0796045037842879},{"type":"grass","position":[34.48966882998194,0,87.27775204443219],"scale":1.2303169009007084},{"type":"grass","position":[-79.96807685080296,0,64.12871805906242],"scale":1.1706178952231396},{"type":"grass","position":[-54.876946259156476,0,48.79580913798708],"scale":0.8273831360931692},{"type":"grass","position":[26.178378564754613,0,8.648511215918331],"scale":1.0933831539131234},{"type":"grass","position":[99.10127883854047,0,2.6305934276646585],"scale":0.7703383498356837},{"type":"grass","position":[-14.13663945374999,0,-24.375386488848104],"scale":0.9235907957196522},{"type":"grass","position":[-56.461558705692376,0,9.117177040832129],"scale":1.0050296576464288},{"type":"grass","position":[37.507994098576255,0,-35.20239264712972],"scale":1.066291318629545},{"type":"grass","position":[4.188556100498315,0,-15.355051976968944],"scale":0.9820294980667853},{"type":"grass","position":[-10.151685326732611,0,-68.60277327810026],"scale":0.8724993275608887},{"type":"grass","position":[13.838599732560615,0,1.0311678636818855],"scale":1.218173718388711},{"type":"grass","position":[42.88991198320063,0,30.16124169106708],"scale":0.7565415547779428},{"type":"grass","position":[-10.614747803918824,0,22.963730889215395],"scale":1.039544157417279},{"type":"grass","position":[4.021172047911144,0,-9.424255406154678],"scale":1.2228977384402526},{"type":"grass","position":[-8.90364507439322,0,11.26475798292448],"scale":0.7568201504093319},{"type":"grass","position":[46.09261362523647,0,1.4260885101024903],"scale":0.9091766825261935},{"type":"grass","position":[70.56156828449171,0,-120.71871687538581],"scale":0.9677255444704657},{"type":"grass","position":[-37.989568668021064,0,27.748873017333114],"scale":1.0023201609899215},{"type":"grass","position":[-0.6616633222519286,0,125.5177040150694],"scale":0.8887722359572615},{"type":"grass","position":[-22.041681683992266,0,-55.16845650702109],"scale":1.2136535047633945},{"type":"grass","position":[-11.49574325090502,0,-3.5434673105568737],"scale":0.7756471642253386},{"type":"grass","position":[86.22349219228329,0,-110.21169878381723],"scale":0.7340947414697114},{"type":"grass","position":[66.67453578481137,0,-74.09452372374629],"scale":0.8058663087966244},{"type":"grass","position":[106.95605084827082,0,-1.6779626007087605],"scale":0.8874098453952335},{"type":"grass","position":[-8.393243898327981,0,31.165725989360617],"scale":0.8860153376683102},{"type":"grass","position":[-24.034268343597887,0,141.9860456734035],"scale":0.8431163074765469},{"type":"grass","position":[-83.26057862294124,0,23.74721946146269],"scale":1.0182991482412291},{"type":"grass","position":[4.7629773901493175,0,-2.6459650714465712],"scale":1.2009694130130824},{"type":"grass","position":[-134.1370965477067,0,-1.9969497718336535],"scale":1.1392086915035116},{"type":"grass","position":[-35.95387840258508,0,25.985038099408143],"scale":0.8907221152829627},{"type":"grass","position":[1.8877424884150416,0,-5.766669492709133],"scale":0.869810217221531},{"type":"grass","position":[5.188148874610121,0,-12.396243188040202],"scale":1.1527712154120628},{"type":"grass","position":[53.73549129760282,0,51.73906044413237],"scale":1.1663828090988804},{"type":"grass","position":[-42.467942679060265,0,6.5916102401578405],"scale":0.8075193458462305},{"type":"grass","position":[36.42552051995237,0,22.09102893375297],"scale":0.7838963197164208},{"type":"grass","position":[-6.080186786384216,0,-3.969641603755028],"scale":1.0070990280162668},{"type":"grass","position":[-92.88377013025462,0,-21.53815201611375],"scale":0.7928115773298067},{"type":"grass","position":[-13.390211686648385,0,-1.0125611866058695],"scale":1.2823521937434026},{"type":"grass","position":[-122.12620517440722,0,36.51321940679082],"scale":0.8575374170513488},{"type":"grass","position":[-82.75028677010022,0,90.30935872130873],"scale":1.024096013167911},{"type":"grass","position":[105.03189377590651,0,36.32875696891849],"scale":1.1916141946713517},{"type":"grass","position":[-76.68514555616859,0,15.286437486845967],"scale":0.7777905517820821},{"type":"grass","position":[103.1552598876975,0,-103.72151056994015],"scale":1.1281059733497742},{"type":"grass","position":[-109.56405577250129,0,-96.40403035035949],"scale":0.8702213543564983},{"type":"grass","position":[-24.52389270277205,0,-16.88705696313039],"scale":0.9354899046830691},{"type":"grass","position":[92.89346880751654,0,-4.213432323207785],"scale":1.0737453329646423},{"type":"grass","position":[69.51113152357277,0,-0.34627439049706504],"scale":1.19499540463204},{"type":"grass","position":[55.9318373900179,0,-35.54479546519448],"scale":1.1016817340997578},{"type":"grass","position":[-16.97782981974045,0,-86.84259619605851],"scale":1.1675720468419528},{"type":"grass","position":[56.28365147310051,0,-137.85687602634516],"scale":0.9842904960137102},{"type":"grass","position":[104.25598322666914,0,82.14507071212944],"scale":0.8362432258973804},{"type":"grass","position":[15.049241484092168,0,1.0859744061413903],"scale":1.2156982529120421},{"type":"grass","position":[51.678035150167865,0,12.707401486065612],"scale":1.033330539747511},{"type":"grass","position":[-0.27073922286312246,0,106.441163641186],"scale":1.0607682748226956},{"type":"grass","position":[3.371105310809606,0,12.426074169457214],"scale":1.234714808360405},{"type":"grass","position":[70.94909863861383,0,0.052054757177190464],"scale":1.2513028803042823},{"type":"grass","position":[90.62868473266566,0,-26.575476177299464],"scale":1.215396792875734},{"type":"grass","position":[-57.632312176236745,0,-20.98645625616827],"scale":1.0306481472526414},{"type":"grass","position":[-79.29925313724092,0,50.46394315127108],"scale":1.0807806445015442},{"type":"grass","position":[29.742999451468624,0,-27.46974722127679],"scale":1.033251419527064},{"type":"grass","position":[-119.85832465337843,0,80.60382567912607],"scale":1.028544329755892},{"type":"grass","position":[-109.82098605316735,0,-1.148566689785373],"scale":1.1067193562161775},{"type":"grass","position":[3.8662055478233714,0,-8.853063256282473],"scale":0.71914935622405},{"type":"grass","position":[-71.27370249936868,0,-112.46757898249139],"scale":1.2742208159847224},{"type":"grass","position":[-141.15552225412026,0,13.214217544246466],"scale":0.8459462212324199},{"type":"grass","position":[-8.784202079093356,0,88.21463673655656],"scale":0.8098952999431166},{"type":"grass","position":[-136.3620521780227,0,-43.200116307087185],"scale":1.2865406855010266},{"type":"grass","position":[-19.95010300445935,0,-25.029079299451976],"scale":0.9172907731835815},{"type":"grass","position":[-1.7053995207096238,0,-11.508981546428453],"scale":1.2984003321669704},{"type":"grass","position":[32.203138703891845,0,-0.2654910436166888],"scale":1.2625887591835814},{"type":"grass","position":[-62.36122789201051,0,-31.105490434354294],"scale":1.0682716708836553},{"type":"grass","position":[79.11480857534721,0,-3.0489969078555252],"scale":1.0245479234348034},{"type":"grass","position":[-16.746937464144228,0,86.92640836759197],"scale":0.9523355049754447},{"type":"grass","position":[47.757340378649204,0,-132.4395626287801],"scale":0.7671702265450019},{"type":"grass","position":[-34.48138124473756,0,-37.61822055578705],"scale":0.820008855293665},{"type":"grass","position":[-0.0014768318376853608,0,-22.09369457512488],"scale":1.1905323795571607},{"type":"grass","position":[-22.28774804943185,0,7.270325825196173],"scale":1.167792180049953},{"type":"grass","position":[-24.911503735239823,0,4.930687346150095],"scale":0.8742635917763101},{"type":"grass","position":[73.83501629104587,0,11.536691098405075],"scale":1.0335981363143445},{"type":"grass","position":[-56.731193764386425,0,40.94470376186995],"scale":0.8450226612024923},{"type":"grass","position":[-11.24482153992858,0,53.27739309371003],"scale":1.2339886220761938},{"type":"grass","position":[3.911370630155537,0,-140.76108734173627],"scale":0.8906594036608053},{"type":"grass","position":[-30.87093413102415,0,98.72592346282757],"scale":1.2372077304948403},{"type":"grass","position":[23.22387298013185,0,-47.7401550391978],"scale":0.9234699279564234},{"type":"grass","position":[58.705757663161606,0,-31.812213138192202],"scale":0.8908024351811068},{"type":"grass","position":[-107.36868644079176,0,-35.58581041206578],"scale":1.273034030048771},{"type":"grass","position":[-16.39919034011356,0,71.40936560044057],"scale":0.8168680149688139},{"type":"grass","position":[12.938343016269172,0,20.759458713478622],"scale":1.1873613088271184},{"type":"grass","position":[63.65986434253756,0,116.0341297786023],"scale":1.2912319046384888},{"type":"grass","position":[0.41058888038772523,0,-0.04710197146368344],"scale":0.9121368181962142},{"type":"grass","position":[30.329626130770077,0,59.250412569946164],"scale":1.186691132731242},{"type":"grass","position":[13.187689885420378,0,-105.78579110795738],"scale":0.7186213318784981},{"type":"grass","position":[19.185787090694905,0,8.592109386212092],"scale":1.0031850400270748},{"type":"grass","position":[-29.460768610101482,0,-55.27658515350261],"scale":0.9762612172960993},{"type":"grass","position":[-43.88285235327991,0,-20.34988423458584],"scale":0.9969101727373602},{"type":"grass","position":[7.052253803088018,0,-113.49550157759457],"scale":1.056903660001703},{"type":"grass","position":[-14.173464430911073,0,48.77672936922413],"scale":1.144997605643336},{"type":"grass","position":[-23.582480251772306,0,-13.645987426936674],"scale":0.9058485041520821},{"type":"grass","position":[-146.60791719935543,0,-22.394118227311143],"scale":1.1151426178861013},{"type":"grass","position":[76.57976831505617,0,-38.82436126812678],"scale":1.0003835143344288},{"type":"grass","position":[50.12992849063207,0,-89.18077314895139],"scale":0.9089610514757647},{"type":"grass","position":[28.420635555246303,0,12.298081523064184],"scale":1.0823226633511436},{"type":"grass","position":[-11.131426925295246,0,-46.057374886830004],"scale":0.8392910297046704},{"type":"grass","position":[60.805476871779405,0,-10.669914544103008],"scale":0.7937652276037894},{"type":"grass","position":[76.49686789410987,0,23.895901138419077],"scale":1.0604017782112138},{"type":"grass","position":[-80.36291438507307,0,-76.85538635813806],"scale":0.7304322748344078},{"type":"grass","position":[3.350466576440241,0,-84.46964074504344],"scale":1.0071222389701615},{"type":"grass","position":[116.36536061066197,0,-82.82807372004636],"scale":1.292753625383225},{"type":"grass","position":[-47.14569462594779,0,-28.856356218930333],"scale":0.970016186734324},{"type":"grass","position":[-37.95977834850706,0,-24.08874473467965],"scale":1.2434511066554357},{"type":"grass","position":[92.08897887503103,0,100.49044907786484],"scale":1.2803346467527197},{"type":"grass","position":[-93.62297101327874,0,-71.72669851035415],"scale":0.915331102763011},{"type":"grass","position":[-9.413982053119792,0,23.490732987793425],"scale":1.2815500153861046},{"type":"grass","position":[36.20038941870198,0,-63.96555678989532],"scale":1.1739725448094234},{"type":"grass","position":[29.997018111607666,0,32.36985866573391],"scale":0.7612018153975982},{"type":"grass","position":[-8.60824253743658,0,-2.4387507277392095],"scale":0.9294629606282787},{"type":"grass","position":[-97.51725378768721,0,-66.15597483585434],"scale":1.2659459383468767},{"type":"grass","position":[84.00550935376367,0,-115.11271350844076],"scale":0.8326885388100485},{"type":"grass","position":[13.581770932452637,0,9.840595682291024],"scale":0.8974838999953011},{"type":"grass","position":[8.895361460134133,0,-112.73394816071523],"scale":0.8498828432562999},{"type":"grass","position":[105.01554886072508,0,8.890760107618165],"scale":0.8978474857067973},{"type":"grass","position":[39.74898483882562,0,25.249372962004447],"scale":1.2922623573758023},{"type":"grass","position":[-33.520975448985304,0,-76.68891911078846],"scale":1.0038779783295273},{"type":"grass","position":[5.453876317586266,0,-3.907888762611546],"scale":1.1096223464541692},{"type":"grass","position":[102.40831054578976,0,24.320725473010864],"scale":0.9655402126366518},{"type":"grass","position":[-8.951317730129873,0,-121.74678675279553],"scale":1.2518960228751772},{"type":"grass","position":[43.73878177171338,0,44.33275309328355],"scale":1.0056437582269884},{"type":"grass","position":[16.09760425466127,0,68.19070081961615],"scale":0.9307734850632204},{"type":"grass","position":[72.4150809253541,0,119.06627266400234],"scale":1.2661827138164718},{"type":"grass","position":[119.20708074303481,0,42.67902789873911],"scale":0.8715489742669378},{"type":"grass","position":[35.63999820263054,0,-21.546146507986776],"scale":1.278278147256343},{"type":"grass","position":[-106.93821519150754,0,-27.064081333580166],"scale":1.0924943588621794},{"type":"grass","position":[19.906374911852872,0,77.88717422654179],"scale":0.791409924609705},{"type":"grass","position":[-4.0195670502587415,0,-149.3676336657027],"scale":1.269052947979671},{"type":"grass","position":[-3.2843351778944103,0,25.49623924570742],"scale":0.9393438578602338},{"type":"grass","position":[118.52655693540862,0,73.29934198259772],"scale":0.8354871689114063},{"type":"grass","position":[34.26906071221056,0,-21.86808596205028],"scale":0.728001762186927},{"type":"grass","position":[29.297295492544297,0,31.79557806219767],"scale":0.8246850460317198},{"type":"grass","position":[11.24795828437448,0,-17.178522433376283],"scale":0.8098761425345852},{"type":"grass","position":[-65.81479450474582,0,-46.92782309500839],"scale":0.9170016411481527},{"type":"grass","position":[-12.974107501179573,0,25.18897620518209],"scale":0.717644879148623},{"type":"grass","position":[74.2566456874823,0,29.883981763630672],"scale":1.0953525117558938},{"type":"grass","position":[94.18422888855856,0,-85.22035784978353],"scale":0.8639300328476971},{"type":"grass","position":[40.38711372428442,0,-83.99626331731811],"scale":1.057421582457127},{"type":"grass","position":[-74.18042621281892,0,11.094826101651119],"scale":0.9089466578527963},{"type":"grass","position":[-34.26599130421704,0,7.614860559268909],"scale":0.7373808659535905},{"type":"grass","position":[11.53848983249545,0,1.7529495681621539],"scale":0.798983801733393},{"type":"grass","position":[33.522027778839025,0,48.32663890305943],"scale":1.2284079664502348},{"type":"grass","position":[0.07764935647425057,0,7.128466247056356],"scale":0.9099642071246908},{"type":"grass","position":[42.3977377674615,0,-9.741336493675364],"scale":0.717441504886904},{"type":"grass","position":[-26.884481427676235,0,143.71308939316836],"scale":0.7504698548424675},{"type":"grass","position":[64.881331523161,0,3.5083520059418514],"scale":0.8709530325217805},{"type":"grass","position":[-4.067077549890784,0,2.3455276848338755],"scale":1.1203598182703327},{"type":"grass","position":[-2.108258865491586,0,65.09587087489832],"scale":0.7424351493601736},{"type":"grass","position":[-3.3338777122453256,0,-50.91923824489952],"scale":0.8111022326207005},{"type":"grass","position":[115.021569422446,0,2.2333621672894686],"scale":1.0504596401926334},{"type":"grass","position":[-72.82661832304883,0,34.603052779191955],"scale":0.794826310436857},{"type":"grass","position":[17.101161550113147,0,1.6571622553736438],"scale":1.0642512345164146},{"type":"grass","position":[5.19429854189306,0,-9.912793924512638],"scale":1.0413244981694483},{"type":"grass","position":[78.79910019003111,0,-68.86069991501559],"scale":0.8209065506054294},{"type":"grass","position":[78.04256014437428,0,89.8038404054463],"scale":1.222825790827283},{"type":"grass","position":[-136.6684547793245,0,-46.52084383649979],"scale":0.7707267787822033},{"type":"grass","position":[91.84799371686779,0,-112.39166958035861],"scale":1.2201908523448153},{"type":"grass","position":[54.75964200743654,0,-14.787258719877519],"scale":0.9116301980212489},{"type":"grass","position":[115.96309182954337,0,-48.04795213045817],"scale":1.131438775178647},{"type":"grass","position":[127.37208980268203,0,48.69188456701223],"scale":0.7552943218048493},{"type":"grass","position":[-37.36570925169987,0,47.66341949318333],"scale":1.105312252863892},{"type":"grass","position":[-59.41284669562678,0,-70.4108172805093],"scale":0.8453745575623927},{"type":"grass","position":[49.78688185147987,0,67.21410600398643],"scale":0.9337502172859964},{"type":"grass","position":[-9.026430973579684,0,3.05159271292247],"scale":1.199129590931958},{"type":"grass","position":[-53.55051285005291,0,-99.5737281404222],"scale":0.9991362665405836},{"type":"grass","position":[-70.01990635988159,0,51.566164934802956],"scale":0.8788653088006906},{"type":"grass","position":[-51.5732838517017,0,25.019229617298397],"scale":1.2085250084732024},{"type":"grass","position":[82.27986136598753,0,-32.80440475804184],"scale":1.1185344890456017},{"type":"grass","position":[-43.140512244554465,0,-8.860326543407522],"scale":0.9087809688821766},{"type":"grass","position":[26.921759869629643,0,-1.8546681087597068],"scale":0.8066888382933017},{"type":"grass","position":[-7.606002296023024,0,-84.70671953453501],"scale":0.81464007280781},{"type":"grass","position":[33.62652496243359,0,64.27902589415412],"scale":1.1695326190880753},{"type":"grass","position":[47.809901817302126,0,27.336197413174112],"scale":0.9072522596182301},{"type":"grass","position":[-128.7865155304062,0,-14.777245532845015],"scale":0.7355991490116485},{"type":"grass","position":[82.97532180709061,0,92.86983522157281],"scale":0.990947544125975},{"type":"grass","position":[-33.189744764891906,0,-25.843038028501432],"scale":1.0919373065777207},{"type":"grass","position":[83.91047245323782,0,-22.5494939055695],"scale":1.1514790718900851},{"type":"grass","position":[29.36440073297468,0,14.195165536759639],"scale":0.7612975445735515},{"type":"grass","position":[-37.69959850412924,0,28.562899091359142],"scale":1.0751851554384153},{"type":"grass","position":[1.7030730279497626,0,-1.0333889703193886],"scale":0.9203565166113326},{"type":"grass","position":[53.62908685303213,0,-34.286641702694084],"scale":1.207771721185079},{"type":"grass","position":[71.00642435864967,0,45.21772754870109],"scale":0.9012773465106164},{"type":"grass","position":[-66.52082664027762,0,50.012272404377406],"scale":0.9297963890308754},{"type":"grass","position":[-13.375600103766931,0,4.823446797074551],"scale":0.8015667249775404},{"type":"grass","position":[25.689361355000678,0,57.52669914641888],"scale":1.2108306022212065},{"type":"grass","position":[36.972279061469955,0,107.62697283657094],"scale":0.8246495391016978},{"type":"grass","position":[0.7950377925693126,0,6.67564567499213],"scale":1.1582826356559568},{"type":"grass","position":[-24.937614591313697,0,-142.91300329045572],"scale":0.7195134478358955},{"type":"grass","position":[7.118392752022647,0,-141.20109529243172],"scale":0.9024769558962917},{"type":"grass","position":[-73.58497405574258,0,51.73557748051474],"scale":1.1044578736497255},{"type":"grass","position":[94.81071951344626,0,-22.114308107163577],"scale":0.8377433974574404},{"type":"grass","position":[-11.409283756234084,0,0.9129212353663223],"scale":0.893718973561884},{"type":"grass","position":[10.232913841294694,0,-91.04850298014166],"scale":0.9157670757717552},{"type":"grass","position":[16.63879089872973,0,2.8982051436767087],"scale":0.8028095294124703},{"type":"grass","position":[-117.72064055213987,0,15.678306434177957],"scale":0.9847963821832189},{"type":"grass","position":[5.788762715024582,0,-6.1169461120361985],"scale":1.0090967174471404},{"type":"grass","position":[-24.735884591993674,0,54.62385976150053],"scale":0.948827170972234},{"type":"grass","position":[-61.69768353807235,0,55.1615524299688],"scale":0.7916558149222102},{"type":"grass","position":[85.16017595639758,0,-48.25293421458384],"scale":1.0408225980108725},{"type":"grass","position":[-18.24546070184506,0,24.254274313732836],"scale":1.2435016550109022},{"type":"grass","position":[-2.5087550558868035,0,0.06601067292185431],"scale":0.7420971235733048},{"type":"grass","position":[35.618388525252584,0,79.74290247132122],"scale":1.207247997884963},{"type":"grass","position":[-95.94275105274835,0,-114.46879208887405],"scale":1.1524591956265218},{"type":"grass","position":[-146.74438218799767,0,-18.767438526523232],"scale":1.2054517543712424},{"type":"grass","position":[-25.40945727938845,0,28.683388274242184],"scale":1.133685458959354},{"type":"grass","position":[-103.61707634159683,0,-73.50348197872393],"scale":0.8586213960443603},{"type":"grass","position":[15.337991008494756,0,-106.66356227663715],"scale":0.7741648913416713},{"type":"grass","position":[41.2887673325494,0,-76.41625464458103],"scale":1.2609407797801386},{"type":"grass","position":[51.87476635903841,0,-43.6858802539777],"scale":0.9552375253429548},{"type":"grass","position":[1.0817703458342514,0,66.1291434254109],"scale":1.2264835876884668},{"type":"grass","position":[-61.343463254236454,0,-59.937386235638016],"scale":0.7013447464825914},{"type":"grass","position":[20.38507750417578,0,138.2019153027098],"scale":1.1499068634938774},{"type":"grass","position":[19.788038394980234,0,-20.367904248825628],"scale":0.9902757094402299},{"type":"grass","position":[-10.41180387455428,0,30.973117763324645],"scale":1.2308827240578406},{"type":"grass","position":[-62.172007113322074,0,-23.993953394321167],"scale":1.000282795804687},{"type":"grass","position":[67.73807174937068,0,-48.79527287425637],"scale":0.8398999307328496},{"type":"grass","position":[122.21015246259829,0,-53.48372879988962],"scale":0.714145058800153},{"type":"grass","position":[-67.55785366034885,0,-22.53610282215907],"scale":1.094387054390329},{"type":"grass","position":[-102.0714836340381,0,-73.58312725168463],"scale":0.8084641990567125},{"type":"grass","position":[-11.923307512674088,0,-12.448843827422838],"scale":1.0167102428742294},{"type":"grass","position":[26.780852088039236,0,-25.888862856090693],"scale":0.7374903111567577},{"type":"grass","position":[-83.78789792644187,0,-64.42495604105659],"scale":1.0010362319437336},{"type":"grass","position":[-59.55329549145232,0,52.43943976094777],"scale":1.1441722588196725},{"type":"grass","position":[6.810219796042914,0,-114.24769488198234],"scale":0.877759052057797},{"type":"grass","position":[-112.81861486694916,0,-30.710139830946517],"scale":1.0043161165730912},{"type":"grass","position":[-44.545846318544726,0,-15.586949121080476],"scale":1.2567476067204078},{"type":"grass","position":[-96.92269674548655,0,7.654295283490127],"scale":1.0635150826922084},{"type":"grass","position":[-74.59682468984329,0,52.892239786445536],"scale":0.7949947675694022},{"type":"grass","position":[3.923632984137352,0,5.628518933808761],"scale":0.8100347731755728},{"type":"grass","position":[25.080400942930144,0,-90.4561237225217],"scale":1.0598146797878687},{"type":"grass","position":[18.258948794345574,0,130.91050686246538],"scale":0.9014291506130042},{"type":"grass","position":[18.52425721216761,0,48.99268769736478],"scale":0.8731568364852609},{"type":"grass","position":[12.126945354603363,0,-104.35988249064127],"scale":0.7393057047310293},{"type":"grass","position":[7.106385849593417,0,25.46838899392139],"scale":0.8910910310520676},{"type":"grass","position":[42.61236219601713,0,-59.00688024515838],"scale":0.914672608108017},{"type":"grass","position":[42.39494802393775,0,-134.07895751474786],"scale":0.7524664835438466},{"type":"grass","position":[117.7262927984291,0,-34.6175426344416],"scale":0.9252518624743525},{"type":"grass","position":[-16.29498080664696,0,15.882002319453738],"scale":0.839122603733353},{"type":"grass","position":[-70.23161753833514,0,-10.521667567037008],"scale":1.0887145758246457},{"type":"grass","position":[-16.803210922711386,0,-88.50197382351733],"scale":1.0513327696323085},{"type":"grass","position":[-30.515901239294966,0,-81.32687807434559],"scale":1.102166818086327},{"type":"grass","position":[84.44055406503176,0,-87.7380464036571],"scale":1.1231591290816216},{"type":"grass","position":[-16.58784303646919,0,-54.90829246547961],"scale":1.1099780729848148},{"type":"grass","position":[8.397575899817552,0,35.09871179249858],"scale":0.8858448503777592},{"type":"grass","position":[-46.798217535713775,0,122.49881692626654],"scale":0.7260236756795496},{"type":"grass","position":[88.47823385154709,0,-93.68226756007456],"scale":0.9932273084978979},{"type":"grass","position":[70.63276273482954,0,47.5995419547698],"scale":1.1935548363591733},{"type":"grass","position":[49.32924628085559,0,-122.82314264002586],"scale":0.8843899131619435},{"type":"grass","position":[-64.36870624982285,0,67.16113060604013],"scale":1.1849848515364965},{"type":"grass","position":[0.3563964959668734,0,122.88744922566195],"scale":1.2516684689429134},{"type":"grass","position":[90.8488924947915,0,-33.043876552812655],"scale":0.7153369601309125},{"type":"grass","position":[-4.308562044811939,0,27.332502112265814],"scale":1.2542262259940868},{"type":"grass","position":[-30.96130204309298,0,-81.45661972753845],"scale":1.0807823958724438},{"type":"grass","position":[54.70566933517269,0,-134.78452016799272],"scale":0.9644711448596882},{"type":"grass","position":[-4.3703628049723,0,-111.05457470224978],"scale":1.1808199338424141},{"type":"grass","position":[-84.17796262720307,0,-112.69623414255756],"scale":1.0598408017077157},{"type":"grass","position":[-18.409762018690913,0,41.6537139751729],"scale":0.8212775786794781},{"type":"grass","position":[-75.9860552450664,0,115.64474092891277],"scale":0.8779960496761041},{"type":"grass","position":[72.34449135109722,0,95.2244338764526],"scale":0.791194391974393},{"type":"grass","position":[21.53067908368996,0,-40.53811730492639],"scale":1.089429530482189},{"type":"grass","position":[22.552851150540913,0,145.2174163629877],"scale":0.9473067257437782},{"type":"grass","position":[17.449046601706538,0,-26.082842929658998],"scale":1.2803742075759792},{"type":"grass","position":[84.71881936422078,0,53.594539741892106],"scale":0.7626348747919565},{"type":"grass","position":[123.09503903908977,0,56.917244616647814],"scale":0.766386270238064},{"type":"grass","position":[-16.178979333469453,0,99.90863014589365],"scale":1.053520545019818},{"type":"grass","position":[78.710807985543,0,-53.54468086941323],"scale":0.7525981049355751},{"type":"grass","position":[-111.8852747137404,0,-63.70202870014084],"scale":1.0837924386615292},{"type":"grass","position":[-22.383668002201976,0,8.12739301521785],"scale":0.7268981240805367},{"type":"grass","position":[-5.777239233606818,0,-31.797352565778887],"scale":0.8413042646747004},{"type":"grass","position":[25.66710914805336,0,1.001088007857797],"scale":0.9599626959340395},{"type":"grass","position":[85.01685901985391,0,19.66731598881522],"scale":0.9294145240310403},{"type":"grass","position":[-18.244816761401832,0,-137.99287161553468],"scale":1.002249255710281},{"type":"grass","position":[-32.204406290420614,0,-90.38089968637975],"scale":1.1344969874342608},{"type":"grass","position":[-29.72053480339656,0,85.91459597645444],"scale":1.0754105849950673},{"type":"grass","position":[-19.92158737242199,0,-3.7367094761120363],"scale":1.0093207238843083},{"type":"grass","position":[-99.47161777158307,0,32.5886175521428],"scale":0.9984086315257588},{"type":"grass","position":[44.32658384442833,0,-142.12423688794345],"scale":1.0106070819705741},{"type":"grass","position":[-7.5474740409346905,0,-23.75733728529656],"scale":0.8590968405948973},{"type":"grass","position":[27.632245493174793,0,5.065707163692902],"scale":1.2936093117339125},{"type":"grass","position":[24.362302532029958,0,98.46989059224167],"scale":0.8651479710182124},{"type":"grass","position":[45.70766014868149,0,26.949956971521992],"scale":1.1679409320984775},{"type":"grass","position":[-79.30300307072717,0,54.2035983695269],"scale":0.7628256448954711},{"type":"grass","position":[-11.317968104316142,0,11.028825648406132],"scale":0.7434872321651399},{"type":"grass","position":[-28.45617984168664,0,-144.73017746888843],"scale":0.8741204212884257},{"type":"grass","position":[-143.5050821449036,0,4.127303441935101],"scale":1.2538781860565336},{"type":"grass","position":[7.2991594952389365,0,-84.3566222952057],"scale":0.8382623208763431},{"type":"grass","position":[-36.272709268853795,0,2.5719287538871725],"scale":1.1746451623957044},{"type":"grass","position":[5.161033771082242,0,90.10878696948515],"scale":1.1581447204886912},{"type":"grass","position":[127.75922323160225,0,39.52949888819645],"scale":0.8732891762576662},{"type":"grass","position":[104.54723217913487,0,-50.147027517496205],"scale":0.8913205123427174},{"type":"grass","position":[-107.68186374836118,0,-101.23178635598698],"scale":1.2544491139511142},{"type":"grass","position":[4.778850636254985,0,119.054917948652],"scale":1.0642483232036797},{"type":"grass","position":[-120.96078806286614,0,67.84026607105083],"scale":1.035434775681093},{"type":"grass","position":[135.3109019656919,0,64.6287534610399],"scale":0.9772209268033514},{"type":"grass","position":[-15.304575295138113,0,98.94582875108173],"scale":0.7261609186592501},{"type":"grass","position":[9.93704450121127,0,6.179254941248711],"scale":1.1994746302308184},{"type":"grass","position":[-73.81990696378992,0,-99.6196419148675],"scale":1.0694112214240368},{"type":"grass","position":[-7.699746600529911,0,-135.8680608735258],"scale":1.222710213611803},{"type":"grass","position":[-77.2979979460973,0,-127.67318386390721],"scale":0.8275092026647225},{"type":"grass","position":[-47.5538407806259,0,-46.93355519200062],"scale":0.9881919534586681},{"type":"grass","position":[-1.7761144130897608,0,86.7991681141484],"scale":0.8691377268680252},{"type":"grass","position":[0.4074108853471487,0,0.13844408126136626],"scale":1.2473923614528455},{"type":"grass","position":[44.89375790335854,0,135.36629040764885],"scale":1.2247698171548778},{"type":"grass","position":[20.377917300613436,0,-17.620621483928986],"scale":0.883932701268798},{"type":"grass","position":[61.23381502976853,0,-57.55293666492288],"scale":1.0336032118966005},{"type":"grass","position":[111.65347810507915,0,4.577646405597791],"scale":0.982914458915245},{"type":"grass","position":[73.71376763347644,0,-123.4080273592796],"scale":1.2042095233759678},{"type":"grass","position":[12.727932522571173,0,-89.34001836908818],"scale":0.8941622423536056},{"type":"grass","position":[41.66645169849329,0,-26.105591493424093],"scale":1.058124827480858},{"type":"grass","position":[-33.12905044642073,0,-84.48855072452407],"scale":1.1022270328697155},{"type":"grass","position":[-96.70199590536433,0,50.301951763715344],"scale":0.7743552242504791},{"type":"grass","position":[-106.99381575798827,0,-9.56783483187999],"scale":1.2896177376849907},{"type":"grass","position":[-3.9063499674018254,0,-56.34365049417703],"scale":1.019789791396407},{"type":"grass","position":[51.97668356982265,0,-62.78092057887245],"scale":0.8062928937947911},{"type":"grass","position":[-2.4645522682373553,0,-15.993672215635302],"scale":0.90883134164193},{"type":"grass","position":[61.517075628149286,0,47.16858499237733],"scale":1.0743087684511192},{"type":"grass","position":[-1.9822867803203184,0,-21.68496773429103],"scale":0.7135117283598463},{"type":"grass","position":[52.93635585562694,0,-3.6504995147022212],"scale":0.8196736211036599},{"type":"grass","position":[23.90692524635887,0,4.711366034047614],"scale":0.8267032984486116},{"type":"grass","position":[-6.169088337738785,0,67.18640531978193],"scale":0.9548674959145442},{"type":"grass","position":[9.538177975730523,0,126.16509009748127],"scale":0.8059218250797138},{"type":"grass","position":[10.15990609580003,0,0.5816348835716559],"scale":0.9956314077856645},{"type":"grass","position":[84.64238558754143,0,-81.90352416381096],"scale":0.7031950705516855},{"type":"grass","position":[58.14141877004118,0,-46.16974470790438],"scale":1.169313831187545},{"type":"grass","position":[-62.903234474671656,0,-55.06865393878994],"scale":1.157133690417988},{"type":"grass","position":[14.468867155229574,0,-36.75059426959389],"scale":1.0155479135436176},{"type":"grass","position":[-26.36549359698065,0,128.69142821126223],"scale":1.2323281900615641},{"type":"grass","position":[20.39940263708651,0,136.49458350200376],"scale":0.8172950549709703},{"type":"grass","position":[67.76917372177603,0,100.15060968227283],"scale":1.032665218091325},{"type":"grass","position":[-122.3166818706454,0,-84.87527402191856],"scale":1.1106746307031174},{"type":"grass","position":[-46.74722138763449,0,64.26528545115687],"scale":1.0488496038541077},{"type":"grass","position":[-121.83920513137119,0,-14.845621476951171],"scale":1.182494533641579},{"type":"grass","position":[78.50747026146385,0,18.06819368310096],"scale":0.8954810089291165},{"type":"grass","position":[-63.056309405494964,0,-37.32648307330151],"scale":0.833368668985873},{"type":"grass","position":[-114.94164250467804,0,-96.05877551156638],"scale":1.1811871883047906},{"type":"grass","position":[0.11283606950143468,0,1.4251257871607785],"scale":1.0324945659305873},{"type":"grass","position":[-143.53281177683664,0,3.732614357877625],"scale":0.9986725906731522},{"type":"grass","position":[100.05444257643033,0,62.40555194688554],"scale":1.1641687373267062},{"type":"grass","position":[-83.588282537554,0,35.981712694266925],"scale":0.7895978479740267},{"type":"grass","position":[28.927907869173332,0,18.814543584447087],"scale":0.8742353007497691},{"type":"grass","position":[13.617656436299443,0,-51.59617850022439],"scale":1.1992412946335922},{"type":"grass","position":[-69.53544565483665,0,19.27040270783283],"scale":0.7615910858573807},{"type":"grass","position":[-123.99070665984854,0,76.8810417479112],"scale":1.2080028938005054},{"type":"grass","position":[36.028188276309834,0,9.071067807734584],"scale":0.8062089290383079},{"type":"grass","position":[44.84671660224612,0,-67.85439811848244],"scale":0.8767780653051951},{"type":"grass","position":[1.719364658413858,0,-8.271127065800124],"scale":0.8954119045288533},{"type":"grass","position":[-66.08912539871233,0,85.34845953588645],"scale":0.8847657686195368},{"type":"grass","position":[-34.4514689470027,0,22.59658862387124],"scale":0.9152064138604487},{"type":"grass","position":[-34.501459864280406,0,-27.679432955433775],"scale":1.204391373411943},{"type":"grass","position":[-0.4686064431968773,0,25.1328991489947],"scale":1.2514516273480183},{"type":"grass","position":[40.887225290372776,0,-67.0164598586594],"scale":1.0259545576109488},{"type":"grass","position":[29.25671207794386,0,61.775915486786346],"scale":0.765893322116716},{"type":"grass","position":[-72.20312087882016,0,59.677254674756306],"scale":0.7988675620719767},{"type":"grass","position":[-22.366619059628324,0,-11.538859005216585],"scale":1.2461852469029402},{"type":"grass","position":[4.049542279424871,0,-1.293892023854139],"scale":1.1117253384073795},{"type":"grass","position":[31.704961527770806,0,-126.47546068736284],"scale":0.9981950675865712},{"type":"grass","position":[-17.198942402368107,0,3.714462562131697],"scale":0.8776740480387029},{"type":"grass","position":[-12.47081801310866,0,29.928837836261053],"scale":0.9915508483678058},{"type":"grass","position":[-81.82390539000608,0,-81.16510178409007],"scale":0.9916527390059819},{"type":"grass","position":[-85.6648582815219,0,-56.26586667050921],"scale":0.8140826244890598},{"type":"grass","position":[-10.323990564061313,0,-11.472199167879559],"scale":1.1880626030391788},{"type":"grass","position":[-24.363173017220547,0,-17.516997733766804],"scale":1.0208368953425841},{"type":"grass","position":[-2.263621636189786,0,21.173224096481125],"scale":1.2298732883299097},{"type":"grass","position":[-84.03734766686892,0,-67.9439876530119],"scale":0.8819016459957528},{"type":"grass","position":[148.32658942862395,0,15.572457545131309],"scale":1.1396051209089437},{"type":"grass","position":[-10.353004808420854,0,-33.95090382082223],"scale":1.1152844297553743},{"type":"grass","position":[106.58535402282752,0,70.30111940164089],"scale":0.8076907281949925},{"type":"grass","position":[5.358954197250572,0,2.921608845161109],"scale":1.2481665217020899},{"type":"grass","position":[15.49919234869423,0,30.195140828994337],"scale":0.7427328955872134},{"type":"grass","position":[13.500541712814599,0,-16.945009867894857],"scale":0.8811391379055548},{"type":"grass","position":[-46.59391003764411,0,81.86915557212346],"scale":0.8165063848673355},{"type":"grass","position":[1.2901922845640401,0,53.91392685819283],"scale":0.8456803061249754},{"type":"grass","position":[22.22209380417853,0,-26.526798451155145],"scale":0.9622405091299893},{"type":"grass","position":[72.33174530588796,0,-78.25365092195244],"scale":0.9816521123316464},{"type":"grass","position":[95.78840198818462,0,-5.87719612717587],"scale":0.9006774935107903},{"type":"grass","position":[-35.96873496967537,0,83.55747815692763],"scale":1.1915229222196766},{"type":"grass","position":[-43.53663731953018,0,-52.15545198965645],"scale":1.0842916367058868},{"type":"grass","position":[-77.12903089686746,0,2.1363751300663765],"scale":0.7536396058473076},{"type":"grass","position":[-38.02096585504808,0,-114.38900353316664],"scale":0.9612148214795351},{"type":"grass","position":[-119.77452744693281,0,-22.63311873268734],"scale":0.9291255054844517},{"type":"grass","position":[146.01039168632596,0,-21.920735188823453],"scale":1.1266875467240647},{"type":"grass","position":[-72.02786032573479,0,7.56405357196612],"scale":1.1408355372897896},{"type":"grass","position":[-58.86845227566114,0,64.86174781249998],"scale":1.2474208827981665},{"type":"grass","position":[23.50548274318352,0,81.73654641880037],"scale":1.0020271205255131},{"type":"grass","position":[141.7193472839004,0,-1.0754850336293387],"scale":1.099519909429656},{"type":"grass","position":[19.383693802440572,0,54.36999549455615],"scale":1.1787365317183514},{"type":"grass","position":[-83.9637277851276,0,39.01582858604649],"scale":1.0741785181040866},{"type":"grass","position":[38.76728654636167,0,28.652195324659502],"scale":0.8939643542725132},{"type":"grass","position":[-124.38841326847758,0,13.341281525975141],"scale":1.1634082202469103},{"type":"grass","position":[4.80912364046845,0,0.01989161913444188],"scale":0.9743269990722031},{"type":"grass","position":[-37.8810212549656,0,32.87012498460877],"scale":1.2631806896476758},{"type":"grass","position":[-63.12654736378066,0,24.98697912282546],"scale":1.2480428925694498},{"type":"grass","position":[-1.2967788977689036,0,-2.066194316984059],"scale":0.9104280787603759},{"type":"grass","position":[83.41506911192144,0,23.144227214201297],"scale":1.1360771547679511},{"type":"grass","position":[2.9749028117101464,0,-21.69999148545673],"scale":0.725376578176629},{"type":"grass","position":[83.76918706800016,0,-44.958218438890356],"scale":0.9203300832900704},{"type":"grass","position":[-3.4132842168685373,0,1.7179531180753187],"scale":1.1303745253860595},{"type":"grass","position":[-8.531937536252878,0,-20.249483845921414],"scale":1.1249554909422352},{"type":"grass","position":[22.49054431820287,0,38.823561450738644],"scale":0.7814125682356687},{"type":"grass","position":[-28.532298248761588,0,34.1560175132252],"scale":1.1294196296532406},{"type":"grass","position":[65.7456238948262,0,-111.28760095262875],"scale":0.7227035837390353},{"type":"grass","position":[-16.260525629631886,0,5.530194000749808],"scale":1.2436940154010125},{"type":"grass","position":[-48.56042936081876,0,40.932333342561286],"scale":1.053048833515652},{"type":"grass","position":[-89.00561992966226,0,-120.52954086847764],"scale":0.7368447696370453},{"type":"grass","position":[27.47427979109133,0,-35.225622871809406],"scale":1.2778875271355497},{"type":"grass","position":[-122.4172790361809,0,-53.48561324008749],"scale":0.7322908237750251},{"type":"grass","position":[-104.81206516622218,0,106.62930651528626],"scale":0.9599601473230894},{"type":"grass","position":[14.199809908857997,0,0.8292874233825157],"scale":1.1331012626158694},{"type":"grass","position":[-22.8664254438985,0,131.77117764590457],"scale":1.201261394727791},{"type":"grass","position":[-8.947812522107695,0,-14.562108495518984],"scale":1.0816458919623317},{"type":"grass","position":[-101.04042472044682,0,-103.19544126175994],"scale":1.2732546072076283},{"type":"grass","position":[-102.9088677031076,0,24.765397374503067],"scale":1.1077131707592969},{"type":"grass","position":[-82.01727445492182,0,30.40303548655673],"scale":0.7730203303297837},{"type":"grass","position":[-3.54555963933547,0,2.986988388876776],"scale":0.9426651274257842},{"type":"grass","position":[41.9489451939163,0,-51.67122798968954],"scale":1.0593029456888496},{"type":"grass","position":[-38.48357550364389,0,-15.569292488119345],"scale":1.0102725230319418},{"type":"grass","position":[-29.02254948324336,0,14.934516179196578],"scale":0.9731696279150626},{"type":"grass","position":[58.887889975243255,0,126.21267883876612],"scale":0.9764870081812624},{"type":"grass","position":[-72.12889355907161,0,24.51651963294954],"scale":1.1007256973439858},{"type":"grass","position":[-26.67609143775336,0,-117.67153775181801],"scale":1.0381341146905396},{"type":"grass","position":[0.08187983345557277,0,148.64600932236024],"scale":1.2893686918402327},{"type":"grass","position":[-2.903446353016912,0,-7.6856596617735695],"scale":1.1115967808451814},{"type":"grass","position":[-66.99288938860722,0,-112.90723021030996],"scale":1.0896166517191788},{"type":"grass","position":[73.3141459084694,0,79.17429559518523],"scale":1.1027416972860042},{"type":"grass","position":[26.60858352870382,0,75.00742877299672],"scale":0.915235688406999},{"type":"grass","position":[3.203592418416031,0,4.061810800578973],"scale":1.248524776021747},{"type":"grass","position":[-34.47603807170862,0,-22.724503537389673],"scale":1.2546194025715354},{"type":"grass","position":[35.637021340691255,0,9.5863842282279],"scale":1.1969587271935158},{"type":"grass","position":[139.66691409273812,0,-34.69404938879251],"scale":0.7041030625057112},{"type":"grass","position":[-54.911797049288815,0,85.65560281640433],"scale":0.8675397037443315},{"type":"grass","position":[113.58553948624416,0,-47.53877979627987],"scale":0.8973625597093255},{"type":"grass","position":[-2.664274725989727,0,87.56321372581696],"scale":0.8383357153104761},{"type":"grass","position":[-74.52632609489841,0,60.86387950421072],"scale":1.0282484054051988},{"type":"grass","position":[36.12164530587201,0,-2.9505281715612397],"scale":0.9168451833509736},{"type":"grass","position":[79.97847015690512,0,49.107188150304204],"scale":1.2133583046191276},{"type":"grass","position":[15.417149021645034,0,51.35028752043139],"scale":0.9667530723326502},{"type":"grass","position":[45.94363179499905,0,-35.17697386861724],"scale":0.7293793471627706},{"type":"grass","position":[54.75585156899558,0,70.74952680544202],"scale":0.8337687953495465},{"type":"grass","position":[1.5243831898348756,0,-4.538968820720233],"scale":0.8596110066251543},{"type":"grass","position":[-32.49380246454034,0,65.21623408434913],"scale":0.9982299776199809},{"type":"grass","position":[-53.88492675462512,0,-59.18483816612964],"scale":0.7378717566723489},{"type":"grass","position":[-58.01707334031674,0,119.19245660509857],"scale":0.9612856301099746},{"type":"grass","position":[-86.91529795799637,0,-98.47187885300622],"scale":1.2487489336904747},{"type":"grass","position":[-113.55461844096362,0,-56.92863015590214],"scale":1.0195890048055705},{"type":"grass","position":[-98.57427713483338,0,27.952235922541057],"scale":0.889314418086623},{"type":"grass","position":[12.65850089776046,0,-4.4343301002827475],"scale":1.2677590437249306},{"type":"grass","position":[76.97579970255659,0,42.62051781549266],"scale":1.0185938308304605},{"type":"grass","position":[-0.766997748416335,0,1.4715993679702721],"scale":1.182125686100273},{"type":"grass","position":[46.50329820171249,0,-5.246441318096196],"scale":0.7524017505525711},{"type":"grass","position":[-39.889328464647974,0,-12.395251256636675],"scale":1.076786763673235},{"type":"grass","position":[4.113383201996271,0,-48.53260974591462],"scale":1.2822693713021638},{"type":"grass","position":[0.20905013511813614,0,16.069156722177496],"scale":1.1986480242793558},{"type":"grass","position":[-82.15515182231145,0,-82.6085120703149],"scale":0.8748170566548342},{"type":"grass","position":[-31.275586521924126,0,44.210869090759985],"scale":0.9324386681199953},{"type":"grass","position":[-53.289994410299585,0,-43.38380462943435],"scale":1.2558698929583114},{"type":"grass","position":[-67.29821325046704,0,29.240973286591306],"scale":1.0102320339008646},{"type":"grass","position":[-52.805781328903485,0,-66.58091387429332],"scale":0.9377971425715116},{"type":"grass","position":[-6.298712023096624,0,-29.326632005024234],"scale":1.234430095145982},{"type":"grass","position":[-18.28123856423177,0,-4.568218265500097],"scale":1.084371340822853},{"type":"grass","position":[22.374040394983552,0,23.033214357632655],"scale":1.0397592173615355},{"type":"grass","position":[-60.28121194998982,0,56.41664287985232],"scale":1.0490468647129467},{"type":"grass","position":[-50.58743694386475,0,-78.48278737479038],"scale":1.284461021369323},{"type":"grass","position":[-71.02915045975571,0,-27.28663792487379],"scale":1.1249475282226788},{"type":"grass","position":[-13.824775227223435,0,53.465650972346886],"scale":0.8365316444380655},{"type":"grass","position":[102.50703316100248,0,9.555113000023253],"scale":1.2135126798525309},{"type":"grass","position":[-24.08865184962314,0,90.19800046047075],"scale":0.7589390527401196},{"type":"grass","position":[-34.80805340476652,0,-33.4162440100238],"scale":0.9210913128816455},{"type":"grass","position":[65.22895076237978,0,6.551784643605984],"scale":0.9588598005127049},{"type":"grass","position":[70.34079170650574,0,12.648730011357085],"scale":0.9427250043359664},{"type":"grass","position":[-21.25263728501412,0,-26.774927842400622],"scale":1.0018860296613772},{"type":"grass","position":[72.30236530251322,0,76.7128635351982],"scale":1.1737681202523165},{"type":"grass","position":[133.8131267099368,0,-40.3247925617952],"scale":0.9528610955933314},{"type":"grass","position":[-19.674467865891252,0,-24.816681874726157],"scale":1.2105152992766737},{"type":"grass","position":[-40.336353028202026,0,125.33399736462329],"scale":1.2899235264159246},{"type":"grass","position":[3.781337486757665,0,75.59748729711762],"scale":1.1299675809037946},{"type":"grass","position":[23.713397330504055,0,-68.84348433947814],"scale":0.9734163391884312},{"type":"grass","position":[-1.966572049166075,0,-22.989771836279314],"scale":1.0753244804662758},{"type":"grass","position":[82.35145892025616,0,-22.74098153831061],"scale":1.217103901239176},{"type":"grass","position":[-8.318867113889038,0,145.96829321765657],"scale":0.8707765075506644},{"type":"grass","position":[-48.341842247949636,0,-140.11594497879113],"scale":0.8073250829211376},{"type":"grass","position":[-12.921112139216092,0,-73.4276900115082],"scale":1.2527344147542265},{"type":"grass","position":[65.78904205767552,0,-89.58970648747481],"scale":1.1834102466947607},{"type":"grass","position":[9.9048328632043,0,13.48305646233704],"scale":0.817185654783567},{"type":"grass","position":[-73.85280287785505,0,38.93558124718571],"scale":0.7141671223164475},{"type":"grass","position":[31.80546666193526,0,-125.23895274318235],"scale":0.9122698775047452},{"type":"grass","position":[71.07513670810518,0,-43.02596439242727],"scale":0.7660843312661075},{"type":"grass","position":[47.45966145937672,0,-12.805009288985847],"scale":1.220089212987527},{"type":"grass","position":[19.836747027134678,0,51.195833489920275],"scale":1.2188278269689097},{"type":"grass","position":[38.06166984179898,0,105.42248285603641],"scale":0.8347124485709001},{"type":"grass","position":[31.817239883715047,0,35.52213062291286],"scale":1.1922176467575296},{"type":"grass","position":[112.46683248489985,0,-6.179349897568211],"scale":1.2175917860030363},{"type":"grass","position":[71.90957210137461,0,-82.0704467520935],"scale":1.0731592888561785},{"type":"grass","position":[49.35961147291143,0,-99.23394448673297],"scale":1.1812400340470788},{"type":"grass","position":[-91.24381260054157,0,-85.08294840358603],"scale":0.9342644044697272},{"type":"grass","position":[-81.63167896682342,0,-72.18505659958812],"scale":1.0470373145456815},{"type":"grass","position":[-6.294678743749874,0,-147.27955215984997],"scale":0.9923684157165468},{"type":"grass","position":[144.8061930672784,0,-6.903891865610948],"scale":0.7352383142619542},{"type":"grass","position":[-54.94062020061415,0,52.6906015031705],"scale":1.0810561216509007},{"type":"grass","position":[103.27648118545747,0,47.675475871581675],"scale":0.775670777016059},{"type":"grass","position":[-47.86131764924678,0,-67.77091480772953],"scale":1.083499009244517},{"type":"grass","position":[3.630855462024745,0,35.68071813694371],"scale":1.0248124377890104},{"type":"grass","position":[-48.23703925169193,0,-29.1011194255506],"scale":1.2889967558426405},{"type":"grass","position":[-91.6351926946533,0,90.80760364440427],"scale":0.9341946314099997},{"type":"grass","position":[2.4160181472050715,0,8.653549493942355],"scale":1.026584142809116},{"type":"grass","position":[-57.258217937930574,0,-85.74249161414627],"scale":1.2837954937585887},{"type":"grass","position":[-1.9417578956801724,0,6.621125824070948],"scale":0.8011285648500776},{"type":"grass","position":[-58.30838647333431,0,-29.08413481841658],"scale":1.2470117471509816},{"type":"grass","position":[-145.82710140164573,0,8.833667889706891],"scale":1.116773272571378},{"type":"grass","position":[-78.34980783084606,0,-5.768289509471201],"scale":1.299248066992021},{"type":"grass","position":[-35.22251994466374,0,-86.87941790066722],"scale":0.8888479255234544},{"type":"grass","position":[-12.624853371535842,0,-108.93991118570128],"scale":1.1041744342420328},{"type":"grass","position":[34.930104604695394,0,87.45939753761645],"scale":1.2110528399747704},{"type":"grass","position":[-28.47269751948894,0,-19.749810411076886],"scale":0.9763886833761836},{"type":"grass","position":[-22.85148463308132,0,34.368761539820646],"scale":0.9894250846142274},{"type":"grass","position":[-39.253563155621016,0,-50.404347037717706],"scale":1.2968233245602625},{"type":"grass","position":[-116.56251375163048,0,-43.21934851503136],"scale":1.2572729837760723},{"type":"grass","position":[-2.2656280716496404,0,116.87440035518539],"scale":1.046035297498382},{"type":"grass","position":[1.8184415973057833,0,-15.73208407308836],"scale":0.9086629768991247},{"type":"grass","position":[-53.50003424358548,0,-80.319419866958],"scale":1.1647187840974156},{"type":"grass","position":[-75.34481266380924,0,-94.97108368913976],"scale":0.8875241082071802},{"type":"grass","position":[-78.03411595777213,0,-0.16900256064641986],"scale":1.1382763314267865},{"type":"grass","position":[-90.0505335231835,0,-108.69771660538945],"scale":0.7326714971244205},{"type":"grass","position":[-18.86678359841564,0,28.941864657494428],"scale":0.8888943073582094},{"type":"grass","position":[-44.890446870941794,0,-40.80848201533567],"scale":1.1219724348364228},{"type":"grass","position":[35.763054016579574,0,18.809819255087476],"scale":1.145796333412727},{"type":"grass","position":[10.322736855687664,0,-13.49865073988207],"scale":0.7580530552874634},{"type":"grass","position":[35.09343413284886,0,48.77699490895403],"scale":0.913472158054047},{"type":"grass","position":[-65.9583129005049,0,-3.2720585557716646],"scale":0.7262449821856226},{"type":"grass","position":[-16.9911277312312,0,-32.1341257379289],"scale":0.9923310525876063},{"type":"grass","position":[-10.28646316481673,0,74.65590920450911],"scale":0.807255423292126},{"type":"grass","position":[-6.373803281239288,0,18.610171272557416],"scale":1.1326663902327259},{"type":"grass","position":[6.927329176870241,0,34.80160901536172],"scale":0.9283032701658751},{"type":"grass","position":[-23.11916245858469,0,24.650482836247594],"scale":1.2757962697820333},{"type":"grass","position":[0.6348908810097363,0,-17.257428457246665],"scale":1.2690183902720933},{"type":"grass","position":[19.067202105081858,0,-11.984397602294598],"scale":0.7888982767521892},{"type":"grass","position":[22.877794226996947,0,-11.217350268064745],"scale":0.9205204684425702},{"type":"grass","position":[56.01641119562043,0,26.2612076506126],"scale":1.2767709577334991},{"type":"grass","position":[-7.229146622313181,0,7.062915033365499],"scale":1.1161449087504662},{"type":"grass","position":[3.991077380212415,0,6.995586237987706],"scale":0.8894530082608589},{"type":"grass","position":[-30.188489375748624,0,34.242533916637775],"scale":1.119381090879323},{"type":"grass","position":[64.89466194058886,0,59.06256304678491],"scale":1.0479694799868318},{"type":"grass","position":[-7.800753977579939,0,-65.39630120623536],"scale":1.1790146685849205},{"type":"grass","position":[10.93617682915882,0,-13.355602370367077],"scale":0.8234851478805086},{"type":"grass","position":[76.87263952298532,0,109.53279365217232],"scale":0.7924085791336134},{"type":"grass","position":[-32.04696168356745,0,19.472298649686174],"scale":1.227153530866063},{"type":"grass","position":[-27.250643212246604,0,3.793695298717459],"scale":1.124893261991425},{"type":"grass","position":[33.09291113771307,0,-93.68455722799256],"scale":0.7990328821158199},{"type":"grass","position":[-53.92570464390631,0,-17.389241354082014],"scale":1.0520496533216024},{"type":"grass","position":[61.15866016878453,0,-99.04147837212803],"scale":1.0862231904085697},{"type":"grass","position":[0.10534829730814915,0,-0.7406977414278207],"scale":0.7421671864010981},{"type":"grass","position":[-12.712146045203003,0,-29.431779387333545],"scale":0.9563663336647641},{"type":"grass","position":[0.13042770771252854,0,1.444637618130164],"scale":1.091077389892077},{"type":"grass","position":[-27.270062144137167,0,9.078776124623058],"scale":0.8682247528052713},{"type":"grass","position":[2.4153652644447274,0,1.8955299410676179],"scale":1.0741702572204055},{"type":"grass","position":[-18.29841235760859,0,-84.17935314790165],"scale":1.2320801722235626},{"type":"grass","position":[29.60079422564501,0,-112.84436059077004],"scale":1.2762618516323152},{"type":"grass","position":[29.011107818755814,0,88.73765605845982],"scale":1.0494504766979833},{"type":"grass","position":[111.65607226118841,0,29.561583460557877],"scale":0.9119893443043284},{"type":"grass","position":[91.8336721817143,0,-55.35237828397207],"scale":0.8308641397731361},{"type":"grass","position":[-74.50228671602788,0,-23.46649184593321],"scale":1.2586789630893414},{"type":"grass","position":[15.35036029952907,0,12.784901975751428],"scale":1.1390415050517153},{"type":"grass","position":[48.2002327197928,0,16.737462377454346],"scale":0.8084015985582688},{"type":"grass","position":[-40.130621717587125,0,50.21644163708909],"scale":1.0307823945006482},{"type":"grass","position":[-24.425009663249906,0,44.63917017674392],"scale":0.921559839176888},{"type":"grass","position":[5.902395564167275,0,-64.69381456713514],"scale":1.1557322128256715},{"type":"grass","position":[103.18947528290927,0,-55.378582349670516],"scale":1.1426898538639025},{"type":"grass","position":[-32.31579060196492,0,-66.81712437470465],"scale":1.000035183815651},{"type":"grass","position":[133.0542434594918,0,-11.842931182412881],"scale":0.731117214052686},{"type":"grass","position":[11.21441662019129,0,31.88761548939438],"scale":0.8332909546660039},{"type":"grass","position":[83.07624947911496,0,-25.505300802069254],"scale":1.0461733956275945},{"type":"grass","position":[42.301062197503775,0,-116.72668665221947],"scale":1.2611680426085916},{"type":"grass","position":[-73.62652962905295,0,-72.42986468394986],"scale":1.1557817821290572},{"type":"grass","position":[-58.922356444278805,0,-28.516636568915292],"scale":0.9068073576458333},{"type":"grass","position":[-73.22852992138354,0,44.992703333799334],"scale":1.2410692776512624},{"type":"grass","position":[-11.504370341742705,0,-36.751275045448814],"scale":0.7689053263751557},{"type":"grass","position":[-59.837151421204695,0,65.24867630109514],"scale":0.7817088951685782},{"type":"grass","position":[118.2733188402237,0,-80.62550025827696],"scale":0.7430079456036945},{"type":"grass","position":[32.34181348227796,0,124.05570716763553],"scale":1.1878695754926916},{"type":"grass","position":[-148.9337672267087,0,-0.5493359433688967],"scale":1.205030689774254},{"type":"grass","position":[-12.199783341919922,0,67.73668583604436],"scale":0.7613105331124762},{"type":"grass","position":[-39.51215970375504,0,15.850480090363423],"scale":1.2365340114698415},{"type":"grass","position":[-14.396772993466152,0,-4.50549386549889],"scale":1.0777240546489215},{"type":"grass","position":[16.290190976462505,0,-21.668257542341387],"scale":0.7332252810160901},{"type":"grass","position":[81.928067483405,0,49.61520508861536],"scale":0.8260479609954484},{"type":"grass","position":[-103.68042377073922,0,39.869682072977156],"scale":1.1194151243278427},{"type":"grass","position":[87.76146397416768,0,-22.836252543410303],"scale":1.2185546294757044},{"type":"grass","position":[-0.835144478228195,0,-100.88275394828051],"scale":1.2144151575601851},{"type":"grass","position":[0.920697292962401,0,-53.824804331981014],"scale":1.2191615687155701},{"type":"grass","position":[87.63882845381076,0,116.12266844182545],"scale":1.1599322677479926},{"type":"grass","position":[-60.56158080499396,0,6.604291235555543],"scale":0.8044660466190641},{"type":"grass","position":[-2.399953522113618,0,48.88699549340936],"scale":1.2689200808736576},{"type":"grass","position":[-66.16304094458556,0,13.5007932258028],"scale":1.1823519058371967},{"type":"grass","position":[1.4373191411440376,0,78.1936933095447],"scale":0.7312548101635882},{"type":"grass","position":[-62.466978267092514,0,-114.77742611388884],"scale":1.2400778373996852},{"type":"grass","position":[123.94469415284378,0,-12.175389151163259],"scale":1.0710890824468982},{"type":"grass","position":[34.284281366490546,0,-31.745196317164606],"scale":1.0001158426156047},{"type":"grass","position":[-114.38338962094656,0,38.46466207886541],"scale":0.9182317939762592},{"type":"grass","position":[-63.067859171074055,0,97.50692975942427],"scale":1.2413521115159434},{"type":"grass","position":[2.481651408933348,0,25.63417520566617],"scale":1.0873219184270686},{"type":"grass","position":[-29.83628515223113,0,90.79709514225341],"scale":1.0383908096203167},{"type":"grass","position":[-53.354056763164664,0,-113.72353883995153],"scale":0.9045038940877644},{"type":"grass","position":[-4.47130213852506,0,-4.895281411782883],"scale":1.0595478522665704},{"type":"grass","position":[86.86714149511168,0,-51.919273642221526],"scale":1.2505779886910335},{"type":"grass","position":[75.03157151250193,0,-27.829003871477752],"scale":1.2472507255490448},{"type":"grass","position":[-76.94279968339357,0,-109.81301882958371],"scale":1.023059117550823},{"type":"grass","position":[-5.698316763290738,0,-0.08759302608396144],"scale":0.9526781075330142},{"type":"grass","position":[110.41512516321369,0,-86.38575322899797],"scale":0.9753740856546219},{"type":"grass","position":[6.838338052439023,0,19.85057039415733],"scale":0.7664004051665412},{"type":"grass","position":[53.972555859004245,0,-107.54146654543325],"scale":1.049032673412602},{"type":"grass","position":[75.84864118440134,0,-117.93343736136707],"scale":1.031844967511475},{"type":"grass","position":[-13.77994217237672,0,11.263334444489555],"scale":1.1964216926599913},{"type":"grass","position":[136.69273051091182,0,-38.37249628057358],"scale":0.7695192000094173},{"type":"grass","position":[120.5145076084034,0,73.77423422342058],"scale":1.118008165667967},{"type":"grass","position":[-131.67677979282973,0,53.48883811098744],"scale":1.105599092010899},{"type":"grass","position":[7.625316525737636,0,3.023670075577595],"scale":1.1881954934169856},{"type":"grass","position":[79.45344196484065,0,-25.481366029672348],"scale":0.719558825509329},{"type":"grass","position":[64.45147311139874,0,22.472938665659232],"scale":1.069998209628014},{"type":"grass","position":[28.660837588349455,0,-12.022432148211681],"scale":0.8322610654475711},{"type":"grass","position":[1.4575011131909787,0,-10.58135659098792],"scale":0.8878924466688749},{"type":"grass","position":[103.7161162539918,0,-64.21938702446151],"scale":0.7477671862655833},{"type":"grass","position":[21.484442987325398,0,-141.67343733351905],"scale":0.9702938128921639},{"type":"grass","position":[51.9083196103943,0,-15.199935275065291],"scale":0.9652231377206015},{"type":"grass","position":[-5.747807544833315,0,0.12024445846880678],"scale":0.8030857153927828},{"type":"grass","position":[78.5354737276434,0,12.861180735609489],"scale":1.0700726587931844},{"type":"grass","position":[19.484470134472097,0,11.172852925751469],"scale":0.9311022684495662},{"type":"grass","position":[-14.269038266986136,0,9.874654801742137],"scale":0.7295831861986507},{"type":"grass","position":[9.170881348469246,0,9.075697604176902],"scale":1.0383587560357428},{"type":"grass","position":[1.30683444131439,0,15.850575761249207],"scale":0.8997172782753142},{"type":"grass","position":[-11.481089954150066,0,13.62963380001206],"scale":1.2549727278944545},{"type":"grass","position":[-0.4569385867921809,0,0.3045189770106057],"scale":0.9467260515249677},{"type":"grass","position":[26.362199625071806,0,-81.12171778036611],"scale":0.9679823814982523},{"type":"grass","position":[32.47656755324425,0,-58.97820769431392],"scale":1.2038362424291915},{"type":"grass","position":[6.7818269534545355,0,-7.354815017139881],"scale":0.7010241954183087},{"type":"grass","position":[-111.3569965164411,0,-27.370137526539782],"scale":1.2433450340346544},{"type":"grass","position":[18.93804236981958,0,-11.470461880568928],"scale":0.7930540698107166},{"type":"grass","position":[-28.077759933293976,0,-51.88112913912836],"scale":0.7608306713576352},{"type":"grass","position":[-51.536077372846336,0,78.58324037724839],"scale":0.8827284618752258},{"type":"grass","position":[23.48453673662801,0,132.3195465630487],"scale":1.0030983468250674},{"type":"grass","position":[-16.632587743199426,0,76.42301753256272],"scale":1.1317809288021743},{"type":"grass","position":[-32.43042075535382,0,-45.1278349829471],"scale":0.8969448958353841},{"type":"grass","position":[105.18899908657114,0,-27.422266643164583],"scale":0.7318059673927293},{"type":"grass","position":[-4.954972929169624,0,-20.10296637588902],"scale":0.9130168441443919},{"type":"grass","position":[20.30397266511035,0,17.161584564163476],"scale":1.1331991504609347},{"type":"grass","position":[79.15234800992772,0,39.417374911885],"scale":1.2720017110773543},{"type":"grass","position":[-71.54109780769535,0,-3.2739476709982327],"scale":0.9565525534449706},{"type":"grass","position":[67.62207773477373,0,-16.115883595672656],"scale":0.7550257125853419},{"type":"grass","position":[59.11578017865117,0,18.129190480775435],"scale":1.2166070467286845},{"type":"grass","position":[-0.39679105382305424,0,-2.932861257268016],"scale":0.8343920966360603},{"type":"grass","position":[5.290357225125866,0,16.434149011406536],"scale":1.1136018583689942},{"type":"grass","position":[11.026972893351042,0,3.0638323273023307],"scale":1.1058480363044239},{"type":"grass","position":[-59.75898598086426,0,28.541110861691994],"scale":0.9664054888933151},{"type":"grass","position":[96.5864989323541,0,-84.96777779272664],"scale":1.2338175637088793},{"type":"grass","position":[-45.53803017276687,0,2.05115443636148],"scale":0.9937865198094171},{"type":"grass","position":[91.73777656463042,0,-19.5268153665625],"scale":0.9248696258194461},{"type":"grass","position":[-0.6983483699005368,0,30.004634829803255],"scale":1.0753716982174784},{"type":"grass","position":[-12.385301068376304,0,-80.1297553222501],"scale":1.0588453272612892},{"type":"grass","position":[19.168513361824097,0,-122.52509447446585],"scale":1.1668423999437325},{"type":"grass","position":[-23.52256468062644,0,-38.596277304631315],"scale":1.169167576899831},{"type":"grass","position":[113.50276625653693,0,58.71164693674353],"scale":1.2947281508768271},{"type":"grass","position":[-22.831415665395966,0,-45.83171115755013],"scale":0.8604793178294765},{"type":"grass","position":[5.262880499107359,0,-130.64027068611347],"scale":0.8907574628252046},{"type":"grass","position":[18.59443556513549,0,-7.648201312280767],"scale":0.7805289522145901},{"type":"grass","position":[37.41439209051695,0,-24.693251347033716],"scale":1.0842017759657383},{"type":"grass","position":[63.72188192034691,0,3.3200611673174425],"scale":0.9063845740429899},{"type":"grass","position":[104.59202615734817,0,69.97447816719531],"scale":1.1038360291553748},{"type":"grass","position":[-77.77361978481107,0,-27.728603266797563],"scale":1.1019738164532338},{"type":"grass","position":[-52.004770854860155,0,21.680662118532595],"scale":1.018828855822401},{"type":"grass","position":[-69.49802911304612,0,83.77276063751806],"scale":1.2829662135308304},{"type":"grass","position":[-3.6533630307165073,0,2.0664206630376922],"scale":0.852519569758242},{"type":"grass","position":[14.165605536216669,0,-63.034924224358534],"scale":1.0558344314385524},{"type":"grass","position":[-38.79203239547953,0,-13.312735984042881],"scale":1.0600789267384096},{"type":"grass","position":[-56.12463508440544,0,-34.926832909631145],"scale":1.1041879943357498},{"type":"grass","position":[-124.86614041502062,0,-57.50885015086305],"scale":1.2672627318014387},{"type":"grass","position":[146.58750189689036,0,-11.069696026402585],"scale":1.186247906988566},{"type":"grass","position":[-12.541895592909906,0,41.957109817730384],"scale":0.9830289240575325},{"type":"grass","position":[-47.84192546919307,0,-132.44910835594231],"scale":0.7802058684193587},{"type":"grass","position":[-40.938062427355966,0,-113.89821398590648],"scale":1.2158653751890218},{"type":"grass","position":[76.49190477787315,0,26.32219167188611],"scale":0.9690570093862751},{"type":"grass","position":[-117.10489611773754,0,0.229345798403337],"scale":0.9511049288692296},{"type":"grass","position":[41.659970945294326,0,-28.083276169057832],"scale":0.9818017115376244},{"type":"grass","position":[40.66142046756411,0,-111.90424861483403],"scale":0.9373623179758123},{"type":"grass","position":[-76.35163741904888,0,-102.75337584587189],"scale":0.8592201204533307},{"type":"grass","position":[10.950011356260092,0,-143.89333495450808],"scale":0.7385664700079527},{"type":"grass","position":[64.35902778772311,0,-101.34850113021048],"scale":0.8393448331298394},{"type":"grass","position":[53.661198105979835,0,70.33585436145579],"scale":0.8988821766002689},{"type":"grass","position":[-77.76289854982052,0,52.676387044331335],"scale":0.9779320486278793},{"type":"grass","position":[-7.036204572476808,0,5.222228355757286],"scale":0.8280888676897231},{"type":"grass","position":[-105.07672587239502,0,-36.67568392513753],"scale":1.1892522262099263},{"type":"grass","position":[35.43867065662219,0,-19.190600058166233],"scale":0.9226455272992004},{"type":"grass","position":[25.10412720011864,0,19.120842975451076],"scale":1.2713053988164278},{"type":"grass","position":[-6.204421820794543,0,123.10126123892175],"scale":0.724312070129171},{"type":"grass","position":[92.47940769239054,0,29.9683854391095],"scale":1.136251004024796},{"type":"grass","position":[2.5007828785252757,0,-16.328419186019566],"scale":0.9052444162471596},{"type":"grass","position":[75.63866822648505,0,121.647754514765],"scale":0.7172862924424437},{"type":"grass","position":[16.54113837018155,0,7.9939838862437265],"scale":0.9849434135476087},{"type":"grass","position":[-88.34493079571966,0,108.27285853354456],"scale":0.9301856911857977},{"type":"grass","position":[20.510014055221493,0,50.79211063320649],"scale":0.829420860102047},{"type":"grass","position":[70.88472531321786,0,-83.02658856882609],"scale":1.2666471309376122},{"type":"grass","position":[20.32981385388582,0,-16.089982848204276],"scale":0.8702807082185108},{"type":"grass","position":[101.45580622469534,0,103.40407958308786],"scale":0.9133277727456732},{"type":"grass","position":[38.89940785490423,0,15.089445303844663],"scale":0.9419750598870141},{"type":"grass","position":[32.641217902928105,0,114.15704429890789],"scale":0.9467835354289645},{"type":"grass","position":[-70.00997119462754,0,25.30152621791395],"scale":0.9004492053045579},{"type":"grass","position":[-20.956839109664912,0,25.412104425228968],"scale":0.9042532225973926},{"type":"grass","position":[143.060193734337,0,-14.258741216994272],"scale":0.7233531306479062},{"type":"grass","position":[32.89293826500134,0,55.929147887010494],"scale":1.1300386770673398},{"type":"grass","position":[-46.59208014357408,0,13.42697905502325],"scale":1.2834300936077727},{"type":"grass","position":[-123.97154396117115,0,-83.92223924000322],"scale":1.295433311939834},{"type":"grass","position":[61.140747219869496,0,-68.01091332400028],"scale":1.173914245616415},{"type":"grass","position":[66.33307582718088,0,4.7844524763999745],"scale":0.8013172117184406},{"type":"grass","position":[6.30448667561496,0,-60.040295063411676],"scale":1.1422446883237747},{"type":"grass","position":[69.1225235269577,0,-26.06424127144606],"scale":1.1800185614128647},{"type":"grass","position":[37.589348590934875,0,-7.7250711784727395],"scale":0.8673659133110305},{"type":"grass","position":[32.004193542529315,0,-29.438034007637306],"scale":1.1507181963275166},{"type":"grass","position":[-78.00150846889717,0,50.151528126231646],"scale":0.738985633881622},{"type":"grass","position":[-94.74949041556773,0,-56.377883268548416],"scale":0.752956619483847},{"type":"grass","position":[-13.144183739611849,0,-41.790172276669786],"scale":1.2712638692507663},{"type":"grass","position":[36.33937404980678,0,54.38740537750381],"scale":0.984480029143825},{"type":"grass","position":[-31.78054926963821,0,-27.63157627349754],"scale":0.8095152996616258},{"type":"grass","position":[32.30252348813282,0,-139.27685839916504],"scale":0.849847223572878},{"type":"grass","position":[64.46046104728723,0,-36.48015956688232],"scale":0.9836511124094377},{"type":"grass","position":[-50.634058634695144,0,83.06391501854488],"scale":1.1517063184422434},{"type":"grass","position":[-51.434589502770564,0,-33.310442432855496],"scale":0.7589400110966964},{"type":"grass","position":[-30.59057502393327,0,7.145046035646843],"scale":1.036299537421915},{"type":"grass","position":[41.69954160513347,0,-75.51694030377702],"scale":1.2800776325128518},{"type":"grass","position":[3.1696707870616234,0,-82.8725879826342],"scale":0.8608291594947381},{"type":"grass","position":[-89.65087087428103,0,-51.447133673095884],"scale":0.7408381786549381},{"type":"grass","position":[-4.50438631334001,0,-19.715441395697418],"scale":1.1505448577960624},{"type":"grass","position":[-15.379297929663531,0,14.750509202486498],"scale":0.8774309635247356},{"type":"grass","position":[-35.431582601234815,0,-75.25374665258637],"scale":0.7430375077141953},{"type":"grass","position":[0.9223101566014031,0,59.11508425764875],"scale":1.0473722436839772},{"type":"grass","position":[7.103582856637497,0,-99.8177738898059],"scale":1.0276112238493627},{"type":"grass","position":[-43.37509394500224,0,72.76721789944033],"scale":0.7939149445374916},{"type":"grass","position":[38.55447950698781,0,22.786871465485348],"scale":1.0570506889273272},{"type":"grass","position":[-2.0193091205797247,0,-47.75519676028789],"scale":1.2842858656516298},{"type":"grass","position":[-67.99406492157446,0,10.22954074959804],"scale":0.7938710316911347},{"type":"grass","position":[28.4375063881264,0,-22.752403900772226],"scale":0.7054371517066965},{"type":"grass","position":[-64.53084606984956,0,3.7254713739963967],"scale":0.9466790625379179},{"type":"grass","position":[-23.392792848830382,0,129.6524966539101],"scale":1.2704511042524467},{"type":"grass","position":[123.69317862063187,0,-47.959382620172335],"scale":1.2352527496599977},{"type":"grass","position":[41.26531891088694,0,-108.69475125214782],"scale":1.2966340935669547},{"type":"grass","position":[28.206442234929508,0,-27.355545501700828],"scale":1.1567658507202763},{"type":"grass","position":[-18.640187895248573,0,61.984398160235976],"scale":1.1776804927210898},{"type":"grass","position":[-132.19688114164927,0,37.877833569176204],"scale":0.888034052723904},{"type":"grass","position":[-75.58123448486376,0,53.70929595814095],"scale":1.2297945093077032},{"type":"grass","position":[-39.04464743326113,0,-65.33957317487535],"scale":1.2544087384886302},{"type":"grass","position":[-118.84379080177595,0,20.829886617044238],"scale":0.9707277704571339},{"type":"grass","position":[-8.455245222766896,0,9.727982623710735],"scale":0.8870289989583138},{"type":"grass","position":[66.9246688007056,0,64.45574504914107],"scale":1.0428211517484542},{"type":"grass","position":[0.6546231322232885,0,-105.42082742127215],"scale":0.774025370104928},{"type":"grass","position":[23.141892430242105,0,36.46130324207002],"scale":1.118316911232169},{"type":"grass","position":[7.500190807779323,0,3.7545580724666823],"scale":1.0815550017197957},{"type":"grass","position":[61.98096387562852,0,80.48944347223765],"scale":1.0984315351413976},{"type":"grass","position":[3.201292639009372,0,-0.07088048471343901],"scale":1.0902254275929215},{"type":"grass","position":[87.25639757714727,0,71.9589196287131],"scale":0.8837765426505425},{"type":"grass","position":[6.900058006750433,0,-16.446891282180264],"scale":0.7560300232102265},{"type":"grass","position":[76.96709504332205,0,106.55769946034074],"scale":1.1622739238451103},{"type":"grass","position":[52.52195326670505,0,-106.36731010959149],"scale":1.2524491107671096},{"type":"grass","position":[-117.11419656859908,0,26.01851228053483],"scale":0.7927526346228267},{"type":"grass","position":[-3.246358928603141,0,-5.9162050101297],"scale":1.1317225090492675},{"type":"grass","position":[32.231182743869915,0,85.3814467758336],"scale":1.1828781781061735},{"type":"grass","position":[-133.67532743466552,0,42.234864217524574],"scale":1.21110183615682},{"type":"grass","position":[-51.28228144809696,0,12.604995646435304],"scale":1.0061249987776755},{"type":"grass","position":[-28.10720402257156,0,-43.075554659548345],"scale":0.7980017350515386},{"type":"grass","position":[-121.39202947250033,0,-12.516793555608345],"scale":0.9656483704670082},{"type":"grass","position":[39.037199286604725,0,-53.29767407459855],"scale":0.7360589062948537},{"type":"grass","position":[-69.3412169408797,0,-32.03169658699564],"scale":1.1953158642210924},{"type":"grass","position":[21.421813263915887,0,-28.21999865488517],"scale":1.2247376332347328},{"type":"grass","position":[-80.53031762944978,0,126.51472086858611],"scale":1.1385325137794224},{"type":"grass","position":[-47.60157822247681,0,-21.73775735372446],"scale":0.8569764181579047},{"type":"grass","position":[-45.78877559156961,0,13.634246543931154],"scale":0.9449989344549505},{"type":"grass","position":[-34.019705281683045,0,125.12579933970304],"scale":0.7115833733407138},{"type":"grass","position":[39.50561287073347,0,81.81570652766703],"scale":1.0368558862436108},{"type":"grass","position":[19.237648262502024,0,-26.465162295131435],"scale":0.9907874780345785},{"type":"grass","position":[40.054913665969835,0,62.83514888331365],"scale":1.1116625279202033},{"type":"grass","position":[-87.99536885033892,0,-87.77540235249609],"scale":1.1035454483931937},{"type":"grass","position":[-10.391674158080322,0,49.41763536639325],"scale":0.7087320476489337},{"type":"grass","position":[51.47088090946645,0,-45.583309995613],"scale":0.8891164547087127},{"type":"grass","position":[7.1443356727414775,0,1.39765503353658],"scale":1.055125140762192},{"type":"grass","position":[-18.15520240457741,0,-66.03125806280259],"scale":0.9683745714203633},{"type":"grass","position":[94.91393137672517,0,17.218303982514733],"scale":0.7751602530453905},{"type":"grass","position":[9.631127418855836,0,139.75317355928829],"scale":1.1641465653379446},{"type":"grass","position":[-57.9917042456565,0,56.90027210467145],"scale":0.7858630646865626},{"type":"grass","position":[-6.63311582802154,0,-10.300419590340184],"scale":1.222985539383086},{"type":"grass","position":[44.021866312151666,0,-97.73184422526617],"scale":0.7733629798380424},{"type":"grass","position":[14.19034123425091,0,-11.331855602425119],"scale":0.8724353699813224},{"type":"grass","position":[-81.34882797601217,0,-60.800782701833086],"scale":0.7170445009697258},{"type":"grass","position":[19.216190884081907,0,-0.859560126818038],"scale":0.9585770137827734},{"type":"grass","position":[116.04004476301938,0,4.965677659160453],"scale":1.25988505637158},{"type":"grass","position":[1.8577052659285889,0,-135.11877599725673],"scale":0.7565335654286373},{"type":"grass","position":[-54.50984843136861,0,-42.21579978455034],"scale":1.2538563787453767},{"type":"grass","position":[-8.5485643074103,0,19.237515343186335],"scale":0.8736487255478141},{"type":"grass","position":[47.05862758394351,0,84.23683613954513],"scale":1.1550213112397532},{"type":"grass","position":[2.383068648974272,0,-25.84658108420793],"scale":1.0306599040791682},{"type":"grass","position":[41.15914892227489,0,73.65763537421658],"scale":1.190977291574256},{"type":"grass","position":[9.24058670759044,0,-3.6253229423396025],"scale":0.7076741237455553},{"type":"grass","position":[-49.02837036802355,0,94.24870219703334],"scale":1.141012749025522},{"type":"grass","position":[109.79989046372813,0,-61.18055967548877],"scale":1.0127240140595557},{"type":"grass","position":[-15.543247529951378,0,2.7975131905518857],"scale":1.2619395829499718},{"type":"grass","position":[-24.020887655423685,0,-42.644452114212115],"scale":1.030283959186801},{"type":"grass","position":[-6.962035154160261,0,-15.10807487811431],"scale":1.2224840577126197},{"type":"grass","position":[-78.5294041356567,0,-38.48329705297473],"scale":0.9084531948055514},{"type":"grass","position":[-72.70305700974195,0,10.860199163120267],"scale":1.035334821390877},{"type":"grass","position":[-10.169030256875796,0,-15.167568175550159],"scale":1.2615987205573553},{"type":"grass","position":[44.06145982991894,0,-72.67843475368191],"scale":1.255468377224061},{"type":"grass","position":[-75.14161465338019,0,46.07604382485425],"scale":0.9750596028943754},{"type":"grass","position":[5.244441194571026,0,-85.69363219365621],"scale":0.9340872198038539},{"type":"grass","position":[46.93915357812697,0,40.70476419560062],"scale":0.7402972030283326},{"type":"grass","position":[9.065822270800004,0,38.04734327224157],"scale":0.8658829794260217},{"type":"grass","position":[16.679199264936166,0,108.79063625147404],"scale":1.0591232318163173},{"type":"grass","position":[-1.9377243900165948,0,-0.0013092543311352606],"scale":0.8832861535195549},{"type":"grass","position":[-35.608570102149976,0,-28.370399697056424],"scale":0.8834247147672728},{"type":"grass","position":[123.61063518260976,0,8.410348110354741],"scale":1.2540166053718185},{"type":"grass","position":[-6.567585494982088,0,-59.0753454231756],"scale":0.9921397569021491},{"type":"grass","position":[40.25079082847503,0,-69.39973222991647],"scale":0.7996588307198867},{"type":"grass","position":[97.38161569672391,0,-42.340450169539835],"scale":1.0999821007716055},{"type":"grass","position":[-61.60479272209487,0,105.60323524419029],"scale":0.9488664819023981},{"type":"grass","position":[-114.41955953282041,0,-59.34429029655566],"scale":0.9899553592704984},{"type":"grass","position":[-18.74495693802513,0,-12.391481364551874],"scale":0.8551557005230284},{"type":"grass","position":[-84.55579811293642,0,58.02071729433486],"scale":1.2682949582304546},{"type":"grass","position":[78.68604319640659,0,41.65616575794203],"scale":1.090000219229834},{"type":"grass","position":[-98.66950720539705,0,60.329144303863906],"scale":0.7240832109972088},{"type":"grass","position":[-57.193611951471404,0,-124.92684281529809],"scale":1.09005388320666},{"type":"grass","position":[-2.05054902386417,0,-58.08672118734426],"scale":0.7723504301534633},{"type":"grass","position":[78.16639901479643,0,40.220989669878215],"scale":1.1153635270781308},{"type":"grass","position":[76.34666055961397,0,-32.38173370306848],"scale":1.0171377237794879},{"type":"grass","position":[-31.280388328743463,0,-35.262785787714954],"scale":0.7394910336926739},{"type":"grass","position":[-55.15257562065207,0,-28.672503685869625],"scale":1.0179661082076303},{"type":"grass","position":[0.7859373499872728,0,21.12027384058715],"scale":0.9770213912931247},{"type":"grass","position":[25.509819823916835,0,86.77903841671923],"scale":0.7429360575124265},{"type":"grass","position":[25.446500490709475,0,-93.58108822815605],"scale":1.0755952733250156},{"type":"grass","position":[15.047180713235191,0,120.84503806710103],"scale":0.9353186719467821},{"type":"grass","position":[70.8540863953091,0,75.87290691034309],"scale":1.2416335534348866},{"type":"grass","position":[39.08933083736304,0,-21.88209646720032],"scale":1.1851615801934656},{"type":"grass","position":[-69.04885299294128,0,3.0659775925423056],"scale":1.1251855939959416},{"type":"grass","position":[128.69613289994427,0,-72.80536145529385],"scale":1.059367639435608},{"type":"grass","position":[82.38592307239746,0,-6.985622517083026],"scale":1.2520227275316744},{"type":"grass","position":[-96.60074848626188,0,29.35920271436708],"scale":0.7132321129735406},{"type":"grass","position":[1.0682689451097833,0,23.905411827954108],"scale":0.8331632206654653},{"type":"grass","position":[107.17696236329449,0,75.6985125174121],"scale":0.7399606885217291},{"type":"grass","position":[-0.8136629620758656,0,0.48594425934946384],"scale":1.2179941609754619},{"type":"grass","position":[7.751264854786195,0,92.8084522942433],"scale":1.270018995040979},{"type":"grass","position":[53.94983778771765,0,-24.3737975914273],"scale":0.7010408008439927},{"type":"grass","position":[48.02971050977042,0,-15.216330341587646],"scale":0.8997149673380115},{"type":"grass","position":[-58.83181051526941,0,16.1086751248707],"scale":0.8806325836155806},{"type":"grass","position":[58.10808408411642,0,-58.83282668766686],"scale":0.7990894466701496},{"type":"grass","position":[-31.33975987455217,0,-37.110791553125324],"scale":1.1016985584472412},{"type":"grass","position":[88.10907348715945,0,109.86790947918959],"scale":1.2003985219042543},{"type":"grass","position":[-137.3925689383962,0,-58.146549692248804],"scale":0.9611011645619568},{"type":"grass","position":[5.63380801178166,0,-1.4797451175992966],"scale":1.1722941301071843},{"type":"grass","position":[-20.74415322352426,0,14.890818884925977],"scale":0.9699231077594577},{"type":"grass","position":[-0.3974360964296764,0,0.6240225755132072],"scale":0.815573137898271},{"type":"grass","position":[65.4405777065554,0,-17.075873910547852],"scale":0.8060134828657446},{"type":"grass","position":[9.18071905815321,0,-12.005964915512934],"scale":0.8081141831048523},{"type":"grass","position":[15.725220993240567,0,-5.996431451388505],"scale":0.8556111454825036},{"type":"grass","position":[-41.56943222280673,0,-3.7109496799386337],"scale":0.954410206529489},{"type":"grass","position":[31.094397800310478,0,-41.740914802133354],"scale":1.23386278513996},{"type":"grass","position":[-2.409904091519797,0,1.160278349208722],"scale":1.0930867621303029},{"type":"grass","position":[-8.700183476376347,0,-81.9483755435166],"scale":1.0057992901949866},{"type":"grass","position":[-67.0076425673603,0,70.41768713081646],"scale":1.1694835804049604},{"type":"grass","position":[15.225323665627183,0,-106.00031551354036],"scale":1.1311861532470686},{"type":"grass","position":[17.638902070180546,0,-44.71829988475759],"scale":1.0654467517966113},{"type":"grass","position":[-101.87101017682477,0,95.46816366996579],"scale":1.0765943613481297},{"type":"grass","position":[69.5910162221618,0,-60.80377352641729],"scale":0.838715017534609},{"type":"grass","position":[-122.81143997806416,0,-6.229512171378202],"scale":0.9651070688328494},{"type":"grass","position":[11.64626850734128,0,14.006209578426216],"scale":1.018222174899527},{"type":"grass","position":[-140.97116120655667,0,-42.151728436484625],"scale":1.2973897022707452},{"type":"grass","position":[50.14833215488168,0,104.81548718331634],"scale":1.1189558732006173},{"type":"grass","position":[34.87303836085293,0,66.0512204473446],"scale":0.8320570558960844},{"type":"grass","position":[1.3607585916123184,0,2.1446584938064635],"scale":0.86431223532516},{"type":"grass","position":[-29.09016502362949,0,-63.40424182149813],"scale":0.7890792161607723},{"type":"grass","position":[91.0686445182689,0,-43.49631811528232],"scale":1.1100652283769978},{"type":"grass","position":[17.176365125460634,0,15.227821243015102],"scale":1.093144848596153},{"type":"grass","position":[-0.4069786334171775,0,-0.02780790070135066],"scale":0.8081329669488915},{"type":"grass","position":[-6.580364830054109,0,8.00962157860822],"scale":1.2929336028227523},{"type":"grass","position":[6.7452817078716345,0,9.07198978084179],"scale":1.1298711916735336},{"type":"grass","position":[-42.50807532540872,0,13.789802086653543],"scale":0.9145599484050875},{"type":"grass","position":[18.497164902962684,0,143.20555121800822],"scale":0.8948388722329297},{"type":"grass","position":[90.38661414085433,0,-80.30771817287435],"scale":0.8570889276906387},{"type":"grass","position":[-7.839455860241051,0,-2.723279166448779],"scale":1.0020298337482738},{"type":"grass","position":[-56.39993515089125,0,-17.36517186608823],"scale":1.0706784575325752},{"type":"grass","position":[25.091604655910764,0,48.46121330604249],"scale":1.1325425845766857},{"type":"grass","position":[105.97837535007011,0,-34.169847557844385],"scale":0.7237965024699873},{"type":"grass","position":[-6.282473338296569,0,119.28192570323553],"scale":0.8933680912084185},{"type":"grass","position":[-24.098428517409445,0,38.034027264537166],"scale":0.9729586999982318},{"type":"grass","position":[-18.24184583814216,0,90.93312037797003],"scale":0.8589563739287117},{"type":"grass","position":[6.003310719046306,0,10.82067496228003],"scale":1.065276808012681},{"type":"grass","position":[30.273250898926193,0,-46.7613305583494],"scale":0.810154861960219},{"type":"grass","position":[65.0734850218665,0,-44.35938100918231],"scale":0.9808974886351444},{"type":"grass","position":[-57.776629133209774,0,-59.1013069543339],"scale":1.0565289361650656},{"type":"grass","position":[-54.77546443461765,0,-85.1235586750897],"scale":0.9803256311268111},{"type":"grass","position":[71.14419996679841,0,-111.02386846437231],"scale":0.940199070770418},{"type":"grass","position":[-16.21732597353987,0,-5.117037153449362],"scale":1.1865427616987647},{"type":"grass","position":[51.37380243339804,0,38.46433985327654],"scale":1.0642163782135612},{"type":"grass","position":[-27.840871822751016,0,55.316439114196704],"scale":0.8840909077750299},{"type":"grass","position":[51.35075618284242,0,4.617769051579994],"scale":1.1879038588760427},{"type":"grass","position":[23.160642049735603,0,127.08909252253828],"scale":0.8387048869326431},{"type":"grass","position":[-17.064837623747593,0,30.44580309270339],"scale":1.0382376088939835},{"type":"grass","position":[1.198575725814814,0,-34.01489025590651],"scale":1.112788409982267},{"type":"grass","position":[86.36660157891608,0,100.95312975192317],"scale":0.9948075690257008},{"type":"grass","position":[-14.519939761071528,0,99.76357618715141],"scale":0.7029864227914857},{"type":"grass","position":[6.028335928733958,0,-0.6535365855975973],"scale":0.9617871390824853},{"type":"grass","position":[-90.33560980777797,0,75.09524797353748],"scale":1.016758875481067},{"type":"grass","position":[-8.475538024289252,0,-3.062146821488324],"scale":1.1537896591354264},{"type":"grass","position":[-93.59150804158162,0,-70.40883659893022],"scale":0.7435715257634453},{"type":"grass","position":[-30.947510203756305,0,90.54355889537919],"scale":0.7495102337433456},{"type":"grass","position":[-48.54245173601844,0,-26.31639765198794],"scale":1.1099439106683329},{"type":"grass","position":[-91.07222366375264,0,84.16710113545197],"scale":0.7882000417411346},{"type":"grass","position":[-91.82411505269648,0,-45.56341381935469],"scale":1.2348747221987653},{"type":"grass","position":[-14.022366410419057,0,-38.16399361125054],"scale":1.2481825042503487},{"type":"grass","position":[94.05827526803847,0,-86.63459386284458],"scale":1.0429621975056755},{"type":"grass","position":[-70.65975708919609,0,16.795002164755005],"scale":0.7221983962212161},{"type":"grass","position":[58.034789497687655,0,-89.4645340203976],"scale":0.7038209300502147},{"type":"grass","position":[-11.847303401683906,0,-8.872809392679839],"scale":1.2929216985957144},{"type":"grass","position":[-54.640859151424515,0,1.6994368666803321],"scale":0.9453359002626344},{"type":"grass","position":[11.653450712290356,0,-0.9982458573298677],"scale":0.7995547639361569},{"type":"grass","position":[122.38420824419325,0,64.84477052713045],"scale":1.1504350949212137},{"type":"grass","position":[35.394931914592576,0,119.10362711289204],"scale":1.090824598942139},{"type":"grass","position":[48.53619947599116,0,-26.303113294720145],"scale":1.0835589632858154},{"type":"grass","position":[25.70846380564226,0,65.54683038873972],"scale":1.2513180208658938},{"type":"grass","position":[-14.586960874456757,0,68.90524181113592],"scale":1.113333586233861},{"type":"grass","position":[14.90844709024849,0,-143.5748313918324],"scale":1.0857600117102049},{"type":"grass","position":[18.711089663898804,0,-82.15018458947519],"scale":0.8747349216270467},{"type":"grass","position":[7.901414666863748,0,35.82349475733974],"scale":1.0574404622400495},{"type":"grass","position":[4.514410932485721,0,-24.9857461611066],"scale":1.2895803620482713},{"type":"grass","position":[6.701761212062467,0,0.2604887528533361],"scale":1.135821349001639},{"type":"grass","position":[67.75188972715647,0,-29.536916979721475],"scale":0.90057982183026},{"type":"grass","position":[124.45346778925946,0,-41.278136724747995],"scale":1.0420269303707363},{"type":"grass","position":[36.48220011076591,0,-50.752963698576686],"scale":1.1835721822903627},{"type":"grass","position":[9.99592071093126,0,-67.07059395503266],"scale":1.0277121652792442},{"type":"grass","position":[42.23324759522411,0,-113.13053082238186],"scale":0.8437002973646691},{"type":"grass","position":[-35.42484676274921,0,14.144604308834316],"scale":1.0879626598806504},{"type":"grass","position":[5.05356378129044,0,-22.283451731152066],"scale":0.8536369035103399},{"type":"grass","position":[-64.1510129070739,0,-15.751959415801055],"scale":1.2642919964354713},{"type":"grass","position":[-15.668350031030702,0,0.9701783366295335],"scale":0.857818013807111},{"type":"grass","position":[16.405825559033204,0,36.800451129846444],"scale":0.9889746568655684},{"type":"grass","position":[-0.5045338384480276,0,-9.727931962743734],"scale":0.9274710242021023},{"type":"grass","position":[3.604756467925082,0,11.680600805821824],"scale":1.1275626945494934},{"type":"grass","position":[85.87945374846427,0,-61.606355309921476],"scale":0.9616642994575726},{"type":"grass","position":[-39.16926261079487,0,11.792399077405161],"scale":1.1233002096201568},{"type":"grass","position":[98.8475338463596,0,107.39715355572292],"scale":1.1625502472424953},{"type":"grass","position":[-0.7728045132778932,0,-1.5101871442179944],"scale":0.720024598268681},{"type":"grass","position":[-18.516090649121686,0,79.04997412517632],"scale":0.868719301454087},{"type":"grass","position":[-37.61278510199167,0,17.22399043372635],"scale":0.8846437111001378},{"type":"grass","position":[-22.157529742444694,0,36.583845364216536],"scale":1.247398321669839},{"type":"grass","position":[61.54014683000239,0,-134.35219211253855],"scale":1.1577612531157695},{"type":"grass","position":[134.34384350544346,0,24.803803484679964],"scale":0.9581626315404657},{"type":"grass","position":[-47.99216780140546,0,-123.15308688122475],"scale":1.1363180547211438},{"type":"grass","position":[25.00624084130385,0,-16.640132165372044],"scale":0.8747245892294828},{"type":"grass","position":[9.16756991749629,0,-31.521945317225818],"scale":0.9517520212084092},{"type":"grass","position":[-31.304701935249707,0,-79.70957952168084],"scale":1.1928815784223694},{"type":"grass","position":[-44.08500513327364,0,-136.19255143351046],"scale":0.9093503258473058},{"type":"grass","position":[96.66132524396245,0,-8.02394040715591],"scale":1.244241306114279},{"type":"grass","position":[-129.2425903621467,0,-56.99400755841483],"scale":1.1274311160045465},{"type":"grass","position":[52.07297485096703,0,-94.52419448788399],"scale":1.0684105936563368},{"type":"grass","position":[72.83086251531905,0,12.117566153679622],"scale":1.2289781768549877},{"type":"grass","position":[51.922356418553235,0,55.129669699766495],"scale":0.804035277246051},{"type":"grass","position":[-11.018131263689433,0,87.11945720031946],"scale":0.7096655968703277},{"type":"grass","position":[-2.161402986950756,0,42.408563449807275],"scale":1.0743185268808575},{"type":"grass","position":[59.73062340914829,0,-17.064472817932735],"scale":0.9142216154896643},{"type":"grass","position":[140.08123359636465,0,6.833105683927033],"scale":1.0744864627799806},{"type":"grass","position":[127.75534752803293,0,-5.372586069149358],"scale":0.986516476553644},{"type":"grass","position":[5.919120328161377,0,-8.290422871262907],"scale":0.8713002418524016},{"type":"grass","position":[15.068193548770925,0,-82.16377880068352],"scale":1.0593670306146818},{"type":"grass","position":[4.704985030073022,0,-19.7134619491203],"scale":0.8073033995849611},{"type":"grass","position":[99.20870168017892,0,30.879965948358812],"scale":0.7039741626171784},{"type":"grass","position":[-7.763499197561444,0,-11.378550799177187],"scale":1.0284161674367287},{"type":"grass","position":[44.72944368418862,0,-103.22675755752095],"scale":0.8983020592037614},{"type":"grass","position":[-48.43874522969494,0,-79.91213625063214],"scale":0.9568551353631789},{"type":"grass","position":[-18.433752588225033,0,8.467529798104987],"scale":0.7983468624632151},{"type":"grass","position":[-3.340028341488979,0,-96.36955622655383],"scale":1.0069571877145478},{"type":"grass","position":[-27.237648547127858,0,-96.07904236586016],"scale":0.787757484404811},{"type":"grass","position":[71.88341061988957,0,69.66005400562338],"scale":1.0066569369975613},{"type":"grass","position":[-18.004853415504165,0,106.27870156033993],"scale":0.855286878752551},{"type":"grass","position":[-59.534465660912694,0,133.79114004583897],"scale":0.801901348768214},{"type":"grass","position":[-50.341950002657626,0,-6.852716725818871],"scale":0.7425579651549302},{"type":"grass","position":[-61.81516075757984,0,40.24899429768175],"scale":1.1401901009030815},{"type":"grass","position":[70.72606051356729,0,-24.971053993328297],"scale":0.7407562200615958},{"type":"grass","position":[28.242964104081178,0,26.37390021044347],"scale":1.0836701563345514},{"type":"grass","position":[21.673750510081458,0,-29.010505787263448],"scale":1.1792957901762127},{"type":"grass","position":[17.956950078117295,0,-36.21942037562747],"scale":0.7972946438842075},{"type":"grass","position":[8.965438416693356,0,116.77200111877144],"scale":1.1236378352781775},{"type":"grass","position":[-66.61567062946615,0,-50.79255280039209],"scale":1.0275877559472555},{"type":"grass","position":[95.22480251489179,0,-24.329854022893603],"scale":0.9577627921801845},{"type":"grass","position":[82.62381688445247,0,-3.4134696610536173],"scale":1.209208972473446},{"type":"grass","position":[-7.821566824816974,0,5.654055764936398],"scale":0.951588422877423},{"type":"grass","position":[14.598541555223488,0,-68.36901475392132],"scale":0.9471754215967676},{"type":"grass","position":[-69.06797742837927,0,81.01773114086703],"scale":0.7140362729324742},{"type":"grass","position":[-26.384487045458567,0,17.850557766355998],"scale":1.188372118846253},{"type":"grass","position":[-74.8262868764344,0,124.7026526906876],"scale":1.2830309078785387},{"type":"grass","position":[34.88926426084372,0,-48.47914326829756],"scale":0.9164047341098482},{"type":"grass","position":[110.82219788459174,0,-46.23975322137957],"scale":1.0346264936968819},{"type":"grass","position":[-16.172461753227452,0,19.496078489111987],"scale":1.0711857612742512},{"type":"grass","position":[-34.29159258685557,0,79.2739278172165],"scale":1.0031416444713344},{"type":"grass","position":[-43.304379857264955,0,-4.752644170877539],"scale":0.7889336213669732},{"type":"grass","position":[-113.91122465554986,0,24.788379272839446],"scale":0.8728102187678909},{"type":"grass","position":[2.795263063942763,0,-41.176034566548736],"scale":0.7415583874247953},{"type":"grass","position":[-70.67606755096011,0,110.66705692009718],"scale":0.7484009162617795},{"type":"grass","position":[-103.54287071220504,0,-20.096073962101844],"scale":0.9629375565473857},{"type":"grass","position":[-40.356681294397504,0,-121.75118753539707],"scale":1.1342730318226344},{"type":"grass","position":[-147.90898136540972,0,7.5086319364696745],"scale":0.9400972700497975},{"type":"grass","position":[101.78082737658318,0,-26.639749179236006],"scale":1.2824743587420042},{"type":"grass","position":[37.32722883792908,0,4.208575698874107],"scale":0.9492220175431347},{"type":"grass","position":[-140.00231351475705,0,32.84679193859335],"scale":1.1849178563188552},{"type":"grass","position":[45.305619035048124,0,-11.769325619574968],"scale":1.216213505976588},{"type":"grass","position":[14.550006013116585,0,-144.46281744300293],"scale":0.8007006318233988},{"type":"grass","position":[-46.18033536863823,0,-4.609755662908014],"scale":0.9517709433484332},{"type":"grass","position":[77.04788053475282,0,38.05905002548253],"scale":1.1633736317673242},{"type":"grass","position":[-88.72079435556337,0,-75.66112456615554],"scale":0.8717778112756895},{"type":"grass","position":[-50.795690771491635,0,42.85658810372942],"scale":1.257630215768578},{"type":"grass","position":[-8.496396293342041,0,56.68740656498896],"scale":1.2399824062185467},{"type":"grass","position":[-107.22554867831917,0,36.73022943813415],"scale":0.9806308074495759},{"type":"grass","position":[-1.8639412198868817,0,-3.117658167084664],"scale":0.9959941691129471},{"type":"grass","position":[-54.4946821762692,0,-78.2281879919587],"scale":1.0195892145417513},{"type":"grass","position":[43.100641700442,0,-28.94306765842992],"scale":0.7500864853334678},{"type":"grass","position":[-23.939617879559584,0,-134.4372869562551],"scale":0.8460717468869177},{"type":"grass","position":[-111.7037911028788,0,-63.34818920743742],"scale":1.1447750318903789},{"type":"grass","position":[-12.891116071006596,0,-1.790987585770908],"scale":0.7428951921830486},{"type":"grass","position":[88.4207778897569,0,-18.01604110406944],"scale":0.7563717577100642},{"type":"grass","position":[43.43755565816263,0,-89.90780670376229],"scale":0.8395733129624817},{"type":"grass","position":[133.68613885818704,0,15.848926970399038],"scale":0.844530765957351},{"type":"grass","position":[-0.3510919001707332,0,3.4809057789474176],"scale":0.7514910911432083},{"type":"grass","position":[-7.282665263157427,0,5.144533875284409],"scale":0.9618340725635455},{"type":"grass","position":[-9.255958440116308,0,53.8392927912602],"scale":0.9617756596794126},{"type":"grass","position":[110.28335481323366,0,-1.0805479951851957],"scale":1.0961294192122448},{"type":"grass","position":[23.490982339200833,0,13.751763451442711],"scale":0.9799004565576488},{"type":"grass","position":[6.35022005766276,0,-0.9788547125232702],"scale":0.7178763323709967},{"type":"grass","position":[-0.4638663784309838,0,19.02874294594193],"scale":0.7817317639846038},{"type":"grass","position":[-1.236403177899661,0,-14.254727172604174],"scale":1.1864046442656182},{"type":"grass","position":[-6.868971523439589,0,-5.715475404126642],"scale":1.0406872627202715},{"type":"grass","position":[-42.97058710660232,0,11.1432346060702],"scale":1.2789737850234215},{"type":"grass","position":[-58.003734609616075,0,75.27796681588016],"scale":1.2083914356396903},{"type":"grass","position":[48.171511577908305,0,66.55276555913262],"scale":1.2063430787019471},{"type":"grass","position":[-111.67588578671992,0,80.8373938808278],"scale":1.2861695622905849},{"type":"grass","position":[-48.86890023459287,0,-39.81415116829419],"scale":0.8257930959241202},{"type":"grass","position":[83.40040860293979,0,76.00730916938232],"scale":0.8384404090609755},{"type":"grass","position":[-109.67232695953157,0,-9.977024500533693],"scale":0.939479159655972},{"type":"grass","position":[70.85754761953342,0,-16.3574787057085],"scale":0.7441433687473306},{"type":"grass","position":[-73.61208335716218,0,-20.877852063306747],"scale":0.7532656221710512},{"type":"grass","position":[31.43222211222101,0,-56.54304223307588],"scale":0.7661235868562941},{"type":"grass","position":[112.13848727586593,0,-64.44615550850376],"scale":1.0934845922113827},{"type":"grass","position":[-121.30538437317541,0,-4.042567732138331],"scale":0.9353710056504518},{"type":"grass","position":[38.64225165414593,0,-1.2957855040496606],"scale":0.8753381014701082},{"type":"grass","position":[9.475776870023443,0,-3.6320696623336004],"scale":1.0602791399469482},{"type":"grass","position":[-76.4259045350865,0,59.527583530064184],"scale":1.1053048222249948},{"type":"grass","position":[129.30749222010894,0,-19.27669791409992],"scale":0.7441999410059297},{"type":"grass","position":[28.804823316174154,0,-48.349370330222264],"scale":0.9177867837642124},{"type":"grass","position":[-16.470068939708902,0,-97.43346078566826],"scale":0.9913549330002528},{"type":"grass","position":[43.15270032655923,0,-42.35722501370725],"scale":0.7818781928120024},{"type":"grass","position":[-40.625553761667945,0,70.84915227825557],"scale":0.8453682629581003},{"type":"grass","position":[-112.27841513972135,0,-64.74057953366857],"scale":0.8902964992625144},{"type":"grass","position":[-122.67033371758293,0,-80.1735536838808],"scale":0.8561424044814783},{"type":"grass","position":[38.51954941521348,0,-128.48465749622412],"scale":0.8806573281994166},{"type":"grass","position":[13.586587674577832,0,9.995432793713505],"scale":0.8801933398957993},{"type":"grass","position":[33.851772867058315,0,-120.29094014595948],"scale":0.8803508727813432},{"type":"grass","position":[128.50445046658461,0,23.938624197737056],"scale":0.7121083665467042},{"type":"grass","position":[25.452523657846854,0,-70.58561867278151],"scale":1.1472237587847527},{"type":"grass","position":[-129.9633876403626,0,26.589492384524558],"scale":1.258095496449037},{"type":"grass","position":[-17.320898825657846,0,3.685293087166663],"scale":1.0327003824195229},{"type":"grass","position":[83.0266714373688,0,-108.19440376612887],"scale":1.0131575753689068},{"type":"grass","position":[86.54024284781444,0,-93.80413526174297],"scale":1.2741420198676134},{"type":"grass","position":[31.419672075314566,0,-34.875014457757096],"scale":0.9133852767255946},{"type":"grass","position":[-49.29460460313278,0,-33.19995389062773],"scale":0.7027868868716011},{"type":"grass","position":[0.016035483056091513,0,-7.4601922706466235],"scale":1.2996130437578162},{"type":"grass","position":[-137.54772390260203,0,38.5854963343394],"scale":0.8790492546340696},{"type":"grass","position":[-11.66783996977345,0,107.53025302405088],"scale":0.8320219350104913},{"type":"grass","position":[-73.42285161688582,0,-22.90045965556703],"scale":1.2255428486911846},{"type":"grass","position":[-110.77845956446677,0,-54.86255041807176],"scale":1.2320946018476568},{"type":"grass","position":[96.08491122710181,0,-54.62701255176287],"scale":0.7094800785390114},{"type":"grass","position":[-34.365212459384544,0,0.5738979535110202],"scale":1.033289904373957},{"type":"grass","position":[60.42702621098398,0,46.018977748222056],"scale":0.7005372886912904},{"type":"grass","position":[-19.78067565423524,0,146.25151255800262],"scale":1.100653225380825},{"type":"grass","position":[-18.68606719967356,0,-19.28344596610226],"scale":1.2549497357163917},{"type":"grass","position":[-3.069952825241366,0,20.7475904808739],"scale":1.2908491768034043},{"type":"grass","position":[-21.523485230319125,0,-102.48351407787125],"scale":1.103109728126228},{"type":"grass","position":[22.617718201542623,0,-77.77510875409602],"scale":1.0850692983561996},{"type":"grass","position":[68.7294463859652,0,0.23400710950148865],"scale":1.1922338646610056},{"type":"grass","position":[-14.051181243457332,0,107.43982266357962],"scale":0.8110287811327594},{"type":"grass","position":[11.290728341784298,0,77.00609922742521],"scale":0.9253668813298664},{"type":"grass","position":[140.37576439394553,0,-31.55955268306266],"scale":0.9518647305208323},{"type":"grass","position":[12.621850080444558,0,11.343324499573916],"scale":1.281275385292676},{"type":"grass","position":[-9.360877327472377,0,8.157018751788703],"scale":1.2060894016613137},{"type":"grass","position":[5.10679171133509,0,-7.2985800725641905],"scale":1.2606130377153781},{"type":"grass","position":[15.617851531277195,0,2.7655371756936593],"scale":0.814035454391159},{"type":"grass","position":[55.04909299224895,0,-72.55210238290145],"scale":0.7434785245423413},{"type":"grass","position":[143.50469103958625,0,-27.972338128335974],"scale":1.2919088736135764},{"type":"grass","position":[38.87551438876658,0,-133.76988369242747],"scale":1.162323069490943},{"type":"grass","position":[57.131586773533016,0,-51.36013675538255],"scale":0.8528816000411117},{"type":"grass","position":[1.2758021581197416,0,127.36966178860627],"scale":1.0330442478067985},{"type":"grass","position":[-118.55505788410383,0,84.83704837932004],"scale":0.8920585513165412},{"type":"grass","position":[-71.04671145035387,0,31.413426691656937],"scale":1.1751107759277206},{"type":"grass","position":[-14.335814618657409,0,-6.120529554137224],"scale":1.1830957428173028},{"type":"grass","position":[-38.618194950395726,0,-60.6623110589045],"scale":1.1735152050844626},{"type":"grass","position":[59.59428121822298,0,-21.184569361955575],"scale":0.7028988377166786},{"type":"grass","position":[19.736315076861626,0,-53.57280411920129],"scale":1.1351659768066833},{"type":"grass","position":[78.51350337727028,0,64.08488015193116],"scale":1.1575224287743753},{"type":"grass","position":[-4.735641822935065,0,-42.50426601191744],"scale":0.7899686924420134},{"type":"grass","position":[59.75229175449355,0,-104.05122039745132],"scale":1.1577025378033818},{"type":"grass","position":[-19.476580824360127,0,-85.01166715864548],"scale":1.1137725431045202},{"type":"grass","position":[5.774109149105527,0,11.60221152572129],"scale":0.979240532401668},{"type":"grass","position":[115.31610662867273,0,73.62865199521752],"scale":0.8950385772967173},{"type":"grass","position":[-20.821596083619816,0,62.85363141477251],"scale":1.1489510699986991},{"type":"grass","position":[-19.53146689104424,0,31.546341250306043],"scale":0.9095796062574959},{"type":"grass","position":[-15.273899808355981,0,-1.9294043370140612],"scale":0.7761565510354886},{"type":"grass","position":[14.75784443327525,0,-79.86688444929715],"scale":0.8148074059172025},{"type":"grass","position":[-4.292401105673723,0,-14.865533222279335],"scale":1.0342047581221832},{"type":"grass","position":[-112.10738779452178,0,16.337946628439003],"scale":1.0748343612879085},{"type":"grass","position":[4.299374264325765,0,-4.463365378375398],"scale":0.7269656409565727},{"type":"grass","position":[-23.93331215065501,0,101.48644105817232],"scale":0.9474593924367066},{"type":"grass","position":[11.80507268748806,0,-8.06977236701984],"scale":1.0931036518378638},{"type":"grass","position":[48.427467372247584,0,-30.892015478998832],"scale":1.2373731552631435},{"type":"grass","position":[-20.694254499390663,0,-4.197377826391169],"scale":0.9805899972795797},{"type":"grass","position":[53.882221689139364,0,4.1886907500467965],"scale":0.8408230648980799},{"type":"grass","position":[100.02801630639317,0,-4.479924917102234],"scale":1.127305593272201},{"type":"grass","position":[59.488749864530966,0,-73.22123744880727],"scale":1.1540975636933584},{"type":"grass","position":[24.39756832683782,0,-124.94008432418555],"scale":0.8603393395357646},{"type":"grass","position":[16.84145022304571,0,39.666176558481986],"scale":1.1640797063223762},{"type":"grass","position":[-61.02653376217197,0,-69.82395241844199],"scale":0.7170484844683703},{"type":"grass","position":[46.56554560409443,0,60.79657927135335],"scale":0.7155380986650882},{"type":"grass","position":[146.6601619484394,0,30.403123826830655],"scale":1.1552998566250419},{"type":"grass","position":[24.453853995281563,0,-5.790346072281672],"scale":1.1652625914164825},{"type":"grass","position":[-91.65161390149817,0,-38.97393929999366],"scale":0.786972501573048},{"type":"grass","position":[-90.78675017942732,0,19.15384468800347],"scale":1.0672452201087603},{"type":"grass","position":[13.951111715518758,0,9.405765230446445],"scale":0.8306796907957373},{"type":"grass","position":[-70.02970190283884,0,-89.75080729137734],"scale":0.8145896050454938},{"type":"grass","position":[18.749851246613094,0,142.87298924589876],"scale":0.8311322093219778},{"type":"grass","position":[106.08718328380762,0,56.780032326782674],"scale":0.9835645986885877},{"type":"grass","position":[53.69958948133692,0,83.27949306972272],"scale":1.2362581684709628},{"type":"grass","position":[4.823318292977849,0,39.54917376806199],"scale":1.0029576416420263},{"type":"grass","position":[-8.794702665208742,0,39.77100189939801],"scale":1.0807632051484861},{"type":"grass","position":[63.72955124419236,0,134.6514978551339],"scale":0.8732535463696562},{"type":"grass","position":[14.09723772979178,0,21.109303487643665],"scale":0.7596950380093958},{"type":"grass","position":[-84.69391442854027,0,7.195540906349817],"scale":0.7707843716226092},{"type":"grass","position":[-32.71124536950327,0,-17.278881832115896],"scale":1.0216237594939963},{"type":"grass","position":[-85.83214384639501,0,82.85378109221594],"scale":0.8658324070953266},{"type":"grass","position":[61.52916195232356,0,-118.08359032285018],"scale":0.8850584842236466},{"type":"grass","position":[-110.6949344036769,0,22.375228584261627],"scale":1.27498368037132},{"type":"grass","position":[-35.605179635318294,0,67.06379702481341],"scale":0.9227478488543801},{"type":"grass","position":[-34.96878384681471,0,-45.209044156225445],"scale":0.8050742619302903},{"type":"grass","position":[54.106561727759455,0,74.4970051982703],"scale":1.1283013789368412},{"type":"grass","position":[-39.38744412328705,0,-126.87283312208729],"scale":0.7304051933991812},{"type":"grass","position":[38.367303308225075,0,31.3804782112814],"scale":0.9424606777511657},{"type":"grass","position":[24.974167912511735,0,28.827577580336758],"scale":1.2352972428703333},{"type":"grass","position":[29.995878379836594,0,-19.347021531241523],"scale":0.9737472361077433},{"type":"grass","position":[-118.34685999447079,0,54.56472675047309],"scale":0.8223247591386381},{"type":"grass","position":[-65.93181685903225,0,-89.27373513921827],"scale":1.2277564079561796},{"type":"grass","position":[50.941782104137886,0,-52.81179894320129],"scale":1.0204106205898267},{"type":"grass","position":[-49.441008914617726,0,-63.73023653535843],"scale":1.0822191817527533},{"type":"grass","position":[-75.11807834793258,0,-29.822796307335732],"scale":0.8251896372276046},{"type":"grass","position":[0.7441133144090243,0,8.28729736308489],"scale":0.8287859791275807},{"type":"grass","position":[59.89472423639534,0,-24.392851893713093],"scale":0.9271729648530926},{"type":"grass","position":[1.371960957436313,0,-11.122086397313685],"scale":1.2940669175905226},{"type":"grass","position":[13.706174895824711,0,77.57154793242843],"scale":0.7780454033371914},{"type":"grass","position":[41.84685172172019,0,50.43852428457031],"scale":1.0780731867125013},{"type":"grass","position":[-53.983451031639966,0,1.5016767358025482],"scale":0.9704828645148059},{"type":"grass","position":[-27.183133157134268,0,-142.29126963845928],"scale":1.213668651362669},{"type":"grass","position":[-54.99575654216372,0,72.55217035300724],"scale":0.8952146994939183},{"type":"grass","position":[34.55630040738376,0,1.4288334892652894],"scale":0.8738098215591059},{"type":"grass","position":[-41.97614971402152,0,-109.92353015545743],"scale":0.9236701237970768},{"type":"grass","position":[12.200610127382186,0,-5.030014008323234],"scale":0.89798373812659},{"type":"grass","position":[-33.83997745917257,0,12.206616906990828],"scale":0.9473035856683244},{"type":"grass","position":[7.70349525181538,0,30.76513818027427],"scale":1.2938808442650112},{"type":"grass","position":[-58.251621887987376,0,-0.9841381088054022],"scale":1.2832820947559107},{"type":"grass","position":[-50.686916616444336,0,11.167708609724592],"scale":0.7022779775670133},{"type":"grass","position":[24.965796195029174,0,-9.8296350713594],"scale":1.2878326390790675},{"type":"grass","position":[-11.19002485758024,0,22.770181879049264],"scale":0.9109572880399108},{"type":"grass","position":[121.67601380468966,0,-40.74672668128108],"scale":0.9327560436326592},{"type":"grass","position":[-28.173099185726546,0,72.11380929758096],"scale":0.8368174442502748},{"type":"grass","position":[-4.042142940215002,0,-0.9627490879032509],"scale":0.9164339868564979},{"type":"grass","position":[-0.5814311862298679,0,-0.6703180853743372],"scale":0.7877922366702338},{"type":"grass","position":[-72.92341260334992,0,-112.24314974795766],"scale":0.753002480026342},{"type":"grass","position":[109.95199243793769,0,93.07419114971202],"scale":0.756084801043168},{"type":"grass","position":[2.2370238280347903,0,-26.15318277457981],"scale":1.2212267036646436},{"type":"grass","position":[-61.810298320167355,0,-87.9793543060548],"scale":1.033081115851556},{"type":"grass","position":[-24.320638749877634,0,21.16172848170957],"scale":1.0291111567137663},{"type":"grass","position":[53.15511005091358,0,-48.775586569413065],"scale":1.2118415012540327},{"type":"grass","position":[-48.754914259994266,0,39.04312069647993],"scale":1.0429091285652163},{"type":"grass","position":[-8.580383306514124,0,6.783444539882013],"scale":1.197790554249805},{"type":"grass","position":[-0.5652223841276662,0,-46.67245608389803],"scale":0.8579417181636946},{"type":"grass","position":[-44.26006627613552,0,-99.47776937188848],"scale":0.8273350802735843},{"type":"grass","position":[130.52050725519587,0,41.870533023102865],"scale":1.1742934394665394},{"type":"grass","position":[-70.52210791362258,0,28.86145379428987],"scale":1.0015336414899876},{"type":"grass","position":[56.82276089408957,0,130.8990900068013],"scale":1.0480794163321412},{"type":"grass","position":[-5.052009801588151,0,-11.840219764737643],"scale":0.7419750710641637},{"type":"grass","position":[-44.76035154656795,0,-32.5088922504676],"scale":0.9675992133605926},{"type":"grass","position":[26.03190985109101,0,19.449646762901722],"scale":0.743673125117679},{"type":"grass","position":[52.715021815415184,0,-75.87284719915358],"scale":1.2790661735916737},{"type":"grass","position":[-29.788026924907587,0,-13.04061841313928],"scale":1.2030402113195755},{"type":"grass","position":[8.073086818093902,0,8.058340513175974],"scale":0.7518619399871864},{"type":"grass","position":[-71.38467981549509,0,112.77118938247777],"scale":0.7872889139895001},{"type":"grass","position":[-37.833290907201565,0,32.79784579426174],"scale":0.9295066627036871},{"type":"grass","position":[-3.454802248709701,0,-21.89797999325453],"scale":1.175142087404189},{"type":"grass","position":[-69.73686331345777,0,-103.54629194962935],"scale":1.1071114477264241},{"type":"grass","position":[-0.023578631203800528,0,0.6587469312918749],"scale":0.8439444553448721},{"type":"grass","position":[-74.58111445735352,0,-123.24354876548891],"scale":1.1314090908456922},{"type":"grass","position":[18.572048490177522,0,-33.51547453409668],"scale":1.2712715772184175},{"type":"grass","position":[-28.66397196950579,0,30.194631867391177],"scale":0.7876524532585548},{"type":"grass","position":[20.92718918693796,0,-123.57139602436956],"scale":1.1603657795816285},{"type":"grass","position":[-17.39356899849261,0,145.21054440263134],"scale":1.010067595545857},{"type":"grass","position":[14.756132878955524,0,-1.018580312903705],"scale":1.0283956579239795},{"type":"grass","position":[26.021235242139237,0,28.13949331191455],"scale":0.7180694762179178},{"type":"grass","position":[4.802789370263348,0,-27.448650557683376],"scale":1.226248849431413},{"type":"grass","position":[-75.56903614947318,0,28.828943717910754],"scale":0.9606328138782217},{"type":"grass","position":[-41.93486176056616,0,102.56931675368041],"scale":0.9348954963308521},{"type":"grass","position":[-12.375292079819104,0,57.422289498444464],"scale":0.960379512675416},{"type":"grass","position":[7.969467578122188,0,-6.748827413049064],"scale":1.2157910026045302},{"type":"grass","position":[-120.54303273282292,0,75.81047787175422],"scale":1.2801291009830496},{"type":"grass","position":[-63.61578706515428,0,-96.99198266894732],"scale":0.7844922050638792},{"type":"grass","position":[-67.3455974704427,0,-54.86355203056728],"scale":1.0955732156766989},{"type":"grass","position":[-62.289896599039686,0,-4.985597759613763],"scale":1.2035383782551266},{"type":"grass","position":[-70.31816135141618,0,55.17853749114174],"scale":0.9481257468531544},{"type":"grass","position":[-95.39997626413984,0,-78.68128413289519],"scale":1.1042673004842316},{"type":"grass","position":[16.221745633292585,0,75.24786027573734],"scale":1.1208206353578287},{"type":"grass","position":[91.17569818881071,0,-98.3641193017262],"scale":1.2002291789353352},{"type":"grass","position":[15.83377016631946,0,26.76576511453041],"scale":1.1658713368022695},{"type":"grass","position":[3.4639941803057024,0,-29.96592615881066],"scale":0.9636046644903442},{"type":"grass","position":[2.1553397508118746,0,-19.59745977059656],"scale":0.7951022734856974},{"type":"grass","position":[-11.790369625928992,0,37.22221175793305],"scale":1.183588779414554},{"type":"grass","position":[-12.443430356943196,0,5.990189306516484],"scale":1.0471882081536776},{"type":"grass","position":[7.563597978503731,0,-35.01631127643545],"scale":0.8139771187398243},{"type":"grass","position":[-104.66814089434308,0,-59.51208183295623],"scale":0.74900771911162},{"type":"grass","position":[-146.96574589987588,0,-16.844127109803235],"scale":1.0951749306253509},{"type":"grass","position":[-6.908036526567588,0,93.46838250993427],"scale":1.0327109252083984},{"type":"grass","position":[99.85155229640488,0,-34.664434016822796],"scale":0.9641332070532178},{"type":"grass","position":[-33.47461873810897,0,-21.29695708192754],"scale":1.2887452387323686},{"type":"grass","position":[-112.83665857399856,0,73.49110599567003],"scale":0.9262084040346523},{"type":"grass","position":[-64.64577946933288,0,13.405051721803067],"scale":0.9170312729421525},{"type":"grass","position":[-50.63969976072037,0,105.40120876887033],"scale":1.249771047864227},{"type":"grass","position":[-91.67559345387376,0,85.09297232138584],"scale":1.221955453984569},{"type":"grass","position":[-37.2137671417359,0,141.880693846238],"scale":0.9980014590668775},{"type":"grass","position":[-4.68681000198175,0,-2.087935832266624],"scale":0.9201302257918244},{"type":"grass","position":[-97.44252569180976,0,60.292470374176716],"scale":1.0295702227474752},{"type":"grass","position":[-28.695656685541707,0,-44.00460806462055],"scale":1.2225498400526669},{"type":"grass","position":[-108.37270984881913,0,-60.18063643761874],"scale":1.1379883734888714},{"type":"grass","position":[103.81514178522968,0,48.39216155263407],"scale":1.000517344843924},{"type":"grass","position":[-0.2080366142818262,0,105.32707645583078],"scale":0.7051931797396427},{"type":"grass","position":[9.960818358290158,0,-6.435378367975616],"scale":0.7067734323701927},{"type":"grass","position":[105.27371040466092,0,-20.713697326578277],"scale":0.7285716723247336},{"type":"grass","position":[12.569613956665176,0,-37.719499766225155],"scale":0.9902738458510343},{"type":"grass","position":[23.62310468014589,0,11.432025179578947],"scale":0.9210822932606322},{"type":"grass","position":[5.5874130162351445,0,15.302110372017598],"scale":0.9914462943906857},{"type":"grass","position":[-46.041146028893415,0,30.171556095355474],"scale":1.1064747292226504},{"type":"grass","position":[54.55636635931792,0,26.950775793469113],"scale":0.8392430902614938},{"type":"grass","position":[-56.415365321589626,0,-0.07845998774584038],"scale":0.7322396317889416},{"type":"grass","position":[-26.98830884359311,0,-48.97143837522209],"scale":1.1193849727404497},{"type":"grass","position":[-133.73231848215437,0,-57.24092486268551],"scale":1.0105180326265482},{"type":"grass","position":[-127.71091835896628,0,-51.148170698939424],"scale":1.2471301368448617},{"type":"grass","position":[22.125512326463607,0,-15.361299274594346],"scale":0.7963728115274149},{"type":"grass","position":[-90.98160356496625,0,-2.9424091757053867],"scale":0.9016304832374897},{"type":"grass","position":[58.30915729390048,0,-134.48437281947258],"scale":0.9415074816089692},{"type":"grass","position":[24.363059646545235,0,-10.645467526634269],"scale":0.8059331714075078},{"type":"grass","position":[11.13629381663949,0,-17.90663445329407],"scale":1.2217028635548928},{"type":"grass","position":[30.159547673470463,0,-62.028970001737534],"scale":1.0579141192437418},{"type":"grass","position":[-46.797141446822124,0,-111.9688055922113],"scale":1.2970861439880117},{"type":"grass","position":[-72.54189638167723,0,27.960599814570674],"scale":1.0795439332020982},{"type":"grass","position":[-122.96469574990374,0,-36.5967360964863],"scale":1.028870495307108},{"type":"grass","position":[26.832267882102528,0,-64.51033210986004],"scale":1.159082573187456},{"type":"grass","position":[38.738685739691256,0,-38.163285541725045],"scale":0.8949252438051859},{"type":"grass","position":[-22.5950721558935,0,-28.804727282483483],"scale":1.0091903700353735},{"type":"grass","position":[-83.03448730467412,0,19.424727049930073],"scale":1.067580153294526},{"type":"grass","position":[7.814735678948298,0,1.13794337014759],"scale":1.0432191481365234},{"type":"grass","position":[7.682703976521369,0,-66.06127718691586],"scale":1.0044096264595612},{"type":"grass","position":[-50.10969044047162,0,92.5219278574832],"scale":1.2581651838532508},{"type":"grass","position":[-16.17731846905429,0,45.56871004525921],"scale":1.1120824231249982},{"type":"grass","position":[-86.53820796877471,0,-78.1185829484272],"scale":0.9999056350228386},{"type":"grass","position":[64.69839165546628,0,36.12219727595533],"scale":0.7569169992581846},{"type":"grass","position":[36.0728134048022,0,28.180557133492627],"scale":1.0876031913429767},{"type":"grass","position":[71.48006322877903,0,36.840069812816104],"scale":0.8918595288967931},{"type":"grass","position":[-9.479411184628695,0,-49.17273181420467],"scale":1.1790974658897044},{"type":"grass","position":[13.988622138112623,0,98.9456528831264],"scale":0.9435277847140335},{"type":"grass","position":[12.150947803002696,0,-0.5676786347489138],"scale":0.9482342462629952},{"type":"grass","position":[-134.46097390311422,0,17.48373077383406],"scale":0.9779427637965079},{"type":"grass","position":[30.40451187356897,0,-89.15550605005272],"scale":1.154063468372802},{"type":"grass","position":[-8.743692388182403,0,-60.86026216516073],"scale":0.7069668785599144},{"type":"grass","position":[-62.267647479382084,0,-60.955562001996554],"scale":1.0001247954962276},{"type":"grass","position":[67.74280009193332,0,34.98862155442184],"scale":0.9027786753239158},{"type":"grass","position":[-15.030280062120296,0,-26.22062867699337],"scale":0.9360741462622529},{"type":"grass","position":[3.3001428161235604,0,24.071808184671124],"scale":0.7743824195369933},{"type":"grass","position":[-96.98062259175971,0,-0.5183835396238184],"scale":1.0732050506046917},{"type":"grass","position":[107.38634940582217,0,-27.600710326374067],"scale":1.2093964845745022},{"type":"grass","position":[-29.067612402236772,0,-14.05087701797366],"scale":1.2458787784288297},{"type":"grass","position":[-4.938215137451794,0,45.59694695316852],"scale":0.9305774306320315},{"type":"grass","position":[91.70026706442768,0,87.98682000895644],"scale":1.2628991757952703},{"type":"grass","position":[-0.28082538804922874,0,4.3716341309190865],"scale":1.2972912132373824},{"type":"grass","position":[-6.438035340541023,0,-2.7200754751426945],"scale":0.969899350656217},{"type":"grass","position":[9.957487461130683,0,-60.60995234104484],"scale":1.2360685938834424},{"type":"grass","position":[27.539672282813726,0,-53.49842019478731],"scale":0.7703439091191343},{"type":"grass","position":[-32.98735340462844,0,-77.13198665964046],"scale":1.1209909884394609},{"type":"grass","position":[44.14524369666124,0,120.73366384062909],"scale":1.1982551524222753},{"type":"grass","position":[-15.082748058325175,0,26.585376337836813],"scale":0.8381882378455279},{"type":"grass","position":[114.41817490936779,0,66.64483354890451],"scale":0.78700741416644},{"type":"grass","position":[-28.84881248098816,0,-15.872657424002849],"scale":1.2501958325722127},{"type":"grass","position":[-27.483950684498254,0,15.724075799632086],"scale":1.2398475390057855},{"type":"grass","position":[28.47597773547495,0,56.62790620546764],"scale":1.1410773716033944},{"type":"grass","position":[42.49949440461023,0,61.30910236936684],"scale":0.982055985988257},{"type":"grass","position":[145.12472894860258,0,27.899488304491882],"scale":0.721891801792352},{"type":"grass","position":[-117.13524841900927,0,38.65312650506894],"scale":0.8675648979921925},{"type":"grass","position":[68.41786757751925,0,41.82930038467802],"scale":0.8280023617331198},{"type":"grass","position":[-5.3966671664231045,0,30.28513851671437],"scale":1.197199370852732},{"type":"grass","position":[0.5549024564528113,0,-43.0636565321362],"scale":1.0295178221717438},{"type":"grass","position":[-46.359737156844695,0,72.18168089410845],"scale":1.0427098631263796},{"type":"grass","position":[41.41135017190275,0,-35.83670606535196],"scale":0.8920128214282339},{"type":"grass","position":[59.3671008046537,0,-75.89330771122216],"scale":0.9880809045223052},{"type":"grass","position":[63.234696595944904,0,-40.05415237195822],"scale":1.1575462259719496},{"type":"grass","position":[-12.149101384946139,0,-9.602697570260512],"scale":0.9311918053655811},{"type":"grass","position":[-35.61318704241926,0,-15.563847419087862],"scale":0.815771270646244},{"type":"grass","position":[-53.96258574063263,0,5.592378299129908],"scale":1.1097553170554348},{"type":"grass","position":[-37.6704801515817,0,-20.892534776591216],"scale":0.7995815460273257},{"type":"grass","position":[-53.04734019791438,0,-138.8950624682311],"scale":0.7821573507790567},{"type":"grass","position":[28.501015452742163,0,-24.96614095201262],"scale":0.8509081553326965},{"type":"grass","position":[135.23598954873705,0,54.80894683497399],"scale":1.025848295931584},{"type":"grass","position":[13.645269869296943,0,-71.70408054089584],"scale":1.1900765285395125},{"type":"grass","position":[-2.137327568652377,0,-50.765842347738314],"scale":0.9957254418249525},{"type":"grass","position":[-93.08392249452085,0,-58.06696225622575],"scale":1.2252422137773293},{"type":"grass","position":[-47.79406424779815,0,-67.7185608531867],"scale":0.9069777241000068},{"type":"grass","position":[-90.04537781802381,0,-64.4328978117119],"scale":1.2478845081847862},{"type":"grass","position":[85.84341615296871,0,-86.44679613688517],"scale":0.9785118904713156},{"type":"grass","position":[-99.33609588094605,0,42.60329350194985],"scale":1.274238587161579},{"type":"grass","position":[-22.78907193339136,0,-71.26480524967015],"scale":1.292937419432745},{"type":"grass","position":[35.99145131180913,0,70.4601181492665],"scale":1.1827765886913981},{"type":"grass","position":[-90.04391096722124,0,119.85296738928146],"scale":1.131729498936095},{"type":"grass","position":[0.15220182674375524,0,0.16842311171606084],"scale":1.0500096380061867},{"type":"grass","position":[-38.578329019066345,0,-37.61152855217627],"scale":1.0150520112846},{"type":"grass","position":[-111.22816113594493,0,91.68061963088637],"scale":0.7313210966519561},{"type":"grass","position":[59.73093388302829,0,-136.45132344107213],"scale":1.1214786193063238},{"type":"grass","position":[99.92702801348844,0,96.93139204512238],"scale":0.9851840128339993},{"type":"grass","position":[-25.606617157688017,0,-43.42136483830828],"scale":1.174526515271419},{"type":"grass","position":[-123.19528923551258,0,26.69173366169519],"scale":0.7452407134820064},{"type":"grass","position":[-86.31047051266155,0,18.523114904286675],"scale":0.7626895813792798},{"type":"grass","position":[-23.119063522321024,0,25.3068672298179],"scale":1.061015435712614},{"type":"grass","position":[0.06591559162748924,0,129.8163490597867],"scale":1.2258093688213159},{"type":"grass","position":[-42.10321723413588,0,-102.7586810699276],"scale":1.13006615264559},{"type":"grass","position":[53.988644951995546,0,-90.84942322358947],"scale":1.0084110874215888},{"type":"grass","position":[-90.36250636197747,0,-31.32701369242384],"scale":1.2462492617656358},{"type":"grass","position":[8.917032289863679,0,55.24967162898015],"scale":1.2458096977547202},{"type":"grass","position":[-10.026024859587721,0,24.321300361071582],"scale":0.79157471086384},{"type":"grass","position":[6.923669801133859,0,-21.209498960300575],"scale":0.8369159047240927},{"type":"grass","position":[9.667060801763451,0,-53.28371455678906],"scale":1.2093581562783284},{"type":"grass","position":[6.481793595700254,0,5.418396008641806],"scale":1.1792859417715955},{"type":"grass","position":[58.46098272936664,0,-75.28527536484823],"scale":0.7003964456667248},{"type":"grass","position":[-28.387212585580976,0,-7.336727240047997],"scale":1.1930087658611448},{"type":"grass","position":[-50.88121125129478,0,-61.809064667287686],"scale":0.7353645166627748},{"type":"grass","position":[-95.99039085133306,0,69.70938350991118],"scale":1.139694511991989},{"type":"grass","position":[14.605413143679206,0,-133.51497759916586],"scale":1.1116343133665583},{"type":"grass","position":[-118.82556998042566,0,-70.08188494550149],"scale":0.963082823641025},{"type":"grass","position":[-43.50376846110051,0,141.40704250130185],"scale":0.7654511877181457},{"type":"grass","position":[92.23938863284502,0,-76.8081050661861],"scale":0.8014176672666462},{"type":"grass","position":[-22.03908645175895,0,13.59609191019687],"scale":0.7799820318124869},{"type":"grass","position":[-11.265191696805081,0,-18.941548906573573],"scale":0.7684031037324396},{"type":"grass","position":[17.009573798899158,0,-23.070599428595134],"scale":0.7452922932797861},{"type":"grass","position":[4.311043051064518,0,49.019760818260046],"scale":1.1061265081700382},{"type":"grass","position":[-76.32986007144993,0,-49.40334802389993],"scale":1.2259994611815186},{"type":"grass","position":[120.53592396557109,0,-52.537078446702445],"scale":1.2424696930171308},{"type":"grass","position":[2.4280673944661535,0,25.608798223312377],"scale":0.8102583237549782},{"type":"grass","position":[35.16739460932471,0,56.45320385078163],"scale":1.154423294224352},{"type":"grass","position":[35.978949832368265,0,14.926117824702661],"scale":1.2168891794663987},{"type":"grass","position":[39.839477890524975,0,43.38601404229134],"scale":0.949911731320593},{"type":"grass","position":[-9.517037312378218,0,-4.323524127966103],"scale":1.287572674914996},{"type":"grass","position":[14.024894931225312,0,-94.46732022182383],"scale":1.0222883555330688},{"type":"grass","position":[17.001607204266705,0,15.805490593375158],"scale":0.8232118049019054},{"type":"grass","position":[51.128093393225434,0,77.20843641655051],"scale":0.9254680225185449},{"type":"grass","position":[28.314418218102595,0,65.1298379062934],"scale":1.0599823813619893},{"type":"grass","position":[37.26082632984623,0,-90.34959243770194],"scale":0.8033519582204538},{"type":"grass","position":[10.04640119394608,0,35.53820836182482],"scale":1.0395285487664825},{"type":"grass","position":[-125.04870071528029,0,-24.760368925352708],"scale":1.0143899140341035},{"type":"grass","position":[43.150376728460735,0,-87.74968698402354],"scale":1.1328813678192655},{"type":"grass","position":[-14.65477555912179,0,-20.89155981568045],"scale":1.1195493053170724},{"type":"grass","position":[-27.961823440715605,0,-9.670608616577567],"scale":1.269440044182643},{"type":"grass","position":[-3.7055917406181447,0,110.23989903416235],"scale":0.7948541500162919},{"type":"grass","position":[24.723940561892256,0,-4.621601576905358],"scale":0.7738225000081146},{"type":"grass","position":[-4.95477856004737,0,-20.19021985258965],"scale":1.103019166531996},{"type":"grass","position":[17.172209220888753,0,22.044783292236417],"scale":0.9558375805794062},{"type":"grass","position":[-2.378280722291071,0,-1.6146231527468513],"scale":1.191284694555943},{"type":"grass","position":[44.38853496680003,0,40.74455386631703],"scale":1.1129946191501334},{"type":"grass","position":[8.869908349642845,0,-16.106670190897333],"scale":1.0195906364108152},{"type":"grass","position":[-88.83549101068611,0,6.147389481629931],"scale":0.799580335314157},{"type":"grass","position":[-96.62081326390677,0,-76.73357024196751],"scale":0.8654799145189513},{"type":"grass","position":[9.014020967418505,0,-45.95929276672106],"scale":0.7571037875627088},{"type":"grass","position":[1.6239609523301513,0,-1.2405941229438002],"scale":1.13534247160375},{"type":"grass","position":[-23.223459238167138,0,28.25683075095296],"scale":0.978817154935833},{"type":"grass","position":[-49.03964464059199,0,139.79107514916564],"scale":0.7506220795358186},{"type":"grass","position":[-34.28892911316021,0,9.6924116163734],"scale":1.053412055870155},{"type":"grass","position":[51.24616646137458,0,105.92793228374019],"scale":0.9985505862063759},{"type":"grass","position":[42.67690986720052,0,-69.16897716471703],"scale":1.044795884431013},{"type":"grass","position":[12.958748129577092,0,-5.284519174946746],"scale":1.198153266541292},{"type":"grass","position":[3.1092811969302288,0,1.304456986789259],"scale":1.1911705843756382},{"type":"grass","position":[-2.233836632354109,0,7.436919449447979],"scale":0.9938879056110759},{"type":"grass","position":[50.31766856946557,0,123.14346628565598],"scale":1.0865761530771496},{"type":"grass","position":[49.79124141973128,0,-63.090627448528565],"scale":0.9960797004735351},{"type":"grass","position":[33.038987382618345,0,40.5647352876761],"scale":1.0061782050706998},{"type":"grass","position":[-3.8140507976303955,0,-12.28257718713888],"scale":0.8588468868692462},{"type":"grass","position":[60.23969507124807,0,-120.29407549526509],"scale":1.0762617086729158},{"type":"grass","position":[13.455801802188438,0,-19.438552286925272],"scale":0.8146900512279218},{"type":"grass","position":[2.8798698765439936,0,-20.826944749940864],"scale":0.7001093872350835},{"type":"grass","position":[-35.06531732229094,0,3.610002714592618],"scale":0.7084405970409796},{"type":"grass","position":[44.327523850128074,0,-20.604394704689344],"scale":1.1156002301220047},{"type":"grass","position":[0.8943455742300752,0,1.9336611939622335],"scale":0.830712255871096},{"type":"grass","position":[-19.65047144044617,0,57.55124346022532],"scale":1.0063922365500537},{"type":"grass","position":[-68.98693298569171,0,-118.09563795565597],"scale":1.0780912592327376},{"type":"grass","position":[91.60057077914503,0,3.560846340448913],"scale":1.0922510323242842},{"type":"grass","position":[3.1693621249884365,0,-8.079931905914473],"scale":1.0491170690825573},{"type":"grass","position":[6.189208807922646,0,-4.038554045834877],"scale":0.8177815959182996},{"type":"grass","position":[35.89836951492229,0,-55.33148915109631],"scale":0.7027209825599835},{"type":"grass","position":[-3.2300248969221896,0,19.17596094097894],"scale":0.7378350875155156},{"type":"grass","position":[1.5327593075431454,0,3.063534866045135],"scale":1.1563242574877934},{"type":"grass","position":[-67.13070771996729,0,-4.616709870209541],"scale":0.7165520458846085},{"type":"grass","position":[-63.7577775250723,0,-28.57772783567846],"scale":0.942747507195499},{"type":"grass","position":[25.046770226755868,0,-95.66643648446626],"scale":1.1072019775335245},{"type":"grass","position":[88.75394452129748,0,110.8560745274796],"scale":1.2660911142112385},{"type":"grass","position":[31.09656098690642,0,88.14512181822371],"scale":0.7577686120474982},{"type":"grass","position":[-61.29031856929003,0,-81.55696855783408],"scale":1.1020115317012626},{"type":"grass","position":[-14.985063183809704,0,2.612879831676454],"scale":0.8562485150470858},{"type":"grass","position":[-2.2081116058117836,0,-142.3678625107722],"scale":1.0848666736783343},{"type":"grass","position":[0.8393117551434283,0,59.10059663742872],"scale":1.2174594738730706},{"type":"grass","position":[-55.550757693073365,0,22.38752365132022],"scale":0.7510242132883459},{"type":"grass","position":[97.73836172081663,0,47.110898828611376],"scale":1.0377063736833712},{"type":"grass","position":[23.67805228282518,0,-6.0765160508020015],"scale":1.2012356912694235},{"type":"grass","position":[-22.98160567146579,0,-9.341446826096123],"scale":1.1519801571263921},{"type":"grass","position":[67.98149551294497,0,-67.14872282537254],"scale":0.9221764369970322},{"type":"grass","position":[106.5614002449882,0,-71.8528257131282],"scale":1.250996742628827},{"type":"grass","position":[-26.050999447839786,0,14.069843959328377],"scale":0.8658012938548365},{"type":"grass","position":[53.106158987735576,0,61.073765161695015],"scale":0.7201676888644885},{"type":"grass","position":[-32.5487070558591,0,15.86513920270907],"scale":1.1806398993157736},{"type":"grass","position":[96.05964785053045,0,21.983816885597243],"scale":1.266169338957328},{"type":"grass","position":[36.08097217320396,0,24.52989469945909],"scale":0.8592310227632656},{"type":"grass","position":[-4.677873160883359,0,-116.85516303710851],"scale":1.132615921125779},{"type":"grass","position":[9.854608530738656,0,36.858577989724324],"scale":0.7950716401265213},{"type":"grass","position":[38.35305086333062,0,54.835044868656496],"scale":1.047412481802733},{"type":"grass","position":[-40.478733525278024,0,132.00324541544956],"scale":1.0685699127014974},{"type":"grass","position":[-81.09623063622134,0,-103.3292806514948],"scale":1.291647393668355},{"type":"grass","position":[-37.43013060804045,0,-37.72552558809644],"scale":1.0203144959189527},{"type":"grass","position":[117.21278033466426,0,-19.734575107134514],"scale":0.8837017972742105},{"type":"grass","position":[34.398688802661155,0,-117.64339918272661],"scale":1.053920881683533},{"type":"grass","position":[-3.6365805892008822,0,6.899513074102465],"scale":0.9343124522859279},{"type":"grass","position":[-10.360614848096153,0,-21.208418933058894],"scale":1.1595828716854872},{"type":"grass","position":[-46.04971413876992,0,22.937493347211543],"scale":0.9391196402174694},{"type":"grass","position":[72.9324504828895,0,80.29337547893378],"scale":1.0214013955264876},{"type":"grass","position":[-26.132298304144776,0,28.585381508238353],"scale":0.7369396318805933},{"type":"grass","position":[64.64246618492719,0,-41.81221260039235],"scale":1.2828420740548163},{"type":"grass","position":[49.43312320851979,0,-4.656640769372229],"scale":0.9435187066098687},{"type":"grass","position":[37.53795046379662,0,38.17391504092505],"scale":1.2301605364422463},{"type":"grass","position":[-68.9767667977892,0,-104.51844352632483],"scale":0.8186434799013389},{"type":"grass","position":[-40.07711503019073,0,128.62568194934124],"scale":1.278372339613608},{"type":"grass","position":[4.828011683921868,0,-36.308882945500294],"scale":1.2045313919874254},{"type":"grass","position":[-19.7928189157114,0,49.65820621813925],"scale":1.2467708508483277},{"type":"grass","position":[10.750052681507656,0,13.895591690265304],"scale":1.01187423538449},{"type":"grass","position":[132.48492538587084,0,-29.42790491029541],"scale":0.7138916401042695},{"type":"grass","position":[52.36812065882015,0,-81.7508842704054],"scale":1.2442279077899496},{"type":"grass","position":[-21.146669297609662,0,21.94547061293201],"scale":1.0649772252253964},{"type":"grass","position":[126.99657048624945,0,75.87637996249231],"scale":1.1925721490241277},{"type":"grass","position":[-14.57429343735927,0,86.72161267422142],"scale":0.8016824329147765},{"type":"grass","position":[-27.23020284673156,0,2.716639292913204],"scale":0.9077432701854549},{"type":"grass","position":[-3.7246018979694484,0,-34.78412229921232],"scale":1.0530736359829616},{"type":"grass","position":[5.841822256952947,0,122.76742068086021],"scale":0.9888083246073355},{"type":"grass","position":[121.62041195158571,0,37.097531815512475],"scale":1.1275130793705699},{"type":"grass","position":[-40.56120103512828,0,-77.32323252113382],"scale":0.9672511434516465},{"type":"grass","position":[10.991667318523486,0,141.11857390505506],"scale":1.0100340098874083},{"type":"grass","position":[3.2226105880027136,0,34.281063651385175],"scale":0.7911305143027992},{"type":"grass","position":[-35.644801061687296,0,77.95137776443896],"scale":0.9353546640414138},{"type":"grass","position":[17.911177827340826,0,-136.39674898960232],"scale":1.2667948966916998},{"type":"grass","position":[-64.01437675352005,0,-16.71553775462611],"scale":1.0488717031656623},{"type":"grass","position":[80.60446866398951,0,-1.2818100471752039],"scale":0.8503700123029394},{"type":"grass","position":[-89.87612939890973,0,88.91602976490194],"scale":0.8749518270734722},{"type":"grass","position":[-16.12460158256311,0,-73.98873802610234],"scale":0.7838842069200765},{"type":"grass","position":[-96.88472209052864,0,-78.48023464950882],"scale":1.2331658095786482},{"type":"grass","position":[29.103258685597094,0,5.810793154762278],"scale":1.1624217984447263},{"type":"grass","position":[-6.135293436480533,0,-5.28938365940991],"scale":0.8951132780076043},{"type":"grass","position":[47.15916941465925,0,34.53389549696945],"scale":1.0418871183046778},{"type":"grass","position":[49.185180765799245,0,38.85340304025644],"scale":1.296004057042067},{"type":"grass","position":[-5.180335647905354,0,-10.461410731776379],"scale":1.200176212614029},{"type":"grass","position":[-10.806498631276105,0,119.24209766137955],"scale":0.7589556605530468},{"type":"grass","position":[-61.03301026370856,0,-47.91788537705987],"scale":0.9786968346413344},{"type":"grass","position":[-136.89452158737214,0,41.902464412439514],"scale":1.1117402033529833},{"type":"grass","position":[6.2271723394532374,0,-1.5066925923636012],"scale":1.2208076151816898},{"type":"grass","position":[141.82522887228077,0,-4.604623398049937],"scale":0.8988172250836705},{"type":"grass","position":[-21.249863592691227,0,53.817884380648444],"scale":0.9933476338442523},{"type":"grass","position":[37.7088689716236,0,-63.57871608209828],"scale":1.2812828665600353},{"type":"grass","position":[-67.50446602653498,0,32.413884590631824],"scale":1.065285629262637},{"type":"grass","position":[95.19564331912797,0,14.004114686221154],"scale":1.099650311142702},{"type":"grass","position":[0.954098823999878,0,15.97312740205839],"scale":1.029502453857064},{"type":"grass","position":[-0.8528864288813415,0,4.058122996940471],"scale":1.298052256425561},{"type":"grass","position":[-11.455686300315472,0,32.76995394288825],"scale":1.2966603492583249},{"type":"grass","position":[137.0959727805367,0,-14.581946941631196],"scale":1.1357601763204546},{"type":"grass","position":[91.36537249035071,0,-38.36444805629956],"scale":0.9199805835523921},{"type":"grass","position":[12.92118899229289,0,-110.06070002699832],"scale":0.7350075774858155},{"type":"grass","position":[4.575133965117276,0,8.110532649423122],"scale":1.0635963987180383},{"type":"grass","position":[108.96901851929312,0,14.08829953767537],"scale":0.9115474323826117},{"type":"grass","position":[-70.39700614199167,0,-75.60753201645983],"scale":0.9896186865117333},{"type":"grass","position":[-92.29516684336768,0,59.18397966193114],"scale":0.7146049096666994},{"type":"grass","position":[37.9245218761053,0,-42.13698455856874],"scale":0.9897016847565704},{"type":"grass","position":[-21.460178318305047,0,-4.341764113638694],"scale":1.2134613145051296},{"type":"grass","position":[-28.772767912217233,0,-44.23736246437485],"scale":0.9574265820510673},{"type":"grass","position":[-4.529779718346433,0,10.183704744357899],"scale":1.1978628820536967},{"type":"grass","position":[-34.760795692984445,0,93.39522753830983],"scale":0.8911422765669971},{"type":"grass","position":[-85.69131231584362,0,-68.563772172096],"scale":0.8968783975360309},{"type":"grass","position":[-31.01418148903676,0,-33.48108522742858],"scale":1.2422357029074695},{"type":"grass","position":[47.325967578823295,0,124.03687191133497],"scale":0.8309511556888267},{"type":"grass","position":[81.20633518344448,0,113.94321047546418],"scale":1.023562062478242},{"type":"grass","position":[-6.2945846600333715,0,-17.431195312304528],"scale":0.9077349245212414},{"type":"grass","position":[84.1571199821741,0,-81.92133583868628],"scale":1.0685600930821648},{"type":"grass","position":[-80.70523975621279,0,109.99096281545012],"scale":1.142707788792297},{"type":"grass","position":[-27.59936144815774,0,99.06302036753743],"scale":1.2229019271415087},{"type":"grass","position":[2.135532547788902,0,4.682568853627898],"scale":0.9231687667102628},{"type":"grass","position":[107.33823151012545,0,61.444244975390475],"scale":0.8090259673585096},{"type":"grass","position":[-63.047123460946096,0,1.8601211783314981],"scale":0.933549093679386},{"type":"grass","position":[95.17400912537327,0,-80.90063027485576],"scale":1.2675782064442433},{"type":"grass","position":[9.771369257132086,0,-8.603801832011444],"scale":1.1301053656762838},{"type":"grass","position":[-58.40355898573479,0,-35.33665750111874],"scale":0.8372994664119897},{"type":"grass","position":[-28.220476103117996,0,112.77538329213232],"scale":0.8752849465363345},{"type":"grass","position":[22.92947360139325,0,-88.80011092984763],"scale":1.0224734387193708},{"type":"grass","position":[-61.66334568276731,0,87.74356291231054],"scale":1.1399208877161835},{"type":"grass","position":[-23.53725346284168,0,27.726327941116335],"scale":1.0930253717720346},{"type":"grass","position":[15.647746786262145,0,-7.099984148561607],"scale":0.9223836509386001},{"type":"grass","position":[-67.06967637868274,0,86.34920450643797],"scale":0.7424471532919842},{"type":"grass","position":[-12.51376087111426,0,-13.661376931963714],"scale":1.0717947187438395},{"type":"grass","position":[58.316726179679534,0,-78.08725349226866],"scale":1.2059896544100122},{"type":"grass","position":[119.43685992097464,0,11.006590985333151],"scale":1.0228758112582306},{"type":"grass","position":[5.234916848830142,0,-26.252089629860873],"scale":1.1421747166344518},{"type":"grass","position":[-35.32152383888711,0,-77.85261722836913],"scale":0.705970860174178},{"type":"grass","position":[-8.973813698580589,0,68.78460108705788],"scale":0.7653581373884957},{"type":"grass","position":[-73.7656006872468,0,90.11559613797581],"scale":1.144016379745504},{"type":"grass","position":[-123.23302648062285,0,25.483733129860212],"scale":0.7621042908038007},{"type":"grass","position":[-79.94410184786105,0,31.4873577787158],"scale":0.7825838321237915},{"type":"grass","position":[-32.841334842253495,0,133.2236160457179],"scale":0.8640828483003029},{"type":"grass","position":[-18.881301650205998,0,13.378292995034254],"scale":0.8835639612510473},{"type":"grass","position":[-51.10854177619286,0,-3.8974484709570527],"scale":0.7190711305187122},{"type":"grass","position":[-4.299885368620266,0,-31.655513916803873],"scale":0.9365885239401044},{"type":"grass","position":[108.27920007838232,0,-8.67375805360426],"scale":0.8082218129887218},{"type":"grass","position":[7.503512764953696,0,-129.12806333221457],"scale":0.8525411486304995},{"type":"grass","position":[-82.32382639939559,0,-92.67245971034245],"scale":1.2361518176682178},{"type":"grass","position":[-9.359180986387809,0,67.78400553899131],"scale":0.8264328046360506},{"type":"grass","position":[3.3783287131642896,0,-36.97691701848849],"scale":0.7960115803213721},{"type":"grass","position":[116.2922790242473,0,74.71278148070974],"scale":1.197614140246626},{"type":"grass","position":[-9.789776105573988,0,122.11705885418178],"scale":1.2429311420167695},{"type":"grass","position":[-35.71600099643074,0,55.18529657403895],"scale":0.7632603973033454},{"type":"grass","position":[48.32168222555477,0,10.402119565531205],"scale":1.2240679024278958},{"type":"grass","position":[-61.74228809877678,0,-52.92391539422593],"scale":1.0327986065042083},{"type":"grass","position":[75.05727132237232,0,-94.8731036981616],"scale":0.7074535782206265},{"type":"grass","position":[-56.05413350982459,0,11.055632976278543],"scale":1.2413329277525396},{"type":"grass","position":[30.697553335104587,0,-66.35204962711917],"scale":0.8807412671942695},{"type":"grass","position":[-108.88342078479312,0,-33.04985215309755],"scale":0.9566976980874462},{"type":"grass","position":[8.950609469713466,0,-41.99110574902429],"scale":1.1627506365255387},{"type":"grass","position":[-75.41123967130687,0,35.441653548494386],"scale":1.1531015209869797},{"type":"grass","position":[-109.1244200120848,0,-55.159506045430454],"scale":0.9903138701113016},{"type":"grass","position":[130.09049896264068,0,-12.730021243695761],"scale":0.7232602040503765},{"type":"grass","position":[6.617053861963287,0,4.403535396833594],"scale":1.0584704623866914},{"type":"grass","position":[71.06616185453353,0,-32.84393110360233],"scale":0.895221943600988},{"type":"grass","position":[68.09975398541208,0,19.07290821205243],"scale":0.8167277639210605},{"type":"grass","position":[-80.21100800560015,0,68.2175065858264],"scale":1.1500814091607747},{"type":"grass","position":[-103.30555013302462,0,-24.98034320869814],"scale":0.8536045604666614},{"type":"grass","position":[-12.041845886361676,0,-19.62623606534387],"scale":1.1367938087898972},{"type":"grass","position":[-6.998062508813618,0,-97.60523782130653],"scale":1.1317488214033582},{"type":"grass","position":[63.72636434335037,0,-132.61495843832913],"scale":1.0464868824423708},{"type":"grass","position":[-28.998206920401028,0,-80.42962707735659],"scale":0.7894871644811197},{"type":"grass","position":[85.68513590940985,0,7.609820354844911],"scale":0.8909384633308087},{"type":"grass","position":[-17.2223593461408,0,-22.39736703877814],"scale":0.8693392942265264},{"type":"grass","position":[83.87264255268887,0,-33.177646652318785],"scale":0.8986887643235896},{"type":"grass","position":[1.2911724468352255,0,-22.61348419786636],"scale":1.1869071116084968},{"type":"grass","position":[0.5964375648318109,0,0.9548921233925173],"scale":1.2821869552681275},{"type":"grass","position":[-34.157613763937,0,-67.73939209726235],"scale":0.8313070636002277},{"type":"grass","position":[-0.15432367779325304,0,-0.5161529688885063],"scale":1.2325442687939647},{"type":"grass","position":[84.35577257600174,0,25.263149320461164],"scale":1.043365623718532},{"type":"grass","position":[-120.56008226289259,0,-4.840386801563765],"scale":0.8747473219192865},{"type":"grass","position":[5.537442947704899,0,38.975746230898324],"scale":0.9869758413798602},{"type":"grass","position":[-55.311726513725475,0,122.82779130402777],"scale":1.0570172864004288},{"type":"grass","position":[36.62762745714076,0,-127.91559613563545],"scale":1.1652195143933968},{"type":"grass","position":[110.37353746619776,0,-48.963160482881904],"scale":1.147166659082767},{"type":"grass","position":[-78.19782897259107,0,102.03503638600228],"scale":1.185513963782772},{"type":"grass","position":[0.5035339138061574,0,-1.5945274992891738],"scale":1.2913774174125687},{"type":"grass","position":[70.02645752978587,0,93.15510474591444],"scale":1.265459085184618},{"type":"grass","position":[-9.917290424591599,0,-107.38772202066667],"scale":0.7987779231113461},{"type":"grass","position":[-48.39674958219789,0,-2.8244801117168064],"scale":0.9024810505057228},{"type":"grass","position":[50.78330429609923,0,-91.00535480140123],"scale":0.8760280550031205},{"type":"grass","position":[-129.0664095553368,0,43.037055940495684],"scale":1.2098100106074423},{"type":"grass","position":[-80.14788366752846,0,104.06679223278516],"scale":0.7088948654453338},{"type":"grass","position":[-87.0026733812787,0,-49.20018099474959],"scale":1.1793555330084171},{"type":"grass","position":[-96.64527593112636,0,80.35336200466102],"scale":0.8389745259534482},{"type":"grass","position":[118.78633335215625,0,52.8255851797009],"scale":0.880818404167035},{"type":"grass","position":[8.109267552232101,0,49.1055738983901],"scale":1.0755077014989496},{"type":"grass","position":[9.893208965957216,0,-1.2553523292678572],"scale":0.7136340158478375},{"type":"grass","position":[79.33957796720051,0,-82.64816357305918],"scale":1.0495874220879418},{"type":"grass","position":[81.33349640991348,0,-24.235187896436813],"scale":0.8201139989217257},{"type":"grass","position":[-26.524306243368958,0,18.23170288557422],"scale":0.736375189503127},{"type":"grass","position":[18.22279222026441,0,36.23927819403158],"scale":1.1652711995717617},{"type":"grass","position":[15.780691861590336,0,7.431570683259795],"scale":0.9044145318240832},{"type":"grass","position":[-27.24001943323163,0,-104.5236664696501],"scale":0.7947642339223271},{"type":"grass","position":[137.2140697580064,0,-58.01673166169023],"scale":0.9791489455323807},{"type":"grass","position":[-29.559035897335935,0,36.61057985311032],"scale":0.9319601007382738},{"type":"grass","position":[57.76772821575594,0,12.494772694521613],"scale":0.8827383280438038},{"type":"grass","position":[46.395172498313315,0,83.21574425072481],"scale":1.1116400554845467},{"type":"grass","position":[58.6444566277541,0,108.01817079650476],"scale":1.1011927862417759},{"type":"grass","position":[-3.3873243220536784,0,-5.033463325620654],"scale":0.9004932350834454},{"type":"grass","position":[50.35572709174182,0,-57.02956097267322],"scale":0.8474161404932727},{"type":"grass","position":[-34.71407820712455,0,-17.830618589781604],"scale":1.1566811354391837},{"type":"grass","position":[-43.811462345631774,0,-23.65903141594753],"scale":0.8528498936292339},{"type":"grass","position":[26.604593773222458,0,-16.04213564069389],"scale":0.9609448356615234},{"type":"grass","position":[-34.83709722989944,0,103.45388390125123],"scale":0.8644854392415438},{"type":"grass","position":[-0.29467448093299065,0,-79.54778038892377],"scale":0.7559762724084789},{"type":"grass","position":[66.40251816096486,0,127.8517153331235],"scale":1.2727979802197522},{"type":"grass","position":[-135.52620099523344,0,10.989636812296796],"scale":0.9658257273020325},{"type":"grass","position":[36.81253271158167,0,42.70692246534691],"scale":1.0739543827831222},{"type":"grass","position":[71.73240864806425,0,98.02264173904985],"scale":1.2921647008317854},{"type":"grass","position":[-36.33116036136975,0,33.59547255927587],"scale":1.1921786024184464},{"type":"grass","position":[-13.216801329135672,0,-44.89261053874058],"scale":0.7818026590089688},{"type":"grass","position":[9.631377145927159,0,105.98699536115292],"scale":0.8662349120409935},{"type":"grass","position":[28.417045944707077,0,-70.91521447990954],"scale":0.7929967464289273},{"type":"grass","position":[19.47375749416336,0,71.72176600654987],"scale":0.7890179010633682},{"type":"grass","position":[46.10578813581108,0,-12.877048786178447],"scale":0.7068022220850418},{"type":"grass","position":[-88.2347507385863,0,14.66021681944339],"scale":0.9255800233069892},{"type":"grass","position":[-0.03793984977268089,0,-0.00877338770210786],"scale":1.0768909215669338},{"type":"grass","position":[74.59548585304296,0,-3.5649722111252955],"scale":0.9658893009048429},{"type":"grass","position":[30.431328608755695,0,62.676859764513075],"scale":1.1770872125848466},{"type":"grass","position":[-60.59015961829057,0,-68.49445791982613],"scale":0.9909460098602323},{"type":"grass","position":[58.853438668315746,0,71.05918822854632],"scale":0.7954905100235938},{"type":"grass","position":[26.88897019849233,0,147.41504747718676],"scale":1.2581010953965208},{"type":"grass","position":[-4.564742476085816,0,29.973976209824443],"scale":1.2978097025105584},{"type":"grass","position":[-0.9489062260870964,0,-7.475312982768636],"scale":1.2649059661316724},{"type":"grass","position":[88.55028748743494,0,-55.2277958640338],"scale":1.0388808802115006},{"type":"grass","position":[-63.2196146657891,0,97.48780993311075],"scale":0.7911169850155407},{"type":"grass","position":[82.85051586896208,0,-30.714678843872356],"scale":0.7374189982339194},{"type":"grass","position":[-96.01256438425133,0,-54.26081505394388],"scale":1.0694388855206927},{"type":"grass","position":[-74.53178677658259,0,13.58904254400501],"scale":1.1823173722742002},{"type":"grass","position":[16.064882244307924,0,53.80121578982736],"scale":0.9440859485966628},{"type":"grass","position":[-33.73646726531914,0,136.18475901105967],"scale":1.1647968624737808},{"type":"grass","position":[16.177338094816594,0,3.818964754154076],"scale":0.8891129888544748},{"type":"grass","position":[-15.125401527936162,0,16.24891824790047],"scale":1.2786028597315975},{"type":"grass","position":[12.686448861310517,0,-79.61551788404854],"scale":0.9089627470110404},{"type":"grass","position":[-4.706987011622678,0,36.780606054842195],"scale":1.243877657110187},{"type":"grass","position":[33.040392052581566,0,2.086990643788519],"scale":0.7128649476717035},{"type":"grass","position":[-49.23846995319008,0,-11.502484783112356],"scale":0.9405339584008244},{"type":"grass","position":[16.93955734542479,0,2.278230999007192],"scale":1.1954660599407878},{"type":"grass","position":[-43.398673902559814,0,-46.82334944368982],"scale":0.8225235066605865},{"type":"grass","position":[41.07208048277062,0,-56.38032602920863],"scale":1.2763919523823697},{"type":"grass","position":[63.33965894683665,0,78.3241714897116],"scale":1.0945094873656422},{"type":"grass","position":[89.0040514509455,0,13.3236464660445],"scale":0.7754627350790039},{"type":"grass","position":[-8.11610061493762,0,-9.02760787413848],"scale":0.9574591129516845},{"type":"grass","position":[-41.2009312218143,0,14.478475668972452],"scale":0.7975685324754312},{"type":"grass","position":[57.75599161730172,0,-47.73740856749953],"scale":1.2720922196394742},{"type":"grass","position":[-65.41911818303555,0,16.68217227907543],"scale":1.162300259161257},{"type":"grass","position":[-2.6850310262046904,0,-30.749929040456927],"scale":1.1640006003855337},{"type":"grass","position":[72.4165366254966,0,-5.799073477513144],"scale":0.7557945808942426},{"type":"grass","position":[74.6512311985251,0,-109.40673719039872],"scale":1.2462110505832102},{"type":"grass","position":[-55.44907979856402,0,4.90249334429109],"scale":1.1722508366523132},{"type":"grass","position":[39.41991708799735,0,57.8071267831997],"scale":1.0468092002517335},{"type":"grass","position":[59.15134716541447,0,55.55787065948665],"scale":0.9323236611812806},{"type":"grass","position":[21.587752465504426,0,12.789002448371495],"scale":0.7361492188313867},{"type":"grass","position":[-50.96422661670211,0,88.12239300164336],"scale":0.8357291007139691},{"type":"grass","position":[-35.52399319334899,0,-56.63339676148932],"scale":1.241541853758216},{"type":"grass","position":[-131.65383653763843,0,-33.43772903167236],"scale":1.063909587997494},{"type":"grass","position":[6.440018500750394,0,-5.832747414067027],"scale":0.9528158608071006},{"type":"grass","position":[98.38496973847198,0,89.3700259043108],"scale":0.8197571686131192},{"type":"grass","position":[-14.348126564541444,0,-106.3180112965442],"scale":1.2029991783821712},{"type":"grass","position":[-52.37376171951702,0,42.16862923937993],"scale":1.1903233406288842},{"type":"grass","position":[-5.3139665266352125,0,-29.908818134559684],"scale":0.944934823799463},{"type":"grass","position":[-31.566461662688774,0,-5.22601722398646],"scale":1.069049509205272},{"type":"grass","position":[7.083493867361407,0,-47.764696327925094],"scale":1.239811975820132},{"type":"grass","position":[98.53499362075799,0,52.52574931213004],"scale":0.9718021465501672},{"type":"grass","position":[-5.082302794832832,0,-9.714205058141378],"scale":1.0941801509518874},{"type":"grass","position":[7.8527428928374645,0,1.7054515093952944],"scale":0.867367437308221},{"type":"grass","position":[106.20737066605668,0,15.441493056078063],"scale":0.7285322399364255},{"type":"grass","position":[73.9796632803243,0,25.348667316307303],"scale":0.7291898364270489},{"type":"grass","position":[4.09922761311588,0,6.558109177427388],"scale":1.186827899468599},{"type":"grass","position":[-41.213977384604505,0,-83.20260254792528],"scale":0.8821454466310726},{"type":"grass","position":[-148.57183386668808,0,-16.24483529148487],"scale":0.9031039609747982},{"type":"grass","position":[-112.13279566332878,0,-54.4900423219542],"scale":1.1260626709809891},{"type":"grass","position":[-49.43527459804401,0,38.53220767595025],"scale":0.9233965029005073},{"type":"grass","position":[-5.789304622698318,0,20.751689254494213],"scale":0.8576019380816516},{"type":"grass","position":[-53.87213204787044,0,-124.82953116112414],"scale":0.9379062745553985},{"type":"grass","position":[-29.08628543870859,0,6.044817464247439],"scale":1.1910429401711187},{"type":"grass","position":[31.58760373221016,0,-2.422996283100785],"scale":1.2641124652251552},{"type":"grass","position":[-57.292756567674175,0,56.36861889956108],"scale":0.9442284525624023},{"type":"grass","position":[-40.33394072495099,0,-69.95217287579693],"scale":1.1242309222986895},{"type":"grass","position":[71.20079182599444,0,59.21762181723293],"scale":0.9315608251582372},{"type":"grass","position":[-114.1823511250569,0,0.9569716741766101],"scale":1.090950594610284},{"type":"grass","position":[-53.34217901004017,0,89.82731957818244],"scale":1.2609468848652279},{"type":"grass","position":[3.0359087242397513,0,3.522156053097446],"scale":0.93061755346947},{"type":"grass","position":[5.413928774126355,0,28.36154734459217],"scale":1.2697077082400932},{"type":"grass","position":[36.362143663789645,0,100.6343918117287],"scale":1.011124295129831},{"type":"grass","position":[28.18078438331853,0,-23.61752033018171],"scale":1.102338166673103},{"type":"grass","position":[-2.0205163745307546,0,-15.930880165612443],"scale":1.155408744321698},{"type":"grass","position":[144.61472305588555,0,-0.846627020433316],"scale":1.135799997796969},{"type":"grass","position":[86.46770008710591,0,7.808980337127191],"scale":0.9338727817837883},{"type":"grass","position":[-19.114880274177203,0,83.43001059863919],"scale":0.9751952163296328},{"type":"grass","position":[-3.606537107518061,0,-23.25257196574008],"scale":0.872010138938967},{"type":"grass","position":[-15.52423286860705,0,0.0532520037655522],"scale":0.928568918243894},{"type":"grass","position":[-42.55347008036532,0,-44.99210402677101],"scale":1.2292663455056814},{"type":"grass","position":[20.257969653173756,0,-59.234032013714796],"scale":0.806414242595502},{"type":"grass","position":[123.22838233087359,0,-67.85713463429975],"scale":0.7837447220885729},{"type":"grass","position":[81.92436202769018,0,-117.45295987741574],"scale":1.0031774501694026},{"type":"grass","position":[9.381458145003728,0,4.051927159969126],"scale":0.8207477269725123},{"type":"grass","position":[6.8452439139964865,0,-5.283715694247334],"scale":1.263863345931179},{"type":"grass","position":[18.683507819182825,0,11.609797367008023],"scale":1.2660834865772106},{"type":"grass","position":[58.111947651477294,0,-125.22979429189428],"scale":0.9669834446614768},{"type":"grass","position":[-10.984430985616601,0,-13.951074243848538],"scale":0.8011944683368675},{"type":"grass","position":[2.5797127394225496,0,85.75982721698747],"scale":1.231385901801378},{"type":"grass","position":[42.2079613835137,0,32.95063753568697],"scale":1.1143850893692073},{"type":"grass","position":[125.87821072462896,0,-60.86548580206362],"scale":1.2276109104951713},{"type":"grass","position":[25.233205473477604,0,56.00801216940076],"scale":0.8901525838552544},{"type":"grass","position":[-60.12935137156412,0,-12.047764501275644],"scale":0.9040388610812677},{"type":"grass","position":[97.58675020126171,0,-76.89315301500709],"scale":0.7149879335697834},{"type":"grass","position":[-1.7069071592305294,0,1.3718420081497333],"scale":1.0668021085693598},{"type":"grass","position":[-89.18539701212008,0,47.61463612611112],"scale":1.066571216248304},{"type":"grass","position":[32.030000370359666,0,2.546608258739999],"scale":0.9903698751278882},{"type":"grass","position":[62.525506373817755,0,-66.828818635036],"scale":0.7392709578381225},{"type":"grass","position":[64.23899836303465,0,-47.22994069027299],"scale":0.9233539706305318},{"type":"grass","position":[19.497868271827663,0,-22.584505941155932],"scale":1.1707806060281363},{"type":"grass","position":[27.768403229845738,0,-69.41733124182085],"scale":1.121165399077431},{"type":"grass","position":[17.74375211395474,0,-40.59359023203294],"scale":1.0382708467328707},{"type":"grass","position":[-44.81945966802017,0,142.2635726226668],"scale":1.2225770977909591},{"type":"grass","position":[7.605643665000366,0,-8.564011574938021],"scale":0.7956061496189949},{"type":"grass","position":[-28.72898607575601,0,-102.84019926484207],"scale":1.2846616875411194},{"type":"grass","position":[-57.12626620213961,0,128.0485608482598],"scale":0.7745648874811218},{"type":"grass","position":[69.47651968852472,0,84.70272878490564],"scale":0.9563091526715144},{"type":"grass","position":[17.235338695451762,0,-2.4791331669160024],"scale":1.1917406386052203},{"type":"grass","position":[-113.29855328444569,0,39.12438249406837],"scale":0.8065851615557923},{"type":"grass","position":[35.27647641728853,0,30.506668633162256],"scale":0.8434360039412554},{"type":"grass","position":[3.0285543877903165,0,15.88700062668553],"scale":1.006023726790099},{"type":"grass","position":[-18.551069710862873,0,-1.624548642453785],"scale":1.0208928703702778},{"type":"grass","position":[10.680121829538178,0,-115.5229038631119],"scale":1.0323484649233525},{"type":"grass","position":[19.580246239179957,0,-7.493601945551393],"scale":0.9644094940161854},{"type":"grass","position":[93.56743410244354,0,-47.83884119263076],"scale":0.7156365001519406},{"type":"grass","position":[-2.7409614623040044,0,-19.048652729745655],"scale":0.9335495064891621},{"type":"grass","position":[-95.907102499663,0,-60.841273336603905],"scale":1.2337324163942989},{"type":"grass","position":[15.93324829634655,0,76.96434721139855],"scale":0.7171906410429045},{"type":"grass","position":[109.93344180355356,0,-46.63465148551539],"scale":1.0321589484463218},{"type":"grass","position":[-47.107127744664766,0,17.236644953940154],"scale":0.9637956661853894},{"type":"grass","position":[39.32295745229944,0,36.138859290624815],"scale":0.8982383759599497},{"type":"grass","position":[5.6776675294748635,0,-4.450682791834938],"scale":1.2010231588879556},{"type":"grass","position":[-33.94176712486358,0,-82.9484279406344],"scale":0.8354692877665368},{"type":"grass","position":[-12.338853565125653,0,-25.918554159822595],"scale":1.292426931782563},{"type":"grass","position":[116.34905620148149,0,-72.5399889161752],"scale":1.2963081767842743},{"type":"grass","position":[-7.940469564408657,0,-107.8474378806433],"scale":0.7454859794150395},{"type":"grass","position":[-58.642178692299375,0,82.54194750775437],"scale":1.0336078948308847},{"type":"grass","position":[-3.3073995923102553,0,-21.999619108745723],"scale":1.0987306438692186},{"type":"grass","position":[2.3199563544672297,0,86.36131197144896],"scale":1.2145129960403032},{"type":"grass","position":[32.09484207490068,0,-17.60670543171015],"scale":0.8260838165613122},{"type":"grass","position":[-9.87916787709947,0,-4.858291417999775],"scale":1.0296358523638038},{"type":"grass","position":[-78.3013966013689,0,-66.24976786314521],"scale":1.2959572299055542},{"type":"grass","position":[-4.640512999161775,0,-7.389290857585841],"scale":1.0399488853195158},{"type":"grass","position":[54.51505471888637,0,93.10361284176238],"scale":1.2899500177039718},{"type":"grass","position":[9.797260860739119,0,47.36696717606646],"scale":0.9801186152468668},{"type":"grass","position":[-23.288904297978185,0,-9.281974552417315],"scale":1.0980926589042044},{"type":"grass","position":[2.940336120998425,0,-25.25274072080938],"scale":1.0975756700770425},{"type":"grass","position":[74.47704866727403,0,38.32984873740301],"scale":0.9134976875156097},{"type":"grass","position":[14.897100707349962,0,-92.65490911056773],"scale":1.2176984231370565},{"type":"grass","position":[-19.623965020433506,0,13.217282533963003],"scale":0.7906552682614567},{"type":"grass","position":[-0.2343296131738309,0,0.732824736795437],"scale":0.8341303649351566},{"type":"grass","position":[-25.41656515397821,0,-126.34758898285092],"scale":1.1066779301151624},{"type":"grass","position":[-113.17860283398862,0,-4.770767766079477],"scale":0.8601299135898863},{"type":"grass","position":[-62.88960296057457,0,93.66064299655302],"scale":1.0942438942769557},{"type":"grass","position":[110.97339344564125,0,83.34300846136723],"scale":1.15029741634786},{"type":"grass","position":[24.01679911697344,0,-7.933990297176231],"scale":1.1025898083878174},{"type":"grass","position":[-35.91009342805451,0,101.81685198089014],"scale":1.0240894087338828},{"type":"grass","position":[1.3072008072492043,0,-75.57150823041884],"scale":0.7619922086249759},{"type":"grass","position":[-1.5026599463820582,0,-100.35413345418158],"scale":1.1121167534403773},{"type":"grass","position":[84.76860408218802,0,9.716215628122008],"scale":1.281525567018257},{"type":"grass","position":[-73.8254517431295,0,80.0359377316298],"scale":0.8771757170912009},{"type":"grass","position":[-3.1104383039819408,0,18.40158913009521],"scale":1.0254600957569875},{"type":"grass","position":[7.4072150178437575,0,47.54327402871907],"scale":1.0598193975438444},{"type":"grass","position":[42.37796312394666,0,-40.82450543214397],"scale":1.1080467223520065},{"type":"grass","position":[100.48828209858272,0,-29.298502703738126],"scale":1.1631700633121687},{"type":"grass","position":[-41.11699319980952,0,-16.671741629104574],"scale":1.1476858245048465},{"type":"grass","position":[-4.722741972158184,0,-13.873459616328413],"scale":1.232586494792649},{"type":"grass","position":[144.52078251605909,0,24.83151513551944],"scale":0.9456346479288452},{"type":"grass","position":[29.771513564708563,0,-7.421009667021365],"scale":0.8459026013437062},{"type":"grass","position":[-26.624065778141343,0,2.403831759368382],"scale":1.0926257421480827},{"type":"grass","position":[-46.58168587460497,0,14.3026603708851],"scale":0.8230421846715374},{"type":"grass","position":[-59.48042427947578,0,77.41671070714223],"scale":1.1388513163783502},{"type":"grass","position":[-2.5151406803583143,0,-4.6543575535308515],"scale":0.7860159941540107},{"type":"grass","position":[23.972055957567154,0,-37.19202240012063],"scale":0.9307948073381274},{"type":"grass","position":[-15.338249288062322,0,-6.054922892818753],"scale":0.8509235052037739},{"type":"grass","position":[27.634405667643932,0,35.607297254057706],"scale":1.1448258812196952},{"type":"grass","position":[-102.84602555993025,0,-1.2709022184512357],"scale":1.078757910499956},{"type":"grass","position":[-16.656610047544785,0,25.11118446094592],"scale":0.7881923173466878},{"type":"grass","position":[123.12180276101012,0,63.64710997488425],"scale":1.1303856871424247},{"type":"grass","position":[61.62869429300768,0,-27.813302307927348],"scale":1.2400543135903705},{"type":"grass","position":[30.532808297854316,0,-33.41394390831989],"scale":1.007976895884405},{"type":"grass","position":[3.617951363802914,0,-31.887283710497996],"scale":0.7661773134231843},{"type":"grass","position":[-5.051442571979663,0,106.33474562272988],"scale":0.8900164717201589},{"type":"grass","position":[128.97054951761237,0,40.37956567527148],"scale":0.8763208769791002},{"type":"grass","position":[-34.83312664801639,0,19.00212557565277],"scale":1.0389845639592656},{"type":"grass","position":[97.1600424827777,0,24.42994328453655],"scale":1.241984061152075},{"type":"grass","position":[33.120050262244256,0,-58.14447461305313],"scale":0.9411248860335567},{"type":"grass","position":[-115.07922352896416,0,18.74354400411067],"scale":0.7679532578302319},{"type":"grass","position":[62.87694612989288,0,-2.2569325081705585],"scale":0.7703018485567472},{"type":"grass","position":[-23.707399150993503,0,-91.5847345324663],"scale":0.9696905603090886},{"type":"grass","position":[24.291162849750375,0,1.1843331695736061],"scale":0.9652334056989178},{"type":"grass","position":[-87.55028418701546,0,117.03508880365126],"scale":1.273737451406534},{"type":"grass","position":[-4.2344347832104186,0,-4.911487861632785],"scale":1.085255732265963},{"type":"grass","position":[-17.70839463320368,0,21.496157596837563],"scale":1.2414560877822773},{"type":"grass","position":[-142.06688528820692,0,35.31420539345581],"scale":1.1198417453729093},{"type":"grass","position":[79.9846667770541,0,99.4713905677638],"scale":1.174207698990088},{"type":"grass","position":[19.41888997973413,0,46.01825406042097],"scale":1.134783187996395},{"type":"grass","position":[0.7417381195712726,0,21.15857458594487],"scale":0.9005558671392164},{"type":"grass","position":[13.401778798377373,0,-31.941380679543883],"scale":1.0040554519026468},{"type":"grass","position":[21.155118616222808,0,-14.954037893941498],"scale":0.728958707007831},{"type":"grass","position":[108.80778386805204,0,46.70394825488651],"scale":0.8836688430937357},{"type":"grass","position":[-44.41449905121117,0,-100.76419181357078],"scale":0.8579042203919689},{"type":"grass","position":[107.18185071908682,0,-71.06011587336391],"scale":0.9825077177930728},{"type":"grass","position":[56.27506994762582,0,-102.74958941932137],"scale":0.8746694179333266},{"type":"grass","position":[61.497918692202326,0,102.93881580428784],"scale":1.122141967277951},{"type":"grass","position":[-31.606548911109474,0,-27.641212278897612],"scale":1.1866270884751553},{"type":"grass","position":[67.9116014939739,0,-100.69701842489863],"scale":1.2333533599076527},{"type":"grass","position":[4.550977243053364,0,-20.588635328863596],"scale":1.2970423245397544},{"type":"grass","position":[15.643132368979861,0,-22.16056798876434],"scale":1.2550698246323282},{"type":"grass","position":[-68.53637854864664,0,107.56423964163824],"scale":1.1706953155093207},{"type":"grass","position":[-6.655807977361789,0,-0.292730442737243],"scale":1.1567510094307156},{"type":"grass","position":[85.9405023188703,0,-74.93908359740982],"scale":1.1760163662786645},{"type":"grass","position":[-143.6942550481503,0,-2.3136960032766156],"scale":0.9894014862690286},{"type":"grass","position":[99.88234776428003,0,-84.18841493857802],"scale":0.7018331140102559},{"type":"grass","position":[-148.76005363039314,0,-7.223884342459188],"scale":0.8347413480876544},{"type":"grass","position":[16.33440357068166,0,-18.060869359879465],"scale":0.9362786428347789},{"type":"grass","position":[33.9123736275187,0,-95.24445562672912],"scale":0.8937582854178914},{"type":"grass","position":[8.630934064315866,0,-41.719835017241614],"scale":1.2432114538406664},{"type":"grass","position":[73.54367755209005,0,13.234098669720108],"scale":1.2999596337054764},{"type":"grass","position":[35.035370658926965,0,62.30818613538035],"scale":0.8797564520931828},{"type":"grass","position":[-88.01184073217814,0,-41.373293754682344],"scale":0.8388166782992668},{"type":"grass","position":[-53.422271430262775,0,61.11594704786315],"scale":1.0658968527789094},{"type":"grass","position":[-44.91702483532065,0,-61.81803289339253],"scale":1.0471782827683955},{"type":"grass","position":[-2.401245841624212,0,65.4041370974825],"scale":1.243241041299075},{"type":"grass","position":[36.23695849840192,0,22.6901350358796],"scale":1.2306755686541795},{"type":"grass","position":[145.5711108845979,0,-33.386966168647696],"scale":1.2430373929179557},{"type":"grass","position":[55.753195448279,0,83.11505555715087],"scale":0.8120607738068261},{"type":"grass","position":[23.110655325974914,0,135.94562950351482],"scale":1.217377890990924},{"type":"grass","position":[-12.068028326498144,0,83.61731733249832],"scale":1.2331102477653322},{"type":"grass","position":[-12.6465812586456,0,80.57067405357644],"scale":1.1946737130380662},{"type":"grass","position":[-48.971379684819965,0,6.08280779503498],"scale":0.872088467092253},{"type":"grass","position":[-4.342226533445662,0,-14.770555108534033],"scale":0.8713768578521486},{"type":"grass","position":[46.36019377907304,0,62.240447957171064],"scale":0.7032513938908418},{"type":"grass","position":[-97.46859725949172,0,-54.35325670452165],"scale":0.8062423076480885},{"type":"grass","position":[35.33895354588103,0,2.8216262081368986],"scale":1.0608263127005344},{"type":"grass","position":[58.817024951658944,0,-92.0916196938575],"scale":1.0611666588391615},{"type":"grass","position":[117.85620596026173,0,38.3799605460192],"scale":0.8016824693843112},{"type":"grass","position":[-127.983471899814,0,47.615012112654306],"scale":1.2315277216159284},{"type":"grass","position":[-36.88007093248078,0,91.29686466761129],"scale":0.8788704344353084},{"type":"grass","position":[-76.42346215915282,0,-18.48856417636327],"scale":1.0358662890435837},{"type":"grass","position":[18.020925288363284,0,28.915937925819865],"scale":1.178370463881084},{"type":"grass","position":[-5.426860278628467,0,9.498082115993029],"scale":0.9882084366681219},{"type":"grass","position":[35.729552038840175,0,41.16053981175486],"scale":1.166372094850964},{"type":"grass","position":[61.3311364569171,0,24.962250504530214],"scale":1.1922104561631726},{"type":"grass","position":[-126.60686674657622,0,-74.94071935561921],"scale":1.1300002391358919},{"type":"grass","position":[97.25325646768553,0,-54.18734421301565],"scale":0.7386284892265601},{"type":"grass","position":[50.65764657225973,0,117.88353103575706],"scale":0.8371293890695115},{"type":"grass","position":[-103.81873517078263,0,-29.200004192275145],"scale":0.8102694244746639},{"type":"grass","position":[-0.2332772130426538,0,-108.24784763389717],"scale":0.7079898655780936},{"type":"grass","position":[-23.777406910933323,0,112.61181044989662],"scale":0.8988457767543205},{"type":"grass","position":[26.741969517634278,0,-3.0800581821201325],"scale":0.9574459792970036},{"type":"grass","position":[-4.49456194526869,0,-12.828531504028216],"scale":1.1447664254921726},{"type":"grass","position":[18.606425726014585,0,113.020078048984],"scale":1.222475108189839},{"type":"grass","position":[-49.65239132754358,0,-66.04627000832066],"scale":1.0471840558073708},{"type":"grass","position":[122.26437716111586,0,-71.58379787451359],"scale":0.9387645106025283},{"type":"grass","position":[118.12161541168821,0,-49.314688791858416],"scale":0.9434180984728064},{"type":"grass","position":[-7.40019719359491,0,-16.932316151752662],"scale":0.9441142714028354},{"type":"grass","position":[-17.7999723785942,0,11.480108580519127],"scale":1.0457230663930044},{"type":"grass","position":[47.4201069595568,0,15.527681144536112],"scale":0.8834554027432232},{"type":"grass","position":[68.00610663380417,0,-19.368141433717778],"scale":1.2694804558666326},{"type":"grass","position":[11.145670486220032,0,-89.89976365224442],"scale":1.0301120784555358},{"type":"grass","position":[16.138856467125294,0,-97.73897182431938],"scale":1.1256659676427052}]'),pn={minX:-38,maxX:78,minZ:-28,maxZ:68},jC=-2;function yl(o,t){let e=vo(o,t);if(o>pn.minX&&o<pn.maxX&&t>pn.minZ&&t<pn.maxZ){const s=Math.min(o-pn.minX,pn.maxX-o),i=Math.min(t-pn.minZ,pn.maxZ-t),n=Math.min(s,i),r=Math.min(1,n/10),a=Gt.lerp(e,jC,r);a<e&&(e=a)}return e}function KC(o,t,e=!0){nA();const s=pA();o.add(s);const i=wN();o.add(i);const n=bN();n.position.set(-50,60,-30),o.add(n);const r=new $i(400,400,128,128),a=r.attributes.position;for(let h=0;h<a.count;h++){const d=a.getX(h),f=-a.getY(h),m=yl(d,f);a.setZ(h,m)}r.computeVertexNormals();const c=new H4({color:as.colors.ground,roughness:.4,metalness:0,clearcoat:.3,clearcoatRoughness:.6,flatShading:!1}),l=new V(r,c);l.rotation.x=-Math.PI/2,l.receiveShadow=!0,o.add(l);const u=new W(as.colors.fog);o.fog=new Hp(u,.012),o.background=u,hA(o,1e4),o.add(IA(150,100));const p=yN(120,100);return p.position.set(20,1.5,20),o.add(p),aA(o),o.add(Jd),e&&ng(t),{sky:s,moon:n,ground:l}}function Ip(o,t=!1,e=1,s=null){ho.length>1e3||(Qd.add(o),ho.push(o),t&&jd.push({position:o.position.clone(),radius:e}),o.userData.type==="mushroom"&&dl.push(o),o.userData.type==="cloud"&&Ps.push(o),o.userData.isTrampoline&&Kd.push(o),s&&(o.userData.type==="tree"?s.registerTree(o):o.userData.type==="shrub"?s.registerShrub(o):o.userData.type==="mushroom"?s.registerMushroom(o):o.userData.type==="cave"&&(s.registerCave(o),zC(o))))}function JC(o,t,e){if(o*o+t*t<225)return!1;for(const i of jd){const n=o-i.position.x,r=t-i.position.z,a=n*n+r*r,c=i.radius+e+1.5;if(a<c*c)return!1}return!(o>-40&&o<80&&t>-30&&t<70)}function ng(o){console.log(`[World] Loading map with ${O5.length} entities...`),O5.forEach(n=>{const[r,a,c]=n.position;let u=yl(r,c);n.type==="cloud"&&(u=a);try{let p=null,h=!1,d=.5;if(n.type==="mushroom"){const g=n.variant==="giant",f=n.scale||1,m=n.hasFace!==void 0?n.hasFace:g||Math.random()<.1;p=An({size:g?"giant":"regular",scale:f,hasFace:m,isBouncy:g||m,note:n.note,noteIndex:n.noteIndex}),h=!0,d=g?2:.5}else if(n.type==="flower")p=n.variant==="glowing"?Ed():xh();else if(n.type==="cloud")p=Ld({size:n.size||1.5});else if(n.type==="grass"){dA(r,u,c);return}else if(n.type==="subwoofer_lotus")p=EN({scale:n.scale||1});else if(n.type==="accordion_palm")p=vA({color:16766720}),h=!0;else if(n.type==="fiber_optic_willow")p=_A(),h=!0;else if(n.type==="floating_orb")p=PA({size:.5}),u+=1.5;else if(n.type==="swingable_vine")p=TA({length:8}),u+=8,gl&&gl.push(new SA(p,8));else if(n.type==="prism_rose_bush")p=mA(),h=!0;else if(n.type==="starflower")p=fA();else if(n.type==="vibrato_violet")p=yA();else if(n.type==="tremolo_tulip")p=Dd();else if(n.type==="kick_drum_geyser")p=zd();else if(n.type==="arpeggio_fern")p=Hd({scale:n.scale||1});else if(n.type==="portamento_pine")p=qd({height:4}),h=!0;else if(n.type==="cymbal_dandelion")p=Yd();else if(n.type==="snare_trap")p=Xd();else if(n.type==="panning_pad"){const g=r<0?-1:1;p=Od({radius:n.scale||1,panBias:g}),u<2&&(u=1)}else if(n.type==="silence_spirit")p=Wd({scale:n.scale||1});else if(n.type==="instrument_shrine"){const g=parseInt(n.variant||"0",10);p=$d({instrumentID:g,scale:n.scale||1}),h=!0,d=1}else n.type==="bubble_willow"?(p=Bd(),h=!0):n.type==="helix_plant"?p=Pd():n.type==="balloon_bush"?p=Id():n.type==="wisteria_cluster"&&(p=bA(),u+=4);p&&(p.position.set(r,u,c),p.rotation.y=Math.random()*Math.PI*2,n.scale&&n.type!=="mushroom"&&n.type!=="flower"&&p.scale.setScalar(n.scale),Ip(p,h,d,o))}catch(p){console.warn(`[World] Failed to spawn ${n.type} at ${r},${c}`,p)}});const t=sC({scale:2}),e=25,s=25,i=yl(e,s);t.position.set(e,i,s),t.lookAt(0,i,0),Ip(t,!1,0,o),console.log("[World] Cave spawned at ",e,s," Height:",i),QC(o)}function QC(o){console.log("[World] Populating procedural extras..."),window.setLoadingStatus&&window.setLoadingStatus("Growing Procedural Flora...");const t=40,e=150;for(let s=0;s<t;s++){let i=null,n=!1,r=.5,a=0,c=0,l=0,u=0,p=!1;for(;u<10;){if(a=(Math.random()-.5)*e,c=(Math.random()-.5)*e,JC(a,c,1.5)){p=!0;break}u++}if(!p)continue;const h=yl(a,c);try{const d=Math.random();if(d<.3)i=Math.random()<.5?xh():Ed(),i.position.set(a,h,c);else if(d<.45)i=An({size:"regular",scale:.8+Math.random()*.5,hasFace:!0,isBouncy:!0}),i.position.set(a,h,c),n=!0;else if(d<.55){const g=Math.random();g<.33?i=Bd():g<.66?i=Id():i=Pd(),i.position.set(a,h,c),n=!0,r=1.5}else if(d<.75){const g=Math.random();if(g<.2)i=Hd({scale:1+Math.random()*.5});else if(g<.35)i=zd({maxHeight:5+Math.random()*3}),r=1;else if(g<.5)i=Xd({scale:.8+Math.random()*.4}),n=!0,r=.8;else if(g<.6)i=qd({height:4+Math.random()*2}),n=!0,r=.5;else if(g<.75)i=Dd({size:1+Math.random()*.5});else if(g<.85)i=Yd({scale:.8+Math.random()*.4});else{const f=a<0?-1:1;i=Od({radius:1.2+Math.random(),panBias:f}),i.position.y=h+.5}i&&i.position.set(a,i.position.y||h,c)}else if(d<.9)l=Math.random()<.5?35+Math.random()*20:12+Math.random()*10,i=Ld({size:1+Math.random()}),i.position.set(a,l,c);else if(d<.95)i=Wd(),i.position.set(a,h,c);else if(d<.97)i=NN({scale:2}),i.position.set(a,h+15+Math.random()*10,c);else{const g=Math.floor(Math.random()*16);i=$d({instrumentID:g}),i.position.set(a,h,c),n=!0}i&&(i.rotation.y=Math.random()*Math.PI*2,Ip(i,n,r,o))}catch(d){console.warn(`[World] Failed to spawn procedural extra at ${a},${c}`,d)}}console.log("[World] Finished populating procedural extras.")}const zc=[],tF=60,eF=.5,sF=new ne(eF,8,8),iF=S0(16777215);function og(o,t,e){const s=new V(sF,iF.clone()),n=performance.now()/1e3*.5%1;s.material.color.setHSL(n,1,.5),s.material.emissive.setHSL(n,1,.8),s.material.emissiveIntensity=2,s.position.copy(t),s.userData.velocity=e.clone().normalize().multiplyScalar(tF),s.userData.life=3,o.add(s),zc.push(s)}function nF(o,t,e,s){const n=Zd(s).sunIntensity>.5;for(let r=zc.length-1;r>=0;r--){const a=zc[r];a.position.addScaledVector(a.userData.velocity,o),a.userData.life-=o;let c=!1;for(let l=Ps.length-1;l>=0;l--){const u=Ps[l],p=3*(u.scale.x||1);if(a.position.distanceToSquared(u.position)<p*p){c=!0,n?rF(u,t):aF(u,t),e&&e.notifyCloudShot&&e.notifyCloudShot(n);break}}(c||a.userData.life<=0)&&(t.remove(a),zc.splice(r,1))}oF(o,t)}const kc=[];function rg(o,t,e,s){const n=new zt,r=new Float32Array(45),a=new Float32Array(45),c=[];for(let p=0;p<15;p++)r[p*3]=t.x+(Math.random()-.5)*2,r[p*3+1]=t.y+(Math.random()-.5)*2,r[p*3+2]=t.z+(Math.random()-.5)*2,a[p*3]=0,a[p*3+1]=1,a[p*3+2]=0,s==="mist"?c.push(new S((Math.random()-.5)*2,Math.random()*2,(Math.random()-.5)*2)):c.push(new S((Math.random()-.5)*1,-10-Math.random()*5,(Math.random()-.5)*1));n.setAttribute("position",new it(r,3)),n.setAttribute("normal",new it(a,3));const l=new xo({color:e,size:s==="mist"?1.5:.5,transparent:!0,opacity:.8,blending:Jt}),u=new Zi(n,l);u.userData={velocities:c,life:1.5,type:s},o.add(u),kc.push(u)}function oF(o,t){for(let e=kc.length-1;e>=0;e--){const s=kc[e];s.userData.life-=o;const i=s.geometry.attributes.position.array,n=s.userData.velocities;for(let r=0;r<n.length;r++)i[r*3]+=n[r].x*o,i[r*3+1]+=n[r].y*o,i[r*3+2]+=n[r].z*o;s.geometry.attributes.position.needsUpdate=!0,s.material.opacity=s.userData.life,s.userData.life<=0&&(t.remove(s),s.geometry.dispose(),s.material.dispose(),kc.splice(e,1))}}function rF(o,t){o.userData.isFalling||(o.userData.isFalling=!0,o.userData.velocity=new S(0,5,0),rg(t,o.position,16777215,"mist"),o.traverse(e=>{e.isMesh&&e.material&&(e.material.transparent=!0,e.material.opacity=.5)}))}function aF(o,t){o.userData.isFalling||(o.userData.isFalling=!0,o.userData.velocity=new S(0,-20,0),rg(t,o.position,255,"rain"),o.traverse(e=>{e.isMesh&&e.material&&(e.material.color.setHex(136),e.material.emissive.setHex(255))}))}const cF=new W(1710638),lF=new W(3029593),uF=new W(4871528),W5=new W(10532296),pF=new W(12636384),hF=new W,dF=new W,gF=new W,wc=new S,Su=new W,vs={biasState:"clear",biasIntensity:0,type:"clear"},{scene:jt,camera:ie,renderer:Vc,ambientLight:$5,sunLight:nr,sunGlow:bc,sunCorona:vc,lightShaftGroup:or,sunGlowMat:_c,coronaMat:Sc}=pC(),_h=new KN,ag=new JN(_h),fF=new YN(jt,{}),Ys=new lC(jt);window.setLoadingStatus&&window.setLoadingStatus("Loading World Map...");const{moon:rr,fireflies:H5}=KC(jt,Ys,!1);oA(jt);let Tu=null,Mu=null,q5=!1,xl=null,za=null,Au=null;function mF(){Tu||(Tu=SN(),jt.add(Tu),console.log("[Deferred] Aurora initialized")),Mu||(Mu=xN(),ie.add(Mu),console.log("[Deferred] Chromatic Pulse initialized")),q5||(LN(jt),q5=!0,console.log("[Deferred] Celestial bodies initialized")),xl||(xl=TN(jt),console.log("[Deferred] Melody Ribbon initialized")),za||(za=CN(),jt.add(za),console.log("[Deferred] Sparkle Trail initialized")),Au||(Au=RN(),jt.add(Au),console.log("[Deferred] Impact System initialized"))}let hr=!1,cg=0;function yF(){cg+=Js/2;const o=!hr;Sh.updateDayNightButtonState(o)}const Sh=bC(ie,_h,yF),xF=Sh.controls,lg=new UN(ie,Sh.updateReticleState);window.addEventListener("keydown",o=>{try{if(!o.key)return;const t=o.key.toLowerCase();t==="p"&&qs.toggle()}catch(t){console.warn("Demo trigger error",t)}});window.addEventListener("mousedown",o=>{if(document.pointerLockElement&&o.button===0&&!lg.triggerClick()){const e=new S;ie.getWorldDirection(e);const s=ie.position.clone().add(e.clone().multiplyScalar(1));s.y-=.2,og(jt,s,e)}});const wF=new Cm;let Tc=0,$t=null,Nu=0,Cs=0,fn=0;const Y5=75;ag.onBeat(o=>{const t=o?.kickTrigger||0;t>.2&&(Cs=Math.max(Cs,.4+t*.5),fn=Math.max(fn,1+t*3)),typeof Ua<"u"&&(Ua.value+=.5*(t+.1))});function bF(o,t){const e=ei,s=_o,i=Yi,n=180;if(vs.biasState="clear",vs.biasIntensity=0,vs.type="clear",o<e+60){const r=o/(e+60);vs.biasState="rain",vs.biasIntensity=.3*(1-r),vs.type="mist"}else if(o>e+120&&o<e+s-60)Math.random()<3e-4&&(vs.biasState="storm",vs.biasIntensity=.7+Math.random()*.3,vs.type="thunderstorm");else if(o>e+s&&o<e+s+i+n/2){const r=(o-e-s)/(i+n/2);vs.biasState="rain",vs.biasIntensity=.3+r*.2,vs.type="drizzle"}return vs}function vF(){qs.startFrame();const o=wF.getDelta(),t=Math.min(o,.1);$t=qs.measure("Audio",()=>_h.update()),qs.measure("BeatSync",()=>ag.update());const e=$t?.bpm||120,s=120/Math.max(10,e);Tc+=t*s,$e.value=Tc;const i=Tc,n=i+cg,r=n%Js,a=bF(r);qs.measure("Weather",()=>{Ys.update(i,$t,a),Ys.updateBerrySeasonalSize(r,Js)}),qs.measure("Interaction",()=>{const kt=ho||[],Bt=dl||[],Ae=Ps||[];lg.update(t,ie.position,kt,Bt,Ae)});const c=$t?.bpm||120,l=Gt.clamp((c-60)/120,0,1.5),p=(1+Ys.windSpeed*4)*(1+l*.5);_p.value=Gt.lerp(_p.value,p,.05),Sp.value.copy(Ys.windDirection);const h=$t?.beatPhase||0;if(h<Nu&&Nu>.8){const kt=$t?.kickTrigger||0;kt>.3&&(Cs=.5+kt*.5,fn=2+kt*3)}Nu=h,Cs>0&&(Cs*=.9,Cs<.01&&(Cs=0)),fn>0&&(ie.fov=Y5-fn,ie.updateProjectionMatrix(),fn*=.85,fn<.1&&(fn=0,ie.fov=Y5,ie.updateProjectionMatrix()));const d=tC(n,Ys.targetPaletteMode||"standard"),g=ei+_o+Yi;hr=r>g-30||r<ei;const f=Ys.getIntensity(),m=Ys.getState(),x=hF.copy(d.skyTop),w=dF.copy(d.skyBot),b=gF.copy(d.fog);m===bt.STORM?(x.lerp(cF,f*.6),w.lerp(lF,f*.5),b.lerp(uF,f*.4)):m===bt.RAIN&&(x.lerp(W5,f*.3),w.lerp(W5,f*.25),b.lerp(pF,f*.2)),Cd.value.copy(x),Fd.value.copy(w),Tp.value.copy(d.horizon),Rd.value=d.atmosphereIntensity,jt.fog.color.copy(b);const v=hr?5:20,T=hr?40:100;jt.fog.near+=(v-jt.fog.near)*t*.5,jt.fog.far+=(T-jt.fog.far)*t*.5;let M=d.sunInt,F=d.ambInt;if(m===bt.STORM?(M*=1-f*.7,F*=1-f*.5):m===bt.RAIN&&(M*=1-f*.3,F*=1-f*.2),nr.color.copy(d.sun),nr.intensity=M,$5.color.copy(d.amb),$5.intensity=F+Cs*.5,r<540){const kt=r/540,Bt=kt*Math.PI,Ae=100;nr.position.set(Math.cos(Bt)*-Ae,Math.sin(Bt)*Ae,20),nr.visible=!0,bc.visible=!0,vc.visible=!0,rr.visible=!1,wc.copy(nr.position).normalize(),bc.position.copy(wc).multiplyScalar(400),bc.lookAt(ie.position),vc.position.copy(wc).multiplyScalar(390),vc.lookAt(ie.position),or.position.copy(wc).multiplyScalar(380),or.lookAt(ie.position);let Se=.25,Qe=.15,Gn=0,qr=!1;if(kt<.15){const xt=1-kt/.15;Se=.25+xt*.35,Qe=.15+xt*.25,Gn=xt*.12,qr=!1,_c.color.setHex(16757606),Sc.color.setHex(16766627)}else if(kt>.85){const xt=(kt-.85)/.15;Se=.25+xt*.45,Qe=.15+xt*.35,Gn=xt*.18,qr=!1,_c.color.setHex(16750950),Sc.color.setHex(16764057)}else _c.color.setHex(16770457),Sc.color.setHex(16774358);_c.opacity=Se,Sc.opacity=Qe,or.visible=qr,qr&&(or.rotation.z+=t*.1,or.children.forEach(xt=>{xt.material.opacity=Gn}))}else{nr.visible=!1,bc.visible=!1,vc.visible=!1,or.visible=!1,rr.visible=!0;const Bt=(r-540)/(Js-540)*Math.PI,Ae=90;rr.position.set(Math.cos(Bt)*-Ae,Math.sin(Bt)*Ae,-30),rr.lookAt(0,0,0),vN(rr,t,$t)}const N=r/Js;let A=0;const E=.5,U=.6,$=.9,Z=.98;N>=U&&N<=$?A=1:N>E&&N<U?A=(N-E)/(U-E):N>$&&N<Z&&(A=1-(N-$)/(Z-$)),Rp.value=Gt.lerp(Rp.value,A*.95,t*2);const j=A*.8;if($t){const kt=$t.kickTrigger||0;zs.value=Gt.lerp(zs.value,kt,.2);let Bt=0,Ae=0;if($t.channelData){if($t.channelData.length>5){const Se=$t.channelData[5].trigger||0,Qe=$t.channelData[6]&&$t.channelData[6].trigger||0;Bt=Math.max(Se,Qe)}for(const Se of $t.channelData)Se.activeEffect===5&&Se.effectValue>0&&(Ae=Math.max(Ae,Se.effectValue))}Bn.value=Gt.lerp(Bn.value,Bt,.2),Ae>0?Vi.value=Ae*.5:(Vi.value*=.8,Vi.value<.01&&(Vi.value=0)),Cs>.4?cs.value=(Cs-.4)*2:(cs.value*=.85,cs.value<.01&&(cs.value=0))}let ut=0;$t&&$t.channelData&&$t.channelData.length>4?ut=$t.channelData[4].trigger||0:$t&&(ut=($t.energy||0)*2);const nt=j*(.3+ut*.7);Dp.value=Gt.lerp(Dp.value,nt,t*2);const Ue=i*.05%1;Su.setHSL(Ue,1,.5),Cs>.2&&Su.setHSL(.8+Cs*.1,1,.6),Lc.value.copy(Su);let _e="clear";m===bt.STORM?_e="storm":m===bt.RAIN&&(_e="rain"),gN($t,hr,_e,f);const It=ei+_o+Yi+ll,se=It+ul,_t=r>=It&&r<se;qs.measure("MusicReact",()=>{fF.update(i,$t,Ys,ho,ie,hr,_t,rr),xl&&MN(xl,t,$t)}),H5&&(H5.visible=_t),qs.measure("Physics",()=>{kC(t,ie,xF,Te,$t),za&&FN(za,O.position,O.velocity,Tc)}),qs.measure("Gameplay",()=>{lA(t);const kt=uA(ie.position,1.5);kt>0&&(O.energy=Math.min(O.maxEnergy,O.energy+kt*.5)),O.energy=Math.max(0,O.energy-t*.1),nF(t,jt,Ys,i),DA(t,Ps,vo)}),qs.measure("Render",()=>Vc.render(jt,ie)),qs.endFrame()}XA().then(async o=>{console.log(`WASM module ${o?"active":"using JS fallbacks"}`);const t=vo(ie.position.x,ie.position.z);ie.position.y=t+1.8,console.log(`[Startup] Camera positioned at ground height: y=${ie.position.y.toFixed(2)}`),window.setLoadingStatus&&window.setLoadingStatus("Preparing Scene..."),Vc.setAnimationLoop(vF);try{window.__sceneReady=!0}catch{}window.setLoadingStatus&&window.setLoadingStatus("Entering Candy World..."),setTimeout(()=>{window.hideLoadingScreen&&window.hideLoadingScreen()},200);const e=An({size:"giant",scale:1.5,hasFace:!0,isBouncy:!0});e.position.set(0,vo(0,-10),-10),e.rotation.y=Math.PI/8,jt.add(e),ho.push(e);const s=document.getElementById("startButton");s&&(s.disabled=!1,s.innerText="Enter World ",s.addEventListener("click",()=>{console.log("[Startup] Entering world..."),s.disabled=!0,s.innerHTML='<span class="spinner" aria-hidden="true"></span>Generating... ',setTimeout(()=>{jt.remove(e);const i=ho.indexOf(e);i>-1&&ho.splice(i,1),ng(Ys);const n=document.getElementById("instructions");n&&(n.style.display="none")},50)},{once:!0})),setTimeout(async()=>{console.log("[Deferred] Starting shader pre-compilation...");const i=new K;i.position.set(0,-9999,0),jt.add(i);const n=xh({shape:"layered"}),r=An({size:"regular"});i.add(n),i.add(r);const a=new S(0,-9999,0),c=new S(0,1,0);og(jt,a,c);try{await Vc.compileAsync(jt,ie),await hC(Vc,jt,ie),console.log(" Scene shaders pre-compiled (Nuclear Warmup complete).")}catch(l){console.warn("Shader compile error:",l)}jt.remove(i),console.log("[Deferred] Shader compilation complete")},2e3),setTimeout(()=>{console.log("[Deferred] Loading celestial bodies and aurora..."),mF()},300)});
